---------------------
PatchSet 316 
Date: 2010/09/24 08:06:37
Author: millert
Branch: HEAD
Tag: (none) 
Log:
merge in perl 5.12.2 plus local changes

Members: 
	Changes:1.14->1.15 
	Configure:1.22->1.23 
	DynaLoader.sed:1.1->1.2 
	INSTALL:1.12->1.13 
	MANIFEST:1.21->1.22 
	Makefile.SH:1.19->1.20 
	Makefile.bsd-wrapper:1.82->1.83 
	Makefile.bsd-wrapper1:1.8->1.9 
	README:1.11->1.12 
	README.os2:1.12->1.13 
	README.qnx:1.3->1.4 
	README.vms:1.13->1.14 
	README.win32:1.11->1.12 
	XSUB.h:1.12->1.13 
	av.c:1.12->1.13 
	av.h:1.9->1.10 
	cflags.SH:1.10->1.11 
	config_h.SH:1.12->1.13 
	configpm:1.14->1.15 
	configure.gnu:1.8->1.9 
	cop.h:1.12->1.13 
	cv.h:1.11->1.12 
	deb.c:1.11->1.12 
	doio.c:1.14->1.15 
	doop.c:1.13->1.14 
	dump.c:1.12->1.13 
	embed.h:1.13->1.14 
	embed.pl:1.11->1.12 
	git_version.h:1.1->1.2 
	global.sym:1.12->1.13 
	globvar.sym:1.5->1.6 
	gv.c:1.12->1.13 
	gv.h:1.10->1.11 
	handy.h:1.12->1.13 
	hv.c:1.13->1.14 
	hv.h:1.10->1.11 
	installperl:1.25->1.26 
	makedef.pl:1.5->1.6 
	malloc.c:1.11->1.12 
	mg.c:1.15->1.16 
	mg.h:1.10->1.11 
	miniperlmain.c:1.10->1.11 
	op.c:1.14->1.15 
	op.h:1.12->1.13 
	opcode.h:1.12->1.13 
	opcode.pl:1.12->1.13 
	patchlevel.h:1.17->1.18 
	perl.c:1.20->1.21 
	perl.h:1.15->1.16 
	perlio.c:1.13->1.14 
	perly.c:1.11->1.12 
	perly.h:1.5->1.6 
	perly.y:1.12->1.13 
	pp.c:1.13->1.14 
	pp.h:1.11->1.12 
	pp_ctl.c:1.13->1.14 
	pp_hot.c:1.13->1.14 
	pp_sys.c:1.12->1.13 
	proto.h:1.13->1.14 
	regcomp.c:1.15->1.16 
	regcomp.h:1.10->1.11 
	regexec.c:1.13->1.14 
	regexp.h:1.9->1.10 
	scope.c:1.12->1.13 
	scope.h:1.12->1.13 
	shlib_version:1.12->1.13 
	sv.c:1.16->1.17 
	sv.h:1.13->1.14 
	taint.c:1.12->1.13 
	toke.c:1.14->1.15 
	universal.c:1.13->1.14 
	util.c:1.13->1.14 
	util.h:1.10->1.11 
	Cross/Makefile:1.5->1.6 
	Cross/README:1.5->1.6 
	Porting/Glossary:1.10->1.11 
	Porting/Maintainers.pl:1.1->1.2 
	Porting/config_H:1.11->1.12 
	Porting/makerel:1.8->1.9 
	Porting/pumpkin.pod:1.10->1.11 
	beos/nm.c:1.8->1.9 
	cpan/CGI/lib/CGI.pm:1.1->1.2 
	cpan/CGI/lib/CGI/Fast.pm:1.1->1.2 
	cpan/CPANPLUS/bin/cpanp:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Backend.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Config.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Configure.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Dist.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Error.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/FAQ.pod:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Hacking.pod:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Internals.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Module.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Selfupdate.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Shell.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Backend/RV.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Dist/Autobundle.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Dist/MM.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Internals/Extract.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Internals/Fetch.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Internals/Report.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Internals/Search.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Internals/Source.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Internals/Utils.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Internals/Source/Memory.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Module/Author.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Module/Checksums.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Module/Fake.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Module/Author/Fake.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Shell/Default.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/CustomSource.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/Remote.pm:1.1->1.2 
	cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/Source.pm:1.1->1.2 
	cpan/Compress-Raw-Bzip2/private/MakeUtil.pm:1.1->1.2 
	cpan/Compress-Raw-Zlib/private/MakeUtil.pm:1.1->1.2 
	cpan/Compress-Raw-Zlib/zlib-src/adler32.c:1.1->1.2 
	cpan/Compress-Raw-Zlib/zlib-src/compress.c:1.1->1.2 
	cpan/Compress-Raw-Zlib/zlib-src/crc32.c:1.1->1.2 
	cpan/Compress-Raw-Zlib/zlib-src/deflate.c:1.1->1.2 
	cpan/Compress-Raw-Zlib/zlib-src/deflate.h:1.1->1.2 
	cpan/Compress-Raw-Zlib/zlib-src/trees.c:1.1->1.2 
	cpan/Compress-Raw-Zlib/zlib-src/uncompr.c:1.1->1.2 
	cpan/Compress-Raw-Zlib/zlib-src/zconf.h:1.1->1.2 
	cpan/Compress-Raw-Zlib/zlib-src/zutil.c:1.1->1.2 
	cpan/Compress-Raw-Zlib/zlib-src/zutil.h:1.1->1.2 
	cpan/Devel-PPPort/Makefile.PL:1.1->1.2 
	cpan/Devel-PPPort/PPPort_pm.PL:1.1->1.2 
	cpan/Devel-PPPort/PPPort_xs.PL:1.1->1.2 
	cpan/Devel-PPPort/apicheck_c.PL:1.1->1.2 
	cpan/Devel-PPPort/mktests.PL:1.1->1.2 
	cpan/Devel-PPPort/module2.c:1.1->1.2 
	cpan/Devel-PPPort/module3.c:1.1->1.2 
	cpan/Devel-PPPort/ppport_h.PL:1.1->1.2 
	cpan/Devel-PPPort/soak:1.1->1.2 
	cpan/Devel-PPPort/typemap:1.1->1.2 
	cpan/Devel-PPPort/devel/buildperl.pl:1.1->1.2 
	cpan/Devel-PPPort/devel/devtools.pl:1.1->1.2 
	cpan/Devel-PPPort/devel/mkapidoc.sh:1.1->1.2 
	cpan/Devel-PPPort/devel/mktodo:1.1->1.2 
	cpan/Devel-PPPort/devel/mktodo.pl:1.1->1.2 
	cpan/Devel-PPPort/devel/regenerate:1.1->1.2 
	cpan/Devel-PPPort/devel/scanprov:1.1->1.2 
	cpan/Devel-PPPort/parts/apicheck.pl:1.1->1.2 
	cpan/Devel-PPPort/parts/ppport.fnc:1.1->1.2 
	cpan/Devel-PPPort/parts/ppptools.pl:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/HvNAME:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/MY_CXT:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/SvPV:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/SvREFCNT:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/Sv_set:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/call:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/cop:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/exception:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/format:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/grok:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/gv:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/limits:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/mPUSH:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/magic:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/memory:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/misc:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/newCONSTSUB:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/newRV:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/newSV_type:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/newSVpv:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/podtest:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/ppphbin:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/ppphdoc:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/ppphtest:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/pv_tools:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/pvs:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/shared_pv:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/snprintf:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/sprintf:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/strlfuncs:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/sv_xpvf:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/threads:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/uv:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/variables:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/version:1.1->1.2 
	cpan/Devel-PPPort/parts/inc/warn:1.1->1.2 
	cpan/Digest-MD5/Changes:1.1->1.2 
	cpan/Digest-MD5/MD5.xs:1.1->1.2 
	cpan/Digest-MD5/t/files.t:1.1->1.2 
	cpan/Encode/Changes:1.1->1.2 
	cpan/Encode/Encode.pm:1.1->1.2 
	cpan/Encode/Encode.xs:1.1->1.2 
	cpan/Encode/Makefile.PL:1.1->1.2 
	cpan/Encode/encoding.pm:1.1->1.2 
	cpan/Encode/Byte/Byte.pm:1.1->1.2 
	cpan/Encode/CN/CN.pm:1.1->1.2 
	cpan/Encode/EBCDIC/EBCDIC.pm:1.1->1.2 
	cpan/Encode/Encode/Changes.e2x:1.1->1.2 
	cpan/Encode/JP/JP.pm:1.1->1.2 
	cpan/Encode/KR/KR.pm:1.1->1.2 
	cpan/Encode/Symbol/Symbol.pm:1.1->1.2 
	cpan/Encode/TW/TW.pm:1.1->1.2 
	cpan/Encode/Unicode/Unicode.pm:1.1->1.2 
	cpan/Encode/Unicode/Unicode.xs:1.1->1.2 
	cpan/Encode/bin/enc2xs:1.1->1.2 
	cpan/Encode/bin/piconv:1.1->1.2 
	cpan/Encode/bin/ucm2table:1.1->1.2 
	cpan/Encode/bin/ucmlint:1.1->1.2 
	cpan/Encode/bin/ucmsort:1.1->1.2 
	cpan/Encode/lib/Encode/Alias.pm:1.1->1.2 
	cpan/Encode/lib/Encode/CJKConstants.pm:1.1->1.2 
	cpan/Encode/lib/Encode/Config.pm:1.1->1.2 
	cpan/Encode/lib/Encode/Encoder.pm:1.1->1.2 
	cpan/Encode/lib/Encode/Encoding.pm:1.1->1.2 
	cpan/Encode/lib/Encode/GSM0338.pm:1.1->1.2 
	cpan/Encode/lib/Encode/Guess.pm:1.1->1.2 
	cpan/Encode/lib/Encode/CN/HZ.pm:1.1->1.2 
	cpan/Encode/lib/Encode/JP/H2Z.pm:1.1->1.2 
	cpan/Encode/lib/Encode/JP/JIS7.pm:1.1->1.2 
	cpan/Encode/lib/Encode/KR/2022_KR.pm:1.1->1.2 
	cpan/Encode/lib/Encode/MIME/Header.pm:1.1->1.2 
	cpan/Encode/lib/Encode/MIME/Name.pm:1.1->1.2 
	cpan/Encode/lib/Encode/MIME/Header/ISO_2022_JP.pm:1.1->1.2 
	cpan/Encode/lib/Encode/Unicode/UTF7.pm:1.1->1.2 
	cpan/Encode/t/Encoder.t:1.1->1.2 
	cpan/Encode/t/Mod_EUCJP.pm:1.1->1.2 
	cpan/Encode/t/Unicode.t:1.1->1.2 
	cpan/Encode/t/enc_data.t:1.1->1.2 
	cpan/Encode/t/enc_eucjp.t:1.1->1.2 
	cpan/Encode/t/enc_module.t:1.1->1.2 
	cpan/Encode/t/enc_utf8.t:1.1->1.2 
	cpan/Encode/t/from_to.t:1.1->1.2 
	cpan/Encode/t/jperl.t:1.1->1.2 
	cpan/Encode/t/mime-header.t:1.1->1.2 
	cpan/Encode/t/mime-name.t:1.1->1.2 
	cpan/Encode/t/piconv.t:1.1->1.2 
	cpan/Encode/t/rt.pl:1.1->1.2 
	cpan/Encode/ucm/8859-1.ucm:1.1->1.2 
	cpan/Encode/ucm/8859-10.ucm:1.1->1.2 
	cpan/Encode/ucm/8859-11.ucm:1.1->1.2 
	cpan/Encode/ucm/8859-13.ucm:1.1->1.2 
	cpan/Encode/ucm/8859-14.ucm:1.1->1.2 
	cpan/Encode/ucm/8859-15.ucm:1.1->1.2 
	cpan/Encode/ucm/8859-16.ucm:1.1->1.2 
	cpan/Encode/ucm/8859-2.ucm:1.1->1.2 
	cpan/Encode/ucm/8859-3.ucm:1.1->1.2 
	cpan/Encode/ucm/8859-4.ucm:1.1->1.2 
	cpan/Encode/ucm/8859-5.ucm:1.1->1.2 
	cpan/Encode/ucm/8859-6.ucm:1.1->1.2 
	cpan/Encode/ucm/8859-7.ucm:1.1->1.2 
	cpan/Encode/ucm/8859-8.ucm:1.1->1.2 
	cpan/Encode/ucm/8859-9.ucm:1.1->1.2 
	cpan/Encode/ucm/adobeStdenc.ucm:1.1->1.2 
	cpan/Encode/ucm/adobeSymbol.ucm:1.1->1.2 
	cpan/Encode/ucm/adobeZdingbat.ucm:1.1->1.2 
	cpan/Encode/ucm/ascii.ucm:1.1->1.2 
	cpan/Encode/ucm/big5-eten.ucm:1.1->1.2 
	cpan/Encode/ucm/big5-hkscs.ucm:1.1->1.2 
	cpan/Encode/ucm/cp037.ucm:1.1->1.2 
	cpan/Encode/ucm/cp1006.ucm:1.1->1.2 
	cpan/Encode/ucm/cp1026.ucm:1.1->1.2 
	cpan/Encode/ucm/cp1047.ucm:1.1->1.2 
	cpan/Encode/ucm/cp1250.ucm:1.1->1.2 
	cpan/Encode/ucm/cp1251.ucm:1.1->1.2 
	cpan/Encode/ucm/cp1252.ucm:1.1->1.2 
	cpan/Encode/ucm/cp1253.ucm:1.1->1.2 
	cpan/Encode/ucm/cp1254.ucm:1.1->1.2 
	cpan/Encode/ucm/cp1255.ucm:1.1->1.2 
	cpan/Encode/ucm/cp1256.ucm:1.1->1.2 
	cpan/Encode/ucm/cp1257.ucm:1.1->1.2 
	cpan/Encode/ucm/cp1258.ucm:1.1->1.2 
	cpan/Encode/ucm/cp424.ucm:1.1->1.2 
	cpan/Encode/ucm/cp437.ucm:1.1->1.2 
	cpan/Encode/ucm/cp500.ucm:1.1->1.2 
	cpan/Encode/ucm/cp737.ucm:1.1->1.2 
	cpan/Encode/ucm/cp775.ucm:1.1->1.2 
	cpan/Encode/ucm/cp850.ucm:1.1->1.2 
	cpan/Encode/ucm/cp852.ucm:1.1->1.2 
	cpan/Encode/ucm/cp855.ucm:1.1->1.2 
	cpan/Encode/ucm/cp856.ucm:1.1->1.2 
	cpan/Encode/ucm/cp857.ucm:1.1->1.2 
	cpan/Encode/ucm/cp858.ucm:1.1->1.2 
	cpan/Encode/ucm/cp860.ucm:1.1->1.2 
	cpan/Encode/ucm/cp861.ucm:1.1->1.2 
	cpan/Encode/ucm/cp862.ucm:1.1->1.2 
	cpan/Encode/ucm/cp863.ucm:1.1->1.2 
	cpan/Encode/ucm/cp864.ucm:1.1->1.2 
	cpan/Encode/ucm/cp865.ucm:1.1->1.2 
	cpan/Encode/ucm/cp866.ucm:1.1->1.2 
	cpan/Encode/ucm/cp869.ucm:1.1->1.2 
	cpan/Encode/ucm/cp874.ucm:1.1->1.2 
	cpan/Encode/ucm/cp875.ucm:1.1->1.2 
	cpan/Encode/ucm/cp932.ucm:1.1->1.2 
	cpan/Encode/ucm/cp936.ucm:1.1->1.2 
	cpan/Encode/ucm/cp949.ucm:1.1->1.2 
	cpan/Encode/ucm/cp950.ucm:1.1->1.2 
	cpan/Encode/ucm/ctrl.ucm:1.1->1.2 
	cpan/Encode/ucm/dingbats.ucm:1.1->1.2 
	cpan/Encode/ucm/euc-cn.ucm:1.1->1.2 
	cpan/Encode/ucm/euc-jp.ucm:1.1->1.2 
	cpan/Encode/ucm/euc-kr.ucm:1.1->1.2 
	cpan/Encode/ucm/gb12345.ucm:1.1->1.2 
	cpan/Encode/ucm/gb2312.ucm:1.1->1.2 
	cpan/Encode/ucm/hp-roman8.ucm:1.1->1.2 
	cpan/Encode/ucm/ir-165.ucm:1.1->1.2 
	cpan/Encode/ucm/jis0201.ucm:1.1->1.2 
	cpan/Encode/ucm/jis0208.ucm:1.1->1.2 
	cpan/Encode/ucm/jis0212.ucm:1.1->1.2 
	cpan/Encode/ucm/johab.ucm:1.1->1.2 
	cpan/Encode/ucm/koi8-f.ucm:1.1->1.2 
	cpan/Encode/ucm/koi8-r.ucm:1.1->1.2 
	cpan/Encode/ucm/koi8-u.ucm:1.1->1.2 
	cpan/Encode/ucm/ksc5601.ucm:1.1->1.2 
	cpan/Encode/ucm/macArabic.ucm:1.1->1.2 
	cpan/Encode/ucm/macCentEuro.ucm:1.1->1.2 
	cpan/Encode/ucm/macChinsimp.ucm:1.1->1.2 
	cpan/Encode/ucm/macChintrad.ucm:1.1->1.2 
	cpan/Encode/ucm/macCroatian.ucm:1.1->1.2 
	cpan/Encode/ucm/macCyrillic.ucm:1.1->1.2 
	cpan/Encode/ucm/macDingbats.ucm:1.1->1.2 
	cpan/Encode/ucm/macFarsi.ucm:1.1->1.2 
	cpan/Encode/ucm/macGreek.ucm:1.1->1.2 
	cpan/Encode/ucm/macHebrew.ucm:1.1->1.2 
	cpan/Encode/ucm/macIceland.ucm:1.1->1.2 
	cpan/Encode/ucm/macJapanese.ucm:1.1->1.2 
	cpan/Encode/ucm/macKorean.ucm:1.1->1.2 
	cpan/Encode/ucm/macROMnn.ucm:1.1->1.2 
	cpan/Encode/ucm/macRUMnn.ucm:1.1->1.2 
	cpan/Encode/ucm/macRoman.ucm:1.1->1.2 
	cpan/Encode/ucm/macSami.ucm:1.1->1.2 
	cpan/Encode/ucm/macSymbol.ucm:1.1->1.2 
	cpan/Encode/ucm/macThai.ucm:1.1->1.2 
	cpan/Encode/ucm/macTurkish.ucm:1.1->1.2 
	cpan/Encode/ucm/macUkraine.ucm:1.1->1.2 
	cpan/Encode/ucm/nextstep.ucm:1.1->1.2 
	cpan/Encode/ucm/null.ucm:1.1->1.2 
	cpan/Encode/ucm/posix-bc.ucm:1.1->1.2 
	cpan/Encode/ucm/shiftjis.ucm:1.1->1.2 
	cpan/Encode/ucm/symbol.ucm:1.1->1.2 
	cpan/Encode/ucm/viscii.ucm:1.1->1.2 
	cpan/ExtUtils-MakeMaker/Changes:1.1->1.2 
	cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_Any.pm:1.1->1.2 
	cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_Unix.pm:1.1->1.2 
	cpan/ExtUtils-MakeMaker/lib/ExtUtils/MakeMaker.pm:1.1->1.2 
	cpan/ExtUtils-MakeMaker/lib/ExtUtils/MakeMaker/FAQ.pod:1.1->1.2 
	cpan/ExtUtils-MakeMaker/t/parse_version.t:1.1->1.2 
	cpan/Getopt-Long/lib/Getopt/Long.pm:1.1->1.2 
	cpan/IO-Compress/private/MakeUtil.pm:1.1->1.2 
	cpan/IPC-SysV/Makefile.PL:1.1->1.2 
	cpan/IPC-SysV/SysV.xs:1.1->1.2 
	cpan/IPC-SysV/lib/IPC/Msg.pm:1.1->1.2 
	cpan/IPC-SysV/lib/IPC/Semaphore.pm:1.1->1.2 
	cpan/IPC-SysV/lib/IPC/SharedMem.pm:1.1->1.2 
	cpan/IPC-SysV/lib/IPC/SysV.pm:1.1->1.2 
	cpan/IPC-SysV/t/ipcsysv.t:1.1->1.2 
	cpan/IPC-SysV/t/msg.t:1.1->1.2 
	cpan/IPC-SysV/t/pod.t:1.1->1.2 
	cpan/IPC-SysV/t/podcov.t:1.1->1.2 
	cpan/IPC-SysV/t/sem.t:1.1->1.2 
	cpan/IPC-SysV/t/shm.t:1.1->1.2 
	cpan/Locale-Codes/lib/Locale/Constants.pm:1.1->1.2 
	cpan/Locale-Codes/lib/Locale/Country.pm:1.1->1.2 
	cpan/Locale-Codes/lib/Locale/Currency.pm:1.1->1.2 
	cpan/Locale-Codes/lib/Locale/Language.pm:1.1->1.2 
	cpan/Locale-Codes/lib/Locale/Script.pm:1.1->1.2 
	cpan/MIME-Base64/Base64.xs:1.1->1.2 
	cpan/Memoize/Memoize.pm:1.1->1.2 
	cpan/Memoize/TODO:1.1->1.2 
	cpan/Module-Build/lib/Module/Build/ModuleInfo.pm:1.1->1.2 
	cpan/Module-Build/t/metadata.t:1.1->1.2 
	cpan/Module-Build/t/moduleinfo.t:1.1->1.2 
	cpan/Module-Build/t/bundled/Tie/CPHash.pm:1.1->1.2 
	cpan/Module-Load-Conditional/t/02_Parse_Version.t:1.1->1.2 
	cpan/NEXT/lib/NEXT.pm:1.1->1.2 
	cpan/Pod-LaTeX/LaTeX.pm:1.1->1.2 
	cpan/Pod-Parser/lib/Pod/Checker.pm:1.1->1.2 
	cpan/Pod-Parser/lib/Pod/PlainText.pm:1.1->1.2 
	cpan/Pod-Parser/lib/Pod/Select.pm:1.1->1.2 
	cpan/Pod-Parser/lib/Pod/Usage.pm:1.1->1.2 
	cpan/Pod-Parser/t/pod/contains_pod.t:1.1->1.2 
	cpan/Pod-Simple/lib/Pod/Simple/Search.pm:1.1->1.2 
	cpan/Pod-Simple/t/perlfaq.pod:1.1->1.2 
	cpan/Pod-Simple/t/perlfaqo.txt:1.1->1.2 
	cpan/Term-UI/lib/Term/UI/History.pm:1.1->1.2 
	cpan/Test-Harness/lib/TAP/Formatter/Console/ParallelSession.pm:1.1->1.2 
	cpan/Text-Balanced/lib/Text/Balanced.pm:1.1->1.2 
	cpan/Text-Soundex/t/Soundex.t:1.1->1.2 
	cpan/Time-Piece/Piece.pm:1.1->1.2 
	cpan/Time-Piece/Seconds.pm:1.1->1.2 
	cpan/encoding-warnings/t/1-warning.t:1.1->1.2 
	cpan/encoding-warnings/t/2-fatal.t:1.1->1.2 
	cpan/libnet/Net/libnetFAQ.pod:1.1->1.2 
	cpan/podlators/lib/Pod/Man.pm:1.1->1.2 
	cpan/podlators/lib/Pod/Text.pm:1.1->1.2 
	dist/Net-Ping/lib/Net/Ping.pm:1.1->1.2 
	dist/Pod-Perldoc/lib/Pod/Perldoc.pm:1.1->1.2 
	dist/Pod-Plainer/Plainer.pm:1.1->1.2 
	dist/Pod-Plainer/t/plainer.t:1.1->1.2 
	emacs/cperl-mode.el:1.9->1.10 
	ext/B/B/Concise.pm:1.8->1.9 
	ext/DynaLoader/Makefile.PL:1.7->1.8 
	ext/DynaLoader/dl_beos.xs:1.8->1.9 
	ext/DynaLoader/dl_dld.xs:1.9->1.10 
	ext/DynaLoader/dl_mac.xs:1.6->1.7 
	ext/DynaLoader/dlutils.c:1.8->1.9 
	ext/File-Glob/bsd_glob.c:1.2->1.3 
	ext/GDBM_File/GDBM_File.pm:1.9->1.10 
	ext/GDBM_File/t/gdbm.t:1.4->1.5 
	ext/IPC-Open3/lib/IPC/Open3.pm:1.1->1.2 
	ext/NDBM_File/t/ndbm.t:1.4->1.5 
	ext/ODBM_File/t/odbm.t:1.4->1.5 
	ext/Opcode/Opcode.pm:1.7->1.8 
	ext/Opcode/Opcode.xs:1.9->1.10 
	ext/POSIX/POSIX.pm:1.12->1.13 
	ext/POSIX/POSIX.pod:1.12->1.13 
	ext/POSIX/POSIX.xs:1.14->1.15 
	ext/PerlIO-encoding/encoding.xs:1.3->1.4 
	ext/SDBM_File/sdbm/readme.ms:1.9->1.10 
	ext/SDBM_File/sdbm/sdbm.3:1.9->1.10 
	ext/SDBM_File/t/sdbm.t:1.4->1.5 
	ext/Socket/Socket.pm:1.11->1.12 
	ext/Socket/Socket.xs:1.11->1.12 
	ext/re/t/regop.t:1.2->1.3 
	hints/aix.sh:1.12->1.13 
	hints/beos.sh:1.9->1.10 
	hints/bsdos.sh:1.7->1.8 
	hints/dgux.sh:1.9->1.10 
	hints/freebsd.sh:1.10->1.11 
	hints/haiku.sh:1.2->1.3 
	hints/hpux.sh:1.11->1.12 
	hints/irix_6.sh:1.10->1.11 
	hints/linux.sh:1.12->1.13 
	hints/os2.sh:1.8->1.9 
	hints/qnx.sh:1.6->1.7 
	lib/Carp.pm:1.10->1.11 
	lib/Env.pm:1.5->1.6 
	lib/Exporter.pm:1.9->1.10 
	lib/UNIVERSAL.pm:1.6->1.7 
	lib/abbrev.pl:1.3->1.4 
	lib/bigfloat.pl:1.3->1.4 
	lib/bigint.pl:1.6->1.7 
	lib/cacheout.pl:1.3->1.4 
	lib/complete.pl:1.3->1.4 
	lib/ctime.pl:1.9->1.10 
	lib/diagnostics.pm:1.12->1.13 
	lib/dotsh.pl:1.4->1.5 
	lib/find.pl:1.2->1.3 
	lib/finddepth.pl:1.2->1.3 
	lib/getcwd.pl:1.3->1.4 
	lib/getopt.pl:1.9->1.10 
	lib/getopts.pl:1.5->1.6 
	lib/importenv.pl:1.8->1.9 
	lib/look.pl:1.3->1.4 
	lib/newgetopt.pl:1.9->1.10 
	lib/open2.pl:1.2->1.3 
	lib/open3.pl:1.2->1.3 
	lib/overload.pm:1.11->1.12 
	lib/perl5db.pl:1.14->1.15 
	lib/pwd.pl:1.9->1.10 
	lib/stat.pl:1.8->1.9 
	lib/syslog.pl:1.9->1.10 
	lib/termcap.pl:1.9->1.10 
	lib/timelocal.pl:1.2->1.3 
	lib/ExtUtils/Embed.pm:1.9->1.10 
	lib/ExtUtils/typemap:1.8->1.9 
	lib/File/Basename.pm:1.11->1.12 
	lib/File/Copy.pm:1.12->1.13 
	lib/File/Find.pm:1.12->1.13 
	lib/File/stat.pm:1.4->1.5 
	lib/Pod/Functions.pm:1.7->1.8 
	lib/Pod/Html.pm:1.10->1.11 
	lib/Search/Dict.pm:1.3->1.4 
	lib/Term/ReadLine.pm:1.10->1.11 
	lib/Tie/Scalar.pm:1.7->1.8 
	lib/version/Internals.pod:1.2->1.3 
	os2/Makefile.SHs:1.10->1.11 
	plan9/config.plan9:1.11->1.12 
	plan9/config_h.sample:1.6->1.7 
	plan9/mkfile:1.4->1.5 
	pod/buildtoc:1.12->1.13 
	pod/perl.pod:1.13->1.14 
	pod/perl58delta.pod:1.6->1.7 
	pod/perlcall.pod:1.9->1.10 
	pod/perldata.pod:1.11->1.12 
	pod/perldebug.pod:1.12->1.13 
	pod/perldiag.pod:1.13->1.14 
	pod/perldsc.pod:1.8->1.9 
	pod/perlembed.pod:1.11->1.12 
	pod/perlfaq.pod:1.10->1.11 
	pod/perlfaq1.pod:1.11->1.12 
	pod/perlfaq2.pod:1.11->1.12 
	pod/perlfaq3.pod:1.11->1.12 
	pod/perlfaq4.pod:1.11->1.12 
	pod/perlfaq5.pod:1.11->1.12 
	pod/perlfaq6.pod:1.10->1.11 
	pod/perlfaq7.pod:1.10->1.11 
	pod/perlfaq8.pod:1.11->1.12 
	pod/perlfaq9.pod:1.10->1.11 
	pod/perlfunc.pod:1.14->1.15 
	pod/perlguts.pod:1.13->1.14 
	pod/perlhist.pod:1.12->1.13 
	pod/perlipc.pod:1.12->1.13 
	pod/perllocale.pod:1.7->1.8 
	pod/perllol.pod:1.7->1.8 
	pod/perlmod.pod:1.12->1.13 
	pod/perlmodinstall.pod:1.6->1.7 
	pod/perlobj.pod:1.11->1.12 
	pod/perlop.pod:1.15->1.16 
	pod/perlpod.pod:1.10->1.11 
	pod/perlre.pod:1.14->1.15 
	pod/perlrun.pod:1.13->1.14 
	pod/perlsec.pod:1.12->1.13 
	pod/perlsub.pod:1.13->1.14 
	pod/perlsyn.pod:1.10->1.11 
	pod/perlthrtut.pod:1.8->1.9 
	pod/perltie.pod:1.13->1.14 
	pod/perltoot.pod:1.9->1.10 
	pod/perlvar.pod:1.11->1.12 
	pod/perlxs.pod:1.11->1.12 
	pod/perlxstut.pod:1.13->1.14 
	pod/pod2man.PL:1.10->1.11 
	pod/roffitall:1.6->1.7 
	qnx/ar:1.1->1.2 
	t/TEST:1.12->1.13 
	t/harness:1.10->1.11 
	t/base/lex.t:1.9->1.10 
	t/base/term.t:1.8->1.9 
	t/cmd/switch.t:1.8->1.9 
	t/comp/colon.t:1.3->1.4 
	t/comp/decl.t:1.8->1.9 
	t/comp/multiline.t:1.8->1.9 
	t/comp/package.t:1.5->1.6 
	t/comp/proto.t:1.7->1.8 
	t/comp/require.t:1.2->1.3 
	t/comp/use.t:1.7->1.8 
	t/io/dup.t:1.10->1.11 
	t/io/fs.t:1.10->1.11 
	t/io/inplace.t:1.9->1.10 
	t/io/open.t:1.10->1.11 
	t/io/pipe.t:1.8->1.9 
	t/io/tell.t:1.10->1.11 
	t/lib/warnings/sv:1.3->1.4 
	t/op/array.t:1.10->1.11 
	t/op/assignwarn.t:1.4->1.5 
	t/op/auto.t:1.8->1.9 
	t/op/chop.t:1.10->1.11 
	t/op/do.t:1.8->1.9 
	t/op/each.t:1.6->1.7 
	t/op/eval.t:1.8->1.9 
	t/op/exec.t:1.7->1.8 
	t/op/flip.t:1.8->1.9 
	t/op/fork.t:1.9->1.10 
	t/op/glob.t:1.7->1.8 
	t/op/goto.t:1.11->1.12 
	t/op/groups.t:1.8->1.9 
	t/op/gv.t:1.9->1.10 
	t/op/inc.t:1.7->1.8 
	t/op/index.t:1.10->1.11 
	t/op/list.t:1.7->1.8 
	t/op/local.t:1.9->1.10 
	t/op/magic.t:1.11->1.12 
	t/op/method.t:1.7->1.8 
	t/op/mkdir.t:1.9->1.10 
	t/op/pack.t:1.10->1.11 
	t/op/push.t:1.8->1.9 
	t/op/range.t:1.10->1.11 
	t/op/readdir.t:1.9->1.10 
	t/op/recurse.t:1.4->1.5 
	t/op/ref.t:1.11->1.12 
	t/op/runlevel.t:1.9->1.10 
	t/op/sort.t:1.11->1.12 
	t/op/split.t:1.11->1.12 
	t/op/sprintf.t:1.11->1.12 
	t/op/sprintf2.t:1.4->1.5 
	t/op/stat.t:1.11->1.12 
	t/op/study.t:1.7->1.8 
	t/op/sysio.t:1.6->1.7 
	t/op/taint.t:1.12->1.13 
	t/op/tie.t:1.10->1.11 
	t/op/time.t:1.10->1.11 
	t/op/undef.t:1.7->1.8 
	t/op/universal.t:1.10->1.11 
	t/op/unshift.t:1.8->1.9 
	t/op/vec.t:1.9->1.10 
	t/op/write.t:1.11->1.12 
	t/uni/tr_7jis.t:1.6->1.7 
	t/uni/tr_eucjp.t:1.5->1.6 
	t/uni/tr_sjis.t:1.6->1.7 
	t/uni/tr_utf8.t:1.6->1.7 
	utils/Makefile:1.11->1.12 
	utils/c2ph.PL:1.11->1.12 
	utils/h2ph.PL:1.18->1.19 
	utils/h2xs.PL:1.12->1.13 
	utils/perlbug.PL:1.12->1.13 
	vms/vms.c:1.12->1.13 
	win32/Makefile:1.12->1.13 
	win32/config.bc:1.11->1.12 
	win32/config.vc:1.11->1.12 
	win32/config_H.bc:1.12->1.13 
	win32/config_H.gc:1.12->1.13 
	win32/config_H.gc64:1.1->1.2 
	win32/config_H.gc64nox:1.1->1.2 
	win32/config_H.vc:1.12->1.13 
	win32/config_h.PL:1.5->1.6 
	win32/config_sh.PL:1.8->1.9 
	win32/makefile.mk:1.12->1.13 
	win32/pod.mak:1.11->1.12 
	win32/win32.c:1.12->1.13 
	win32/win32.h:1.8->1.9 
	win32/win32iop.h:1.8->1.9 
	win32/win32sck.c:1.11->1.12 
	win32/bin/pl2bat.pl:1.5->1.6 
	win32/bin/search.pl:1.4->1.5 
	x2p/Makefile.SH:1.12->1.13 
	x2p/a2p.c:1.11->1.12 
	x2p/a2p.h:1.10->1.11 
	x2p/a2p.pod:1.4->1.5 
	x2p/a2p.y:1.10->1.11 
	x2p/a2py.c:1.9->1.10 
	x2p/walk.c:1.10->1.11 

Index: src/gnu/usr.bin/perl/Changes
diff -u src/gnu/usr.bin/perl/Changes:1.14 src/gnu/usr.bin/perl/Changes:1.15
--- Changes:1.14	Mon Oct 12 18:24:18 2009
+++ Changes	Fri Sep 24 15:06:37 2010
@@ -16,13 +16,6 @@
 
 to view all the changes between 5.10.0 and 5.11.0.
 
-Specifically, the changes for this release, (i.e. between 5.10.0 and
-5.10.1), is shown with with following command. Note that the range
-specification is slightly unusual for this release due to some kinks while
-migrating to git.
-
-    git log --name-status perl-5.10.0^..perl-5.10.1 ^f7c6915850
-
 See pod/perlrepository.pod for more details on using git and accessing the
 commit history.
 
Index: src/gnu/usr.bin/perl/Configure
diff -u src/gnu/usr.bin/perl/Configure:1.22 src/gnu/usr.bin/perl/Configure:1.23
--- Configure:1.22	Mon Jan  4 15:53:31 2010
+++ Configure	Fri Sep 24 15:06:38 2010
@@ -16,16 +16,21 @@
 # The dist package (which contains metaconfig) is available via SVN:
 #     svn co https://svn.sourceforge.net/svnroot/dist/trunk/dist
 #
+# Though this script was generated by metaconfig from metaunits, it is
+# OK to send patches against Configure itself. It's up to the Configure
+# pumpkin to backport the patch to the metaunits if it is accepted.
+# For more information on patching Configure, see pod/perlhack.pod
+#
+# The metaunits are also available from the public git repository:
+#     http://perl5.git.perl.org/metaconfig.git/ or
+#     $ git clone git://perl5.git.perl.org/metaconfig.git metaconfig
 #
-# Though this script was generated by metaconfig, it is OK to send
-# patches against it. It's up to the Configure pumpkin to backport
-# the patch to the metaunits if it is accepted.
 # See Porting/pumpkin.pod for more information on metaconfig.
 #
 
-# $Id: Configure,v 1.21 2009/10/14 19:08:07 millert Exp $
+# $Id: Head.U 6 2006-08-25 22:21:46Z rmanfredi $
 #
-# Generated on Tue Aug 18 19:22:01 CEST 2009 [metaconfig 3.5 PL0]
+# Generated on Wed Jun 23 16:03:55 CEST 2010 [metaconfig 3.5 PL0]
 # (with additional metaconfig patches by perlbug@perl.org)
 
 cat >c1$$ <<EOF
@@ -53,7 +58,7 @@
 rm -f c1$$ c2$$
 
 if test -f /dev/cputype -a -f /dev/drivers -a -f /dev/osversion; then
-	cat >&4 <<EOF
+	cat <<EOF
 ***
 *** I'm sorry but this system looks like Plan 9 and Plan 9 doesn't do
 *** Configure that well.  (Plan 9 is close to UNIX but not close enough.)
@@ -65,7 +70,7 @@
 fi
 
 if test ! -c /dev/null ; then
-	cat >&4 <<EOF
+	cat <<EOF
 ***
 *** I'm sorry, but /dev/null appears to be a file rather than a device.
 *** Please consult your operating sytem's notes for making a device
@@ -348,6 +353,8 @@
 cf_email=''
 cf_by=''
 cf_time=''
+charbits=''
+charsize=''
 contains=''
 cpp_stuff=''
 cpplast=''
@@ -824,6 +831,7 @@
 d_wctomb=''
 d_writev=''
 dlext=''
+bin_ELF=''
 cccdlflags=''
 ccdlflags=''
 dlsrc=''
@@ -1224,6 +1232,7 @@
 incpath=''
 mips_type=''
 usrinc=''
+vaproto=''
 d_vendorarch=''
 installvendorarch=''
 vendorarch=''
@@ -2436,6 +2445,15 @@
 	_egrep=$grep
 	;;
 esac
+case "$less" in
+'')	;;
+*)	if $less -R </dev/null >/dev/null; then
+	       echo "Substituting less -R for less."
+	       less="$less -R"
+	       _less=$less
+	fi
+	;;
+esac
 case "$ln" in
 ln)
 	echo "Substituting cp for ln."
@@ -7153,6 +7171,8 @@
 
 : DTrace support
 dflt_dtrace='/usr/sbin/dtrace'
+$test -x /usr/bin/dtrace && dflt_dtrace='/usr/bin/dtrace'
+
 cat <<EOM
 
 Perl can be built to support DTrace on platforms that support it.
@@ -7945,6 +7965,7 @@
 rp="Do you wish to use dynamic loading?"
 . ./myread
 usedl="$ans"
+bin_ELF="$undef"
 case "$ans" in
 y*) usedl="$define"
 	case "$dlsrc" in
@@ -8041,6 +8062,7 @@
 You appear to have ELF support.  I'll use $cc to build dynamic libraries.
 EOM
 			dflt="$cc"
+			bin_ELF="$define"
 		else
 			echo "I'll use ld to build dynamic libraries."
 			dflt='ld'
@@ -8209,6 +8231,13 @@
 
 case "$useshrplib" in
 true)
+	case "$userelocatableinc" in
+	true|define)
+		echo "Cannot build with both -Duserelocatableinc and -Duseshrplib" >&4
+		echo "See INSTALL for an explanation why that won't work." >&4
+		exit 4
+		;;
+	esac
 	case "$libperl" in
 	'')
 		# Figure out a good name for libperl.so.  Since it gets stored in
@@ -11019,7 +11048,7 @@
 	signal(SIGFPE, blech);
 
 	/* Don't let compiler optimize the test away.  Store the number
-	   in a writable string for gcc to pass to sscanf under HP/UX.
+	   in a writable string for gcc to pass to sscanf under HP-UX.
 	*/
 	sprintf(str, "2147483647");
 	sscanf(str, "%lf", &f); /* f = (double) 0x7fffffff; */
@@ -11086,7 +11115,7 @@
 	   optimized the whole file away
 	*/
 	/* Store the number in a writable string for gcc to pass to
-	   sscanf under HP/UX.
+	   sscanf under HP-UX.
 	*/
 	sprintf(str, "-123");
 	sscanf(str, "%lf", &f);  /* f = -123.; */
@@ -18568,8 +18597,8 @@
 #endif
 int main() {
 #if BYTEORDER == 0x1234 || BYTEORDER == 0x4321
-    U8 buf[8];
-    U32 *up;
+    volatile U8 buf[8];
+    volatile U32 *up;
     int i;
 
     if (sizeof(U32) != 4) {
@@ -18825,6 +18854,86 @@
 : set the base revision
 baserev=5.0
 
+: check for length of character
+echo " "
+case "$charsize" in
+'')
+	echo "Checking to see how big your characters are (hey, you never know)..." >&4
+	$cat >try.c <<EOCP
+#include <stdio.h>
+#$i_stdlib I_STDLIB
+#ifdef I_STDLIB
+#include <stdlib.h>
+#endif
+int main()
+{
+    printf("%d\n", (int)sizeof(char));
+    exit(0);
+}
+EOCP
+	set try
+	if eval $compile_ok; then
+		dflt=`$run ./try`
+	else
+		dflt='1'
+		echo "(I can't seem to compile the test program.  Guessing...)"
+	fi
+	;;
+*)
+	dflt="$charsize"
+	;;
+esac
+rp="What is the size of a character (in bytes)?"
+. ./myread
+charsize="$ans"
+$rm_try
+
+: Check for the number of bits in a character
+case "$charbits" in
+'')	echo "Checking how long a character is (in bits)..." >&4
+	$cat >try.c <<EOCP
+#include <stdio.h>
+int main ()
+{
+    int n;
+    unsigned char c;
+    for (c = 1, n = 0; c; c <<= 1, n++) ;
+    printf ("%d\n", n);
+    return (0);
+    }
+EOCP
+	set try
+	if eval $compile_ok; then
+		dflt=`$run ./try`
+	else
+		dflt='8'
+		echo "(I can't seem to compile the test program.  Guessing...)"
+	fi
+	;;
+*)
+	dflt="$charbits"
+	;;
+esac
+rp="What is the length of a character (in bits)?"
+. ./myread
+charbits="$ans"
+$rm_try
+case "$charbits" in
+8)	;;
+*)	cat >&4 << EOM
+Your system has an unsigned character size of $charbits bits, which
+is rather unusual (normally it is 8 bits).  Perl likely will not work
+correctly on your system, with subtle bugs in various places.
+EOM
+	rp='Do you really want to continue?'
+	dflt='n'
+	. ./myread
+	case "$ans" in
+		[yY])	echo >&4 "Okay, continuing."	;;
+		*)	exit 1				;;
+	esac
+esac
+
 : how do we concatenate cpp tokens here?
 echo " "
 echo "Checking to see how your cpp does stuff like concatenate tokens..." >&4
@@ -21132,6 +21241,21 @@
 	;;
     esac
 
+: see if prototypes support variable argument declarations
+echo " "
+case "$prototype$i_stdarg" in
+$define$define)
+	echo "It appears we'll be able to prototype varargs functions." >&4
+	val="$define"
+	;;
+*)
+	echo "Too bad... We won't be using prototyped varargs functions..." >&4
+	val="$undef"
+	;;
+esac
+set vaproto
+eval $setvar
+
 : determine compiler compiler
 case "$yacc" in
 '')
@@ -21394,11 +21518,11 @@
 ./Cppsym < Cppsym.know > Cppsym.true
 : Add in any linux cpp "predefined macros":
 case "$osname::$gccversion" in
-  *linux*::*.*)
+  *linux*::*.*|*gnukfreebsd*::*.*|gnu::*.*)
     tHdrH=_tmpHdr
     rm -f $tHdrH'.h' $tHdrH
     touch $tHdrH'.h'
-    if cpp -dM $tHdrH'.h' > $tHdrH'_cppsym.h' && [ -s $tHdrH'_cppsym.h' ]; then
+    if $cpp -dM $tHdrH'.h' > $tHdrH'_cppsym.h' && [ -s $tHdrH'_cppsym.h' ]; then
        sed 's/#define[\ \  ]*//;s/[\ \     ].*$//' <$tHdrH'_cppsym.h' >$tHdrH'_cppsym.real'
        if [ -s $tHdrH'_cppsym.real' ]; then
 	  cat $tHdrH'_cppsym.real' Cppsym.know | sort | uniq | ./Cppsym | sort | uniq > Cppsym.true
@@ -21654,6 +21778,8 @@
 
 : Function to recursively find available extensions, ignoring DynaLoader
 : NOTE: recursion limit of 10 to prevent runaway in case of symlink madness
+: In 5.10.1 and later, extensions are stored in directories
+: like File-Glob instead of the older File/Glob/.
 find_extensions='
     for xxx in *; do
 	case "$xxx" in
@@ -21661,17 +21787,7 @@
 	    *)
 	    this_ext=`echo $xxx | $sed -e s/-/\\\//g`;
 	    leaf=`echo $xxx | $sed -e s/.*-//`;
-	    if $test -d File-Glob; then
-		$ls -1 $xxx > $$.tmp;
-		if   $contains "\.xs$" $$.tmp > /dev/null 2>&1; then
-		    known_extensions="$known_extensions $this_ext";
-		elif $contains "\.c$"  $$.tmp > /dev/null 2>&1; then
-		    known_extensions="$known_extensions $this_ext";
-		elif $test -d $xxx; then
-		    nonxs_extensions="$nonxs_extensions $this_ext";
-		fi;
-		$rm -f $$.tmp;
-	    else
+	    if $test -d File; then
 		if $test -f $xxx/$leaf.xs -o -f $xxx/$leaf.c; then
 		    known_extensions="$known_extensions $1$this_ext";
 		elif $test -f $xxx/Makefile.PL; then
@@ -21685,11 +21801,29 @@
 			shift;
 		    fi;
 		fi;
+	    else
+		$ls -1 $xxx > $$.tmp;
+		if   $contains "\.xs$" $$.tmp > /dev/null 2>&1; then
+		    known_extensions="$known_extensions $this_ext";
+		elif $contains "\.c$"  $$.tmp > /dev/null 2>&1; then
+		    known_extensions="$known_extensions $this_ext";
+		elif $test -d $xxx; then
+		    nonxs_extensions="$nonxs_extensions $this_ext";
+		fi;
+		$rm -f $$.tmp;
 	    fi
 	    ;;
 	esac;
     done'
 tdir=`pwd`
+cd "$rsrc/cpan"
+set X
+shift
+eval $find_extensions
+cd "$rsrc/dist"
+set X
+shift
+eval $find_extensions
 cd "$rsrc/ext"
 set X
 shift
@@ -21706,10 +21840,10 @@
 fi
 set X $known_extensions
 shift
-known_extensions="$*"
+known_extensions=`echo "$*" | tr ' ' $trnl | $sort | tr $trnl ' '`
 set X $nonxs_extensions
 shift
-nonxs_extensions="$*"
+nonxs_extensions=`echo "$*" | tr ' ' $trnl | $sort | tr $trnl ' '`
 cd "$tdir"
 
 : Now see which are supported on this system.
@@ -21831,6 +21965,13 @@
 		$define) avail_ext="$avail_ext $xxx" ;;
 		esac
 		;;
+	XS/APItest/KeywordRPN|xs/apitest/keywordrpn)
+		# This is just for testing.  Skip it unless we have dynamic loading.
+
+		case "$usedl" in
+		$define) avail_ext="$avail_ext $xxx" ;;
+		esac
+		;;
 	XS/Typemap|xs/typemap)
 		# This is just for testing.  Skip it unless we have dynamic loading.
 		case "$usedl" in
@@ -22181,6 +22322,7 @@
 baserev='$baserev'
 bash='$bash'
 bin='$bin'
+bin_ELF='$bin_ELF'
 binexp='$binexp'
 bison='$bison'
 byacc='$byacc'
@@ -22199,6 +22341,8 @@
 cf_by='$cf_by'
 cf_email='$cf_email'
 cf_time='$cf_time'
+charbits='$charbits'
+charsize='$charsize'
 chgrp='$chgrp'
 chmod='$chmod'
 chown='$chown'
@@ -23183,6 +23327,7 @@
 uvtype='$uvtype'
 uvuformat='$uvuformat'
 uvxformat='$uvxformat'
+vaproto='$vaproto'
 vendorarch='$vendorarch'
 vendorarchexp='$vendorarchexp'
 vendorbin='$vendorbin'
Index: src/gnu/usr.bin/perl/DynaLoader.sed
diff -u src/gnu/usr.bin/perl/DynaLoader.sed:1.1 src/gnu/usr.bin/perl/DynaLoader.sed:1.2
--- DynaLoader.sed:1.1	Mon Sep 29 17:35:56 2008
+++ DynaLoader.sed	Fri Sep 24 15:06:38 2010
@@ -1,6 +1,6 @@
 s@"dlutils.c"@"ext/DynaLoader/dlutils.c"@
 /^#ifndef RTLD_LAZY/{N;N;c\
-#define VERSION "1.08"\
-#define XS_VERSION "1.08"\
+#define VERSION "1.10"\
+#define XS_VERSION "1.10"\
 #define DLOPEN_WONT_DO_RELATIVE_PATHS
 }
Index: src/gnu/usr.bin/perl/INSTALL
diff -u src/gnu/usr.bin/perl/INSTALL:1.12 src/gnu/usr.bin/perl/INSTALL:1.13
--- INSTALL:1.12	Mon Oct 12 18:24:20 2009
+++ INSTALL	Fri Sep 24 15:06:38 2010
@@ -36,13 +36,18 @@
 To explicitly name the perl binary, use the command
 "make install PERLNAME=myperl".
 
+Building perl from source requires an ANSI compliant C-Compiler.
+A minimum of C89 is required. Some features available in C99 will
+be probed for and used when found. The perl build process does not
+rely on anything more than C89.
+
 These options, and many more, are explained in further detail below.
 
 If you have problems, corrections, or questions, please see
 L<"Reporting Problems"> below.
 
 For information on what's new in this release, see the
-pod/perl5101delta.pod file.  For more information about how to find more
+pod/perl5122delta.pod file.  For more information about how to find more
 specific detail about changes, see the Changes file.
 
 =head1 DESCRIPTION
@@ -75,13 +80,12 @@
 
 =head2 Changes and Incompatibilities
 
-Please see pod/perl5101delta.pod for a description of the changes and
+Please see pod/perl5122delta.pod for a description of the changes and
 potential incompatibilities introduced with this release.  A few of
 the most important issues are listed below, but you should refer
-to pod/perl5101delta.pod for more detailed information.
+to pod/perl5122delta.pod for more detailed information.
 
-B<WARNING:> This version is not binary compatible with releases of
-Perl prior to 5.10.0.
+B<WARNING:> This version is not binary compatible with prior releases of Perl.
 If you have built extensions (i.e. modules that include C code)
 using an earlier version of Perl, you will need to rebuild and reinstall
 those extensions.
@@ -94,7 +98,7 @@
 
 On a related issue, old modules may possibly be affected by the changes
 in the Perl language in the current release.  Please see
-pod/perl5101delta.pod for a description of what's changed.  See your
+pod/perl5122delta.pod for a description of what's changed.  See your
 installed copy of the perllocal.pod file for a (possibly incomplete)
 list of locally installed modules.  Also see CPAN::autobundle for one
 way to make a "bundle" of your currently installed modules.
@@ -245,7 +249,7 @@
 model (available internally since 5.6, and as a user-level module since 5.8) is
 called interpreter-based implementation (ithreads), with one interpreter per
 thread, and explicit sharing of data.  The (deprecated) 5.005 version
-(5005threads) has been removed for release 5.10.
+(5005threads) was removed for release 5.10.
 
 The 'threads' module is for use with the ithreads implementation.  The
 'Thread' module emulates the old 5005threads interface on top of the current
@@ -311,7 +315,7 @@
 On these systems, it might be the default compilation mode, and there
 is currently no guarantee that passing no use64bitall option to the
 Configure process will build a 32bit perl. Implementing -Duse32bit*
-options is planned for perl 5.12.
+options is planned for a future release of perl.
 
 =head3 Long doubles
 
@@ -465,8 +469,8 @@
 There is also an potential problem with the shared perl library if you
 want to have more than one "flavor" of the same version of perl (e.g.
 with and without -DDEBUGGING).  For example, suppose you build and
-install a standard Perl 5.10.1 with a shared library.  Then, suppose you
-try to build Perl 5.10.1 with -DDEBUGGING enabled, but everything else
+install a standard Perl 5.10.0 with a shared library.  Then, suppose you
+try to build Perl 5.10.0 with -DDEBUGGING enabled, but everything else
 the same, including all the installation directories.  How can you
 ensure that your newly built perl will link with your newly built
 libperl.so.8 rather with the installed libperl.so.8?  The answer is
@@ -496,9 +500,10 @@
 whenever perl is running as a stand alone interpreter, and to call the safe
 but potentially leaky C<putenv()> function when the perl interpreter is
 embedded in another application. You can force perl to always use C<putenv()>
-by compiling with -DPERL_USE_SAFE_PUTENV. You can force an embedded perl to
-use direct manipulation by setting C<PL_use_safe_putenv = 0;> after the
-C<perl_construct()> call.
+by compiling with C<-Accflags="-DPERL_USE_SAFE_PUTENV">, see section
+L</"Altering Configure variables for C compiler switches etc.">.
+You can force an embedded perl to use direct manipulation by setting
+C<PL_use_safe_putenv = 0;> after the C<perl_construct()> call.
 
 =head2 Installation Directories
 
@@ -525,9 +530,9 @@
 
 =item Directories for the perl distribution
 
-By default, Configure will use the following directories for 5.10.1.
+By default, Configure will use the following directories for 5.12.2.
 $version is the full perl version number, including subversion, e.g.
-5.10.1 or 5.9.5, and $archname is a string like sun4-sunos,
+5.12.2 or 5.9.5, and $archname is a string like sun4-sunos,
 determined by Configure.  The full definitions of all Configure
 variables are in the file Porting/Glossary.
 
@@ -788,6 +793,10 @@
 "-Duserelocatableinc" is that everything is relocated. The initial
 install is done to the original configured prefix.
 
+This option is not compatible with the building of a shared libperl
+("-Duseshrplib"), because in that case perl is linked with an hard-coded
+rpath that points at the libperl.so, that cannot be relocated.
+
 =head2 Site-wide Policy settings
 
 After Configure runs, it stores a number of common site-wide "policy"
@@ -933,7 +942,8 @@
 
 To disable certain extensions so that they are not built, use the
 -Dnoextensions=... and -Donlyextensions=... options.  They both accept
-a space-separated list of extensions.  The extensions listed in
+a space-separated list of extensions, such as C<IPC/SysV>. The extensions
+listed in
 C<noextensions> are removed from the list of extensions to build, while
 the C<onlyextensions> is rather more severe and builds only the listed
 extensions.  The latter should be used with extreme caution since
@@ -1283,7 +1293,7 @@
 
 If you plan to port Perl to a new architecture, study carefully the
 section titled "Philosophical Issues in Patching and Porting Perl"
-in the file Porting/pumpkin.pod and the file Porting/patching.pod.
+in the file Porting/pumpkin.pod and the file pod/perlrepository.pod.
 Study also how other non-UNIX ports have solved problems.
 
 =back
@@ -1316,25 +1326,9 @@
 
 =head2 suidperl
 
-suidperl is an optional component, which is normally neither built
-nor installed by default.  From perlfaq1:
-
-	On some systems, setuid and setgid scripts (scripts written
-        in the C shell, Bourne shell, or Perl, for example, with the
-        set user or group ID permissions enabled) are insecure due to
-        a race condition in the kernel. For those systems, Perl versions
-        5 and 4 attempt to work around this vulnerability with an optional
-        component, a special program named suidperl, also known as sperl.
-        This program attempts to emulate the set-user-ID and set-group-ID
-        features of the kernel.
-
-Because of the buggy history of suidperl, and the difficulty
-of properly security auditing as large and complex piece of
-software as Perl, we cannot recommend using suidperl and the feature
-should be considered deprecated.
-
-Instead, use a tool specifically designed to handle changes in
-privileges, such as B<sudo>.
+suidperl was an optional component of earlier releases of perl. It is no
+longer available.  Instead, use a tool specifically designed to handle
+changes in privileges, such as B<sudo>.
 
 =head1 make depend
 
@@ -1573,6 +1567,26 @@
 SCO prior to 3.2.4 may be missing dbmclose().  An upgrade to 3.2.4
 that includes libdbm.nfs (which includes dbmclose()) may be available.
 
+=item error: too few arguments to function 'dbmclose'
+
+Building ODBM_File on some (Open)SUSE distributions might run into this
+error, as the header file is broken. There are two ways to deal with this
+
+ 1. Disable the use of ODBM_FILE
+
+    Configure ... -Dnoextensions=ODBM_File
+
+ 2. Fix the header file, somewhat like this:
+
+    --- a/usr/include/dbm.h  2010-03-24 08:54:59.000000000 +0100
+    +++ b/usr/include/dbm.h  2010-03-24 08:55:15.000000000 +0100
+    @@ -59,4 +59,4 @@ extern datum  firstkey __P((void));
+
+     extern datum   nextkey __P((datum key));
+
+    -extern int     dbmclose __P((DBM *));
+    +extern int     dbmclose __P((void));
+
 =item Note (probably harmless): No library found for -lsomething
 
 If you see such a message during the building of an extension, but
@@ -1852,7 +1866,7 @@
 by hand to see if it makes any difference.  If individual tests
 bomb, you can run them by hand, e.g.,
 
-	cd t ; ./perl -MTestInit op/groups.t
+	./perl -MTestInit t/op/groups.t
 
 Another way to get more detailed information about failed tests and
 individual subtests is to cd to the t directory and run
@@ -2278,9 +2292,8 @@
 
 =head1 Coexistence with earlier versions of perl 5
 
-This version is not binary compatible with releases of Perl prior
-to 5.10.0.  In other words, you will have to recompile any XS modules
-installed under version 5.8.9 (or earlier).
+Perl 5.12 is not binary compatible with earlier versions of Perl.
+In other words, you will have to recompile your XS modules.
 
 In general, you can usually safely upgrade from one version of Perl (e.g.
 5.X.Y) to another similar minor version (e.g. 5.X.(Y+1))) without
@@ -2291,38 +2304,60 @@
 used with a newer version of Perl.  Here is how it is supposed to work.
 (These examples assume you accept all the Configure defaults.)
 
-Suppose you already have versions 5.8.9 and 5.10.0 installed, and you
-are now installing 5.10.1.  The directories searched by version 5.10.1
-will be:
-
-    /usr/local/lib/perl5/5.10.1/$archname
-    /usr/local/lib/perl5/5.10.1
-    /usr/local/lib/perl5/site_perl/5.10.1/$archname
-    /usr/local/lib/perl5/site_perl/5.10.1
-
-    /usr/local/lib/perl5/site_perl/5.10.0/$archname
-    /usr/local/lib/perl5/site_perl/5.10.0
-    /usr/local/lib/perl5/site_perl/5.8.9
-    /usr/local/lib/perl5/site_perl
+Suppose you already have version 5.8.7 installed.  The directories
+searched by 5.8.7 are typically like:
+
+	/usr/local/lib/perl5/5.8.7/$archname
+	/usr/local/lib/perl5/5.8.7
+	/usr/local/lib/perl5/site_perl/5.8.7/$archname
+	/usr/local/lib/perl5/site_perl/5.8.7
+
+Now, suppose you install version 5.8.8.  The directories
+searched by version 5.8.8 will be:
+
+	/usr/local/lib/perl5/5.8.8/$archname
+	/usr/local/lib/perl5/5.8.8
+	/usr/local/lib/perl5/site_perl/5.8.8/$archname
+	/usr/local/lib/perl5/site_perl/5.8.8
+
+	/usr/local/lib/perl5/site_perl/5.8.7/$archname
+	/usr/local/lib/perl5/site_perl/5.8.7
+	/usr/local/lib/perl5/site_perl/
 
-Notice the last four entries -- Perl understands the default structure
+Notice the last three entries -- Perl understands the default structure
 of the $sitelib directories and will look back in older, compatible
-directories.  It will load up architecture-dependent modules from your
-5.10.0 installation, and pure perl modules from either your 5.10.0 or
-5.8.9 installations.  The last entry, /usr/local/lib/perl5/site_perl/,
-is there for 5.004-era pure perl modules.
-
-Next, suppose that you now upgrade a module to one which requires
-features present only in 5.10.1.  That new module will get installed into
-/usr/local/lib/perl5/site_perl/5.10.1 and will be available to 5.10.1,
-but will not interfere with the 5.10.0 version.
+directories.  This way, modules installed under 5.8.7 will continue
+to be usable by 5.8.7 but will also accessible to 5.8.8.  Further,
+suppose that you upgrade a module to one which requires features
+present only in 5.8.8.  That new module will get installed into
+/usr/local/lib/perl5/site_perl/5.8.8 and will be available to 5.8.8,
+but will not interfere with the 5.8.7 version.
+
+The last entry, /usr/local/lib/perl5/site_perl/, is there so that
+5.6.0 and above will look for 5.004-era pure perl modules.
+
+Lastly, suppose you now install 5.10.0, which is not binary compatible
+with 5.8.x.  The directories searched by 5.10.0 (if you don't change the
+Configure defaults) will be:
+
+	/usr/local/lib/perl5/5.10.0/$archname
+	/usr/local/lib/perl5/5.10.0
+	/usr/local/lib/perl5/site_perl/5.10.0/$archname
+	/usr/local/lib/perl5/site_perl/5.10.0
+
+	/usr/local/lib/perl5/site_perl/5.8.8
+
+	/usr/local/lib/perl5/site_perl/5.8.7
+
+	/usr/local/lib/perl5/site_perl/
+
+Note that the earlier $archname entries are now gone, but pure perl
+modules from earlier versions will still be found.
 
 This way, you can choose to share compatible extensions, but also upgrade
 to a newer version of an extension that may be incompatible with earlier
 versions, without breaking the earlier versions' installations.
 
-This search order is scheduled for revision starting in version 5.11.0.
-
 =head2 Maintaining completely separate versions
 
 Many users prefer to keep all versions of perl in completely
@@ -2331,9 +2366,9 @@
 libraries after 5.6.0, but not for executables. TODO?)  One convenient
 way to do this is by using a separate prefix for each version, such as
 
-	sh Configure -Dprefix=/opt/perl5.10.1
+	sh Configure -Dprefix=/opt/perl5.12.2
 
-and adding /opt/perl5.10.1/bin to the shell PATH variable.  Such users
+and adding /opt/perl5.12.2/bin to the shell PATH variable.  Such users
 may also wish to add a symbolic link /usr/local/bin/perl so that
 scripts can still start with #!/usr/local/bin/perl.
 
@@ -2346,13 +2381,13 @@
 subversions may not have all the compatibility wrinkles ironed out
 yet.
 
-=head2 Upgrading from 5.8.x or earlier
+=head2 Upgrading from 5.11.0 or earlier
 
-B<Perl 5.10.1 is binary incompatible with Perl 5.8.x and any earlier
+B<Perl 5.12.2 is binary incompatible with Perl 5.11.1 and any earlier
 Perl release.>  Perl modules having binary parts
 (meaning that a C compiler is used) will have to be recompiled to be
-used with 5.10.1.  If you find you do need to rebuild an extension with
-5.10.1, you may safely do so without disturbing the older
+used with 5.12.2.  If you find you do need to rebuild an extension with
+5.12.2, you may safely do so without disturbing the older
 installations.  (See L<"Coexistence with earlier versions of perl 5">
 above.)
 
Index: src/gnu/usr.bin/perl/MANIFEST
diff -u src/gnu/usr.bin/perl/MANIFEST:1.21 src/gnu/usr.bin/perl/MANIFEST:1.22
--- MANIFEST:1.21	Mon Jun 28 18:18:11 2010
+++ MANIFEST	Fri Sep 24 15:06:38 2010
@@ -18,23 +18,2872 @@
 configure.gnu		Crude emulation of GNU configure
 cop.h			Control operator header
 Copying			The GNU General Public License
-Cross/build-arm-n770-sh	Cross-compilation
-Cross/cflags-cross-arm	Cross-compilation
-Cross/config		Cross-compilation
+cpan/Archive-Extract/lib/Archive/Extract.pm	Archive::Extract
+cpan/Archive-Extract/t/01_Archive-Extract.t	Archive::Extract tests
+cpan/Archive-Extract/t/src/double_dir.zip	Archive::Extract tests
+cpan/Archive-Extract/t/src/x.bz2		Archive::Extract tests
+cpan/Archive-Extract/t/src/x.gz			Archive::Extract tests
+cpan/Archive-Extract/t/src/x.jar		Archive::Extract tests
+cpan/Archive-Extract/t/src/x.lzma		Archive::Extract tests
+cpan/Archive-Extract/t/src/x.par		Archive::Extract tests
+cpan/Archive-Extract/t/src/x.tar		Archive::Extract tests
+cpan/Archive-Extract/t/src/x.tar.gz		Archive::Extract tests
+cpan/Archive-Extract/t/src/x.tgz		Archive::Extract tests
+cpan/Archive-Extract/t/src/x.Z			Archive::Extract tests
+cpan/Archive-Extract/t/src/x.zip		Archive::Extract tests
+cpan/Archive-Extract/t/src/y.jar		Archive::Extract tests
+cpan/Archive-Extract/t/src/y.par		Archive::Extract tests
+cpan/Archive-Extract/t/src/y.tar		Archive::Extract tests
+cpan/Archive-Extract/t/src/y.tar.bz2		Archive::Extract tests
+cpan/Archive-Extract/t/src/y.tar.gz		Archive::Extract tests
+cpan/Archive-Extract/t/src/y.tbz		Archive::Extract tests
+cpan/Archive-Extract/t/src/y.tgz		Archive::Extract tests
+cpan/Archive-Extract/t/src/y.zip		Archive::Extract tests
+cpan/Archive-Tar/bin/ptar				the ptar utility
+cpan/Archive-Tar/bin/ptardiff				the ptardiff utility
+cpan/Archive-Tar/lib/Archive/Tar/Constant.pm		Archive::Tar
+cpan/Archive-Tar/lib/Archive/Tar/File.pm		Archive::Tar
+cpan/Archive-Tar/lib/Archive/Tar.pm			Archive::Tar
+cpan/Archive-Tar/Makefile.PL				Achive::Tar
+cpan/Archive-Tar/t/01_use.t				Archive::Tar tests
+cpan/Archive-Tar/t/02_methods.t				Archive::Tar tests
+cpan/Archive-Tar/t/03_file.t				Archive::Tar tests
+cpan/Archive-Tar/t/04_resolved_issues.t			Archive::Tar tests
+cpan/Archive-Tar/t/05_iter.t				Archive::Tar tests
+cpan/Archive-Tar/t/06_error.t				Archive::Tar tests
+cpan/Archive-Tar/t/90_symlink.t				Archive::Tar tests
+cpan/Archive-Tar/t/99_pod.t				Archive::Tar tests
+cpan/Archive-Tar/t/src/header/signed.tar		Archive::Tar tests
+cpan/Archive-Tar/t/src/linktest/linktest_missing_dir.tar	Archive::Tar tests
+cpan/Archive-Tar/t/src/linktest/linktest_with_dir.tar	Archive::Tar tests
+cpan/Archive-Tar/t/src/long/b				Archive::Tar tests
+cpan/Archive-Tar/t/src/long/bar.tar			Archive::Tar tests
+cpan/Archive-Tar/t/src/long/foo.tbz			Archive::Tar tests
+cpan/Archive-Tar/t/src/long/foo.tgz			Archive::Tar tests
+cpan/Archive-Tar/t/src/short/b				Archive::Tar tests
+cpan/Archive-Tar/t/src/short/bar.tar			Archive::Tar tests
+cpan/Archive-Tar/t/src/short/foo.tbz			Archive::Tar tests
+cpan/Archive-Tar/t/src/short/foo.tgz			Archive::Tar tests
+cpan/autodie/lib/autodie/exception.pm		Exception class for autodie
+cpan/autodie/lib/autodie/exception/system.pm	Exception class for autodying system()
+cpan/autodie/lib/autodie/hints.pm	Hinting interface for autodie
+cpan/autodie/lib/autodie.pm		Functions suceed or die with lexical scope
+cpan/autodie/lib/Fatal.pm		Make errors in functions/builtins fatal
+cpan/autodie/t/00-load.t		autodie - basic load
+cpan/autodie/t/autodie.t		autodie - Basic functionality
+cpan/autodie/t/autodie_test_module.pm	autodie - test helper
+cpan/autodie/t/backcompat.t		autodie - More Fatal backcompat
+cpan/autodie/t/basic_exceptions.t	autodie - Basic exception tests
+cpan/autodie/t/binmode.t		autodie - Binmode testing
+cpan/autodie/t/blog_hints.t		autodie - Tests fro PJF's blog
+cpan/autodie/t/caller.t			autodie - Caller diagnostics
+cpan/autodie/t/context_lexical.t	autodie - Context clobbering lexically
+cpan/autodie/t/context.t		autodie - Context clobbering tests
+cpan/autodie/t/crickey.t		autodie - Like an Australian
+cpan/autodie/t/dbmopen.t		autodie - dbm tests
+cpan/autodie/t/exception_class.t	autodie - Exception class subclasses
+cpan/autodie/t/exceptions.t		autodie - 5.10 exception tests.
+cpan/autodie/t/exec.t			autodie - exec tests.
+cpan/autodie/t/Fatal.t			autodie - Fatal backcompatibility
+cpan/autodie/t/filehandles.t		autodie - filehandle tests
+cpan/autodie/t/fileno.t			autodie - fileno tests
+cpan/autodie/t/flock.t			autodie - File locking tests
+cpan/autodie/t/format-clobber.t		autodie - Don't clobber scalars
+cpan/autodie/t/hints_insist.t		autodie - Test hints insistance
+cpan/autodie/t/hints_pod_examples.t	autodie - Test hints POD examples
+cpan/autodie/t/hints_provider_does.t	autodie - Test hints/does roles
+cpan/autodie/t/hints_provider_easy_does_it.t	autodie - Test easy hints/does
+cpan/autodie/t/hints_provider_isa.t	autodie - Test hints/inheritance
+cpan/autodie/t/hints.t			autodie - Test hints interface
+cpan/autodie/t/internal-backcompat.t	autodie - Back-compatibility tests
+cpan/autodie/t/internal.t		autodie - internal interface tests
+cpan/autodie/t/lethal.t			autodie - lethal is the one true name
+cpan/autodie/t/lib/autodie/test/au/exception.pm	autodie - Australian helper
+cpan/autodie/t/lib/autodie/test/au.pm		autodie - Austrlaian helper
+cpan/autodie/t/lib/autodie/test/badname.pm	autodie - Bad exception class
+cpan/autodie/t/lib/autodie/test/missing.pm	autodie - Missing exception class
+cpan/autodie/t/lib/Caller_helper.pm		autodie - Caller helper
+cpan/autodie/t/lib/Hints_pod_examples.pm	autodie - Hints/pod helper
+cpan/autodie/t/lib/Hints_provider_does.pm	autodie - Hints/does helper
+cpan/autodie/t/lib/Hints_provider_easy_does_it.pm	autodie - Hints/easy helper
+cpan/autodie/t/lib/Hints_provider_isa.pm	autodie - Hints/inherit helper
+cpan/autodie/t/lib/Hints_test.pm	autodie - Hints test helper
+cpan/autodie/t/lib/lethal.pm		autodie - with a better name
+cpan/autodie/t/lib/my/autodie.pm	autodie - blog_hints.t helper
+cpan/autodie/t/lib/OtherTypes.pm	autodie - Format clobberer helper.
+cpan/autodie/t/lib/pujHa/ghach/Dotlh.pm	autodie - With Klingon honour
+cpan/autodie/t/lib/pujHa/ghach.pm	autodie - Like a Klingon
+cpan/autodie/t/lib/Some/Module.pm	autodie - blog_hints.t helper
+cpan/autodie/t/mkdir.t			autodie - filesystem tests
+cpan/autodie/t/open.t			autodie - Testing open
+cpan/autodie/t/recv.t			autodie - send/recv tests
+cpan/autodie/t/repeat.t			autodie - repeat autodie leak tests
+cpan/autodie/t/scope_leak.t		autodie - file scope leak tests
+cpan/autodie/t/string-eval-basic.t	autodie - Basic string eval test
+cpan/autodie/t/string-eval-leak.t	autodie - String eval leak test
+cpan/autodie/t/sysopen.t		autodie - sysopen tests
+cpan/autodie/t/truncate.t		autodie - File truncation tests
+cpan/autodie/t/unlink.t			autodie - Unlink system tests.
+cpan/autodie/t/user-context.t		autodie - Context changes for usersubs
+cpan/autodie/t/usersub.t		autodie - user subroutine tests
+cpan/autodie/t/version.t		autodie - versioning tests
+cpan/autodie/t/version_tag.t
+cpan/AutoLoader/lib/AutoLoader.pm	Autoloader base class
+cpan/AutoLoader/lib/AutoSplit.pm	Split up autoload functions
+cpan/AutoLoader/t/01AutoLoader.t	See if AutoLoader works
+cpan/AutoLoader/t/02AutoSplit.t		See if AutoSplit works
+cpan/B-Debug/Debug.pm	Compiler Debug backend
+cpan/B-Debug/t/debug.t	See if B::Debug works
+cpan/bignum/lib/bigint.pm		bigint
+cpan/bignum/lib/bignum.pm		bignum
+cpan/bignum/lib/bigrat.pm		bigrat
+cpan/bignum/lib/Math/BigFloat/Trace.pm	bignum tracing
+cpan/bignum/lib/Math/BigInt/Trace.pm	bignum tracing
+cpan/bignum/t/big_e_pi.t		See if bignum exports e() and PI()
+cpan/bignum/t/bigexp.t			See if bignum works
+cpan/bignum/t/bigint.t			See if bigint works
+cpan/bignum/t/bignum.t			See if bignum works
+cpan/bignum/t/bigrat.t			See if bigrat works
+cpan/bignum/t/bii_e_pi.t		See if bigint exports e() and PI()
+cpan/bignum/t/biinfnan.t		See if bignum works
+cpan/bignum/t/bir_e_pi.t		See if bigrat exports e() and PI()
+cpan/bignum/t/bninfnan.t		See if bignum works
+cpan/bignum/t/bn_lite.t			See if bignum with Math::BigInt::Lite works
+cpan/bignum/t/brinfnan.t		See if bignum works
+cpan/bignum/t/br_lite.t			See if bigrat with Math::BigInt::Lite works
+cpan/bignum/t/in_effect.t		See if in_effect() works
+cpan/bignum/t/infnan.inc		See if bignum with inf/NaN works
+cpan/bignum/t/option_a.t		See if bignum a => X works
+cpan/bignum/t/option_l.t		See if bignum l => X works
+cpan/bignum/t/option_p.t		See if bignum p => X works
+cpan/bignum/t/ratopt_a.t		See if bigrat a => X works
+cpan/bignum/t/scope_f.t			See if no bignum works
+cpan/bignum/t/scope_i.t			See if no bigint works
+cpan/bignum/t/scope_r.t			See if no bigrat works
+cpan/B-Lint/lib/B/Lint/Debug.pm			Adds debugging stringification to B::
+cpan/B-Lint/lib/B/Lint.pm			Compiler Lint backend
+cpan/B-Lint/t/lint.t				See if B::Lint works
+cpan/B-Lint/t/pluglib/B/Lint/Plugin/Test.pm	See if B::Lint works
+cpan/CGI/Changes			Changelog for CGI.pm
+cpan/CGI/examples/caution.xbm		CGI example
+cpan/CGI/examples/clickable_image.cgi	CGI example
+cpan/CGI/examples/cookie.cgi		CGI example
+cpan/CGI/examples/crash.cgi		CGI example
+cpan/CGI/examples/customize.cgi		CGI example
+cpan/CGI/examples/diff_upload.cgi	CGI example
+cpan/CGI/examples/dna.small.gif		Small image for CGI examples
+cpan/CGI/examples/file_upload.cgi	CGI example
+cpan/CGI/examples/frameset.cgi		CGI example
+cpan/CGI/examples/index.html		Index page for CGI examples
+cpan/CGI/examples/internal_links.cgi	CGI example
+cpan/CGI/examples/javascript.cgi	CGI example
+cpan/CGI/examples/make_links.pl		CGI example
+cpan/CGI/examples/monty.cgi		CGI example
+cpan/CGI/examples/multiple_forms.cgi	CGI example
+cpan/CGI/examples/nph-clock.cgi		CGI example
+cpan/CGI/examples/nph-multipart.cgi	CGI example
+cpan/CGI/examples/popup.cgi		CGI example
+cpan/CGI/examples/save_state.cgi	CGI example
+cpan/CGI/examples/tryit.cgi		CGI example
+cpan/CGI/examples/wilogo.gif		CGI example
+cpan/CGI/lib/CGI/Apache.pm		Support for Apache's Perl module
+cpan/CGI/lib/CGI/Carp.pm		Log server errors with helpful context
+cpan/CGI/lib/CGI/Cookie.pm		Interface to Netscape Cookies
+cpan/CGI/lib/CGI/Fast.pm		Support for FastCGI (persistent server process)
+cpan/CGI/lib/CGI.pm			Web server interface ("Common Gateway Interface")
+cpan/CGI/lib/CGI/Pretty.pm		Output nicely formatted HTML
+cpan/CGI/lib/CGI/Push.pm		Support for server push
+cpan/CGI/lib/CGI/Switch.pm		Simple interface for multiple server types
+cpan/CGI/lib/CGI/Util.pm		Utility functions
+cpan/CGI/t/apache.t			See if CGI::Apache still loads
+cpan/CGI/t/autoescape.t			See if CGI.pm works
+cpan/CGI/t/can.t			See if CGI.pm works
+cpan/CGI/t/carp.t			See if CGI::Carp works
+cpan/CGI/t/checkbox_group.t		See if CGI.pm works
+cpan/CGI/t/cookie.t			See if CGI::Cookie works
+cpan/CGI/t/Dump.t			See if CGI->Dump works
+cpan/CGI/t/end_form.t			See if CGI.pm works
+cpan/CGI/t/form.t			See if CGI.pm works
+cpan/CGI/t/function.t			See if CGI.pm works
+cpan/CGI/t/hidden.t			See if CGI.pm works
+cpan/CGI/t/html.t			See if CGI.pm works
+cpan/CGI/t/http.t			See if CGI.pm works
+cpan/CGI/t/init.t			See if CGI.pm works
+cpan/CGI/t/init_test.txt		See if CGI.pm works
+cpan/CGI/t/no_tabindex.t		See if CGI.pm works
+cpan/CGI/t/popup_menu.t			See if CGI pop menus work
+cpan/CGI/t/pretty.t			See if CGI.pm works
+cpan/CGI/t/push.t			See if CGI::Push works
+cpan/CGI/t/query_string.t		See if CGI->query_string() works
+cpan/CGI/t/request.t			See if CGI.pm works
+cpan/CGI/t/save_read_roundtrip.t	See if CGI.pm works
+cpan/CGI/t/start_end_asterisk.t		See if CGI.pm works
+cpan/CGI/t/start_end_end.t		See if CGI.pm works
+cpan/CGI/t/start_end_start.t		See if CGI.pm works
+cpan/CGI/t/switch.t			See if CGI::Switch still loads
+cpan/CGI/t/unescapeHTML.t		See if CGI::unescapeHTML() works
+cpan/CGI/t/uploadInfo.t			See if CGI.pm works
+cpan/CGI/t/upload_post_text.txt		Test data for CGI.pm
+cpan/CGI/t/upload.t			See if CGI.pm works
+cpan/CGI/t/url.t			See if CGI.pm works
+cpan/CGI/t/user_agent.t			See if CGI->user_agent() works
+cpan/CGI/t/utf8.t			See if CGI.pm works
+cpan/CGI/t/util-58.t			See if 5.8-dependent features work
+cpan/CGI/t/util.t			See if CGI.pm works
+cpan/Class-ISA/ChangeLog		Changes for Class::ISA
+cpan/Class-ISA/lib/Class/ISA.pm		Class::ISA
+cpan/Class-ISA/t/00_about_verbose.t	Tests for Class::ISA
+cpan/Class-ISA/t/01_old_junk.t		Tests for Class::ISA
+cpan/Compress-Raw-Bzip2/bzip2-src/blocksort.c
+cpan/Compress-Raw-Bzip2/bzip2-src/bzlib.c
+cpan/Compress-Raw-Bzip2/bzip2-src/bzlib.h
+cpan/Compress-Raw-Bzip2/bzip2-src/bzlib_private.h
+cpan/Compress-Raw-Bzip2/bzip2-src/compress.c
+cpan/Compress-Raw-Bzip2/bzip2-src/crctable.c
+cpan/Compress-Raw-Bzip2/bzip2-src/decompress.c
+cpan/Compress-Raw-Bzip2/bzip2-src/huffman.c
+cpan/Compress-Raw-Bzip2/bzip2-src/LICENSE
+cpan/Compress-Raw-Bzip2/bzip2-src/randtable.c
+cpan/Compress-Raw-Bzip2/Bzip2.xs
+cpan/Compress-Raw-Bzip2/Changes
+cpan/Compress-Raw-Bzip2/fallback/constants.h
+cpan/Compress-Raw-Bzip2/fallback/constants.xs
+cpan/Compress-Raw-Bzip2/lib/Compress/Raw/Bzip2.pm
+cpan/Compress-Raw-Bzip2/Makefile.PL
+cpan/Compress-Raw-Bzip2/pod/FAQ.pod
+cpan/Compress-Raw-Bzip2/private/MakeUtil.pm
+cpan/Compress-Raw-Bzip2/README
+cpan/Compress-Raw-Bzip2/t/000prereq.t
+cpan/Compress-Raw-Bzip2/t/01bzip2.t
+cpan/Compress-Raw-Bzip2/t/09limitoutput.t
+cpan/Compress-Raw-Bzip2/t/99pod.t
+cpan/Compress-Raw-Bzip2/t/compress/CompTestUtils.pm
+cpan/Compress-Raw-Bzip2/typemap
+cpan/Compress-Raw-Zlib/Changes			Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/config.in		Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/examples/filtdef		Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/examples/filtinf		Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/fallback/constants.h	Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/fallback/constants.xs	Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/lib/Compress/Raw/Zlib.pm	Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/Makefile.PL		Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/pod/FAQ.pod		Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/private/MakeUtil.pm	Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/README			Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/t/01version.t		Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/t/02zlib.t		Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/t/07bufsize.t		Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/t/09limitoutput.t	Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/t/18lvalue.t		Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/t/compress/CompTestUtils.pm
+cpan/Compress-Raw-Zlib/typemap			Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/zlib-src/adler32.c	Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/zlib-src/compress.c	Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/zlib-src/crc32.c		Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/zlib-src/crc32.h		Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/zlib-src/deflate.c	Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/zlib-src/deflate.h	Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/zlib-src/infback.c	Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/zlib-src/inffast.c	Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/zlib-src/inffast.h	Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/zlib-src/inffixed.h	Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/zlib-src/inflate.c	Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/zlib-src/inflate.h	Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/zlib-src/inftrees.c	Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/zlib-src/inftrees.h	Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/zlib-src/trees.c		Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/zlib-src/trees.h		Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/zlib-src/uncompr.c	Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/zlib-src/zconf.h		Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/zlib-src/zlib.h		Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/zlib-src/zutil.c		Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/zlib-src/zutil.h		Compress::Raw::Zlib
+cpan/Compress-Raw-Zlib/Zlib.xs			Compress::Raw::Zlib
+cpan/CPAN/Changes				CPAN.pm Changes file
+cpan/CPAN/lib/App/Cpan.pm		helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/API/HOWTO.pod		recipe book for programming with CPAN.pm
+cpan/CPAN/lib/CPAN/Author.pm		helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/Bundle.pm		helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/CacheMgr.pm		helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/Complete.pm		helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/Debug.pm		helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/DeferredCode.pm	helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/Distribution.pm	helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/Distroprefs.pm	helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/Distrostatus.pm	helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/Exception/blocked_urllist.pm	helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/Exception/RecursiveDependency.pm	helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/Exception/yaml_not_installed.pm	helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/FirstTime.pm		Utility for creating CPAN config files
+cpan/CPAN/lib/CPAN/FTP/netrc.pm		helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/FTP.pm			helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/HandleConfig.pm	helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/Index.pm		helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/InfoObj.pm		helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/Kwalify/distroprefs.dd		helper file for validating config files
+cpan/CPAN/lib/CPAN/Kwalify/distroprefs.yml	helper file for validating config files
+cpan/CPAN/lib/CPAN/Kwalify.pm		helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/LWP/UserAgent.pm	helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/Mirrors.pm		helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/Module.pm		helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/Nox.pm			Runs CPAN while avoiding compiled extensions
+cpan/CPAN/lib/CPAN.pm			Interface to Comprehensive Perl Archive Network
+cpan/CPAN/lib/CPAN/Prompt.pm
+cpan/CPAN/lib/CPAN/Queue.pm		queueing system for CPAN.pm
+cpan/CPAN/lib/CPAN/Shell.pm
+cpan/CPAN/lib/CPAN/Tarzip.pm		helper package for CPAN.pm
+cpan/CPAN/lib/CPAN/URL.pm
+cpan/CPAN/lib/CPAN/Version.pm		Simple math with different flavors of version strings
+cpan/CPAN/PAUSE2003.pub		CPAN public key
+cpan/CPAN/PAUSE2005.pub		CPAN public key
+cpan/CPAN/PAUSE2007.pub		CPAN public key
+cpan/CPAN/PAUSE2009.pub		CPAN public key
+cpan/CPANPLUS/bin/cpan2dist			the cpan2dist utility
+cpan/CPANPLUS/bin/cpanp				the cpanp utility
+cpan/CPANPLUS/bin/cpanp-run-perl		the cpanp-run-perl utility
+cpan/CPANPLUS-Dist-Build/lib/CPANPLUS/Dist/Build/Constants.pm	CPANPLUS::Dist::Build
+cpan/CPANPLUS-Dist-Build/lib/CPANPLUS/Dist/Build.pm		CPANPLUS::Dist::Build
+cpan/CPANPLUS-Dist-Build/t/01_CPANPLUS-Dist-Build-Constants.t	CPANPLUS::Dist::Build tests
+cpan/CPANPLUS-Dist-Build/t/02_CPANPLUS-Dist-Build.t		CPANPLUS::Dist::Build tests
+cpan/CPANPLUS-Dist-Build/t/dummy-CPAN/authors/01mailrc.txt.gz
+cpan/CPANPLUS-Dist-Build/t/dummy-CPAN/modules/02packages.details.txt.gz
+cpan/CPANPLUS-Dist-Build/t/dummy-CPAN/modules/03modlist.data.gz
+cpan/CPANPLUS-Dist-Build/t/dummy-perl/.hidden			CPANPLUS::Dist::Build tests
+cpan/CPANPLUS-Dist-Build/t/inc/conf.pl				CPANPLUS::Dist::Build tests
+cpan/CPANPLUS-Dist-Build/t/src/noxs/Foo-Bar-0.01.tar.gz		CPANPLUS::Dist::Build tests
+cpan/CPANPLUS-Dist-Build/t/src/xs/Foo-Bar-0.01.tar.gz		CPANPLUS::Dist::Build tests
+cpan/CPANPLUS/lib/CPANPLUS/Backend.pm				CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Backend/RV.pm			CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Config.pm				CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Configure.pm				CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Configure/Setup.pm			CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Dist/Autobundle.pm			CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Dist/Base.pm				CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Dist/MM.pm				CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Dist.pm				CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Dist/Sample.pm			CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Error.pm				CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/FAQ.pod				CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Hacking.pod				CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Internals/Constants.pm		CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Internals/Constants/Report.pm	CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Internals/Extract.pm			CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Internals/Fetch.pm			CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Internals.pm				CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Internals/Report.pm			CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Internals/Search.pm			CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Internals/Source/Memory.pm		CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Internals/Source.pm			CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Internals/Source/SQLite.pm		CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Internals/Source/SQLite/Tie.pm	CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Internals/Utils/Autoflush.pm		CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Internals/Utils.pm			CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Module/Author/Fake.pm		CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Module/Author.pm			CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Module/Checksums.pm			CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Module/Fake.pm			CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Module.pm				CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Module/Signature.pm			CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS.pm					CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Selfupdate.pm			CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Shell/Classic.pm			CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/CustomSource.pm	CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/HOWTO.pod	CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/Remote.pm	CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/Source.pm	CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Shell/Default.pm			CPANPLUS
+cpan/CPANPLUS/lib/CPANPLUS/Shell.pm				CPANPLUS
+cpan/CPANPLUS/Makefile.PL
+cpan/CPANPLUS/t/00_CPANPLUS-Internals-Utils.t		CPANPLUS tests
+cpan/CPANPLUS/t/01_CPANPLUS-Configure.t			CPANPLUS tests
+cpan/CPANPLUS/t/02_CPANPLUS-Internals.t			CPANPLUS tests
+cpan/CPANPLUS/t/03_CPANPLUS-Internals-Source.t		CPANPLUS tests
+cpan/CPANPLUS/t/04_CPANPLUS-Module.t			CPANPLUS tests
+cpan/CPANPLUS/t/05_CPANPLUS-Internals-Fetch.t		CPANPLUS tests
+cpan/CPANPLUS/t/06_CPANPLUS-Internals-Constants.t	CPANPLUS tests
+cpan/CPANPLUS/t/07_CPANPLUS-Internals-Extract.t		CPANPLUS tests
+cpan/CPANPLUS/t/08_CPANPLUS-Backend.t			CPANPLUS tests
+cpan/CPANPLUS/t/09_CPANPLUS-Internals-Search.t		CPANPLUS tests
+cpan/CPANPLUS/t/10_CPANPLUS-Error.t			CPANPLUS tests
+cpan/CPANPLUS/t/15_CPANPLUS-Shell.t			CPANPLUS tests
+cpan/CPANPLUS/t/19_CPANPLUS-Dist.t			CPANPLUS tests
+cpan/CPANPLUS/t/20_CPANPLUS-Dist-MM.t			CPANPLUS tests
+cpan/CPANPLUS/t/21_CPANPLUS-Dist-No-Build.t		CPANPLUS tests
+cpan/CPANPLUS/t/25_CPANPLUS.t				CPANPLUS tests
+cpan/CPANPLUS/t/30_CPANPLUS-Internals-Selfupdate.t	CPANPLUS tests
+cpan/CPANPLUS/t/40_CPANPLUS-Internals-Report.t		CPANPLUS tests
+cpan/CPANPLUS/t/dummy-CPAN/authors/01mailrc.txt.gz	CPANPLUS tests
+cpan/CPANPLUS/t/dummy-CPAN/authors/id/EUNOXS/Bundle-Foo-Bar-0.01.tar.gz	CPANPLUS tests
+cpan/CPANPLUS/t/dummy-CPAN/authors/id/EUNOXS/CHECKSUMS			CPANPLUS tests
+cpan/CPANPLUS/t/dummy-CPAN/authors/id/EUNOXS/Foo-Bar-0.01.meta		CPANPLUS tests
+cpan/CPANPLUS/t/dummy-CPAN/authors/id/EUNOXS/Foo-Bar-0.01.readme	CPANPLUS tests
+cpan/CPANPLUS/t/dummy-CPAN/authors/id/EUNOXS/Foo-Bar-0.01.tar.gz	CPANPLUS tests
+cpan/CPANPLUS/t/dummy-CPAN/authors/id/EUNOXS/perl5.005_03.tar.gz	CPANPLUS tests
+cpan/CPANPLUS/t/dummy-CPAN/authors/id/EUXS/CHECKSUMS			CPANPLUS tests
+cpan/CPANPLUS/t/dummy-CPAN/authors/id/EUXS/Foo-Bar-0.01.readme		CPANPLUS tests
+cpan/CPANPLUS/t/dummy-CPAN/authors/id/EUXS/Foo-Bar-0.01.tar.gz		CPANPLUS tests
+cpan/CPANPLUS/t/dummy-CPAN/authors/id/MBNOXS/CHECKSUMS			CPANPLUS tests
+cpan/CPANPLUS/t/dummy-CPAN/authors/id/MBNOXS/Foo-Bar-0.01.readme	CPANPLUS tests
+cpan/CPANPLUS/t/dummy-CPAN/authors/id/MBNOXS/Foo-Bar-0.01.tar.gz	CPANPLUS tests
+cpan/CPANPLUS/t/dummy-CPAN/authors/id/MBXS/CHECKSUMS		CPANPLUS tests
+cpan/CPANPLUS/t/dummy-CPAN/authors/id/MBXS/Foo-Bar-0.01.readme	CPANPLUS tests
+cpan/CPANPLUS/t/dummy-CPAN/authors/id/MBXS/Foo-Bar-0.01.tar.gz	CPANPLUS tests
+cpan/CPANPLUS/t/dummy-CPAN/autobundle/Snapshot.pm		CPANPLUS tests
+cpan/CPANPLUS/t/dummy-CPAN/modules/02packages.details.txt.gz	CPANPLUS tests
+cpan/CPANPLUS/t/dummy-CPAN/modules/03modlist.data.gz		CPANPLUS tests
+cpan/CPANPLUS/t/inc/conf.pl					CPANPLUS tests
+cpan/CPAN/scripts/cpan		easily interact with CPAN from the command line
+cpan/CPAN/t/01loadme.t		See if CPAN the module works
+cpan/CPAN/t/02nox.t		See if CPAN::Nox works
+cpan/CPAN/t/03pkgs.t		See if CPAN::Version works
+cpan/CPAN/t/10version.t		See if CPAN the module works
+cpan/CPAN/t/11mirroredby.t		See if CPAN::Mirrored::By works
+cpan/Cwd/Changes			Cwd extension Changelog
+cpan/Cwd/Cwd.pm				Various cwd routines (getcwd, fastcwd, chdir)
+cpan/Cwd/Cwd.xs				Cwd extension external subroutines
+cpan/Cwd/lib/File/Spec/Cygwin.pm	portable operations on Cygwin file names
+cpan/Cwd/lib/File/Spec/Epoc.pm		portable operations on EPOC file names
+cpan/Cwd/lib/File/Spec/Functions.pm	Function interface to File::Spec object methods
+cpan/Cwd/lib/File/Spec/Mac.pm		portable operations on Mac file names
+cpan/Cwd/lib/File/Spec/OS2.pm		portable operations on OS2 file names
+cpan/Cwd/lib/File/Spec.pm		portable operations on file names
+cpan/Cwd/lib/File/Spec/Unix.pm		portable operations on Unix file names
+cpan/Cwd/lib/File/Spec/VMS.pm		portable operations on VMS file names
+cpan/Cwd/lib/File/Spec/Win32.pm		portable operations on Win32 and NetWare file names
+cpan/Cwd/t/crossplatform.t		See if File::Spec works crossplatform
+cpan/Cwd/t/cwd.t			See if Cwd works
+cpan/Cwd/t/Functions.t			See if File::Spec::Functions works
+cpan/Cwd/t/rel2abs2rel.t		See if File::Spec->rel2abs/abs2rel works
+cpan/Cwd/t/Spec.t			See if File::Spec works
+cpan/Cwd/t/taint.t			See if Cwd works with taint
+cpan/Cwd/t/tmpdir.t			See if File::Spec->tmpdir() works
+cpan/Cwd/t/win32.t			See if Cwd works on Win32
+cpan/DB_File/Changes		Berkeley DB extension change log
+cpan/DB_File/config.in		Part of Berkeley DB configuration
+cpan/DB_File/DB_File_BS		Berkeley DB extension mkbootstrap fodder
+cpan/DB_File/DB_File.pm		Berkeley DB extension Perl module
+cpan/DB_File/DB_File.xs		Berkeley DB extension external subroutines
+cpan/DB_File/dbinfo		Berkeley DB database version checker
+cpan/DB_File/hints/dynixptx.pl	Hint for DB_File for named architecture
+cpan/DB_File/hints/sco.pl	Hint for DB_File for named architecture
+cpan/DB_File/Makefile.PL	Berkeley DB extension makefile writer
+cpan/DB_File/t/db-btree.t	See if DB_File works
+cpan/DB_File/t/db-hash.t	See if DB_File works
+cpan/DB_File/t/db-recno.t	See if DB_File works
+cpan/DB_File/typemap		Berkeley DB extension interface types
+cpan/DB_File/version.c		Berkeley DB extension interface version check
+cpan/Devel-PPPort/apicheck_c.PL		Devel::PPPort apicheck generator
+cpan/Devel-PPPort/Changes		Devel::PPPort changes
+cpan/Devel-PPPort/devel/buildperl.pl	Devel::PPPort perl version builder
+cpan/Devel-PPPort/devel/devtools.pl	Devel::PPPort development utilities
+cpan/Devel-PPPort/devel/mkapidoc.sh	Devel::PPPort apidoc collector
+cpan/Devel-PPPort/devel/mktodo		Devel::PPPort baseline/todo generator
+cpan/Devel-PPPort/devel/mktodo.pl	Devel::PPPort baseline/todo generator
+cpan/Devel-PPPort/devel/regenerate	Devel::PPPort API re-generator
+cpan/Devel-PPPort/devel/scanprov	Devel::PPPort provided API scanner
+cpan/Devel-PPPort/HACKERS		Devel::PPPort hackers documentation
+cpan/Devel-PPPort/Makefile.PL		Devel::PPPort makefile writer
+cpan/Devel-PPPort/MANIFEST.SKIP		Devel::PPPort Manifest skip specs
+cpan/Devel-PPPort/mktests.PL		Devel::PPPort test file writer
+cpan/Devel-PPPort/module2.c		Devel::PPPort test file
+cpan/Devel-PPPort/module3.c		Devel::PPPort test file
+cpan/Devel-PPPort/parts/apicheck.pl	Devel::PPPort apicheck generator
+cpan/Devel-PPPort/parts/apidoc.fnc	Devel::PPPort Perl API listing
+cpan/Devel-PPPort/parts/base/5004000	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5004010	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5004020	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5004030	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5004040	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5004050	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5005000	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5005010	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5005020	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5005030	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5005040	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5006000	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5006001	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5006002	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5007000	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5007001	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5007002	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5007003	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5008000	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5008001	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5008002	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5008003	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5008004	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5008005	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5008006	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5008007	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5008008	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5009000	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5009001	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5009002	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5009003	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5009004	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5009005	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5010000	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/base/5011000	Devel::PPPort baseline todo file
+cpan/Devel-PPPort/parts/embed.fnc	Devel::PPPort Perl API listing
+cpan/Devel-PPPort/parts/inc/call	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/cop		Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/exception	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/format	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/grok	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/gv		Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/HvNAME	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/limits	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/magic	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/memory	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/misc	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/mPUSH	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/MY_CXT	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/newCONSTSUB	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/newRV	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/newSVpv	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/newSV_type	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/podtest	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/ppphbin	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/ppphdoc	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/ppphtest	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/pvs		Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/pv_tools	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/shared_pv	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/snprintf	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/sprintf	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/strlfuncs	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/SvPV	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/SvREFCNT	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/Sv_set	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/sv_xpvf	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/threads	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/uv		Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/variables	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/version	Devel::PPPort include
+cpan/Devel-PPPort/parts/inc/warn	Devel::PPPort include
+cpan/Devel-PPPort/parts/ppport.fnc	Devel::PPPort API listing
+cpan/Devel-PPPort/parts/ppptools.pl	Devel::PPPort various utilities
+cpan/Devel-PPPort/parts/todo/5004000	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5004010	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5004020	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5004030	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5004040	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5004050	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5005000	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5005010	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5005020	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5005030	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5005040	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5006000	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5006001	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5006002	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5007000	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5007001	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5007002	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5007003	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5008000	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5008001	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5008002	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5008003	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5008004	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5008005	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5008006	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5008007	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5008008	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5009000	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5009001	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5009002	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5009003	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5009004	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5009005	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5010000	Devel::PPPort todo file
+cpan/Devel-PPPort/parts/todo/5011000	Devel::PPPort todo file
+cpan/Devel-PPPort/ppport_h.PL		Devel::PPPort ppport.h writer
+cpan/Devel-PPPort/PPPort_pm.PL		Devel::PPPort PPPort.pm writer
+cpan/Devel-PPPort/PPPort.xs		Devel::PPPort dummy PPPort.xs
+cpan/Devel-PPPort/PPPort_xs.PL		Devel::PPPort RealPPPort.xs writer
+cpan/Devel-PPPort/README		Devel::PPPort Readme
+cpan/Devel-PPPort/soak			Devel::PPPort Test Harness to run under various Perls
+cpan/Devel-PPPort/t/call.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/cop.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/exception.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/format.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/grok.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/gv.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/HvNAME.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/limits.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/magic.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/memory.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/misc.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/mPUSH.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/MY_CXT.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/newCONSTSUB.t	Devel::PPPort test file
+cpan/Devel-PPPort/t/newRV.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/newSVpv.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/newSV_type.t	Devel::PPPort test file
+cpan/Devel-PPPort/TODO			Devel::PPPort Todo
+cpan/Devel-PPPort/t/podtest.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/ppphtest.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/pvs.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/pv_tools.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/shared_pv.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/snprintf.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/sprintf.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/strlfuncs.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/SvPV.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/SvREFCNT.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/Sv_set.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/sv_xpvf.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/testutil.pl		Devel::PPPort test utilities
+cpan/Devel-PPPort/t/threads.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/uv.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/variables.t		Devel::PPPort test file
+cpan/Devel-PPPort/t/warn.t		Devel::PPPort test file
+cpan/Devel-PPPort/typemap		Devel::PPPort Typemap
+cpan/Digest/Changes		Digest changelog
+cpan/Digest/Digest/base.pm	Digest extensions
+cpan/Digest/Digest/file.pm	Digest extensions
+cpan/Digest/Digest.pm		Digest extensions
+cpan/Digest-MD5/Changes			Digest::MD5 extension changes
+cpan/Digest-MD5/hints/dec_osf.pl	Hints for named architecture
+cpan/Digest-MD5/hints/irix_6.pl		Hints for named architecture
+cpan/Digest-MD5/hints/MacOS.pl		Hints for named architecture
+cpan/Digest-MD5/Makefile.PL		Digest::MD5 extension makefile writer
+cpan/Digest-MD5/MD5.pm			Digest::MD5 extension
+cpan/Digest-MD5/MD5.xs			Digest::MD5 extension
+cpan/Digest-MD5/README			Digest::MD5 extension Readme
+cpan/Digest-MD5/t/align.t		See if Digest::MD5 extension works
+cpan/Digest-MD5/t/badfile.t		See if Digest::MD5 extension works
+cpan/Digest-MD5/t/bits.t		See if Digest::MD5 extension works
+cpan/Digest-MD5/t/clone.t		See if Digest::MD5 extension works
+cpan/Digest-MD5/t/files.t		See if Digest::MD5 extension works
+cpan/Digest-MD5/t/md5-aaa.t		See if Digest::MD5 extension works
+cpan/Digest-MD5/t/utf8.t		See if Digest::MD5 extension works
+cpan/Digest-MD5/typemap			Digest::MD5 extension
+cpan/Digest-SHA/Changes			Digest::SHA changes
+cpan/Digest-SHA/lib/Digest/SHA.pm	Digest::SHA extension
+cpan/Digest-SHA/Makefile.PL		Digest::SHA Makefile.PL
+cpan/Digest-SHA/README			Digest::SHA README
+cpan/Digest-SHA/shasum			shasum script
+cpan/Digest-SHA/SHA.xs			Digest::SHA extension
+cpan/Digest-SHA/src/hmac.c		Digest::SHA extension
+cpan/Digest-SHA/src/hmac.h		Digest::SHA extension
+cpan/Digest-SHA/src/hmacxtra.c		Digest::SHA extension
+cpan/Digest-SHA/src/sha64bit.c		Digest::SHA extension
+cpan/Digest-SHA/src/sha64bit.h		Digest::SHA extension
+cpan/Digest-SHA/src/sha.c		Digest::SHA extension
+cpan/Digest-SHA/src/sha.h		Digest::SHA extension
+cpan/Digest-SHA/src/shaxtra.c		Digest::SHA extension
+cpan/Digest-SHA/t/allfcns.t		See if Digest::SHA works
+cpan/Digest-SHA/t/base64.t		See if Digest::SHA works
+cpan/Digest-SHA/t/bitbuf.t		See if Digest::SHA works
+cpan/Digest-SHA/t/dumpload.t		See if Digest::SHA works
+cpan/Digest-SHA/t/fips198.t		See if Digest::SHA works
+cpan/Digest-SHA/t/gglong.t		See if Digest::SHA works
+cpan/Digest-SHA/t/gg.t			See if Digest::SHA works
+cpan/Digest-SHA/t/hmacsha.t		See if Digest::SHA works
+cpan/Digest-SHA/t/ireland.t		See if Digest::SHA works
+cpan/Digest-SHA/t/methods.t		See if Digest::SHA works
+cpan/Digest-SHA/t/nistbit.t		See if Digest::SHA works
+cpan/Digest-SHA/t/nistbyte.t		See if Digest::SHA works
+cpan/Digest-SHA/t/rfc2202.t		See if Digest::SHA works
+cpan/Digest-SHA/t/sha1.t		See if Digest::SHA works
+cpan/Digest-SHA/t/sha224.t		See if Digest::SHA works
+cpan/Digest-SHA/t/sha256.t		See if Digest::SHA works
+cpan/Digest-SHA/t/sha384.t		See if Digest::SHA works
+cpan/Digest-SHA/t/sha512.t		See if Digest::SHA works
+cpan/Digest-SHA/t/woodbury.t		See if Digest::SHA works
+cpan/Digest-SHA/typemap			Typemap for Digest::SHA
+cpan/Digest/t/base.t		See if Digest extensions work
+cpan/Digest/t/digest.t		See if Digest extensions work
+cpan/Digest/t/file.t		See if Digest extensions work
+cpan/Encode/AUTHORS		List of authors
+cpan/Encode/bin/enc2xs		Encode module generator
+cpan/Encode/bin/piconv		iconv by perl
+cpan/Encode/bin/ucm2table	Table Generator for testing
+cpan/Encode/bin/ucmlint		A UCM Lint utility
+cpan/Encode/bin/ucmsort		A UCM sort utility
+cpan/Encode/bin/unidump		Unicode Dump like hexdump(1)
+cpan/Encode/Byte/Byte.pm		Encode extension
+cpan/Encode/Byte/Makefile.PL	Encode extension
+cpan/Encode/Changes		Change Log
+cpan/Encode/CN/CN.pm		Encode extension
+cpan/Encode/CN/Makefile.PL	Encode extension
+cpan/Encode/EBCDIC/EBCDIC.pm	Encode extension
+cpan/Encode/EBCDIC/Makefile.PL	Encode extension
+cpan/Encode/encengine.c		Encode extension
+cpan/Encode/Encode/Changes.e2x	Skeleton file for enc2xs
+cpan/Encode/Encode/ConfigLocal_PM.e2x	Skeleton file for enc2xs
+cpan/Encode/Encode/encode.h	Encode extension header file
+cpan/Encode/Encode/Makefile_PL.e2x	Skeleton file for enc2xs
+cpan/Encode/Encode.pm		Mother of all Encode extensions
+cpan/Encode/Encode/_PM.e2x	Skeleton file for enc2xs
+cpan/Encode/Encode/README.e2x	Skeleton file for enc2xs
+cpan/Encode/Encode/_T.e2x	Skeleton file for enc2xs
+cpan/Encode/Encode.xs		Encode extension
+cpan/Encode/encoding.pm		Perl Pragmatic Module
+cpan/Encode/JP/JP.pm		Encode extension
+cpan/Encode/JP/Makefile.PL	Encode extension
+cpan/Encode/KR/KR.pm		Encode extension
+cpan/Encode/KR/Makefile.PL	Encode extension
+cpan/Encode/lib/Encode/Alias.pm	Encode extension
+cpan/Encode/lib/Encode/CJKConstants.pm	Encode extension
+cpan/Encode/lib/Encode/CN/HZ.pm		Encode extension
+cpan/Encode/lib/Encode/Config.pm	Encode configuration module
+cpan/Encode/lib/Encode/Encoder.pm	OO Encoder
+cpan/Encode/lib/Encode/Encoding.pm	Encode extension
+cpan/Encode/lib/Encode/GSM0338.pm	Encode extension
+cpan/Encode/lib/Encode/Guess.pm	Encode Extension
+cpan/Encode/lib/Encode/JP/H2Z.pm	Encode extension
+cpan/Encode/lib/Encode/JP/JIS7.pm	Encode extension
+cpan/Encode/lib/Encode/KR/2022_KR.pm	Encode extension
+cpan/Encode/lib/Encode/MIME/Header/ISO_2022_JP.pm	Encode extension
+cpan/Encode/lib/Encode/MIME/Header.pm	Encode extension
+cpan/Encode/lib/Encode/MIME/Name.pm	Encode extension
+cpan/Encode/lib/Encode/PerlIO.pod	Documents for Encode & PerlIO
+cpan/Encode/lib/Encode/Supported.pod	Documents for supported encodings
+cpan/Encode/lib/Encode/Unicode/UTF7.pm	Encode extension
+cpan/Encode/Makefile.PL			Encode extension makefile writer
+cpan/Encode/MANIFEST			Encode MANIFEST
+cpan/Encode/META.yml			Encode META.yml
+cpan/Encode/README			Encode extension
+cpan/Encode/Symbol/Makefile.PL		Encode extension
+cpan/Encode/Symbol/Symbol.pm		Encode extension
+cpan/Encode/t/Aliases.t			test script
+cpan/Encode/t/at-cn.t			test script
+cpan/Encode/t/at-tw.t			test script
+cpan/Encode/t/big5-eten.enc		test data
+cpan/Encode/t/big5-eten.utf		test data
+cpan/Encode/t/big5-hkscs.enc		test data
+cpan/Encode/t/big5-hkscs.utf		test data
+cpan/Encode/t/CJKT.t			test script
+cpan/Encode/t/enc_data.t		test script for utf8 DATA
+cpan/Encode/t/enc_eucjp.t		test script
+cpan/Encode/t/enc_module.enc		test data for t/enc_module.t
+cpan/Encode/t/enc_module.t		test script
+cpan/Encode/t/Encoder.t			test script
+cpan/Encode/t/Encode.t			test script
+cpan/Encode/t/encoding.t		test script
+cpan/Encode/t/enc_utf8.t		test script
+cpan/Encode/t/fallback.t		test script
+cpan/Encode/t/from_to.t			test script
+cpan/Encode/t/gb2312.enc		test data
+cpan/Encode/t/gb2312.utf		test data
+cpan/Encode/t/grow.t			test script
+cpan/Encode/t/gsm0338.t			test script
+cpan/Encode/t/guess.t			test script
+cpan/Encode/t/jis7-fallback.t		test script
+cpan/Encode/t/jisx0201.enc		test data
+cpan/Encode/t/jisx0201.utf		test data
+cpan/Encode/t/jisx0208.enc		test data
+cpan/Encode/t/jisx0208.utf		test data
+cpan/Encode/t/jisx0212.enc		test data
+cpan/Encode/t/jisx0212.utf		test data
+cpan/Encode/t/jperl.t			test script
+cpan/Encode/t/ksc5601.enc		test data
+cpan/Encode/t/ksc5601.utf		test data
+cpan/Encode/t/mime_header_iso2022jp.t	test script
+cpan/Encode/t/mime-header.t		test script
+cpan/Encode/t/mime-name.t		test script
+cpan/Encode/t/Mod_EUCJP.pm		module that t/enc_module.enc uses
+cpan/Encode/t/perlio.t			test script
+cpan/Encode/t/piconv.t			Test for piconv.t
+cpan/Encode/t/rt.pl			test script
+cpan/Encode/t/unibench.pl		benchmark script
+cpan/Encode/t/Unicode.t			test script
+cpan/Encode/t/utf8strict.t		test script
+cpan/Encode/TW/Makefile.PL		Encode extension
+cpan/Encode/TW/TW.pm			Encode extension
+cpan/Encode/ucm/8859-10.ucm		Unicode Character Map
+cpan/Encode/ucm/8859-11.ucm		Unicode Character Map
+cpan/Encode/ucm/8859-13.ucm		Unicode Character Map
+cpan/Encode/ucm/8859-14.ucm		Unicode Character Map
+cpan/Encode/ucm/8859-15.ucm		Unicode Character Map
+cpan/Encode/ucm/8859-16.ucm		Unicode Character Map
+cpan/Encode/ucm/8859-1.ucm		Unicode Character Map
+cpan/Encode/ucm/8859-2.ucm		Unicode Character Map
+cpan/Encode/ucm/8859-3.ucm		Unicode Character Map
+cpan/Encode/ucm/8859-4.ucm		Unicode Character Map
+cpan/Encode/ucm/8859-5.ucm		Unicode Character Map
+cpan/Encode/ucm/8859-6.ucm		Unicode Character Map
+cpan/Encode/ucm/8859-7.ucm		Unicode Character Map
+cpan/Encode/ucm/8859-8.ucm		Unicode Character Map
+cpan/Encode/ucm/8859-9.ucm		Unicode Character Map
+cpan/Encode/ucm/adobeStdenc.ucm		Unicode Character Map
+cpan/Encode/ucm/adobeSymbol.ucm		Unicode Character Map
+cpan/Encode/ucm/adobeZdingbat.ucm	Unicode Character Map
+cpan/Encode/ucm/ascii.ucm		Unicode Character Map
+cpan/Encode/ucm/big5-eten.ucm		Unicode Character Map
+cpan/Encode/ucm/big5-hkscs.ucm		Unicode Character Map
+cpan/Encode/ucm/cp037.ucm		Unicode Character Map
+cpan/Encode/ucm/cp1006.ucm		Unicode Character Map
+cpan/Encode/ucm/cp1026.ucm		Unicode Character Map
+cpan/Encode/ucm/cp1047.ucm		Unicode Character Map
+cpan/Encode/ucm/cp1250.ucm		Unicode Character Map
+cpan/Encode/ucm/cp1251.ucm		Unicode Character Map
+cpan/Encode/ucm/cp1252.ucm		Unicode Character Map
+cpan/Encode/ucm/cp1253.ucm		Unicode Character Map
+cpan/Encode/ucm/cp1254.ucm		Unicode Character Map
+cpan/Encode/ucm/cp1255.ucm		Unicode Character Map
+cpan/Encode/ucm/cp1256.ucm		Unicode Character Map
+cpan/Encode/ucm/cp1257.ucm		Unicode Character Map
+cpan/Encode/ucm/cp1258.ucm		Unicode Character Map
+cpan/Encode/ucm/cp424.ucm		Unicode Character Map
+cpan/Encode/ucm/cp437.ucm		Unicode Character Map
+cpan/Encode/ucm/cp500.ucm		Unicode Character Map
+cpan/Encode/ucm/cp737.ucm		Unicode Character Map
+cpan/Encode/ucm/cp775.ucm		Unicode Character Map
+cpan/Encode/ucm/cp850.ucm		Unicode Character Map
+cpan/Encode/ucm/cp852.ucm		Unicode Character Map
+cpan/Encode/ucm/cp855.ucm		Unicode Character Map
+cpan/Encode/ucm/cp856.ucm		Unicode Character Map
+cpan/Encode/ucm/cp857.ucm		Unicode Character Map
+cpan/Encode/ucm/cp858.ucm		Unicode Character Map
+cpan/Encode/ucm/cp860.ucm		Unicode Character Map
+cpan/Encode/ucm/cp861.ucm		Unicode Character Map
+cpan/Encode/ucm/cp862.ucm		Unicode Character Map
+cpan/Encode/ucm/cp863.ucm		Unicode Character Map
+cpan/Encode/ucm/cp864.ucm		Unicode Character Map
+cpan/Encode/ucm/cp865.ucm		Unicode Character Map
+cpan/Encode/ucm/cp866.ucm		Unicode Character Map
+cpan/Encode/ucm/cp869.ucm		Unicode Character Map
+cpan/Encode/ucm/cp874.ucm		Unicode Character Map
+cpan/Encode/ucm/cp875.ucm		Unicode Character Map
+cpan/Encode/ucm/cp932.ucm		Unicode Character Map
+cpan/Encode/ucm/cp936.ucm		Unicode Character Map
+cpan/Encode/ucm/cp949.ucm		Unicode Character Map
+cpan/Encode/ucm/cp950.ucm		Unicode Character Map
+cpan/Encode/ucm/ctrl.ucm		Unicode Character Map
+cpan/Encode/ucm/dingbats.ucm		Unicode Character Map
+cpan/Encode/ucm/euc-cn.ucm		Unicode Character Map
+cpan/Encode/ucm/euc-jp.ucm		Unicode Character Map
+cpan/Encode/ucm/euc-kr.ucm		Unicode Character Map
+cpan/Encode/ucm/gb12345.ucm		Unicode Character Map
+cpan/Encode/ucm/gb2312.ucm		Unicode Character Map
+cpan/Encode/ucm/hp-roman8.ucm		Unicode Character Map
+cpan/Encode/ucm/ir-165.ucm		Unicode Character Map
+cpan/Encode/ucm/jis0201.ucm		Unicode Character Map
+cpan/Encode/ucm/jis0208.ucm		Unicode Character Map
+cpan/Encode/ucm/jis0212.ucm		Unicode Character Map
+cpan/Encode/ucm/johab.ucm		Unicode Character Map
+cpan/Encode/ucm/koi8-f.ucm		Unicode Character Map
+cpan/Encode/ucm/koi8-r.ucm		Unicode Character Map
+cpan/Encode/ucm/koi8-u.ucm		Unicode Character Map
+cpan/Encode/ucm/ksc5601.ucm		Unicode Character Map
+cpan/Encode/ucm/macArabic.ucm		Unicode Character Map
+cpan/Encode/ucm/macCentEuro.ucm		Unicode Character Map
+cpan/Encode/ucm/macChinsimp.ucm		Unicode Character Map
+cpan/Encode/ucm/macChintrad.ucm		Unicode Character Map
+cpan/Encode/ucm/macCroatian.ucm		Unicode Character Map
+cpan/Encode/ucm/macCyrillic.ucm		Unicode Character Map
+cpan/Encode/ucm/macDingbats.ucm		Unicode Character Map
+cpan/Encode/ucm/macFarsi.ucm		Unicode Character Map
+cpan/Encode/ucm/macGreek.ucm		Unicode Character Map
+cpan/Encode/ucm/macHebrew.ucm		Unicode Character Map
+cpan/Encode/ucm/macIceland.ucm		Unicode Character Map
+cpan/Encode/ucm/macJapanese.ucm		Unicode Character Map
+cpan/Encode/ucm/macKorean.ucm		Unicode Character Map
+cpan/Encode/ucm/macRoman.ucm		Unicode Character Map
+cpan/Encode/ucm/macROMnn.ucm		Unicode Character Map
+cpan/Encode/ucm/macRUMnn.ucm		Unicode Character Map
+cpan/Encode/ucm/macSami.ucm		Unicode Character Map
+cpan/Encode/ucm/macSymbol.ucm		Unicode Character Map
+cpan/Encode/ucm/macThai.ucm		Unicode Character Map
+cpan/Encode/ucm/macTurkish.ucm		Unicode Character Map
+cpan/Encode/ucm/macUkraine.ucm		Unicode Character Map
+cpan/Encode/ucm/nextstep.ucm		Unicode Character Map
+cpan/Encode/ucm/null.ucm		Unicode Character Map
+cpan/Encode/ucm/posix-bc.ucm		Unicode Character Map
+cpan/Encode/ucm/shiftjis.ucm		Unicode Character Map
+cpan/Encode/ucm/symbol.ucm		Unicode Character Map
+cpan/Encode/ucm/viscii.ucm		Unicode Character Map
+cpan/Encode/Unicode/Makefile.PL		Encode extension
+cpan/Encode/Unicode/Unicode.pm		Encode extension
+cpan/Encode/Unicode/Unicode.xs		Encode extension
+cpan/encoding-warnings/Changes		Changelog for encoding::warnings
+cpan/encoding-warnings/lib/encoding/warnings.pm	warn on implicit encoding conversions
+cpan/encoding-warnings/t/1-warning.t	tests for encoding::warnings
+cpan/encoding-warnings/t/2-fatal.t	tests for encoding::warnings
+cpan/encoding-warnings/t/3-normal.t	tests for encoding::warnings
+cpan/encoding-warnings/t/4-lexical.t	tests for encoding::warnings
+cpan/ExtUtils-CBuilder/Changes					Changes for ExtUtils::CBuilder
+cpan/ExtUtils-CBuilder/lib/ExtUtils/CBuilder/Base.pm		Base class for ExtUtils::CBuilder methods
+cpan/ExtUtils-CBuilder/lib/ExtUtils/CBuilder/Platform/aix.pm	CBuilder methods for AIX
+cpan/ExtUtils-CBuilder/lib/ExtUtils/CBuilder/Platform/cygwin.pm	CBuilder methods for cygwin
+cpan/ExtUtils-CBuilder/lib/ExtUtils/CBuilder/Platform/darwin.pm	CBuilder methods for darwin
+cpan/ExtUtils-CBuilder/lib/ExtUtils/CBuilder/Platform/dec_osf.pm	CBuilder methods for OSF
+cpan/ExtUtils-CBuilder/lib/ExtUtils/CBuilder/Platform/os2.pm	CBuilder methods for OS/2
+cpan/ExtUtils-CBuilder/lib/ExtUtils/CBuilder/Platform/Unix.pm	CBuilder methods for Unix
+cpan/ExtUtils-CBuilder/lib/ExtUtils/CBuilder/Platform/VMS.pm	CBuilder methods for VMS
+cpan/ExtUtils-CBuilder/lib/ExtUtils/CBuilder/Platform/Windows/BCC.pm	CBuilder methods for Windows
+cpan/ExtUtils-CBuilder/lib/ExtUtils/CBuilder/Platform/Windows/GCC.pm	CBuilder methods for Windows
+cpan/ExtUtils-CBuilder/lib/ExtUtils/CBuilder/Platform/Windows/MSVC.pm	CBuilder methods for Windows
+cpan/ExtUtils-CBuilder/lib/ExtUtils/CBuilder/Platform/Windows.pm	CBuilder methods for Windows
+cpan/ExtUtils-CBuilder/lib/ExtUtils/CBuilder.pm			Compile and link C code for Perl modules
+cpan/ExtUtils-CBuilder/t/00-have-compiler.t			ExtUtils::CBuilder tests
+cpan/ExtUtils-CBuilder/t/01-basic.t				tests for ExtUtils::CBuilder
+cpan/ExtUtils-CBuilder/t/02-link.t				tests for ExtUtils::CBuilder
+cpan/ExtUtils-CBuilder/t/03-cplusplus.t				tests for ExtUtils::CBuilder
+cpan/ExtUtils-Command/lib/ExtUtils/Command.pm	Utilities for Make on non-UNIX platforms
+cpan/ExtUtils-Command/t/cp.t			See if ExtUtils::Command works
+cpan/ExtUtils-Command/t/eu_command.t		See if ExtUtils::Command works
+cpan/ExtUtils-Command/t/lib/TieOut.pm		Testing library to capture prints
+cpan/ExtUtils-Constant/lib/ExtUtils/Constant/Base.pm		generate XS code to import C header constants
+cpan/ExtUtils-Constant/lib/ExtUtils/Constant.pm			generate XS code to import C header constants
+cpan/ExtUtils-Constant/lib/ExtUtils/Constant/ProxySubs.pm	generate XS code for proxy constants
+cpan/ExtUtils-Constant/lib/ExtUtils/Constant/Utils.pm		generate XS code to import C header constants
+cpan/ExtUtils-Constant/lib/ExtUtils/Constant/XS.pm		generate XS code to import C header constants
+cpan/ExtUtils-Constant/t/Constant.t				See if ExtUtils::Constant works
+cpan/ExtUtils-MakeMaker/bin/instmodsh				Give information about installed extensions
+cpan/ExtUtils-MakeMaker/Changes					MakeMaker change log
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/Command/MM.pm		Calling MM functions from the cmd line
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/Liblist/Kid.pm		Does the real work of the above
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/Liblist.pm			Locates libraries
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MakeMaker/Config.pm	MakeMaker wrapper for Config
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MakeMaker/FAQ.pod		MakeMaker FAQ
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MakeMaker.pm		Write Makefiles for extensions
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MakeMaker/Tutorial.pod	Writing a module with MakeMaker
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/Mkbootstrap.pm		Writes a bootstrap file (see MakeMaker)
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/Mksymlists.pm		Writes a linker options file for extensions
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_AIX.pm			MakeMaker methods for AIX
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_Any.pm			MakeMaker methods for Any OS
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_BeOS.pm			MakeMaker methods for BeOS
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_Cygwin.pm		MakeMaker methods for Cygwin
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_Darwin.pm		MakeMaker methods for Darwin
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_DOS.pm			MakeMaker methods for DOS
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_MacOS.pm		MakeMaker methods for MacOS
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_NW5.pm			MakeMaker methods for NetWare
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_OS2.pm			MakeMaker methods for OS/2
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM.pm			MakeMaker adaptor class
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_QNX.pm			MakeMaker methods for QNX
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_Unix.pm			MakeMaker methods for Unix
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_UWIN.pm			MakeMaker methods for U/WIN
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_VMS.pm			MakeMaker methods for VMS
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_VOS.pm			MakeMaker methods for VOS
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_Win32.pm		MakeMaker methods for Win32
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_Win95.pm		MakeMaker methods for Win95
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/MY.pm			MakeMaker user override class
+cpan/ExtUtils-MakeMaker/lib/ExtUtils/testlib.pm			Fixes up @INC to use just-built extension
+cpan/ExtUtils-MakeMaker/MANIFEST				ExtUtils::MakeMaker MANIFEST
+cpan/ExtUtils-MakeMaker/NOTES					Notes about MakeMaker internals
+cpan/ExtUtils-MakeMaker/PATCHING				Suggestions for patching MakeMaker
+cpan/ExtUtils-MakeMaker/README					MakeMaker README
+cpan/ExtUtils-MakeMaker/t/00compile.t				See if MakeMaker modules compile
+cpan/ExtUtils-MakeMaker/t/arch_check.t				Test MakeMaker's arch_check()
+cpan/ExtUtils-MakeMaker/t/backwards.t				Check MakeMaker's backwards compatibility
+cpan/ExtUtils-MakeMaker/t/basic.t				See if MakeMaker can build a module
+cpan/ExtUtils-MakeMaker/t/build_man.t				Set if MakeMaker builds manpages
+cpan/ExtUtils-MakeMaker/t/cd.t					Test to see cd works
+cpan/ExtUtils-MakeMaker/t/config.t				Test ExtUtils::MakeMaker::Config
+cpan/ExtUtils-MakeMaker/t/dir_target.t				Verify if dir_target() is supported
+cpan/ExtUtils-MakeMaker/t/FIRST_MAKEFILE.t			See if FIRST_MAKEFILE works
+cpan/ExtUtils-MakeMaker/t/fixin.t				See if ExtUtils::MakeMaker works
+cpan/ExtUtils-MakeMaker/t/fix_libs.t				Test for ExtUtils::MakeMaker
+cpan/ExtUtils-MakeMaker/t/hints.t				See if hint files are honored.
+cpan/ExtUtils-MakeMaker/t/INSTALL_BASE.t			Test INSTALL_BASE in MakeMaker
+cpan/ExtUtils-MakeMaker/t/installed_file.t			Test for ExtUtils::MakeMaker
+cpan/ExtUtils-MakeMaker/t/INST_PREFIX.t				See if MakeMaker can apply PREFIXs
+cpan/ExtUtils-MakeMaker/t/INST.t				Check MakeMaker INST_* macros
+cpan/ExtUtils-MakeMaker/t/is_of_type.t				Test for ExtUtils::MakeMaker
+cpan/ExtUtils-MakeMaker/t/Liblist.t				See if ExtUtils::Liblist works
+cpan/ExtUtils-MakeMaker/t/lib/MakeMaker/Test/NoXS.pm		MakeMaker test utilities
+cpan/ExtUtils-MakeMaker/t/lib/MakeMaker/Test/Setup/BFD.pm	MakeMaker test utilities
+cpan/ExtUtils-MakeMaker/t/lib/MakeMaker/Test/Setup/MPV.pm	MakeMaker test utilities
+cpan/ExtUtils-MakeMaker/t/lib/MakeMaker/Test/Setup/PL_FILES.pm	MakeMaker test utilities
+cpan/ExtUtils-MakeMaker/t/lib/MakeMaker/Test/Setup/Problem.pm	MakeMaker test utilities
+cpan/ExtUtils-MakeMaker/t/lib/MakeMaker/Test/Setup/Recurs.pm	MakeMaker test utilities
+cpan/ExtUtils-MakeMaker/t/lib/MakeMaker/Test/Setup/XS.pm	MakeMaker test utilities
+cpan/ExtUtils-MakeMaker/t/lib/MakeMaker/Test/Utils.pm		MakeMaker test utilities
+cpan/ExtUtils-MakeMaker/t/lib/TieIn.pm				Testing library for dummy input handles
+cpan/ExtUtils-MakeMaker/t/lib/TieOut.pm				Testing library to capture prints
+cpan/ExtUtils-MakeMaker/t/MakeMaker_Parameters.t		test "MakeMaker Parameters" section
+cpan/ExtUtils-MakeMaker/t/make.t				See if make detection works
+cpan/ExtUtils-MakeMaker/t/maketext_filter.t			See if maketext_filter works
+cpan/ExtUtils-MakeMaker/t/metafile_data.t			See if META.yml handling works
+cpan/ExtUtils-MakeMaker/t/metafile_file.t			See if META.yml handling works
+cpan/ExtUtils-MakeMaker/t/miniperl.t				Test MakeMaker with miniperl
+cpan/ExtUtils-MakeMaker/t/min_perl_version.t			Test the MIN_PERL_VERSION argument to WriteMakefile.
+cpan/ExtUtils-MakeMaker/t/Mkbootstrap.t				See if ExtUtils::Mkbootstrap works
+cpan/ExtUtils-MakeMaker/t/MM_Any.t				See if ExtUtils::MM_Any works
+cpan/ExtUtils-MakeMaker/t/MM_BeOS.t				See if ExtUtils::MM_BeOS works
+cpan/ExtUtils-MakeMaker/t/MM_Cygwin.t				See if ExtUtils::MM_Cygwin works
+cpan/ExtUtils-MakeMaker/t/MM_NW5.t				See if ExtUtils::MM_NW5 works
+cpan/ExtUtils-MakeMaker/t/MM_OS2.t				See if ExtUtils::MM_OS2 works
+cpan/ExtUtils-MakeMaker/t/MM_Unix.t				See if ExtUtils::MM_UNIX works
+cpan/ExtUtils-MakeMaker/t/MM_VMS.t				See if ExtUtils::MM_VMS works
+cpan/ExtUtils-MakeMaker/t/MM_Win32.t				See if ExtUtils::MM_Win32 works
+cpan/ExtUtils-MakeMaker/TODO					Things TODO in MakeMaker
+cpan/ExtUtils-MakeMaker/t/oneliner.t				See if MM can generate perl one-liners
+cpan/ExtUtils-MakeMaker/t/parse_version.t			See if parse_version works
+cpan/ExtUtils-MakeMaker/t/PL_FILES.t				Test PL_FILES in MakeMaker
+cpan/ExtUtils-MakeMaker/t/pm.t					See if MakeMaker can handle PM
+cpan/ExtUtils-MakeMaker/t/pm_to_blib.t				Test for ExtUtils::MakeMaker
+cpan/ExtUtils-MakeMaker/t/pod2man.t				See if MakeMaker can handle no pod2man
+cpan/ExtUtils-MakeMaker/t/postamble.t				See if postamble works
+cpan/ExtUtils-MakeMaker/t/prefixify.t				See if MakeMaker can apply a PREFIX
+cpan/ExtUtils-MakeMaker/t/prereq_print.t				See if PREREQ_PRINT works
+cpan/ExtUtils-MakeMaker/t/prereq.t				See if MakeMaker works
+cpan/ExtUtils-MakeMaker/t/problems.t				How MakeMaker reacts to build problems
+cpan/ExtUtils-MakeMaker/t/prompt.t				See if E::MM::prompt() works
+cpan/ExtUtils-MakeMaker/t/recurs.t				See if recursive builds work
+cpan/ExtUtils-MakeMaker/t/revision.t				See if $Revision is correct
+cpan/ExtUtils-MakeMaker/t/split_command.t			See if MM's xargs-like function works
+cpan/ExtUtils-MakeMaker/t/test_boilerplate.t			MakeMaker test
+cpan/ExtUtils-MakeMaker/t/testdata/reallylongdirectoryname/arch1/Config.pm	test data for MakeMaker
+cpan/ExtUtils-MakeMaker/t/testdata/reallylongdirectoryname/arch2/Config.pm	test data for MakeMaker
+cpan/ExtUtils-MakeMaker/t/testlib.t				See if ExtUtils::testlib works
+cpan/ExtUtils-MakeMaker/t/VERSION_FROM.t			See if MakeMaker's VERSION_FROM works
+cpan/ExtUtils-MakeMaker/t/WriteEmptyMakefile.t			See if WriteEmptyMakefile works
+cpan/ExtUtils-MakeMaker/t/writemakefile_args.t			See if WriteMakefile works
+cpan/ExtUtils-MakeMaker/t/xs.t					Part of MakeMaker's test suite
+cpan/ExtUtils-Manifest/lib/ExtUtils/Manifest.pm			Utilities to write MANIFEST files
+cpan/ExtUtils-Manifest/lib/ExtUtils/MANIFEST.SKIP		The default MANIFEST.SKIP
+cpan/ExtUtils-Manifest/t/Manifest.t				See if ExtUtils::Manifest works
+cpan/ExtUtils-ParseXS/Changes			ExtUtils::ParseXS change log
+cpan/ExtUtils-ParseXS/lib/ExtUtils/ParseXS.pm	converts Perl XS code into C code
+cpan/ExtUtils-ParseXS/lib/ExtUtils/xsubpp	External subroutine preprocessor
+cpan/ExtUtils-ParseXS/t/basic.t			See if ExtUtils::ParseXS works
+cpan/ExtUtils-ParseXS/t/more.t			Extended ExtUtils::ParseXS testing
+cpan/ExtUtils-ParseXS/t/typemap			Standard typemap for controlled testing
+cpan/ExtUtils-ParseXS/t/usage.t			ExtUtils::ParseXS tests
+cpan/ExtUtils-ParseXS/t/XSInclude.xsh		Test file for ExtUtils::ParseXS tests
+cpan/ExtUtils-ParseXS/t/XSMore.xs		Test file for ExtUtils::ParseXS tests
+cpan/ExtUtils-ParseXS/t/XSTest.pm		Test file for ExtUtils::ParseXS tests
+cpan/ExtUtils-ParseXS/t/XSTest.xs		Test file for ExtUtils::ParseXS tests
+cpan/ExtUtils-ParseXS/t/XSUsage.pm		ExtUtils::ParseXS tests
+cpan/ExtUtils-ParseXS/t/XSUsage.xs		ExtUtils::ParseXS tests
+cpan/File-Fetch/lib/File/Fetch.pm	File::Fetch
+cpan/File-Fetch/t/01_File-Fetch.t	File::Fetch tests
+cpan/File-Fetch/t/null_subclass.t
+cpan/File-Path/lib/File/Path.pm		Do things like 'mkdir -p' and 'rm -r'
+cpan/File-Path/t/Path.t			See if File::Path works
+cpan/File-Path/t/taint.t		See if File::Path works with -T
+cpan/File-Temp/t/cmp.t		See if File::Temp works
+cpan/File-Temp/Temp.pm		create safe temporary files and file handles
+cpan/File-Temp/t/fork.t		See if File::Temp works
+cpan/File-Temp/t/lock.t		See if File::Temp works
+cpan/File-Temp/t/mktemp.t	See if File::Temp works
+cpan/File-Temp/t/object.t	See if File::Temp works
+cpan/File-Temp/t/posix.t	See if File::Temp works
+cpan/File-Temp/t/security.t	See if File::Temp works
+cpan/File-Temp/t/seekable.t	See if File::Temp works
+cpan/File-Temp/t/tempfile.t	See if File::Temp works
+cpan/Filter-Util-Call/Call.pm	Filter::Util::Call extension module
+cpan/Filter-Util-Call/Call.xs	Filter::Util::Call extension external subroutines
+cpan/Filter-Util-Call/filter-util.pl		See if Filter::Util::Call works
+cpan/Filter-Util-Call/t/call.t	See if Filter::Util::Call works
+cpan/Getopt-Long/CHANGES		Getopt::Long changes
+cpan/Getopt-Long/lib/Getopt/Long.pm	Fetch command options (GetOptions)
+cpan/Getopt-Long/README			Getopt::Long README
+cpan/Getopt-Long/t/gol-basic.t		See if Getopt::Long works
+cpan/Getopt-Long/t/gol-compat.t		See if Getopt::Long works
+cpan/Getopt-Long/t/gol-linkage.t	See if Getopt::Long works
+cpan/Getopt-Long/t/gol-oo.t		See if Getopt::Long works
+cpan/Getopt-Long/t/gol-xargv.t		See if Getopt::Long works
+cpan/Getopt-Long/t/gol-xstring.t	See if Getopt::Long works
+cpan/if/if.pm			For "use if"
+cpan/if/t/if.t			Tests for "use if"
+cpan/IO-Compress/Changes				IO::Compress
+cpan/IO-Compress/examples/compress-zlib/filtdef		IO::Compress
+cpan/IO-Compress/examples/compress-zlib/filtinf		IO::Compress
+cpan/IO-Compress/examples/compress-zlib/gzcat		IO::Compress
+cpan/IO-Compress/examples/compress-zlib/gzgrep		IO::Compress
+cpan/IO-Compress/examples/compress-zlib/gzstream	IO::Compress
+cpan/IO-Compress/examples/io/anycat			IO::Compress
+cpan/IO-Compress/examples/io/bzip2/bzcat		IO::Compress
+cpan/IO-Compress/examples/io/bzip2/bzgrep		IO::Compress
+cpan/IO-Compress/examples/io/bzip2/bzstream		IO::Compress
+cpan/IO-Compress/examples/io/gzip/gzappend		IO::Compress
+cpan/IO-Compress/examples/io/gzip/gzcat			IO::Compress
+cpan/IO-Compress/examples/io/gzip/gzgrep		IO::Compress
+cpan/IO-Compress/examples/io/gzip/gzstream		IO::Compress
+cpan/IO-Compress/lib/Compress/Zlib.pm			IO::Compress
+cpan/IO-Compress/lib/File/GlobMapper.pm			IO::Compress
+cpan/IO-Compress/lib/IO/Compress/Adapter/Bzip2.pm	IO::Compress
+cpan/IO-Compress/lib/IO/Compress/Adapter/Deflate.pm	IO::Compress
+cpan/IO-Compress/lib/IO/Compress/Adapter/Identity.pm	IO::Compress
+cpan/IO-Compress/lib/IO/Compress/Base/Common.pm		IO::Compress
+cpan/IO-Compress/lib/IO/Compress/Base.pm		IO::Compress
+cpan/IO-Compress/lib/IO/Compress/Bzip2.pm		IO::Compress
+cpan/IO-Compress/lib/IO/Compress/Deflate.pm		IO::Compress
+cpan/IO-Compress/lib/IO/Compress/Gzip/Constants.pm	IO::Compress
+cpan/IO-Compress/lib/IO/Compress/Gzip.pm		IO::Compress
+cpan/IO-Compress/lib/IO/Compress/RawDeflate.pm		IO::Compress
+cpan/IO-Compress/lib/IO/Compress/Zip/Constants.pm	IO::Compress
+cpan/IO-Compress/lib/IO/Compress/Zip.pm			IO::Compress
+cpan/IO-Compress/lib/IO/Compress/Zlib/Constants.pm	IO::Compress
+cpan/IO-Compress/lib/IO/Compress/Zlib/Extra.pm		IO::Compress
+cpan/IO-Compress/lib/IO/Uncompress/Adapter/Bunzip2.pm	IO::Compress
+cpan/IO-Compress/lib/IO/Uncompress/Adapter/Identity.pm	IO::Compress
+cpan/IO-Compress/lib/IO/Uncompress/Adapter/Inflate.pm	IO::Compress
+cpan/IO-Compress/lib/IO/Uncompress/AnyInflate.pm	IO::Compress
+cpan/IO-Compress/lib/IO/Uncompress/AnyUncompress.pm	IO::Compress
+cpan/IO-Compress/lib/IO/Uncompress/Base.pm		IO::Compress
+cpan/IO-Compress/lib/IO/Uncompress/Bunzip2.pm		IO::Compress
+cpan/IO-Compress/lib/IO/Uncompress/Gunzip.pm		IO::Compress
+cpan/IO-Compress/lib/IO/Uncompress/Inflate.pm		IO::Compress
+cpan/IO-Compress/lib/IO/Uncompress/RawInflate.pm	IO::Compress
+cpan/IO-Compress/lib/IO/Uncompress/Unzip.pm		IO::Compress
+cpan/IO-Compress/Makefile.PL				IO::Compress
+cpan/IO-Compress/pod/FAQ.pod				IO::Compress
+cpan/IO-Compress/private/MakeUtil.pm			IO::Compress
+cpan/IO-Compress/README					IO::Compress
+cpan/IO-Compress/t/000prereq.t				IO::Compress
+cpan/IO-Compress/t/001bzip2.t				IO::Compress
+cpan/IO-Compress/t/001zlib-generic-deflate.t		IO::Compress
+cpan/IO-Compress/t/001zlib-generic-gzip.t		IO::Compress
+cpan/IO-Compress/t/001zlib-generic-rawdeflate.t		IO::Compress
+cpan/IO-Compress/t/001zlib-generic-zip.t		IO::Compress
+cpan/IO-Compress/t/002any-deflate.t			IO::Compress
+cpan/IO-Compress/t/002any-gzip.t			IO::Compress
+cpan/IO-Compress/t/002any-rawdeflate.t			IO::Compress
+cpan/IO-Compress/t/002any-transparent.t			IO::Compress
+cpan/IO-Compress/t/002any-zip.t				IO::Compress
+cpan/IO-Compress/t/004gziphdr.t				IO::Compress
+cpan/IO-Compress/t/005defhdr.t				IO::Compress
+cpan/IO-Compress/t/006zip.t				IO::Compress
+cpan/IO-Compress/t/010examples-bzip2.t			IO::Compress
+cpan/IO-Compress/t/010examples-zlib.t			IO::Compress
+cpan/IO-Compress/t/01misc.t				IO::Compress
+cpan/IO-Compress/t/020isize.t				IO::Compress
+cpan/IO-Compress/t/050interop-gzip.t			IO::Compress
+cpan/IO-Compress/t/100generic-bzip2.t			IO::Compress
+cpan/IO-Compress/t/100generic-deflate.t			IO::Compress
+cpan/IO-Compress/t/100generic-gzip.t			IO::Compress
+cpan/IO-Compress/t/100generic-rawdeflate.t		IO::Compress
+cpan/IO-Compress/t/100generic-zip.t			IO::Compress
+cpan/IO-Compress/t/101truncate-bzip2.t			IO::Compress
+cpan/IO-Compress/t/101truncate-deflate.t		IO::Compress
+cpan/IO-Compress/t/101truncate-gzip.t			IO::Compress
+cpan/IO-Compress/t/101truncate-rawdeflate.t		IO::Compress
+cpan/IO-Compress/t/101truncate-zip.t			IO::Compress
+cpan/IO-Compress/t/102tied-bzip2.t			IO::Compress
+cpan/IO-Compress/t/102tied-deflate.t			IO::Compress
+cpan/IO-Compress/t/102tied-gzip.t			IO::Compress
+cpan/IO-Compress/t/102tied-rawdeflate.t			IO::Compress
+cpan/IO-Compress/t/102tied-zip.t			IO::Compress
+cpan/IO-Compress/t/103newtied-bzip2.t			IO::Compress
+cpan/IO-Compress/t/103newtied-deflate.t			IO::Compress
+cpan/IO-Compress/t/103newtied-gzip.t			IO::Compress
+cpan/IO-Compress/t/103newtied-rawdeflate.t		IO::Compress
+cpan/IO-Compress/t/103newtied-zip.t			IO::Compress
+cpan/IO-Compress/t/104destroy-bzip2.t			IO::Compress
+cpan/IO-Compress/t/104destroy-deflate.t			IO::Compress
+cpan/IO-Compress/t/104destroy-gzip.t			IO::Compress
+cpan/IO-Compress/t/104destroy-rawdeflate.t		IO::Compress
+cpan/IO-Compress/t/104destroy-zip.t			IO::Compress
+cpan/IO-Compress/t/105oneshot-bzip2.t			IO::Compress
+cpan/IO-Compress/t/105oneshot-deflate.t			IO::Compress
+cpan/IO-Compress/t/105oneshot-gzip-only.t		IO::Compress
+cpan/IO-Compress/t/105oneshot-gzip.t			IO::Compress
+cpan/IO-Compress/t/105oneshot-rawdeflate.t		IO::Compress
+cpan/IO-Compress/t/105oneshot-zip-bzip2-only.t		IO::Compress
+cpan/IO-Compress/t/105oneshot-zip-only.t		IO::Compress
+cpan/IO-Compress/t/105oneshot-zip.t			IO::Compress
+cpan/IO-Compress/t/106prime-bzip2.t			IO::Compress
+cpan/IO-Compress/t/106prime-deflate.t			IO::Compress
+cpan/IO-Compress/t/106prime-gzip.t			IO::Compress
+cpan/IO-Compress/t/106prime-rawdeflate.t		IO::Compress
+cpan/IO-Compress/t/106prime-zip.t			IO::Compress
+cpan/IO-Compress/t/107multi-bzip2.t			IO::Compress
+cpan/IO-Compress/t/107multi-deflate.t			IO::Compress
+cpan/IO-Compress/t/107multi-gzip.t			IO::Compress
+cpan/IO-Compress/t/107multi-rawdeflate.t		IO::Compress
+cpan/IO-Compress/t/107multi-zip.t			IO::Compress
+cpan/IO-Compress/t/108anyunc-bzip2.t			IO::Compress
+cpan/IO-Compress/t/108anyunc-deflate.t			IO::Compress
+cpan/IO-Compress/t/108anyunc-gzip.t			IO::Compress
+cpan/IO-Compress/t/108anyunc-rawdeflate.t		IO::Compress
+cpan/IO-Compress/t/108anyunc-transparent.t		IO::Compress
+cpan/IO-Compress/t/108anyunc-zip.t			IO::Compress
+cpan/IO-Compress/t/109merge-deflate.t			IO::Compress
+cpan/IO-Compress/t/109merge-gzip.t			IO::Compress
+cpan/IO-Compress/t/109merge-rawdeflate.t		IO::Compress
+cpan/IO-Compress/t/109merge-zip.t			IO::Compress
+cpan/IO-Compress/t/110encode-bzip2.t			IO::Compress
+cpan/IO-Compress/t/110encode-deflate.t			IO::Compress
+cpan/IO-Compress/t/110encode-gzip.t			IO::Compress
+cpan/IO-Compress/t/110encode-rawdeflate.t		IO::Compress
+cpan/IO-Compress/t/110encode-zip.t			IO::Compress
+cpan/IO-Compress/t/999pod.t				IO::Compress
+cpan/IO-Compress/t/compress/any.pl			Compress::Zlib
+cpan/IO-Compress/t/compress/anyunc.pl			Compress::Zlib
+cpan/IO-Compress/t/compress/CompTestUtils.pm		Compress::Zlib
+cpan/IO-Compress/t/compress/destroy.pl			Compress::Zlib
+cpan/IO-Compress/t/compress/encode.pl			Compress::Zlib
+cpan/IO-Compress/t/compress/generic.pl			Compress::Zlib
+cpan/IO-Compress/t/compress/merge.pl			Compress::Zlib
+cpan/IO-Compress/t/compress/multi.pl			Compress::Zlib
+cpan/IO-Compress/t/compress/newtied.pl			Compress::Zlib
+cpan/IO-Compress/t/compress/oneshot.pl			Compress::Zlib
+cpan/IO-Compress/t/compress/prime.pl			Compress::Zlib
+cpan/IO-Compress/t/compress/tied.pl			Compress::Zlib
+cpan/IO-Compress/t/compress/truncate.pl			Compress::Zlib
+cpan/IO-Compress/t/compress/zlib-generic.pl		Compress::Zlib
+cpan/IO-Compress/t/cz-01version.t			IO::Compress
+cpan/IO-Compress/t/cz-03zlib-v1.t			IO::Compress
+cpan/IO-Compress/t/cz-05examples.t			IO::Compress
+cpan/IO-Compress/t/cz-06gzsetp.t			IO::Compress
+cpan/IO-Compress/t/cz-08encoding.t			IO::Compress
+cpan/IO-Compress/t/cz-14gzopen.t			IO::Compress
+cpan/IO-Compress/t/globmapper.t				IO::Compress
+cpan/IO-Zlib/t/basic.t		Tests for IO::Zlib
+cpan/IO-Zlib/t/external.t	Tests for IO::Zlib
+cpan/IO-Zlib/t/getc.t		Tests for IO::Zlib
+cpan/IO-Zlib/t/getline.t	Tests for IO::Zlib
+cpan/IO-Zlib/t/import.t		Tests for IO::Zlib
+cpan/IO-Zlib/t/large.t		Tests for IO::Zlib
+cpan/IO-Zlib/t/tied.t		Tests for IO::Zlib
+cpan/IO-Zlib/t/uncomp1.t	Tests for IO::Zlib
+cpan/IO-Zlib/t/uncomp2.t	Tests for IO::Zlib
+cpan/IO-Zlib/Zlib.pm		IO::Zlib
+cpan/IPC-Cmd/lib/IPC/Cmd.pm			IPC::Cmd
+cpan/IPC-Cmd/t/01_IPC-Cmd.t	IPC::Cmd tests
+cpan/IPC-Cmd/t/02_Interactive.t	IPC::Cmd tests
+cpan/IPC-Cmd/t/src/child.pl	IPC::Cmd tests
+cpan/IPC-Cmd/t/src/output.pl	IPC::Cmd tests
+cpan/IPC-Cmd/t/src/x.tgz	IPC::Cmd tests
+cpan/IPC-SysV/Changes			IPC::SysV changes
+cpan/IPC-SysV/hints/cygwin.pl		Hint for IPC::SysV for named architecture
+cpan/IPC-SysV/hints/next_3.pl		Hint for IPC::SysV for named architecture
+cpan/IPC-SysV/lib/IPC/Msg.pm		IPC::SysV extension Perl module
+cpan/IPC-SysV/lib/IPC/Semaphore.pm	IPC::SysV extension Perl module
+cpan/IPC-SysV/lib/IPC/SharedMem.pm	IPC::SysV extension Perl module
+cpan/IPC-SysV/lib/IPC/SysV.pm		IPC::SysV extension Perl module
+cpan/IPC-SysV/Makefile.PL		IPC::SysV makefile writer
+cpan/IPC-SysV/MANIFEST.SKIP		IPC::SysV manifest skip specs
+cpan/IPC-SysV/README			IPC::SysV README
+cpan/IPC-SysV/regen.pl			IPC::SysV file regeneration script
+cpan/IPC-SysV/SysV.xs			IPC::SysV extension Perl module
+cpan/IPC-SysV/t/ipcsysv.t		IPC::SysV test file
+cpan/IPC-SysV/t/msg.t			IPC::SysV test file
+cpan/IPC-SysV/TODO			IPC::SysV todo file
+cpan/IPC-SysV/t/podcov.t		IPC::SysV test file
+cpan/IPC-SysV/t/pod.t			IPC::SysV test file
+cpan/IPC-SysV/t/sem.t			IPC::SysV test file
+cpan/IPC-SysV/t/shm.t			IPC::SysV test file
+cpan/IPC-SysV/typemap			IPC::SysV typemap
+cpan/libnet/Changes		libnet
+cpan/libnet/Config.eg		libnet
+cpan/libnet/demos/ftp		libnet
+cpan/libnet/demos/inetd		libnet
+cpan/libnet/demos/nntp		libnet
+cpan/libnet/demos/nntp.mirror	libnet
+cpan/libnet/demos/pop3		libnet
+cpan/libnet/demos/smtp.self	libnet
+cpan/libnet/demos/time		libnet
+cpan/libnet/Hostname.pm.eg	libnet
+cpan/libnet/Makefile.PL
+cpan/libnet/Net/Cmd.pm		libnet
+cpan/libnet/Net/Config.pm	libnet
+cpan/libnet/Net/Domain.pm	libnet
+cpan/libnet/Net/FTP/A.pm	libnet
+cpan/libnet/Net/FTP/dataconn.pm	libnet
+cpan/libnet/Net/FTP/E.pm	libnet
+cpan/libnet/Net/FTP/I.pm	libnet
+cpan/libnet/Net/FTP/L.pm	libnet
+cpan/libnet/Net/FTP.pm		libnet
+cpan/libnet/Net/libnetFAQ.pod	libnet
+cpan/libnet/Net/Netrc.pm	libnet
+cpan/libnet/Net/NNTP.pm		libnet
+cpan/libnet/Net/POP3.pm		libnet
+cpan/libnet/Net/SMTP.pm		libnet
+cpan/libnet/Net/Time.pm		libnet
+cpan/libnet/README		libnet
+cpan/libnet/t/config.t		libnet
+cpan/libnet/t/datasend.t	libnet
+cpan/libnet/t/ftp.t		libnet
+cpan/libnet/t/hostname.t	libnet
+cpan/libnet/t/libnet_t.pl	libnet
+cpan/libnet/t/netrc.t		libnet
+cpan/libnet/t/nntp.t		libnet
+cpan/libnet/t/require.t		libnet
+cpan/libnet/t/smtp.t		libnet
+cpan/libnet/t/time.t		libnet
+cpan/List-Util/Changes			Util extension
+cpan/List-Util/lib/List/Util.pm		List::Util
+cpan/List-Util/lib/List/Util/PP.pm	List::Util
+cpan/List-Util/lib/List/Util/XS.pm	List::Util
+cpan/List-Util/lib/Scalar/Util.pm	Scalar::Util
+cpan/List-Util/lib/Scalar/Util/PP.pm	Scalar::Util
+cpan/List-Util/ListUtil.xs		Util extension
+cpan/List-Util/Makefile.PL		Util extension
+cpan/List-Util/multicall.h		Util extension
+cpan/List-Util/README			Util extension
+cpan/List-Util/t/00version.t		Scalar::Util
+cpan/List-Util/t/blessed.t		Scalar::Util
+cpan/List-Util/t/dualvar.t		Scalar::Util
+cpan/List-Util/t/expfail.t		List::Util
+cpan/List-Util/t/first.t		List::Util
+cpan/List-Util/t/isvstring.t		Scalar::Util
+cpan/List-Util/t/lln.t			Scalar::Util
+cpan/List-Util/t/maxstr.t		List::Util
+cpan/List-Util/t/max.t			List::Util
+cpan/List-Util/t/minstr.t		List::Util
+cpan/List-Util/t/min.t			List::Util
+cpan/List-Util/t/openhan.t		Scalar::Util
+cpan/List-Util/t/p_00version.t		Scalar::Util
+cpan/List-Util/t/p_blessed.t		Scalar::Util
+cpan/List-Util/t/p_first.t		List::Util
+cpan/List-Util/t/p_lln.t		Scalar::Util
+cpan/List-Util/t/p_maxstr.t		List::Util
+cpan/List-Util/t/p_max.t		List::Util
+cpan/List-Util/t/p_minstr.t		List::Util
+cpan/List-Util/t/p_min.t		List::Util
+cpan/List-Util/t/p_openhan.t		Scalar::Util
+cpan/List-Util/t/p_readonly.t		Scalar::Util
+cpan/List-Util/t/p_reduce.t		List::Util
+cpan/List-Util/t/p_refaddr.t		Scalar::Util
+cpan/List-Util/t/p_reftype.t		Scalar::Util
+cpan/List-Util/t/proto.t		Scalar::Util
+cpan/List-Util/t/p_shuffle.t		List::Util
+cpan/List-Util/t/p_sum.t		List::Util
+cpan/List-Util/t/p_tainted.t		Scalar::Util
+cpan/List-Util/t/readonly.t		Scalar::Util
+cpan/List-Util/t/reduce.t		List::Util
+cpan/List-Util/t/refaddr.t		Scalar::Util
+cpan/List-Util/t/reftype.t		Scalar::Util
+cpan/List-Util/t/shuffle.t		List::Util
+cpan/List-Util/t/stack-corruption.t	List::Util
+cpan/List-Util/t/sum.t			List::Util
+cpan/List-Util/t/tainted.t		Scalar::Util
+cpan/List-Util/t/weak.t			Scalar::Util
+cpan/List-Util/XS.pp			List::Util
+cpan/Locale-Codes/ChangeLog			Locale::Codes
+cpan/Locale-Codes/lib/Locale/Constants.pm	Locale::Codes
+cpan/Locale-Codes/lib/Locale/Constants.pod	Locale::Codes documentation
+cpan/Locale-Codes/lib/Locale/Country.pm		Locale::Codes
+cpan/Locale-Codes/lib/Locale/Country.pod	Locale::Codes documentation
+cpan/Locale-Codes/lib/Locale/Currency.pm	Locale::Codes
+cpan/Locale-Codes/lib/Locale/Currency.pod	Locale::Codes documentation
+cpan/Locale-Codes/lib/Locale/Language.pm	Locale::Codes
+cpan/Locale-Codes/lib/Locale/Language.pod	Locale::Codes documentation
+cpan/Locale-Codes/lib/Locale/Script.pm		Locale::Codes
+cpan/Locale-Codes/lib/Locale/Script.pod		Locale::Codes documentation
+cpan/Locale-Codes/Makefile.PL
+cpan/Locale-Codes/README			Locale::Codes
+cpan/Locale-Codes/t/all.t			See if Locale::Codes work
+cpan/Locale-Codes/t/constants.t			See if Locale::Codes work
+cpan/Locale-Codes/t/country.t			See if Locale::Codes work
+cpan/Locale-Codes/t/currency.t			See if Locale::Codes work
+cpan/Locale-Codes/t/language.t			See if Locale::Codes work
+cpan/Locale-Codes/t/rename.t			See if Locale::Codes work
+cpan/Locale-Codes/t/script.t			See if Locale::Codes work
+cpan/Locale-Codes/t/uk.t			See if Locale::Codes work
+cpan/Locale-Maketext-Simple/lib/Locale/Maketext/Simple.pm	Locale::Simple
+cpan/Locale-Maketext-Simple/t/0-signature.t			Locale::Simple tests
+cpan/Locale-Maketext-Simple/t/1-basic.t				Locale::Simple tests
+cpan/Locale-Maketext-Simple/t/2-load_po_without_i_default.t	Locale::Simple tests
+cpan/Locale-Maketext-Simple/t/3-load_po_with_i_default.t	Locale::Simple tests
+cpan/Locale-Maketext-Simple/t/po_with_i_default/en.po		Locale::Simple tests
+cpan/Locale-Maketext-Simple/t/po_with_i_default/fr.po		Locale::Simple tests
+cpan/Locale-Maketext-Simple/t/po_with_i_default/i_default.po	Locale::Simple tests
+cpan/Locale-Maketext-Simple/t/po_without_i_default/en.po	Locale::Simple tests
+cpan/Locale-Maketext-Simple/t/po_without_i_default/fr.po	Locale::Simple tests
+cpan/Log-Message/lib/Log/Message/Config.pm	Log::Message
+cpan/Log-Message/lib/Log/Message/Handlers.pm	Log::Message
+cpan/Log-Message/lib/Log/Message/Item.pm	Log::Message
+cpan/Log-Message/lib/Log/Message.pm		Log::Message
+cpan/Log-Message-Simple/lib/Log/Message/Simple.pm	Log::Simple
+cpan/Log-Message-Simple/t/01_use.t			Log::Simple tests
+cpan/Log-Message-Simple/t/02_imports.t			Log::Simple tests
+cpan/Log-Message-Simple/t/03_functions.t		Log::Simple tests
+cpan/Log-Message/t/01_Log-Message-Config.t	Log::Message tests
+cpan/Log-Message/t/02_Log-Message.t		Log::Message tests
+cpan/Log-Message/t/conf/config_file		Log::Message tests
+cpan/Log-Message/t/conf/LoadMe.pl		Log::Message tests
+cpan/Math-BigInt-FastCalc/FastCalc.pm	Math::BigInt::FastCalc extension
+cpan/Math-BigInt-FastCalc/FastCalc.xs	Math::BigInt::FastCalc extension
+cpan/Math-BigInt-FastCalc/t/bigintfc.t	Math::BigInt::FastCalc extension
+cpan/Math-BigInt-FastCalc/t/bootstrap.t	Math::BigInt::FastCalc extension
+cpan/Math-BigInt-FastCalc/t/leak.t	test for memory leaks in Math::BigInt::FastCalc
+cpan/Math-BigInt-FastCalc/t/mbi_rand.t	Math::BigInt::FastCalc extension
+cpan/Math-BigInt/lib/Math/BigFloat.pm		An arbitrary precision floating-point arithmetic package
+cpan/Math-BigInt/lib/Math/BigInt/CalcEmu.pm	Pure Perl module to support Math::BigInt
+cpan/Math-BigInt/lib/Math/BigInt/Calc.pm	Pure Perl module to support Math::BigInt
+cpan/Math-BigInt/lib/Math/BigInt.pm	An arbitrary precision integer arithmetic package
+cpan/Math-BigInt/t/alias.inc		Support for BigInt tests
+cpan/Math-BigInt/t/bare_mbf.t		Test MBF under Math::BigInt::BareCalc
+cpan/Math-BigInt/t/bare_mbi.t		Test MBI under Math::BigInt::BareCalc
+cpan/Math-BigInt/t/bare_mif.t		Rounding tests under BareCalc
+cpan/Math-BigInt/t/bigfltpm.inc		Shared tests for bigfltpm.t and sub_mbf.t
+cpan/Math-BigInt/t/bigfltpm.t		See if BigFloat.pm works
+cpan/Math-BigInt/t/bigintc.t		See if BigInt/Calc.pm works
+cpan/Math-BigInt/t/bigintpm.inc		Shared tests for bigintpm.t and sub_mbi.t
+cpan/Math-BigInt/t/bigintpm.t		See if BigInt.pm works
+cpan/Math-BigInt/t/bigints.t		See if BigInt.pm works
+cpan/Math-BigInt/t/biglog.t		Test the log function
+cpan/Math-BigInt/t/big_pi_e.t		test bpi() and bexp()
+cpan/Math-BigInt/t/bigroot.t		Test the broot function
+cpan/Math-BigInt/t/calling.t		Test calling conventions
+cpan/Math-BigInt/t/config.t		Test Math::BigInt->config()
+cpan/Math-BigInt/t/constant.t		Test Math::BigInt/BigFloat under :constant
+cpan/Math-BigInt/t/const_mbf.t		Test Math::BigInt
+cpan/Math-BigInt/t/downgrade.t		Test if use Math::BigInt(); under downgrade works
+cpan/Math-BigInt/t/_e_math.t		Helper routine in BigFloat for _e math
+cpan/Math-BigInt/t/inf_nan.t		Special tests for inf and *NaN* handling
+cpan/Math-BigInt/t/isa.t		Test for Math::BigInt inheritance
+cpan/Math-BigInt/t/lib_load.t		Test sane lib names
+cpan/Math-BigInt/t/Math/BigFloat/Subclass.pm	Empty subclass of BigFloat for test
+cpan/Math-BigInt/t/Math/BigInt/BareCalc.pm	Bigint's simulation of Calc
+cpan/Math-BigInt/t/Math/BigInt/Scalar.pm	Pure Perl module to support Math::BigInt
+cpan/Math-BigInt/t/Math/BigInt/Subclass.pm	Empty subclass of BigInt for test
+cpan/Math-BigInt/t/mbf_ali.t		Tests for BigFloat
+cpan/Math-BigInt/t/mbi_ali.t		Tests for BigInt
+cpan/Math-BigInt/t/mbimbf.inc		Actual BigInt/BigFloat accuracy, precision and fallback, round_mode tests
+cpan/Math-BigInt/t/mbimbf.t		BigInt/BigFloat accuracy, precision and fallback, round_mode
+cpan/Math-BigInt/t/mbi_rand.t		Test Math::BigInt randomly
+cpan/Math-BigInt/t/nan_cmp.t		overloaded comparision involving *NaN*
+cpan/Math-BigInt/t/new_overloaded.t	test overloaded numbers in BigFloat's new()
+cpan/Math-BigInt/t/req_mbf0.t		test: require Math::BigFloat; ->bzero();
+cpan/Math-BigInt/t/req_mbf1.t		test: require Math::BigFloat; ->bone();
+cpan/Math-BigInt/t/req_mbfa.t		test: require Math::BigFloat; ->bnan();
+cpan/Math-BigInt/t/req_mbfi.t		test: require Math::BigFloat; ->binf();
+cpan/Math-BigInt/t/req_mbfn.t		test: require Math::BigFloat; ->new();
+cpan/Math-BigInt/t/req_mbfw.t		require Math::BigFloat; import ( with => );
+cpan/Math-BigInt/t/require.t		Test if require Math::BigInt works
+cpan/Math-BigInt/t/round.t		Test rounding with non-integer A and P
+cpan/Math-BigInt/t/sub_ali.t		Tests for aliases in BigInt subclasses
+cpan/Math-BigInt/t/sub_mbf.t		Empty subclass test of BigFloat
+cpan/Math-BigInt/t/sub_mbi.t		Empty subclass test of BigInt
+cpan/Math-BigInt/t/sub_mif.t		Test A & P with subclasses using mbimbf.inc
+cpan/Math-BigInt/t/trap.t		Test whether trap_nan and trap_inf work
+cpan/Math-BigInt/t/upgradef.t		Test if use Math::BigFloat(); under upgrade works
+cpan/Math-BigInt/t/upgrade.inc		Actual tests for upgrade.t
+cpan/Math-BigInt/t/upgrade.t		Test if use Math::BigInt(); under upgrade works
+cpan/Math-BigInt/t/use_lib1.t		Test combinations of Math::BigInt and BigFloat
+cpan/Math-BigInt/t/use_lib2.t		Test combinations of Math::BigInt and BigFloat
+cpan/Math-BigInt/t/use_lib3.t		Test combinations of Math::BigInt and BigFloat
+cpan/Math-BigInt/t/use_lib4.t		Test combinations of Math::BigInt and BigFloat
+cpan/Math-BigInt/t/use_mbfw.t		use BigFloat w/ with and lib at the same time
+cpan/Math-BigInt/t/use.t		Test if use Math::BigInt(); works
+cpan/Math-BigInt/t/with_sub.t		Test use Math::BigFloat with => package
+cpan/Math-BigRat/lib/Math/BigRat.pm	Math::BigRat
+cpan/Math-BigRat/t/big_ap.t		Math::BigRat test
+cpan/Math-BigRat/t/bigfltpm.inc		Math::BigRat test
+cpan/Math-BigRat/t/bigfltrt.t		Math::BigRat test
+cpan/Math-BigRat/t/biglog.t		Math::BigRat test
+cpan/Math-BigRat/t/bigratpm.inc		Math::BigRat test
+cpan/Math-BigRat/t/bigratpm.t		Math::BigRat test
+cpan/Math-BigRat/t/bigrat.t		Math::BigRat test
+cpan/Math-BigRat/t/bigratup.t		test under $Math::BigInt::upgrade
+cpan/Math-BigRat/t/bigroot.t		Math::BigRat test
+cpan/Math-BigRat/t/hang.t		Math::BigRat test for bug #34584 - hang in exp()
+cpan/Math-BigRat/t/Math/BigRat/Test.pm	Math::BigRat test helper
+cpan/Math-BigRat/t/requirer.t		see if require works properly
+cpan/Math-BigRat/t/trap.t		see if trap_nan and trap_inf work
+cpan/Math-Complex/lib/Math/Complex.pm	A Complex package
+cpan/Math-Complex/lib/Math/Trig.pm	A simple interface to complex trigonometry
+cpan/Math-Complex/t/Complex.t		See if Math::Complex works
+cpan/Math-Complex/t/Trig.t		See if Math::Trig works
+cpan/Math-Complex/t/underbar.t		See if Math::Complex works
+cpan/Memoize/Memoize/AnyDBM_File.pm	Memoize glue layer for AnyDBM_File
+cpan/Memoize/Memoize/ExpireFile.pm	Memoize expiry manager test scaffold
+cpan/Memoize/Memoize/Expire.pm		Memoize expiry manager example
+cpan/Memoize/Memoize/ExpireTest.pm	Memoize expiry manager test scaffold
+cpan/Memoize/Memoize/NDBM_File.pm	Memoize glue layer for NDBM_File
+cpan/Memoize/Memoize.pm			Memoize
+cpan/Memoize/Memoize/SDBM_File.pm	Memoize glue layer for SDBM_File
+cpan/Memoize/Memoize/Storable.pm	Memoize glue layer for Storable
+cpan/Memoize/README			Memoize release notes
+cpan/Memoize/t/array_confusion.t	Memoize ambiguous array return tests
+cpan/Memoize/t/array.t			Memoize array context return tests
+cpan/Memoize/t/correctness.t		Memoize basic correctness tests
+cpan/Memoize/t/errors.t			Memoize PEBKAC detection tests
+cpan/Memoize/t/expfile.t		Memoize expiry manager tests
+cpan/Memoize/t/expire.t			Memoize expiry manager tests
+cpan/Memoize/t/expmod_n.t		Memoize expiry manager tests
+cpan/Memoize/t/expmod_t.t		Memoize expiry manager (timed) tests
+cpan/Memoize/t/flush.t			Memoize 'flush_cache' function tests
+cpan/Memoize/t/normalize.t		Memoize 'normalizer' feature tests
+cpan/Memoize/TODO			Memoize to-do list
+cpan/Memoize/t/prototype.t		Memoize prototyped function handling tests
+cpan/Memoize/t/speed.t			"Makes functions faster" advertisement test
+cpan/Memoize/t/tiefeatures.t		Memoize FAULT / MERGE / HASH options test
+cpan/Memoize/t/tie_gdbm.t		Memoize GDBM interface test
+cpan/Memoize/t/tie_ndbm.t		Memoize NDBM interface test
+cpan/Memoize/t/tie_sdbm.t		Memoize SDBM interface test
+cpan/Memoize/t/tie_storable.t		Memoize Storable interface test
+cpan/Memoize/t/tie.t			Memoize tied file test
+cpan/Memoize/t/unmemoize.t		Memoize 'unmemoize' function test
+cpan/MIME-Base64/Base64.pm		MIME::Base64 extension
+cpan/MIME-Base64/Base64.xs		MIME::Base64 extension
+cpan/MIME-Base64/Changes		MIME::Base64 extension
+cpan/MIME-Base64/Makefile.PL		MIME::Base64 extension
+cpan/MIME-Base64/QuotedPrint.pm		MIME::Base64 extension
+cpan/MIME-Base64/README			README for MIME::Base64
+cpan/MIME-Base64/t/base64.t		See whether MIME::Base64 works
+cpan/MIME-Base64/t/quoted-print.t	See whether MIME::QuotedPrint works
+cpan/MIME-Base64/t/unicode.t		See whether MIME::Base64 works
+cpan/MIME-Base64/t/warn.t		See whether MIME::Base64 works
+cpan/Module-Build/Changes				Module::Build
+cpan/Module-Build/lib/inc/latest.pm			Module::Build
+cpan/Module-Build/lib/inc/latest/private.pm		Module::Build
+cpan/Module-Build/lib/Module/Build/API.pod		Module::Build
+cpan/Module-Build/lib/Module/Build/Authoring.pod	Module::Build
+cpan/Module-Build/lib/Module/Build/Base.pm		Module::Build
+cpan/Module-Build/lib/Module/Build/Bundling.pod		Module::Build
+cpan/Module-Build/lib/Module/Build/Compat.pm		Module::Build
+cpan/Module-Build/lib/Module/Build/ConfigData.pm	Configuration for Module::Build
+cpan/Module-Build/lib/Module/Build/Config.pm		Module::Build
+cpan/Module-Build/lib/Module/Build/Cookbook.pm		Module::Build
+cpan/Module-Build/lib/Module/Build/Dumper.pm		Module::Build
+cpan/Module-Build/lib/Module/Build/ModuleInfo.pm	Module::Build
+cpan/Module-Build/lib/Module/Build/Notes.pm		Module::Build
+cpan/Module-Build/lib/Module/Build/Platform/aix.pm	Module::Build
+cpan/Module-Build/lib/Module/Build/Platform/Amiga.pm	Module::Build
+cpan/Module-Build/lib/Module/Build/Platform/cygwin.pm	Module::Build
+cpan/Module-Build/lib/Module/Build/Platform/darwin.pm	Module::Build
+cpan/Module-Build/lib/Module/Build/Platform/Default.pm	Module::Build
+cpan/Module-Build/lib/Module/Build/Platform/EBCDIC.pm	Module::Build
+cpan/Module-Build/lib/Module/Build/Platform/MacOS.pm	Module::Build
+cpan/Module-Build/lib/Module/Build/Platform/MPEiX.pm	Module::Build
+cpan/Module-Build/lib/Module/Build/Platform/os2.pm	Module::Build
+cpan/Module-Build/lib/Module/Build/Platform/RiscOS.pm	Module::Build
+cpan/Module-Build/lib/Module/Build/Platform/Unix.pm	Module::Build
+cpan/Module-Build/lib/Module/Build/Platform/VMS.pm	Module::Build
+cpan/Module-Build/lib/Module/Build/Platform/VOS.pm	Module::Build
+cpan/Module-Build/lib/Module/Build/Platform/Windows.pm	Module::Build
+cpan/Module-Build/lib/Module/Build.pm			Module::Build
+cpan/Module-Build/lib/Module/Build/PodParser.pm		Module::Build
+cpan/Module-Build/lib/Module/Build/PPMMaker.pm		Module::Build
+cpan/Module-Build/lib/Module/Build/Version.pm		Module::Build
+cpan/Module-Build/lib/Module/Build/YAML.pm		Module::Build
+cpan/Module-Build/scripts/config_data			Module::Build
+cpan/Module-Build/t/00-compile.t			Module::Build
+cpan/Module-Build/t/actions/installdeps.t		Module::Build
+cpan/Module-Build/t/add_property.t			Module::Build
+cpan/Module-Build/t/basic.t				Module::Build
+cpan/Module-Build/t/bundled/Tie/CPHash.pm		Module::Build
+cpan/Module-Build/t/bundle_inc.t			Module::Build
+cpan/Module-Build/t/compat/exit.t			Module::Build
+cpan/Module-Build/t/compat.t				Module::Build
+cpan/Module-Build/t/debug.t				Module::Build
+cpan/Module-Build/t/destinations.t			Module::Build
+cpan/Module-Build/t/extend.t				Module::Build
+cpan/Module-Build/t/ext.t				Module::Build
+cpan/Module-Build/t/files.t				Module::Build
+cpan/Module-Build/t/help.t				Module::Build
+cpan/Module-Build/t/install_extra_target.t		Module::Build
+cpan/Module-Build/t/install.t				Module::Build
+cpan/Module-Build/t/lib/DistGen.pm			Module::Build
+cpan/Module-Build/t/lib/MBTest.pm			Module::Build
+cpan/Module-Build/t/manifypods.t			Module::Build
+cpan/Module-Build/t/metadata2.t				Module::Build
+cpan/Module-Build/t/metadata.t				Module::Build
+cpan/Module-Build/t/moduleinfo.t			Module::Build
+cpan/Module-Build/t/mymeta.t				Module::Build
+cpan/Module-Build/t/new_from_context.t			Module::Build
+cpan/Module-Build/t/notes.t				Module::Build
+cpan/Module-Build/t/parents.t				Module::Build
+cpan/Module-Build/t/perl_mb_opt.t			Module::Build
+cpan/Module-Build/t/PL_files.t				Module::Build
+cpan/Module-Build/t/pod_parser.t			Module::Build
+cpan/Module-Build/t/ppm.t				Module::Build
+cpan/Module-Build/t/properties/module_name.t		Module::Build
+cpan/Module-Build/t/properties/needs_compiler.t		Module::Build
+cpan/Module-Build/t/properties/share_dir.t		Module::Build
+cpan/Module-Build/t/README.pod				Module::Build
+cpan/Module-Build/t/resume.t				Module::Build
+cpan/Module-Build/t/runthrough.t			Module::Build
+cpan/Module-Build/t/sample.t				Module::Build
+cpan/Module-Build/t/script_dist.t			Module::Build
+cpan/Module-Build/t/test_file_exts.t			Module::Build
+cpan/Module-Build/t/test_types.t			Module::Build
+cpan/Module-Build/t/test_type.t				Module::Build
+cpan/Module-Build/t/tilde.t				Module::Build
+cpan/Module-Build/t/use_tap_harness.t			Module::Build
+cpan/Module-Build/t/versions.t				Module::Build
+cpan/Module-Build/t/write_default_maniskip.t		Module::Build
+cpan/Module-Build/t/xs.t				Module::Build
+cpan/Module-Load-Conditional/lib/Module/Load/Conditional.pm	Module::Conditional
+cpan/Module-Load-Conditional/t/01_Module_Load_Conditional.t	Module::Conditional tests
+cpan/Module-Load-Conditional/t/02_Parse_Version.t		Module::Load::Conditional tests
+cpan/Module-Load-Conditional/t/to_load/Commented.pm		Module::Conditional tests
+cpan/Module-Load-Conditional/t/to_load/InPod.pm			Module::Load::Conditional tests
+cpan/Module-Load-Conditional/t/to_load/LoadIt.pm		Module::Conditional tests
+cpan/Module-Load-Conditional/t/to_load/LoadMe.pl		Module::Conditional tests
+cpan/Module-Load-Conditional/t/to_load/MustBe/Loaded.pm		Module::Load::Conditional tests
+cpan/Module-Load-Conditional/t/to_load/ToBeLoaded		Module::Conditional tests
+cpan/Module-Loaded/lib/Module/Loaded.pm	Module::Loaded
+cpan/Module-Loaded/t/01_Module-Loaded.t	Module::Loaded tests
+cpan/Module-Load/lib/Module/Load.pm		Module::Load
+cpan/Module-Load/t/01_Module-Load.t		Module::Load tests
+cpan/Module-Load/t/to_load/config_file		Module::Load tests
+cpan/Module-Load/t/to_load/LoadIt.pm		Module::Load tests
+cpan/Module-Load/t/to_load/LoadMe.pl		Module::Load tests
+cpan/Module-Load/t/to_load/Must/Be/Loaded.pm	Module::Load tests
+cpan/Module-Load/t/to_load/TestModule.pm	Module::Load tests
+cpan/Module-Load/t/to_load/ToBeLoaded		Module::Load tests
+cpan/Module-Pluggable/lib/Devel/InnerPackage.pm		Find inner packages
+cpan/Module-Pluggable/lib/Module/Pluggable/Object.pm	Module::Pluggable
+cpan/Module-Pluggable/lib/Module/Pluggable.pm		Module::Pluggable
+cpan/Module-Pluggable/Makefile.PL			Module::Pluggable
+cpan/Module-Pluggable/t/01use.t				Module::Pluggable tests
+cpan/Module-Pluggable/t/02alsoworks.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/02works.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/02works_taint.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/03diffname.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/04acmedir_single.t		Module::Pluggable tests
+cpan/Module-Pluggable/t/04acmedir.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/04acmepath_single.t		Module::Pluggable tests
+cpan/Module-Pluggable/t/04acmepath.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/05postpath.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/06multipath.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/07instantiate.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/08nothing.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/09require.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/10innerpack_inner.t		Module::Pluggable tests
+cpan/Module-Pluggable/t/10innerpack_noinner.t		Module::Pluggable tests
+cpan/Module-Pluggable/t/10innerpack_onefile.t		Module::Pluggable tests
+cpan/Module-Pluggable/t/10innerpack_override.t		Module::Pluggable tests
+cpan/Module-Pluggable/t/10innerpack_super.t		Module::Pluggable tests
+cpan/Module-Pluggable/t/10innerpack.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/11usetwice.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/12onlyarray.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/12onlyregex.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/12onlyrequire.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/12only.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/13exceptarray.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/13exceptregex.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/13except.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/14package.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/15topicsafe.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/16different_extension.t		Module::Pluggable tests
+cpan/Module-Pluggable/t/17devel_inner_package.t		Module::Pluggable tests
+cpan/Module-Pluggable/t/18skipped_package.t		Module::Pluggable tests
+cpan/Module-Pluggable/t/19can_ok_clobber.t		Module::Pluggable tests
+cpan/Module-Pluggable/t/20dodgy_files.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/21editor_junk.t			Module::Pluggable tests
+cpan/Module-Pluggable/t/acme/Acme/MyTest/Plugin/Foo.pm	Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/Acme/Foo-Bar.pm		Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/Acme/MyTest/Plugin/Foo.pm	Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/EditorJunk/Plugin/Bar.pm	Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/EditorJunk/Plugin/Bar.pm~	Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/EditorJunk/Plugin/Bar.pm.swo	Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/EditorJunk/Plugin/Bar.pm.swp	Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/EditorJunk/Plugin/Foo.pm	Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/ExtTest/Plugin/Bar.plugin	Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/ExtTest/Plugin/Foo.plugin	Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/ExtTest/Plugin/Quux/Foo.plugin	Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/InnerTest/Plugin/Foo.pm	Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/MyOtherTest/Plugin/Bar.pm	Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/MyOtherTest/Plugin/Foo.pm	Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/MyOtherTest/Plugin/Quux/Foo.pm	Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/MyOtherTest/Plugin/Quux.pm	Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/MyTest/Extend/Plugin/Bar.pm	Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/MyTest/Plugin/Bar.pm	Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/MyTest/Plugin/Foo.pm	Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/MyTest/Plugin/Quux/Foo.pm	Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/No/Middle.pm		Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/OddTest/Plugin/Foo.pm	Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/TA/C/A/I.pm			Module::Pluggable tests
+cpan/Module-Pluggable/t/lib/Zot/.Zork.pm		Module::Pluggable tests
+cpan/NEXT/Changes		NEXT
+cpan/NEXT/lib/NEXT.pm		Pseudo-class NEXT for method redispatch
+cpan/NEXT/README		NEXT
+cpan/NEXT/t/actual.t		NEXT
+cpan/NEXT/t/actuns.t		NEXT
+cpan/NEXT/t/dynamically_scoped_regex_vars.t	NEXT
+cpan/NEXT/t/next.t		NEXT
+cpan/NEXT/t/stringify.t		NEXT
+cpan/NEXT/t/unseen.t		NEXT
+cpan/Object-Accessor/lib/Object/Accessor.pm		Object::Accessor
+cpan/Object-Accessor/t/00_Object-Accessor.t		Object::Accessor tests
+cpan/Object-Accessor/t/01_Object-Accessor-Subclassed.t	Object::Accessor tests
+cpan/Object-Accessor/t/02_Object-Accessor-allow.t	Object::Accessor tests
+cpan/Object-Accessor/t/03_Object-Accessor-local.t	Object::Accessor tests
+cpan/Object-Accessor/t/04_Object-Accessor-lvalue.t	Object::Accessor tests
+cpan/Object-Accessor/t/05_Object-Accessor-callback.t	Object::Accessor tests
+cpan/Object-Accessor/t/06_Object-Accessor-alias.t	Object::Accessor tests
+cpan/Package-Constants/lib/Package/Constants.pm	Package::Constants
+cpan/Package-Constants/t/01_list.t		Package::Constants tests
+cpan/Params-Check/lib/Params/Check.pm	Params::Check
+cpan/Params-Check/t/01_Params-Check.t	Params::Check tests
+cpan/parent/lib/parent.pm			Establish an ISA relationship with base classes at compile time
+cpan/parent/t/compile-time-file.t		tests for parent.pm
+cpan/parent/t/compile-time.t			tests for parent.pm
+cpan/parent/t/lib/Dummy2.plugin			test files for parent.pm
+cpan/parent/t/lib/Dummy/Outside.pm		test files for parent.pm
+cpan/parent/t/lib/Dummy.pm			test files for parent.pm
+cpan/parent/t/lib/FileThatOnlyExistsAsPMC.pmc	test files for parent.pm
+cpan/parent/t/lib/ReturnsFalse.pm		test files for parent.pm
+cpan/parent/t/parent-classfromclassfile.t	tests for parent.pm
+cpan/parent/t/parent-classfromfile.t		tests for parent.pm
+cpan/parent/t/parent-pmc.t			tests for parent.pm
+cpan/parent/t/parent-returns-false.t		tests for parent.pm
+cpan/parent/t/parent.t				tests for parent.pm
+cpan/Parse-CPAN-Meta/Changes				Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/lib/Parse/CPAN/Meta.pm		Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/01_compile.t			Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/02_basic.t			Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/03_regression.t			Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/04_scalar.t			Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/05_export.t			Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/11_meta_yml.t			Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/12_plagger.t			Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/13_perl_smith.t			Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/14_yaml_org.t			Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/15_multibyte.t			Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/16_nullrefs.t			Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/17_toolbar.t			Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/18_tap.t				Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/19_errors.t			Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/21_bom.t				Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/data/HTML-WebDAO.yml		Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/data/multibyte.yml		Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/data/sample.yml			Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/data/Spreadsheet-Read.yml	Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/data/Template-Provider-Unicode-Japanese.yml	Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/data/toolbar.yml			Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/data/utf_16_le_bom.yml	Parse::CPAN::Meta - manually generated; see Porting/Maintainers.pl
+cpan/Parse-CPAN-Meta/t/data/utf_16_le_bom.yml.packed	Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/data/vanilla.yml			Parse::CPAN::Meta
+cpan/Parse-CPAN-Meta/t/lib/Parse/CPAN/Meta/Test.pm	Parse::CPAN::Meta testing library
+cpan/Parse-CPAN-Meta/uupacktool.pl			Parse::CPAN::Meta
+cpan/PerlIO-via-QuotedPrint/lib/PerlIO/via/QuotedPrint.pm	PerlIO::via::QuotedPrint
+cpan/PerlIO-via-QuotedPrint/t/QuotedPrint.t			PerlIO::via::QuotedPrint
+cpan/Pod-Escapes/ChangeLog		ChangeLog for Pod::Escapes
+cpan/Pod-Escapes/lib/Pod/Escapes.pm	Pod::Escapes
+cpan/Pod-Escapes/README			README for Pod::Escapes
+cpan/Pod-Escapes/t/01_about_verbose.t	test Pod::Escapes
+cpan/Pod-Escapes/t/10_main.t		test Pod::Escapes
+cpan/Pod-Escapes/t/15_name2charnum.t	test Pod::Escapes
+cpan/Pod-LaTeX/LaTeX.pm		Convert POD data to LaTeX
+cpan/Pod-LaTeX/t/pod2latex.t	See if Pod::LaTeX works
+cpan/Pod-LaTeX/t/user.t		See if Pod::LaTeX works
+cpan/podlators/lib/Pod/Man.pm			Convert POD data to *roff
+cpan/podlators/lib/Pod/ParseLink.pm		Perl an L<> formatting code in POD text
+cpan/podlators/lib/Pod/Text/Color.pm		Convert POD data to color ASCII text
+cpan/podlators/lib/Pod/Text/Overstrike.pm	Convert POD data to formatted overstrike text
+cpan/podlators/lib/Pod/Text.pm			Pod-Parser - convert POD data to formatted ASCII text
+cpan/podlators/lib/Pod/Text/Termcap.pm		Convert POD data to ASCII text with format escapes
+cpan/podlators/Makefile.PL
+cpan/podlators/t/basic.cap			podlators test
+cpan/podlators/t/basic.clr			podlators test
+cpan/podlators/t/basic.man			podlators test
+cpan/podlators/t/basic.ovr			podlators test
+cpan/podlators/t/basic.pod			podlators test
+cpan/podlators/t/basic.t			podlators test
+cpan/podlators/t/basic.txt			podlators test
+cpan/podlators/t/color.t			podlators test
+cpan/podlators/t/devise-date.t			podlators test
+cpan/podlators/t/filehandle.t			podlators test
+cpan/podlators/t/man-heading.t			podlators test
+cpan/podlators/t/man-options.t			podlators test
+cpan/podlators/t/man.t				podlators test
+cpan/podlators/t/man-utf8.t			podlators test
+cpan/podlators/t/overstrike.t			podlators test
+cpan/podlators/t/parselink.t			podlators test
+cpan/podlators/t/pod-parser.t			podlators test
+cpan/podlators/t/pod-spelling.t			podlators test
+cpan/podlators/t/pod.t				podlators test
+cpan/podlators/t/termcap.t			podlators test
+cpan/podlators/t/text-encoding.t		podlators test
+cpan/podlators/t/text-options.t			podlators test
+cpan/podlators/t/text.t				podlators test
+cpan/podlators/t/text-utf8.t			podlators test
+cpan/podlators/VERSION				podlators distribution version
+cpan/Pod-Parser/lib/Pod/Checker.pm		Pod-Parser - check POD documents for syntax errors
+cpan/Pod-Parser/lib/Pod/Find.pm			used by pod/splitpod
+cpan/Pod-Parser/lib/Pod/InputObjects.pm		Pod-Parser - define objects for input streams
+cpan/Pod-Parser/lib/Pod/Parser.pm		Pod-Parser - define base class for parsing POD
+cpan/Pod-Parser/lib/Pod/ParseUtils.pm		Pod-Parser - pod utility functions
+cpan/Pod-Parser/lib/Pod/PlainText.pm		Convert POD data to formatted ASCII text
+cpan/Pod-Parser/lib/Pod/Select.pm		Pod-Parser - select portions of POD docs
+cpan/Pod-Parser/lib/Pod/Usage.pm		Pod-Parser - print usage messages
+cpan/Pod-Parser/t/pod/contains_bad_pod.xr	Pod-Parser test file
+cpan/Pod-Parser/t/pod/contains_pod.t		Pod-Parser test
+cpan/Pod-Parser/t/pod/contains_pod.xr		Pod-Parser test file
+cpan/Pod-Parser/t/pod/emptycmd.t		Test empty pod directives
+cpan/Pod-Parser/t/pod/emptycmd.xr		Expected results for emptycmd.t
+cpan/Pod-Parser/t/pod/find.t			See if Pod::Find works
+cpan/Pod-Parser/t/pod/for.t			Test =for directive
+cpan/Pod-Parser/t/pod/for.xr			Expected results for for.t
+cpan/Pod-Parser/t/pod/headings.t		Test =head directives
+cpan/Pod-Parser/t/pod/headings.xr		Expected results for headings.t
+cpan/Pod-Parser/t/pod/included.t		Test =include directive
+cpan/Pod-Parser/t/pod/included.xr		Expected results for included.t
+cpan/Pod-Parser/t/pod/include.t			Test =include directive
+cpan/Pod-Parser/t/pod/include.xr		Expected results for include.t
+cpan/Pod-Parser/t/pod/lref.t			Test L<...> sequences
+cpan/Pod-Parser/t/pod/lref.xr			Expected results for lref.t
+cpan/Pod-Parser/t/pod/multiline_items.t		Test multiline =items
+cpan/Pod-Parser/t/pod/multiline_items.xr	Expected results for multiline_items.t
+cpan/Pod-Parser/t/pod/nested_items.t		Test nested =items
+cpan/Pod-Parser/t/pod/nested_items.xr		Expected results for nested_items.t
+cpan/Pod-Parser/t/pod/nested_seqs.t		Test nested interior sequences
+cpan/Pod-Parser/t/pod/nested_seqs.xr		Expected results for nested_seqs.t
+cpan/Pod-Parser/t/pod/oneline_cmds.t		Test single paragraph ==cmds
+cpan/Pod-Parser/t/pod/oneline_cmds.xr		Expected results for oneline_cmds.t
+cpan/Pod-Parser/t/pod/p2u_data.pl		Test Pod::Usage
+cpan/Pod-Parser/t/pod/pod2usage2.t		Test Pod::Usage
+cpan/Pod-Parser/t/pod/pod2usage.t		Test Pod::Usage
+cpan/Pod-Parser/t/pod/pod2usage.xr		Expected results for pod2usage.t
+cpan/Pod-Parser/t/pod/podchkenc.t		Validate =encoding support
+cpan/Pod-Parser/t/pod/podchkenc.xr		Expected results for the above
+cpan/Pod-Parser/t/pod/poderrs.t			Test POD errors
+cpan/Pod-Parser/t/pod/poderrs.xr		Expected results for poderrs.t
+cpan/Pod-Parser/t/pod/podselect.t		Test Pod::Select
+cpan/Pod-Parser/t/pod/podselect.xr		Expected results for podselect.t
+cpan/Pod-Parser/t/pod/special_seqs.t		Test "special" interior sequences
+cpan/Pod-Parser/t/pod/special_seqs.xr		Expected results for special_seqs.t
+cpan/Pod-Parser/t/pod/testcmp.pl		Module to compare output against expected results
+cpan/Pod-Parser/t/pod/testp2pt.pl		Module to test Pod::PlainText for a given file
+cpan/Pod-Parser/t/pod/testpchk.pl		Module to test Pod::Checker for a given file
+cpan/Pod-Parser/t/pod/testpods/lib/Pod/Stuff.pm	Sample data for t/pod/find.t
+cpan/Pod-Parser/t/pod/twice.t			Test Pod::Parser
+cpan/Pod-Parser/t/pod/usage2.pod		Test POD for pod2usage tests
+cpan/Pod-Parser/t/pod/usage.pod			Test POD for pod2usage tests
+cpan/Pod-Simple/ChangeLog				Pod::Simple ChangeLog
+cpan/Pod-Simple/lib/Pod/Simple/BlackBox.pm		Pod::Simple::BlackBox
+cpan/Pod-Simple/lib/Pod/Simple/Checker.pm		check the Pod syntax of a document
+cpan/Pod-Simple/lib/Pod/Simple/Debug.pm			put Pod::Simple into trace/debug mode
+cpan/Pod-Simple/lib/Pod/Simple/DumpAsText.pm		dump Pod-parsing events as text
+cpan/Pod-Simple/lib/Pod/Simple/DumpAsXML.pm		turn Pod into XML
+cpan/Pod-Simple/lib/Pod/Simple/HTMLBatch.pm		convert several Pod files to several HTML files
+cpan/Pod-Simple/lib/Pod/Simple/HTMLLegacy.pm		Pod::Simple::HTMLLegacy
+cpan/Pod-Simple/lib/Pod/Simple/HTML.pm			convert Pod to HTML
+cpan/Pod-Simple/lib/Pod/Simple/LinkSection.pm		represent "section" attributes of L codes
+cpan/Pod-Simple/lib/Pod/Simple/Methody.pm		turn Pod::Simple events into method calls
+cpan/Pod-Simple/lib/Pod/Simple.pm			Pod made simple
+cpan/Pod-Simple/lib/Pod/Simple.pod			Pod for Pod::Simple
+cpan/Pod-Simple/lib/Pod/Simple/Progress.pm		Pod::Simple::Progress
+cpan/Pod-Simple/lib/Pod/Simple/PullParserEndToken.pm	end-tokens from Pod::Simple::PullParser
+cpan/Pod-Simple/lib/Pod/Simple/PullParser.pm		a pull-parser interface to parsing Pod
+cpan/Pod-Simple/lib/Pod/Simple/PullParserStartToken.pm	start-tokens from Pod::Simple::PullParser
+cpan/Pod-Simple/lib/Pod/Simple/PullParserTextToken.pm	text-tokens from Pod::Simple::PullParser
+cpan/Pod-Simple/lib/Pod/Simple/PullParserToken.pm	tokens from Pod::Simple::PullParser
+cpan/Pod-Simple/lib/Pod/Simple/RTF.pm			format Pod as RTF
+cpan/Pod-Simple/lib/Pod/Simple/Search.pm		find POD documents in directory trees
+cpan/Pod-Simple/lib/Pod/Simple/SimpleTree.pm		parse Pod into a simple parse tree
+cpan/Pod-Simple/lib/Pod/Simple/Subclassing.pod		write a formatter as a Pod::Simple subclass
+cpan/Pod-Simple/lib/Pod/Simple/TextContent.pm		get the text content of Pod
+cpan/Pod-Simple/lib/Pod/Simple/Text.pm			format Pod as plaintext
+cpan/Pod-Simple/lib/Pod/Simple/TiedOutFH.pm		Pod::Simple::TiedOutFH
+cpan/Pod-Simple/lib/Pod/Simple/TranscodeDumb.pm		Pod::Simple::TranscodeDumb
+cpan/Pod-Simple/lib/Pod/Simple/Transcode.pm		Pod::Simple::Transcode
+cpan/Pod-Simple/lib/Pod/Simple/TranscodeSmart.pm	Pod::Simple::TranscodeSmart
+cpan/Pod-Simple/lib/Pod/Simple/XHTML.pm			turn Pod into XHTML
+cpan/Pod-Simple/lib/Pod/Simple/XMLOutStream.pm		turn Pod into XML
+cpan/Pod-Simple/README					Pod::Simple README file
+cpan/Pod-Simple/t/00about.t				Pod::Simple test file
+cpan/Pod-Simple/t/20_skip.t				Pod::Simple test file
+cpan/Pod-Simple/t/accept01.t				Pod::Simple test file
+cpan/Pod-Simple/t/accept05.t				Pod::Simple test file
+cpan/Pod-Simple/t/ac_d.t				Pod::Simple test file
+cpan/Pod-Simple/t/basic.t				Pod::Simple test file
+cpan/Pod-Simple/t/begin.t				Pod::Simple test file
+cpan/Pod-Simple/t/cbacks.t				Pod::Simple test file
+cpan/Pod-Simple/t/chunking.t				Pod::Simple test file
+cpan/Pod-Simple/t/closeys.t				Pod::Simple test file
+cpan/Pod-Simple/t/corpus/2202jp.txt			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/2202jp.xml			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/2202jpx.txt			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/2202jpx.xml			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/2202jpy.txt			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/2202jpy.xml			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/2202jpz.txt			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/2202jpz.xml			Pod::Simple test file
+cpan/Pod-Simple/t/corpus2/fiqhakbar_iso6.txt		Pod::Simple test file
+cpan/Pod-Simple/t/corpus2/fiqhakbar_iso6.xml		Pod::Simple test file
+cpan/Pod-Simple/t/corpus2/polish_implicit_utf8.txt	Pod::Simple test file
+cpan/Pod-Simple/t/corpus2/polish_utf16be_bom.txt	Pod::Simple test file
+cpan/Pod-Simple/t/corpus2/polish_utf16le_bom.txt	Pod::Simple test file
+cpan/Pod-Simple/t/corpus2/polish_utf8_bom2.txt		Pod::Simple test file
+cpan/Pod-Simple/t/corpus2/polish_utf8_bom2.xml		Pod::Simple test file
+cpan/Pod-Simple/t/corpus2/polish_utf8_bom.txt		Pod::Simple test file
+cpan/Pod-Simple/t/corpus2/polish_utf8_bom.xml		Pod::Simple test file
+cpan/Pod-Simple/t/corpus2/README			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/8859_7.pod			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/8859_7.xml			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/cp1256.txt			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/cp1256.xml			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/fet_cont.txt			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/fet_cont.xml			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/fet_dup.txt			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/fet_dup.xml			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/iso6.txt			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/iso6.xml			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/koi8r.txt			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/koi8r.xml			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/laozi38b.txt			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/laozi38b.xml			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/laozi38p.pod			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/laozi38p.xml			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/laozi38.txt			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/laozi38.xml			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/lat1frim.txt			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/lat1frim.xml			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/lat1fr.txt			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/lat1fr.xml			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/nonesuch.txt			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/nonesuch.xml			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/pasternak_cp1251.txt		Pod::Simple test file
+cpan/Pod-Simple/t/corpus/pasternak_cp1251.xml		Pod::Simple test file
+cpan/Pod-Simple/t/corpus/plain_explicit.txt		Pod::Simple test file
+cpan/Pod-Simple/t/corpus/plain_explicit.xml		Pod::Simple test file
+cpan/Pod-Simple/t/corpus/plain_latin1.txt		Pod::Simple test file
+cpan/Pod-Simple/t/corpus/plain_latin1.xml		Pod::Simple test file
+cpan/Pod-Simple/t/corpus/plain.txt			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/plain_utf8.txt			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/plain_utf8.xml			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/plain.xml			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/polish_utf8.txt		Pod::Simple test file
+cpan/Pod-Simple/t/corpus/polish_utf8.xml		Pod::Simple test file
+cpan/Pod-Simple/t/corpus/s2763_sjis.txt			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/s2763_sjis.xml			Pod::Simple test file
+cpan/Pod-Simple/t/corpus.t				Pod::Simple test file
+cpan/Pod-Simple/t/corpus/thai_iso11.txt			Pod::Simple test file
+cpan/Pod-Simple/t/corpus/thai_iso11.xml			Pod::Simple test file
+cpan/Pod-Simple/t/encod01.t				Pod::Simple test file
+cpan/Pod-Simple/t/encod02.t				Pod::Simple test file
+cpan/Pod-Simple/t/encod03.t				Pod::Simple test file
+cpan/Pod-Simple/t/end_over.t				Pod::Simple test file
+cpan/Pod-Simple/t/fcodes_e.t				Pod::Simple test file
+cpan/Pod-Simple/t/fcodes_l.t				Pod::Simple test file
+cpan/Pod-Simple/t/fcodes_s.t				Pod::Simple test file
+cpan/Pod-Simple/t/fcodes.t				Pod::Simple test file
+cpan/Pod-Simple/t/fornot.t				Pod::Simple test file
+cpan/Pod-Simple/t/for.t					Pod::Simple test file
+cpan/Pod-Simple/t/heads.t				Pod::Simple test file
+cpan/Pod-Simple/t/html01.t				Pod::Simple test file
+cpan/Pod-Simple/t/html02.t				Pod::Simple test file
+cpan/Pod-Simple/t/html03.t				Pod::Simple test file
+cpan/Pod-Simple/t/htmlbat.t				Pod::Simple test file
+cpan/Pod-Simple/t/items02.t				Pod::Simple test file
+cpan/Pod-Simple/t/items.t				Pod::Simple test file
+cpan/Pod-Simple/t/itemstar.t				Pod::Simple test file
+cpan/Pod-Simple/t/junk1o.txt				Pod::Simple test file
+cpan/Pod-Simple/t/junk1.pod				Pod::Simple test file
+cpan/Pod-Simple/t/junk2o.txt				Pod::Simple test file
+cpan/Pod-Simple/t/junk2.pod				Pod::Simple test file
+cpan/Pod-Simple/t/linkclas.t				Pod::Simple test file
+cpan/Pod-Simple/t/perlcygo.txt				Pod::Simple test file
+cpan/Pod-Simple/t/perlcyg.pod				Pod::Simple test file
+cpan/Pod-Simple/t/perlfaqo.txt				Pod::Simple test file
+cpan/Pod-Simple/t/perlfaq.pod				Pod::Simple test file
+cpan/Pod-Simple/t/perlvaro.txt				Pod::Simple test file
+cpan/Pod-Simple/t/perlvar.pod				Pod::Simple test file
+cpan/Pod-Simple/t/puller.t				Pod::Simple test file
+cpan/Pod-Simple/t/pulltitl.t				Pod::Simple test file
+cpan/Pod-Simple/t/reinit.t				Pod::Simple test file
+cpan/Pod-Simple/t/render.t				Pod::Simple test file
+cpan/Pod-Simple/t/search05.t				Pod::Simple test file
+cpan/Pod-Simple/t/search10.t				Pod::Simple test file
+cpan/Pod-Simple/t/search12.t				Pod::Simple test file
+cpan/Pod-Simple/t/search20.t				Pod::Simple test file
+cpan/Pod-Simple/t/search22.t				Pod::Simple test file
+cpan/Pod-Simple/t/search25.t				Pod::Simple test file
+cpan/Pod-Simple/t/search26.t				Pod::Simple test file
+cpan/Pod-Simple/t/search27.t				Pod::Simple test file
+cpan/Pod-Simple/t/search28.t				Pod::Simple test file
+cpan/Pod-Simple/t/search29.t				Pod::Simple test file
+cpan/Pod-Simple/t/search50.t				Pod::Simple test file
+cpan/Pod-Simple/t/stree.t				Pod::Simple test file
+cpan/Pod-Simple/t/strpvbtm.t				Pod::Simple test file
+cpan/Pod-Simple/t/testlib1/Blorm.pm			Pod::Simple test file
+cpan/Pod-Simple/t/testlib1/hinkhonk/Glunk.pod		Pod::Simple test file
+cpan/Pod-Simple/t/testlib1/hinkhonk/readme.txt		Pod::Simple test file
+cpan/Pod-Simple/t/testlib1/hinkhonk/Vliff.pm		Pod::Simple test file
+cpan/Pod-Simple/t/testlib1/pod/perlflif.pod		Pod::Simple test file
+cpan/Pod-Simple/t/testlib1/pod/perlthng.pod		Pod::Simple test file
+cpan/Pod-Simple/t/testlib1/squaa/Glunk.pod		Pod::Simple test file
+cpan/Pod-Simple/t/testlib1/squaa.pm			Pod::Simple test file
+cpan/Pod-Simple/t/testlib1/squaa/Vliff.pm		Pod::Simple test file
+cpan/Pod-Simple/t/testlib1/zikzik.pod			Pod::Simple test file
+cpan/Pod-Simple/t/testlib1/Zonk/Fiddle.txt		Pod::Simple test file
+cpan/Pod-Simple/t/testlib1/Zonk/Pronk.pm		Pod::Simple test file
+cpan/Pod-Simple/t/testlib1/Zonk/Veng.pm			Pod::Simple test file
+cpan/Pod-Simple/t/testlib2/hinkhonk/Glunk.pod		Pod::Simple test file
+cpan/Pod-Simple/t/testlib2/hinkhonk/readme.txt		Pod::Simple test file
+cpan/Pod-Simple/t/testlib2/hinkhonk/Vliff.pm		Pod::Simple test file
+cpan/Pod-Simple/t/testlib2/pod/perlthng.pod		Pod::Simple test file
+cpan/Pod-Simple/t/testlib2/pod/perlzuk.pod		Pod::Simple test file
+cpan/Pod-Simple/t/testlib2/squaa/Vliff.pm		Pod::Simple test file
+cpan/Pod-Simple/t/testlib2/squaa/Wowo.pod		Pod::Simple test file
+cpan/Pod-Simple/t/testlib2/Suzzle.pm			Pod::Simple test file
+cpan/Pod-Simple/t/testlib3/squaa/Vliff.pm		Pod::Simple test file
+cpan/Pod-Simple/t/tiedfh.t				Pod::Simple test file
+cpan/Pod-Simple/t/verbatim.t				Pod::Simple test file
+cpan/Pod-Simple/t/verb_fmt.t				Pod::Simple test file
+cpan/Pod-Simple/t/xhtml01.t				Pod::Simple test file
+cpan/Pod-Simple/t/xhtml05.t				Pod::Simple test file
+cpan/Pod-Simple/t/xhtml10.t				Pod::Simple test file
+cpan/Pod-Simple/t/x_nixer.t				Pod::Simple test file
+cpan/Shell/Shell.pm		Make AUTOLOADed system() calls
+cpan/Shell/t/Shell.t		Tests for above
+cpan/Sys-Syslog/Changes			Changlog for Sys::Syslog
+cpan/Sys-Syslog/fallback/const-c.inc	Sys::Syslog constants fallback file
+cpan/Sys-Syslog/fallback/const-xs.inc	Sys::Syslog constants fallback file
+cpan/Sys-Syslog/fallback/syslog.h	Sys::Syslog header fallback file
+cpan/Sys-Syslog/Makefile.PL		Sys::Syslog extension makefile writer
+cpan/Sys-Syslog/README			README for Sys::Syslog
+cpan/Sys-Syslog/README.win32		README for Sys::Syslog on Windows
+cpan/Sys-Syslog/Syslog.pm		Sys::Syslog extension Perl module
+cpan/Sys-Syslog/Syslog.xs		Sys::Syslog extension external subroutines
+cpan/Sys-Syslog/t/00-load.t		test for Sys::Syslog
+cpan/Sys-Syslog/t/constants.t		test for Sys::Syslog
+cpan/Sys-Syslog/t/syslog.t		See if Sys::Syslog works
+cpan/Sys-Syslog/win32/compile.pl	Sys::Syslog extension Win32 related file
+cpan/Sys-Syslog/win32/PerlLog_dll.uu	Sys::Syslog extension Win32 related file
+cpan/Sys-Syslog/win32/PerlLog.mc	Sys::Syslog extension Win32 related file
+cpan/Sys-Syslog/win32/PerlLog_RES.uu	Sys::Syslog extension Win32 related file
+cpan/Sys-Syslog/win32/Win32.pm		Sys::Syslog extension Win32 related file
+cpan/Term-ANSIColor/ANSIColor.pm	Perl module supporting termcap usage
+cpan/Term-ANSIColor/ChangeLog		Term::ANSIColor
+cpan/Term-ANSIColor/README		Term::ANSIColor
+cpan/Term-ANSIColor/t/basic.t		Tests for Term::ANSIColor
+cpan/Term-Cap/Cap.pm			Perl module supporting termcap usage
+cpan/Term-Cap/test.pl			See if Term::Cap works
+cpan/Term-UI/lib/Term/UI/History.pm	Term::UI
+cpan/Term-UI/lib/Term/UI.pm		Term::UI
+cpan/Term-UI/t/00_load.t		Term::UI tests
+cpan/Term-UI/t/01_history.t		Term::UI tests
+cpan/Term-UI/t/02_ui.t			Term::UI tests
+cpan/Test-Harness/bin/prove				The prove harness utility
+cpan/Test-Harness/Changes				Test::Harness change log
+cpan/Test-Harness/lib/App/Prove.pm			Gubbins for the prove utility
+cpan/Test-Harness/lib/App/Prove/State.pm		Gubbins for the prove utility
+cpan/Test-Harness/lib/App/Prove/State/Result.pm		Gubbins for the prove utility
+cpan/Test-Harness/lib/App/Prove/State/Result/Test.pm	Gubbins for the prove utility
+cpan/Test-Harness/lib/TAP/Base.pm			A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Formatter/Base.pm		A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Formatter/Color.pm		A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Formatter/Console/ParallelSession.pm	A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Formatter/Console.pm		A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Formatter/Console/Session.pm	A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Formatter/File.pm		A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Formatter/File/Session.pm	A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Formatter/Session.pm		A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Harness.pm			A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Object.pm			A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Aggregator.pm		A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Grammar.pm		A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Iterator/Array.pm	A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/IteratorFactory.pm	A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Iterator.pm		A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Iterator/Process.pm	A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Iterator/Stream.pm	A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Multiplexer.pm		A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser.pm			A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Result/Bailout.pm	A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Result/Comment.pm	A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/ResultFactory.pm	A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Result/Plan.pm		A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Result.pm		A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Result/Pragma.pm	A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Result/Test.pm		A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Result/Unknown.pm	A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Result/Version.pm	A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Result/YAML.pm		A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Scheduler/Job.pm	A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Scheduler.pm		A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Scheduler/Spinner.pm	A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Source/Perl.pm		A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Source.pm		A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/Utils.pm		A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/YAMLish/Reader.pm	A parser for Test Anything Protocol
+cpan/Test-Harness/lib/TAP/Parser/YAMLish/Writer.pm	A parser for Test Anything Protocol
+cpan/Test-Harness/lib/Test/Harness.pm			A test harness
+cpan/Test-Harness/t/000-load.t				Test::Harness test
+cpan/Test-Harness/t/aggregator.t			Test::Harness test
+cpan/Test-Harness/t/bailout.t				Test::Harness test
+cpan/Test-Harness/t/base.t				Test::Harness test
+cpan/Test-Harness/t/callbacks.t				Test::Harness test
+cpan/Test-Harness/t/compat/env.t			Test::Harness test
+cpan/Test-Harness/t/compat/failure.t			Test::Harness test
+cpan/Test-Harness/t/compat/inc-propagation.t		Test::Harness test
+cpan/Test-Harness/t/compat/inc_taint.t			Test::Harness test
+cpan/Test-Harness/t/compat/nonumbers.t			Test::Harness test
+cpan/Test-Harness/t/compat/regression.t			Test::Harness test
+cpan/Test-Harness/t/compat/switches.t			Test::Harness test
+cpan/Test-Harness/t/compat/test-harness-compat.t	Test::Harness test
+cpan/Test-Harness/t/compat/version.t			Test::Harness test
+cpan/Test-Harness/t/console.t				Test::Harness test
+cpan/Test-Harness/t/data/catme.1			Test data for Test::Harness
+cpan/Test-Harness/t/data/proverc			Test data for Test::Harness
+cpan/Test-Harness/t/data/sample.yml			Test data for Test::Harness
+cpan/Test-Harness/t/errors.t				Test::Harness test
+cpan/Test-Harness/t/file.t				Test::Harness test
+cpan/Test-Harness/t/glob-to-regexp.t			Test::Harness test
+cpan/Test-Harness/t/grammar.t				Test::Harness test
+cpan/Test-Harness/t/harness-bailout.t			Test::Harness test
+cpan/Test-Harness/t/harness-subclass.t			Test::Harness test
+cpan/Test-Harness/t/harness.t				Test::Harness test
+cpan/Test-Harness/t/iterators.t				Test::Harness test
+cpan/Test-Harness/t/lib/App/Prove/Plugin/Dummy2.pm	Module for testing Test::Harness
+cpan/Test-Harness/t/lib/App/Prove/Plugin/Dummy.pm	Module for testing Test::Harness
+cpan/Test-Harness/t/lib/Dev/Null.pm			Module for testing Test::Harness
+cpan/Test-Harness/t/lib/EmptyParser.pm			Module for testing Test::Harness
+cpan/Test-Harness/t/lib/IO/c55Capture.pm		Module for testing Test::Harness
+cpan/Test-Harness/t/lib/MyCustom.pm			Module for testing Test::Harness
+cpan/Test-Harness/t/lib/MyGrammar.pm			Module for testing Test::Harness
+cpan/Test-Harness/t/lib/MyIteratorFactory.pm		Module for testing Test::Harness
+cpan/Test-Harness/t/lib/MyIterator.pm			Module for testing Test::Harness
+cpan/Test-Harness/t/lib/MyPerlSource.pm			Module for testing Test::Harness
+cpan/Test-Harness/t/lib/MyResultFactory.pm		Module for testing Test::Harness
+cpan/Test-Harness/t/lib/MyResult.pm			Module for testing Test::Harness
+cpan/Test-Harness/t/lib/MySource.pm			Module for testing Test::Harness
+cpan/Test-Harness/t/lib/NoFork.pm			Module for testing Test::Harness
+cpan/Test-Harness/t/lib/NOP.pm				Module for testing Test::Harness
+cpan/Test-Harness/t/lib/TAP/Parser/SubclassTest.pm	Module for testing Test::Harness
+cpan/Test-Harness/t/multiplexer.t			Test::Harness test
+cpan/Test-Harness/t/nofork-mux.t			Test::Harness test
+cpan/Test-Harness/t/nofork.t				Test::Harness test
+cpan/Test-Harness/t/object.t				Test::Harness test
+cpan/Test-Harness/t/parser-config.t			Test::Harness test
+cpan/Test-Harness/t/parser-subclass.t			Test::Harness test
+cpan/Test-Harness/t/parse.t				Test::Harness test
+cpan/Test-Harness/t/perl5lib.t				Test::Harness test
+cpan/Test-Harness/t/premature-bailout.t			Test::Harness test
+cpan/Test-Harness/t/process.t				Test::Harness test
+cpan/Test-Harness/t/proveenv.t				Test::Harness test
+cpan/Test-Harness/t/proverc/emptyexec			Test data for Test::Harness
+cpan/Test-Harness/t/proverc.t				Test::Harness test
+cpan/Test-Harness/t/proverun.t				Test::Harness test
+cpan/Test-Harness/t/prove.t				Test::Harness test
+cpan/Test-Harness/t/regression.t			Test::Harness test
+cpan/Test-Harness/t/results.t				Test::Harness test
+cpan/Test-Harness/t/sample-tests/bailout		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/bignum			Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/bignum_many		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/combined		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/combined_compat	Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/delayed		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/descriptive		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/descriptive_trailing	Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/die			Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/die_head_end		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/die_last_minute	Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/die_unfinished		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/duplicates		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/echo			Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/empty			Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/escape_eol		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/escape_hash		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/head_end		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/head_fail		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/inc_taint		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/junk_before_plan	Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/lone_not_bug		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/no_nums		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/no_output		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/out_err_mix		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/out_of_order		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/schwern		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/schwern-todo-quiet	Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/segfault		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/sequence_misparse	Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/shbang_misparse	Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/simple			Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/simple_fail		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/simple_yaml		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/skip			Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/skipall		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/skipall_nomsg		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/skipall_v13		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/skip_nomsg		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/space_after_plan	Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/stdout_stderr		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/strict			Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/switches		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/taint			Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/taint_warn		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/todo			Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/todo_inline		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/todo_misparse		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/too_many		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/version_good		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/version_late		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/version_old		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/vms_nit		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/with_comments		Test data for Test::Harness
+cpan/Test-Harness/t/sample-tests/zero_valid		Test data for Test::Harness
+cpan/Test-Harness/t/scheduler.t				Test::Harness test
+cpan/Test-Harness/t/source.t				Test::Harness test
+cpan/Test-Harness/t/source_tests/harness		Test data for Test::Harness
+cpan/Test-Harness/t/source_tests/harness_badtap		Test data for Test::Harness
+cpan/Test-Harness/t/source_tests/harness_complain	Test data for Test::Harness
+cpan/Test-Harness/t/source_tests/harness_directives	Test data for Test::Harness
+cpan/Test-Harness/t/source_tests/harness_failure	Test data for Test::Harness
+cpan/Test-Harness/t/source_tests/source			Test data for Test::Harness
+cpan/Test-Harness/t/spool.t				Test::Harness test
+cpan/Test-Harness/t/state_results.t			Test::Harness test
+cpan/Test-Harness/t/state.t				Test::Harness test
+cpan/Test-Harness/t/streams.t				Test::Harness test
+cpan/Test-Harness/t/subclass_tests/non_perl_source	Test data for Test::Harness
+cpan/Test-Harness/t/subclass_tests/perl_source		Test data for Test::Harness
+cpan/Test-Harness/t/taint.t				Test::Harness test
+cpan/Test-Harness/t/testargs.t				Test::Harness test
+cpan/Test-Harness/t/unicode.t				Test::Harness test
+cpan/Test-Harness/t/utils.t				Test::Harness test
+cpan/Test-Harness/t/yamlish-output.t			Test::Harness test
+cpan/Test-Harness/t/yamlish.t				Test::Harness test
+cpan/Test-Harness/t/yamlish-writer.t			Test::Harness test
+cpan/Test/lib/Test.pm		A simple framework for writing test scripts
+cpan/Test-Simple/Changes				Test::Simple changes
+cpan/Test-Simple/examples/indent.pl			Test::Simple examples
+cpan/Test-Simple/examples/subtest.t			Test::Simple examples
+cpan/Test-Simple/lib/Test/Builder/Module.pm		Base class for test modules
+cpan/Test-Simple/lib/Test/Builder.pm			For writing new test libraries
+cpan/Test-Simple/lib/Test/Builder/Tester/Color.pm	Turn on color in Test::Builder::Tester
+cpan/Test-Simple/lib/Test/Builder/Tester.pm		For testing Test::Builder based classes
+cpan/Test-Simple/lib/Test/More.pm			More utilities for writing tests
+cpan/Test-Simple/lib/Test/Simple.pm			Basic utility for writing tests
+cpan/Test-Simple/lib/Test/Tutorial.pod			A tutorial on writing tests
+cpan/Test-Simple/README					Test::Simple README
+cpan/Test-Simple/t/00test_harness_check.t		Test::Simple test
+cpan/Test-Simple/t/bad_plan.t				Test::Builder plan() test
+cpan/Test-Simple/t/bail_out.t				Test::Builder BAIL_OUT test
+cpan/Test-Simple/t/BEGIN_require_ok.t			Test::More require_ok() testing
+cpan/Test-Simple/t/BEGIN_use_ok.t			Test::More use_ok() testing
+cpan/Test-Simple/t/buffer.t				Test::Builder buffering test
+cpan/Test-Simple/t/Builder/Builder.t			Test::Builder tests
+cpan/Test-Simple/t/Builder/carp.t			Test::Builder test
+cpan/Test-Simple/t/Builder/create.t			Test::Builder test
+cpan/Test-Simple/t/Builder/current_test.t		Test::Builder tests
+cpan/Test-Simple/t/Builder/current_test_without_plan.t	Test::Builder tests
+cpan/Test-Simple/t/Builder/details.t			Test::Builder tests
+cpan/Test-Simple/t/Builder/done_testing_double.t		Test::Builder tests
+cpan/Test-Simple/t/Builder/done_testing_plan_mismatch.t	Test::Builder tests
+cpan/Test-Simple/t/Builder/done_testing.t		Test::Builder tests
+cpan/Test-Simple/t/Builder/done_testing_with_no_plan.t	Test::Builder tests
+cpan/Test-Simple/t/Builder/done_testing_with_number.t	Test::Builder tests
+cpan/Test-Simple/t/Builder/done_testing_with_plan.t	Test::Builder tests
+cpan/Test-Simple/t/Builder/fork_with_new_stdout.t	Test::Builder tests
+cpan/Test-Simple/t/Builder/has_plan2.t			Test::Builder tests
+cpan/Test-Simple/t/Builder/has_plan.t			Test::Builder tests
+cpan/Test-Simple/t/Builder/is_fh.t			Test::Builder tests
+cpan/Test-Simple/t/Builder/is_passing.t			Test::Builder tests
+cpan/Test-Simple/t/Builder/maybe_regex.t		Test::Builder tests
+cpan/Test-Simple/t/Builder/no_diag.t			Test::Builder tests
+cpan/Test-Simple/t/Builder/no_ending.t			Test::Builder tests
+cpan/Test-Simple/t/Builder/no_header.t			Test::Builder tests
+cpan/Test-Simple/t/Builder/no_plan_at_all.t		Test::Builder tests
+cpan/Test-Simple/t/Builder/ok_obj.t			Test::Builder tests
+cpan/Test-Simple/t/Builder/output.t			Test::Builder tests
+cpan/Test-Simple/t/Builder/reset.t			Test::Builder tests
+cpan/Test-Simple/t/Builder/try.t			Test::Builder tests
+cpan/Test-Simple/t/c_flag.t				Test::Simple test
+cpan/Test-Simple/t/circular_data.t			Test::Simple test
+cpan/Test-Simple/t/cmp_ok.t				Test::More test
+cpan/Test-Simple/t/dependents.t				Test::More test
+cpan/Test-Simple/t/diag.t				Test::More diag() test
+cpan/Test-Simple/t/died.t				Test::Simple test
+cpan/Test-Simple/t/dont_overwrite_die_handler.t		Test::More tests
+cpan/Test-Simple/t/eq_set.t				Test::Simple test
+cpan/Test-Simple/t/exit.t				Test::Simple test, exit codes
+cpan/Test-Simple/t/explain.t				Test::Simple test
+cpan/Test-Simple/t/extra_one.t				Test::Simple test
+cpan/Test-Simple/t/extra.t				Test::Simple test
+cpan/Test-Simple/t/fail-like.t				Test::More test, like() failures
+cpan/Test-Simple/t/fail-more.t				Test::More test, tests failing
+cpan/Test-Simple/t/fail_one.t				Test::Simple test
+cpan/Test-Simple/t/fail.t				Test::Simple test, test failures
+cpan/Test-Simple/t/filehandles.t			Test::Simple test, STDOUT can be played with
+cpan/Test-Simple/t/fork.t				Test::More fork tests
+cpan/Test-Simple/t/harness_active.t			Test::Simple test
+cpan/Test-Simple/t/import.t				Test::More test, importing functions
+cpan/Test-Simple/t/is_deeply_dne_bug.t			Test::More test
+cpan/Test-Simple/t/is_deeply_fail.t			Test::More test, is_deeply()
+cpan/Test-Simple/t/is_deeply_with_threads.t		Test::More test
+cpan/Test-Simple/t/lib/Dev/Null.pm			Test::More test module
+cpan/Test-Simple/t/lib/Dummy.pm				Test::More test module
+cpan/Test-Simple/t/lib/MyOverload.pm			Test::More test module
+cpan/Test-Simple/t/lib/NoExporter.pm			Test::Simple test module
+cpan/Test-Simple/t/lib/SigDie.pm			Test module for Test::More
+cpan/Test-Simple/t/lib/Test/Builder/NoOutput.pm		Utility module for testing Test::Builder
+cpan/Test-Simple/t/lib/Test/Simple/Catch.pm		Utility module for testing Test::Simple
+cpan/Test-Simple/t/lib/Test/Simple/sample_tests/death_in_eval.plx	for exit.t
+cpan/Test-Simple/t/lib/Test/Simple/sample_tests/death.plx		for exit.t
+cpan/Test-Simple/t/lib/Test/Simple/sample_tests/death_with_handler.plx	for exit.t
+cpan/Test-Simple/t/lib/Test/Simple/sample_tests/exit.plx			for exit.t
+cpan/Test-Simple/t/lib/Test/Simple/sample_tests/extras.plx		for exit.t
+cpan/Test-Simple/t/lib/Test/Simple/sample_tests/five_fail.plx		for exit.t
+cpan/Test-Simple/t/lib/Test/Simple/sample_tests/last_minute_death.plx	for exit.t
+cpan/Test-Simple/t/lib/Test/Simple/sample_tests/one_fail.plx		for exit.t
+cpan/Test-Simple/t/lib/Test/Simple/sample_tests/pre_plan_death.plx	for exit.t
+cpan/Test-Simple/t/lib/Test/Simple/sample_tests/require.plx		for exit.t
+cpan/Test-Simple/t/lib/Test/Simple/sample_tests/success.plx		for exit.t
+cpan/Test-Simple/t/lib/Test/Simple/sample_tests/too_few_fail.plx		for exit.t
+cpan/Test-Simple/t/lib/Test/Simple/sample_tests/too_few.plx		for exit.t
+cpan/Test-Simple/t/lib/Test/Simple/sample_tests/two_fail.plx		for exit.t
+cpan/Test-Simple/t/lib/TieOut.pm			Testing library to capture prints
+cpan/Test-Simple/t/missing.t				Test::Simple test, missing tests
+cpan/Test-Simple/t/More.t				Test::More test, basic stuff
+cpan/Test-Simple/t/new_ok.t				Test::More test
+cpan/Test-Simple/t/no_plan.t				Test::Simple test, forgot the plan
+cpan/Test-Simple/t/no_tests.t				Test::More test
+cpan/Test-Simple/t/note.t				Test::More test
+cpan/Test-Simple/TODO					Test::Simple TODO
+cpan/Test-Simple/t/overload.t				Test::Simple test
+cpan/Test-Simple/t/overload_threads.t			Test::Simple test
+cpan/Test-Simple/t/plan_bad.t				Test::Simple test
+cpan/Test-Simple/t/plan_is_noplan.t			Test::Simple test, no_plan
+cpan/Test-Simple/t/plan_no_plan.t			Test::More test, plan() w/no_plan
+cpan/Test-Simple/t/plan_shouldnt_import.t		Test::Simple test
+cpan/Test-Simple/t/plan_skip_all.t			Test::More test, plan() w/skip_all
+cpan/Test-Simple/t/plan.t				Test::More test, plan()
+cpan/Test-Simple/t/require_ok.t				Test::Simple test
+cpan/Test-Simple/t/simple.t				Test::Simple test, basic stuff
+cpan/Test-Simple/t/skipall.t				Test::More test, skip all tests
+cpan/Test-Simple/t/skip.t				Test::More test, SKIP tests
+cpan/Test-Simple/t/subtest/args.t			Test::More test
+cpan/Test-Simple/t/subtest/basic.t			Test::More test
+cpan/Test-Simple/t/subtest/die.t			Test::More test
+cpan/Test-Simple/t/subtest/do.t				Test::More test
+cpan/Test-Simple/t/subtest/exceptions.t			Test::More test
+cpan/Test-Simple/t/subtest/for_do_t.test		Test::More test
+cpan/Test-Simple/t/subtest/singleton.t			Test::More test
+cpan/Test-Simple/t/tbm_doesnt_set_exported_to.t		Test::Builder::Module test
+cpan/Test-Simple/t/Tester/tbt_01basic.t			Test::Builder::Tester test
+cpan/Test-Simple/t/Tester/tbt_02fhrestore.t		Test::Builder::Tester test
+cpan/Test-Simple/t/Tester/tbt_03die.t			Test::Builder::Tester test
+cpan/Test-Simple/t/Tester/tbt_04line_num.t		Test::Builder::Tester test
+cpan/Test-Simple/t/Tester/tbt_05faildiag.t		Test::Builder::Tester test
+cpan/Test-Simple/t/Tester/tbt_06errormess.t		Test::Builder::Tester test
+cpan/Test-Simple/t/Tester/tbt_07args.t			Test::Builder::Tester test
+cpan/Test-Simple/t/threads.t				Test::Builder thread-safe checks
+cpan/Test-Simple/t/thread_taint.t			Test::Simple test
+cpan/Test-Simple/t/todo.t				Test::More test, TODO tests
+cpan/Test-Simple/t/undef.t				Test::More test, undefs don't cause warnings
+cpan/Test-Simple/t/useing.t				Test::More test, compile test
+cpan/Test-Simple/t/use_ok.t				Test::More test, use_ok()
+cpan/Test-Simple/t/utf8.t				Test::More test
+cpan/Test-Simple/t/versions.t				Test::More test
+cpan/Test/t/05_about_verbose.t	See if Test works
+cpan/Test/t/fail.t		See if Test works
+cpan/Test/t/mix.t		See if Test works
+cpan/Test/t/multiline.t		See if Test works
+cpan/Test/t/onfail.t		See if Test works
+cpan/Test/t/qr.t		See if Test works
+cpan/Test/t/skip.t		See if Test works
+cpan/Test/t/success.t		See if Test works
+cpan/Test/t/todo.t		See if Test works
+cpan/Text-Balanced/Changes		Text::Balanced
+cpan/Text-Balanced/lib/Text/Balanced.pm	Text::Balanced
+cpan/Text-Balanced/README		Text::Balanced
+cpan/Text-Balanced/t/01_compile.t	See if Text::Balanced works
+cpan/Text-Balanced/t/02_extbrk.t	See if Text::Balanced works
+cpan/Text-Balanced/t/03_extcbk.t	See if Text::Balanced works
+cpan/Text-Balanced/t/04_extdel.t	See if Text::Balanced works
+cpan/Text-Balanced/t/05_extmul.t	See if Text::Balanced works
+cpan/Text-Balanced/t/06_extqlk.t	See if Text::Balanced works
+cpan/Text-Balanced/t/07_exttag.t	See if Text::Balanced works
+cpan/Text-Balanced/t/08_extvar.t	See if Text::Balanced works
+cpan/Text-Balanced/t/09_gentag.t	See if Text::Balanced works
+cpan/Text-ParseWords/lib/Text/ParseWords.pm	Perl module to split words on arbitrary delimiter
+cpan/Text-ParseWords/t/ParseWords.t		See if Text::ParseWords works
+cpan/Text-ParseWords/t/taint.t			See if Text::ParseWords works with tainting
+cpan/Text-Soundex/Changes	Changelog for Text::Soundex
+cpan/Text-Soundex/README	README for Text::Soundex
+cpan/Text-Soundex/Soundex.pm	Text::Soundex extension Perl module
+cpan/Text-Soundex/Soundex.xs	Text::Soundex extension external subroutines
+cpan/Text-Soundex/t/Soundex.t	test for Text::Soundex
+cpan/Text-Tabs/CHANGELOG		ChangeLog for Tabs+Wrap
+cpan/Text-Tabs/lib/Text/Tabs.pm		Do expand and unexpand
+cpan/Text-Tabs/lib/Text/Wrap.pm		Paragraph formatter
+cpan/Text-Tabs/t/37000.t		See if Text::Tabs is working
+cpan/Text-Tabs/t/39548.t		See if Text::Tabs is working
+cpan/Text-Tabs/t/belg4mit.t		See if Text::Tabs is working
+cpan/Text-Tabs/t/dandv.t		See if Text::Tabs is working
+cpan/Text-Tabs/t/fill.t			See if Text::Wrap::fill works
+cpan/Text-Tabs/t/Jacobson2.t		See if Text::Tabs is working
+cpan/Text-Tabs/t/Jacobson.t		See if Text::Tabs is working
+cpan/Text-Tabs/t/Jochen.t		See if Text::Tabs is working
+cpan/Text-Tabs/t/sep2.t			See if Text::Tabs is working
+cpan/Text-Tabs/t/sep.t			See if Text::Tabs is working
+cpan/Text-Tabs/t/tabs.t			See if Text::Tabs works
+cpan/Text-Tabs/t/wrap_separator2.t	See if Text::Wrap::wrap works
+cpan/Text-Tabs/t/wrap.t			See if Text::Wrap::wrap works
+cpan/Tie-File/lib/Tie/File.pm		Files as tied arrays
+cpan/Tie-File/t/00_version.t		Trivial test for Tie::File
+cpan/Tie-File/t/01_gen.t		Generic read/write tests for Tie::File
+cpan/Tie-File/t/02_fetchsize.t		File length fetch test for Tie::File
+cpan/Tie-File/t/03_longfetch.t		Past-the-end-of-the-array tests for Tie::File
+cpan/Tie-File/t/04_splice.t		SPLICE method tests for Tie::File
+cpan/Tie-File/t/05_size.t		$#a tests for Tie::File
+cpan/Tie-File/t/06_fixrec.t		'_fixrec' method functional tests for Tie::File
+cpan/Tie-File/t/07_rv_splice.t		SPLICE method return value tests for Tie::File
+cpan/Tie-File/t/08_ro.t			read-only mode tests for Tie::File
+cpan/Tie-File/t/09_gen_rs.t		Like 01_gen.t, with unusual record separator
+cpan/Tie-File/t/10_splice_rs.t		Like 04_splice.t, with unusual record separator
+cpan/Tie-File/t/11_rv_splice_rs.t	Like 07_rv_splice.t, with unusual record separator
+cpan/Tie-File/t/12_longfetch_rs.t	Like 03_longfetch.t, with unusual record separator
+cpan/Tie-File/t/13_size_rs.t		Like 05_size.t, with unusual record separator
+cpan/Tie-File/t/14_lock.t		File locking method tests for Tie::File
+cpan/Tie-File/t/15_pushpop.t		PUSH / POP / SHIFT / UNSHIFT for Tie::File
+cpan/Tie-File/t/16_handle.t		Tying a handle instead of a file for Tie::File
+cpan/Tie-File/t/17_misc_meth.t		CLEAR / EXISTS / DELETE / EXTEND for Tie::File
+cpan/Tie-File/t/18_rs_fixrec.t		Like 06_fixrec.t, with unusual record separator
+cpan/Tie-File/t/19_cache.t		Read cache exercises and regression for Tie::File
+cpan/Tie-File/t/20_cache_full.t		LRU expiry exercises and regression for Tie::File
+cpan/Tie-File/t/21_win32.t		Win32 special behavior of Tie::File
+cpan/Tie-File/t/22_autochomp.t		'autochomp' option of Tie::File
+cpan/Tie-File/t/23_rv_ac_splice.t	Like 07_rv_splice.t, but with autochomp
+cpan/Tie-File/t/24_cache_loop.t		Regression for old Tie::File cache bug
+cpan/Tie-File/t/25_gen_nocache.t	Like 01_gen.t, but with caching disabled
+cpan/Tie-File/t/26_twrite.t		Unit tests for Tie::File::_twrite
+cpan/Tie-File/t/27_iwrite.t		Unit tests for Tie::File::_iwrite
+cpan/Tie-File/t/28_mtwrite.t		Unit tests for Tie::File::_mtwrite
+cpan/Tie-File/t/29a_upcopy.t		Unit tests for Tie::File::_upcopy
+cpan/Tie-File/t/29_downcopy.t		Unit tests for Tie::File::_downcopy
+cpan/Tie-File/t/30_defer.t		deferred writing feature tests for Tie::File
+cpan/Tie-File/t/31_autodefer.t		'autodefer' feature tests for Tie::File
+cpan/Tie-File/t/32_defer_misc.t		Like 17_misc_meth.t, but with deferred writing
+cpan/Tie-File/t/33_defer_vs.t		Like 30_defer.t, but with varying-length records
+cpan/Tie-File/t/40_abs_cache.t		Unit tests for Tie::File::Cache
+cpan/Tie-File/t/41_heap.t		Unit tests for Tie::File::Heap
+cpan/Tie-File/t/42_offset.t		Unit tests for the offset method
+cpan/Tie-RefHash/lib/Tie/RefHash.pm		Base class for tied hashes with references as keys
+cpan/Tie-RefHash/t/rebless.t	Test for Tie::RefHash with rebless
+cpan/Tie-RefHash/t/refhash.t	Test for Tie::RefHash and Tie::RefHash::Nestable
+cpan/Tie-RefHash/t/storable.t	Test for Tie::RefHash with storable
+cpan/Tie-RefHash/t/threaded.t	Test for Tie::RefHash with threads
+cpan/Time-HiRes/Changes			Time::HiRes extension
+cpan/Time-HiRes/fallback/const-c.inc	Time::HiRes extension
+cpan/Time-HiRes/fallback/const-xs.inc	Time::HiRes extension
+cpan/Time-HiRes/hints/aix.pl		Hint for Time::HiRes for named architecture
+cpan/Time-HiRes/hints/dec_osf.pl	Hint for Time::HiRes for named architecture
+cpan/Time-HiRes/hints/dynixptx.pl	Hint for Time::HiRes for named architecture
+cpan/Time-HiRes/hints/irix.pl		Hint for Time::HiRes for named architecture
+cpan/Time-HiRes/hints/linux.pl		Hints for Time::HiRes for named architecture
+cpan/Time-HiRes/hints/sco.pl		Hints for Time::HiRes for named architecture
+cpan/Time-HiRes/hints/solaris.pl	Hints for Time::HiRes for named architecture
+cpan/Time-HiRes/hints/svr4.pl		Hints for Time::HiRes for named architecture
+cpan/Time-HiRes/HiRes.pm		Time::HiRes extension
+cpan/Time-HiRes/HiRes.xs		Time::HiRes extension
+cpan/Time-HiRes/Makefile.PL		Time::HiRes extension
+cpan/Time-HiRes/t/HiRes.t		Test for Time::HiRes
+cpan/Time-HiRes/typemap			Time::HiRes extension
+cpan/Time-Piece/Changes		Time::Piece extension
+cpan/Time-Piece/Makefile.PL	Time::Piece extension
+cpan/Time-Piece/Piece.pm	Time::Piece extension
+cpan/Time-Piece/Piece.xs	Time::Piece extension
+cpan/Time-Piece/README		Time::Piece extension
+cpan/Time-Piece/Seconds.pm	Time::Piece extension
+cpan/Time-Piece/t/01base.t	Test for Time::Piece
+cpan/Time-Piece/t/02core.t	Test for Time::Piece
+cpan/Time-Piece/t/03compare.t	Test for Time::Piece
+cpan/Time-Piece/t/04mjd.t	Test for Time::Piece
+cpan/Time-Piece/t/05overload.t	Test for Time::Piece
+cpan/Time-Piece/t/06subclass.t	Test for Time::Piece
+cpan/Time-Piece/t/07arith.t	Test for Time::Piece
+cpan/Unicode-Collate/Changes			Unicode::Collate
+cpan/Unicode-Collate/Collate/allkeys.txt	Unicode::Collate
+cpan/Unicode-Collate/Collate/keys.txt		Unicode::Collate
+cpan/Unicode-Collate/Collate.pm			Unicode::Collate
+cpan/Unicode-Collate/README			Unicode::Collate
+cpan/Unicode-Collate/t/altern.t			Unicode::Collate
+cpan/Unicode-Collate/t/cjkrange.t		Unicode::Collate
+cpan/Unicode-Collate/t/contract.t		Unicode::Collate
+cpan/Unicode-Collate/t/hangtype.t		Unicode::Collate
+cpan/Unicode-Collate/t/hangul.t			Unicode::Collate
+cpan/Unicode-Collate/t/ignor.t			Unicode::Collate
+cpan/Unicode-Collate/t/illegalp.t		Unicode::Collate
+cpan/Unicode-Collate/t/illegal.t		Unicode::Collate
+cpan/Unicode-Collate/t/index.t			Unicode::Collate
+cpan/Unicode-Collate/t/normal.t			Unicode::Collate
+cpan/Unicode-Collate/t/override.t		Unicode::Collate
+cpan/Unicode-Collate/t/rearrang.t		Unicode::Collate
+cpan/Unicode-Collate/t/test.t			Unicode::Collate
+cpan/Unicode-Collate/t/trailwt.t		Unicode::Collate
+cpan/Unicode-Collate/t/variable.t		Unicode::Collate
+cpan/Unicode-Collate/t/version.t		Unicode::Collate
+cpan/Unicode-Collate/t/view.t			Unicode::Collate
+cpan/Unicode-Normalize/Changes		Unicode::Normalize
+cpan/Unicode-Normalize/Makefile.PL	Unicode::Normalize
+cpan/Unicode-Normalize/mkheader		Unicode::Normalize
+cpan/Unicode-Normalize/Normalize.pm	Unicode::Normalize
+cpan/Unicode-Normalize/Normalize.xs	Unicode::Normalize
+cpan/Unicode-Normalize/README		Unicode::Normalize
+cpan/Unicode-Normalize/t/fcdc.t		Unicode::Normalize
+cpan/Unicode-Normalize/t/form.t		Unicode::Normalize
+cpan/Unicode-Normalize/t/func.t		Unicode::Normalize
+cpan/Unicode-Normalize/t/illegal.t	Unicode::Normalize
+cpan/Unicode-Normalize/t/norm.t		Unicode::Normalize
+cpan/Unicode-Normalize/t/null.t		Unicode::Normalize
+cpan/Unicode-Normalize/t/proto.t	Unicode::Normalize
+cpan/Unicode-Normalize/t/split.t	Unicode::Normalize
+cpan/Unicode-Normalize/t/test.t		Unicode::Normalize
+cpan/Unicode-Normalize/t/tie.t		Unicode::Normalize
+cpan/Win32API-File/buffers.h	Win32API::File extension
+cpan/Win32API-File/cFile.h	Win32API::File extension
+cpan/Win32API-File/cFile.pc	Win32API::File extension
+cpan/Win32API-File/Changes	Win32API::File extension changes
+cpan/Win32API-File/const2perl.h	Win32API::File extension
+cpan/Win32API-File/ExtUtils/Myconst2perl.pm	Win32API::File extension
+cpan/Win32API-File/File.pm	Win32API::File extension
+cpan/Win32API-File/File.xs	Win32API::File extension
+cpan/Win32API-File/Makefile.PL	Win32API::File extension makefile write
+cpan/Win32API-File/README	Win32API::File extension Readme
+cpan/Win32API-File/t/file.t	See if Win32API::File extension works
+cpan/Win32API-File/t/tie.t	See if Win32API::File extension works
+cpan/Win32API-File/typemap	Win32API::File extension interface types
+cpan/Win32/Changes			Changes for Win32 extension module
+cpan/Win32/longpath.inc			Win32 extension long path support
+cpan/Win32/Makefile.PL			Win32 extension makefile writer
+cpan/Win32/t/CreateFile.t		See if Win32 extension works
+cpan/Win32/t/ExpandEnvironmentStrings.t	See if Win32 extension works
+cpan/Win32/t/GetCurrentThreadId.t	See if Win32 extension works
+cpan/Win32/t/GetFileVersion.t		See if Win32 extension works
+cpan/Win32/t/GetFolderPath.t		See if Win32 extension works
+cpan/Win32/t/GetFullPathName.t		See if Win32 extension works
+cpan/Win32/t/GetLongPathName.t		See if Win32 extension works
+cpan/Win32/t/GetOSName.t		See if Win32 extension works
+cpan/Win32/t/GetOSVersion.t		See if Win32 extension works
+cpan/Win32/t/GetShortPathName.t		See if Win32 extension works
+cpan/Win32/t/GuidGen.t			See if Win32 extension works
+cpan/Win32/t/Names.t			See if Win32 extension works
+cpan/Win32/t/Unicode.t			See if Win32 extension works
+cpan/Win32/Win32.pm			Win32 extension Perl module
+cpan/Win32/Win32.xs			Win32 extension external subroutines
+Cross/build-arm-n770-sh		Cross-compilation
+Cross/cflags-cross-arm		Cross-compilation
+Cross/config			Cross-compilation
 Cross/config.sh-arm-linux	Cross-compilation
 Cross/config.sh-arm-linux-n770	Cross-compilation
 Cross/generate_config_sh	Cross-compilation
 Cross/installperl.patch		Cross-compilation
-Cross/Makefile		Cross-compilation
-Cross/Makefile-cross-SH	Cross-compilation
-Cross/Makefile.SH.patch	Cross-compilation
-Cross/README		Cross-compilation
-Cross/README.new	Cross-compilation
-Cross/TODO		Cross-compilation
-Cross/warp		Cross-compilation
-cv.h			Code value header
-cygwin/cygwin.c		Additional code for Cygwin port
-deb.c			Debugging routines
+Cross/Makefile			Cross-compilation
+Cross/Makefile-cross-SH		Cross-compilation
+Cross/Makefile.SH.patch		Cross-compilation
+Cross/README			Cross-compilation
+Cross/README.new		Cross-compilation
+Cross/TODO			Cross-compilation
+Cross/warp			Cross-compilation
+cv.h				Code value header
+cygwin/cygwin.c			Additional code for Cygwin port
+deb.c				Debugging routines
+dist/Attribute-Handlers/Changes				Attribute::Handlers
+dist/Attribute-Handlers/demo/demo2.pl			Attribute::Handlers demo
+dist/Attribute-Handlers/demo/demo3.pl			Attribute::Handlers demo
+dist/Attribute-Handlers/demo/demo4.pl			Attribute::Handlers demo
+dist/Attribute-Handlers/demo/demo_call.pl		Attribute::Handlers demo
+dist/Attribute-Handlers/demo/demo_chain.pl		Attribute::Handlers demo
+dist/Attribute-Handlers/demo/demo_cycle.pl		Attribute::Handlers demo
+dist/Attribute-Handlers/demo/demo_hashdir.pl		Attribute::Handlers demo
+dist/Attribute-Handlers/demo/demo_phases.pl		Attribute::Handlers demo
+dist/Attribute-Handlers/demo/demo.pl			Attribute::Handlers demo
+dist/Attribute-Handlers/demo/Demo.pm			Attribute::Handlers demo
+dist/Attribute-Handlers/demo/demo_range.pl		Attribute::Handlers demo
+dist/Attribute-Handlers/demo/demo_rawdata.pl		Attribute::Handlers demo
+dist/Attribute-Handlers/demo/Descriptions.pm		Attribute::Handlers demo
+dist/Attribute-Handlers/demo/MyClass.pm			Attribute::Handlers demo
+dist/Attribute-Handlers/lib/Attribute/Handlers.pm	Attribute::Handlers
+dist/Attribute-Handlers/README				Attribute::Handlers
+dist/Attribute-Handlers/t/constants.t			Test constants and Attribute::Handlers
+dist/Attribute-Handlers/t/data_convert.t		Test attribute data conversion
+dist/Attribute-Handlers/t/linerep.t			See if Attribute::Handlers works
+dist/Attribute-Handlers/t/multi.t			See if Attribute::Handlers works
+dist/base/Changes		base.pm changelog
+dist/base/lib/base.pm		Establish IS-A relationship at compile time
+dist/base/lib/fields.pm		Set up object field names for pseudo-hash-using classes
+dist/base/MANIFEST		base.pm manifest
+dist/base/META.yml		base.pm META.yml file
+dist/base/t/base.t		See if base works
+dist/base/t/compile-time.t	See if base works
+dist/base/t/fields-5_6_0.t	See if fields work
+dist/base/t/fields-5_8_0.t	See if fields work
+dist/base/t/fields-base.t	See if fields work
+dist/base/t/fields.t		See if fields work
+dist/base/t/isa.t		See if base's behaviour doesn't change
+dist/base/t/lib/Dummy.pm	Test module for base.pm
+dist/base/t/lib/HasSigDie.pm	Module for testing base.pm
+dist/base/t/sigdie.t		See if base works with SIGDIE
+dist/base/t/version.t		See if base works with versions
+dist/base/t/warnings.t		See if base works with warnings
+dist/B-Deparse/Deparse.pm	Compiler Deparse backend
+dist/B-Deparse/t/deparse.t	See if B::Deparse works
+dist/constant/lib/constant.pm	For "use constant"
+dist/constant/t/constant.t	See if compile-time constants work
+dist/Data-Dumper/Changes	Data pretty printer, changelog
+dist/Data-Dumper/Dumper.pm	Data pretty printer, module
+dist/Data-Dumper/Dumper.xs	Data pretty printer, externals
+dist/Data-Dumper/t/bless.t	See if Data::Dumper works
+dist/Data-Dumper/t/bugs.t	See if Data::Dumper works
+dist/Data-Dumper/t/dumper.t	See if Data::Dumper works
+dist/Data-Dumper/t/freezer.t	See if $Data::Dumper::Freezer works
+dist/Data-Dumper/Todo		Data pretty printer, futures
+dist/Data-Dumper/t/overload.t	See if Data::Dumper works for overloaded data
+dist/Data-Dumper/t/pair.t	See if Data::Dumper pair separator works
+dist/ExtUtils-Install/Changes				ExtUtils-Install change log
+dist/ExtUtils-Install/lib/ExtUtils/Installed.pm		Information on installed extensions
+dist/ExtUtils-Install/lib/ExtUtils/Install.pm		Handles 'make install' on extensions
+dist/ExtUtils-Install/lib/ExtUtils/Packlist.pm		Manipulates .packlist files
+dist/ExtUtils-Install/t/can_write_dir.t			Does the _can_write_dir function of ExtUtils::Install work properly?
+dist/ExtUtils-Install/t/Installapi2.t			See if new api for ExtUtils::Install::install() works
+dist/ExtUtils-Install/t/Installed.t			See if ExtUtils::Installed works
+dist/ExtUtils-Install/t/Install.t			See if ExtUtils::Install works
+dist/ExtUtils-Install/t/InstallWithMM.t			See if ExtUtils::Install works (related to EUMM/t/basic.t)
+dist/ExtUtils-Install/t/lib/MakeMaker/Test/Setup/BFD.pm	MakeMaker test utilities
+dist/ExtUtils-Install/t/lib/MakeMaker/Test/Utils.pm	MakeMaker test utilities
+dist/ExtUtils-Install/t/lib/TieOut.pm			Testing library to capture prints
+dist/ExtUtils-Install/t/Packlist.t			See if Packlist works
+dist/Filter-Simple/Changes					Filter::Simple
+dist/Filter-Simple/lib/Filter/Simple.pm				Simple frontend to Filter::Util::Call
+dist/Filter-Simple/t/data.t					See if Filter::Simple works
+dist/Filter-Simple/t/export.t					See if Filter::Simple works
+dist/Filter-Simple/t/filter_only.t				See if Filter::Simple works
+dist/Filter-Simple/t/filter.t					See if Filter::Simple works
+dist/Filter-Simple/t/import.t					See if Filter::Simple works
+dist/Filter-Simple/t/lib/Filter/Simple/ExportTest.pm		Helper file for Filter::Simple tests
+dist/Filter-Simple/t/lib/Filter/Simple/FilterOnlyTest.pm	Helper file for Filter::Simple tests
+dist/Filter-Simple/t/lib/Filter/Simple/FilterTest.pm		Helper file for Filter::Simple tests
+dist/Filter-Simple/t/lib/Filter/Simple/ImportTest.pm		Helper file for Filter::Simple tests
+dist/I18N-LangTags/ChangeLog			I18N::LangTags
+dist/I18N-LangTags/lib/I18N/LangTags/Detect.pm	Detect language preferences
+dist/I18N-LangTags/lib/I18N/LangTags/List.pm	List of tags for human languages
+dist/I18N-LangTags/lib/I18N/LangTags.pm		I18N::LangTags
+dist/I18N-LangTags/README			I18N::LangTags
+dist/I18N-LangTags/t/01_about_verbose.t		See whether I18N::LangTags works
+dist/I18N-LangTags/t/05_main.t			See whether I18N::LangTags works
+dist/I18N-LangTags/t/07_listy.t			See whether I18N::LangTags works
+dist/I18N-LangTags/t/10_http.t			See whether I18N::LangTags works
+dist/I18N-LangTags/t/20_locales.t		See whether I18N::LangTags works
+dist/I18N-LangTags/t/50_super.t			See whether I18N::LangTags works
+dist/I18N-LangTags/t/55_supers_strict.t		See whether I18N::LangTags works
+dist/I18N-LangTags/t/80_all_env.t		See whether I18N::LangTags works
+dist/IO/ChangeLog		IO perl module change log
+dist/IO/hints/sco.pl		Hint for IO for named architecture
+dist/IO/IO.pm			Top-level interface to IO::* classes
+dist/IO/IO.xs			IO extension external subroutines
+dist/IO/lib/IO/Dir.pm		IO directory reading package
+dist/IO/lib/IO/File.pm		IO file handle package
+dist/IO/lib/IO/Handle.pm	IO base handle package
+dist/IO/lib/IO/Pipe.pm		IO pipe package
+dist/IO/lib/IO/Poll.pm		IO system poll() interface
+dist/IO/lib/IO/Seekable.pm	IO methods for seekable handles
+dist/IO/lib/IO/Select.pm	IO system select() interface
+dist/IO/lib/IO/Socket/INET.pm	IO INET specific socket methods
+dist/IO/lib/IO/Socket.pm	IO socket handle package
+dist/IO/lib/IO/Socket/UNIX.pm	IO UNIX specific socket methods
+dist/IO/Makefile.PL		IO extension makefile writer
+dist/IO/poll.c			IO poll() emulation using select()
+dist/IO/poll.h			IO poll() emulation using select()
+dist/IO/README			IO extension maintenance notice
+dist/IO/t/io_const.t		See if constants from IO work
+dist/IO/t/io_dir.t		See if directory-related methods from IO work
+dist/IO/t/io_dup.t		See if dup()-related methods from IO work
+dist/IO/t/io_file.t		See if binmode()-related methods on IO::File work
+dist/IO/t/io_linenum.t		See if I/O line numbers are tracked correctly
+dist/IO/t/io_multihomed.t	See if INET sockets work with multi-homed hosts
+dist/IO/t/io_pipe.t		See if pipe()-related methods from IO work
+dist/IO/t/io_poll.t		See if poll()-related methods from IO work
+dist/IO/t/io_sel.t		See if select()-related methods from IO work
+dist/IO/t/io_sock.t		See if INET socket-related methods from IO work
+dist/IO/t/IO.t			See if IO works
+dist/IO/t/io_taint.t		See if the untaint method from IO works
+dist/IO/t/io_tell.t		See if seek()/tell()-related methods from IO work
+dist/IO/t/io_udp.t		See if UDP socket-related methods from IO work
+dist/IO/t/io_unix.t		See if UNIX socket-related methods from IO work
+dist/IO/t/io_utf8.t		See if perlio opens work
+dist/IO/t/io_xs.t		See if XSUB methods from IO work
+dist/lib/lib_pm.PL		For "use lib", produces lib/lib.pm
+dist/lib/Makefile.PL
+dist/lib/t/01lib.t		For "use lib" testing
+dist/Locale-Maketext/ChangeLog				Locale::Maketext
+dist/Locale-Maketext/lib/Locale/Maketext/GutsLoader.pm	Locale::Maketext
+dist/Locale-Maketext/lib/Locale/Maketext/Guts.pm	Locale::Maketext
+dist/Locale-Maketext/lib/Locale/Maketext.pm		Locale::Maketext
+dist/Locale-Maketext/lib/Locale/Maketext.pod		Locale::Maketext documentation
+dist/Locale-Maketext/lib/Locale/Maketext/TPJ13.pod	Locale::Maketext documentation article
+dist/Locale-Maketext/README				Locale::Maketext
+dist/Locale-Maketext/t/01_about_verbose.t		See if Locale::Maketext works
+dist/Locale-Maketext/t/10_make.t			See if Locale::Maketext works
+dist/Locale-Maketext/t/20_get.t				See if Locale::Maketext works
+dist/Locale-Maketext/t/30_local.t			See if Locale::Maketext works
+dist/Locale-Maketext/t/40_super.t			See if Locale::Maketext works
+dist/Locale-Maketext/t/50_super.t			See if Locale::Maketext works
+dist/Locale-Maketext/t/60_super.t			See if Locale::Maketext works
+dist/Locale-Maketext/t/90_utf8.t			See if Locale::Maketext works
+dist/Module-CoreList/Changes			Module::CoreList Changes
+dist/Module-CoreList/corelist			The corelist command-line utility
+dist/Module-CoreList/identify-dependencies	A usage example for Module::CoreList
+dist/Module-CoreList/lib/Module/CoreList.pm	Module::CoreList
+dist/Module-CoreList/Makefile.PL		Module::CoreList
+dist/Module-CoreList/MANIFEST			Module::CoreList
+dist/Module-CoreList/META.yml			Module::CoreList
+dist/Module-CoreList/README			Module::CoreList
+dist/Module-CoreList/t/corelist.t		Module::CoreList tests
+dist/Module-CoreList/t/deprecated.t		Module::CoreList tests
+dist/Module-CoreList/t/find_modules.t		Module::CoreList tests
+dist/Module-CoreList/t/pod.t			Module::CoreList tests
+dist/Net-Ping/Changes			Net::Ping
+dist/Net-Ping/lib/Net/Ping.pm		Hello, anybody home?
+dist/Net-Ping/t/100_load.t		Ping Net::Ping
+dist/Net-Ping/t/110_icmp_inst.t		Ping Net::Ping
+dist/Net-Ping/t/120_udp_inst.t		Ping Net::Ping
+dist/Net-Ping/t/130_tcp_inst.t		Ping Net::Ping
+dist/Net-Ping/t/140_stream_inst.t	Ping Net::Ping
+dist/Net-Ping/t/150_syn_inst.t		Ping Net::Ping
+dist/Net-Ping/t/190_alarm.t		Ping Net::Ping
+dist/Net-Ping/t/200_ping_tcp.t		Ping Net::Ping
+dist/Net-Ping/t/250_ping_hires.t	Ping Net::Ping
+dist/Net-Ping/t/300_ping_stream.t	Ping Net::Ping
+dist/Net-Ping/t/400_ping_syn.t		Ping Net::Ping
+dist/Net-Ping/t/410_syn_host.t		Ping Net::Ping
+dist/Net-Ping/t/450_service.t		Ping Net::Ping
+dist/Net-Ping/t/500_ping_icmp.t		Ping Net::Ping
+dist/Net-Ping/t/510_ping_udp.t		Ping Net::Ping
+dist/Pod-Perldoc/lib/Pod/Perldoc/BaseTo.pm	utility module for perldoc
+dist/Pod-Perldoc/lib/Pod/Perldoc/GetOptsOO.pm	options parsing for perldoc
+dist/Pod-Perldoc/lib/Pod/Perldoc.pm		guts of the 'perldoc' utility
+dist/Pod-Perldoc/lib/Pod/Perldoc/ToChecker.pm	let perldoc check POD for errors
+dist/Pod-Perldoc/lib/Pod/Perldoc/ToMan.pm	render POD as man pages
+dist/Pod-Perldoc/lib/Pod/Perldoc/ToNroff.pm	convert POD to nroff
+dist/Pod-Perldoc/lib/Pod/Perldoc/ToPod.pm	convert POD to POD
+dist/Pod-Perldoc/lib/Pod/Perldoc/ToRtf.pm	convert POD to RTF
+dist/Pod-Perldoc/lib/Pod/Perldoc/ToText.pm	convert POD to plain text
+dist/Pod-Perldoc/lib/Pod/Perldoc/ToTk.pm	convert POD via Tk::Pod
+dist/Pod-Perldoc/lib/Pod/Perldoc/ToXml.pm	convert POD to XML
+dist/Pod-Perldoc/t/01_about_verbose.t		test Pod::Perldoc
+dist/Pod-Perldoc/t/checkerbasic.t		test Pod::Perldoc::ToChecker
+dist/Pod-Perldoc/t/perldocbasic.t		test Pod::Perldoc basic operation
+dist/Pod-Perldoc/t/textbasic.t			test Pod::Perldoc::ToText
+dist/Pod-Plainer/Plainer.pm	Pod migration utility module
+dist/Pod-Plainer/t/plainer.t	Test Pod::Plainer
+dist/Safe/Changes		Changes for Safe.pm
+dist/Safe/Makefile.PL		Makefile.PL for Safe.pm
+dist/Safe/MANIFEST		MANIFEST for Safe.pm
+dist/Safe/META.yml		META.yml for Safe.pm
+dist/Safe/README		README for Safe.pm
+dist/Safe/Safe.pm		Safe extension Perl module
+dist/Safe/t/safe1.t		See if Safe works
+dist/Safe/t/safe2.t		See if Safe works
+dist/Safe/t/safe3.t		See if Safe works
+dist/Safe/t/safeload.t		Tests that some modules can be loaded by Safe
+dist/Safe/t/safeops.t		Tests that all ops can be trapped by Safe
+dist/Safe/t/safesort.t		Tests Safe with sort
+dist/Safe/t/safeuniversal.t	Tests Safe with functions from universal.c
+dist/Safe/t/safeutf8.t		Tests Safe with utf8.pm
+dist/Safe/t/safewrap.t		Tests Safe::wrap_code_ref()
+dist/SelfLoader/lib/SelfLoader.pm	Load functions only on demand
+dist/SelfLoader/t/01SelfLoader.t	See if SelfLoader works
+dist/SelfLoader/t/02SelfLoader-buggy.t	See if SelfLoader works
+dist/Storable/ChangeLog			Storable extension
+dist/Storable/hints/gnukfreebsd.pl	Hint for Storable for named architecture
+dist/Storable/hints/gnuknetbsd.pl	Hint for Storable for named architecture
+dist/Storable/hints/hpux.pl		Hint for Storable for named architecture
+dist/Storable/hints/linux.pl		Hint for Storable for named architecture
+dist/Storable/Makefile.PL		Storable extension
+dist/Storable/README			Storable extension
+dist/Storable/Storable.pm		Storable extension
+dist/Storable/Storable.xs		Storable extension
+dist/Storable/t/attach_errors.t		Trigger and test STORABLE_attach errors
+dist/Storable/t/attach_singleton.t	Test STORABLE_attach for the Singleton pattern
+dist/Storable/t/blessed.t		See if Storable works
+dist/Storable/t/canonical.t		See if Storable works
+dist/Storable/t/circular_hook.t		Test thaw hook called depth-first for circular refs
+dist/Storable/t/code.t			See if Storable works
+dist/Storable/t/compat01.t		See if Storable works
+dist/Storable/t/compat06.t		See if Storable works
+dist/Storable/t/croak.t			See if Storable works
+dist/Storable/t/dclone.t		See if Storable works
+dist/Storable/t/downgrade.t		See if Storable works
+dist/Storable/t/file_magic.t		See if file_magic function works
+dist/Storable/t/forgive.t		See if Storable works
+dist/Storable/t/freeze.t		See if Storable works
+dist/Storable/t/HAS_ATTACH.pm		For auto-requiring of modules for STORABLE_attach
+dist/Storable/t/HAS_HOOK.pm		For auto-requiring of modules for STORABLE_thaw
+dist/Storable/t/HAS_OVERLOAD.pm		For auto-requiring of mdoules for overload
+dist/Storable/t/integer.t		See if Storable works
+dist/Storable/t/interwork56.t		Test compatibility kludge for 64bit data under 5.6.x
+dist/Storable/t/just_plain_nasty.t	See if Storable works
+dist/Storable/t/lock.t			See if Storable works
+dist/Storable/t/make_56_interwork.pl	Make test data for interwork56.t
+dist/Storable/t/make_downgrade.pl	Make test data for downgrade.t
+dist/Storable/t/make_overload.pl	Make test data for overload.t
+dist/Storable/t/malice.t		See if Storable copes with corrupt files
+dist/Storable/t/overload.t		See if Storable works
+dist/Storable/t/recurse.t		See if Storable works
+dist/Storable/t/restrict.t		See if Storable works
+dist/Storable/t/retrieve.t		See if Storable works
+dist/Storable/t/sig_die.t		See if Storable works
+dist/Storable/t/st-dump.pl		See if Storable works
+dist/Storable/t/store.t			See if Storable works
+dist/Storable/t/testlib.pl		more helper routines for tests
+dist/Storable/t/threads.t		Does Storable work with threads?
+dist/Storable/t/tied_hook.t		See if Storable works
+dist/Storable/t/tied_items.t		See if Storable works
+dist/Storable/t/tied.t			See if Storable works
+dist/Storable/t/utf8hash.t		See if Storable works
+dist/Storable/t/utf8.t			See if Storable works
+dist/Storable/t/weak.t			Can Storable store weakrefs
+dist/Switch/Changes		Changes for Switch.pm
+dist/Switch/Makefile.PL		Makefile.PL for Switch.pm
+dist/Switch/MANIFEST		MANIFEST for Switch.pm
+dist/Switch/META.yml		META.yml for Switch.pm
+dist/Switch/README		README for Switch.pm
+dist/Switch/Switch.pm		Switch for Perl
+dist/Switch/t/given.t		See if Perl 6 given (switch) works
+dist/Switch/t/nested.t		See if nested switch works
+dist/Switch/t/switch.t		See if Perl 5 switch works
+dist/Thread-Queue/lib/Thread/Queue.pm	Thread-safe queues
+dist/Thread-Queue/t/01_basic.t		Thread::Queue tests
+dist/Thread-Queue/t/02_refs.t		Thread::Queue tests
+dist/Thread-Queue/t/03_peek.t		Thread::Queue tests
+dist/Thread-Queue/t/04_errs.t		Thread::Queue tests
+dist/Thread-Queue/t/05_extract.t	Thread::Queue tests
+dist/Thread-Queue/t/06_insert.t		Thread::Queue tests
+dist/Thread-Queue/t/07_lock.t		Thread::Queue tests
+dist/Thread-Queue/t/08_nothreads.t	Thread::Queue tests
+dist/Thread-Semaphore/lib/Thread/Semaphore.pm	Thread-safe semaphores
+dist/Thread-Semaphore/t/01_basic.t		Thread::Semaphore tests
+dist/Thread-Semaphore/t/02_errs.t		Thread::Semaphore tests
+dist/Thread-Semaphore/t/03_nothreads.t		Thread::Semaphore tests
+dist/threads/hints/hpux.pl	Hint file for HPUX
+dist/threads/hints/linux.pl	Hint file for Linux
+dist/threads/Makefile.PL	ithreads
+dist/threads-shared/hints/linux.pl	thread shared variables
+dist/threads-shared/Makefile.PL		thread shared variables
+dist/threads-shared/shared.pm		thread shared variables
+dist/threads-shared/shared.xs		thread shared variables
+dist/threads-shared/t/0nothread.t	Tests for basic shared array functionality.
+dist/threads-shared/t/av_refs.t		Tests for arrays containing references
+dist/threads-shared/t/av_simple.t	Tests for basic shared array functionality.
+dist/threads-shared/t/blessed.t		Test blessed shared variables
+dist/threads-shared/t/clone.t		Test shared cloning
+dist/threads-shared/t/cond.t		Test condition variables
+dist/threads-shared/t/disabled.t	Test threads::shared when threads are disabled.
+dist/threads-shared/t/hv_refs.t		Test shared hashes containing references
+dist/threads-shared/t/hv_simple.t	Tests for basic shared hash functionality.
+dist/threads-shared/t/no_share.t	Tests for disabled share on variables.
+dist/threads-shared/t/object.t		Shared objects tests
+dist/threads-shared/t/shared_attr.t	Test :shared attribute
+dist/threads-shared/t/stress.t		Stress test
+dist/threads-shared/t/sv_refs.t		thread shared variables
+dist/threads-shared/t/sv_simple.t	thread shared variables
+dist/threads-shared/t/utf8.t		Test UTF-8 keys in shared hashes
+dist/threads-shared/t/waithires.t	Test sub-second cond_timedwait
+dist/threads-shared/t/wait.t		Test cond_wait and cond_timedwait
+dist/threads/t/basic.t		ithreads
+dist/threads/t/blocks.t		Test threads in special blocks
+dist/threads/t/context.t	Explicit thread context
+dist/threads/t/end.t		Test end functions
+dist/threads/t/err.t		Test $thr->error()
+dist/threads/t/exit.t		Test exit and die in threads
+dist/threads/t/free2.t		More ithread destruction tests
+dist/threads/t/free.t		Test ithread destruction
+dist/threads/threads.pm		ithreads
+dist/threads/threads.xs		ithreads
+dist/threads/t/join.t		Testing the join function
+dist/threads/t/kill.t		Tests thread signalling
+dist/threads/t/libc.t		testing libc functions for threadsafety
+dist/threads/t/list.t		Test threads->list()
+dist/threads/t/no_threads.t	threads test for non-threaded Perls
+dist/threads/t/problems.t	Test various memory problems
+dist/threads/t/stack_env.t	Tests for stack limits
+dist/threads/t/stack.t		Tests for stack limits
+dist/threads/t/state.t		Tests state methods
+dist/threads/t/stress_cv.t	Test with multiple threads, coderef cv argument.
+dist/threads/t/stress_re.t	Test with multiple threads, string cv argument and regexes.
+dist/threads/t/stress_string.t	Test with multiple threads, string cv argument.
+dist/threads/t/thread.t		General ithread tests from thr5005
+dist/XSLoader/Makefile.PL	Dynamic Loader makefile writer
+dist/XSLoader/t/XSLoader.t	See if XSLoader works
+dist/XSLoader/XSLoader_pm.PL	Simple XS Loader perl module
 djgpp/config.over	DOS/DJGPP port
 djgpp/configure.bat	DOS/DJGPP port
 djgpp/djgpp.c		DOS/DJGPP port
@@ -59,36 +2908,12 @@
 epoc/epocish.h		EPOC port
 epoc/epoc_stubs.c	EPOC port
 epoc/link.pl		EPOC port link a exe
-ext/Attribute-Handlers/Changes			Attribute::Handlers
-ext/Attribute-Handlers/demo/demo2.pl		Attribute::Handlers demo
-ext/Attribute-Handlers/demo/demo3.pl		Attribute::Handlers demo
-ext/Attribute-Handlers/demo/demo4.pl		Attribute::Handlers demo
-ext/Attribute-Handlers/demo/demo_call.pl	Attribute::Handlers demo
-ext/Attribute-Handlers/demo/demo_chain.pl	Attribute::Handlers demo
-ext/Attribute-Handlers/demo/demo_cycle.pl	Attribute::Handlers demo
-ext/Attribute-Handlers/demo/demo_hashdir.pl	Attribute::Handlers demo
-ext/Attribute-Handlers/demo/demo_phases.pl	Attribute::Handlers demo
-ext/Attribute-Handlers/demo/demo.pl		Attribute::Handlers demo
-ext/Attribute-Handlers/demo/Demo.pm		Attribute::Handlers demo
-ext/Attribute-Handlers/demo/demo_range.pl	Attribute::Handlers demo
-ext/Attribute-Handlers/demo/demo_rawdata.pl	Attribute::Handlers demo
-ext/Attribute-Handlers/demo/Descriptions.pm	Attribute::Handlers demo
-ext/Attribute-Handlers/demo/MyClass.pm		Attribute::Handlers demo
-ext/Attribute-Handlers/lib/Attribute/Handlers.pm	Attribute::Handlers
-ext/Attribute-Handlers/README		Attribute::Handlers
-ext/Attribute-Handlers/t/constants.t	Test constants and Attribute::Handlers
-ext/Attribute-Handlers/t/data_convert.t	Test attribute data conversion
-ext/Attribute-Handlers/t/linerep.t	See if Attribute::Handlers works
-ext/Attribute-Handlers/t/multi.t	See if Attribute::Handlers works
-ext/attrs/attrs.pm		attrs extension Perl module
-ext/attrs/attrs.xs		attrs extension external subroutines
-ext/attrs/Makefile.PL		attrs extension makefile writer
-ext/attrs/t/attrs.t		See if attrs works with C<sub : attrs>
+ext/attributes/attributes.pm		For "sub foo : attrlist"
+ext/attributes/attributes.xs		For "sub foo : attrlist"
+ext/autouse/lib/autouse.pm	Load and call a function only when it's used
+ext/autouse/t/autouse.t		See if autouse works
+ext/autouse/t/lib/MyTestModule.pm	Test module for autouse
 ext/B/B/Concise.pm	Compiler Concise backend
-ext/B/B/Debug.pm	Compiler Debug backend
-ext/B/B/Deparse.pm	Compiler Deparse backend
-ext/B/B/Lint/Debug.pm	Adds debugging stringification to B::
-ext/B/B/Lint.pm		Compiler Lint backend
 ext/B/B.pm		Compiler backend support functions and methods
 ext/B/B/Showlex.pm	Compiler Showlex backend
 ext/B/B/Terse.pm	Compiler Terse backend
@@ -102,13 +2927,10 @@
 ext/B/t/b.t		See if B works
 ext/B/t/concise.t	See whether B::Concise works
 ext/B/t/concise-xs.t	See whether B::Concise recognizes XS functions
-ext/B/t/debug.t		See if B::Debug works
-ext/B/t/deparse.t	See if B::Deparse works
 ext/B/t/f_map			code from perldoc -f map
 ext/B/t/f_map.t			converted to optreeCheck()s
 ext/B/t/f_sort			optree test raw material
 ext/B/t/f_sort.t		optree test raw material
-ext/B/t/lint.t		See if B::Lint works
 ext/B/t/OptreeCheck.pm		optree comparison tool
 ext/B/t/optree_check.t		test OptreeCheck apparatus
 ext/B/t/optree_concise.t	more B::Concise tests
@@ -119,113 +2941,30 @@
 ext/B/t/optree_specials.t	BEGIN, END, etc code
 ext/B/t/optree_varinit.t	my,our,local var init optimization
 ext/B/t/o.t		See if O works
-ext/B/t/pluglib/B/Lint/Plugin/Test.pm	See if B::Lint works
 ext/B/t/pragma.t	See if user pragmas work.
 ext/B/t/showlex.t	See if B::ShowLex works
 ext/B/t/terse.t		See if B::Terse works
 ext/B/t/xref.t		See if B::Xref works
 ext/B/typemap			Compiler backend interface types
-ext/Compress-Raw-Bzip2/bzip2-src/blocksort.c
-ext/Compress-Raw-Bzip2/bzip2-src/bzip2.c
-ext/Compress-Raw-Bzip2/bzip2-src/bzip2recover.c
-ext/Compress-Raw-Bzip2/bzip2-src/bzlib.c
-ext/Compress-Raw-Bzip2/bzip2-src/bzlib.h
-ext/Compress-Raw-Bzip2/bzip2-src/bzlib_private.h
-ext/Compress-Raw-Bzip2/bzip2-src/compress.c
-ext/Compress-Raw-Bzip2/bzip2-src/crctable.c
-ext/Compress-Raw-Bzip2/bzip2-src/decompress.c
-ext/Compress-Raw-Bzip2/bzip2-src/dlltest.c
-ext/Compress-Raw-Bzip2/bzip2-src/huffman.c
-ext/Compress-Raw-Bzip2/bzip2-src/LICENSE
-ext/Compress-Raw-Bzip2/bzip2-src/mk251.c
-ext/Compress-Raw-Bzip2/bzip2-src/randtable.c
-ext/Compress-Raw-Bzip2/bzip2-src/spewG.c
-ext/Compress-Raw-Bzip2/bzip2-src/unzcrash.c
-ext/Compress-Raw-Bzip2/Bzip2.xs
-ext/Compress-Raw-Bzip2/Changes
-ext/Compress-Raw-Bzip2/fallback/constants.h
-ext/Compress-Raw-Bzip2/fallback/constants.xs
-ext/Compress-Raw-Bzip2/lib/Compress/Raw/Bzip2.pm
-ext/Compress-Raw-Bzip2/Makefile.PL
-ext/Compress-Raw-Bzip2/pod/FAQ.pod
-ext/Compress-Raw-Bzip2/private/MakeUtil.pm
-ext/Compress-Raw-Bzip2/README
-ext/Compress-Raw-Bzip2/t/000prereq.t
-ext/Compress-Raw-Bzip2/t/01bzip2.t
-ext/Compress-Raw-Bzip2/t/09limitoutput.t
-ext/Compress-Raw-Bzip2/t/99pod.t
-ext/Compress-Raw-Bzip2/typemap
-ext/Compress-Raw-Zlib/Changes		Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/config.in		Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/examples/filtdef	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/examples/filtinf	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/fallback/constants.h	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/fallback/constants.xs	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/lib/Compress/Raw/Zlib.pm	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/Makefile.PL	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/pod/FAQ.pod	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/private/MakeUtil.pm	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/README		Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/t/01version.t	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/t/02zlib.t	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/t/07bufsize.t	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/t/09limitoutput.t	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/t/18lvalue.t	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/typemap		Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/zlib-src/adler32.c	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/zlib-src/compress.c	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/zlib-src/crc32.c	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/zlib-src/crc32.h	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/zlib-src/deflate.c	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/zlib-src/deflate.h	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/zlib-src/infback.c	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/zlib-src/inffast.c	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/zlib-src/inffast.h	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/zlib-src/inffixed.h	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/zlib-src/inflate.c	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/zlib-src/inflate.h	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/zlib-src/inftrees.c	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/zlib-src/inftrees.h	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/zlib-src/trees.c	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/zlib-src/trees.h	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/zlib-src/uncompr.c	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/zlib-src/zconf.h	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/zlib-src/zlib.h	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/zlib-src/zutil.c	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/zlib-src/zutil.h	Compress::Raw::Zlib
-ext/Compress-Raw-Zlib/Zlib.xs		Compress::Raw::Zlib
-ext/Cwd/Changes			Cwd extension Changelog
-ext/Cwd/Cwd.xs			Cwd extension external subroutines
-ext/Cwd/Makefile.PL		Cwd extension makefile maker
-ext/Cwd/t/cwd.t			See if Cwd works
-ext/Cwd/t/taint.t		See if Cwd works with taint
-ext/Cwd/t/win32.t		See if Cwd works on Win32
-ext/Data-Dumper/Changes		Data pretty printer, changelog
-ext/Data-Dumper/Dumper.pm	Data pretty printer, module
-ext/Data-Dumper/Dumper.xs	Data pretty printer, externals
-ext/Data-Dumper/t/bless.t	See if Data::Dumper works
-ext/Data-Dumper/t/bugs.t	See if Data::Dumper works
-ext/Data-Dumper/t/dumper.t	See if Data::Dumper works
-ext/Data-Dumper/t/freezer.t	See if $Data::Dumper::Freezer works
-ext/Data-Dumper/Todo		Data pretty printer, futures
-ext/Data-Dumper/t/overload.t	See if Data::Dumper works for overloaded data
-ext/Data-Dumper/t/pair.t	See if Data::Dumper pair separator works
-ext/DB_File/Changes	Berkeley DB extension change log
-ext/DB_File/config.in	Part of Berkeley DB configuration
-ext/DB_File/DB_File_BS	Berkeley DB extension mkbootstrap fodder
-ext/DB_File/DB_File.pm	Berkeley DB extension Perl module
-ext/DB_File/DB_File.xs	Berkeley DB extension external subroutines
-ext/DB_File/dbinfo	Berkeley DB database version checker
-ext/DB_File/hints/dynixptx.pl	Hint for DB_File for named architecture
-ext/DB_File/hints/sco.pl	Hint for DB_File for named architecture
-ext/DB_File/Makefile.PL	Berkeley DB extension makefile writer
-ext/DB_File/t/db-btree.t	See if DB_File works
-ext/DB_File/t/db-hash.t		See if DB_File works
-ext/DB_File/t/db-recno.t	See if DB_File works
-ext/DB_File/typemap		Berkeley DB extension interface types
-ext/DB_File/version.c		Berkeley DB extension interface version check
 ext/Devel-DProf/Changes		Perl code profiler changelog
 ext/Devel-DProf/DProf.pm	Perl code profiler
+ext/Devel-DProf/dprof/test1_t	Perl code profiler tests
+ext/Devel-DProf/dprof/test1_v	Perl code profiler tests
+ext/Devel-DProf/dprof/test2_t	Perl code profiler tests
+ext/Devel-DProf/dprof/test2_v	Perl code profiler tests
+ext/Devel-DProf/dprof/test3_t	Perl code profiler tests
+ext/Devel-DProf/dprof/test3_v	Perl code profiler tests
+ext/Devel-DProf/dprof/test4_t	Perl code profiler tests
+ext/Devel-DProf/dprof/test4_v	Perl code profiler tests
+ext/Devel-DProf/dprof/test5_t	Perl code profiler tests
+ext/Devel-DProf/dprof/test5_v	Perl code profiler tests
+ext/Devel-DProf/dprof/test6_t	Perl code profiler tests
+ext/Devel-DProf/dprof/test6_v	Perl code profiler tests
+ext/Devel-DProf/dprof/test7_t	Perl code profiler tests
+ext/Devel-DProf/dprof/test7_v	Perl code profiler tests
+ext/Devel-DProf/dprof/test8_t	Perl code profiler tests
+ext/Devel-DProf/dprof/test8_v	Perl code profiler tests
+ext/Devel-DProf/dprof/V.pm	Perl code profiler tests
 ext/Devel-DProf/DProf.xs	Perl code profiler
 ext/Devel-DProf/Makefile.PL	Perl code profiler makefile writer
 ext/Devel-DProf/t/DProf.t	Perl code profiler
@@ -235,224 +2974,8 @@
 ext/Devel-Peek/Peek.pm		Data debugging tool, module and pod
 ext/Devel-Peek/Peek.xs		Data debugging tool, externals
 ext/Devel-Peek/t/Peek.t		See if Devel::Peek works
-ext/Devel-PPPort/apicheck_c.PL	Devel::PPPort apicheck generator
-ext/Devel-PPPort/Changes	Devel::PPPort changes
-ext/Devel-PPPort/devel/buildperl.pl	Devel::PPPort perl version builder
-ext/Devel-PPPort/devel/devtools.pl	Devel::PPPort development utilities
-ext/Devel-PPPort/devel/mkapidoc.sh	Devel::PPPort apidoc collector
-ext/Devel-PPPort/devel/mktodo	Devel::PPPort baseline/todo generator
-ext/Devel-PPPort/devel/mktodo.pl	Devel::PPPort baseline/todo generator
-ext/Devel-PPPort/devel/regenerate	Devel::PPPort API re-generator
-ext/Devel-PPPort/devel/scanprov	Devel::PPPort provided API scanner
-ext/Devel-PPPort/HACKERS	Devel::PPPort hackers documentation
-ext/Devel-PPPort/Makefile.PL	Devel::PPPort makefile writer
-ext/Devel-PPPort/MANIFEST.SKIP	Devel::PPPort Manifest skip specs
-ext/Devel-PPPort/mktests.PL	Devel::PPPort test file writer
-ext/Devel-PPPort/module2.c	Devel::PPPort test file
-ext/Devel-PPPort/module3.c	Devel::PPPort test file
-ext/Devel-PPPort/parts/apicheck.pl	Devel::PPPort apicheck generator
-ext/Devel-PPPort/parts/apidoc.fnc	Devel::PPPort Perl API listing
-ext/Devel-PPPort/parts/base/5004000	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5004010	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5004020	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5004030	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5004040	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5004050	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5005000	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5005010	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5005020	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5005030	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5005040	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5006000	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5006001	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5006002	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5007000	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5007001	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5007002	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5007003	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5008000	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5008001	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5008002	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5008003	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5008004	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5008005	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5008006	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5008007	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5008008	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5009000	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5009001	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5009002	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5009003	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5009004	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5009005	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5010000	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/base/5011000	Devel::PPPort baseline todo file
-ext/Devel-PPPort/parts/embed.fnc	Devel::PPPort Perl API listing
-ext/Devel-PPPort/parts/inc/call	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/cop	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/exception	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/format	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/grok	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/gv	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/HvNAME	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/limits	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/magic	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/memory	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/misc	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/mPUSH	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/MY_CXT	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/newCONSTSUB	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/newRV	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/newSVpv	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/newSV_type	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/podtest	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/ppphbin	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/ppphdoc	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/ppphtest	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/pvs	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/pv_tools	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/shared_pv	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/snprintf	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/sprintf	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/strlfuncs	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/SvPV	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/SvREFCNT	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/Sv_set	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/sv_xpvf	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/threads	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/uv	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/variables	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/version	Devel::PPPort include
-ext/Devel-PPPort/parts/inc/warn	Devel::PPPort include
-ext/Devel-PPPort/parts/ppport.fnc	Devel::PPPort API listing
-ext/Devel-PPPort/parts/ppptools.pl	Devel::PPPort various utilities
-ext/Devel-PPPort/parts/todo/5004000	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5004010	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5004020	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5004030	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5004040	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5004050	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5005000	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5005010	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5005020	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5005030	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5005040	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5006000	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5006001	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5006002	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5007000	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5007001	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5007002	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5007003	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5008000	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5008001	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5008002	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5008003	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5008004	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5008005	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5008006	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5008007	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5008008	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5009000	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5009001	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5009002	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5009003	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5009004	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5009005	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5010000	Devel::PPPort todo file
-ext/Devel-PPPort/parts/todo/5011000	Devel::PPPort todo file
-ext/Devel-PPPort/ppport_h.PL	Devel::PPPort ppport.h writer
-ext/Devel-PPPort/PPPort_pm.PL	Devel::PPPort PPPort.pm writer
-ext/Devel-PPPort/PPPort.xs	Devel::PPPort dummy PPPort.xs
-ext/Devel-PPPort/PPPort_xs.PL	Devel::PPPort RealPPPort.xs writer
-ext/Devel-PPPort/README		Devel::PPPort Readme
-ext/Devel-PPPort/soak		Devel::PPPort Test Harness to run under various Perls
-ext/Devel-PPPort/t/call.t	Devel::PPPort test file
-ext/Devel-PPPort/t/cop.t	Devel::PPPort test file
-ext/Devel-PPPort/t/exception.t	Devel::PPPort test file
-ext/Devel-PPPort/t/format.t	Devel::PPPort test file
-ext/Devel-PPPort/t/grok.t	Devel::PPPort test file
-ext/Devel-PPPort/t/gv.t	Devel::PPPort test file
-ext/Devel-PPPort/t/HvNAME.t	Devel::PPPort test file
-ext/Devel-PPPort/t/limits.t	Devel::PPPort test file
-ext/Devel-PPPort/t/magic.t	Devel::PPPort test file
-ext/Devel-PPPort/t/memory.t	Devel::PPPort test file
-ext/Devel-PPPort/t/misc.t	Devel::PPPort test file
-ext/Devel-PPPort/t/mPUSH.t	Devel::PPPort test file
-ext/Devel-PPPort/t/MY_CXT.t	Devel::PPPort test file
-ext/Devel-PPPort/t/newCONSTSUB.t	Devel::PPPort test file
-ext/Devel-PPPort/t/newRV.t	Devel::PPPort test file
-ext/Devel-PPPort/t/newSVpv.t	Devel::PPPort test file
-ext/Devel-PPPort/t/newSV_type.t	Devel::PPPort test file
-ext/Devel-PPPort/TODO		Devel::PPPort Todo
-ext/Devel-PPPort/t/podtest.t	Devel::PPPort test file
-ext/Devel-PPPort/t/ppphtest.t	Devel::PPPort test file
-ext/Devel-PPPort/t/pvs.t	Devel::PPPort test file
-ext/Devel-PPPort/t/pv_tools.t	Devel::PPPort test file
-ext/Devel-PPPort/t/shared_pv.t	Devel::PPPort test file
-ext/Devel-PPPort/t/snprintf.t	Devel::PPPort test file
-ext/Devel-PPPort/t/sprintf.t	Devel::PPPort test file
-ext/Devel-PPPort/t/strlfuncs.t	Devel::PPPort test file
-ext/Devel-PPPort/t/SvPV.t	Devel::PPPort test file
-ext/Devel-PPPort/t/SvREFCNT.t	Devel::PPPort test file
-ext/Devel-PPPort/t/Sv_set.t	Devel::PPPort test file
-ext/Devel-PPPort/t/sv_xpvf.t	Devel::PPPort test file
-ext/Devel-PPPort/t/testutil.pl	Devel::PPPort test utilities
-ext/Devel-PPPort/t/threads.t	Devel::PPPort test file
-ext/Devel-PPPort/t/uv.t		Devel::PPPort test file
-ext/Devel-PPPort/t/variables.t	Devel::PPPort test file
-ext/Devel-PPPort/t/warn.t	Devel::PPPort test file
-ext/Devel-PPPort/typemap	Devel::PPPort Typemap
-ext/Digest-MD5/Changes		Digest::MD5 extension changes
-ext/Digest-MD5/hints/dec_osf.pl	Hints for named architecture
-ext/Digest-MD5/hints/irix_6.pl	Hints for named architecture
-ext/Digest-MD5/hints/MacOS.pl	Hints for named architecture
-ext/Digest-MD5/Makefile.PL	Digest::MD5 extension makefile writer
-ext/Digest-MD5/MD5.pm		Digest::MD5 extension
-ext/Digest-MD5/MD5.xs		Digest::MD5 extension
-ext/Digest-MD5/README		Digest::MD5 extension Readme
-ext/Digest-MD5/t/align.t	See if Digest::MD5 extension works
-ext/Digest-MD5/t/badfile.t	See if Digest::MD5 extension works
-ext/Digest-MD5/t/bits.t		See if Digest::MD5 extension works
-ext/Digest-MD5/t/clone.t	See if Digest::MD5 extension works
-ext/Digest-MD5/t/files.t	See if Digest::MD5 extension works
-ext/Digest-MD5/t/md5-aaa.t	See if Digest::MD5 extension works
-ext/Digest-MD5/t/utf8.t		See if Digest::MD5 extension works
-ext/Digest-MD5/typemap		Digest::MD5 extension
-ext/Digest-SHA/bin/shasum	shasum script
-ext/Digest-SHA/Changes		Digest::SHA changes
-ext/Digest-SHA/lib/Digest/SHA.pm	Digest::SHA extension
-ext/Digest-SHA/Makefile.PL	Digest::SHA Makefile.PL
-ext/Digest-SHA/README		Digest::SHA README
-ext/Digest-SHA/SHA.xs		Digest::SHA extension
-ext/Digest-SHA/src/hmac.c	Digest::SHA extension
-ext/Digest-SHA/src/hmac.h	Digest::SHA extension
-ext/Digest-SHA/src/hmacxtra.c	Digest::SHA extension
-ext/Digest-SHA/src/sha64bit.c	Digest::SHA extension
-ext/Digest-SHA/src/sha64bit.h	Digest::SHA extension
-ext/Digest-SHA/src/sha.c	Digest::SHA extension
-ext/Digest-SHA/src/sha.h	Digest::SHA extension
-ext/Digest-SHA/src/shaxtra.c	Digest::SHA extension
-ext/Digest-SHA/t/allfcns.t	See if Digest::SHA works
-ext/Digest-SHA/t/base64.t	See if Digest::SHA works
-ext/Digest-SHA/t/bitbuf.t	See if Digest::SHA works
-ext/Digest-SHA/t/dumpload.t	See if Digest::SHA works
-ext/Digest-SHA/t/fips198.t	See if Digest::SHA works
-ext/Digest-SHA/t/gglong.t	See if Digest::SHA works
-ext/Digest-SHA/t/gg.t		See if Digest::SHA works
-ext/Digest-SHA/t/hmacsha.t	See if Digest::SHA works
-ext/Digest-SHA/t/ireland.t	See if Digest::SHA works
-ext/Digest-SHA/t/methods.t	See if Digest::SHA works
-ext/Digest-SHA/t/nistbit.t	See if Digest::SHA works
-ext/Digest-SHA/t/nistbyte.t	See if Digest::SHA works
-ext/Digest-SHA/t/rfc2202.t	See if Digest::SHA works
-ext/Digest-SHA/t/sha1.t		See if Digest::SHA works
-ext/Digest-SHA/t/sha224.t	See if Digest::SHA works
-ext/Digest-SHA/t/sha256.t	See if Digest::SHA works
-ext/Digest-SHA/t/sha384.t	See if Digest::SHA works
-ext/Digest-SHA/t/sha512.t	See if Digest::SHA works
-ext/Digest-SHA/t/woodbury.t	See if Digest::SHA works
-ext/Digest-SHA/typemap		Typemap for Digest::SHA
+ext/Devel-SelfStubber/lib/Devel/SelfStubber.pm	Generate stubs for SelfLoader.pm
+ext/Devel-SelfStubber/t/Devel-SelfStubber.t	See if Devel::SelfStubber works
 ext/DynaLoader/dl_aix.xs	AIX implementation
 ext/DynaLoader/dl_beos.xs	BeOS implementation
 ext/DynaLoader/dl_dld.xs	GNU dld style implementation
@@ -468,6 +2991,7 @@
 ext/DynaLoader/dlutils.c	Dynamic loader utilities for dl_*.xs files
 ext/DynaLoader/dl_vmesa.xs	VM/ESA implementation
 ext/DynaLoader/dl_vms.xs	VMS implementation
+ext/DynaLoader/dl_win32.xs	Win32 implementation
 ext/DynaLoader/DynaLoader_pm.PL	Dynamic Loader perl module
 ext/DynaLoader/hints/aix.pl	Hint for DynaLoader for named architecture
 ext/DynaLoader/hints/gnukfreebsd.pl	Hint for DynaLoader for named architecture
@@ -478,209 +3002,6 @@
 ext/DynaLoader/Makefile.PL	Dynamic Loader makefile writer
 ext/DynaLoader/README		Dynamic Loader notes and intro
 ext/DynaLoader/t/DynaLoader.t	See if DynaLoader works
-ext/DynaLoader/t/XSLoader.t	See if XSLoader works
-ext/DynaLoader/XSLoader_pm.PL	Simple XS Loader perl module
-ext/Encode/AUTHORS		List of authors
-ext/Encode/bin/enc2xs		Encode module generator
-ext/Encode/bin/piconv		iconv by perl
-ext/Encode/bin/ucm2table	Table Generator for testing
-ext/Encode/bin/ucmlint		A UCM Lint utility
-ext/Encode/bin/ucmsort		A UCM sort utility
-ext/Encode/bin/unidump		Unicode Dump like hexdump(1)
-ext/Encode/Byte/Byte.pm		Encode extension
-ext/Encode/Byte/Makefile.PL	Encode extension
-ext/Encode/Changes		Change Log
-ext/Encode/CN/CN.pm		Encode extension
-ext/Encode/CN/Makefile.PL	Encode extension
-ext/Encode/EBCDIC/EBCDIC.pm	Encode extension
-ext/Encode/EBCDIC/Makefile.PL	Encode extension
-ext/Encode/encengine.c		Encode extension
-ext/Encode/Encode/Changes.e2x	Skeleton file for enc2xs
-ext/Encode/Encode/ConfigLocal_PM.e2x	Skeleton file for enc2xs
-ext/Encode/Encode/encode.h	Encode extension header file
-ext/Encode/Encode/Makefile_PL.e2x	Skeleton file for enc2xs
-ext/Encode/Encode.pm		Mother of all Encode extensions
-ext/Encode/Encode/_PM.e2x	Skeleton file for enc2xs
-ext/Encode/Encode/README.e2x	Skeleton file for enc2xs
-ext/Encode/Encode/_T.e2x	Skeleton file for enc2xs
-ext/Encode/Encode.xs		Encode extension
-ext/Encode/encoding.pm		Perl Pragmatic Module
-ext/Encode/JP/JP.pm		Encode extension
-ext/Encode/JP/Makefile.PL	Encode extension
-ext/Encode/KR/KR.pm		Encode extension
-ext/Encode/KR/Makefile.PL	Encode extension
-ext/Encode/lib/Encode/Alias.pm	Encode extension
-ext/Encode/lib/Encode/CJKConstants.pm	Encode extension
-ext/Encode/lib/Encode/CN/HZ.pm		Encode extension
-ext/Encode/lib/Encode/Config.pm	Encode configuration module
-ext/Encode/lib/Encode/Encoder.pm	OO Encoder
-ext/Encode/lib/Encode/Encoding.pm	Encode extension
-ext/Encode/lib/Encode/GSM0338.pm	Encode extension
-ext/Encode/lib/Encode/Guess.pm	Encode Extension
-ext/Encode/lib/Encode/JP/H2Z.pm	Encode extension
-ext/Encode/lib/Encode/JP/JIS7.pm	Encode extension
-ext/Encode/lib/Encode/KR/2022_KR.pm	Encode extension
-ext/Encode/lib/Encode/MIME/Header/ISO_2022_JP.pm	Encode extension
-ext/Encode/lib/Encode/MIME/Header.pm	Encode extension
-ext/Encode/lib/Encode/MIME/Name.pm	Encode extension
-ext/Encode/lib/Encode/PerlIO.pod	Documents for Encode & PerlIO
-ext/Encode/lib/Encode/Supported.pod	Documents for supported encodings
-ext/Encode/lib/Encode/Unicode/UTF7.pm	Encode extension
-ext/Encode/Makefile.PL		Encode extension makefile writer
-ext/Encode/README		Encode extension
-ext/Encode/Symbol/Makefile.PL	Encode extension
-ext/Encode/Symbol/Symbol.pm	Encode extension
-ext/Encode/t/Aliases.t		test script
-ext/Encode/t/at-cn.t		test script
-ext/Encode/t/at-tw.t		test script
-ext/Encode/t/big5-eten.enc	test data
-ext/Encode/t/big5-eten.utf	test data
-ext/Encode/t/big5-hkscs.enc	test data
-ext/Encode/t/big5-hkscs.utf	test data
-ext/Encode/t/CJKT.t		test script
-ext/Encode/t/enc_data.t		test script for utf8 DATA
-ext/Encode/t/enc_eucjp.t	test script
-ext/Encode/t/enc_module.enc	test data for t/enc_module.t
-ext/Encode/t/enc_module.t	test script
-ext/Encode/t/Encoder.t		test script
-ext/Encode/t/Encode.t		test script
-ext/Encode/t/encoding.t		test script
-ext/Encode/t/enc_utf8.t		test script
-ext/Encode/t/fallback.t		test script
-ext/Encode/t/from_to.t		test script
-ext/Encode/t/gb2312.enc		test data
-ext/Encode/t/gb2312.utf		test data
-ext/Encode/t/grow.t		test script
-ext/Encode/t/gsm0338.t		test script
-ext/Encode/t/guess.t		test script
-ext/Encode/t/jis7-fallback.t	test script
-ext/Encode/t/jisx0201.enc	test data
-ext/Encode/t/jisx0201.utf	test data
-ext/Encode/t/jisx0208.enc	test data
-ext/Encode/t/jisx0208.utf	test data
-ext/Encode/t/jisx0212.enc	test data
-ext/Encode/t/jisx0212.utf	test data
-ext/Encode/t/jperl.t		test script
-ext/Encode/t/ksc5601.enc	test data
-ext/Encode/t/ksc5601.utf	test data
-ext/Encode/t/mime_header_iso2022jp.t	test script
-ext/Encode/t/mime-header.t	test script
-ext/Encode/t/mime-name.t	test script
-ext/Encode/t/Mod_EUCJP.pm	module that t/enc_module.enc uses
-ext/Encode/t/perlio.t		test script
-ext/Encode/t/piconv.t		test script
-ext/Encode/t/rt.pl		test script
-ext/Encode/t/unibench.pl	benchmark script
-ext/Encode/t/Unicode.t		test script
-ext/Encode/t/utf8strict.t	test script
-ext/Encode/TW/Makefile.PL	Encode extension
-ext/Encode/TW/TW.pm		Encode extension
-ext/Encode/ucm/8859-10.ucm	Unicode Character Map
-ext/Encode/ucm/8859-11.ucm	Unicode Character Map
-ext/Encode/ucm/8859-13.ucm	Unicode Character Map
-ext/Encode/ucm/8859-14.ucm	Unicode Character Map
-ext/Encode/ucm/8859-15.ucm	Unicode Character Map
-ext/Encode/ucm/8859-16.ucm	Unicode Character Map
-ext/Encode/ucm/8859-1.ucm	Unicode Character Map
-ext/Encode/ucm/8859-2.ucm	Unicode Character Map
-ext/Encode/ucm/8859-3.ucm	Unicode Character Map
-ext/Encode/ucm/8859-4.ucm	Unicode Character Map
-ext/Encode/ucm/8859-5.ucm	Unicode Character Map
-ext/Encode/ucm/8859-6.ucm	Unicode Character Map
-ext/Encode/ucm/8859-7.ucm	Unicode Character Map
-ext/Encode/ucm/8859-8.ucm	Unicode Character Map
-ext/Encode/ucm/8859-9.ucm	Unicode Character Map
-ext/Encode/ucm/adobeStdenc.ucm	Unicode Character Map
-ext/Encode/ucm/adobeSymbol.ucm	Unicode Character Map
-ext/Encode/ucm/adobeZdingbat.ucm	Unicode Character Map
-ext/Encode/ucm/ascii.ucm	Unicode Character Map
-ext/Encode/ucm/big5-eten.ucm	Unicode Character Map
-ext/Encode/ucm/big5-hkscs.ucm	Unicode Character Map
-ext/Encode/ucm/cp037.ucm	Unicode Character Map
-ext/Encode/ucm/cp1006.ucm	Unicode Character Map
-ext/Encode/ucm/cp1026.ucm	Unicode Character Map
-ext/Encode/ucm/cp1047.ucm	Unicode Character Map
-ext/Encode/ucm/cp1250.ucm	Unicode Character Map
-ext/Encode/ucm/cp1251.ucm	Unicode Character Map
-ext/Encode/ucm/cp1252.ucm	Unicode Character Map
-ext/Encode/ucm/cp1253.ucm	Unicode Character Map
-ext/Encode/ucm/cp1254.ucm	Unicode Character Map
-ext/Encode/ucm/cp1255.ucm	Unicode Character Map
-ext/Encode/ucm/cp1256.ucm	Unicode Character Map
-ext/Encode/ucm/cp1257.ucm	Unicode Character Map
-ext/Encode/ucm/cp1258.ucm	Unicode Character Map
-ext/Encode/ucm/cp424.ucm	Unicode Character Map
-ext/Encode/ucm/cp437.ucm	Unicode Character Map
-ext/Encode/ucm/cp500.ucm	Unicode Character Map
-ext/Encode/ucm/cp737.ucm	Unicode Character Map
-ext/Encode/ucm/cp775.ucm	Unicode Character Map
-ext/Encode/ucm/cp850.ucm	Unicode Character Map
-ext/Encode/ucm/cp852.ucm	Unicode Character Map
-ext/Encode/ucm/cp855.ucm	Unicode Character Map
-ext/Encode/ucm/cp856.ucm	Unicode Character Map
-ext/Encode/ucm/cp857.ucm	Unicode Character Map
-ext/Encode/ucm/cp858.ucm	Unicode Character Map
-ext/Encode/ucm/cp860.ucm	Unicode Character Map
-ext/Encode/ucm/cp861.ucm	Unicode Character Map
-ext/Encode/ucm/cp862.ucm	Unicode Character Map
-ext/Encode/ucm/cp863.ucm	Unicode Character Map
-ext/Encode/ucm/cp864.ucm	Unicode Character Map
-ext/Encode/ucm/cp865.ucm	Unicode Character Map
-ext/Encode/ucm/cp866.ucm	Unicode Character Map
-ext/Encode/ucm/cp869.ucm	Unicode Character Map
-ext/Encode/ucm/cp874.ucm	Unicode Character Map
-ext/Encode/ucm/cp875.ucm	Unicode Character Map
-ext/Encode/ucm/cp932.ucm	Unicode Character Map
-ext/Encode/ucm/cp936.ucm	Unicode Character Map
-ext/Encode/ucm/cp949.ucm	Unicode Character Map
-ext/Encode/ucm/cp950.ucm	Unicode Character Map
-ext/Encode/ucm/ctrl.ucm		Unicode Character Map
-ext/Encode/ucm/dingbats.ucm	Unicode Character Map
-ext/Encode/ucm/euc-cn.ucm	Unicode Character Map
-ext/Encode/ucm/euc-jp.ucm	Unicode Character Map
-ext/Encode/ucm/euc-kr.ucm	Unicode Character Map
-ext/Encode/ucm/gb12345.ucm	Unicode Character Map
-ext/Encode/ucm/gb2312.ucm	Unicode Character Map
-ext/Encode/ucm/hp-roman8.ucm	Unicode Character Map
-ext/Encode/ucm/ir-165.ucm	Unicode Character Map
-ext/Encode/ucm/jis0201.ucm	Unicode Character Map
-ext/Encode/ucm/jis0208.ucm	Unicode Character Map
-ext/Encode/ucm/jis0212.ucm	Unicode Character Map
-ext/Encode/ucm/johab.ucm	Unicode Character Map
-ext/Encode/ucm/koi8-f.ucm	Unicode Character Map
-ext/Encode/ucm/koi8-r.ucm	Unicode Character Map
-ext/Encode/ucm/koi8-u.ucm	Unicode Character Map
-ext/Encode/ucm/ksc5601.ucm	Unicode Character Map
-ext/Encode/ucm/macArabic.ucm	Unicode Character Map
-ext/Encode/ucm/macCentEuro.ucm	Unicode Character Map
-ext/Encode/ucm/macChinsimp.ucm	Unicode Character Map
-ext/Encode/ucm/macChintrad.ucm	Unicode Character Map
-ext/Encode/ucm/macCroatian.ucm	Unicode Character Map
-ext/Encode/ucm/macCyrillic.ucm	Unicode Character Map
-ext/Encode/ucm/macDingbats.ucm	Unicode Character Map
-ext/Encode/ucm/macFarsi.ucm	Unicode Character Map
-ext/Encode/ucm/macGreek.ucm	Unicode Character Map
-ext/Encode/ucm/macHebrew.ucm	Unicode Character Map
-ext/Encode/ucm/macIceland.ucm	Unicode Character Map
-ext/Encode/ucm/macJapanese.ucm	Unicode Character Map
-ext/Encode/ucm/macKorean.ucm	Unicode Character Map
-ext/Encode/ucm/macRoman.ucm	Unicode Character Map
-ext/Encode/ucm/macROMnn.ucm	Unicode Character Map
-ext/Encode/ucm/macRUMnn.ucm	Unicode Character Map
-ext/Encode/ucm/macSami.ucm	Unicode Character Map
-ext/Encode/ucm/macSymbol.ucm	Unicode Character Map
-ext/Encode/ucm/macThai.ucm	Unicode Character Map
-ext/Encode/ucm/macTurkish.ucm	Unicode Character Map
-ext/Encode/ucm/macUkraine.ucm	Unicode Character Map
-ext/Encode/ucm/nextstep.ucm	Unicode Character Map
-ext/Encode/ucm/null.ucm		Unicode Character Map
-ext/Encode/ucm/posix-bc.ucm	Unicode Character Map
-ext/Encode/ucm/shiftjis.ucm	Unicode Character Map
-ext/Encode/ucm/symbol.ucm	Unicode Character Map
-ext/Encode/ucm/viscii.ucm	Unicode Character Map
-ext/Encode/Unicode/Makefile.PL	Encode extension
-ext/Encode/Unicode/Unicode.pm	Encode extension
-ext/Encode/Unicode/Unicode.xs	Encode extension
 EXTERN.h			Included before foreign .h files
 ext/Errno/ChangeLog	Errno changes
 ext/Errno/Errno_pm.PL	Errno perl module create script
@@ -692,6 +3013,14 @@
 ext/Fcntl/t/fcntl.t	See if Fcntl works
 ext/Fcntl/t/mode.t	See if S_ISREG() and S_ISDIR() work
 ext/Fcntl/t/syslfs.t	See if large files work for sysio
+ext/FileCache/lib/FileCache.pm	Keep more files open than the system permits
+ext/FileCache/t/01open.t	See if FileCache works
+ext/FileCache/t/02maxopen.t	See if FileCache works
+ext/FileCache/t/03append.t	See if FileCache works
+ext/FileCache/t/04twoarg.t	See if FileCache works
+ext/FileCache/t/05override.t	See if FileCache works
+ext/FileCache/t/06export.t	See if FileCache exporting works
+ext/FileCache/t/07noimport.t	See if FileCache works without importing
 ext/File-Glob/bsd_glob.c	File::Glob extension run time code
 ext/File-Glob/bsd_glob.h	File::Glob extension header file
 ext/File-Glob/Changes		File::Glob extension changelog
@@ -703,9 +3032,6 @@
 ext/File-Glob/t/global.t	See if File::Glob works
 ext/File-Glob/TODO		File::Glob extension todo list
 ext/File-Glob/t/taint.t		See if File::Glob works
-ext/Filter-Util-Call/Call.pm	Filter::Util::Call extension module
-ext/Filter-Util-Call/Call.xs	Filter::Util::Call extension external subroutines
-ext/Filter-Util-Call/t/call.t	See if Filter::Util::Call works
 ext/GDBM_File/GDBM_File.pm	GDBM extension Perl module
 ext/GDBM_File/GDBM_File.xs	GDBM extension external subroutines
 ext/GDBM_File/hints/sco.pl	Hint for GDBM_File for named architecture
@@ -734,322 +3060,13 @@
 ext/I18N-Langinfo/Langinfo.xs	I18N::Langinfo
 ext/I18N-Langinfo/Makefile.PL	I18N::Langinfo
 ext/I18N-Langinfo/t/Langinfo.t	See whether I18N::Langinfo works
-ext/IO/ChangeLog		IO perl module change log
-ext/IO-Compress/Changes	IO::Compress
-ext/IO-Compress/examples/compress-zlib/filtdef	IO::Compress
-ext/IO-Compress/examples/compress-zlib/filtinf	IO::Compress
-ext/IO-Compress/examples/compress-zlib/gzcat	IO::Compress
-ext/IO-Compress/examples/compress-zlib/gzgrep	IO::Compress
-ext/IO-Compress/examples/compress-zlib/gzstream	IO::Compress
-ext/IO-Compress/examples/io/anycat	IO::Compress
-ext/IO-Compress/examples/io/bzip2/bzcat	IO::Compress
-ext/IO-Compress/examples/io/bzip2/bzgrep	IO::Compress
-ext/IO-Compress/examples/io/bzip2/bzstream	IO::Compress
-ext/IO-Compress/examples/io/gzip/gzappend	IO::Compress
-ext/IO-Compress/examples/io/gzip/gzcat	IO::Compress
-ext/IO-Compress/examples/io/gzip/gzgrep	IO::Compress
-ext/IO-Compress/examples/io/gzip/gzstream	IO::Compress
-ext/IO-Compress/lib/Compress/Zlib.pm	IO::Compress
-ext/IO-Compress/lib/File/GlobMapper.pm	IO::Compress
-ext/IO-Compress/lib/IO/Compress/Adapter/Bzip2.pm	IO::Compress
-ext/IO-Compress/lib/IO/Compress/Adapter/Deflate.pm	IO::Compress
-ext/IO-Compress/lib/IO/Compress/Adapter/Identity.pm	IO::Compress
-ext/IO-Compress/lib/IO/Compress/Base/Common.pm	IO::Compress
-ext/IO-Compress/lib/IO/Compress/Base.pm	IO::Compress
-ext/IO-Compress/lib/IO/Compress/Bzip2.pm	IO::Compress
-ext/IO-Compress/lib/IO/Compress/Deflate.pm	IO::Compress
-ext/IO-Compress/lib/IO/Compress/Gzip/Constants.pm	IO::Compress
-ext/IO-Compress/lib/IO/Compress/Gzip.pm	IO::Compress
-ext/IO-Compress/lib/IO/Compress/RawDeflate.pm	IO::Compress
-ext/IO-Compress/lib/IO/Compress/Zip/Constants.pm	IO::Compress
-ext/IO-Compress/lib/IO/Compress/Zip.pm	IO::Compress
-ext/IO-Compress/lib/IO/Compress/Zlib/Constants.pm	IO::Compress
-ext/IO-Compress/lib/IO/Compress/Zlib/Extra.pm	IO::Compress
-ext/IO-Compress/lib/IO/Uncompress/Adapter/Bunzip2.pm	IO::Compress
-ext/IO-Compress/lib/IO/Uncompress/Adapter/Identity.pm	IO::Compress
-ext/IO-Compress/lib/IO/Uncompress/Adapter/Inflate.pm	IO::Compress
-ext/IO-Compress/lib/IO/Uncompress/AnyInflate.pm	IO::Compress
-ext/IO-Compress/lib/IO/Uncompress/AnyUncompress.pm	IO::Compress
-ext/IO-Compress/lib/IO/Uncompress/Base.pm	IO::Compress
-ext/IO-Compress/lib/IO/Uncompress/Bunzip2.pm	IO::Compress
-ext/IO-Compress/lib/IO/Uncompress/Gunzip.pm	IO::Compress
-ext/IO-Compress/lib/IO/Uncompress/Inflate.pm	IO::Compress
-ext/IO-Compress/lib/IO/Uncompress/RawInflate.pm	IO::Compress
-ext/IO-Compress/lib/IO/Uncompress/Unzip.pm	IO::Compress
-ext/IO-Compress/Makefile.PL	IO::Compress
-ext/IO-Compress/pod/FAQ.pod	IO::Compress
-ext/IO-Compress/private/MakeUtil.pm	IO::Compress
-ext/IO-Compress/README	IO::Compress
-ext/IO-Compress/t/000prereq.t	IO::Compress
-ext/IO-Compress/t/001bzip2.t	IO::Compress
-ext/IO-Compress/t/001zlib-generic-deflate.t	IO::Compress
-ext/IO-Compress/t/001zlib-generic-gzip.t	IO::Compress
-ext/IO-Compress/t/001zlib-generic-rawdeflate.t	IO::Compress
-ext/IO-Compress/t/001zlib-generic-zip.t	IO::Compress
-ext/IO-Compress/t/002any-deflate.t	IO::Compress
-ext/IO-Compress/t/002any-gzip.t	IO::Compress
-ext/IO-Compress/t/002any-rawdeflate.t	IO::Compress
-ext/IO-Compress/t/002any-transparent.t	IO::Compress
-ext/IO-Compress/t/002any-zip.t	IO::Compress
-ext/IO-Compress/t/004gziphdr.t	IO::Compress
-ext/IO-Compress/t/005defhdr.t	IO::Compress
-ext/IO-Compress/t/006zip.t	IO::Compress
-ext/IO-Compress/t/010examples-bzip2.t	IO::Compress
-ext/IO-Compress/t/010examples-zlib.t	IO::Compress
-ext/IO-Compress/t/01misc.t	IO::Compress
-ext/IO-Compress/t/020isize.t	IO::Compress
-ext/IO-Compress/t/050interop-gzip.t	IO::Compress
-ext/IO-Compress/t/100generic-bzip2.t	IO::Compress
-ext/IO-Compress/t/100generic-deflate.t	IO::Compress
-ext/IO-Compress/t/100generic-gzip.t	IO::Compress
-ext/IO-Compress/t/100generic-rawdeflate.t	IO::Compress
-ext/IO-Compress/t/100generic-zip.t	IO::Compress
-ext/IO-Compress/t/101truncate-bzip2.t	IO::Compress
-ext/IO-Compress/t/101truncate-deflate.t	IO::Compress
-ext/IO-Compress/t/101truncate-gzip.t	IO::Compress
-ext/IO-Compress/t/101truncate-rawdeflate.t	IO::Compress
-ext/IO-Compress/t/101truncate-zip.t	IO::Compress
-ext/IO-Compress/t/102tied-bzip2.t	IO::Compress
-ext/IO-Compress/t/102tied-deflate.t	IO::Compress
-ext/IO-Compress/t/102tied-gzip.t	IO::Compress
-ext/IO-Compress/t/102tied-rawdeflate.t	IO::Compress
-ext/IO-Compress/t/102tied-zip.t	IO::Compress
-ext/IO-Compress/t/103newtied-bzip2.t	IO::Compress
-ext/IO-Compress/t/103newtied-deflate.t	IO::Compress
-ext/IO-Compress/t/103newtied-gzip.t	IO::Compress
-ext/IO-Compress/t/103newtied-rawdeflate.t	IO::Compress
-ext/IO-Compress/t/103newtied-zip.t	IO::Compress
-ext/IO-Compress/t/104destroy-bzip2.t	IO::Compress
-ext/IO-Compress/t/104destroy-deflate.t	IO::Compress
-ext/IO-Compress/t/104destroy-gzip.t	IO::Compress
-ext/IO-Compress/t/104destroy-rawdeflate.t	IO::Compress
-ext/IO-Compress/t/104destroy-zip.t	IO::Compress
-ext/IO-Compress/t/105oneshot-bzip2.t	IO::Compress
-ext/IO-Compress/t/105oneshot-deflate.t	IO::Compress
-ext/IO-Compress/t/105oneshot-gzip-only.t	IO::Compress
-ext/IO-Compress/t/105oneshot-gzip.t	IO::Compress
-ext/IO-Compress/t/105oneshot-rawdeflate.t	IO::Compress
-ext/IO-Compress/t/105oneshot-zip-bzip2-only.t	IO::Compress
-ext/IO-Compress/t/105oneshot-zip-only.t	IO::Compress
-ext/IO-Compress/t/105oneshot-zip.t	IO::Compress
-ext/IO-Compress/t/106prime-bzip2.t	IO::Compress
-ext/IO-Compress/t/106prime-deflate.t	IO::Compress
-ext/IO-Compress/t/106prime-gzip.t	IO::Compress
-ext/IO-Compress/t/106prime-rawdeflate.t	IO::Compress
-ext/IO-Compress/t/106prime-zip.t	IO::Compress
-ext/IO-Compress/t/107multi-bzip2.t	IO::Compress
-ext/IO-Compress/t/107multi-deflate.t	IO::Compress
-ext/IO-Compress/t/107multi-gzip.t	IO::Compress
-ext/IO-Compress/t/107multi-rawdeflate.t	IO::Compress
-ext/IO-Compress/t/107multi-zip.t	IO::Compress
-ext/IO-Compress/t/108anyunc-bzip2.t	IO::Compress
-ext/IO-Compress/t/108anyunc-deflate.t	IO::Compress
-ext/IO-Compress/t/108anyunc-gzip.t	IO::Compress
-ext/IO-Compress/t/108anyunc-rawdeflate.t	IO::Compress
-ext/IO-Compress/t/108anyunc-transparent.t	IO::Compress
-ext/IO-Compress/t/108anyunc-zip.t	IO::Compress
-ext/IO-Compress/t/109merge-deflate.t	IO::Compress
-ext/IO-Compress/t/109merge-gzip.t	IO::Compress
-ext/IO-Compress/t/109merge-rawdeflate.t	IO::Compress
-ext/IO-Compress/t/109merge-zip.t	IO::Compress
-ext/IO-Compress/t/110encode-bzip2.t	IO::Compress
-ext/IO-Compress/t/110encode-deflate.t	IO::Compress
-ext/IO-Compress/t/110encode-gzip.t	IO::Compress
-ext/IO-Compress/t/110encode-rawdeflate.t	IO::Compress
-ext/IO-Compress/t/110encode-zip.t	IO::Compress
-ext/IO-Compress/t/999pod.t	IO::Compress
-ext/IO-Compress/t/cz-01version.t	IO::Compress
-ext/IO-Compress/t/cz-05examples.t	IO::Compress
-ext/IO-Compress/t/cz-06gzsetp.t	IO::Compress
-ext/IO-Compress/t/cz-08encoding.t	IO::Compress
-ext/IO-Compress/t/cz-14gzopen.t	IO::Compress
-ext/IO-Compress/t/globmapper.t	IO::Compress
-ext/IO/hints/sco.pl		Hint for IO for named architecture
-ext/IO/IO.pm			Top-level interface to IO::* classes
-ext/IO/IO.xs			IO extension external subroutines
-ext/IO/lib/IO/Dir.pm		IO directory reading package
-ext/IO/lib/IO/File.pm		IO file handle package
-ext/IO/lib/IO/Handle.pm		IO base handle package
-ext/IO/lib/IO/Pipe.pm		IO pipe package
-ext/IO/lib/IO/Poll.pm		IO system poll() interface
-ext/IO/lib/IO/Seekable.pm	IO methods for seekable handles
-ext/IO/lib/IO/Select.pm		IO system select() interface
-ext/IO/lib/IO/Socket/INET.pm	IO INET specific socket methods
-ext/IO/lib/IO/Socket.pm		IO socket handle package
-ext/IO/lib/IO/Socket/UNIX.pm	IO UNIX specific socket methods
-ext/IO/Makefile.PL		IO extension makefile writer
-ext/IO/poll.c			IO poll() emulation using select()
-ext/IO/poll.h			IO poll() emulation using select()
-ext/IO/README			IO extension maintenance notice
-ext/IO/t/io_const.t	See if constants from IO work
-ext/IO/t/io_dir.t	See if directory-related methods from IO work
-ext/IO/t/io_dup.t	See if dup()-related methods from IO work
-ext/IO/t/io_file.t	See if binmode()-related methods on IO::File work
-ext/IO/t/io_linenum.t	See if I/O line numbers are tracked correctly
-ext/IO/t/io_multihomed.t	See if INET sockets work with multi-homed hosts
-ext/IO/t/io_pipe.t	See if pipe()-related methods from IO work
-ext/IO/t/io_poll.t	See if poll()-related methods from IO work
-ext/IO/t/io_sel.t	See if select()-related methods from IO work
-ext/IO/t/io_sock.t	See if INET socket-related methods from IO work
-ext/IO/t/IO.t	See if IO works
-ext/IO/t/io_taint.t	See if the untaint method from IO works
-ext/IO/t/io_tell.t	See if seek()/tell()-related methods from IO work
-ext/IO/t/io_udp.t	See if UDP socket-related methods from IO work
-ext/IO/t/io_unix.t	See if UNIX socket-related methods from IO work
-ext/IO/t/io_utf8.t	See if perlio opens work
-ext/IO/t/io_xs.t		See if XSUB methods from IO work
-ext/IPC-SysV/Changes	IPC::SysV changes
-ext/IPC-SysV/hints/cygwin.pl	Hint for IPC::SysV for named architecture
-ext/IPC-SysV/hints/next_3.pl	Hint for IPC::SysV for named architecture
-ext/IPC-SysV/lib/IPC/Msg.pm	IPC::SysV extension Perl module
-ext/IPC-SysV/lib/IPC/Semaphore.pm	IPC::SysV extension Perl module
-ext/IPC-SysV/lib/IPC/SharedMem.pm	IPC::SysV extension Perl module
-ext/IPC-SysV/lib/IPC/SysV.pm	IPC::SysV extension Perl module
-ext/IPC-SysV/Makefile.PL	IPC::SysV makefile writer
-ext/IPC-SysV/MANIFEST.SKIP	IPC::SysV manifest skip specs
-ext/IPC-SysV/README		IPC::SysV README
-ext/IPC-SysV/regen.pl	IPC::SysV file regeneration script
-ext/IPC-SysV/SysV.xs		IPC::SysV extension Perl module
-ext/IPC-SysV/t/ipcsysv.t		IPC::SysV test file
-ext/IPC-SysV/t/msg.t		IPC::SysV test file
-ext/IPC-SysV/TODO	IPC::SysV todo file
-ext/IPC-SysV/t/podcov.t	IPC::SysV test file
-ext/IPC-SysV/t/pod.t	IPC::SysV test file
-ext/IPC-SysV/t/sem.t		IPC::SysV test file
-ext/IPC-SysV/t/shm.t	IPC::SysV test file
-ext/IPC-SysV/typemap	IPC::SysV typemap
-ext/List-Util/Changes		Util extension
-ext/List-Util/lib/List/Util.pm	List::Util
-ext/List-Util/lib/List/Util/PP.pm	List::Util
-ext/List-Util/lib/List/Util/XS.pm	List::Util
-ext/List-Util/lib/Scalar/Util.pm	Scalar::Util
-ext/List-Util/lib/Scalar/Util/PP.pm	Scalar::Util
-ext/List-Util/ListUtil.xs		Util extension
-ext/List-Util/Makefile.PL	Util extension
-ext/List-Util/multicall.h	Util extension
-ext/List-Util/README		Util extension
-ext/List-Util/t/00version.t	Scalar::Util
-ext/List-Util/t/blessed.t	Scalar::Util
-ext/List-Util/t/dualvar.t	Scalar::Util
-ext/List-Util/t/expfail.t	List::Util
-ext/List-Util/t/first.t		List::Util
-ext/List-Util/t/isvstring.t	Scalar::Util
-ext/List-Util/t/lln.t		Scalar::Util
-ext/List-Util/t/maxstr.t	List::Util
-ext/List-Util/t/max.t		List::Util
-ext/List-Util/t/minstr.t	List::Util
-ext/List-Util/t/min.t		List::Util
-ext/List-Util/t/openhan.t	Scalar::Util
-ext/List-Util/t/p_00version.t	Scalar::Util
-ext/List-Util/t/p_blessed.t	Scalar::Util
-ext/List-Util/t/p_first.t	List::Util
-ext/List-Util/t/p_lln.t		Scalar::Util
-ext/List-Util/t/p_maxstr.t	List::Util
-ext/List-Util/t/p_max.t		List::Util
-ext/List-Util/t/p_minstr.t	List::Util
-ext/List-Util/t/p_min.t		List::Util
-ext/List-Util/t/p_openhan.t	Scalar::Util
-ext/List-Util/t/p_readonly.t	Scalar::Util
-ext/List-Util/t/p_reduce.t	List::Util
-ext/List-Util/t/p_refaddr.t	Scalar::Util
-ext/List-Util/t/p_reftype.t	Scalar::Util
-ext/List-Util/t/proto.t		Scalar::Util
-ext/List-Util/t/p_shuffle.t	List::Util
-ext/List-Util/t/p_sum.t		List::Util
-ext/List-Util/t/p_tainted.t	Scalar::Util
-ext/List-Util/t/readonly.t	Scalar::Util
-ext/List-Util/t/reduce.t	List::Util
-ext/List-Util/t/refaddr.t	Scalar::Util
-ext/List-Util/t/reftype.t	Scalar::Util
-ext/List-Util/t/shuffle.t	List::Util
-ext/List-Util/t/stack-corruption.t	List::Util
-ext/List-Util/t/sum.t		List::Util
-ext/List-Util/t/tainted.t	Scalar::Util
-ext/List-Util/t/weak.t		Scalar::Util
-ext/List-Util/XS.pp		List::Util
-ext/Math-BigInt-FastCalc/FastCalc.pm	Math::BigInt::FastCalc extension
-ext/Math-BigInt-FastCalc/FastCalc.xs	Math::BigInt::FastCalc extension
-ext/Math-BigInt-FastCalc/t/bigintfc.t	Math::BigInt::FastCalc extension
-ext/Math-BigInt-FastCalc/t/bootstrap.t	Math::BigInt::FastCalc extension
-ext/Math-BigInt-FastCalc/t/leak.t	test for memory leaks in Math::BigInt::FastCalc
-ext/Math-BigInt-FastCalc/t/mbi_rand.t	Math::BigInt::FastCalc extension
-ext/MIME-Base64/Base64.pm	MIME::Base64 extension
-ext/MIME-Base64/Base64.xs	MIME::Base64 extension
-ext/MIME-Base64/Changes		MIME::Base64 extension
-ext/MIME-Base64/Makefile.PL	MIME::Base64 extension
-ext/MIME-Base64/QuotedPrint.pm	MIME::Base64 extension
-ext/MIME-Base64/README		README for MIME::Base64
-ext/MIME-Base64/t/base64.t	See whether MIME::Base64 works
-ext/MIME-Base64/t/quoted-print.t	See whether MIME::QuotedPrint works
-ext/MIME-Base64/t/unicode.t	See whether MIME::Base64 works
-ext/MIME-Base64/t/warn.t	See whether MIME::Base64 works
-ext/Module-Pluggable/lib/Devel/InnerPackage.pm		Find inner packages
-ext/Module-Pluggable/lib/Module/Pluggable/Object.pm	Module::Pluggable
-ext/Module-Pluggable/lib/Module/Pluggable.pm		Module::Pluggable
-ext/Module-Pluggable/Makefile.PL			Module::Pluggable
-ext/Module-Pluggable/t/01use.t	Module::Pluggable tests
-ext/Module-Pluggable/t/02alsoworks.t	Module::Pluggable tests
-ext/Module-Pluggable/t/02works.t	Module::Pluggable tests
-ext/Module-Pluggable/t/02works_taint.t	Module::Pluggable tests
-ext/Module-Pluggable/t/03diffname.t	Module::Pluggable tests
-ext/Module-Pluggable/t/04acmedir_single.t	Module::Pluggable tests
-ext/Module-Pluggable/t/04acmedir.t	Module::Pluggable tests
-ext/Module-Pluggable/t/04acmepath_single.t	Module::Pluggable tests
-ext/Module-Pluggable/t/04acmepath.t	Module::Pluggable tests
-ext/Module-Pluggable/t/05postpath.t	Module::Pluggable tests
-ext/Module-Pluggable/t/06multipath.t	Module::Pluggable tests
-ext/Module-Pluggable/t/07instantiate.t	Module::Pluggable tests
-ext/Module-Pluggable/t/08nothing.t	Module::Pluggable tests
-ext/Module-Pluggable/t/09require.t	Module::Pluggable tests
-ext/Module-Pluggable/t/10innerpack_inner.t	Module::Pluggable tests
-ext/Module-Pluggable/t/10innerpack_noinner.t	Module::Pluggable tests
-ext/Module-Pluggable/t/10innerpack_onefile.t	Module::Pluggable tests
-ext/Module-Pluggable/t/10innerpack_override.t	Module::Pluggable tests
-ext/Module-Pluggable/t/10innerpack_super.t		Module::Pluggable tests
-ext/Module-Pluggable/t/10innerpack.t	Module::Pluggable tests
-ext/Module-Pluggable/t/11usetwice.t	Module::Pluggable tests
-ext/Module-Pluggable/t/12onlyarray.t	Module::Pluggable tests
-ext/Module-Pluggable/t/12onlyregex.t	Module::Pluggable tests
-ext/Module-Pluggable/t/12onlyrequire.t	Module::Pluggable tests
-ext/Module-Pluggable/t/12only.t	Module::Pluggable tests
-ext/Module-Pluggable/t/13exceptarray.t	Module::Pluggable tests
-ext/Module-Pluggable/t/13exceptregex.t	Module::Pluggable tests
-ext/Module-Pluggable/t/13except.t	Module::Pluggable tests
-ext/Module-Pluggable/t/14package.t	Module::Pluggable tests
-ext/Module-Pluggable/t/15topicsafe.t	Module::Pluggable tests
-ext/Module-Pluggable/t/16different_extension.t	Module::Pluggable tests
-ext/Module-Pluggable/t/17devel_inner_package.t	Module::Pluggable tests
-ext/Module-Pluggable/t/18skipped_package.t	Module::Pluggable tests
-ext/Module-Pluggable/t/19can_ok_clobber.t	Module::Pluggable tests
-ext/Module-Pluggable/t/20dodgy_files.t	Module::Pluggable tests
-ext/Module-Pluggable/t/21editor_junk.t			Module::Pluggable tests
-ext/Module-Pluggable/t/acme/Acme/MyTest/Plugin/Foo.pm	Module::Pluggable tests
-ext/Module-Pluggable/t/lib/Acme/Foo-Bar.pm			Module::Pluggable tests
-ext/Module-Pluggable/t/lib/Acme/MyTest/Plugin/Foo.pm	Module::Pluggable tests
-ext/Module-Pluggable/t/lib/EditorJunk/Plugin/Bar.pm		Module::Pluggable tests
-ext/Module-Pluggable/t/lib/EditorJunk/Plugin/Bar.pm.swo	Module::Pluggable tests
-ext/Module-Pluggable/t/lib/EditorJunk/Plugin/Bar.pm.swp	Module::Pluggable tests
-ext/Module-Pluggable/t/lib/EditorJunk/Plugin/Foo.pm		Module::Pluggable tests
-ext/Module-Pluggable/t/lib/ExtTest/Plugin/Bar.plugin	Module::Pluggable tests
-ext/Module-Pluggable/t/lib/ExtTest/Plugin/Foo.plugin	Module::Pluggable tests
-ext/Module-Pluggable/t/lib/ExtTest/Plugin/Quux/Foo.plugin	Module::Pluggable tests
-ext/Module-Pluggable/t/lib/InnerTest/Plugin/Foo.pm	Module::Pluggable tests
-ext/Module-Pluggable/t/lib/MyOtherTest/Plugin/Bar.pm	Module::Pluggable tests
-ext/Module-Pluggable/t/lib/MyOtherTest/Plugin/Foo.pm	Module::Pluggable tests
-ext/Module-Pluggable/t/lib/MyOtherTest/Plugin/Quux/Foo.pm	Module::Pluggable tests
-ext/Module-Pluggable/t/lib/MyOtherTest/Plugin/Quux.pm	Module::Pluggable tests
-ext/Module-Pluggable/t/lib/MyTest/Extend/Plugin/Bar.pm	Module::Pluggable tests
-ext/Module-Pluggable/t/lib/MyTest/Plugin/Bar.pm	Module::Pluggable tests
-ext/Module-Pluggable/t/lib/MyTest/Plugin/Foo.pm	Module::Pluggable tests
-ext/Module-Pluggable/t/lib/MyTest/Plugin/Quux/Foo.pm	Module::Pluggable tests
-ext/Module-Pluggable/t/lib/No/Middle.pm	Module::Pluggable tests
-ext/Module-Pluggable/t/lib/OddTest/Plugin/Foo.pm	Module::Pluggable tests
-ext/Module-Pluggable/t/lib/TA/C/A/I.pm	Module::Pluggable tests
-ext/Module-Pluggable/t/lib/Zot/.Zork.pm	Module::Pluggable tests
+ext/IPC-Open2/lib/IPC/Open2.pm	Open a two-ended pipe
+ext/IPC-Open2/t/IPC-Open2.t	See if IPC::Open2 works
+ext/IPC-Open3/lib/IPC/Open3.pm	Open a three-ended pipe
+ext/IPC-Open3/t/IPC-Open3.t	See if IPC::Open3 works
 ext/mro/Changes			mro extension
 ext/mro/mro.pm			mro extension
 ext/mro/mro.xs			mro extension
-ext/mro/t/pluggable.t		Test that c3 mro extension is actually pluggable
 ext/NDBM_File/hints/cygwin.pl	Hint for NDBM_File for named architecture
 ext/NDBM_File/hints/dec_osf.pl	Hint for NDBM_File for named architecture
 ext/NDBM_File/hints/dynixptx.pl	Hint for NDBM_File for named architecture
@@ -1138,16 +3155,6 @@
 ext/re/t/regop.pl		generate debug output for various patterns
 ext/re/t/regop.t		test RE optimizations by scraping debug output
 ext/re/t/re.t			see if re pragma works
-ext/Safe/Safe.pm		Safe extension Perl module
-ext/Safe/t/safe1.t		See if Safe works
-ext/Safe/t/safe2.t		See if Safe works
-ext/Safe/t/safe3.t		See if Safe works
-ext/Safe/t/safeload.t		Tests that some modules can be loaded by Safe
-ext/Safe/t/safeops.t		Tests that all ops can be trapped by Safe
-ext/Safe/t/safesort.t		See if Safe works
-ext/Safe/t/safeuniversal.t	Tests Safe with functions from universal.c
-ext/Safe/t/safeutf8.t		See if Safe works
-ext/Safe/t/safewrap.t		See if Safe works
 ext/SDBM_File/Makefile.PL	SDBM extension makefile writer
 ext/SDBM_File/sdbm/biblio	SDBM kit
 ext/SDBM_File/sdbm/CHANGES	SDBM kit
@@ -1181,392 +3188,39 @@
 ext/Socket/Socket.xs		Socket extension external subroutines
 ext/Socket/t/socketpair.t	See if socketpair works
 ext/Socket/t/Socket.t		See if Socket works
-ext/Storable/ChangeLog		Storable extension
-ext/Storable/hints/gnukfreebsd.pl	Hint for Storable for named architecture
-ext/Storable/hints/gnuknetbsd.pl	Hint for Storable for named architecture
-ext/Storable/hints/hpux.pl	Hint for Storable for named architecture
-ext/Storable/hints/linux.pl	Hint for Storable for named architecture
-ext/Storable/Makefile.PL	Storable extension
-ext/Storable/README		Storable extension
-ext/Storable/Storable.pm	Storable extension
-ext/Storable/Storable.xs	Storable extension
-ext/Storable/t/attach_errors.t	Trigger and test STORABLE_attach errors
-ext/Storable/t/attach_singleton.t	Test STORABLE_attach for the Singleton pattern
-ext/Storable/t/blessed.t	See if Storable works
-ext/Storable/t/canonical.t	See if Storable works
-ext/Storable/t/circular_hook.t	Test thaw hook called depth-first for circular refs
-ext/Storable/t/code.t		See if Storable works
-ext/Storable/t/compat01.t	See if Storable works
-ext/Storable/t/compat06.t	See if Storable works
-ext/Storable/t/croak.t		See if Storable works
-ext/Storable/t/dclone.t		See if Storable works
-ext/Storable/t/downgrade.t	See if Storable works
-ext/Storable/t/file_magic.t	See if file_magic function works
-ext/Storable/t/forgive.t	See if Storable works
-ext/Storable/t/freeze.t		See if Storable works
-ext/Storable/t/HAS_ATTACH.pm	For auto-requiring of modules for STORABLE_attach
-ext/Storable/t/HAS_HOOK.pm	For auto-requiring of modules for STORABLE_thaw
-ext/Storable/t/HAS_OVERLOAD.pm	For auto-requiring of mdoules for overload
-ext/Storable/t/integer.t	See if Storable works
-ext/Storable/t/interwork56.t	Test compatibility kludge for 64bit data under 5.6.x
-ext/Storable/t/just_plain_nasty.t	See if Storable works
-ext/Storable/t/lock.t		See if Storable works
-ext/Storable/t/make_56_interwork.pl	Make test data for interwork56.t
-ext/Storable/t/make_downgrade.pl	Make test data for downgrade.t
-ext/Storable/t/make_overload.pl	Make test data for overload.t
-ext/Storable/t/malice.t		See if Storable copes with corrupt files
-ext/Storable/t/overload.t	See if Storable works
-ext/Storable/t/recurse.t	See if Storable works
-ext/Storable/t/restrict.t	See if Storable works
-ext/Storable/t/retrieve.t	See if Storable works
-ext/Storable/t/sig_die.t	See if Storable works
-ext/Storable/t/st-dump.pl	See if Storable works
-ext/Storable/t/store.t		See if Storable works
-ext/Storable/t/testlib.pl	more helper routines for tests
-ext/Storable/t/threads.t	Does Storable work with threads?
-ext/Storable/t/tied_hook.t	See if Storable works
-ext/Storable/t/tied_items.t	See if Storable works
-ext/Storable/t/tied.t		See if Storable works
-ext/Storable/t/utf8hash.t	See if Storable works
-ext/Storable/t/utf8.t		See if Storable works
-ext/Storable/t/weak.t		Can Storable store weakrefs
 ext/Sys-Hostname/Hostname.pm	Sys::Hostname extension Perl module
 ext/Sys-Hostname/Hostname.xs	Sys::Hostname extension external subroutines
 ext/Sys-Hostname/t/Hostname.t	See if Sys::Hostname works
-ext/Sys-Syslog/Changes		Changlog for Sys::Syslog
-ext/Sys-Syslog/fallback/const-c.inc	Sys::Syslog constants fallback file
-ext/Sys-Syslog/fallback/const-xs.inc	Sys::Syslog constants fallback file
-ext/Sys-Syslog/fallback/syslog.h	Sys::Syslog header fallback file
-ext/Sys-Syslog/Makefile.PL	Sys::Syslog extension makefile writer
-ext/Sys-Syslog/README		README for Sys::Syslog
-ext/Sys-Syslog/README.win32	README for Sys::Syslog on Windows
-ext/Sys-Syslog/Syslog.pm	Sys::Syslog extension Perl module
-ext/Sys-Syslog/Syslog.xs	Sys::Syslog extension external subroutines
-ext/Sys-Syslog/t/00-load.t	test for Sys::Syslog
-ext/Sys-Syslog/t/constants.t	test for Sys::Syslog
-ext/Sys-Syslog/t/syslog.t	See if Sys::Syslog works
-ext/Sys-Syslog/win32/compile.pl	Sys::Syslog extension Win32 related file
-ext/Sys-Syslog/win32/PerlLog_dll.uu	Sys::Syslog extension Win32 related file
-ext/Sys-Syslog/win32/PerlLog.mc	Sys::Syslog extension Win32 related file
-ext/Sys-Syslog/win32/PerlLog_RES.uu	Sys::Syslog extension Win32 related file
-ext/Sys-Syslog/win32/Win32.pm	Sys::Syslog extension Win32 related file
-ext/Test-Harness/bin/prove		The prove harness utility
-ext/Test-Harness/Changes		Test::Harness change log
-ext/Test-Harness/lib/App/Prove.pm	Gubbins for the prove utility
-ext/Test-Harness/lib/App/Prove/State.pm	Gubbins for the prove utility
-ext/Test-Harness/lib/App/Prove/State/Result.pm	Gubbins for the prove utility
-ext/Test-Harness/lib/App/Prove/State/Result/Test.pm	Gubbins for the prove utility
-ext/Test-Harness/lib/TAP/Base.pm			A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Formatter/Base.pm		A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Formatter/Color.pm		A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Formatter/Console/ParallelSession.pm	A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Formatter/Console.pm		A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Formatter/Console/Session.pm	A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Formatter/File.pm		A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Formatter/File/Session.pm	A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Formatter/Session.pm		A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Harness.pm			A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Object.pm			A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Aggregator.pm		A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Grammar.pm		A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Iterator/Array.pm	A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/IteratorFactory.pm	A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Iterator.pm		A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Iterator/Process.pm	A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Iterator/Stream.pm	A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Multiplexer.pm		A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser.pm			A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Result/Bailout.pm	A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Result/Comment.pm	A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/ResultFactory.pm	A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Result/Plan.pm		A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Result.pm		A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Result/Pragma.pm	A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Result/Test.pm		A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Result/Unknown.pm	A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Result/Version.pm	A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Result/YAML.pm		A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Scheduler/Job.pm	A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Scheduler.pm		A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Scheduler/Spinner.pm	A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Source/Perl.pm		A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Source.pm		A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/Utils.pm		A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/YAMLish/Reader.pm	A parser for Test Anything Protocol
-ext/Test-Harness/lib/TAP/Parser/YAMLish/Writer.pm	A parser for Test Anything Protocol
-ext/Test-Harness/lib/Test/Harness.pm			A test harness
-ext/Test-Harness/t/000-load.t				Test::Harness test
-ext/Test-Harness/t/aggregator.t				Test::Harness test
-ext/Test-Harness/t/bailout.t				Test::Harness test
-ext/Test-Harness/t/base.t				Test::Harness test
-ext/Test-Harness/t/callbacks.t				Test::Harness test
-ext/Test-Harness/t/compat/env.t				Test::Harness test
-ext/Test-Harness/t/compat/failure.t			Test::Harness test
-ext/Test-Harness/t/compat/inc-propagation.t		Test::Harness test
-ext/Test-Harness/t/compat/inc_taint.t			Test::Harness test
-ext/Test-Harness/t/compat/nonumbers.t			Test::Harness test
-ext/Test-Harness/t/compat/regression.t			Test::Harness test
-ext/Test-Harness/t/compat/switches.t			Test::Harness test
-ext/Test-Harness/t/compat/test-harness-compat.t		Test::Harness test
-ext/Test-Harness/t/compat/version.t			Test::Harness test
-ext/Test-Harness/t/console.t				Test::Harness test
-ext/Test-Harness/t/data/catme.1				Test data for Test::Harness
-ext/Test-Harness/t/data/proverc				Test data for Test::Harness
-ext/Test-Harness/t/data/sample.yml			Test data for Test::Harness
-ext/Test-Harness/t/errors.t				Test::Harness test
-ext/Test-Harness/t/file.t				Test::Harness test
-ext/Test-Harness/t/glob-to-regexp.t			Test::Harness test
-ext/Test-Harness/t/grammar.t				Test::Harness test
-ext/Test-Harness/t/harness-bailout.t			Test::Harness test
-ext/Test-Harness/t/harness-subclass.t			Test::Harness test
-ext/Test-Harness/t/harness.t				Test::Harness test
-ext/Test-Harness/t/iterators.t				Test::Harness test
-ext/Test-Harness/t/lib/App/Prove/Plugin/Dummy2.pm	Module for testing Test::Harness
-ext/Test-Harness/t/lib/App/Prove/Plugin/Dummy.pm	Module for testing Test::Harness
-ext/Test-Harness/t/lib/Dev/Null.pm			Module for testing Test::Harness
-ext/Test-Harness/t/lib/EmptyParser.pm			Module for testing Test::Harness
-ext/Test-Harness/t/lib/IO/c55Capture.pm			Module for testing Test::Harness
-ext/Test-Harness/t/lib/MyCustom.pm			Module for testing Test::Harness
-ext/Test-Harness/t/lib/MyGrammar.pm			Module for testing Test::Harness
-ext/Test-Harness/t/lib/MyIteratorFactory.pm		Module for testing Test::Harness
-ext/Test-Harness/t/lib/MyIterator.pm			Module for testing Test::Harness
-ext/Test-Harness/t/lib/MyPerlSource.pm			Module for testing Test::Harness
-ext/Test-Harness/t/lib/MyResultFactory.pm		Module for testing Test::Harness
-ext/Test-Harness/t/lib/MyResult.pm			Module for testing Test::Harness
-ext/Test-Harness/t/lib/MySource.pm			Module for testing Test::Harness
-ext/Test-Harness/t/lib/NoFork.pm			Module for testing Test::Harness
-ext/Test-Harness/t/lib/NOP.pm				Module for testing Test::Harness
-ext/Test-Harness/t/lib/TAP/Parser/SubclassTest.pm	Module for testing Test::Harness
-ext/Test-Harness/t/multiplexer.t			Test::Harness test
-ext/Test-Harness/t/nofork-mux.t				Test::Harness test
-ext/Test-Harness/t/nofork.t				Test::Harness test
-ext/Test-Harness/t/object.t				Test::Harness test
-ext/Test-Harness/t/parser-config.t			Test::Harness test
-ext/Test-Harness/t/parser-subclass.t			Test::Harness test
-ext/Test-Harness/t/parse.t				Test::Harness test
-ext/Test-Harness/t/perl5lib.t				Test::Harness test
-ext/Test-Harness/t/premature-bailout.t			Test::Harness test
-ext/Test-Harness/t/process.t				Test::Harness test
-ext/Test-Harness/t/proveenv.t				Test::Harness test
-ext/Test-Harness/t/proverc/emptyexec			Test data for Test::Harness
-ext/Test-Harness/t/proverc.t				Test::Harness test
-ext/Test-Harness/t/proverun.t				Test::Harness test
-ext/Test-Harness/t/prove.t				Test::Harness test
-ext/Test-Harness/t/regression.t				Test::Harness test
-ext/Test-Harness/t/results.t				Test::Harness test
-ext/Test-Harness/t/sample-tests/bailout			Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/bignum			Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/bignum_many		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/combined		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/combined_compat		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/delayed			Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/descriptive		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/descriptive_trailing	Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/die			Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/die_head_end		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/die_last_minute		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/die_unfinished		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/duplicates		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/echo			Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/empty			Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/escape_eol		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/escape_hash		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/head_end		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/head_fail		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/inc_taint		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/junk_before_plan	Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/lone_not_bug		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/no_nums			Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/no_output		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/out_err_mix		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/out_of_order		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/schwern			Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/schwern-todo-quiet	Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/segfault		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/sequence_misparse	Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/shbang_misparse		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/simple			Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/simple_fail		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/simple_yaml		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/skip			Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/skipall			Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/skipall_nomsg		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/skipall_v13		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/skip_nomsg		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/space_after_plan	Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/stdout_stderr		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/strict			Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/switches		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/taint			Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/taint_warn		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/todo			Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/todo_inline		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/todo_misparse		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/too_many		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/version_good		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/version_late		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/version_old		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/vms_nit			Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/with_comments		Test data for Test::Harness
-ext/Test-Harness/t/sample-tests/zero_valid		Test data for Test::Harness
-ext/Test-Harness/t/scheduler.t				Test::Harness test
-ext/Test-Harness/t/source.t				Test::Harness test
-ext/Test-Harness/t/source_tests/harness			Test data for Test::Harness
-ext/Test-Harness/t/source_tests/harness_badtap		Test data for Test::Harness
-ext/Test-Harness/t/source_tests/harness_complain	Test data for Test::Harness
-ext/Test-Harness/t/source_tests/harness_directives	Test data for Test::Harness
-ext/Test-Harness/t/source_tests/harness_failure		Test data for Test::Harness
-ext/Test-Harness/t/source_tests/source			Test data for Test::Harness
-ext/Test-Harness/t/spool.t				Test::Harness test
-ext/Test-Harness/t/state_results.t			Test::Harness test
-ext/Test-Harness/t/state.t				Test::Harness test
-ext/Test-Harness/t/streams.t				Test::Harness test
-ext/Test-Harness/t/subclass_tests/non_perl_source	Test data for Test::Harness
-ext/Test-Harness/t/subclass_tests/perl_source		Test data for Test::Harness
-ext/Test-Harness/t/taint.t				Test::Harness test
-ext/Test-Harness/t/testargs.t				Test::Harness test
-ext/Test-Harness/t/unicode.t				Test::Harness test
-ext/Test-Harness/t/utils.t				Test::Harness test
-ext/Test-Harness/t/yamlish-output.t			Test::Harness test
-ext/Test-Harness/t/yamlish.t				Test::Harness test
-ext/Test-Harness/t/yamlish-writer.t			Test::Harness test
-ext/Text-Soundex/Changes	Changelog for Text::Soundex
-ext/Text-Soundex/README		README for Text::Soundex
-ext/Text-Soundex/Soundex.pm	Text::Soundex extension Perl module
-ext/Text-Soundex/Soundex.xs	Text::Soundex extension external subroutines
-ext/Text-Soundex/t/Soundex.t	test for Text::Soundex
-ext/threads/hints/hpux.pl	Hint file for HPUX
-ext/threads/hints/linux.pl	Hint file for Linux
-ext/threads/Makefile.PL		ithreads
-ext/threads-shared/hints/linux.pl	thread shared variables
-ext/threads-shared/Makefile.PL	thread shared variables
-ext/threads-shared/shared.pm	thread shared variables
-ext/threads-shared/shared.xs	thread shared variables
-ext/threads-shared/t/0nothread.t	Tests for basic shared array functionality.
-ext/threads-shared/t/av_refs.t	Tests for arrays containing references
-ext/threads-shared/t/av_simple.t	Tests for basic shared array functionality.
-ext/threads-shared/t/blessed.t	Test blessed shared variables
-ext/threads-shared/t/clone.t	Test shared cloning
-ext/threads-shared/t/cond.t	Test condition variables
-ext/threads-shared/t/disabled.t	Test threads::shared when threads are disabled.
-ext/threads-shared/t/hv_refs.t	Test shared hashes containing references
-ext/threads-shared/t/hv_simple.t	Tests for basic shared hash functionality.
-ext/threads-shared/t/no_share.t	Tests for disabled share on variables.
-ext/threads-shared/t/object.t	Shared objects tests
-ext/threads-shared/t/shared_attr.t	Test :shared attribute
-ext/threads-shared/t/stress.t	Stress test
-ext/threads-shared/t/sv_refs.t	thread shared variables
-ext/threads-shared/t/sv_simple.t	thread shared variables
-ext/threads-shared/t/utf8.t	Test UTF-8 keys in shared hashes
-ext/threads-shared/t/waithires.t	Test sub-second cond_timedwait
-ext/threads-shared/t/wait.t	Test cond_wait and cond_timedwait
-ext/threads/t/basic.t		ithreads
-ext/threads/t/blocks.t		Test threads in special blocks
-ext/threads/t/context.t		Explicit thread context
-ext/threads/t/end.t		Test end functions
-ext/threads/t/err.t		Test $thr->error()
-ext/threads/t/exit.t		Test exit and die in threads
-ext/threads/t/free2.t		More ithread destruction tests
-ext/threads/t/free.t		Test ithread destruction
-ext/threads/threads.pm		ithreads
-ext/threads/threads.xs		ithreads
-ext/threads/t/join.t		Testing the join function
-ext/threads/t/kill.t		Tests thread signalling
-ext/threads/t/libc.t		testing libc functions for threadsafety
-ext/threads/t/list.t		Test threads->list()
-ext/threads/t/problems.t	Test various memory problems
-ext/threads/t/stack_env.t	Tests for stack limits
-ext/threads/t/stack.t		Tests for stack limits
-ext/threads/t/state.t		Tests state methods
-ext/threads/t/stress_cv.t	Test with multiple threads, coderef cv argument.
-ext/threads/t/stress_re.t	Test with multiple threads, string cv argument and regexes.
-ext/threads/t/stress_string.t	Test with multiple threads, string cv argument.
-ext/threads/t/thread.t		General ithread tests from thr5005
-ext/Time-HiRes/Changes		Time::HiRes extension
-ext/Time-HiRes/fallback/const-c.inc	Time::HiRes extension
-ext/Time-HiRes/fallback/const-xs.inc	Time::HiRes extension
-ext/Time-HiRes/hints/aix.pl	Hint for Time::HiRes for named architecture
-ext/Time-HiRes/hints/dec_osf.pl		Hint for Time::HiRes for named architecture
-ext/Time-HiRes/hints/dynixptx.pl	Hint for Time::HiRes for named architecture
-ext/Time-HiRes/hints/irix.pl	Hint for Time::HiRes for named architecture
-ext/Time-HiRes/hints/linux.pl	Hints for Time::HiRes for named architecture
-ext/Time-HiRes/hints/sco.pl	Hints for Time::HiRes for named architecture
-ext/Time-HiRes/hints/solaris.pl	Hints for Time::HiRes for named architecture
-ext/Time-HiRes/hints/svr4.pl	Hints for Time::HiRes for named architecture
-ext/Time-HiRes/HiRes.pm		Time::HiRes extension
-ext/Time-HiRes/HiRes.xs		Time::HiRes extension
-ext/Time-HiRes/Makefile.PL	Time::HiRes extension
-ext/Time-HiRes/t/HiRes.t	Test for Time::HiRes
-ext/Time-HiRes/typemap		Time::HiRes extension
-ext/Time-Piece/Changes		Time::Piece extension
-ext/Time-Piece/Makefile.PL	Time::Piece extension
-ext/Time-Piece/Piece.pm		Time::Piece extension
-ext/Time-Piece/Piece.xs		Time::Piece extension
-ext/Time-Piece/README		Time::Piece extension
-ext/Time-Piece/Seconds.pm	Time::Piece extension
-ext/Time-Piece/t/01base.t	Test for Time::Piece
-ext/Time-Piece/t/02core.t	Test for Time::Piece
-ext/Time-Piece/t/03compare.t	Test for Time::Piece
-ext/Time-Piece/t/04mjd.t	Test for Time::Piece
-ext/Time-Piece/t/05overload.t	Test for Time::Piece
-ext/Time-Piece/t/06subclass.t	Test for Time::Piece
-ext/Time-Piece/t/07arith.t	Test for Time::Piece
-ext/Unicode-Normalize/Changes	Unicode::Normalize
-ext/Unicode-Normalize/Makefile.PL	Unicode::Normalize
-ext/Unicode-Normalize/mkheader	Unicode::Normalize
-ext/Unicode-Normalize/Normalize.pm	Unicode::Normalize
-ext/Unicode-Normalize/Normalize.xs	Unicode::Normalize
-ext/Unicode-Normalize/README	Unicode::Normalize
-ext/Unicode-Normalize/t/fcdc.t	Unicode::Normalize
-ext/Unicode-Normalize/t/form.t	Unicode::Normalize
-ext/Unicode-Normalize/t/func.t	Unicode::Normalize
-ext/Unicode-Normalize/t/illegal.t	Unicode::Normalize
-ext/Unicode-Normalize/t/norm.t	Unicode::Normalize
-ext/Unicode-Normalize/t/null.t	Unicode::Normalize
-ext/Unicode-Normalize/t/proto.t	Unicode::Normalize
-ext/Unicode-Normalize/t/split.t	Unicode::Normalize
-ext/Unicode-Normalize/t/test.t	Unicode::Normalize
-ext/Unicode-Normalize/t/tie.t	Unicode::Normalize
-ext/Win32API-File/buffers.h	Win32API::File extension
-ext/Win32API-File/cFile.h	Win32API::File extension
-ext/Win32API-File/cFile.pc	Win32API::File extension
-ext/Win32API-File/Changes	Win32API::File extension changes
-ext/Win32API-File/const2perl.h	Win32API::File extension
-ext/Win32API-File/ExtUtils/Myconst2perl.pm	Win32API::File extension
-ext/Win32API-File/File.pm	Win32API::File extension
-ext/Win32API-File/File.xs	Win32API::File extension
-ext/Win32API-File/Makefile.PL	Win32API::File extension makefile write
-ext/Win32API-File/README	Win32API::File extension Readme
-ext/Win32API-File/t/file.t	See if Win32API::File extension works
-ext/Win32API-File/t/tie.t	See if Win32API::File extension works
-ext/Win32API-File/typemap	Win32API::File extension interface types
-ext/Win32/Changes		Changes for Win32 extension module
+ext/Tie-Memoize/lib/Tie/Memoize.pm	Base class for memoized tied hashes
+ext/Tie-Memoize/t/Tie-Memoize.t		Test for Tie::Memoize
+ext/Time-Local/lib/Time/Local.pm	Reverse translation of localtime, gmtime
+ext/Time-Local/t/Local.t		See if Time::Local works
+ext/VMS-DCLsym/0README.txt	ReadMe file for VMS::DCLsym
+ext/VMS-DCLsym/DCLsym.pm	Perl access to CLI symbols
+ext/VMS-DCLsym/DCLsym.xs	Perl access to CLI symbols
+ext/VMS-DCLsym/Makefile.PL	MakeMaker driver for VMS::DCLsym
+ext/VMS-DCLsym/t/vms_dclsym.t	regression tests for VMS::DCLsym
+ext/VMS-Stdio/0README.txt	ReadMe file for VMS::Stdio
+ext/VMS-Stdio/Makefile.PL	MakeMaker driver for VMS::Stdio
+ext/VMS-Stdio/Stdio.pm		VMS options to stdio routines
+ext/VMS-Stdio/Stdio.xs		VMS options to stdio routines
+ext/VMS-Stdio/t/vms_stdio.t	regression tests for VMS::Stdio
 ext/Win32CORE/Makefile.PL	Win32CORE extension
 ext/Win32CORE/t/win32core.t	Win32CORE extension
 ext/Win32CORE/Win32CORE.c	Win32CORE extension
 ext/Win32CORE/Win32CORE.pm	Win32CORE extension (stubs for Win32 CORE subs)
-ext/Win32/longpath.inc		Win32 extension long path support
-ext/Win32/Makefile.PL		Win32 extension makefile writer
-ext/Win32/t/CreateFile.t	See if Win32 extension works
-ext/Win32/t/ExpandEnvironmentStrings.t	See if Win32 extension works
-ext/Win32/t/GetCurrentThreadId.t	See if Win32 extension works
-ext/Win32/t/GetFileVersion.t	See if Win32 extension works
-ext/Win32/t/GetFolderPath.t	See if Win32 extension works
-ext/Win32/t/GetFullPathName.t	See if Win32 extension works
-ext/Win32/t/GetLongPathName.t	See if Win32 extension works
-ext/Win32/t/GetOSName.t		See if Win32 extension works
-ext/Win32/t/GetOSVersion.t	See if Win32 extension works
-ext/Win32/t/GetShortPathName.t	See if Win32 extension works
-ext/Win32/t/GuidGen.t		See if Win32 extension works
-ext/Win32/t/Names.t		See if Win32 extension works
-ext/Win32/t/Unicode.t		See if Win32 extension works
-ext/Win32/Win32.pm		Win32 extension Perl module
-ext/Win32/Win32.xs		Win32 extension external subroutines
 ext/XS-APItest/APItest.pm	XS::APItest extension
 ext/XS-APItest/APItest.xs	XS::APItest extension
 ext/XS-APItest/core.c		Test API functions when PERL_CORE is defined
 ext/XS-APItest/core_or_not.inc	Code common to core.c and notcore.c
 ext/XS-APItest/exception.c	XS::APItest extension
+ext/XS-APItest-KeywordRPN/KeywordRPN.pm	XS::APItest::KeywordRPN extension
+ext/XS-APItest-KeywordRPN/KeywordRPN.xs	XS::APItest::KeywordRPN extension
+ext/XS-APItest-KeywordRPN/Makefile.PL	XS::APItest::KeywordRPN extension
+ext/XS-APItest-KeywordRPN/README	XS::APItest::KeywordRPN extension
+ext/XS-APItest-KeywordRPN/t/keyword_plugin.t	test keyword plugin mechanism
+ext/XS-APItest-KeywordRPN/t/multiline.t	test plugin parsing across lines
+ext/XS-APItest-KeywordRPN/t/stuff_svcur_bug.t	test for a bug in lex_stuff_pvn
 ext/XS-APItest/Makefile.PL	XS::APItest extension
 ext/XS-APItest/MANIFEST		XS::APItest extension
 ext/XS-APItest/notcore.c	Test API functions when PERL_CORE is not defined
@@ -1575,12 +3229,15 @@
 ext/XS-APItest/t/exception.t	XS::APItest extension
 ext/XS-APItest/t/hash.t		XS::APItest: tests for hash related APIs
 ext/XS-APItest/t/my_cxt.t	XS::APItest: test MY_CXT interface
+ext/XS-APItest/t/my_exit.t	XS::APItest: test my_exit
 ext/XS-APItest/t/op.t		XS::APItest: tests for OP related APIs
+ext/XS-APItest/t/pmflag.t	Test deprecation warning for Perl_pmflag()
 ext/XS-APItest/t/printf.t	XS::APItest extension
 ext/XS-APItest/t/push.t		XS::APItest extension
 ext/XS-APItest/t/rmagical.t	XS::APItest extension
 ext/XS-APItest/t/svpeek.t	XS::APItest extension
 ext/XS-APItest/t/svsetsv.t	Test behaviour of sv_setsv with/without PERL_CORE
+ext/XS-APItest/t/utf16_to_utf8.t	Test behaviour of utf16_to_utf8{,reversed}
 ext/XS-APItest/t/xs_special_subs_require.t	for require too
 ext/XS-APItest/t/xs_special_subs.t	Test that XS BEGIN/CHECK/INIT/END work
 ext/XS-Typemap/Makefile.PL	XS::Typemap extension
@@ -1648,8 +3305,8 @@
 hints/fps.sh			Hints for named architecture
 hints/freebsd.sh		Hints for named architecture
 hints/genix.sh			Hints for named architecture
-hints/gnukfreebsd.sh			Hints for named architecture
-hints/gnuknetbsd.sh			Hints for named architecture
+hints/gnukfreebsd.sh		Hints for named architecture
+hints/gnuknetbsd.sh		Hints for named architecture
 hints/gnu.sh			Hints for named architecture
 hints/greenhills.sh		Hints for named architecture
 hints/haiku.sh			Hints for named architecture
@@ -1665,10 +3322,7 @@
 hints/isc.sh			Hints for named architecture
 hints/linux.sh			Hints for named architecture
 hints/lynxos.sh			Hints for named architecture
-hints/machten_2.sh		Hints for named architecture
-hints/machten.sh		Hints for named architecture
 hints/midnightbsd.sh		Hints for named architecture
-hints/mint.sh			Hints for named architecture
 hints/mips.sh			Hints for named architecture
 hints/mirbsd.sh			Hints for named architecture
 hints/mpc.sh			Hints for named architecture
@@ -1732,166 +3386,14 @@
 lib/abbrev.pl			An abbreviation table builder
 lib/AnyDBM_File.pm		Perl module to emulate dbmopen
 lib/AnyDBM_File.t		See if AnyDBM_File works
-lib/Archive/Extract.pm	Archive::Extract
-lib/Archive/Extract/t/01_Archive-Extract.t	Archive::Extract tests
-lib/Archive/Extract/t/src/double_dir.zip.packed	Archive::Extract tests
-lib/Archive/Extract/t/src/x.bz2.packed	Archive::Extract tests
-lib/Archive/Extract/t/src/x.gz.packed	Archive::Extract tests
-lib/Archive/Extract/t/src/x.jar.packed	Archive::Extract tests
-lib/Archive/Extract/t/src/x.lzma.packed	Archive::Extract tests
-lib/Archive/Extract/t/src/x.par.packed	Archive::Extract tests
-lib/Archive/Extract/t/src/x.tar.gz.packed	Archive::Extract tests
-lib/Archive/Extract/t/src/x.tar.packed	Archive::Extract tests
-lib/Archive/Extract/t/src/x.tgz.packed	Archive::Extract tests
-lib/Archive/Extract/t/src/x.zip.packed	Archive::Extract tests
-lib/Archive/Extract/t/src/x.Z.packed	Archive::Extract tests
-lib/Archive/Extract/t/src/y.jar.packed	Archive::Extract tests
-lib/Archive/Extract/t/src/y.par.packed	Archive::Extract tests
-lib/Archive/Extract/t/src/y.tar.bz2.packed	Archive::Extract tests
-lib/Archive/Extract/t/src/y.tar.gz.packed	Archive::Extract tests
-lib/Archive/Extract/t/src/y.tar.packed	Archive::Extract tests
-lib/Archive/Extract/t/src/y.tbz.packed	Archive::Extract tests
-lib/Archive/Extract/t/src/y.tgz.packed	Archive::Extract tests
-lib/Archive/Extract/t/src/y.zip.packed	Archive::Extract tests
-lib/Archive/Tar/bin/ptar	the ptar utility
-lib/Archive/Tar/bin/ptardiff	the ptardiff utility
-lib/Archive/Tar/Constant.pm	Archive::Tar
-lib/Archive/Tar/File.pm		Archive::Tar
-lib/Archive/Tar.pm		Archive::Tar
-lib/Archive/Tar/t/01_use.t	Archive::Tar tests
-lib/Archive/Tar/t/02_methods.t	Archive::Tar tests
-lib/Archive/Tar/t/03_file.t	Archive::Tar tests
-lib/Archive/Tar/t/04_resolved_issues.t	Archive::Tar tests
-lib/Archive/Tar/t/05_iter.t	Archive::Tar tests
-lib/Archive/Tar/t/90_symlink.t	Archive::Tar tests
-lib/Archive/Tar/t/99_pod.t	Archive::Tar tests
-lib/Archive/Tar/t/src/header/signed.tar.packed	Archive::Tar tests
-lib/Archive/Tar/t/src/linktest/linktest_missing_dir.tar.packed	Archive::Tar tests
-lib/Archive/Tar/t/src/linktest/linktest_with_dir.tar.packed	Archive::Tar tests
-lib/Archive/Tar/t/src/long/b	Archive::Tar tests
-lib/Archive/Tar/t/src/long/bar.tar.packed	Archive::Tar tests
-lib/Archive/Tar/t/src/long/foo.tbz.packed	Archive::Tar tests
-lib/Archive/Tar/t/src/long/foo.tgz.packed	Archive::Tar tests
-lib/Archive/Tar/t/src/short/b	Archive::Tar tests
-lib/Archive/Tar/t/src/short/bar.tar.packed	Archive::Tar tests
-lib/Archive/Tar/t/src/short/foo.tbz.packed	Archive::Tar tests
-lib/Archive/Tar/t/src/short/foo.tgz.packed	Archive::Tar tests
 lib/assert.pl			assertion and panic with stack trace
-lib/attributes.pm		For "sub foo : attrlist"
-lib/autodie/exception.pm	Exception class for autodie
-lib/autodie/exception/system.pm	Exception class for autodying system()
-lib/autodie/hints.pm		Hinting interface for autodie
-lib/autodie.pm			Functions suceed or die with lexical scope
-lib/autodie/t/00-load.t			autodie - basic load
-lib/autodie/t/autodie.t			autodie - Basic functionality
-lib/autodie/t/autodie_test_module.pm	autodie - test helper
-lib/autodie/t/backcompat.t		autodie - More Fatal backcompat
-lib/autodie/t/basic_exceptions.t	autodie - Basic exception tests
-lib/autodie/t/binmode.t			autodie - Binmode testing
-lib/autodie/t/blog_hints.t		autodie - Tests fro PJF's blog
-lib/autodie/t/caller.t			autodie - Caller diagnostics
-lib/autodie/t/context_lexical.t		autodie - Context clobbering lexically
-lib/autodie/t/context.t			autodie - Context clobbering tests
-lib/autodie/t/crickey.t			autodie - Like an Australian
-lib/autodie/t/dbmopen.t			autodie - dbm tests
-lib/autodie/t/exception_class.t		autodie - Exception class subclasses
-lib/autodie/t/exceptions.t		autodie - 5.10 exception tests.
-lib/autodie/t/exec.t			autodie - exec tests.
-lib/autodie/t/Fatal.t			autodie - Fatal backcompatibility
-lib/autodie/t/filehandles.t		autodie - filehandle tests
-lib/autodie/t/fileno.t			autodie - fileno tests
-lib/autodie/t/flock.t			autodie - File locking tests
-lib/autodie/t/format-clobber.t		autodie - Don't clobber scalars
-lib/autodie/t/hints_insist.t		autodie - Test hints insistance
-lib/autodie/t/hints_pod_examples.t	autodie - Test hints POD examples
-lib/autodie/t/hints_provider_does.t	autodie - Test hints/does roles
-lib/autodie/t/hints_provider_easy_does_it.t	autodie - Test easy hints/does
-lib/autodie/t/hints_provider_isa.t	autodie - Test hints/inheritance
-lib/autodie/t/hints.t			autodie - Test hints interface
-lib/autodie/t/internal-backcompat.t	autodie - Back-compatibility tests
-lib/autodie/t/internal.t		autodie - internal interface tests
-lib/autodie/t/lethal.t			autodie - lethal is the one true name
-lib/autodie/t/lib/autodie/test/au/exception.pm	autodie - Australian helper
-lib/autodie/t/lib/autodie/test/au.pm		autodie - Austrlaian helper
-lib/autodie/t/lib/autodie/test/badname.pm	autodie - Bad exception class
-lib/autodie/t/lib/autodie/test/missing.pm	autodie - Missing exception class
-lib/autodie/t/lib/Caller_helper.pm	autodie - Caller helper
-lib/autodie/t/lib/Hints_pod_examples.pm	autodie - Hints/pod helper
-lib/autodie/t/lib/Hints_provider_does.pm	autodie - Hints/does helper
-lib/autodie/t/lib/Hints_provider_easy_does_it.pm	autodie - Hints/easy helper
-lib/autodie/t/lib/Hints_provider_isa.pm	autodie - Hints/inherit helper
-lib/autodie/t/lib/Hints_test.pm		autodie - Hints test helper
-lib/autodie/t/lib/lethal.pm		autodie - with a better name
-lib/autodie/t/lib/my/autodie.pm		autodie - blog_hints.t helper
-lib/autodie/t/lib/OtherTypes.pm		autodie - Format clobberer helper.
-lib/autodie/t/lib/pujHa/ghach/Dotlh.pm	autodie - With Klingon honour
-lib/autodie/t/lib/pujHa/ghach.pm	autodie - Like a Klingon
-lib/autodie/t/lib/Some/Module.pm	autodie - blog_hints.t helper
-lib/autodie/t/mkdir.t			autodie - filesystem tests
-lib/autodie/t/open.t			autodie - Testing open
-lib/autodie/t/recv.t			autodie - send/recv tests
-lib/autodie/t/repeat.t			autodie - repeat autodie leak tests
-lib/autodie/t/scope_leak.t		autodie - file scope leak tests
-lib/autodie/t/string-eval-basic.t	autodie - Basic string eval test
-lib/autodie/t/string-eval-leak.t	autodie - String eval leak test
-lib/autodie/t/sysopen.t			autodie - sysopen tests
-lib/autodie/t/truncate.t		autodie - File truncation tests
-lib/autodie/t/unlink.t			autodie - Unlink system tests.
-lib/autodie/t/user-context.t		autodie - Context changes for usersubs
-lib/autodie/t/usersub.t			autodie - user subroutine tests
-lib/autodie/t/version.t			autodie - versioning tests
-lib/autodie/t/version_tag.t
-lib/AutoLoader.pm		Autoloader base class
-lib/AutoLoader/t/01AutoLoader.t	See if AutoLoader works
-lib/AutoLoader/t/02AutoSplit.t	See if AutoSplit works
-lib/AutoSplit.pm		Split up autoload functions
-lib/autouse.pm			Load and call a function only when it's used
-lib/autouse.t			See if autouse works
-lib/base/Changes		base.pm changelog
-lib/base.pm			Establish IS-A relationship at compile time
-lib/base/t/base.t		See if base works
-lib/base/t/compile-time.t	See if base works
-lib/base/t/fields-5.6.0.t	See if fields work
-lib/base/t/fields-5.8.0.t	See if fields work
-lib/base/t/fields-base.t	See if fields work
-lib/base/t/fields.t		See if fields work
-lib/base/t/isa.t		See if base's behaviour doesn't change
-lib/base/t/lib/Dummy.pm		Test module for base.pm
-lib/base/t/lib/HasSigDie.pm	Module for testing base.pm
-lib/base/t/sigdie.t		See if base works with SIGDIE
-lib/base/t/version.t		See if base works with versions
-lib/base/t/warnings.t		See if base works with warnings
 lib/Benchmark.pm		Measure execution time
 lib/Benchmark.t			See if Benchmark works
 lib/bigfloat.pl			An arbitrary precision floating point package
 lib/bigfloatpl.t		See if bigfloat.pl works
 lib/bigint.pl			An arbitrary precision integer arithmetic package
 lib/bigintpl.t			See if bigint.pl works
-lib/bigint.pm			bigint
-lib/bignum.pm			bignum
-lib/bignum/t/big_e_pi.t		See if bignum exports e() and PI()
-lib/bignum/t/bigexp.t		See if bignum works
-lib/bignum/t/bigint.t		See if bigint works
-lib/bignum/t/bignum.t		See if bignum works
-lib/bignum/t/bigrat.t		See if bigrat works
-lib/bignum/t/bii_e_pi.t		See if bigint exports e() and PI()
-lib/bignum/t/biinfnan.t		See if bignum works
-lib/bignum/t/bir_e_pi.t		See if bigrat exports e() and PI()
-lib/bignum/t/bninfnan.t		See if bignum works
-lib/bignum/t/bn_lite.t		See if bignum with Math::BigInt::Lite works
-lib/bignum/t/brinfnan.t		See if bignum works
-lib/bignum/t/br_lite.t		See if bigrat with Math::BigInt::Lite works
-lib/bignum/t/in_effect.t	See if in_effect() works
-lib/bignum/t/infnan.inc		See if bignum with inf/NaN works
-lib/bignum/t/option_a.t		See if bignum a => X works
-lib/bignum/t/option_l.t		See if bignum l => X works
-lib/bignum/t/option_p.t		See if bignum p => X works
-lib/bignum/t/ratopt_a.t		See if bigrat a => X works
-lib/bignum/t/scope_f.t		See if no bignum works
-lib/bignum/t/scope_i.t		See if no bigint works
-lib/bignum/t/scope_r.t		See if no bigrat works
 lib/bigrat.pl			An arbitrary precision rational arithmetic package
-lib/bigrat.pm			bigrat
 lib/blib.pm			For "use blib"
 lib/blib.t			blib.pm test
 lib/bytes_heavy.pl		Support routines for byte pragma
@@ -1901,65 +3403,8 @@
 lib/Carp/Heavy.pm		Error message workhorse
 lib/Carp.pm			Error message base class
 lib/Carp.t			See if Carp works
-lib/CGI/Apache.pm		Support for Apache's Perl module
-lib/CGI/Carp.pm			Log server errors with helpful context
-lib/CGI/Changes			Changelog for CGI.pm
-lib/CGI/Cookie.pm		Interface to Netscape Cookies
-lib/CGI/eg/caution.xbm		CGI example
-lib/CGI/eg/clickable_image.cgi	CGI example
-lib/CGI/eg/cookie.cgi		CGI example
-lib/CGI/eg/crash.cgi		CGI example
-lib/CGI/eg/customize.cgi	CGI example
-lib/CGI/eg/diff_upload.cgi	CGI example
-lib/CGI/eg/dna_small_gif.uu	Small image for CGI examples
-lib/CGI/eg/file_upload.cgi	CGI example
-lib/CGI/eg/frameset.cgi		CGI example
-lib/CGI/eg/index.html		Index page for CGI examples
-lib/CGI/eg/internal_links.cgi	CGI example
-lib/CGI/eg/javascript.cgi	CGI example
-lib/CGI/eg/make_links.pl	CGI example
-lib/CGI/eg/monty.cgi		CGI example
-lib/CGI/eg/multiple_forms.cgi	CGI example
-lib/CGI/eg/nph-clock.cgi	CGI example
-lib/CGI/eg/nph-multipart.cgi	CGI example
-lib/CGI/eg/popup.cgi		CGI example
-lib/CGI/eg/RunMeFirst		Setup script for CGI examples
-lib/CGI/eg/save_state.cgi	CGI example
-lib/CGI/eg/tryit.cgi		CGI example
-lib/CGI/eg/wilogo_gif.uu	CGI example
-lib/CGI/Fast.pm			Support for FastCGI (persistent server process)
-lib/CGI.pm			Web server interface ("Common Gateway Interface")
-lib/CGI/Pretty.pm		Output nicely formatted HTML
-lib/CGI/Push.pm			Support for server push
-lib/CGI/Switch.pm		Simple interface for multiple server types
-lib/CGI/t/apache.t		See if CGI::Apache still loads
-lib/CGI/t/can.t			See if CGI.pm works
-lib/CGI/t/carp.t		See if CGI::Carp works
-lib/CGI/t/cookie.t		See if CGI::Cookie works
-lib/CGI/t/fast.t		See if CGI::Fast works (if FCGI is installed)
-lib/CGI/t/form.t		See if CGI.pm works
-lib/CGI/t/function.t		See if CGI.pm works
-lib/CGI/t/html.t		See if CGI.pm works
-lib/CGI/t/no_tabindex.t	See if CGI.pm works
-lib/CGI/t/pretty.t		See if CGI.pm works
-lib/CGI/t/push.t		See if CGI::Push works
-lib/CGI/t/request.t		See if CGI.pm works
-lib/CGI/t/start_end_asterisk.t	See if CGI.pm works
-lib/CGI/t/start_end_end.t	See if CGI.pm works
-lib/CGI/t/start_end_start.t	See if CGI.pm works
-lib/CGI/t/switch.t		See if CGI::Switch still loads
-lib/CGI/t/uploadInfo.t		See if CGI.pm works
-lib/CGI/t/upload_post_text.txt.packed	Test data for CGI.pm
-lib/CGI/t/upload.t		See if CGI.pm works
-lib/CGI/t/util-58.t		See if 5.8-dependent features work
-lib/CGI/t/util.t		See if CGI.pm works
-lib/CGI/Util.pm			Utility functions
 lib/charnames.pm		Character names
 lib/charnames.t			See if character names work
-lib/Class/ISA/ChangeLog		Changes for Class::ISA
-lib/Class/ISA.pm		Class::ISA
-lib/Class/ISA/t/00_about_verbose.t	Tests for Class::ISA
-lib/Class/ISA/t/01_old_junk.t	Tests for Class::ISA
 lib/Class/Struct.pm		Declare struct-like datatypes as Perl classes
 lib/Class/Struct.t		See if Class::Struct works
 lib/complete.pl			A command completion subroutine
@@ -1967,147 +3412,8 @@
 lib/Config/Extensions.t		See if Config::Extensions works
 lib/Config_git.pl		Pre-generated git_version.h for OpenBSD
 lib/Config.t			See if Config works
-lib/constant.pm			For "use constant"
-lib/constant.t			See if compile-time constants work
 lib/CORE.pod			document the CORE namespace
-lib/CPAN/API/HOWTO.pod		recipe book for programming with CPAN.pm
-lib/CPAN/Author.pm		helper package for CPAN.pm
-lib/CPAN/bin/cpan		easily interact with CPAN from the command line
-lib/CPAN/Bundle.pm		helper package for CPAN.pm
-lib/CPAN/CacheMgr.pm		helper package for CPAN.pm
-lib/CPAN/Complete.pm		helper package for CPAN.pm
-lib/CPAN/Debug.pm		helper package for CPAN.pm
-lib/CPAN/DeferredCode.pm	helper package for CPAN.pm
-lib/CPAN/Distribution.pm	helper package for CPAN.pm
-lib/CPAN/Distroprefs.pm		helper package for CPAN.pm
-lib/CPAN/Distrostatus.pm	helper package for CPAN.pm
-lib/CPAN/Exception/blocked_urllist.pm	helper package for CPAN.pm
-lib/CPAN/Exception/RecursiveDependency.pm	helper package for CPAN.pm
-lib/CPAN/Exception/yaml_not_installed.pm	helper package for CPAN.pm
-lib/CPAN/FirstTime.pm		Utility for creating CPAN config files
-lib/CPAN/FTP/netrc.pm		helper package for CPAN.pm
-lib/CPAN/FTP.pm			helper package for CPAN.pm
-lib/CPAN/HandleConfig.pm	helper package for CPAN.pm
-lib/CPAN/Index.pm		helper package for CPAN.pm
-lib/CPAN/InfoObj.pm		helper package for CPAN.pm
-lib/CPAN/Kwalify/distroprefs.dd		helper file for validating config files
-lib/CPAN/Kwalify/distroprefs.yml	helper file for validating config files
-lib/CPAN/Kwalify.pm		helper package for CPAN.pm
-lib/CPAN/LWP/UserAgent.pm	helper package for CPAN.pm
-lib/CPAN/Module.pm		helper package for CPAN.pm
-lib/CPAN/Nox.pm			Runs CPAN while avoiding compiled extensions
-lib/CPAN/PAUSE2003.pub		CPAN public key
-lib/CPAN/PAUSE2005.pub		CPAN public key
-lib/CPAN/PAUSE2007.pub		CPAN public key
-lib/CPAN/PAUSE2009.pub		CPAN public key
-lib/CPANPLUS/Backend.pm	CPANPLUS
-lib/CPANPLUS/Backend/RV.pm	CPANPLUS
-lib/CPANPLUS/bin/cpan2dist	the cpan2dist utility
-lib/CPANPLUS/bin/cpanp	the cpanp utility
-lib/CPANPLUS/bin/cpanp-run-perl	the cpanp-run-perl utility
-lib/CPANPLUS/Config.pm	CPANPLUS
-lib/CPANPLUS/Configure.pm	CPANPLUS
-lib/CPANPLUS/Configure/Setup.pm	CPANPLUS
-lib/CPANPLUS/Dist/Autobundle.pm	CPANPLUS
-lib/CPANPLUS/Dist/Base.pm	CPANPLUS
-lib/CPANPLUS/Dist/Build/Constants.pm	CPANPLUS::Dist::Build
-lib/CPANPLUS/Dist/Build.pm	CPANPLUS::Dist::Build
-lib/CPANPLUS/Dist/Build/t/01_CPANPLUS-Dist-Build-Constants.t	CPANPLUS::Dist::Build tests
-lib/CPANPLUS/Dist/Build/t/02_CPANPLUS-Dist-Build.t	CPANPLUS::Dist::Build tests
-lib/CPANPLUS/Dist/Build/t/dummy-CPAN/authors/01mailrc.txt.gz.packed
-lib/CPANPLUS/Dist/Build/t/dummy-CPAN/modules/02packages.details.txt.gz.packed
-lib/CPANPLUS/Dist/Build/t/dummy-CPAN/modules/03modlist.data.gz.packed
-lib/CPANPLUS/Dist/Build/t/dummy-perl/.hidden	CPANPLUS::Dist::Build tests
-lib/CPANPLUS/Dist/Build/t/inc/conf.pl	CPANPLUS::Dist::Build tests
-lib/CPANPLUS/Dist/Build/t/src/noxs/Foo-Bar-0.01.tar.gz.packed	CPANPLUS::Dist::Build tests
-lib/CPANPLUS/Dist/Build/t/src/xs/Foo-Bar-0.01.tar.gz.packed	CPANPLUS::Dist::Build tests
-lib/CPANPLUS/Dist/MM.pm	CPANPLUS
-lib/CPANPLUS/Dist.pm	CPANPLUS
-lib/CPANPLUS/Dist/Sample.pm	CPANPLUS
-lib/CPANPLUS/Error.pm	CPANPLUS
-lib/CPANPLUS/FAQ.pod	CPANPLUS
-lib/CPANPLUS/Hacking.pod	CPANPLUS
-lib/CPANPLUS/Internals/Constants.pm	CPANPLUS
-lib/CPANPLUS/Internals/Constants/Report.pm	CPANPLUS
-lib/CPANPLUS/Internals/Extract.pm	CPANPLUS
-lib/CPANPLUS/Internals/Fetch.pm	CPANPLUS
-lib/CPANPLUS/Internals.pm	CPANPLUS
-lib/CPANPLUS/Internals/Report.pm	CPANPLUS
-lib/CPANPLUS/Internals/Search.pm	CPANPLUS
-lib/CPANPLUS/Internals/Source/Memory.pm	CPANPLUS
-lib/CPANPLUS/Internals/Source.pm	CPANPLUS
-lib/CPANPLUS/Internals/Source/SQLite.pm	CPANPLUS
-lib/CPANPLUS/Internals/Source/SQLite/Tie.pm	CPANPLUS
-lib/CPANPLUS/Internals/Utils/Autoflush.pm	CPANPLUS
-lib/CPANPLUS/Internals/Utils.pm	CPANPLUS
-lib/CPANPLUS/Module/Author/Fake.pm	CPANPLUS
-lib/CPANPLUS/Module/Author.pm	CPANPLUS
-lib/CPANPLUS/Module/Checksums.pm	CPANPLUS
-lib/CPANPLUS/Module/Fake.pm	CPANPLUS
-lib/CPANPLUS/Module.pm	CPANPLUS
-lib/CPANPLUS/Module/Signature.pm	CPANPLUS
-lib/CPANPLUS.pm	CPANPLUS
-lib/CPANPLUS/Selfupdate.pm	CPANPLUS
-lib/CPANPLUS/Shell/Classic.pm	CPANPLUS
-lib/CPANPLUS/Shell/Default/Plugins/CustomSource.pm	CPANPLUS
-lib/CPANPLUS/Shell/Default/Plugins/HOWTO.pod	CPANPLUS
-lib/CPANPLUS/Shell/Default/Plugins/Remote.pm	CPANPLUS
-lib/CPANPLUS/Shell/Default/Plugins/Source.pm	CPANPLUS
-lib/CPANPLUS/Shell/Default.pm	CPANPLUS
-lib/CPANPLUS/Shell.pm	CPANPLUS
-lib/CPANPLUS/t/00_CPANPLUS-Internals-Utils.t	CPANPLUS tests
-lib/CPANPLUS/t/01_CPANPLUS-Configure.t	CPANPLUS tests
-lib/CPANPLUS/t/02_CPANPLUS-Internals.t	CPANPLUS tests
-lib/CPANPLUS/t/03_CPANPLUS-Internals-Source.t	CPANPLUS tests
-lib/CPANPLUS/t/04_CPANPLUS-Module.t	CPANPLUS tests
-lib/CPANPLUS/t/05_CPANPLUS-Internals-Fetch.t	CPANPLUS tests
-lib/CPANPLUS/t/06_CPANPLUS-Internals-Constants.t	CPANPLUS tests
-lib/CPANPLUS/t/07_CPANPLUS-Internals-Extract.t	CPANPLUS tests
-lib/CPANPLUS/t/08_CPANPLUS-Backend.t	CPANPLUS tests
-lib/CPANPLUS/t/09_CPANPLUS-Internals-Search.t	CPANPLUS tests
-lib/CPANPLUS/t/10_CPANPLUS-Error.t	CPANPLUS tests
-lib/CPANPLUS/t/15_CPANPLUS-Shell.t	CPANPLUS tests
-lib/CPANPLUS/t/19_CPANPLUS-Dist.t	CPANPLUS tests
-lib/CPANPLUS/t/20_CPANPLUS-Dist-MM.t	CPANPLUS tests
-lib/CPANPLUS/t/21_CPANPLUS-Dist-No-Build.t	CPANPLUS tests
-lib/CPANPLUS/t/25_CPANPLUS.t	CPANPLUS tests
-lib/CPANPLUS/t/30_CPANPLUS-Internals-Selfupdate.t	CPANPLUS tests
-lib/CPANPLUS/t/40_CPANPLUS-Internals-Report.t	CPANPLUS tests
-lib/CPANPLUS/t/dummy-CPAN/authors/01mailrc.txt.gz.packed	CPANPLUS tests
-lib/CPANPLUS/t/dummy-CPAN/authors/id/EUNOXS/Bundle-Foo-Bar-0.01.tar.gz.packed	CPANPLUS tests
-lib/CPANPLUS/t/dummy-CPAN/authors/id/EUNOXS/CHECKSUMS	CPANPLUS tests
-lib/CPANPLUS/t/dummy-CPAN/authors/id/EUNOXS/Foo-Bar-0.01.meta	CPANPLUS tests
-lib/CPANPLUS/t/dummy-CPAN/authors/id/EUNOXS/Foo-Bar-0.01.readme	CPANPLUS tests
-lib/CPANPLUS/t/dummy-CPAN/authors/id/EUNOXS/Foo-Bar-0.01.tar.gz.packed	CPANPLUS tests
-lib/CPANPLUS/t/dummy-CPAN/authors/id/EUNOXS/perl5.005_03.tar.gz.packed	CPANPLUS tests
-lib/CPANPLUS/t/dummy-CPAN/authors/id/EUXS/CHECKSUMS	CPANPLUS tests
-lib/CPANPLUS/t/dummy-CPAN/authors/id/EUXS/Foo-Bar-0.01.readme	CPANPLUS tests
-lib/CPANPLUS/t/dummy-CPAN/authors/id/EUXS/Foo-Bar-0.01.tar.gz.packed	CPANPLUS tests
-lib/CPANPLUS/t/dummy-CPAN/authors/id/MBNOXS/CHECKSUMS	CPANPLUS tests
-lib/CPANPLUS/t/dummy-CPAN/authors/id/MBNOXS/Foo-Bar-0.01.readme	CPANPLUS tests
-lib/CPANPLUS/t/dummy-CPAN/authors/id/MBNOXS/Foo-Bar-0.01.tar.gz.packed	CPANPLUS tests
-lib/CPANPLUS/t/dummy-CPAN/authors/id/MBXS/CHECKSUMS	CPANPLUS tests
-lib/CPANPLUS/t/dummy-CPAN/authors/id/MBXS/Foo-Bar-0.01.readme	CPANPLUS tests
-lib/CPANPLUS/t/dummy-CPAN/authors/id/MBXS/Foo-Bar-0.01.tar.gz.packed	CPANPLUS tests
-lib/CPANPLUS/t/dummy-CPAN/autobundle/Snapshot.pm	CPANPLUS tests
-lib/CPANPLUS/t/dummy-CPAN/modules/02packages.details.txt.gz.packed	CPANPLUS tests
-lib/CPANPLUS/t/dummy-CPAN/modules/03modlist.data.gz.packed	CPANPLUS tests
-lib/CPANPLUS/t/inc/conf.pl	CPANPLUS tests
-lib/CPAN.pm			Interface to Comprehensive Perl Archive Network
-lib/CPAN/Prompt.pm
-lib/CPAN/Queue.pm		queueing system for CPAN.pm
-lib/CPAN/Shell.pm
-lib/CPAN/SIGNATURE		CPAN public key
-lib/CPAN/t/01loadme.t		See if CPAN the module works
-lib/CPAN/t/02nox.t		See if CPAN::Nox works
-lib/CPAN/t/03pkgs.t		See if CPAN::Version works
-lib/CPAN/t/10version.t		See if CPAN the module works
-lib/CPAN/t/11mirroredby.t		See if CPAN::Mirrored::By works
-lib/CPAN/Tarzip.pm		helper package for CPAN.pm
-lib/CPAN/URL.pm
-lib/CPAN/Version.pm		Simple math with different flavors of version strings
 lib/ctime.pl			A ctime workalike
-lib/Cwd.pm			Various cwd routines (getcwd, fastcwd, chdir)
 lib/DBM_Filter/Changes		DBM Filter Change history
 lib/DBM_Filter/compress.pm	DBM Filter to compress keys/values
 lib/DBM_Filter/encode.pm	DBM Filter for encoding
@@ -2125,17 +3431,9 @@
 lib/dbm_filter_util.pl		Utility functions used by DBM Filter tests
 lib/DB.pm			Debugger API (draft)
 lib/DB.t			See if DB works
-lib/Devel/SelfStubber.pm	Generate stubs for SelfLoader.pm
-lib/Devel/SelfStubber.t		See if Devel::SelfStubber works
+lib/deprecate.pm		A pragma for deprecating modules from the core.
 lib/diagnostics.pm		Print verbose diagnostics
 lib/diagnostics.t		See if diagnostics.pm works
-lib/Digest/base.pm		Digest extensions
-lib/Digest/Changes		Digest changelog
-lib/Digest/file.pm		Digest extensions
-lib/Digest.pm			Digest extensions
-lib/Digest/t/base.t		See if Digest extensions work
-lib/Digest/t/digest.t		See if Digest extensions work
-lib/Digest/t/file.t		See if Digest extensions work
 lib/DirHandle.pm		like FileHandle only for directories
 lib/DirHandle.t			See if DirHandle works
 lib/dotsh.pl			Code to "dot" in a shell script
@@ -2143,11 +3441,6 @@
 lib/Dumpvalue.t			See if Dumpvalue works
 lib/dumpvar.pl			A variable dumper
 lib/dumpvar.t			A variable dumper tester
-lib/encoding/warnings.pm	warn on implicit encoding conversions
-lib/encoding/warnings/t/1-warning.t	tests for encoding::warnings
-lib/encoding/warnings/t/2-fatal.t	tests for encoding::warnings
-lib/encoding/warnings/t/3-normal.t	tests for encoding::warnings
-lib/encoding/warnings/t/4-lexical.t	tests for encoding::warnings
 lib/English.pm			Readable aliases for short variables
 lib/English.t			See if English works
 lib/Env.pm			Map environment into ordinary variables
@@ -2157,161 +3450,16 @@
 lib/Exporter/Heavy.pm		Complicated routines for Exporter
 lib/Exporter.pm			Exporter base class
 lib/Exporter.t			See if Exporter works
-lib/ExtUtils/CBuilder/Base.pm	Base class for ExtUtils::CBuilder methods
-lib/ExtUtils/CBuilder/Changes	Changes for ExtUtils::CBuilder
-lib/ExtUtils/CBuilder/Platform/aix.pm	CBuilder methods for AIX
-lib/ExtUtils/CBuilder/Platform/cygwin.pm	CBuilder methods for cygwin
-lib/ExtUtils/CBuilder/Platform/darwin.pm	CBuilder methods for darwin
-lib/ExtUtils/CBuilder/Platform/dec_osf.pm	CBuilder methods for OSF
-lib/ExtUtils/CBuilder/Platform/os2.pm	CBuilder methods for OS/2
-lib/ExtUtils/CBuilder/Platform/Unix.pm	CBuilder methods for Unix
-lib/ExtUtils/CBuilder/Platform/VMS.pm	CBuilder methods for VMS
-lib/ExtUtils/CBuilder/Platform/Windows.pm	CBuilder methods for Windows
-lib/ExtUtils/CBuilder.pm	Compile and link C code for Perl modules
-lib/ExtUtils/CBuilder/t/00-have-compiler.t	ExtUtils::CBuilder tests
-lib/ExtUtils/CBuilder/t/01-basic.t	tests for ExtUtils::CBuilder
-lib/ExtUtils/CBuilder/t/02-link.t	tests for ExtUtils::CBuilder
-lib/ExtUtils/Changes		MakeMaker change log
-lib/ExtUtils/Changes_EU-Install		ExtUtils-Install change log
-lib/ExtUtils/Command/MM.pm	Calling MM functions from the cmd line
-lib/ExtUtils/Command.pm		Utilities for Make on non-UNIX platforms
-lib/ExtUtils/Constant/Base.pm	generate XS code to import C header constants
-lib/ExtUtils/Constant.pm	generate XS code to import C header constants
-lib/ExtUtils/Constant/ProxySubs.pm	generate XS code for proxy constants
-lib/ExtUtils/Constant/Utils.pm	generate XS code to import C header constants
-lib/ExtUtils/Constant/XS.pm	generate XS code to import C header constants
 lib/ExtUtils/Embed.pm		Utilities for embedding Perl in C programs
-lib/ExtUtils/Installed.pm	Information on installed extensions
-lib/ExtUtils/Install.pm		Handles 'make install' on extensions
-lib/ExtUtils/instmodsh		Give information about installed extensions
-lib/ExtUtils/Liblist/Kid.pm	Does the real work of the above
-lib/ExtUtils/Liblist.pm		Locates libraries
-lib/ExtUtils/MakeMaker/Config.pm	MakeMaker wrapper for Config
-lib/ExtUtils/MakeMaker/FAQ.pod	MakeMaker FAQ
-lib/ExtUtils/MakeMaker.pm	Write Makefiles for extensions
-lib/ExtUtils/MakeMaker/Tutorial.pod	Writing a module with MakeMaker
-lib/ExtUtils/Manifest.pm	Utilities to write MANIFEST files
-lib/ExtUtils/MANIFEST.SKIP	The default MANIFEST.SKIP
-lib/ExtUtils/Mkbootstrap.pm	Writes a bootstrap file (see MakeMaker)
-lib/ExtUtils/Mksymlists.pm	Writes a linker options file for extensions
-lib/ExtUtils/MM_AIX.pm		MakeMaker methods for AIX
-lib/ExtUtils/MM_Any.pm		MakeMaker methods for Any OS
-lib/ExtUtils/MM_BeOS.pm		MakeMaker methods for BeOS
-lib/ExtUtils/MM_Cygwin.pm	MakeMaker methods for Cygwin
-lib/ExtUtils/MM_Darwin.pm	MakeMaker methods for Darwin
-lib/ExtUtils/MM_DOS.pm		MakeMaker methods for DOS
-lib/ExtUtils/MM_MacOS.pm	MakeMaker methods for MacOS
-lib/ExtUtils/MM_NW5.pm		MakeMaker methods for NetWare
-lib/ExtUtils/MM_OS2.pm		MakeMaker methods for OS/2
-lib/ExtUtils/MM.pm		MakeMaker adaptor class
-lib/ExtUtils/MM_QNX.pm		MakeMaker methods for QNX
-lib/ExtUtils/MM_Unix.pm		MakeMaker methods for Unix
-lib/ExtUtils/MM_UWIN.pm		MakeMaker methods for U/WIN
-lib/ExtUtils/MM_VMS.pm		MakeMaker methods for VMS
-lib/ExtUtils/MM_VOS.pm		MakeMaker methods for VOS
-lib/ExtUtils/MM_Win32.pm	MakeMaker methods for Win32
-lib/ExtUtils/MM_Win95.pm	MakeMaker methods for Win95
-lib/ExtUtils/MY.pm		MakeMaker user override class
-lib/ExtUtils/NOTES		Notes about MakeMaker internals
-lib/ExtUtils/Packlist.pm	Manipulates .packlist files
-lib/ExtUtils/ParseXS/Changes	ExtUtils::ParseXS change log
-lib/ExtUtils/ParseXS.pm		converts Perl XS code into C code
-lib/ExtUtils/ParseXS/t/basic.t	See if ExtUtils::ParseXS works
-lib/ExtUtils/ParseXS/t/usage.t	ExtUtils::ParseXS tests
-lib/ExtUtils/ParseXS/t/XSTest.pm	Test file for ExtUtils::ParseXS tests
-lib/ExtUtils/ParseXS/t/XSTest.xs	Test file for ExtUtils::ParseXS tests
-lib/ExtUtils/ParseXS/t/XSUsage.pm	ExtUtils::ParseXS tests
-lib/ExtUtils/ParseXS/t/XSUsage.xs	ExtUtils::ParseXS tests
-lib/ExtUtils/PATCHING		Suggestions for patching MakeMaker
-lib/ExtUtils/README		MakeMaker README
-lib/ExtUtils/t/00compile.t	See if MakeMaker modules compile
-lib/ExtUtils/t/arch_check.t	Test MakeMaker's arch_check()
-lib/ExtUtils/t/backwards.t	Check MakeMaker's backwards compatibility
-lib/ExtUtils/t/basic.t		See if MakeMaker can build a module
-lib/ExtUtils/t/build_man.t	Set if MakeMaker builds manpages
-lib/ExtUtils/t/can_write_dir.t	Does the _can_write_dir function of ExtUtils::Install work properly?
-lib/ExtUtils/t/cd.t		Test to see cd works
-lib/ExtUtils/t/config.t		Test ExtUtils::MakeMaker::Config
-lib/ExtUtils/t/Constant.t	See if ExtUtils::Constant works
-lib/ExtUtils/t/cp.t		See if ExtUtils::Command works
-lib/ExtUtils/t/dir_target.t	Verify if dir_target() is supported
 lib/ExtUtils/t/Embed.t		See if ExtUtils::Embed and embedding works
-lib/ExtUtils/testlib.pm		Fixes up @INC to use just-built extension
-lib/ExtUtils/t/eu_command.t	See if ExtUtils::Command works
-lib/ExtUtils/t/FIRST_MAKEFILE.t		See if FIRST_MAKEFILE works
-lib/ExtUtils/t/fixin.t		See if ExtUtils::MakeMaker works
-lib/ExtUtils/t/fix_libs.t	Test for ExtUtils::MakeMaker
-lib/ExtUtils/t/hints.t		See if hint files are honored.
-lib/ExtUtils/t/Installapi2.t	See if new api for ExtUtils::Install::install() works
-lib/ExtUtils/t/INSTALL_BASE.t	Test INSTALL_BASE in MakeMaker
-lib/ExtUtils/t/installed_file.t	Test for ExtUtils::MakeMaker
-lib/ExtUtils/t/Installed.t	See if ExtUtils::Installed works
-lib/ExtUtils/t/Install.t	See if ExtUtils::Install works
-lib/ExtUtils/t/InstallWithMM.t	See if ExtUtils::Install works (related to EUMM/t/basic.t)
-lib/ExtUtils/t/INST_PREFIX.t	See if MakeMaker can apply PREFIXs
-lib/ExtUtils/t/INST.t		Check MakeMaker INST_* macros
-lib/ExtUtils/t/is_of_type.t	Test for ExtUtils::MakeMaker
-lib/ExtUtils/t/Liblist.t	See if ExtUtils::Liblist works
-lib/ExtUtils/t/MakeMaker_Parameters.t	test "MakeMaker Parameters" section
-lib/ExtUtils/t/make.t		See if make detection works
-lib/ExtUtils/t/maketext_filter.t	See if maketext_filter works
-lib/ExtUtils/t/Manifest.t	See if ExtUtils::Manifest works
-lib/ExtUtils/t/metafile_data.t	See if META.yml handling works
-lib/ExtUtils/t/metafile_file.t	See if META.yml handling works
-lib/ExtUtils/t/miniperl.t	Test MakeMaker with miniperl
-lib/ExtUtils/t/min_perl_version.t	Test the MIN_PERL_VERSION argument to WriteMakefile.
-lib/ExtUtils/t/Mkbootstrap.t	See if ExtUtils::Mkbootstrap works
-lib/ExtUtils/t/MM_Any.t		See if ExtUtils::MM_Any works
-lib/ExtUtils/t/MM_BeOS.t	See if ExtUtils::MM_BeOS works
-lib/ExtUtils/t/MM_Cygwin.t	See if ExtUtils::MM_Cygwin works
-lib/ExtUtils/t/MM_NW5.t		See if ExtUtils::MM_NW5 works
-lib/ExtUtils/t/MM_OS2.t		See if ExtUtils::MM_OS2 works
-lib/ExtUtils/t/MM_Unix.t	See if ExtUtils::MM_UNIX works
-lib/ExtUtils/t/MM_VMS.t		See if ExtUtils::MM_VMS works
-lib/ExtUtils/t/MM_Win32.t	See if ExtUtils::MM_Win32 works
-lib/ExtUtils/TODO		Things TODO in MakeMaker
-lib/ExtUtils/t/oneliner.t	See if MM can generate perl one-liners
-lib/ExtUtils/t/Packlist.t	See if Packlist works
-lib/ExtUtils/t/parse_version.t	See if parse_version works
-lib/ExtUtils/t/PL_FILES.t	Test PL_FILES in MakeMaker
-lib/ExtUtils/t/pm.t		See if MakeMaker can handle PM
-lib/ExtUtils/t/pm_to_blib.t	Test for ExtUtils::MakeMaker
-lib/ExtUtils/t/pod2man.t	See if MakeMaker can handle no pod2man
-lib/ExtUtils/t/postamble.t	See if postamble works
-lib/ExtUtils/t/prefixify.t	See if MakeMaker can apply a PREFIX
-lib/ExtUtils/t/prereq_print.t	See if PREREQ_PRINT works
-lib/ExtUtils/t/prereq.t		See if MakeMaker works
-lib/ExtUtils/t/problems.t	How MakeMaker reacts to build problems
-lib/ExtUtils/t/prompt.t		See if E::MM::prompt() works
-lib/ExtUtils/t/recurs.t		See if recursive builds work
-lib/ExtUtils/t/revision.t	See if $Revision is correct
-lib/ExtUtils/t/split_command.t	See if MM's xargs-like function works
-lib/ExtUtils/t/test_boilerplate.t	MakeMaker test
-lib/ExtUtils/t/testdata/reallylongdirectoryname/arch1/Config.pm		test data for MakeMaker
-lib/ExtUtils/t/testdata/reallylongdirectoryname/arch2/Config.pm		test data for MakeMaker
-lib/ExtUtils/t/testlib.t	See if ExtUtils::testlib works
-lib/ExtUtils/t/VERSION_FROM.t	See if MakeMaker's VERSION_FROM works
-lib/ExtUtils/t/WriteEmptyMakefile.t	See if WriteEmptyMakefile works
-lib/ExtUtils/t/writemakefile_args.t	See if WriteMakefile works
-lib/ExtUtils/t/xs.t		Part of MakeMaker's test suite
 lib/ExtUtils/typemap		Extension interface types
 lib/ExtUtils/XSSymSet.pm	on VMS, manage linker symbols when building extensions
-lib/ExtUtils/xsubpp		External subroutine preprocessor
 lib/fastcwd.pl			a faster but more dangerous getcwd
-lib/Fatal.pm			Make errors in functions/builtins fatal
 lib/feature.pm			Pragma to enable new syntax
 lib/feature.t			See if features work
-lib/fields.pm			Set up object field names for pseudo-hash-using classes
+lib/feature/unicode_strings.t	See if feature "unicode_strings" work
 lib/File/Basename.pm		Emulate the basename program
 lib/File/Basename.t		See if File::Basename works
-lib/FileCache.pm		Keep more files open than the system permits
-lib/FileCache/t/01open.t	See if FileCache works
-lib/FileCache/t/02maxopen.t	See if FileCache works
-lib/FileCache/t/03append.t	See if FileCache works
-lib/FileCache/t/04twoarg.t	See if FileCache works
-lib/FileCache/t/05override.t	See if FileCache works
-lib/FileCache/t/06export.t	See if FileCache exporting works
-lib/FileCache/t/07noimport.t	See if FileCache works without importing
 lib/File/CheckTree.pm		Perl module supporting wholesale file mode validation
 lib/File/CheckTree.t		See if File::CheckTree works
 lib/File/Compare.pm		Emulation of cmp command
@@ -2320,65 +3468,21 @@
 lib/File/Copy.t			See if File::Copy works
 lib/File/DosGlob.pm		Win32 DOS-globbing module
 lib/File/DosGlob.t		See if File::DosGlob works
-lib/File/Fetch.pm	File::Fetch
-lib/File/Fetch/t/01_File-Fetch.t	File::Fetch tests
 lib/File/Find.pm		Routines to do a find
 lib/File/Find/t/find.t		See if File::Find works
 lib/File/Find/t/taint.t		See if File::Find works with taint
 lib/FileHandle.pm		Backward-compatible front end to IO extension
 lib/FileHandle.t		See if FileHandle works
-lib/File/Path.pm		Do things like `mkdir -p' and `rm -r'
-lib/File/Path.t			See if File::Path works
-lib/File/Spec/Cygwin.pm		portable operations on Cygwin file names
-lib/File/Spec/Epoc.pm		portable operations on EPOC file names
-lib/File/Spec/Functions.pm	Function interface to File::Spec object methods
-lib/File/Spec/Mac.pm		portable operations on Mac file names
-lib/File/Spec/OS2.pm		portable operations on OS2 file names
-lib/File/Spec.pm		portable operations on file names
-lib/File/Spec/t/crossplatform.t	See if File::Spec works crossplatform
-lib/File/Spec/t/Functions.t	See if File::Spec::Functions works
-lib/File/Spec/t/rel2abs2rel.t	See if File::Spec->rel2abs/abs2rel works
-lib/File/Spec/t/Spec.t		See if File::Spec works
-lib/File/Spec/t/tmpdir.t	See if File::Spec->tmpdir() works
-lib/File/Spec/Unix.pm		portable operations on Unix file names
-lib/File/Spec/VMS.pm		portable operations on VMS file names
-lib/File/Spec/Win32.pm		portable operations on Win32 and NetWare file names
 lib/File/stat.pm		By-name interface to Perl's builtin stat
 lib/File/stat.t			See if File::stat works
-lib/File/Temp.pm		create safe temporary files and file handles
-lib/File/Temp/t/cmp.t		See if File::Temp works
-lib/File/Temp/t/fork.t		See if File::Temp works
-lib/File/Temp/t/lock.t		See if File::Temp works
-lib/File/Temp/t/mktemp.t	See if File::Temp works
-lib/File/Temp/t/object.t	See if File::Temp works
-lib/File/Temp/t/posix.t		See if File::Temp works
-lib/File/Temp/t/security.t	See if File::Temp works
-lib/File/Temp/t/seekable.t	See if File::Temp works
-lib/File/Temp/t/tempfile.t	See if File::Temp works
 lib/filetest.pm			For "use filetest"
 lib/filetest.t			See if filetest works
-lib/Filter/Simple/Changes	Filter::Simple
-lib/Filter/Simple.pm		Simple frontend to Filter::Util::Call
-lib/Filter/Simple/t/data.t	See if Filter::Simple works
-lib/Filter/Simple/t/export.t	See if Filter::Simple works
-lib/Filter/Simple/t/filter_only.t	See if Filter::Simple works
-lib/Filter/Simple/t/filter.t	See if Filter::Simple works
-lib/Filter/Simple/t/import.t	See if Filter::Simple works
 lib/FindBin.pm			Find name of currently executing program
 lib/FindBin.t			See if FindBin works
 lib/finddepth.pl		A depth-first find emulator--used by find2perl
 lib/find.pl			A find emulator--used by find2perl
 lib/flush.pl			Routines to do single flush
 lib/getcwd.pl			A getcwd() emulator
-lib/Getopt/Long/CHANGES		Getopt::Long changes
-lib/Getopt/Long.pm		Fetch command options (GetOptions)
-lib/Getopt/Long/README		Getopt::Long README
-lib/Getopt/Long/t/gol-basic.t	See if Getopt::Long works
-lib/Getopt/Long/t/gol-compat.t	See if Getopt::Long works
-lib/Getopt/Long/t/gol-linkage.t	See if Getopt::Long works
-lib/Getopt/Long/t/gol-oo.t	See if Getopt::Long works
-lib/Getopt/Long/t/gol-xargv.t	See if Getopt::Long works
-lib/Getopt/Long/t/gol-xstring.t	See if Getopt::Long works
 lib/getopt.pl			Perl library supporting option parsing
 lib/getopts.pl			Perl library supporting option parsing
 lib/Getopt/Std.pm		Fetch command options (getopt, getopts)
@@ -2388,375 +3492,24 @@
 lib/hostname.pl			Old hostname code
 lib/I18N/Collate.pm		Routines to do strxfrm-based collation
 lib/I18N/Collate.t		See if I18N::Collate works
-lib/I18N/LangTags/ChangeLog	I18N::LangTags
-lib/I18N/LangTags/Detect.pm	Detect language preferences
-lib/I18N/LangTags/List.pm	List of tags for human languages
-lib/I18N/LangTags.pm		I18N::LangTags
-lib/I18N/LangTags/README	I18N::LangTags
-lib/I18N/LangTags/t/01_about_verbose.t	See whether I18N::LangTags works
-lib/I18N/LangTags/t/05_main.t	See whether I18N::LangTags works
-lib/I18N/LangTags/t/07_listy.t	See whether I18N::LangTags works
-lib/I18N/LangTags/t/10_http.t	See whether I18N::LangTags works
-lib/I18N/LangTags/t/20_locales.t	See whether I18N::LangTags works
-lib/I18N/LangTags/t/50_super.t	See whether I18N::LangTags works
-lib/I18N/LangTags/t/55_supers_strict.t	See whether I18N::LangTags works
-lib/I18N/LangTags/t/80_all_env.t	See whether I18N::LangTags works
-lib/if.pm			For "use if"
-lib/if.t			Tests for "use if"
 lib/importenv.pl		Perl routine to get environment into variables
 lib/integer.pm			For "use integer"
 lib/integer.t			For "use integer" testing
 lib/Internals.t			For Internals::* testing
-lib/IO/Zlib.pm			IO::Zlib
-lib/IO/Zlib/t/basic.t		Tests for IO::Zlib
-lib/IO/Zlib/t/external.t	Tests for IO::Zlib
-lib/IO/Zlib/t/getc.t		Tests for IO::Zlib
-lib/IO/Zlib/t/getline.t		Tests for IO::Zlib
-lib/IO/Zlib/t/import.t		Tests for IO::Zlib
-lib/IO/Zlib/t/large.t		Tests for IO::Zlib
-lib/IO/Zlib/t/tied.t		Tests for IO::Zlib
-lib/IO/Zlib/t/uncomp1.t		Tests for IO::Zlib
-lib/IO/Zlib/t/uncomp2.t		Tests for IO::Zlib
-lib/IPC/Cmd.pm			IPC::Cmd
-lib/IPC/Cmd/t/01_IPC-Cmd.t	IPC::Cmd tests
-lib/IPC/Cmd/t/02_Interactive.t	IPC::Cmd tests
-lib/IPC/Cmd/t/src/child.pl	IPC::Cmd tests
-lib/IPC/Cmd/t/src/output.pl	IPC::Cmd tests
-lib/IPC/Cmd/t/src/x.tgz.packed	IPC::Cmd tests
-lib/IPC/Open2.pm		Open a two-ended pipe
-lib/IPC/Open2.t			See if IPC::Open2 works
-lib/IPC/Open3.pm		Open a three-ended pipe!
-lib/IPC/Open3.t			See if IPC::Open3 works
 lib/less.pm			For "use less"
 lib/less.t			See if less support works
-lib/lib_pm.PL			For "use lib", produces lib/lib.pm
-lib/lib.t			For "use lib" testing
-lib/Locale/Codes/ChangeLog	Locale::Codes
-lib/Locale/Codes/README		Locale::Codes
-lib/Locale/Codes/t/all.t	See if Locale::Codes work
-lib/Locale/Codes/t/constants.t	See if Locale::Codes work
-lib/Locale/Codes/t/country.t	See if Locale::Codes work
-lib/Locale/Codes/t/currency.t	See if Locale::Codes work
-lib/Locale/Codes/t/languages.t	See if Locale::Codes work
-lib/Locale/Codes/t/rename.t	See if Locale::Codes work
-lib/Locale/Codes/t/script.t	See if Locale::Codes work
-lib/Locale/Codes/t/uk.t		See if Locale::Codes work
-lib/Locale/Constants.pm		Locale::Codes
-lib/Locale/Constants.pod	Locale::Codes documentation
-lib/Locale/Country.pm		Locale::Codes
-lib/Locale/Country.pod		Locale::Codes documentation
-lib/Locale/Currency.pm		Locale::Codes
-lib/Locale/Currency.pod		Locale::Codes documentation
-lib/Locale/Language.pm		Locale::Codes
-lib/Locale/Language.pod		Locale::Codes documentation
-lib/Locale/Maketext/ChangeLog	Locale::Maketext
-lib/Locale/Maketext/GutsLoader.pm	Locale::Maketext
-lib/Locale/Maketext/Guts.pm	Locale::Maketext
-lib/Locale/Maketext.pm		Locale::Maketext
-lib/Locale/Maketext.pod		Locale::Maketext documentation
-lib/Locale/Maketext/README	Locale::Maketext
-lib/Locale/Maketext/Simple.pm	Locale::Simple
-lib/Locale/Maketext/Simple/t/0-signature.t	Locale::Simple tests
-lib/Locale/Maketext/Simple/t/1-basic.t	Locale::Simple tests
-lib/Locale/Maketext/t/01_about_verbose.t	See if Locale::Maketext works
-lib/Locale/Maketext/t/10_make.t	See if Locale::Maketext works
-lib/Locale/Maketext/t/20_get.t	See if Locale::Maketext works
-lib/Locale/Maketext/t/30_local.t	See if Locale::Maketext works
-lib/Locale/Maketext/t/40_super.t	See if Locale::Maketext works
-lib/Locale/Maketext/t/50_super.t	See if Locale::Maketext works
-lib/Locale/Maketext/t/60_super.t	See if Locale::Maketext works
-lib/Locale/Maketext/t/90_utf8.t	See if Locale::Maketext works
-lib/Locale/Maketext/TPJ13.pod	Locale::Maketext documentation article
 lib/locale.pm			For "use locale"
-lib/Locale/Script.pm		Locale::Codes
-lib/Locale/Script.pod		Locale::Codes documentation
 lib/locale.t			See if locale support works
-lib/Log/Message/Config.pm	Log::Message
-lib/Log/Message/Handlers.pm	Log::Message
-lib/Log/Message/Item.pm	Log::Message
-lib/Log/Message.pm	Log::Message
-lib/Log/Message/Simple.pm	Log::Simple
-lib/Log/Message/Simple/t/01_use.t	Log::Simple tests
-lib/Log/Message/Simple/t/02_imports.t	Log::Simple tests
-lib/Log/Message/Simple/t/03_functions.t	Log::Simple tests
-lib/Log/Message/t/01_Log-Message-Config.t	Log::Message tests
-lib/Log/Message/t/02_Log-Message.t	Log::Message tests
-lib/Log/Message/t/conf/config_file	Log::Message tests
-lib/Log/Message/t/conf/LoadMe.pl	Log::Message tests
 lib/look.pl			A "look" equivalent
-lib/Math/BigFloat.pm		An arbitrary precision floating-point arithmetic package
-lib/Math/BigFloat/Trace.pm	bignum tracing
-lib/Math/BigInt/CalcEmu.pm	Pure Perl module to support Math::BigInt
-lib/Math/BigInt/Calc.pm		Pure Perl module to support Math::BigInt
-lib/Math/BigInt.pm		An arbitrary precision integer arithmetic package
-lib/Math/BigInt/t/alias.inc	Support for BigInt tests
-lib/Math/BigInt/t/bare_mbf.t	Test MBF under Math::BigInt::BareCalc
-lib/Math/BigInt/t/bare_mbi.t	Test MBI under Math::BigInt::BareCalc
-lib/Math/BigInt/t/bare_mif.t	Rounding tests under BareCalc
-lib/Math/BigInt/t/bigfltpm.inc	Shared tests for bigfltpm.t and sub_mbf.t
-lib/Math/BigInt/t/bigfltpm.t	See if BigFloat.pm works
-lib/Math/BigInt/t/bigintc.t	See if BigInt/Calc.pm works
-lib/Math/BigInt/t/bigintpm.inc	Shared tests for bigintpm.t and sub_mbi.t
-lib/Math/BigInt/t/bigintpm.t	See if BigInt.pm works
-lib/Math/BigInt/t/bigints.t	See if BigInt.pm works
-lib/Math/BigInt/t/biglog.t	Test the log function
-lib/Math/BigInt/t/big_pi_e.t	test bpi() and bexp()
-lib/Math/BigInt/t/bigroot.t	Test the broot function
-lib/Math/BigInt/t/calling.t	Test calling conventions
-lib/Math/BigInt/t/config.t	Test Math::BigInt->config()
-lib/Math/BigInt/t/constant.t	Test Math::BigInt/BigFloat under :constant
-lib/Math/BigInt/t/const_mbf.t	Test Math::BigInt
-lib/Math/BigInt/t/downgrade.t	Test if use Math::BigInt(); under downgrade works
-lib/Math/BigInt/t/_e_math.t	Helper routine in BigFloat for _e math
-lib/Math/BigInt/t/inf_nan.t	Special tests for inf and *NaN* handling
-lib/Math/BigInt/t/isa.t		Test for Math::BigInt inheritance
-lib/Math/BigInt/t/lib_load.t	Test sane lib names
-lib/Math/BigInt/t/mbf_ali.t	Tests for BigFloat
-lib/Math/BigInt/t/mbi_ali.t	Tests for BigInt
-lib/Math/BigInt/t/mbimbf.inc	Actual BigInt/BigFloat accuracy, precision and fallback, round_mode tests
-lib/Math/BigInt/t/mbimbf.t	BigInt/BigFloat accuracy, precision and fallback, round_mode
-lib/Math/BigInt/t/mbi_rand.t	Test Math::BigInt randomly
-lib/Math/BigInt/t/nan_cmp.t	overloaded comparision involving *NaN*
-lib/Math/BigInt/t/new_ovld.t	test overloaded numbers in BigFloat's new()
-lib/Math/BigInt/Trace.pm	bignum tracing
-lib/Math/BigInt/t/req_mbf0.t	test: require Math::BigFloat; ->bzero();
-lib/Math/BigInt/t/req_mbf1.t	test: require Math::BigFloat; ->bone();
-lib/Math/BigInt/t/req_mbfa.t	test: require Math::BigFloat; ->bnan();
-lib/Math/BigInt/t/req_mbfi.t	test: require Math::BigFloat; ->binf();
-lib/Math/BigInt/t/req_mbfn.t	test: require Math::BigFloat; ->new();
-lib/Math/BigInt/t/req_mbfw.t	require Math::BigFloat; import ( with => );
-lib/Math/BigInt/t/require.t	Test if require Math::BigInt works
-lib/Math/BigInt/t/round.t	Test rounding with non-integer A and P
-lib/Math/BigInt/t/sub_ali.t	Tests for aliases in BigInt subclasses
-lib/Math/BigInt/t/sub_mbf.t	Empty subclass test of BigFloat
-lib/Math/BigInt/t/sub_mbi.t	Empty subclass test of BigInt
-lib/Math/BigInt/t/sub_mif.t	Test A & P with subclasses using mbimbf.inc
-lib/Math/BigInt/t/trap.t	Test whether trap_nan and trap_inf work
-lib/Math/BigInt/t/upgradef.t	Test if use Math::BigFloat(); under upgrade works
-lib/Math/BigInt/t/upgrade.inc	Actual tests for upgrade.t
-lib/Math/BigInt/t/upgrade.t	Test if use Math::BigInt(); under upgrade works
-lib/Math/BigInt/t/use_lib1.t	Test combinations of Math::BigInt and BigFloat
-lib/Math/BigInt/t/use_lib2.t	Test combinations of Math::BigInt and BigFloat
-lib/Math/BigInt/t/use_lib3.t	Test combinations of Math::BigInt and BigFloat
-lib/Math/BigInt/t/use_lib4.t	Test combinations of Math::BigInt and BigFloat
-lib/Math/BigInt/t/use_mbfw.t	use BigFloat w/ with and lib at the same time
-lib/Math/BigInt/t/use.t		Test if use Math::BigInt(); works
-lib/Math/BigInt/t/with_sub.t	Test use Math::BigFloat with => package
-lib/Math/BigRat.pm		Math::BigRat
-lib/Math/BigRat/t/big_ap.t		Math::BigRat test
-lib/Math/BigRat/t/bigfltpm.inc		Math::BigRat test
-lib/Math/BigRat/t/bigfltrt.t		Math::BigRat test
-lib/Math/BigRat/t/biglog.t		Math::BigRat test
-lib/Math/BigRat/t/bigratpm.inc		Math::BigRat test
-lib/Math/BigRat/t/bigratpm.t		Math::BigRat test
-lib/Math/BigRat/t/bigrat.t		Math::BigRat test
-lib/Math/BigRat/t/bigratup.t	test under $Math::BigInt::upgrade
-lib/Math/BigRat/t/bigroot.t		Math::BigRat test
-lib/Math/BigRat/t/hang.t		Math::BigRat test for bug #34584 - hang in exp()
-lib/Math/BigRat/t/requirer.t	see if require works properly
-lib/Math/BigRat/t/trap.t	see if trap_nan and trap_inf work
-lib/Math/Complex.pm		A Complex package
-lib/Math/Complex.t		See if Math::Complex works
-lib/Math/Trig.pm		A simple interface to complex trigonometry
-lib/Math/Trig.t			See if Math::Trig works
-lib/Math/underbar.t		See if Math::Complex works
-lib/Memoize/AnyDBM_File.pm	Memoize glue layer for AnyDBM_File
-lib/Memoize/ExpireFile.pm	Memoize expiry manager test scaffold
-lib/Memoize/Expire.pm		Memoize expiry manager example
-lib/Memoize/ExpireTest.pm	Memoize expiry manager test scaffold
-lib/Memoize/NDBM_File.pm	Memoize glue layer for NDBM_File
-lib/Memoize.pm			Memoize
-lib/Memoize/README		Memoize release notes
-lib/Memoize/SDBM_File.pm	Memoize glue layer for SDBM_File
-lib/Memoize/Storable.pm		Memoize glue layer for Storable
-lib/Memoize/t/array_confusion.t		Memoize ambiguous array return tests
-lib/Memoize/t/array.t		Memoize array context return tests
-lib/Memoize/t/correctness.t	Memoize basic correctness tests
-lib/Memoize/t/errors.t		Memoize PEBKAC detection tests
-lib/Memoize/t/expfile.t		Memoize expiry manager tests
-lib/Memoize/t/expire.t		Memoize expiry manager tests
-lib/Memoize/t/expmod_n.t	Memoize expiry manager tests
-lib/Memoize/t/expmod_t.t	Memoize expiry manager (timed) tests
-lib/Memoize/t/flush.t		Memoize 'flush_cache' function tests
-lib/Memoize/t/normalize.t	Memoize 'normalizer' feature tests
-lib/Memoize/TODO		Memoize to-do list
-lib/Memoize/t/prototype.t	Memoize prototyped function handling tests
-lib/Memoize/t/speed.t		"Makes functions faster" advertisement test
-lib/Memoize/t/tiefeatures.t	Memoize FAULT / MERGE / HASH options test
-lib/Memoize/t/tie_gdbm.t	Memoize GDBM interface test
-lib/Memoize/t/tie_ndbm.t	Memoize NDBM interface test
-lib/Memoize/t/tie_sdbm.t	Memoize SDBM interface test
-lib/Memoize/t/tie_storable.t	Memoize Storable interface test
-lib/Memoize/t/tie.t		Memoize tied file test
-lib/Memoize/t/unmemoize.t	Memoize 'unmemoize' function test
-lib/Module/Build/API.pod	Module::Build
-lib/Module/Build/Authoring.pod	Module::Build
-lib/Module/Build/Base.pm	Module::Build
-lib/Module/Build/Changes	Module::Build
-lib/Module/Build/Compat.pm	Module::Build
-lib/Module/Build/ConfigData.pm	Module::Build
-lib/Module/Build/Config.pm	Module::Build
-lib/Module/Build/Cookbook.pm	Module::Build
-lib/Module/Build/Dumper.pm	Module::Build
-lib/Module/Build/ModuleInfo.pm	Module::Build
-lib/Module/Build/Notes.pm	Module::Build
-lib/Module/Build/Platform/aix.pm	Module::Build
-lib/Module/Build/Platform/Amiga.pm	Module::Build
-lib/Module/Build/Platform/cygwin.pm	Module::Build
-lib/Module/Build/Platform/darwin.pm	Module::Build
-lib/Module/Build/Platform/Default.pm	Module::Build
-lib/Module/Build/Platform/EBCDIC.pm	Module::Build
-lib/Module/Build/Platform/MacOS.pm	Module::Build
-lib/Module/Build/Platform/MPEiX.pm	Module::Build
-lib/Module/Build/Platform/os2.pm	Module::Build
-lib/Module/Build/Platform/RiscOS.pm	Module::Build
-lib/Module/Build/Platform/Unix.pm	Module::Build
-lib/Module/Build/Platform/VMS.pm	Module::Build
-lib/Module/Build/Platform/VOS.pm	Module::Build
-lib/Module/Build/Platform/Windows.pm	Module::Build
-lib/Module/Build.pm		Module::Build
-lib/Module/Build/PodParser.pm	Module::Build
-lib/Module/Build/PPMMaker.pm	Module::Build
-lib/Module/Build/scripts/config_data	Module::Build
-lib/Module/Build/t/add_property.t	Module::Build
-lib/Module/Build/t/basic.t	Module::Build
-lib/Module/Build/t/bundled/Tie/CPHash.pm	Module::Build.pm
-lib/Module/Build/t/compat/exit.t	Module::Build
-lib/Module/Build/t/compat.t	Module::Build
-lib/Module/Build/t/debug.t	Module::Build tests
-lib/Module/Build/t/destinations.t	Module::Build
-lib/Module/Build/t/extend.t	Module::Build
-lib/Module/Build/t/ext.t	Module::Build
-lib/Module/Build/t/files.t	Module::Build
-lib/Module/Build/t/help.t	Module::Build
-lib/Module/Build/t/install.t	Module::Build
-lib/Module/Build/t/lib/DistGen.pm	Module::Build
-lib/Module/Build/t/lib/MBTest.pm	Module::Build
-lib/Module/Build/t/manifypods.t	Module::Build
-lib/Module/Build/t/mbyaml.t	Module::Build
-lib/Module/Build/t/metadata2.t	Module::Build
-lib/Module/Build/t/metadata.t	Module::Build
-lib/Module/Build/t/moduleinfo.t	Module::Build
-lib/Module/Build/t/new_from_context.t	Module::Build
-lib/Module/Build/t/notes.t	Module::Build
-lib/Module/Build/t/parents.t	Module::Build
-lib/Module/Build/t/PL_files.t	Module::Build tests
-lib/Module/Build/t/pod_parser.t	Module::Build
-lib/Module/Build/t/ppm.t	Module::Build
-lib/Module/Build/t/runthrough.t	Module::Build
-lib/Module/Build/t/script_dist.t	Module::Build
-lib/Module/Build/t/test_file_exts.t	Module::Build
-lib/Module/Build/t/test_types.t	Module::Build
-lib/Module/Build/t/test_type.t	Module::Build
-lib/Module/Build/t/tilde.t	Module::Build
-lib/Module/Build/t/use_tap_harness.t	Module::Build
-lib/Module/Build/t/versions.t	Module::Build
-lib/Module/Build/t/write_default_maniskip.t	Module::Build tests
-lib/Module/Build/t/xs.t		Module::Build
-lib/Module/Build/Version.pm	Module::Build
-lib/Module/Build/YAML.pm	Module::Build
-lib/Module/CoreList/bin/corelist	Module::CoreList
-lib/Module/CoreList.pm			Module::CoreList
-lib/Module/CoreList/t/corelist.t	Module::CoreList
-lib/Module/CoreList/t/find_modules.t	Module::CoreList
-lib/Module/Load/Conditional.pm	Module::Conditional
-lib/Module/Load/Conditional/t/01_Module_Load_Conditional.t	Module::Conditional tests
-lib/Module/Load/Conditional/t/02_Parse_Version.t	Module::Load::Conditional tests
-lib/Module/Load/Conditional/t/to_load/Commented.pm	Module::Conditional tests
-lib/Module/Load/Conditional/t/to_load/InPod.pm	Module::Load::Conditional tests
-lib/Module/Load/Conditional/t/to_load/LoadIt.pm	Module::Conditional tests
-lib/Module/Load/Conditional/t/to_load/LoadMe.pl	Module::Conditional tests
-lib/Module/Load/Conditional/t/to_load/MustBe/Loaded.pm	Module::Load::Conditional tests
-lib/Module/Load/Conditional/t/to_load/ToBeLoaded	Module::Conditional tests
-lib/Module/Loaded.pm	Module::Loaded
-lib/Module/Loaded/t/01_Module-Loaded.t	Module::Loaded tests
-lib/Module/Load.pm	Module::Load
-lib/Module/Load/t/01_Module-Load.t	Module::Load tests
-lib/Module/Load/t/to_load/config_file	Module::Load tests
-lib/Module/Load/t/to_load/LoadIt.pm	Module::Load tests
-lib/Module/Load/t/to_load/LoadMe.pl	Module::Load tests
-lib/Module/Load/t/to_load/Must/Be/Loaded.pm	Module::Load tests
-lib/Module/Load/t/to_load/TestModule.pm	Module::Load tests
-lib/Module/Load/t/to_load/ToBeLoaded	Module::Load tests
-lib/Net/Changes			libnet
-lib/Net/Cmd.pm			libnet
-lib/Net/Config.eg		libnet
-lib/Net/Config.pm		libnet
-lib/Net/demos/ftp		libnet
-lib/Net/demos/inetd		libnet
-lib/Net/demos/nntp		libnet
-lib/Net/demos/nntp.mirror	libnet
-lib/Net/demos/pop3		libnet
-lib/Net/demos/smtp.self		libnet
-lib/Net/demos/time		libnet
-lib/Net/Domain.pm		libnet
-lib/Net/FTP/A.pm		libnet
-lib/Net/FTP/dataconn.pm		libnet
-lib/Net/FTP/E.pm		libnet
-lib/Net/FTP/I.pm		libnet
-lib/Net/FTP/L.pm		libnet
-lib/Net/FTP.pm			libnet
 lib/Net/hostent.pm		By-name interface to Perl's builtin gethost*
 lib/Net/hostent.t		See if Net::hostent works
-lib/Net/Hostname.pm.eg		libnet
-lib/Net/libnetFAQ.pod		libnet
 lib/Net/netent.pm		By-name interface to Perl's builtin getnet*
 lib/Net/netent.t		See if Net::netent works
-lib/Net/Netrc.pm		libnet
-lib/Net/NNTP.pm			libnet
-lib/Net/Ping/Changes		Net::Ping
-lib/Net/Ping.pm			Hello, anybody home?
-lib/Net/Ping/t/100_load.t	Ping Net::Ping
-lib/Net/Ping/t/110_icmp_inst.t	Ping Net::Ping
-lib/Net/Ping/t/120_udp_inst.t	Ping Net::Ping
-lib/Net/Ping/t/130_tcp_inst.t	Ping Net::Ping
-lib/Net/Ping/t/140_stream_inst.t	Ping Net::Ping
-lib/Net/Ping/t/150_syn_inst.t	Ping Net::Ping
-lib/Net/Ping/t/190_alarm.t	Ping Net::Ping
-lib/Net/Ping/t/200_ping_tcp.t	Ping Net::Ping
-lib/Net/Ping/t/250_ping_hires.t	Ping Net::Ping
-lib/Net/Ping/t/300_ping_stream.t	Ping Net::Ping
-lib/Net/Ping/t/400_ping_syn.t	Ping Net::Ping
-lib/Net/Ping/t/410_syn_host.t	Ping Net::Ping
-lib/Net/Ping/t/450_service.t	Ping Net::Ping
-lib/Net/Ping/t/500_ping_icmp.t	Ping Net::Ping
-lib/Net/Ping/t/510_ping_udp.t	Ping Net::Ping
-lib/Net/POP3.pm			libnet
 lib/Net/protoent.pm		By-name interface to Perl's builtin getproto*
 lib/Net/protoent.t		See if Net::protoent works
-lib/Net/README			libnet
 lib/Net/servent.pm		By-name interface to Perl's builtin getserv*
 lib/Net/servent.t		See if Net::servtent works
-lib/Net/SMTP.pm			libnet
-lib/Net/t/config.t		libnet
-lib/Net/t/datasend.t		libnet
-lib/Net/t/ftp.t			libnet
-lib/Net/t/hostname.t		libnet
-lib/Net/Time.pm			libnet
-lib/Net/t/libnet_t.pl		libnet
-lib/Net/t/netrc.t		libnet
-lib/Net/t/nntp.t		libnet
-lib/Net/t/require.t		libnet
-lib/Net/t/smtp.t		libnet
-lib/Net/t/time.t		libnet
 lib/newgetopt.pl		A perl library supporting long option parsing
-lib/NEXT/Changes		NEXT
-lib/NEXT.pm			Pseudo-class NEXT for method redispatch
-lib/NEXT/README			NEXT
-lib/NEXT/t/actual.t		NEXT
-lib/NEXT/t/actuns.t		NEXT
-lib/NEXT/t/dynamically_scoped_regex_vars.t	NEXT
-lib/NEXT/t/next.t		NEXT
-lib/NEXT/t/stringify.t	NEXT
-lib/NEXT/t/unseen.t		NEXT
-lib/Object/Accessor.pm	Object::Accessor
-lib/Object/Accessor/t/00_Object-Accessor.t	Object::Accessor tests
-lib/Object/Accessor/t/01_Object-Accessor-Subclassed.t	Object::Accessor tests
-lib/Object/Accessor/t/02_Object-Accessor-allow.t	Object::Accessor tests
-lib/Object/Accessor/t/03_Object-Accessor-local.t	Object::Accessor tests
-lib/Object/Accessor/t/04_Object-Accessor-lvalue.t	Object::Accessor tests
-lib/Object/Accessor/t/05_Object-Accessor-callback.t	Object::Accessor tests
-lib/Object/Accessor/t/06_Object-Accessor-alias.t	Object::Accessor tests
 lib/open2.pl			Open a two-ended pipe (uses IPC::Open2)
 lib/open3.pl			Open a three-ended pipe (uses IPC::Open3)
 lib/open.pm			Pragma to specify default I/O layers
@@ -2767,278 +3520,18 @@
 lib/overload/numbers.pm		Helper for overloading pragma
 lib/overload.pm			Module for overloading perl operators
 lib/overload.t			See if operator overloading works
-lib/Package/Constants.pm	Package::Constants
-lib/Package/Constants/t/01_list.t	Package::Constants tests
-lib/Params/Check.pm	Params::Check
-lib/Params/Check/t/01_Params-Check.t	Params::Check tests
-lib/parent.pm	Establish an ISA relationship with base classes at compile time
-lib/parent/t/compile-time-file.t	tests for parent.pm
-lib/parent/t/compile-time.t	tests for parent.pm
-lib/parent/t/lib/Dummy2.plugin	test files for parent.pm
-lib/parent/t/lib/Dummy/Outside.pm	test files for parent.pm
-lib/parent/t/lib/Dummy.pm	test files for parent.pm
-lib/parent/t/lib/FileThatOnlyExistsAsPMC.pmc	test files for parent.pm
-lib/parent/t/lib/ReturnsFalse.pm	test files for parent.pm
-lib/parent/t/parent-classfromclassfile.t	tests for parent.pm
-lib/parent/t/parent-classfromfile.t	tests for parent.pm
-lib/parent/t/parent-pmc.t	tests for parent.pm
-lib/parent/t/parent-returns-false.t	tests for parent.pm
-lib/parent/t/parent.t	tests for parent.pm
-lib/Parse/CPAN/Meta/Changes					Parse::CPAN::Meta
-lib/Parse/CPAN/Meta.pm						Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/01_compile.t				Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/02_basic.t				Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/03_regression.t				Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/04_scalar.t				Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/05_export.t				Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/11_meta_yml.t				Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/12_plagger.t				Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/13_perl_smith.t				Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/14_yaml_org.t				Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/15_multibyte.t				Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/16_nullrefs.t				Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/17_toolbar.t				Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/18_tap.t					Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/19_errors.t				Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/21_bom.t					Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/data/HTML-WebDAO.yml			Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/data/multibyte.yml			Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/data/sample.yml				Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/data/Spreadsheet-Read.yml			Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/data/Template-Provider-Unicode-Japanese.yml	Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/data/toolbar.yml				Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/data/utf_16_le_bom.yml			Parse::CPAN::Meta
-lib/Parse/CPAN/Meta/t/data/vanilla.yml				Parse::CPAN::Meta
 lib/perl5db.pl			Perl debugging routines
 lib/perl5db.t			Tests for the Perl debugger
 lib/perl5db/t/eval-line-bug	Tests for the Perl debugger
 lib/perl5db/t/lvalue-bug	Tests for the Perl debugger
+lib/perl5db/t/proxy-constants	Tests for the Perl debugger
+lib/perl5db/t/rt-61222		Tests for the Perl debugger
+lib/perl5db/t/rt-66110		Tests for the Perl debugger
+lib/perl5db/t/symbol-table-bug	Tests for the Perl debugger
 lib/PerlIO.pm			PerlIO support module
-lib/PerlIO/via/QuotedPrint.pm	PerlIO::via::QuotedPrint
-lib/PerlIO/via/t/QuotedPrint.t	PerlIO::via::QuotedPrint
-lib/Pod/Checker.pm		Pod-Parser - check POD documents for syntax errors
-lib/Pod/Escapes/ChangeLog	ChangeLog for Pod::Escapes
-lib/Pod/Escapes.pm		Pod::Escapes
-lib/Pod/Escapes/README		README for Pod::Escapes
-lib/Pod/Escapes/t/01_about_verbose.t	test Pod::Escapes
-lib/Pod/Escapes/t/10_main.t	test Pod::Escapes
-lib/Pod/Escapes/t/15_name2charnum.t	test Pod::Escapes
-lib/Pod/Find.pm			used by pod/splitpod
 lib/Pod/Functions.pm		used by pod/splitpod
 lib/Pod/Html.pm			Convert POD data to HTML
-lib/Pod/InputObjects.pm		Pod-Parser - define objects for input streams
-lib/Pod/LaTeX.pm		Convert POD data to LaTeX
-lib/Pod/Man.pm			Convert POD data to *roff
-lib/Pod/ParseLink.pm		Perl an L<> formatting code in POD text
-lib/Pod/Parser.pm		Pod-Parser - define base class for parsing POD
-lib/Pod/ParseUtils.pm		Pod-Parser - pod utility functions
-lib/Pod/Perldoc/BaseTo.pm	utility module for perldoc
-lib/Pod/Perldoc/GetOptsOO.pm	options parsing for perldoc
-lib/Pod/Perldoc.pm		guts of the 'perldoc' utility
-lib/Pod/Perldoc/t/01_about_verbose.t	test Pod::Perldoc
-lib/Pod/Perldoc/t/checkerbasic.t	test Pod::Perldoc::ToChecker
-lib/Pod/Perldoc/ToChecker.pm	let perldoc check POD for errors
-lib/Pod/Perldoc/ToMan.pm	render POD as man pages
-lib/Pod/Perldoc/ToNroff.pm	convert POD to nroff
-lib/Pod/Perldoc/ToPod.pm	convert POD to POD
-lib/Pod/Perldoc/ToRtf.pm	convert POD to RTF
-lib/Pod/Perldoc/ToText.pm	convert POD to plain text
-lib/Pod/Perldoc/ToTk.pm		convert POD via Tk::Pod
-lib/Pod/Perldoc/ToXml.pm	convert POD to XML
-lib/Pod/Perldoc/t/perldocbasic.t	test Pod::Perldoc basic operation
-lib/Pod/Perldoc/t/textbasic.t	test Pod::Perldoc::ToText
-lib/Pod/Plainer.pm		Pod migration utility module
-lib/Pod/PlainText.pm		Convert POD data to formatted ASCII text
-lib/Pod/Select.pm		Pod-Parser - select portions of POD docs
-lib/Pod/Simple/BlackBox.pm	Pod::Simple::BlackBox
-lib/Pod/Simple/ChangeLog	Pod::Simple ChangeLog
-lib/Pod/Simple/Checker.pm	check the Pod syntax of a document
-lib/Pod/Simple/Debug.pm		put Pod::Simple into trace/debug mode
-lib/Pod/Simple/DumpAsText.pm	dump Pod-parsing events as text
-lib/Pod/Simple/DumpAsXML.pm	turn Pod into XML
-lib/Pod/Simple/HTMLBatch.pm	convert several Pod files to several HTML files
-lib/Pod/Simple/HTMLLegacy.pm	Pod::Simple::HTMLLegacy
-lib/Pod/Simple/HTML.pm		convert Pod to HTML
-lib/Pod/Simple/LinkSection.pm	represent "section" attributes of L codes
-lib/Pod/Simple/Methody.pm	turn Pod::Simple events into method calls
-lib/Pod/Simple.pm		Pod made simple
-lib/Pod/Simple.pod		Pod for Pod::Simple
-lib/Pod/Simple/Progress.pm	Pod::Simple::Progress
-lib/Pod/Simple/PullParserEndToken.pm	end-tokens from Pod::Simple::PullParser
-lib/Pod/Simple/PullParser.pm		a pull-parser interface to parsing Pod
-lib/Pod/Simple/PullParserStartToken.pm	start-tokens from Pod::Simple::PullParser
-lib/Pod/Simple/PullParserTextToken.pm	text-tokens from Pod::Simple::PullParser
-lib/Pod/Simple/PullParserToken.pm	tokens from Pod::Simple::PullParser
-lib/Pod/Simple/README		Pod::Simple README file
-lib/Pod/Simple/RTF.pm		format Pod as RTF
-lib/Pod/Simple/Search.pm	find POD documents in directory trees
-lib/Pod/Simple/SimpleTree.pm	parse Pod into a simple parse tree
-lib/Pod/Simple/Subclassing.pod	write a formatter as a Pod::Simple subclass
-lib/Pod/Simple/t/00about.t	Pod::Simple test file
-lib/Pod/Simple/t/20_skip.t	Pod::Simple test file
-lib/Pod/Simple/t/accept01.t	Pod::Simple test file
-lib/Pod/Simple/t/accept05.t	Pod::Simple test file
-lib/Pod/Simple/t/ac_d.t		Pod::Simple test file
-lib/Pod/Simple/t/basic.t	Pod::Simple test file
-lib/Pod/Simple/t/begin.t	Pod::Simple test file
-lib/Pod/Simple/t/cbacks.t	Pod::Simple test file
-lib/Pod/Simple/t/chunking.t	Pod::Simple test file
-lib/Pod/Simple/t/closeys.t	Pod::Simple test file
-lib/Pod/Simple/t/corpus/2202jp.txt.packed	Pod::Simple test file
-lib/Pod/Simple/t/corpus/2202jp.xml	Pod::Simple test file
-lib/Pod/Simple/t/corpus/2202jpx.txt.packed	Pod::Simple test file
-lib/Pod/Simple/t/corpus/2202jpx.xml	Pod::Simple test file
-lib/Pod/Simple/t/corpus/2202jpy.txt.packed	Pod::Simple test file
-lib/Pod/Simple/t/corpus/2202jpy.xml	Pod::Simple test file
-lib/Pod/Simple/t/corpus/2202jpz.txt	Pod::Simple test file
-lib/Pod/Simple/t/corpus/2202jpz.xml	Pod::Simple test file
-lib/Pod/Simple/t/corpus2/fiqhakbar_iso6.txt	Pod::Simple test file
-lib/Pod/Simple/t/corpus2/fiqhakbar_iso6.xml	Pod::Simple test file
-lib/Pod/Simple/t/corpus2/polish_implicit_utf8.txt	Pod::Simple test file
-lib/Pod/Simple/t/corpus2/polish_utf16be_bom.txt.packed	Pod::Simple test file
-lib/Pod/Simple/t/corpus2/polish_utf16le_bom.txt.packed	Pod::Simple test file
-lib/Pod/Simple/t/corpus2/polish_utf8_bom2.txt	Pod::Simple test file
-lib/Pod/Simple/t/corpus2/polish_utf8_bom2.xml	Pod::Simple test file
-lib/Pod/Simple/t/corpus2/polish_utf8_bom.txt	Pod::Simple test file
-lib/Pod/Simple/t/corpus2/polish_utf8_bom.xml	Pod::Simple test file
-lib/Pod/Simple/t/corpus/8859_7.pod	Pod::Simple test file
-lib/Pod/Simple/t/corpus/8859_7.xml	Pod::Simple test file
-lib/Pod/Simple/t/corpus/cp1256.txt	Pod::Simple test file
-lib/Pod/Simple/t/corpus/cp1256.xml	Pod::Simple test file
-lib/Pod/Simple/t/corpus/fet_cont.txt	Pod::Simple test file
-lib/Pod/Simple/t/corpus/fet_cont.xml	Pod::Simple test file
-lib/Pod/Simple/t/corpus/fet_dup.txt	Pod::Simple test file
-lib/Pod/Simple/t/corpus/fet_dup.xml	Pod::Simple test file
-lib/Pod/Simple/t/corpus/iso6.txt	Pod::Simple test file
-lib/Pod/Simple/t/corpus/iso6.xml	Pod::Simple test file
-lib/Pod/Simple/t/corpus/koi8r.txt	Pod::Simple test file
-lib/Pod/Simple/t/corpus/koi8r.xml	Pod::Simple test file
-lib/Pod/Simple/t/corpus/laozi38b.txt		Pod::Simple test file
-lib/Pod/Simple/t/corpus/laozi38b.xml		Pod::Simple test file
-lib/Pod/Simple/t/corpus/laozi38p.pod		Pod::Simple test file
-lib/Pod/Simple/t/corpus/laozi38p.xml		Pod::Simple test file
-lib/Pod/Simple/t/corpus/laozi38.txt		Pod::Simple test file
-lib/Pod/Simple/t/corpus/laozi38.xml		Pod::Simple test file
-lib/Pod/Simple/t/corpus/lat1frim.txt	Pod::Simple test file
-lib/Pod/Simple/t/corpus/lat1frim.xml	Pod::Simple test file
-lib/Pod/Simple/t/corpus/lat1fr.txt	Pod::Simple test file
-lib/Pod/Simple/t/corpus/lat1fr.xml	Pod::Simple test file
-lib/Pod/Simple/t/corpus/nonesuch.txt		Pod::Simple test file
-lib/Pod/Simple/t/corpus/nonesuch.xml		Pod::Simple test file
-lib/Pod/Simple/t/corpus/pasternak_cp1251.txt	Pod::Simple test file
-lib/Pod/Simple/t/corpus/pasternak_cp1251.xml	Pod::Simple test file
-lib/Pod/Simple/t/corpus/plain_explicit.txt	Pod::Simple test file
-lib/Pod/Simple/t/corpus/plain_explicit.xml	Pod::Simple test file
-lib/Pod/Simple/t/corpus/plain_latin1.txt	Pod::Simple test file
-lib/Pod/Simple/t/corpus/plain_latin1.xml	Pod::Simple test file
-lib/Pod/Simple/t/corpus/plain.txt		Pod::Simple test file
-lib/Pod/Simple/t/corpus/plain_utf8.txt		Pod::Simple test file
-lib/Pod/Simple/t/corpus/plain_utf8.xml			Pod::Simple test file
-lib/Pod/Simple/t/corpus/plain.xml		Pod::Simple test file
-lib/Pod/Simple/t/corpus/polish_utf8.txt		Pod::Simple test file
-lib/Pod/Simple/t/corpus/polish_utf8.xml		Pod::Simple test file
-lib/Pod/Simple/t/corpus/s2763_sjis.txt		Pod::Simple test file
-lib/Pod/Simple/t/corpus/s2763_sjis.xml		Pod::Simple test file
-lib/Pod/Simple/t/corpus.t	Pod::Simple test file
-lib/Pod/Simple/t/corpus/thai_iso11.txt		Pod::Simple test file
-lib/Pod/Simple/t/corpus/thai_iso11.xml		Pod::Simple test file
-lib/Pod/Simple/t/encod01.t	Pod::Simple test file
-lib/Pod/Simple/t/encod02.t	Pod::Simple test file
-lib/Pod/Simple/t/encod03.t	Pod::Simple test file
-lib/Pod/Simple/t/end_over.t	Pod::Simple test file
-lib/Pod/Simple/TextContent.pm	get the text content of Pod
-lib/Pod/Simple/Text.pm		format Pod as plaintext
-lib/Pod/Simple/t/fcodes_e.t	Pod::Simple test file
-lib/Pod/Simple/t/fcodes_l.t	Pod::Simple test file
-lib/Pod/Simple/t/fcodes_s.t	Pod::Simple test file
-lib/Pod/Simple/t/fcodes.t	Pod::Simple test file
-lib/Pod/Simple/t/fornot.t	Pod::Simple test file
-lib/Pod/Simple/t/for.t		Pod::Simple test file
-lib/Pod/Simple/t/fullstop.t	Pod::Simple test file
-lib/Pod/Simple/t/heads.t	Pod::Simple test file
-lib/Pod/Simple/t/html01.t	Pod::Simple test file
-lib/Pod/Simple/t/html02.t	Pod::Simple test file
-lib/Pod/Simple/t/html03.t	Pod::Simple test file
-lib/Pod/Simple/t/htmlbat.t	Pod::Simple test file
-lib/Pod/Simple/TiedOutFH.pm	Pod::Simple::TiedOutFH
-lib/Pod/Simple/t/items02.t	Pod::Simple test file
-lib/Pod/Simple/t/items.t	Pod::Simple test file
-lib/Pod/Simple/t/itemstar.t	Pod::Simple test file
-lib/Pod/Simple/t/junk1o.txt	Pod::Simple test file
-lib/Pod/Simple/t/junk1.pod	Pod::Simple test file
-lib/Pod/Simple/t/junk2o.txt	Pod::Simple test file
-lib/Pod/Simple/t/junk2.pod	Pod::Simple test file
-lib/Pod/Simple/t/linkclas.t	Pod::Simple test file
-lib/Pod/Simple/t/perlcygo.txt	Pod::Simple test file
-lib/Pod/Simple/t/perlcyg.pod	Pod::Simple test file
-lib/Pod/Simple/t/perlfaqo.txt	Pod::Simple test file
-lib/Pod/Simple/t/perlfaq.pod	Pod::Simple test file
-lib/Pod/Simple/t/perlvaro.txt	Pod::Simple test file
-lib/Pod/Simple/t/perlvar.pod	Pod::Simple test file
-lib/Pod/Simple/t/puller.t	Pod::Simple test file
-lib/Pod/Simple/t/pulltitl.t	Pod::Simple test file
-lib/Pod/Simple/TranscodeDumb.pm		Pod::Simple::TranscodeDumb
-lib/Pod/Simple/Transcode.pm	Pod::Simple::Transcode
-lib/Pod/Simple/TranscodeSmart.pm	Pod::Simple::TranscodeSmart
-lib/Pod/Simple/t/reinit.t	Pod::Simple test file
-lib/Pod/Simple/t/render.t	Pod::Simple test file
-lib/Pod/Simple/t/search05.t	Pod::Simple test file
-lib/Pod/Simple/t/search10.t	Pod::Simple test file
-lib/Pod/Simple/t/search12.t	Pod::Simple test file
-lib/Pod/Simple/t/search20.t	Pod::Simple test file
-lib/Pod/Simple/t/search22.t	Pod::Simple test file
-lib/Pod/Simple/t/search25.t	Pod::Simple test file
-lib/Pod/Simple/t/search26.t	Pod::Simple test file
-lib/Pod/Simple/t/search27.t	Pod::Simple test file
-lib/Pod/Simple/t/search28.t	Pod::Simple test file
-lib/Pod/Simple/t/search29.t	Pod::Simple test file
-lib/Pod/Simple/t/search50.t	Pod::Simple test file
-lib/Pod/Simple/t/stree.t		Pod::Simple test file
-lib/Pod/Simple/t/testlib1/Blorm.pm		Pod::Simple test file
-lib/Pod/Simple/t/testlib1/hinkhonk/Glunk.pod	Pod::Simple test file
-lib/Pod/Simple/t/testlib1/hinkhonk/readme.txt	Pod::Simple test file
-lib/Pod/Simple/t/testlib1/hinkhonk/Vliff.pm	Pod::Simple test file
-lib/Pod/Simple/t/testlib1/pod/perlflif.pod	Pod::Simple test file
-lib/Pod/Simple/t/testlib1/pod/perlthng.pod	Pod::Simple test file
-lib/Pod/Simple/t/testlib1/squaa/Glunk.pod	Pod::Simple test file
-lib/Pod/Simple/t/testlib1/squaa.pm		Pod::Simple test file
-lib/Pod/Simple/t/testlib1/squaa/Vliff.pm	Pod::Simple test file
-lib/Pod/Simple/t/testlib1/zikzik.pod		Pod::Simple test file
-lib/Pod/Simple/t/testlib1/Zonk/Fiddle.txt	Pod::Simple test file
-lib/Pod/Simple/t/testlib1/Zonk/Pronk.pm		Pod::Simple test file
-lib/Pod/Simple/t/testlib1/Zonk/Veng.pm		Pod::Simple test file
-lib/Pod/Simple/t/testlib2/hinkhonk/Glunk.pod	Pod::Simple test file
-lib/Pod/Simple/t/testlib2/hinkhonk/readme.txt	Pod::Simple test file
-lib/Pod/Simple/t/testlib2/hinkhonk/Vliff.pm	Pod::Simple test file
-lib/Pod/Simple/t/testlib2/pod/perlthng.pod	Pod::Simple test file
-lib/Pod/Simple/t/testlib2/pod/perlzuk.pod	Pod::Simple test file
-lib/Pod/Simple/t/testlib2/squaa/Vliff.pm	Pod::Simple test file
-lib/Pod/Simple/t/testlib2/squaa/Wowo.pod	Pod::Simple test file
-lib/Pod/Simple/t/testlib2/Suzzle.pm		Pod::Simple test file
-lib/Pod/Simple/t/testlib3/squaa/Vliff.pm	Pod::Simple test file
-lib/Pod/Simple/t/tiedfh.t	Pod::Simple test file
-lib/Pod/Simple/t/verbatim.t		Pod::Simple test file
-lib/Pod/Simple/t/verb_fmt.t	Pod::Simple test file
-lib/Pod/Simple/t/xhtml01.t	Pod::Simple test file
-lib/Pod/Simple/t/xhtml05.t	Pod::Simple test file
-lib/Pod/Simple/t/x_nixer.t		Pod::Simple test file
-lib/Pod/Simple/XHTML.pm		turn Pod into XHTML
-lib/Pod/Simple/XMLOutStream.pm	turn Pod into XML
-lib/Pod/t/basic.cap		podlators test
-lib/Pod/t/basic.clr		podlators test
-lib/Pod/t/basic.man		podlators test
-lib/Pod/t/basic.ovr		podlators test
-lib/Pod/t/basic.pod		podlators test
-lib/Pod/t/basic.t		podlators test
-lib/Pod/t/basic.txt		podlators test
-lib/Pod/t/color.t		podlators test
-lib/Pod/t/contains_pod.t	Pod-Parser test
 lib/Pod/t/eol.t			end of line agnosticism
-lib/Pod/Text/Color.pm		Convert POD data to color ASCII text
-lib/Pod/Text/Overstrike.pm	Convert POD data to formatted overstrike text
-lib/Pod/Text.pm			Pod-Parser - convert POD data to formatted ASCII text
-lib/Pod/Text/Termcap.pm		Convert POD data to ASCII text with format escapes
-lib/Pod/t/filehandle.t		podlators test
 lib/Pod/t/Functions.t		See if Pod::Functions works
 lib/Pod/t/htmlescp.pod		pod2html escape test input data
 lib/Pod/t/htmlescp.t		pod2html escape test
@@ -3047,35 +3540,15 @@
 lib/Pod/t/htmlview.pod		pod2html render test input data
 lib/Pod/t/htmlview.t		pod2html render test
 lib/Pod/t/InputObjects.t	See if Pod::InputObjects works
-lib/Pod/t/man-options.t		podlators test
-lib/Pod/t/man.t			podlators test
-lib/Pod/t/man-utf8.t		podlators test
-lib/Pod/t/parselink.t		podlators test
 lib/Pod/t/pod2html-lib.pl	pod2html testing library
-lib/Pod/t/pod2latex.t		See if Pod::LaTeX works
-lib/Pod/t/pod-parser.t		podlators test
-lib/Pod/t/pod-spelling.t	podlators test
-lib/Pod/t/pod.t			podlators test
 lib/Pod/t/Select.t		See if Pod::Select works
-lib/Pod/t/termcap.t		podlators test
-lib/Pod/t/text-encoding.t		podlators test
-lib/Pod/t/text-options.t		podlators test
-lib/Pod/t/text.t		podlators test
-lib/Pod/t/text-utf8.t		podlators test
 lib/Pod/t/Usage.t		See if Pod::Usage works
-lib/Pod/t/user.t		See if Pod::LaTeX works
 lib/Pod/t/utils.t		Test for Pod::ParseUtils
-lib/Pod/Usage.pm		Pod-Parser - print usage messages
 lib/pwd.pl			Routines to keep track of PWD environment variable
 lib/Search/Dict.pm		Perform binary search on dictionaries
 lib/Search/Dict.t		See if Search::Dict works
 lib/SelectSaver.pm		Enforce proper select scoping
 lib/SelectSaver.t		See if SelectSaver works
-lib/SelfLoader.pm		Load functions only on demand
-lib/SelfLoader/t/01SelfLoader.t	See if SelfLoader works
-lib/SelfLoader/t/02SelfLoader-buggy.t	See if SelfLoader works
-lib/Shell.pm			Make AUTOLOADed system() calls
-lib/Shell.t			Tests for above
 lib/shellwords.pl		Perl library to split into words with shell quoting
 lib/sigtrap.pm			For trapping an abort and giving traceback
 lib/sigtrap.t			See if sigtrap works
@@ -3086,245 +3559,29 @@
 lib/strict.t			See if strictures work
 lib/subs.pm			Declare overriding subs
 lib/subs.t			See if subroutine pseudo-importation works
-lib/Switch.pm			Switch for Perl
-lib/Switch/t/given.t		See if Perl 6 given (switch) works
-lib/Switch/t/nested.t		See if nested switch works
-lib/Switch/t/switch.t		See if Perl 5 switch works
 lib/Symbol.pm			Symbol table manipulation routines
 lib/Symbol.t			See if Symbol works
 lib/syslog.pl			Perl library supporting syslogging
 lib/tainted.pl			Old code for tainting
-lib/Term/ANSIColor/ChangeLog	Term::ANSIColor
-lib/Term/ANSIColor.pm		Perl module supporting termcap usage
-lib/Term/ANSIColor/README	Term::ANSIColor
-lib/Term/ANSIColor/t/basic.t	Tests for Term::ANSIColor
 lib/termcap.pl			Perl library supporting termcap usage
-lib/Term/Cap.pm			Perl module supporting termcap usage
-lib/Term/Cap.t			See if Term::Cap works
 lib/Term/Complete.pm		A command completion subroutine
 lib/Term/Complete.t		See if Term::Complete works
 lib/Term/ReadLine.pm		Stub readline library
 lib/Term/ReadLine.t		See if Term::ReadLine works
-lib/Term/UI/History.pm	Term::UI
-lib/Term/UI.pm	Term::UI
-lib/Term/UI/t/00_load.t	Term::UI tests
-lib/Term/UI/t/01_history.t	Term::UI tests
-lib/Term/UI/t/02_ui.t	Term::UI tests
-lib/Test/Builder/Module.pm	Base class for test modules
-lib/Test/Builder.pm		For writing new test libraries
-lib/Test/Builder/Tester/Color.pm	Turn on color in Test::Builder::Tester
-lib/Test/Builder/Tester.pm	For testing Test::Builder based classes
-lib/Test/More.pm		More utilities for writing tests
-lib/Test.pm			A simple framework for writing test scripts
-lib/Test/Simple/Changes		Test::Simple changes
-lib/Test/Simple.pm		Basic utility for writing tests
-lib/Test/Simple/README		Test::Simple README
-lib/Test/Simple/t/00test_harness_check.t	Test::Simple test
-lib/Test/Simple/t/bad_plan.t	Test::Builder plan() test
-lib/Test/Simple/t/bail_out.t	Test::Builder BAIL_OUT test
-lib/Test/Simple/t/BEGIN_require_ok.t	Test::More require_ok() testing
-lib/Test/Simple/t/BEGIN_use_ok.t	Test::More use_ok() testing
-lib/Test/Simple/t/buffer.t	Test::Builder buffering test
-lib/Test/Simple/t/Builder/Builder.t	Test::Builder tests
-lib/Test/Simple/t/Builder/carp.t	Test::Builder test
-lib/Test/Simple/t/Builder/create.t	Test::Builder test 
-lib/Test/Simple/t/Builder/current_test.t	Test::Builder tests
-lib/Test/Simple/t/Builder/current_test_without_plan.t	Test::Builder tests
-lib/Test/Simple/t/Builder/details.t	Test::Builder tests
-lib/Test/Simple/t/Builder/done_testing_double.t	Test::Builder tests
-lib/Test/Simple/t/Builder/done_testing_plan_mismatch.t	Test::Builder tests
-lib/Test/Simple/t/Builder/done_testing.t		Test::Builder tests
-lib/Test/Simple/t/Builder/done_testing_with_no_plan.t	Test::Builder tests
-lib/Test/Simple/t/Builder/done_testing_with_number.t	Test::Builder tests
-lib/Test/Simple/t/Builder/done_testing_with_plan.t	Test::Builder tests
-lib/Test/Simple/t/Builder/fork_with_new_stdout.t	Test::Builder tests
-lib/Test/Simple/t/Builder/has_plan2.t	Test::Builder tests
-lib/Test/Simple/t/Builder/has_plan.t	Test::Builder tests
-lib/Test/Simple/t/Builder/is_fh.t	Test::Builder tests
-lib/Test/Simple/t/Builder/maybe_regex.t	Test::Builder tests
-lib/Test/Simple/t/Builder/no_diag.t	Test::Builder tests
-lib/Test/Simple/t/Builder/no_ending.t	Test::Builder tests
-lib/Test/Simple/t/Builder/no_header.t	Test::Builder tests
-lib/Test/Simple/t/Builder/no_plan_at_all.t	Test::Builder tests
-lib/Test/Simple/t/Builder/ok_obj.t	Test::Builder tests
-lib/Test/Simple/t/Builder/output.t	Test::Builder tests
-lib/Test/Simple/t/Builder/reset.t	Test::Builder tests
-lib/Test/Simple/t/Builder/try.t		Test::Builder tests
-lib/Test/Simple/t/c_flag.t	Test::Simple test
-lib/Test/Simple/t/circular_data.t	Test::Simple test
-lib/Test/Simple/t/cmp_ok.t	Test::More test
-lib/Test/Simple/t/diag.t	Test::More diag() test
-lib/Test/Simple/t/died.t	Test::Simple test
-lib/Test/Simple/t/dont_overwrite_die_handler.t	Test::More tests
-lib/Test/Simple/t/eq_set.t	Test::Simple test
-lib/Test/Simple/t/exit.t	Test::Simple test, exit codes
-lib/Test/Simple/t/explain.t	Test::Simple test
-lib/Test/Simple/t/extra_one.t	Test::Simple test
-lib/Test/Simple/t/extra.t	Test::Simple test
-lib/Test/Simple/t/fail-like.t	Test::More test, like() failures
-lib/Test/Simple/t/fail-more.t	Test::More test, tests failing
-lib/Test/Simple/t/fail_one.t	Test::Simple test
-lib/Test/Simple/t/fail.t	Test::Simple test, test failures
-lib/Test/Simple/t/filehandles.t	Test::Simple test, STDOUT can be played with
-lib/Test/Simple/t/fork.t	Test::More fork tests
-lib/Test/Simple/t/harness_active.t	Test::Simple test
-lib/Test/Simple/t/import.t	Test::More test, importing functions
-lib/Test/Simple/t/is_deeply_dne_bug.t	Test::More test
-lib/Test/Simple/t/is_deeply_fail.t	Test::More test, is_deeply()
-lib/Test/Simple/t/is_deeply_with_threads.t	Test::More test
-lib/Test/Simple/t/lib/Dummy.pm	Test::More test module
-lib/Test/Simple/t/lib/MyOverload.pm	Test::More test module
-lib/Test/Simple/t/lib/NoExporter.pm	Test::Simple test module
-lib/Test/Simple/t/lib/SigDie.pm	Test module for Test::More
-lib/Test/Simple/t/missing.t	Test::Simple test, missing tests
-lib/Test/Simple/t/More.t	Test::More test, basic stuff
-lib/Test/Simple/t/new_ok.t	Test::More test
-lib/Test/Simple/t/no_plan.t	Test::Simple test, forgot the plan
-lib/Test/Simple/t/no_tests.t	Test::More test
-lib/Test/Simple/t/note.t	Test::More test
-lib/Test/Simple/TODO		Test::Simple TODO
-lib/Test/Simple/t/overload.t		Test::Simple test
-lib/Test/Simple/t/overload_threads.t	Test::Simple test
-lib/Test/Simple/t/plan_bad.t		Test::Simple test
-lib/Test/Simple/t/plan_is_noplan.t	Test::Simple test, no_plan
-lib/Test/Simple/t/plan_no_plan.t	Test::More test, plan() w/no_plan
-lib/Test/Simple/t/plan_shouldnt_import.t	Test::Simple test
-lib/Test/Simple/t/plan_skip_all.t	Test::More test, plan() w/skip_all
-lib/Test/Simple/t/plan.t	Test::More test, plan()
-lib/Test/Simple/t/require_ok.t	Test::Simple test
-lib/Test/Simple/t/simple.t	Test::Simple test, basic stuff
-lib/Test/Simple/t/skipall.t	Test::More test, skip all tests
-lib/Test/Simple/t/skip.t	Test::More test, SKIP tests
-lib/Test/Simple/t/tbm_doesnt_set_exported_to.t	Test::Builder::Module test
-lib/Test/Simple/t/Tester/tbt_01basic.t	Test::Builder::Tester test
-lib/Test/Simple/t/Tester/tbt_02fhrestore.t	Test::Builder::Tester test
-lib/Test/Simple/t/Tester/tbt_03die.t	Test::Builder::Tester test
-lib/Test/Simple/t/Tester/tbt_04line_num.t	Test::Builder::Tester test
-lib/Test/Simple/t/Tester/tbt_05faildiag.t	Test::Builder::Tester test
-lib/Test/Simple/t/Tester/tbt_06errormess.t	Test::Builder::Tester test
-lib/Test/Simple/t/Tester/tbt_07args.t	Test::Builder::Tester test
-lib/Test/Simple/t/threads.t	Test::Builder thread-safe checks
-lib/Test/Simple/t/thread_taint.t	Test::Simple test
-lib/Test/Simple/t/todo.t	Test::More test, TODO tests
-lib/Test/Simple/t/undef.t	Test::More test, undefs don't cause warnings
-lib/Test/Simple/t/useing.t	Test::More test, compile test
-lib/Test/Simple/t/use_ok.t	Test::More test, use_ok()
-lib/Test/Simple/t/utf8.t	Test::More test
-lib/Test/Simple/t/versions.t	Test::More test
-lib/Test/t/05_about_verbose.t	See if Test works
-lib/Test/t/fail.t		See if Test works
-lib/Test/t/mix.t		See if Test works
-lib/Test/t/multiline.t		See if Test works
-lib/Test/t/onfail.t		See if Test works
-lib/Test/t/qr.t			See if Test works
-lib/Test/t/skip.t		See if Test works
-lib/Test/t/success.t		See if Test works
-lib/Test/t/todo.t		See if Test works
-lib/Test/Tutorial.pod		A tutorial on writing tests
 lib/Text/Abbrev.pm		An abbreviation table builder
 lib/Text/Abbrev.t		Test Text::Abbrev
-lib/Text/Balanced/Changes	Text::Balanced
-lib/Text/Balanced.pm		Text::Balanced
-lib/Text/Balanced/README	Text::Balanced
-lib/Text/Balanced/t/00-load.t	See if Text::Balanced works
-lib/Text/Balanced/t/extbrk.t	See if Text::Balanced works
-lib/Text/Balanced/t/extcbk.t	See if Text::Balanced works
-lib/Text/Balanced/t/extdel.t	See if Text::Balanced works
-lib/Text/Balanced/t/extmul.t	See if Text::Balanced works
-lib/Text/Balanced/t/extqlk.t	See if Text::Balanced works
-lib/Text/Balanced/t/exttag.t	See if Text::Balanced works
-lib/Text/Balanced/t/extvar.t	See if Text::Balanced works
-lib/Text/Balanced/t/gentag.t	See if Text::Balanced works
-lib/Text/ParseWords.pm		Perl module to split words on arbitrary delimiter
-lib/Text/ParseWords.t		See if Text::ParseWords works
-lib/Text/ParseWords/taint.t	See if Text::ParseWords works with tainting
-lib/Text/Tabs.pm		Do expand and unexpand
-lib/Text/TabsWrap/CHANGELOG	ChangeLog for Tabs+Wrap
-lib/Text/TabsWrap/t/37000.t	See if Text::Tabs is working
-lib/Text/TabsWrap/t/39548.t	See if Text::Tabs is working
-lib/Text/TabsWrap/t/belg4mit.t	See if Text::Tabs is working
-lib/Text/TabsWrap/t/dandv.t	See if Text::Tabs is working
-lib/Text/TabsWrap/t/fill.t	See if Text::Wrap::fill works
-lib/Text/TabsWrap/t/Jacobson2.t	See if Text::Tabs is working
-lib/Text/TabsWrap/t/Jacobson.t	See if Text::Tabs is working
-lib/Text/TabsWrap/t/Jochen.t	See if Text::Tabs is working
-lib/Text/TabsWrap/t/sep2.t	See if Text::Tabs is working
-lib/Text/TabsWrap/t/sep.t	See if Text::Tabs is working
-lib/Text/TabsWrap/t/tabs.t	See if Text::Tabs works
-lib/Text/TabsWrap/t/wrap_separator2.t	See if Text::Wrap::wrap works
-lib/Text/TabsWrap/t/wrap.t	See if Text::Wrap::wrap works
-lib/Text/Wrap.pm		Paragraph formatter
 lib/Thread.pm			Thread extensions frontend
-lib/Thread/Queue.pm		Thread-safe queues
-lib/Thread/Queue/t/01_basic.t	Thread::Queue tests
-lib/Thread/Queue/t/02_refs.t	Thread::Queue tests
-lib/Thread/Queue/t/03_peek.t	Thread::Queue tests
-lib/Thread/Queue/t/04_errs.t	Thread::Queue tests
-lib/Thread/Queue/t/05_extract.t	Thread::Queue tests
-lib/Thread/Queue/t/06_insert.t	Thread::Queue tests
-lib/Thread/Queue/t/07_lock.t	Thread::Queue tests
-lib/Thread/Queue/t/08_nothreads.t	Thread::Queue tests
-lib/Thread/Semaphore.pm		Thread-safe semaphores
-lib/Thread/Semaphore/t/01_basic.t	Thread::Semaphore tests
-lib/Thread/Semaphore/t/02_errs.t	Thread::Semaphore tests
-lib/Thread/Semaphore/t/03_nothreads.t	Thread::Semaphore tests
 lib/Thread.t			Thread extensions frontend tests
 lib/Tie/Array.pm		Base class for tied arrays
 lib/Tie/Array/push.t		Test for Tie::Array
 lib/Tie/Array/splice.t		Test for Tie::Array::SPLICE
 lib/Tie/Array/stdpush.t		Test for Tie::StdArray
 lib/Tie/Array/std.t		Test for Tie::StdArray
-lib/Tie/File.pm			Files as tied arrays
-lib/Tie/File/t/00_version.t	Trivial test for Tie::File
-lib/Tie/File/t/01_gen.t		Generic read/write tests for Tie::File
-lib/Tie/File/t/02_fetchsize.t	File length fetch test for Tie::File
-lib/Tie/File/t/03_longfetch.t	Past-the-end-of-the-array tests for Tie::File
-lib/Tie/File/t/04_splice.t	SPLICE method tests for Tie::File
-lib/Tie/File/t/05_size.t	$#a tests for Tie::File
-lib/Tie/File/t/06_fixrec.t	'_fixrec' method functional tests for Tie::File
-lib/Tie/File/t/07_rv_splice.t	SPLICE method return value tests for Tie::File
-lib/Tie/File/t/08_ro.t		read-only mode tests for Tie::File
-lib/Tie/File/t/09_gen_rs.t	Like 01_gen.t, with unusual record separator
-lib/Tie/File/t/10_splice_rs.t	Like 04_splice.t, with unusual record separator
-lib/Tie/File/t/11_rv_splice_rs.t	Like 07_rv_splice.t, with unusual record separator
-lib/Tie/File/t/12_longfetch_rs.t	Like 03_longfetch.t, with unusual record separator
-lib/Tie/File/t/13_size_rs.t	Like 05_size.t, with unusual record separator
-lib/Tie/File/t/14_lock.t	File locking method tests for Tie::File
-lib/Tie/File/t/15_pushpop.t	PUSH / POP / SHIFT / UNSHIFT for Tie::File
-lib/Tie/File/t/16_handle.t	Tying a handle instead of a file for Tie::File
-lib/Tie/File/t/17_misc_meth.t	CLEAR / EXISTS / DELETE / EXTEND for Tie::File
-lib/Tie/File/t/18_rs_fixrec.t	Like 06_fixrec.t, with unusual record separator
-lib/Tie/File/t/19_cache.t	Read cache exercises and regression for Tie::File
-lib/Tie/File/t/20_cache_full.t	LRU expiry exercises and regression for Tie::File
-lib/Tie/File/t/21_win32.t	Win32 special behavior of Tie::File
-lib/Tie/File/t/22_autochomp.t	'autochomp' option of Tie::File
-lib/Tie/File/t/23_rv_ac_splice.t	Like 07_rv_splice.t, but with autochomp
-lib/Tie/File/t/24_cache_loop.t	Regression for old Tie::File cache bug
-lib/Tie/File/t/25_gen_nocache.t	Like 01_gen.t, but with caching disabled
-lib/Tie/File/t/26_twrite.t	Unit tests for Tie::File::_twrite
-lib/Tie/File/t/27_iwrite.t	Unit tests for Tie::File::_iwrite
-lib/Tie/File/t/28_mtwrite.t	Unit tests for Tie::File::_mtwrite
-lib/Tie/File/t/29a_upcopy.t	Unit tests for Tie::File::_upcopy
-lib/Tie/File/t/29_downcopy.t	Unit tests for Tie::File::_downcopy
-lib/Tie/File/t/30_defer.t	deferred writing feature tests for Tie::File
-lib/Tie/File/t/31_autodefer.t	'autodefer' feature tests for Tie::File
-lib/Tie/File/t/32_defer_misc.t	Like 17_misc_meth.t, but with deferred writing
-lib/Tie/File/t/33_defer_vs.t	Like 30_defer.t, but with varying-length records
-lib/Tie/File/t/40_abs_cache.t	Unit tests for Tie::File::Cache
-lib/Tie/File/t/41_heap.t	Unit tests for Tie::File::Heap
-lib/Tie/File/t/42_offset.t	Unit tests for the offset method
 lib/Tie/Handle.pm		Base class for tied handles
 lib/Tie/Handle/stdhandle_from_handle.t	Test for Tie::StdHandle/Handle backwards compat
 lib/Tie/Handle/stdhandle.t	Test for Tie::StdHandle
 lib/Tie/Hash/NamedCapture.pm	Implements %- and %+ behaviour
 lib/Tie/Hash.pm			Base class for tied hashes
-lib/Tie/Memoize.pm		Base class for memoized tied hashes
-lib/Tie/Memoize.t		Test for Memoize.t
-lib/Tie/RefHash.pm		Base class for tied hashes with references as keys
-lib/Tie/RefHash/rebless.t	Test for Tie::RefHash with rebless
-lib/Tie/RefHash/refhash.t	Test for Tie::RefHash and Tie::RefHash::Nestable
-lib/Tie/RefHash/storable.t	Test for Tie::RefHash with storable
-lib/Tie/RefHash/threaded.t	Test for Tie::RefHash with threads
 lib/Tie/Scalar.pm		Base class for tied scalars
 lib/Tie/Scalar.t		See if Tie::Scalar works
 lib/Tie/StdHandle.pm		Tie::StdHandle
@@ -3333,64 +3590,58 @@
 lib/Time/gmtime.pm		By-name interface to Perl's builtin gmtime
 lib/Time/gmtime.t		Test for Time::gmtime
 lib/timelocal.pl		Perl library supporting inverse of localtime, gmtime
-lib/Time/Local.pm		Reverse translation of localtime, gmtime
-lib/Time/Local.t		See if Time::Local works
 lib/Time/localtime.pm		By-name interface to Perl's builtin localtime
 lib/Time/localtime.t		Test for Time::localtime
 lib/Time/tm.pm			Internal object for Time::{gm,local}time
-lib/Unicode/Collate/allkeys.txt	Unicode::Collate
-lib/Unicode/Collate/Changes	Unicode::Collate
-lib/Unicode/Collate/keys.txt	Unicode::Collate
-lib/Unicode/Collate.pm		Unicode::Collate
-lib/Unicode/Collate/README	Unicode::Collate
-lib/Unicode/Collate/t/altern.t	Unicode::Collate
-lib/Unicode/Collate/t/cjkrange.t	Unicode::Collate
-lib/Unicode/Collate/t/contract.t	Unicode::Collate
-lib/Unicode/Collate/t/hangtype.t	Unicode::Collate
-lib/Unicode/Collate/t/hangul.t	Unicode::Collate
-lib/Unicode/Collate/t/ignor.t	Unicode::Collate
-lib/Unicode/Collate/t/illegalp.t	Unicode::Collate
-lib/Unicode/Collate/t/illegal.t	Unicode::Collate
-lib/Unicode/Collate/t/index.t	Unicode::Collate
-lib/Unicode/Collate/t/normal.t	Unicode::Collate
-lib/Unicode/Collate/t/override.t	Unicode::Collate
-lib/Unicode/Collate/t/rearrang.t	Unicode::Collate
-lib/Unicode/Collate/t/test.t	Unicode::Collate
-lib/Unicode/Collate/t/trailwt.t	Unicode::Collate
-lib/Unicode/Collate/t/variable.t	Unicode::Collate
-lib/Unicode/Collate/t/version.t	Unicode::Collate
-lib/Unicode/Collate/t/view.t	Unicode::Collate
 lib/Unicode/README		Explanation what happened to lib/unicode.
 lib/Unicode/UCD.pm		Unicode character database
 lib/Unicode/UCD.t		See if Unicode character database works
-lib/unicore/ArabicShaping.txt	Unicode character database
-lib/unicore/BidiMirroring.txt	Unicode character database
-lib/unicore/Blocks.txt		Unicode character database
-lib/unicore/CaseFolding.txt	Unicode character database
-lib/unicore/CompositionExclusions.txt	Unicode character database
-lib/unicore/EastAsianWidth.txt	Unicode character database
-lib/unicore/HangulSyllableType.txt	Unicode character database
-lib/unicore/Index.txt		Unicode character database
-lib/unicore/Jamo.txt		Unicode character database
-lib/unicore/LineBreak.txt	Unicode character database
-lib/unicore/Makefile		Unicode character database
-lib/unicore/mktables		Unicode character database generator
-lib/unicore/mktables.lst	File list for mktables
-lib/unicore/NameAliases.txt	Unicode character database
-lib/unicore/NamedSequences.txt	Unicode character database
-lib/unicore/NamedSqProv.txt	Unicode character database
-lib/unicore/NamesList.txt	Unicode character database
+lib/unicore/ArabicShaping.txt			Unicode character database
+lib/unicore/auxiliary/GCBTest.txt	Unicode character database
+lib/unicore/auxiliary/GraphemeBreakProperty.txt	Unicode character database
+lib/unicore/auxiliary/SentenceBreakProperty.txt	Unicode character database
+lib/unicore/auxiliary/WordBreakProperty.txt	Unicode character database
+lib/unicore/BidiMirroring.txt			Unicode character database
+lib/unicore/Blocks.txt				Unicode character database
+lib/unicore/CaseFolding.txt			Unicode character database
+lib/unicore/CJKRadicals.txt			Unicode character database
+lib/unicore/CompositionExclusions.txt		Unicode character database
+lib/unicore/DAge.txt				Unicode character database
+lib/unicore/DCoreProperties.txt			Unicode character database
+lib/unicore/DNormalizationProps.txt		Unicode character database
+lib/unicore/EastAsianWidth.txt			Unicode character database
+lib/unicore/extracted/DBidiClass.txt		Unicode character database
+lib/unicore/extracted/DBinaryProperties.txt	Unicode character database
+lib/unicore/extracted/DCombiningClass.txt	Unicode character database
+lib/unicore/extracted/DDecompositionType.txt	Unicode character database
+lib/unicore/extracted/DEastAsianWidth.txt	Unicode character database
+lib/unicore/extracted/DGeneralCategory.txt	Unicode character database
+lib/unicore/extracted/DJoinGroup.txt		Unicode character database
+lib/unicore/extracted/DJoinType.txt		Unicode character database
+lib/unicore/extracted/DLineBreak.txt		Unicode character database
+lib/unicore/extracted/DNumType.txt		Unicode character database
+lib/unicore/extracted/DNumValues.txt		Unicode character database
+lib/unicore/HangulSyllableType.txt		Unicode character database
+lib/unicore/Index.txt				Unicode character database
+lib/unicore/Jamo.txt				Unicode character database
+lib/unicore/LineBreak.txt			Unicode character database
+lib/unicore/Makefile				Unicode character database
+lib/unicore/mktables				Unicode character database generator
+lib/unicore/NameAliases.txt			Unicode character database
+lib/unicore/NamedSequences.txt			Unicode character database
+lib/unicore/NamedSqProv.txt			Unicode character database
+lib/unicore/NamesList.txt			Unicode character database
 lib/unicore/NormalizationCorrections.txt	Unicode character database
-lib/unicore/PropertyAliases.txt	Unicode character database
-lib/unicore/PropList.txt	Unicode character database
-lib/unicore/PropValueAliases.txt	Unicode character database
-lib/unicore/README.perl		Unicode character database
-lib/unicore/ReadMe.txt		Unicode character database info
-lib/unicore/Scripts.txt		Unicode character database
-lib/unicore/SpecialCasing.txt	Unicode character database
-lib/unicore/StandardizedVariants.txt	Unicode character database
-lib/unicore/UnicodeData.txt	Unicode character database
-lib/unicore/version		The version of the Unicode
+lib/unicore/PropertyAliases.txt			Unicode character database
+lib/unicore/PropList.txt			Unicode character database
+lib/unicore/PropValueAliases.txt		Unicode character database
+lib/unicore/README.perl				Unicode character database
+lib/unicore/ReadMe.txt				Unicode character database info
+lib/unicore/Scripts.txt				Unicode character database
+lib/unicore/SpecialCasing.txt			Unicode character database
+lib/unicore/StandardizedVariants.txt		Unicode character database
+lib/unicore/UnicodeData.txt			Unicode character database
+lib/unicore/version				The version of the Unicode
 lib/UNIVERSAL.pm		Base class for ALL classes
 lib/User/grent.pm		By-name interface to Perl's builtin getgr*
 lib/User/grent.t		See if User::grwent works
@@ -3423,7 +3674,6 @@
 makeaperl.SH			perl script that produces a new perl binary
 makedef.pl			Create symbol export lists for linking
 makedepend.SH			Precursor to makedepend
-makedir.SH			Precursor to makedir
 make_ext.pl			Used by Makefile to execute extension Makefiles
 Makefile.micro			microperl Makefile
 Makefile.SH			A script that generates Makefile
@@ -3437,13 +3687,6 @@
 mg.h				Magic header
 minimod.pl			Writes lib/ExtUtils/Miniperl.pm
 miniperlmain.c			Basic perl w/o dynamic loading or extensions
-mint/errno.h			MiNT port
-mint/Makefile			MiNT port
-mint/pwd.c			MiNT port
-mint/README			MiNT port
-mint/stdio.h			MiNT port
-mint/sys/time.h			MiNT port
-mint/time.h			MiNT port
 mkppport			A script that distributes ppport.h
 mkppport.lst			List of extensions that need a ppport.h
 mpeix/mpeix.c			MPE/iX port
@@ -3524,51 +3767,51 @@
 os2/os2add.sym			Overriding symbols to export
 os2/os2_base.t			Additional tests for builtin methods
 os2/os2.c			Additional code for OS/2
-os2/OS2/ExtAttr/Changes		EA access module
-os2/OS2/ExtAttr/ExtAttr.pm	EA access module
-os2/OS2/ExtAttr/ExtAttr.xs	EA access module
-os2/OS2/ExtAttr/Makefile.PL	EA access module
-os2/OS2/ExtAttr/MANIFEST	EA access module
-os2/OS2/ExtAttr/myea.h		EA access module
-os2/OS2/ExtAttr/t/os2_ea.t	EA access module
-os2/OS2/ExtAttr/typemap		EA access module
 os2/os2ish.h			Header for OS/2
+os2/OS2/OS2-ExtAttr/Changes	EA access module
+os2/OS2/OS2-ExtAttr/ExtAttr.pm	EA access module
+os2/OS2/OS2-ExtAttr/ExtAttr.xs	EA access module
+os2/OS2/OS2-ExtAttr/Makefile.PL	EA access module
+os2/OS2/OS2-ExtAttr/MANIFEST	EA access module
+os2/OS2/OS2-ExtAttr/myea.h	EA access module
+os2/OS2/OS2-ExtAttr/t/os2_ea.t	EA access module
+os2/OS2/OS2-ExtAttr/typemap	EA access module
+os2/OS2/OS2-PrfDB/Changes	System database access module
+os2/OS2/OS2-PrfDB/Makefile.PL	System database access module
+os2/OS2/OS2-PrfDB/MANIFEST	System database access module
+os2/OS2/OS2-PrfDB/PrfDB.pm	System database access module
+os2/OS2/OS2-PrfDB/PrfDB.xs	System database access module
+os2/OS2/OS2-PrfDB/t/os2_prfdb.t	System database access module
+os2/OS2/OS2-Process/Makefile.PL	system() constants in a module
+os2/OS2/OS2-Process/MANIFEST	system() constants in a module
+os2/OS2/OS2-Process/Process.pm	system() constants in a module
+os2/OS2/OS2-Process/Process.xs	system() constants in a module
+os2/OS2/OS2-Process/t/os2_atoms.t	Test for OS2::Process
+os2/OS2/OS2-Process/t/os2_clipboard.t	Test for OS2::Process
+os2/OS2/OS2-Process/t/os2_process_kid.t	Tests
+os2/OS2/OS2-Process/t/os2_process.t	Tests
+os2/OS2/OS2-Process/t/os2_process_text.t	Tests
+os2/OS2/OS2-REXX/Changes		DLL access module
+os2/OS2/OS2-REXX/DLL/Changes	DLL access module
+os2/OS2/OS2-REXX/DLL/DLL.pm	DLL access module
+os2/OS2/OS2-REXX/DLL/DLL.xs	DLL access module
+os2/OS2/OS2-REXX/DLL/Makefile.PL	DLL access module
+os2/OS2/OS2-REXX/DLL/MANIFEST	DLL access module
+os2/OS2/OS2-REXX/Makefile.PL	DLL access module
+os2/OS2/OS2-REXX/MANIFEST	DLL access module
+os2/OS2/OS2-REXX/REXX.pm	DLL access module
+os2/OS2/OS2-REXX/REXX.xs	DLL access module
+os2/OS2/OS2-REXX/t/rx_cmprt.t	DLL access module
+os2/OS2/OS2-REXX/t/rx_dllld.t	DLL access module
+os2/OS2/OS2-REXX/t/rx_emxrv.t	DLL access module
+os2/OS2/OS2-REXX/t/rx_objcall.t	DLL access module
+os2/OS2/OS2-REXX/t/rx_sql.test	DLL access module
+os2/OS2/OS2-REXX/t/rx_tiesql.test	DLL access module
+os2/OS2/OS2-REXX/t/rx_tievar.t	DLL access module
+os2/OS2/OS2-REXX/t/rx_tieydb.t	DLL access module
+os2/OS2/OS2-REXX/t/rx_varset.t	DLL access module
+os2/OS2/OS2-REXX/t/rx_vrexx.t	DLL access module
 os2/os2_pipe.t			Tests for pipe creation logic
-os2/OS2/PrfDB/Changes		System database access module
-os2/OS2/PrfDB/Makefile.PL	System database access module
-os2/OS2/PrfDB/MANIFEST		System database access module
-os2/OS2/PrfDB/PrfDB.pm		System database access module
-os2/OS2/PrfDB/PrfDB.xs		System database access module
-os2/OS2/PrfDB/t/os2_prfdb.t	System database access module
-os2/OS2/Process/Makefile.PL	system() constants in a module
-os2/OS2/Process/MANIFEST	system() constants in a module
-os2/OS2/Process/Process.pm	system() constants in a module
-os2/OS2/Process/Process.xs	system() constants in a module
-os2/OS2/Process/t/os2_atoms.t		Test for OS2::Process
-os2/OS2/Process/t/os2_clipboard.t	Test for OS2::Process
-os2/OS2/Process/t/os2_process_kid.t	Tests
-os2/OS2/Process/t/os2_process.t	Tests
-os2/OS2/Process/t/os2_process_text.t	Tests
-os2/OS2/REXX/Changes		DLL access module
-os2/OS2/REXX/DLL/Changes	DLL access module
-os2/OS2/REXX/DLL/DLL.pm		DLL access module
-os2/OS2/REXX/DLL/DLL.xs		DLL access module
-os2/OS2/REXX/DLL/Makefile.PL	DLL access module
-os2/OS2/REXX/DLL/MANIFEST	DLL access module
-os2/OS2/REXX/Makefile.PL	DLL access module
-os2/OS2/REXX/MANIFEST		DLL access module
-os2/OS2/REXX/REXX.pm		DLL access module
-os2/OS2/REXX/REXX.xs		DLL access module
-os2/OS2/REXX/t/rx_cmprt.t	DLL access module
-os2/OS2/REXX/t/rx_dllld.t	DLL access module
-os2/OS2/REXX/t/rx_emxrv.t	DLL access module
-os2/OS2/REXX/t/rx_objcall.t	DLL access module
-os2/OS2/REXX/t/rx_sql.test	DLL access module
-os2/OS2/REXX/t/rx_tiesql.test	DLL access module
-os2/OS2/REXX/t/rx_tievar.t	DLL access module
-os2/OS2/REXX/t/rx_tieydb.t	DLL access module
-os2/OS2/REXX/t/rx_varset.t	DLL access module
-os2/OS2/REXX/t/rx_vrexx.t	DLL access module
 os2/os2.sym			Additional symbols to export
 os2/os2thread.h			pthread-like typedefs
 os2/OS2/typemap			Common typemap for OS/2 types
@@ -3623,6 +3866,15 @@
 pod/perl5005delta.pod		Perl changes in version 5.005
 pod/perl5100delta.pod		Perl changes in version 5.10.0
 pod/perl5101delta.pod		Perl changes in version 5.10.1
+pod/perl5110delta.pod		Perl changes in version 5.11.0
+pod/perl5111delta.pod		Perl changes in version 5.11.1
+pod/perl5112delta.pod		Perl changes in version 5.11.2
+pod/perl5113delta.pod		Perl changes in version 5.11.3
+pod/perl5114delta.pod		Perl changes in version 5.11.4
+pod/perl5115delta.pod		Perl changes in version 5.11.5
+pod/perl5120delta.pod		Perl changes in version 5.12.0
+pod/perl5121delta.pod		Perl changes in version 5.12.1
+pod/perl5122delta.pod		Perl changes in version 5.12.2
 pod/perl561delta.pod		Perl changes in version 5.6.1
 pod/perl56delta.pod		Perl changes in version 5.6
 pod/perl570delta.pod		Perl changes in version 5.7.0
@@ -3700,12 +3952,12 @@
 pod/perlobj.pod			Perl objects
 pod/perlopentut.pod		Perl open() tutorial
 pod/perlop.pod			Perl operators and precedence
-pod/perlothrtut.pod		Old Perl threads tutorial
 pod/perlpacktut.pod		Perl pack() and unpack() tutorial
 pod/perlperf.pod		Perl Performance and Optimization Techniques
 pod/perl.pod			Perl overview (this section)
 pod/perlpod.pod			Perl plain old documentation
 pod/perlpodspec.pod		Perl plain old documentation format specification
+pod/perlpolicy.pod		Perl development policies
 pod/perlport.pod		Perl portability guide
 pod/perlpragma.pod		Perl modules: writing a user pragma
 pod/perlreapi.pod		Perl regular expression plugin interface
@@ -3750,53 +4002,54 @@
 pod/rofftoc			Generate a table of contents in troff format
 pod/splitman			Splits perlfunc into multiple man pages
 pod/splitpod			Splits perlfunc into multiple pod pages
-Policy_sh.SH		Hold site-wide preferences between Configure runs.
-Porting/add-package.pl	Add/Update CPAN modules that are part of Core
+Policy_sh.SH			Hold site-wide preferences between Configure runs.
+Porting/add-package.pl		Add/Update CPAN modules that are part of Core
 Porting/bump-perl-version	bump the perl version in relevant files
-Porting/check83.pl	Check whether we are 8.3-friendly
-Porting/checkansi.pl	Check source code for ANSI-C violations
-Porting/checkARGS_ASSERT.pl	Check we use every PERL_ARGS_ASSERT* macro
-Porting/checkAUTHORS.pl	Check that the AUTHORS file is complete
-Porting/checkcase.pl	Check whether we are case-insensitive-fs-friendly
-Porting/checkcfgvar.pl	Check that config scripts define all symbols
-Porting/checkURL.pl	Check whether we have working URLs
-Porting/checkVERSION.pl	Check whether we have $VERSIONs
-Porting/cmpVERSION.pl	Compare whether two trees have changed modules
-Porting/config_H	Sample config.h
-Porting/config_h.pl	Reorder config_h.SH after metaconfig
-Porting/config.sh	Sample config.sh
-Porting/Contract	Social contract for contributed modules in Perl core
-Porting/core-cpan-diff	Compare core distros with their CPAN equivalents
-Porting/corecpan.pl	Reports outdated dual-lived modules
-Porting/corelist.pl	Generates data for Module::CoreList
-Porting/curliff.pl	Curliff or liff your curliffable files.
-Porting/expand-macro.pl	A tool to expand C macro definitions in the Perl source
-Porting/findrfuncs	Find reentrant variants of functions used in an executable
-Porting/findvars	Find occurrences of words
-Porting/fixCORE		Find and fix modules that generate warnings
-Porting/fixvars		Find undeclared variables with C compiler and fix em
-Porting/genlog		Generate formatted changelogs by querying p4d
+Porting/check83.pl		Check whether we are 8.3-friendly
+Porting/checkansi.pl		Check source code for ANSI-C violations
+Porting/checkAUTHORS.pl		Check that the AUTHORS file is complete
+Porting/checkcfgvar.pl		Check that config scripts define all symbols
+Porting/check-cpan-pollution	Check for commits that may wrongly touch CPAN distros
+Porting/checkURL.pl		Check whether we have working URLs
+Porting/checkVERSION.pl		Check whether we have $VERSIONs
+Porting/cmpVERSION.pl		Compare whether two trees have changed modules
+Porting/config_H		Sample config.h
+Porting/config_h.pl		Reorder config_h.SH after metaconfig
+Porting/config.sh		Sample config.sh
+Porting/core-cpan-diff		Compare core distros with their CPAN equivalents
+Porting/corecpan.pl		Reports outdated dual-lived modules
+Porting/corelist-diff		Tool to produce corelist diffs
+Porting/corelist-perldelta.pl	Generates data perldelta from Module::CoreList
+Porting/corelist.pl		Generates data for Module::CoreList
+Porting/curliff.pl		Curliff or liff your curliffable files.
+Porting/expand-macro.pl		A tool to expand C macro definitions in the Perl source
+Porting/findrfuncs		Find reentrant variants of functions used in an executable
+Porting/findvars		Find occurrences of words
+Porting/fixCORE			Find and fix modules that generate warnings
+Porting/fixvars			Find undeclared variables with C compiler and fix em
+Porting/genlog			Generate formatted changelogs by querying p4d
 Porting/git-find-p4-change	Find the change for a p4 change number
 Porting/git-make-p4-refs	Output git refs for each p4 change number, suitable for appending to .git/packed-refs
-Porting/GitUtils.pm	Generate the contents of a .patch file
-Porting/Glossary	Glossary of config.sh variables
+Porting/GitUtils.pm		Generate the contents of a .patch file
+Porting/Glossary		Glossary of config.sh variables
 Porting/how_to_write_a_perldelta.pod	Bluffer's guide to writing a perldelta.
-Porting/Maintainers	Program to pretty print info in Maintainers.pl
-Porting/Maintainers.pl	Information about maintainers
-Porting/Maintainers.pm	Library to pretty print info in Maintainers.pl
+Porting/Maintainers		Program to pretty print info in Maintainers.pl
+Porting/Maintainers.pl		Information about maintainers
+Porting/Maintainers.pm		Library to pretty print info in Maintainers.pl
 Porting/make_dot_patch.pl	Make a .patch file from a git WD
-Porting/makemeta	Create the top-level META.yml
-Porting/makerel		Release making utility
+Porting/makemeta		Create the top-level META.yml
+Porting/makerel			Release making utility
 Porting/make_snapshot.pl	Make a tgz snapshot of our tree with a .patch file in it
-Porting/manicheck	Check against MANIFEST
-Porting/manisort	Sort the MANIFEST
-Porting/mergelog	log of merges from bleed to maint
-Porting/mergelog-tool	tool to process mergelog
-Porting/podtidy		Reformat pod using Pod::Tidy
-Porting/pumpkin.pod	Guidelines and hints for Perl maintainers
-Porting/README.y2038	Perl notes for the 2038 fix
-Porting/regcharclass.pl	Generate regcharclass.h from inline data
+Porting/manicheck		Check against MANIFEST
+Porting/manisort		Sort the MANIFEST
+Porting/newtests-perldelta.pl	Generate Perldelta stub for newly added tests
+Porting/perldelta_template.pod	Template for creating new perldelta.pod files
+Porting/podtidy			Reformat pod using Pod::Tidy
+Porting/pumpkin.pod		Guidelines and hints for Perl maintainers
+Porting/README.y2038		Perl notes for the 2038 fix
+Porting/regcharclass.pl		Generate regcharclass.h from inline data
 Porting/release_managers_guide.pod	Release Manager's Guide
+Porting/release_schedule.pod	Schedule for future releases
 Porting/sort_perldiag.pl	Keep our diagnostics orderly
 Porting/testall.atom		Cumulative profile with Third Degree
 Porting/thirdclean		Cleanup Third Degree reports
@@ -3836,11 +4089,9 @@
 README.jp			Perl for Japanese (in EUC-JP)
 README.ko			Perl for Korean (in EUC-KR)
 README.linux			Perl notes for Linux
-README.machten			Perl notes for Power MachTen
 README.macos			Perl notes for Mac OS (Classic)
 README.macosx			Perl notes for Mac OS X
 README.micro			Notes about microperl
-README.mint			Perl notes for MiNT
 README.mpeix			Perl notes for MPE/iX
 README.netware			Perl notes for NetWare
 README.openbsd			Perl notes for OpenBSD
@@ -3874,6 +4125,7 @@
 regexp.h			Public declarations for the above
 regnodes.h			Description of nodes of RE engine
 run.c				The interpreter loop
+runtests.SH			A script that generates runtests
 scope.c				Scope entry and exit code
 scope.h				Scope entry and exit header
 sv.c				Scalar value code
@@ -3919,7 +4171,7 @@
 symbian/sdk.pl			Helper code for config.pl
 symbian/sisify.pl		Packaging utility
 symbian/symbian_dll.cpp		The DLL stub for Symbian
-symbian/symbianish.h		Header for Symbian	
+symbian/symbianish.h		Header for Symbian
 symbian/symbian_proto.h		Prototypes for Symbian
 symbian/symbian_stubs.c		Stub routines for Symbian
 symbian/symbian_stubs.h		Stub headers for Symbian
@@ -3936,6 +4188,7 @@
 t/base/pat.t			See if pattern matching works
 t/base/rs.t			See if record-read works
 t/base/term.t			See if various terms work
+t/benchmark/rt26188-speed-up-keys-on-empty-hash.t	Benchmark if keys on empty hashes is fast enough
 t/cmd/elsif.t			See if else-if works
 t/cmd/for.t			See if for loops work
 t/cmd/mod.t			See if statement modifiers work
@@ -3945,11 +4198,14 @@
 t/comp/bproto.t			See if builtins conform to their prototypes
 t/comp/cmdopt.t			See if command optimization works
 t/comp/colon.t			See if colons are parsed correctly
-t/comp/cpp.aux			main file for cpp.t
-t/comp/cpp.t			See if C preprocessor works
 t/comp/decl.t			See if declarations work
+t/comp/final_line_num.t		See if line numbers are correct at EOF
 t/comp/fold.t			See if constant folding works
+t/comp/form_scope.t		See if format scoping works
+t/comp/hints.aux		Auxillary file for %^H test
 t/comp/hints.t			See if %^H works
+t/comp/line_debug_0.aux		Auxiliary file for @{"_<$file"} test
+t/comp/line_debug.t		See if @{"_<$file"} works
 t/comp/multiline.t		See if multiline strings work
 t/comp/opsubs.t			See if q() etc. are not parsed as functions
 t/comp/our.t			Tests for our declaration
@@ -3959,18 +4215,22 @@
 t/comp/redef.t			See if we get correct warnings on redefined subs
 t/comp/require.t		See if require works
 t/comp/retainedlines.t		See if the debugger can retain eval's lines
-t/comp/script.t			See if script invocation works
 t/comp/term.t			See if more terms work
 t/comp/uproto.t			See if the _ prototype works
 t/comp/use.t			See if pragmata work
 t/comp/utf.t			See if UTFs work
+TestInit.pm			Preamble library for tests
 t/harness			Finer diagnostics from test suite
 thread.h			Threading header
+time64.c			64 bit clean time.h (code)
+time64_config.h			64 bit clean time.h (configuration)
+time64.h			64 bit clean time.h (header)
 t/io/argv.t			See if ARGV stuff works
 t/io/binmode.t			See if binmode() works
 t/io/crlf.t			See if :crlf works
 t/io/crlf_through.t		See if pipe passes data intact with :crlf
 t/io/dup.t			See if >& works right
+t/io/errno.t			See if $! is correctly set
 t/io/fflush.t			See if auto-flush on fork/exec/system/qx works
 t/io/fs.t			See if directory manipulations work
 t/io/inplace.t			See if inplace editing works
@@ -3997,98 +4257,32 @@
 t/lib/common.pl			Helper for lib/{warnings,feature}.t
 t/lib/commonsense.t		See if configuration meets basic needs
 t/lib/compmod.pl		Helper for 1_compile.t
-t/lib/compress/any.pl		Compress::Zlib
-t/lib/compress/anyunc.pl	Compress::Zlib
-t/lib/compress/CompTestUtils.pm	Compress::Zlib
-t/lib/compress/destroy.pl	Compress::Zlib
-t/lib/compress/encode.pl	Compress::Zlib
-t/lib/compress/generic.pl	Compress::Zlib
-t/lib/compress/merge.pl		Compress::Zlib
-t/lib/compress/multi.pl		Compress::Zlib
-t/lib/compress/newtied.pl	Compress::Zlib
-t/lib/compress/oneshot.pl	Compress::Zlib
-t/lib/compress/prime.pl		Compress::Zlib
-t/lib/compress/tied.pl		Compress::Zlib
-t/lib/compress/truncate.pl	Compress::Zlib
-t/lib/compress/zlib-generic.pl	Compress::Zlib
-t/lib/contains_bad_pod.xr	Pod-Parser test file
-t/lib/contains_pod.xr		Pod-Parser test file
+t/lib/croak.t			Test calls to Perl_croak() in the C source.
 t/lib/cygwin.t			Builtin cygwin function tests
+t/lib/deprecate/Deprecated.pm	Deprecated module to test deprecate.pm
+t/lib/deprecate/Optionally.pm	Optionally deprecated module to test deprecate.pm
+t/lib/deprecate.t		Test deprecate.pm
 t/lib/Devel/switchd.pm		Module for t/run/switchd.t
-t/lib/Dev/Null.pm		Test::More test module
-t/lib/dprof/test1_t		Perl code profiler tests
-t/lib/dprof/test1_v		Perl code profiler tests
-t/lib/dprof/test2_t		Perl code profiler tests
-t/lib/dprof/test2_v		Perl code profiler tests
-t/lib/dprof/test3_t		Perl code profiler tests
-t/lib/dprof/test3_v		Perl code profiler tests
-t/lib/dprof/test4_t		Perl code profiler tests
-t/lib/dprof/test4_v		Perl code profiler tests
-t/lib/dprof/test5_t		Perl code profiler tests
-t/lib/dprof/test5_v		Perl code profiler tests
-t/lib/dprof/test6_t		Perl code profiler tests
-t/lib/dprof/test6_v		Perl code profiler tests
-t/lib/dprof/test7_t		Perl code profiler tests
-t/lib/dprof/test7_v		Perl code profiler tests
-t/lib/dprof/test8_t		Perl code profiler tests
-t/lib/dprof/test8_v		Perl code profiler tests
-t/lib/dprof/V.pm		Perl code profiler tests
 t/lib/feature/bundle		Tests for feature bundles
 t/lib/feature/implicit		Tests for implicit loading of feature.pm
 t/lib/feature/nonesuch		Tests for enabling/disabling nonexistent feature
 t/lib/feature/say		Tests for enabling/disabling say feature
 t/lib/feature/switch		Tests for enabling/disabling switch feature
-t/lib/Filter/Simple/ExportTest.pm	Helper file for Filter::Simple tests
-t/lib/Filter/Simple/FilterOnlyTest.pm	Helper file for Filter::Simple tests
-t/lib/Filter/Simple/FilterTest.pm	Helper file for Filter::Simple tests
-t/lib/Filter/Simple/ImportTest.pm	Helper file for Filter::Simple tests
-t/lib/filter-util.pl		See if Filter::Util::Call works
 t/lib/h2ph.h			Test header file for h2ph
 t/lib/h2ph.pht			Generated output from h2ph.h by h2ph, for comparison
 t/lib/locale/latin1		Part of locale.t in Latin 1
 t/lib/locale/utf8		Part of locale.t in UTF8
-t/lib/MakeMaker/Test/NoXS.pm		MakeMaker test utilities
-t/lib/MakeMaker/Test/Setup/BFD.pm	MakeMaker test utilities
-t/lib/MakeMaker/Test/Setup/MPV.pm	MakeMaker test utilities
-t/lib/MakeMaker/Test/Setup/PL_FILES.pm	MakeMaker test utilities
-t/lib/MakeMaker/Test/Setup/Problem.pm	MakeMaker test utilities
-t/lib/MakeMaker/Test/Setup/Recurs.pm	MakeMaker test utilities
-t/lib/MakeMaker/Test/Setup/XS.pm	MakeMaker test utilities
-t/lib/MakeMaker/Test/Utils.pm	MakeMaker test utilities
-t/lib/manifest.t		Test that this MANIFEST file is well formed
-t/lib/Math/BigFloat/Subclass.pm	Empty subclass of BigFloat for test
-t/lib/Math/BigInt/BareCalc.pm	Bigint's simulation of Calc
-t/lib/Math/BigInt/Scalar.pm	Pure Perl module to support Math::BigInt
-t/lib/Math/BigInt/Subclass.pm	Empty subclass of BigInt for test
-t/lib/Math/BigRat/Test.pm		Math::BigRat test helper
 t/lib/mypragma.pm		An example user pragma
 t/lib/mypragma.t		Test the example user pragma
 t/lib/no_load.t			Test that some modules don't load others
-t/lib/Parse/CPAN/Meta/Test.pm	Parse::CPAN::Meta testing library
+t/lib/overload_fallback.t	Test that using overload 2x in a scope doesn't clobber fallback
 t/lib/proxy_constant_subs.t	Test that Proxy Constant Subs behave correctly
-t/lib/Sans_mypragma.pm			Test module for t/lib/mypragma.t
+t/lib/Sans_mypragma.pm		Test module for t/lib/mypragma.t
 t/lib/strict/refs		Tests of "use strict 'refs'" for strict.t
 t/lib/strict/subs		Tests of "use strict 'subs'" for strict.t
 t/lib/strict/vars		Tests of "use strict 'vars'" for strict.t
-t/lib/Test/Builder/NoOutput.pm	Utility module for testing Test::Builder
-t/lib/Test/Simple/Catch.pm	Utility module for testing Test::Simple
-t/lib/Test/Simple/sample_tests/death_in_eval.plx	for exit.t
-t/lib/Test/Simple/sample_tests/death.plx		for exit.t
-t/lib/Test/Simple/sample_tests/death_with_handler.plx	for exit.t
-t/lib/Test/Simple/sample_tests/death_with_handler.plx	for exit.t
-t/lib/Test/Simple/sample_tests/exit.plx			for exit.t
-t/lib/Test/Simple/sample_tests/extras.plx		for exit.t
-t/lib/Test/Simple/sample_tests/five_fail.plx		for exit.t
-t/lib/Test/Simple/sample_tests/last_minute_death.plx	for exit.t
-t/lib/Test/Simple/sample_tests/one_fail.plx		for exit.t
-t/lib/Test/Simple/sample_tests/pre_plan_death.plx		for exit.t
-t/lib/Test/Simple/sample_tests/require.plx		for exit.t
-t/lib/Test/Simple/sample_tests/success.plx		for exit.t
-t/lib/Test/Simple/sample_tests/too_few_fail.plx		for exit.t
-t/lib/Test/Simple/sample_tests/too_few.plx		for exit.t
-t/lib/Test/Simple/sample_tests/two_fail.plx		for exit.t
-t/lib/TieIn.pm			Testing library for dummy input handles
-t/lib/TieOut.pm			Testing library to capture prints
+t/lib/test_use_14937.pm		A test pragma for t/comp/use.t
+t/lib/test_use.pm		A test pragma for t/comp/use.t
 t/lib/warnings/1global		Tests of global warnings for warnings.t
 t/lib/warnings/2use		Tests for "use warnings" for warnings.t
 t/lib/warnings/3both		Tests for interaction of $^W and "use warnings"
@@ -4142,6 +4336,8 @@
 t/mro/dbic_c3.t			mro tests
 t/mro/dbic_dfs.t		mro tests
 t/mro/inconsistent_c3.t		mro tests
+t/mro/isa_c3.t			test for optimisatised mro_get_linear_isa_c3
+t/mro/isa_dfs.t			test for optimisatised mro_get_linear_isa_dfs
 t/mro/method_caching.t		mro tests
 t/mro/next_edgecases.t		mro tests
 t/mro/next_goto.t		mro tests
@@ -4153,7 +4349,7 @@
 t/mro/overload_c3.t		mro tests
 t/mro/overload_dfs.t		mro tests
 t/mro/package_aliases.t		mro tests
-t/mro/pkg_gen.t		mro tests
+t/mro/pkg_gen.t			mro tests
 t/mro/recursion_c3.t		mro tests
 t/mro/recursion_dfs.t		mro tests
 t/mro/vulcan_c3.t		mro tests
@@ -4165,6 +4361,8 @@
 t/op/append.t			See if . works
 t/op/args.t			See if operations on @_ work
 t/op/arith.t			See if arithmetic works
+t/op/array_base.aux		Auxiliary file for the $[ test
+t/op/array_base.t		Tests for the $[, which is deprecated
 t/op/array.t			See if array operations work
 t/op/assignwarn.t		See if OP= operators warn correctly for undef targets
 t/op/attrhand.t			See if attribute handlers work
@@ -4194,13 +4392,16 @@
 t/op/die.t			See if die works
 t/op/dor.t			See if defined-or (//) works
 t/op/do.t			See if subroutines work
+t/op/each_array.t		See if array iterators work
 t/op/each.t			See if hash iterators work
 t/op/eval.t			See if eval operator works
 t/op/exec.t			See if exec, system and qx work
 t/op/exists_sub.t		See if exists(&sub) works
 t/op/exp.t			See if math functions work
 t/op/fh.t			See if filehandles work
+t/op/filehandle.t		Tests for http://rt.perl.org/rt3/Ticket/Display.html?id=72586
 t/op/filetest.t			See if file tests work
+t/op/filetest_t.t		See if -t file test works
 t/op/flip.t			See if range operator works
 t/op/fork.t			See if fork works
 t/op/getpid.t			See if $$ and getppid work with threads
@@ -4229,6 +4430,7 @@
 t/op/lc_user.t			See if user-defined lc et alia work
 t/op/length.t			See if length works
 t/op/lex_assign.t		See if ops involving lexicals or pad temps work
+t/op/lex.t			Tests too complex for t/base/lex.t
 t/op/lfs.t			See if large files work for perlio
 t/op/list.t			See if array lists work
 t/op/localref.t			See if local ${deref} works
@@ -4247,18 +4449,16 @@
 t/op/oct.t			See if oct and hex work
 t/op/ord.t			See if ord works
 t/op/or.t			See if || works in weird situations
-t/op/overload_integer.t			See if overload::constant for integer works after "use".   
+t/op/overload_integer.t		See if overload::constant for integer works after "use".
 t/op/override.t			See if operator overriding works
+t/op/packagev.t			See if package VERSION work
 t/op/pack.t			See if pack and unpack work
-t/op/pat.t			See if esoteric patterns work
-t/op/pat_thr.t			See if esoteric patterns work in another thread
 t/op/pos.t			See if pos works
 t/op/pow.t			See if ** works
+t/op/protowarn.t		See if the illegalproto warnings work
 t/op/push.t			See if push and pop work
 t/op/pwent.t			See if getpw*() functions work
 t/op/qq.t			See if qq works
-t/op/qr_gc.t			See if qr doesn't leak
-t/op/qrstack.t			See if qr expands the stack properly
 t/op/qr.t			See if qr works
 t/op/quotemeta.t		See if quotemeta works
 t/op/rand.t			See if rand works
@@ -4268,31 +4468,10 @@
 t/op/read.t			See if read() works
 t/op/recurse.t			See if deep recursion works
 t/op/ref.t			See if refs and objects work
-t/op/reg_email.t		See if regex recursion works by parsing email addresses
-t/op/reg_email_thr.t		See if regex recursion works by parsing email addresses in another thread
-t/op/regexp_noamp.t		See if regular expressions work with optimizations
-t/op/regexp_notrie.t		See if regular expressions work without trie optimisation
-t/op/regexp_qr_embed.t		See if regular expressions work with embedded qr//
-t/op/regexp_qr_embed_thr.t	See if regular expressions work with embedded qr// in another thread
-t/op/regexp_qr.t		See if regular expressions work as qr//
-t/op/regexp.t			See if regular expressions work
-t/op/regexp_trielist.t		See if regular expressions work with trie optimisation
-t/op/regexp_unicode_prop.t	See if unicode properties work in regular expressions as expected
-t/op/regexp_unicode_prop_thr.t	See if unicode properties work in regular expressions as expected under threads
-t/op/reg_fold.t			See if case folding works properly
-t/op/reg_mesg.t			See if one can get regular expression errors
-t/op/reg_namedcapture.t		Make sure glob assignment doesn't break named capture
-t/op/reg_nc_tie.t		Test the tied methods of Tie::Hash::NamedCapture
-t/op/reg_pmod.t			See if regexp /p modifier works as expected
-t/op/reg_posixcc.t		See if posix character classes behave consistantly
-t/op/reg_unsafe.t		Check for unsafe match vars
 t/op/repeat.t			See if x operator works
 t/op/reset.t			See if reset operator works
-t/op/re.t			See if exportable 're' funcs in universal.c work
-t/op/re_tests			Regular expressions for regexp.t
 t/op/reverse.t			See if reverse operator works
 t/op/runlevel.t			See if die() works from perl_call_*()
-t/op/rxcode.t			See if /(?{ code })/ works
 t/op/setpgrpstack.t		See if setpgrp works
 t/op/sleep.t			See if sleep works
 t/op/smartmatch.t		See if the ~~ operator works
@@ -4309,12 +4488,6 @@
 t/op/study.t			See if study works
 t/op/studytied.t		See if study works with tied scalars
 t/op/sub_lval.t			See if lvalue subroutines work
-t/op/subst_amp.t		See if $&-related substitution works
-t/op/substr.t			See if substr works
-t/op/substr_thr.t		See if substr works in another thread
-t/op/subst.t			See if substitution works
-t/op/substT.t			See if substitution works with -T
-t/op/subst_wamp.t		See if substitution works with $& present
 t/op/sub.t			See if subroutines work
 t/op/switch.t			See if switches (given/when) work
 t/op/symbolcache.t		See if undef/delete works on stashes with functions
@@ -4325,67 +4498,84 @@
 t/op/tiearray.t			See if tie for arrays works
 t/op/tiehandle.t		See if tie for handles works
 t/op/tie.t			See if tie/untie functions work
+t/op/time_loop.t		Test that very large values don't hang gmtime and localtime.
 t/op/time.t			See if time functions work
 t/op/tr.t			See if tr works
 t/op/undef.t			See if undef works
 t/op/universal.t		See if UNIVERSAL class works
 t/op/unshift.t			See if unshift works
 t/op/upgrade.t			See if upgrading and assigning scalars works
+t/op/utf8cache.t		Tests malfunctions of utf8 cache
 t/op/utf8decode.t		See if UTF-8 decoding works
+t/op/utf8magic.t		See if utf8:: functions handle magic variables
 t/op/utfhash.t			See if utf8 keys in hashes behave
 t/op/utftaint.t			See if utf8 and taint work together
 t/op/vec.t			See if vectors work
 t/op/ver.t			See if v-strings and the %v format flag work
 t/op/wantarray.t		See if wantarray works
+t/op/while_readdir.t		See if while(readdir) works
 t/op/write.t			See if write works (formats work)
+t/op/yadayada.t			See if ... works
 t/perl.supp			Perl valgrind suppressions
-t/pod/emptycmd.t		Test empty pod directives
-t/pod/emptycmd.xr		Expected results for emptycmd.t
-t/pod/find.t			See if Pod::Find works
-t/pod/for.t			Test =for directive
-t/pod/for.xr			Expected results for for.t
-t/pod/headings.t		Test =head directives
-t/pod/headings.xr		Expected results for headings.t
-t/pod/included.t		Test =include directive
-t/pod/included.xr		Expected results for included.t
-t/pod/include.t			Test =include directive
-t/pod/include.xr		Expected results for include.t
-t/pod/lref.t			Test L<...> sequences
-t/pod/lref.xr			Expected results for lref.t
-t/pod/multiline_items.t		Test multiline =items
-t/pod/multiline_items.xr	Expected results for multiline_items.t
-t/pod/nested_items.t		Test nested =items
-t/pod/nested_items.xr		Expected results for nested_items.t
-t/pod/nested_seqs.t		Test nested interior sequences
-t/pod/nested_seqs.xr		Expected results for nested_seqs.t
-t/pod/oneline_cmds.t		Test single paragraph ==cmds
-t/pod/oneline_cmds.xr		Expected results for oneline_cmds.t
-t/pod/p2u_data.pl		Test Pod::Usage
-t/pod/plainer.t			Test Pod::Plainer
-t/pod/pod2usage2.t		Test Pod::Usage
-t/pod/pod2usage.t		Test Pod::Usage
-t/pod/pod2usage.xr		Expected results for pod2usage.t
-t/pod/podchkenc.t		Validate =encoding support
-t/pod/podchkenc.xr		Expected results for the above
-t/pod/poderrs.t			Test POD errors
-t/pod/poderrs.xr		Expected results for poderrs.t
-t/pod/podselect.t		Test Pod::Select
-t/pod/podselect.xr		Expected results for podselect.t
-t/pod/special_seqs.t		Test "special" interior sequences
-t/pod/special_seqs.xr		Expected results for special_seqs.t
-t/pod/testcmp.pl		Module to compare output against expected results
-t/pod/testp2pt.pl		Module to test Pod::PlainText for a given file
-t/pod/testpchk.pl		Module to test Pod::Checker for a given file
-t/pod/testpods/lib/Pod/Stuff.pm		Sample data for t/pod/find.t
-t/pod/twice.t			Test Pod::Parser
-t/pod/usage2.pod		Test POD for pod2usage tests
-t/pod/usage.pod			Test POD for pod2usage tests
+t/porting/args_assert.t		Check that all PERL_ARGS_ASSERT* macros are used
+t/porting/checkcase.t		Check whether we are case-insensitive-fs-friendly
+t/porting/diag.t		Test completeness of perldiag.pod
+t/porting/maintainers.t		Test that Porting/Maintaners.pl is up to date
+t/porting/manifest.t		Test that this MANIFEST file is well formed
+t/porting/podcheck.t		Test the POD of shipped modules is well formed
+t/porting/test_bootstrap.t	Test that the instructions for test bootstrapping aren't accidentally overlooked.
 t/README			Instructions for regression tests
+t/re/pat_advanced.t		See if advanced esoteric patterns work
+t/re/pat_advanced_thr.t		See if advanced esoteric patterns work in another thread
+t/re/pat_psycho.t		See if insane esoteric and slow patterns work
+t/re/pat_psycho_thr.t		See if insane esoteric and slow patterns work in another thread
+t/re/pat_re_eval.t		See if esoteric patterns using re 'eval' work
+t/re/pat_re_eval_thr.t		See if esoteric patterns using re 'eval' work in another thread
+t/re/pat_rt_report.t		See if esoteric patterns from rt reports work
+t/re/pat_rt_report_thr.t	See if esoteric patterns from rt reports work in another thread
+t/re/pat_special_cc.t		See if special charclasses (\s \w \d) work the same as (\s and [\s])
+t/re/pat_special_cc_thr.t	See if special charclasses (\s \w \d) work the same as (\s and [\s]) under threads
+t/re/pat.t			See if esoteric patterns work
+t/re/pat_thr.t			See if esoteric patterns work in another thread
+t/re/qr_gc.t			See if qr doesn't leak
+t/re/qrstack.t			See if qr expands the stack properly
+t/re/qr.t			See if qr works
+t/re/reg_60508.t		See if bug #60508 is fixed
+t/re/reg_email.t		See if regex recursion works by parsing email addresses
+t/re/reg_email_thr.t		See if regex recursion works by parsing email addresses in another thread
+t/re/regexp_noamp.t		See if regular expressions work with optimizations
+t/re/regexp_notrie.t		See if regular expressions work without trie optimisation
+t/re/regexp_qr_embed.t		See if regular expressions work with embedded qr//
+t/re/regexp_qr_embed_thr.t	See if regular expressions work with embedded qr// in another thread
+t/re/regexp_qr.t		See if regular expressions work as qr//
+t/re/regexp.t			See if regular expressions work
+t/re/regexp_trielist.t		See if regular expressions work with trie optimisation
+t/re/regexp_unicode_prop.t	See if unicode properties work in regular expressions as expected
+t/re/regexp_unicode_prop_thr.t	See if unicode properties work in regular expressions as expected under threads
+t/re/reg_fold.t			See if case folding works properly
+t/re/reg_mesg.t			See if one can get regular expression errors
+t/re/reg_namedcapture.t		Make sure glob assignment doesn't break named capture
+t/re/reg_nc_tie.t		Test the tied methods of Tie::Hash::NamedCapture
+t/re/reg_pmod.t			See if regexp /p modifier works as expected
+t/re/reg_posixcc.t		See if posix character classes behave consistantly
+t/re/reg_unsafe.t		Check for unsafe match vars
+t/re/re.t			See if exportable 're' funcs in universal.c work
+t/re/ReTest.pl			Test utilities for the t/re/pat*.t tests (used by do)
+t/re/re_tests			Regular expressions for regexp.t
+t/re/rxcode.t			See if /(?{ code })/ works
+t/re/subst_amp.t		See if $&-related substitution works
+t/re/substr.t			See if substr works
+t/re/substr_thr.t		See if substr works in another thread
+t/re/subst.t			See if substitution works
+t/re/substT.t			See if substitution works with -T
+t/re/subst_wamp.t		See if substitution works with $& present
+t/re/uniprops.t			Test unicode \p{} regex constructs
 t/run/cloexec.t			Test close-on-exec.
 t/run/exit.t			Test perl's exit status.
 t/run/fresh_perl.t		Tests that require a fresh perl.
 t/run/noswitch.t		Test aliasing ARGV for other switch tests
 t/run/runenv.t			Test if perl honors its environment variables.
+t/run/script.t			See if script invocation works
 t/run/switch0.t			Test the -0 switch
 t/run/switcha.t			Test the -a switch
 t/run/switchC.t			Test the -C switch
@@ -4396,14 +4586,11 @@
 t/run/switchI.t			Test the -I switch
 t/run/switchn.t			Test the -n switch
 t/run/switchp.t			Test the -p switch
-t/run/switchPx.aux		Data for switchPx.t
-t/run/switchPx.t		Test the -Px combination
 t/run/switcht.t			Test the -t switch
 t/run/switchx2.aux		Data for switchx.t
 t/run/switchx.aux		Data for switchx.t
 t/run/switchx.t			Test the -x switch
 t/TEST				The regression tester
-t/TestInit.pm			Preamble library for core tests
 t/test.pl			Simple testing library
 t/thread_it.pl			Run regression tests in a new thread
 t/uni/cache.t			See if Unicode swash caching works
@@ -4441,10 +4628,10 @@
 utils/c2ph.PL			program to translate dbx stabs to perl
 utils/config_data.PL		Module::Build tool
 utils/corelist.PL		Module::CoreList
-utils/cpan2dist.PL	the cpan2dist utility
+utils/cpan2dist.PL		the cpan2dist utility
 utils/cpan.PL			easily interact with CPAN from the command line
-utils/cpanp.PL	the cpanp utility
-utils/cpanp-run-perl.PL	the cpanp-run-perl utility
+utils/cpanp.PL			the cpanp utility
+utils/cpanp-run-perl.PL		the cpanp-run-perl utility
 utils/dprofpp.PL		Perl code profile post-processor
 utils/enc2xs.PL			Encode module generator
 utils/h2ph.PL			A thing to turn C .h files into perl .ph files
@@ -4467,23 +4654,12 @@
 utils/xsubpp.PL			External subroutine preprocessor
 uts/sprintf_wrap.c		sprintf wrapper for UTS
 uts/strtol_wrap.c		strtol wrapper for UTS
-uupacktool.pl			Pack/unpack files to the .packed format
 vmesa/Makefile			VM/ESA Makefile
 vmesa/vmesa.c			VM/ESA-specific C code for Perl core
 vmesa/vmesaish.h		VM/ESA-specific C header for Perl core
 vms/descrip_mms.template	Template MM[SK] description file for build
-vms/ext/DCLsym/0README.txt	ReadMe file for VMS::DCLsym
-vms/ext/DCLsym/DCLsym.pm	Perl access to CLI symbols
-vms/ext/DCLsym/DCLsym.xs	Perl access to CLI symbols
-vms/ext/DCLsym/Makefile.PL	MakeMaker driver for VMS::DCLsym
-vms/ext/DCLsym/test.pl		regression tests for VMS::DCLsym
 vms/ext/Filespec.pm		VMS-Unix file syntax interconversion
 vms/ext/filespec.t		See if VMS::Filespec functions work
-vms/ext/Stdio/0README.txt	ReadMe file for VMS::Stdio
-vms/ext/Stdio/Makefile.PL	MakeMaker driver for VMS::Stdio
-vms/ext/Stdio/Stdio.pm		VMS options to stdio routines
-vms/ext/Stdio/Stdio.xs		VMS options to stdio routines
-vms/ext/Stdio/test.pl		regression tests for VMS::Stdio
 vms/genopt.com			hack to write options files in case of broken makes
 vms/gen_shrfls.pl		generate options files and glue for shareable image
 vms/make_command.com		record MM[SK] command used to build Perl
@@ -4519,10 +4695,14 @@
 win32/ce-helpers/registry.bat	WinCE port
 win32/config.bc			Win32 base line config.sh (Borland C++ build)
 win32/config.ce			WinCE port
-win32/config.gc			Win32 base line config.sh (mingw32/gcc build)
+win32/config.gc			Win32 base line config.sh (MinGW build)
+win32/config.gc64		Win64 base line config.sh (MinGW build)
+win32/config.gc64nox		Win64 base line config.sh (MinGW build)
 win32/config_H.bc		Win32 config header (Borland C++ build)
 win32/config_H.ce		WinCE port
-win32/config_H.gc		Win32 config header (GNU build)?
+win32/config_H.gc		Win32 config header (MinGW build)
+win32/config_H.gc64		Win64 config header (MinGW build)
+win32/config_H.gc64nox		Win64 config header (MinGW build)
 win32/config_h.PL		Perl code to convert Win32 config.sh to config.h
 win32/config_H.vc		Win32 config header (Visual C++ build)
 win32/config_H.vc64		Win64 config header (Visual C++ build)
@@ -4531,7 +4711,6 @@
 win32/config.vc64		Win64 base line config.sh (Visual C++ build)
 win32/create_perllibst_h.pl	creates perllibst.h file for inclusion from perllib.c
 win32/distclean.bat		Remove _ALL_ files not listed here in MANIFEST
-win32/dl_win32.xs		Win32 port
 win32/fcrypt.c			crypt() implementation
 win32/FindExt.pm		Scan for extensions
 win32/FindExt.t			Test FindExt.pm
@@ -4545,7 +4724,8 @@
 win32/Makefile.ce		WinCE port
 win32/makefile.mk		Win32 makefile for DMAKE (BC++, VC++ builds)
 win32/mdelete.bat		multifile delete
-win32/perlexe.ico.packd		uupacktool.pl packed perlexe.ico image file, 'packd' ext is deliberate!
+win32/perlexe.ico		perlexe.ico image file
+win32/perlexe.manifest		Assembly manifest file
 win32/perlexe.rc		associated perl binary with icon
 win32/perlglob.c		Win32 port
 win32/perlhost.h		Perl "host" implementation
@@ -4554,7 +4734,6 @@
 win32/perl.rc			WinCE port
 win32/pod.mak			Win32 port
 win32/runperl.c			Win32 port
-win32/splittree.pl		Win32 port
 win32/sync_ext.pl		Win32 port
 win32/vdir.h			Perl "host" virtual directory manager for CE
 win32/vmem.h			Perl "host" memory manager for CE
@@ -4590,4 +4769,3 @@
 x2p/util.h			Public declarations for the above
 x2p/walk.c			Parse tree walker
 XSUB.h				Include file for extension subroutines
-xsutils.c			Additional bundled package methods not in UNIVERSAL::
Index: src/gnu/usr.bin/perl/Makefile.SH
diff -u src/gnu/usr.bin/perl/Makefile.SH:1.19 src/gnu/usr.bin/perl/Makefile.SH:1.20
--- Makefile.SH:1.19	Thu May 20 19:26:32 2010
+++ Makefile.SH	Fri Sep 24 15:06:39 2010
@@ -1,4 +1,3 @@
-#! /bin/sh
 case $PERL_CONFIG_SH in
 '')
 	if test -f config.sh
@@ -41,11 +40,6 @@
 */*) cd `expr X$0 : 'X\(.*\)/'` ;;
 esac
 
-case "$d_dosuid" in
-*define*) suidperl='suidperl' ;;
-*) suidperl='';;
-esac
-
 linklibperl='$(LIBPERL)'
 linklibperl_nonshr=''
 shrpldflags='$(LDDLFLAGS)'
@@ -186,6 +180,7 @@
 
 : Prepare dependency lists for Makefile.
 dynamic_list=' '
+dynamic_ext_re="lib/auto/re/re.$dlext"
 extra_dep=''
 for f in $dynamic_ext; do
     : the dependency named here will never exist
@@ -195,10 +190,14 @@
 
     : Parallel makes reveal that we have some interdependencies
     case $f in
+	Encode|POSIX|SDBM_File) extra_dep="$extra_dep
+$this_target: lib/auto/Cwd/Cwd.$dlext" ;;
 	Math/BigInt/FastCalc|Devel/NYTProf) extra_dep="$extra_dep
 $this_target: lib/auto/List/Util/Util.$dlext" ;;
 	Unicode/Normalize) extra_dep="$extra_dep
 $this_target: uni.data" ;;
+	Text/ParseWords) extra_dep="$extra_dep
+$this_target: lib/auto/Scalar/Util.$dlext" ;;
     esac
 done
 
@@ -219,7 +218,11 @@
 nonxs_list=' '
 for f in $nonxs_ext; do
     p=`echo "$f" | tr / -`
-    nonxs_list="$nonxs_list ext/$p/pm_to_blib"
+    for d in ext dist cpan; do
+	if test -d $d/$p; then
+	    nonxs_list="$nonxs_list $d/$p/pm_to_blib"
+	fi
+    done
 done
 
 dtrace_h=''
@@ -303,8 +306,20 @@
 OBJ_EXT = $_o
 PATH_SEP = $p_
 
-#
+# Macros to invoke a copy of miniperl during the build.  Targets which
+# are built using these macros should depend on \$(MINIPERL_EXE)
+MINIPERL_EXE = miniperl\$(EXE_EXT)
+MINIPERL = \$(LDLIBPTH) \$(RUN) ./miniperl\$(EXE_EXT) -Ilib
+
+# Macros to invoke a copy of our fully operational perl during the build.
+PERL_EXE = perl\$(EXE_EXT)
+RUN_PERL = \$(LDLIBPTH) \$(RUN) ./perl\$(EXE_EXT)
+
+# Macros to run our tests
+RUN_TESTS = \$(LDLIBPTH) ./runtests
+
 dynamic_ext = $dynamic_list
+dynamic_ext_re = $dynamic_ext_re
 static_ext = $static_list
 nonxs_ext = $nonxs_list
 ext = \$(dynamic_ext) \$(static_ext) \$(nonxs_ext)
@@ -312,7 +327,7 @@
 
 libs = $perllibs $cryptlib
 
-public = perl\$(EXE_EXT) $suidperl utilities translators
+public = \$(PERL_EXE) utilities translators
 
 shellflags = $shellflags
 
@@ -418,7 +433,7 @@
 # Files to be built with variable substitution before miniperl
 # is available.
 sh = Makefile.SH cflags.SH config_h.SH makeaperl.SH makedepend.SH \
-	makedir.SH myconfig.SH writemain.SH pod/Makefile.SH
+	myconfig.SH writemain.SH pod/Makefile.SH
 
 shextract = Makefile cflags config.h makeaperl makedepend \
 	makedir myconfig writemain pod/Makefile
@@ -429,16 +444,15 @@
 pl = pod/pod2html.PL pod/pod2latex.PL pod/pod2man.PL pod/pod2text.PL \
 	pod/pod2usage.PL pod/podchecker.PL pod/podselect.PL
 
-# lib/lib.pm is not listed here because it has a rule of its own.
 plextract = pod/pod2html pod/pod2latex pod/pod2man pod/pod2text \
 	pod/pod2usage pod/podchecker pod/podselect
 
-addedbyconf = UU $(shextract) $(plextract) lib/lib.pm pstruct
+addedbyconf = UU $(shextract) $(plextract) pstruct
 
 # Unicode data files generated by mktables
-unidatafiles = lib/unicore/Canonical.pl lib/unicore/Exact.pl \
-	lib/unicore/Properties lib/unicore/Decomposition.pl \
-	lib/unicore/CombiningClass.pl lib/unicore/Name.pl lib/unicore/PVA.pl
+unidatafiles = lib/unicore/Decomposition.pl lib/unicore/TestProp.pl \
+	lib/unicore/CombiningClass.pl lib/unicore/Name.pl \
+	lib/unicore/Heavy.pl lib/unicore/mktables.lst
 
 # Directories of Unicode data files generated by mktables
 unidatadirs = lib/unicore/To lib/unicore/lib
@@ -452,7 +466,7 @@
 
 c1 = av.c scope.c op.c doop.c doio.c dump.c gv.c hv.c mg.c reentr.c mro.c perl.c
 c2 = perly.c pp.c pp_hot.c pp_ctl.c pp_sys.c regcomp.c regexec.c utf8.c sv.c
-c3 = taint.c toke.c util.c deb.c run.c universal.c xsutils.c pad.c globals.c
+c3 = taint.c toke.c util.c deb.c run.c universal.c pad.c globals.c
 c4 = perlio.c perlapi.c numeric.c mathoms.c locale.c pp_pack.c pp_sort.c
 c5 = $(madlysrc) $(mallocsrc)
 
@@ -461,15 +475,17 @@
 obj0 = op$(OBJ_EXT) perl$(OBJ_EXT)
 obj1 = $(madlyobj) $(mallocobj) gv$(OBJ_EXT) toke$(OBJ_EXT) perly$(OBJ_EXT) pad$(OBJ_EXT) regcomp$(OBJ_EXT) dump$(OBJ_EXT) util$(OBJ_EXT) mg$(OBJ_EXT) reentr$(OBJ_EXT) mro$(OBJ_EXT)
 obj2 = hv$(OBJ_EXT) av$(OBJ_EXT) run$(OBJ_EXT) pp_hot$(OBJ_EXT) sv$(OBJ_EXT) pp$(OBJ_EXT) scope$(OBJ_EXT) pp_ctl$(OBJ_EXT) pp_sys$(OBJ_EXT)
-obj3 = doop$(OBJ_EXT) doio$(OBJ_EXT) regexec$(OBJ_EXT) utf8$(OBJ_EXT) taint$(OBJ_EXT) deb$(OBJ_EXT) universal$(OBJ_EXT) xsutils$(OBJ_EXT) globals$(OBJ_EXT) perlio$(OBJ_EXT) perlapi$(OBJ_EXT) numeric$(OBJ_EXT) mathoms$(OBJ_EXT) locale$(OBJ_EXT) pp_pack$(OBJ_EXT) pp_sort$(OBJ_EXT)
+obj3 = doop$(OBJ_EXT) doio$(OBJ_EXT) regexec$(OBJ_EXT) utf8$(OBJ_EXT) taint$(OBJ_EXT) deb$(OBJ_EXT) universal$(OBJ_EXT) globals$(OBJ_EXT) perlio$(OBJ_EXT) perlapi$(OBJ_EXT) numeric$(OBJ_EXT) mathoms$(OBJ_EXT) locale$(OBJ_EXT) pp_pack$(OBJ_EXT) pp_sort$(OBJ_EXT)
 
-mini_obj =  $(obj1) $(obj2) $(obj3) $(ARCHOBJS)
+mini_obj =  $(obj1) $(obj2) $(obj3) $(ARCHOBJS) $(DTRACE_O)
 ndt_obj = $(obj0) $(obj1) $(obj2) $(obj3) $(ARCHOBJS)
 obj = $(ndt_obj) $(DTRACE_O)
 
-perltoc_pod_prereqs = extra.pods pod/perlapi.pod pod/perldelta.pod pod/perlintern.pod pod/perlmodlib.pod
+perltoc_pod_prereqs = extra.pods pod/perlapi.pod pod/perldelta.pod pod/perlintern.pod pod/perlmodlib.pod pod/perluniprops.pod
 generated_pods = pod/perltoc.pod $(perltoc_pod_prereqs)
 
+Icwd = -Icpan/Cwd -Icpan/Cwd/lib
+
 lintflags = \
     -b \
     -n \
@@ -537,33 +553,27 @@
 .c.s:
 	$(CCCMDSRC) -S $*.c
 
-all: $(FIRSTMAKEFILE) miniperl$(EXE_EXT) miniperl $(generated_pods) $(private) $(unidatafiles) $(public) $(dynamic_ext) $(nonxs_ext) extras.make
+all: $(FIRSTMAKEFILE) $(MINIPERL_EXE) miniperl $(generated_pods) $(private) $(unidatafiles) $(public) $(dynamic_ext) $(nonxs_ext) extras.make
 	@echo " ";
 	@echo "	Everything is up to date. Type '$(MAKE) test' to run test suite."
 
-sperl$(OBJ_EXT): perl.c $(h)
-	$(RMS) sperl.c
-	$(LNS) perl.c sperl.c
-	$(CCCMD) -DIAMSUID sperl.c
-	$(RMS) sperl.c
-
-sperl.i: perl.c $(h)
-	$(CCCMDSRC) -DIAMSUID -E perl.c > sperl.i
-
 .PHONY: all translators utilities
 
-# We use pre-generated lib/Config_git.pl and git_version.h files
-#lib/Config_git.pl git_version.h: miniperl$(EXE_EXT) make_patchnum.pl
-#	$(LDLIBPTH) $(RUN) ./miniperl$(EXE_EXT) -Ilib make_patchnum.pl
+# OpenBSD uses pre-generated lib/Config_git.pl and git_version.h files
+# Both git_version.h and lib/Config_git.pl are built
+# by make_patchnum.pl.
+#git_version.h: lib/Config_git.pl
+#
+#lib/Config_git.pl: $(MINIPERL_EXE) make_patchnum.pl
+#	$(MINIPERL) make_patchnum.pl
 
 # make sure that we recompile perl.c if the git version changes
 perl$(OBJ_EXT): git_version.h
-sperl$(OBJ_EXT): git_version.h
 
-translators:	miniperl$(EXE_EXT) $(CONFIGPM) FORCE
+translators:	$(MINIPERL_EXE) $(CONFIGPM) $(dynamic_ext) FORCE
 	@echo " "; echo "	Making x2p stuff"; cd x2p; $(LDLIBPTH) $(MAKE) all
 
-utilities:	miniperl$(EXE_EXT) $(CONFIGPM) $(plextract) lib/lib.pm FORCE
+utilities:	$(MINIPERL_EXE) $(CONFIGPM) $(plextract) FORCE
 	@echo " "; echo "	Making utilities"; cd utils; $(LDLIBPTH) $(MAKE) all
 
 
@@ -596,10 +606,12 @@
 perlmini\$(OBJ_EXT): perlmini.c
 	\$(CCCMD) \$(PLDLFLAGS) $DPERL_IS_MINIPERL perlmini.c
 
-globals\$(OBJ_EXT): uudmap.h
+globals\$(OBJ_EXT): uudmap.h bitcount.h
+
+uudmap.h: bitcount.h
 
-uudmap.h: generate_uudmap\$(HOST_EXE_EXT)
-	\$(RUN) ./generate_uudmap\$(HOST_EXE_EXT) >uudmap.h
+bitcount.h: generate_uudmap\$(HOST_EXE_EXT)
+	\$(RUN) ./generate_uudmap\$(HOST_EXE_EXT) uudmap.h bitcount.h
 
 generate_uudmap\$(HOST_EXE_EXT): generate_uudmap\$(OBJ_EXT)
 	\$(CC) -o generate_uudmap\$(EXE_EXT) \$(LDFLAGS) generate_uudmap\$(OBJ_EXT) \$(libs)
@@ -665,7 +677,7 @@
 		;;
 	*)	
 		$spitshell >>$Makefile <<'!NO!SUBS!'
-MINIPERLEXP		= miniperl$(EXE_EXT)
+MINIPERLEXP		= $(MINIPERL_EXE)
 
 PERLEXPORT		= perl.exp
 
@@ -773,8 +785,8 @@
 	case "${osname}${osvers}" in
 	aix*|beos*)
 		$spitshell >>$Makefile <<'!NO!SUBS!'
-miniperl$(EXE_EXT): $& miniperlmain$(OBJ_EXT) $(mini_obj) opmini$(OBJ_EXT) perlmini$(OBJ_EXT)
-	$(CC) -o miniperl$(EXE_EXT) $(CLDFLAGS) \
+$(MINIPERL_EXE): $& miniperlmain$(OBJ_EXT) $(mini_obj) opmini$(OBJ_EXT) perlmini$(OBJ_EXT)
+	$(CC) -o $(MINIPERL_EXE) $(CLDFLAGS) \
 	    $(mini_obj) \
 	    miniperlmain$(OBJ_EXT) opmini$(OBJ_EXT) perlmini$(OBJ_EXT) $(libs)
 	$(LDLIBPTH) $(RUN) ./miniperl$(HOST_EXE_EXT) -w -Ilib -MExporter -e '<?>' || $(MAKE) minitest
@@ -782,8 +794,8 @@
 		;;
 	next4*)
 		$spitshell >>$Makefile <<'!NO!SUBS!'
-miniperl$(EXE_EXT): $& miniperlmain$(OBJ_EXT) $(mini_obj) perlmini$(OBJ_EXT) opmini$(OBJ_EXT)
-	$(CC) -o miniperl$(EXE_EXT) $(mini_obj) \
+$(MINIPERL_EXE): $& miniperlmain$(OBJ_EXT) $(mini_obj) perlmini$(OBJ_EXT) opmini$(OBJ_EXT)
+	$(CC) -o $(MINIPERL_EXE) $(mini_obj) \
 	    miniperlmain$(OBJ_EXT) opmini$(OBJ_EXT) perlmini$(OBJ_EXT) $(libs)
 	$(LDLIBPTH) $(RUN) ./miniperl$(HOST_EXE_EXT) -w -Ilib -MExporter -e '<?>' || $(MAKE) minitest
 !NO!SUBS!
@@ -802,9 +814,9 @@
 		    ;;
 		esac
 		$spitshell >>$Makefile <<'!NO!SUBS!'
-miniperl$(EXE_EXT): $& miniperlmain$(OBJ_EXT) $(mini_obj) opmini$(OBJ_EXT) perlmini$(OBJ_EXT)
+$(MINIPERL_EXE): $& miniperlmain$(OBJ_EXT) $(mini_obj) opmini$(OBJ_EXT) perlmini$(OBJ_EXT)
 	-@rm -f miniperl.xok
-	$(CC) $(CLDFLAGS) $(NAMESPACEFLAGS) -o miniperl$(EXE_EXT) \
+	$(CC) $(CLDFLAGS) $(NAMESPACEFLAGS) -o $(MINIPERL_EXE) \
 	    $(mini_obj) \
 	    miniperlmain$(OBJ_EXT) opmini$(OBJ_EXT) perlmini$(OBJ_EXT) $(libs)
 	$(LDLIBPTH) $(RUN) ./miniperl$(HOST_EXE_EXT) -w -Ilib -MExporter -e '<?>' || $(MAKE) minitest
@@ -812,9 +824,9 @@
 		;;
 	*)
 		$spitshell >>$Makefile <<'!NO!SUBS!'
-miniperl$(EXE_EXT): $& miniperlmain$(OBJ_EXT) $(mini_obj) opmini$(OBJ_EXT) perlmini$(OBJ_EXT)
+$(MINIPERL_EXE): $& miniperlmain$(OBJ_EXT) $(mini_obj) opmini$(OBJ_EXT) perlmini$(OBJ_EXT)
 	-@rm -f miniperl.xok
-	$(LDLIBPTH) $(CC) $(CLDFLAGS) -o miniperl$(EXE_EXT) \
+	$(LDLIBPTH) $(CC) $(CLDFLAGS) -o $(MINIPERL_EXE) \
 	    $(mini_obj) \
 	    miniperlmain$(OBJ_EXT) opmini$(OBJ_EXT) perlmini$(OBJ_EXT) $(libs)
 	$(LDLIBPTH) $(RUN) ./miniperl$(HOST_EXE_EXT) -w -Ilib -MExporter -e '<?>' || $(MAKE) minitest
@@ -824,19 +836,19 @@
 
 	$spitshell >>$Makefile <<'!NO!SUBS!'
 
-perl$(EXE_EXT): $& perlmain$(OBJ_EXT) $(LIBPERL) $(static_ext) ext.libs $(PERLEXPORT)
+$(PERL_EXE): $& perlmain$(OBJ_EXT) $(LIBPERL) $(static_ext) ext.libs $(PERLEXPORT)
 	-@rm -f miniperl.xok
 	$(SHRPENV) $(LDLIBPTH) $(CC) -o perl$(PERL_SUFFIX) $(PERL_PROFILE_LDFLAGS) $(CLDFLAGS) $(CCDLFLAGS) perlmain$(OBJ_EXT) $(static_ext) $(LLIBPERL) `cat ext.libs` $(libs)
 
 # Purify/Quantify Perls.
 
-pureperl$(EXE_EXT): $& perlmain$(OBJ_EXT) $(LIBPERL) $(static_ext) ext.libs $(PERLEXPORT)
+pure$(PERL_EXE): $& perlmain$(OBJ_EXT) $(LIBPERL) $(static_ext) ext.libs $(PERLEXPORT)
 	$(SHRPENV) $(LDLIBPTH) purify $(CC) -o pureperl $(CLDFLAGS) $(CCDLFLAGS) perlmain$(OBJ_EXT) $(static_ext) $(LLIBPERL) `cat ext.libs` $(libs)
 
-purecovperl$(EXE_EXT): $& perlmain$(OBJ_EXT) $(LIBPERL) $(static_ext) ext.libs $(PERLEXPORT)
+purecov$(PERL_EXE): $& perlmain$(OBJ_EXT) $(LIBPERL) $(static_ext) ext.libs $(PERLEXPORT)
 	$(SHRPENV) $(LDLIBPTH) purecov $(CC) -o purecovperl $(CLDFLAGS) $(CCDLFLAGS) perlmain$(OBJ_EXT) $(static_ext) $(LLIBPERL) `cat ext.libs` $(libs)
 
-quantperl$(EXE_EXT): $& perlmain$(OBJ_EXT) $(LIBPERL) $(static_ext) ext.libs $(PERLEXPORT)
+quant$(PERL_EXE): $& perlmain$(OBJ_EXT) $(LIBPERL) $(static_ext) ext.libs $(PERLEXPORT)
 	$(SHRPENV) $(LDLIBPTH) quantify $(CC) -o quantperl $(CLDFLAGS) $(CCDLFLAGS) perlmain$(OBJ_EXT) $(static_ext) $(LLIBPERL) `cat ext.libs` $(libs)
 
 # Valgrind perl (currently Linux only)
@@ -929,29 +941,7 @@
 microperl:
 	$(MAKE) -f Makefile.micro
 
-# This version, if specified in Configure, does ONLY those scripts which need
-# set-id emulation.  Suidperl must be setuid root.  It contains the "taint"
-# checks as well as the special code to validate that the script in question
-# has been invoked correctly.
-
-!NO!SUBS!
-
-case "${osname}" in
-aix*)
-$spitshell >>$Makefile <<'!NO!SUBS!'
-suidperl$(EXE_EXT): $& sperl$(OBJ_EXT) perlmain$(OBJ_EXT) $(LIBPERL) $(static_ext) ext.libs $(PERLEXPORT)
-	$(SHRPENV) $(LDLIBPTH) $(CC) -o suidperl $(CLDFLAGS) $(CCDLFLAGS) perlmain$(OBJ_EXT) sperl$(OBJ_EXT) $(static_ext) $(LLIBPERL_NONSHR) $(LLIBPERL) `cat ext.libs` $(libs)
-
-!NO!SUBS!
-;;
-*)
-$spitshell >>$Makefile <<'!NO!SUBS!'
-suidperl$(EXE_EXT): $& sperl$(OBJ_EXT) perlmain$(OBJ_EXT) $(LIBPERL) $(static_ext) ext.libs $(PERLEXPORT)
-	$(SHRPENV) $(LDLIBPTH) $(CC) -o suidperl $(CLDFLAGS) $(CCDLFLAGS) perlmain$(OBJ_EXT) sperl$(OBJ_EXT) $(static_ext) $(LLIBPERL) `cat ext.libs` $(libs)
-
 !NO!SUBS!
-;;
-esac
 
 fi
 
@@ -961,9 +951,9 @@
 catamount)
 $spitshell >>$Makefile <<!GROK!THIS!
 .PHONY: makeppport
-makeppport: miniperl\$(EXE_EXT) \$(CONFIGPM)
+makeppport: \$(MINIPERL_EXE) \$(CONFIGPM)
 	-@for f in Makefile.PL PPPort_pm.PL PPPort_xs.PL ppport_h.PL; do \
-	(cd ext/Devel-PPPort && `pwd`/run.sh ../../miniperl$(EXE_EXT) -I../../lib \$\$f); \
+	(cd ext/Devel-PPPort && `pwd`/run.sh ../../$(MINIPERL_EXE) -I../../lib \$\$f); \
 	done
 
 !GROK!THIS!
@@ -971,8 +961,8 @@
 *)
 $spitshell >>$Makefile <<'!NO!SUBS!'
 .PHONY: makeppport
-makeppport: miniperl$(EXE_EXT) $(CONFIGPM)
-	$(LDLIBPTH) $(RUN) ./miniperl$(EXE_EXT) -Ilib mkppport
+makeppport: $(MINIPERL_EXE) $(CONFIGPM) $(nonxs_ext)
+	$(MINIPERL) $(Icwd) mkppport
 
 !NO!SUBS!
 ;;
@@ -980,60 +970,54 @@
 
 $spitshell >>$Makefile <<'!NO!SUBS!'
 
-# We have to call our ./makedir because Ultrix 4.3 make can't handle the line
-#	test -d lib/auto || mkdir lib/auto
-# We need to autosplit in two steps because VOS can't handle so many args
-#
 .PHONY: preplibrary
-preplibrary: miniperl$(EXE_EXT) $(CONFIGPM) lib/lib.pm $(PREPLIBRARY_LIBPERL)
-	@sh ./makedir lib/auto
-	@echo "	AutoSplitting perl library"
-	$(LDLIBPTH) $(RUN) ./miniperl$(EXE_EXT) -Ilib -MAutoSplit -MFile::Find -e 'find ({no_chdir=>1, wanted => sub {autosplit_lib_modules($$_) if /\.pm$$/}}, "lib")'
-	$(MAKE) lib/re.pm
+preplibrary: $(MINIPERL_EXE) $(CONFIGPM) lib/re.pm $(PREPLIBRARY_LIBPERL)
 
-$(CONFIGPM_FROM_CONFIG_SH) $(CONFIGPOD): config.sh miniperl$(EXE_EXT) configpm Porting/Glossary lib/Config_git.pl
-	$(LDLIBPTH) $(RUN) ./miniperl$(EXE_EXT) -Ilib configpm
+$(CONFIGPM_FROM_CONFIG_SH): $(CONFIGPOD)
 
-lib/ExtUtils/Miniperl.pm: miniperlmain.c miniperl$(EXE_EXT) minimod.pl $(CONFIGPM)
-	$(LDLIBPTH) $(RUN) ./miniperl$(EXE_EXT) minimod.pl > lib/ExtUtils/Miniperl.pm
+$(CONFIGPOD): config.sh $(MINIPERL_EXE) configpm Porting/Glossary lib/Config_git.pl
+	$(MINIPERL) configpm
+
+lib/ExtUtils/Miniperl.pm: miniperlmain.c $(MINIPERL_EXE) minimod.pl $(CONFIGPM)
+	$(MINIPERL) minimod.pl > lib/ExtUtils/Miniperl.pm
 
 lib/re.pm: ext/re/re.pm
 	@-rm -f $@
 	cp ext/re/re.pm lib/re.pm
 
-$(plextract):	miniperl$(EXE_EXT) $(CONFIGPM) x2p/s2p
+$(plextract):	$(MINIPERL_EXE) $(CONFIGPM) x2p/s2p $(dynamic_ext)
 	@-rm -f $@
-	$(LDLIBPTH) $(RUN) ./miniperl$(EXE_EXT) -I"`pwd`/lib" $@.PL
+	$(MINIPERL) $@.PL
 
-x2p/s2p: miniperl$(EXE_EXT) $(CONFIGPM) x2p/s2p.PL
+x2p/s2p: $(MINIPERL_EXE) $(CONFIGPM) $(dynamic_ext) x2p/s2p.PL
 	cd x2p; $(LDLIBPTH) $(MAKE) s2p
 
-lib/lib.pm:	miniperl$(EXE_EXT) $(CONFIGPM)
-	@-rm -f $@
-	$(LDLIBPTH) $(RUN) ./miniperl$(EXE_EXT) -Ilib lib/lib_pm.PL
-
-unidatafiles $(unidatafiles): uni.data
+unidatafiles $(unidatafiles) pod/perluniprops.pod: uni.data
 
-uni.data: miniperl$(EXE_EXT) $(CONFIGPM) lib/unicore/mktables
-	cd lib/unicore && $(LDLIBPTH) $(RUN) ../../miniperl$(EXE_EXT) -I../../lib mktables -w
-	touch uni.data
+uni.data: $(MINIPERL_EXE) $(CONFIGPM) lib/unicore/mktables $(nonxs_ext)
+	$(MINIPERL) $(Icwd) lib/unicore/mktables -C lib/unicore -P pod -maketest -makelist -p
+#	Commented out so always runs, mktables looks at far more files than we
+#	can in this makefile to decide if needs to run or not
+#	touch uni.data
 
-# perl$(EXE_EXT) and ext because buildtoc uses Text::Wrap uses re
+# $(PERL_EXE) and ext because buildtoc uses Text::Wrap uses re
 # But also this ensures that all extensions are built before we try to scan
 # them, which picks up Devel::PPPort's documentation.
-pod/perltoc.pod: $(perltoc_pod_prereqs) perl$(EXE_EXT) $(ext) pod/buildtoc
-	$(LDLIBPTH) $(RUN) ./perl$(EXE_EXT) -Ilib pod/buildtoc --build-toc -q
+pod/perltoc.pod: $(perltoc_pod_prereqs)  $(PERL_EXE) $(ext) pod/buildtoc
+	$(RUN_PERL) -f -Ilib pod/buildtoc --build-toc -q
 
-pod/perlapi.pod pod/perlintern.pod: miniperl$(EXE_EXT) autodoc.pl embed.fnc
-	$(LDLIBPTH) $(RUN) ./miniperl$(EXE_EXT) -Ilib autodoc.pl
+pod/perlapi.pod: pod/perlintern.pod
 
-pod/perlmodlib.pod: miniperl$(EXE_EXT) pod/perlmodlib.PL MANIFEST
-	$(LDLIBPTH) $(RUN) ./miniperl$(EXE_EXT) -Ilib pod/perlmodlib.PL -q
+pod/perlintern.pod: $(MINIPERL_EXE) autodoc.pl embed.fnc
+	$(MINIPERL) autodoc.pl
 
-pod/perldelta.pod: pod/perl5101delta.pod
-	$(LNS) perl5101delta.pod pod/perldelta.pod
+pod/perlmodlib.pod: $(MINIPERL_EXE) pod/perlmodlib.PL MANIFEST
+	$(MINIPERL) $(Icwd) pod/perlmodlib.PL -q
 
-extra.pods: miniperl$(EXE_EXT)
+pod/perldelta.pod: pod/perl5122delta.pod
+	$(LNS) perl5122delta.pod pod/perldelta.pod
+
+extra.pods: $(MINIPERL_EXE)
 	-@test ! -f extra.pods || rm -f `cat extra.pods`
 	-@rm -f extra.pods
 	-@for x in `grep -l '^=[a-z]' README.* | grep -v README.vms` ; do \
@@ -1042,20 +1026,20 @@
 	    echo "pod/perl"$$nx".pod" >> extra.pods ; \
 	done
 
-extras.make: perl$(EXE_EXT)
-	-@test ! -s extras.lst || PATH="`pwd`:${PATH}" PERL5LIB="`pwd`/lib" $(LDLIBPTH) $(RUN) ./perl -Ilib -MCPAN -e '@ARGV&&make(@ARGV)' `cat extras.lst`
+extras.make: $(PERL_EXE)
+	-@test ! -s extras.lst || PATH="`pwd`:${PATH}" PERL5LIB="`pwd`/lib" $(RUN_PERL) -Ilib -MCPAN -e '@ARGV&&make(@ARGV)' `cat extras.lst`
 
-extras.test: perl$(EXE_EXT)
-	-@test ! -s extras.lst || PATH="`pwd`:${PATH}" PERL5LIB="`pwd`/lib" $(LDLIBPTH) $(RUN) ./perl -Ilib -MCPAN -e '@ARGV&&test(@ARGV)' `cat extras.lst`
+extras.test: $(PERL_EXE)
+	-@test ! -s extras.lst || PATH="`pwd`:${PATH}" PERL5LIB="`pwd`/lib" $(RUN_PERL) -Ilib -MCPAN -e '@ARGV&&test(@ARGV)' `cat extras.lst`
 
-extras.install: perl$(EXE_EXT)
-	-@test ! -s extras.lst || PATH="`pwd`:${PATH}" PERL5LIB="`pwd`/lib" $(LDLIBPTH) $(RUN) ./perl -Ilib -MCPAN -e '@ARGV&&install(@ARGV)' `cat extras.lst`
+extras.install: $(PERL_EXE)
+	-@test ! -s extras.lst || PATH="`pwd`:${PATH}" PERL5LIB="`pwd`/lib" $(RUN_PERL) -Ilib -MCPAN -e '@ARGV&&install(@ARGV)' `cat extras.lst`
 
 .PHONY: install install-strip install-all install-verbose install-silent \
 	no-install install.perl install.man install.html
 
 META.yml:	Porting/makemeta Porting/Maintainers.pl Porting/Maintainers.pm
-	$(LDLIBPTH) $(RUN) ./miniperl$(EXE_EXT) -Ilib Porting/makemeta
+	PATH="`pwd`:${PATH}" PERL5LIB="`pwd`/lib" $(RUN_PERL) -Ilib Porting/makemeta
 
 install-strip:
 	$(MAKE) STRIPFLAGS=-s install DESTDIR="$(DESTDIR)"
@@ -1076,24 +1060,24 @@
 INSTALL_DEPENDENCE = all
 
 install.perl:	$(INSTALL_DEPENDENCE) installperl
-	$(LDLIBPTH) $(RUN) ./perl installperl --destdir=$(DESTDIR) $(INSTALLFLAGS) $(STRIPFLAGS)
+	$(RUN_PERL) installperl --destdir=$(DESTDIR) $(INSTALLFLAGS) $(STRIPFLAGS)
 	-@test ! -s extras.lst || $(MAKE) extras.install
 
 install.man:	all installman
-	$(LDLIBPTH) $(RUN) ./perl installman --destdir=$(DESTDIR) $(INSTALLFLAGS)
+	$(RUN_PERL) installman --destdir=$(DESTDIR) $(INSTALLFLAGS)
 
 # XXX Experimental. Hardwired values, but useful for testing.
 # Eventually Configure could ask for some of these values.
 install.html: all installhtml
 	-@test -f README.vms && cd vms && $(LNS) ../README.vms README_vms.pod && cd ..
-	$(LDLIBPTH) $(RUN) ./perl installhtml   \
+	$(RUN_PERL) installhtml   \
       --podroot=. --podpath=. --recurse  \
       --htmldir=$(privlib)/html   \
       --htmlroot=$(privlib)/html  \
       --splithead=pod/perlipc     \
       --splititem=pod/perlfunc    \
       --libpods=perlfunc:perlguts:perlvar:perlrun:perlop \
-      --ignore=Porting/Maintainers.pm,Porting/patching.pod,Porting/pumpkin.pod,Porting/repository.pod \
+      --ignore=Porting/Maintainers.pm,Porting/pumpkin.pod,Porting/repository.pod \
       --verbose
 
 
@@ -1177,17 +1161,17 @@
 #
 # DynaLoader may be needed for extensions that use Makefile.PL.
 
-$(DYNALOADER):	miniperl$(EXE_EXT) preplibrary FORCE
-	$(LDLIBPTH) $(RUN) ./miniperl$(EXE_EXT) -Ilib make_ext.pl $@ MAKE=$(MAKE) LIBPERL_A=$(LIBPERL) LINKTYPE=static $(STATIC_LDFLAGS)
+$(DYNALOADER):	$(MINIPERL_EXE) preplibrary FORCE $(nonxs_ext)
+	$(MINIPERL) make_ext.pl $@ MAKE=$(MAKE) LIBPERL_A=$(LIBPERL) LINKTYPE=static $(STATIC_LDFLAGS)
 
-d_dummy $(dynamic_ext):	miniperl$(EXE_EXT) preplibrary makeppport $(DYNALOADER) FORCE
-	$(LDLIBPTH) $(RUN) ./miniperl$(EXE_EXT) -Ilib make_ext.pl $@ MAKE=$(MAKE) LIBPERL_A=$(LIBPERL) LINKTYPE=dynamic
+d_dummy $(dynamic_ext):	$(MINIPERL_EXE) preplibrary makeppport $(DYNALOADER) FORCE $(PERLEXPORT)
+	$(MINIPERL) make_ext.pl $@ MAKE=$(MAKE) LIBPERL_A=$(LIBPERL) LINKTYPE=dynamic
 
-s_dummy $(static_ext):	miniperl$(EXE_EXT) preplibrary makeppport $(DYNALOADER) FORCE
-	$(LDLIBPTH) $(RUN) ./miniperl$(EXE_EXT) -Ilib make_ext.pl $@ MAKE=$(MAKE) LIBPERL_A=$(LIBPERL) LINKTYPE=static $(STATIC_LDFLAGS)
+s_dummy $(static_ext):	$(MINIPERL_EXE) preplibrary makeppport $(DYNALOADER) FORCE
+	$(MINIPERL) make_ext.pl $@ MAKE=$(MAKE) LIBPERL_A=$(LIBPERL) LINKTYPE=static $(STATIC_LDFLAGS)
 
-n_dummy $(nonxs_ext):	miniperl$(EXE_EXT) preplibrary FORCE
-	$(LDLIBPTH) $(RUN) ./miniperl$(EXE_EXT) -Ilib make_ext.pl $@ MAKE=$(MAKE) LIBPERL_A=$(LIBPERL)
+n_dummy $(nonxs_ext):	$(MINIPERL_EXE) preplibrary FORCE
+	$(MINIPERL) make_ext.pl $@ MAKE=$(MAKE) LIBPERL_A=$(LIBPERL)
 !NO!SUBS!
 
 $spitshell >>$Makefile <<EOF
@@ -1198,35 +1182,33 @@
 
 .PHONY: printconfig
 printconfig:
-	@eval `$(LDLIBPTH) $(RUN) ./perl -Ilib -V:$(CONFIGVAR)`; echo $$$(CONFIGVAR)
+	@eval `$(RUN_PERL) -Ilib -V:$(CONFIGVAR)`; echo $$$(CONFIGVAR)
 
 .PHONY: clean _tidy _mopup _cleaner1 _cleaner2 \
 	realclean _realcleaner clobber _clobber \
-	distclean veryclean _verycleaner \
-	cleanup_unpacked_files unpack_files
+	distclean veryclean _verycleaner
 
-clean:		cleanup_unpacked_files _tidy _mopup 
+clean:		_tidy _mopup 
 
-realclean:	cleanup_unpacked_files _realcleaner _mopup
+realclean:	_realcleaner _mopup
 	@echo "Note that '$(MAKE) realclean' does not delete config.sh or Policy.sh"
 
 _clobber:
 	-@rm -f Cross/run-* Cross/to-* Cross/from-*
 	rm -f t/test_state
 	rm -f config.sh cppstdin Policy.sh extras.lst
-	rm -f ext/Test-Harness/t/ext/Test-Harness/t/source_tests/harness
 
-clobber:	cleanup_unpacked_files _realcleaner _mopup _clobber
+clobber:	_realcleaner _mopup _clobber
 
 distclean:	clobber
 
 # Like distclean but also removes emacs backups and *.orig.
-veryclean:	cleanup_unpacked_files _verycleaner _mopup _clobber
+veryclean:	_verycleaner _mopup _clobber
 	-@rm -f Obsolete Wanted
 
 # Do not 'make _mopup' directly.
 _mopup:
-	rm -f *$(OBJ_EXT) *$(LIB_EXT) all perlmain.c opmini.c perlmini.c uudmap.h generate_uudmap$(EXE_EXT)
+	rm -f *$(OBJ_EXT) *$(LIB_EXT) all perlmain.c opmini.c perlmini.c uudmap.h generate_uudmap$(EXE_EXT) bitcount.h
 	-rmdir .depending
 	-@test -f extra.pods && rm -f `cat extra.pods`
 	-@test -f vms/README_vms.pod && rm -f vms/README_vms.pod
@@ -1237,9 +1219,9 @@
 	-rm -f perl.pixie lib*.so.perl.pixie lib*.so.Addrs
 	-rm -f perl.Addrs perl.Counts t/perl.Addrs t/perl.Counts *perl.xok
 	-rm -f cygwin.c libperl*.def libperl*.dll cygperl*.dll *.exe.stackdump
-	-rm -f perl$(EXE_EXT) suidperl$(EXE_EXT) miniperl$(EXE_EXT) $(LIBPERL) libperl.* microperl
+	-rm -f $(PERL_EXE) $(MINIPERL_EXE) $(LIBPERL) libperl.* microperl
 	-rm -f opcode.h-old opnames.h-old pp.sym-old pp_proto.h-old
-	-rm -f $(DTRACE_H)
+	-rm -f $(DTRACE_H) runtests
 
 # Do not 'make _tidy' directly.
 _tidy:
@@ -1247,7 +1229,7 @@
 	-cd utils; $(LDLIBPTH) $(MAKE) clean
 	-cd x2p; $(LDLIBPTH) $(MAKE) clean
 	-@for x in $(DYNALOADER) $(dynamic_ext) $(static_ext) $(nonxs_ext) ; do \
-	$(LDLIBPTH) $(RUN) ./miniperl$(EXE_EXT) -Ilib make_ext.pl --target=clean $$x MAKE=$(MAKE) ; \
+	$(MINIPERL) make_ext.pl --target=clean $$x MAKE=$(MAKE) ; \
 	done
 
 _cleaner1:
@@ -1255,21 +1237,24 @@
 	-cd pod; $(LDLIBPTH) $(MAKE) $(CLEAN)
 	-cd utils; $(LDLIBPTH) $(MAKE) $(CLEAN)
 	-cd x2p; $(LDLIBPTH) $(MAKE) $(CLEAN)
-	-@if test -f miniperl$(EXE_EXT) ; then \
+	-@if test -f $(MINIPERL_EXE) ; then \
 	for x in $(DYNALOADER) $(dynamic_ext) $(static_ext) $(nonxs_ext) ; do \
-	$(LDLIBPTH) $(RUN) ./miniperl$(EXE_EXT) -Ilib make_ext.pl --target=$(CLEAN) $$x MAKE=$(MAKE) ; \
+	$(MINIPERL) make_ext.pl --target=$(CLEAN) $$x MAKE=$(MAKE) ; \
 	done ; \
 	else \
 	sh $(CLEAN).sh ; \
 	fi
 	rm -f realclean.sh veryclean.sh
-	-@test ! -f ./miniperl$(EXE_EXT) || $(LDLIBPTH) $(RUN) ./miniperl$(EXE_EXT) -Ilib mkppport --clean
+	-for file in `find cpan dist ext -name ppport.h` ; do rm -f $$file; done
+
+# Dear POSIX, thanks for making the default to xargs to be
+# run once if nothhing is passed in. It is such a great help.
 
 # Some systems do not support "?", so keep these files separate.
 _cleaner2:
 	-rm -f core.*perl.*.? t/core.perl.*.? .?*.c
 	rm -f core *perl.core t/core t/*perl.core core.* t/core.*
-	rm -f t/misctmp* t/forktmp* t/tmp* t/c t/perl$(EXE_EXT) t/rantests
+	rm -f t/misctmp* t/forktmp* t/tmp* t/c t/$(PERL_EXE) t/rantests
 	rm -f so_locations $(LIBPERL_NONSHR) $(MINIPERL_NONSHR)
 	rm -rf $(addedbyconf)
 	rm -f $(FIRSTMAKEFILE) $(FIRSTMAKEFILE).old makefile.old
@@ -1288,17 +1273,39 @@
 	rm -f lib/ExtUtils/ParseXS/t/XSTest$(OBJ_EXT)
 	rm -f lib/ExtUtils/ParseXS/t/XSTest$(DLSUFFIX)
 	rm -fr lib/B
-	-rmdir lib/Data
-	-rmdir lib/Filter/Util lib/IO/Socket
-	-rmdir lib/List lib/MIME lib/Scalar lib/Sys
-	-rmdir lib/threads lib/XS
-	-rmdir lib/CPANPLUS/Dist/Build/t/dummy-*
-	-rmdir lib/CPANPLUS/t/dummy-cpanplus lib/CPANPLUS/t/dummy-localmirror
+	rm -fr lib/CPAN lib/CPANPLUS
+	rm -fr lib/ExtUtils/CBuilder
+	-rmdir cpan/CPANPLUS-Dist-Build/t/dummy-cpanplus cpan/CPANPLUS/t/dummy-cpanplus cpan/CPANPLUS/t/dummy-localmirror
+	-rmdir ext/B/lib
+	-rmdir lib/Archive/Tar lib/Archive lib/Attribute
+	-rmdir lib/CGI
+	-rmdir lib/Data lib/Devel lib/Digest
+	-rmdir lib/ExtUtils/Command lib/ExtUtils/Constant lib/ExtUtils/Liblist lib/ExtUtils/MakeMaker
+	-rmdir lib/File/Spec lib/Filter/Util lib/Filter
+	-rmdir lib/I18N/LangTags lib/IO/Socket lib/IO lib/IPC
+	-rmdir lib/List/Util lib/List
+	-rmdir lib/Locale/Maketext lib/Locale
+	-rmdir lib/Log/Message lib/Log
+	-rmdir lib/Math/Big* lib/Math
+	-rmdir lib/Memoize lib/MIME
+	-rmdir lib/Module/Build/Platform lib/Module/Build lib/Module/Load lib/Module
+	-rmdir lib/Net/FTP lib/Object
+	-rmdir lib/Parse/CPAN lib/Parse
+	-rmdir lib/PerlIO/via lib/PerlIO
+	-rmdir lib/Package lib/Params
+	-rmdir lib/Pod/Perldoc lib/Pod/Simple lib/Pod/Text
+	-rmdir lib/Sys lib/Scalar/Util lib/Scalar
+	-rmdir lib/Term/UI lib/Thread
+	-rmdir lib/Test/Builder/Tester lib/Test/Builder lib/Test
+	-rmdir lib/Unicode/Collate
+	-rmdir lib/XS/APItest lib/XS
+	-rmdir lib/inc/latest lib/inc
+	-rmdir lib/autodie/exception lib/autodie lib/encoding lib/threads
 	-rm -f lib/ExtUtils/CBuilder/t/libcompilet.dll.a
 	-rm -f lib/ExtUtils/ParseXS/t/libXSTest.dll.a
 
 _realcleaner:
-	@$(LDLIBPTH) $(MAKE) _cleaner1 CLEAN=realclean
+	@$(LDLIBPTH) $(MAKE) _cleaner1 CLEAN=distclean
 	@$(LDLIBPTH) $(MAKE) _cleaner2
 
 _verycleaner:
@@ -1338,65 +1345,49 @@
 makedepend: makedepend.SH config.sh
 	sh ./makedepend.SH
 
-.PHONY: test check test_prep test_prep_nodll test_prep_pre _test_prep \
-	test_tty test-tty _test_tty test_notty test-notty _test_notty \
+runtests: runtests.SH config.sh
+	sh ./runtests.SH
+
+.PHONY: test check test_prep test_prep_nodll test_prep_pre \
+	test_prep_reonly test_tty test-tty test_notty test-notty \
 	utest ucheck test.utf8 check.utf8 test.torture torturetest \
 	test.utf16 check.utf16 utest.utf16 ucheck.utf16 \
 	test.third check.third utest.third ucheck.third test_notty.third \
 	test.deparse test_notty.deparse test_harness test_harness_notty \
-	minitest coretest test.taintwarn test-reonly
+	minitest coretest test.taintwarn test-reonly _test
+
+_test:
+	echo >&2 The _test target is deprecated. Please upgrade your smoker
+	PERL=./perl $(RUN_TESTS) choose
 
 # Cannot delegate rebuilding of t/perl to make
 # to allow interlaced test and minitest
 
-TESTFILE=TEST
-
-_test_prep: unpack_files
-	cd t && (rm -f $(PERL)$(EXE_EXT); $(LNS) ../$(PERL)$(EXE_EXT) $(PERL)$(EXE_EXT))
-
 # Architecture-neutral stuff:
 
 test_prep_pre: preplibrary utilities $(nonxs_ext)
 
-test_prep: test_prep_pre miniperl$(EXE_EXT) $(unidatafiles) perl$(EXE_EXT) $(dynamic_ext) $(TEST_PERL_DLL)
-	PERL=./perl $(MAKE) _test_prep
-
-_test_tty:
-	cd t && $(PERL_DEBUG) $(LDLIBPTH) $(PERL) $(TESTFILE) $(TEST_ARGS) $(TEST_FILES) </dev/tty
-
-_test_notty:
-	cd t && $(PERL_DEBUG) PERL_SKIP_TTY_TEST=1 $(LDLIBPTH) $(PERL) $(TESTFILE) $(TEST_ARGS) $(TEST_FILES)
+test_prep: test_prep_pre $(MINIPERL_EXE) $(unidatafiles) $(PERL_EXE) $(dynamic_ext) $(TEST_PERL_DLL) runtests
+	cd t && (rm -f $(PERL_EXE); $(LNS) ../$(PERL_EXE) $(PERL_EXE))
 
-unpack_files:
-	$(LDLIBPTH) $(RUN) ./miniperl$(EXE_EXT) -Ilib uupacktool.pl -u -m
-
-cleanup_unpacked_files:
-	-@test ! -f ./miniperl$(EXE_EXT) || $(LDLIBPTH) $(RUN) ./miniperl$(EXE_EXT) -Ilib uupacktool.pl -c
-
-# The second branch is for testing without a tty or controlling terminal,
-# see t/op/stat.t
-_test:
-	if (true </dev/tty) >/dev/null 2>&1; then \
-	  $(MAKE) TEST_ARGS='$(TEST_ARGS)' TESTFILE=$(TESTFILE) _test_tty   ; \
-	else \
-	  $(MAKE) TEST_ARGS='$(TEST_ARGS)' TESTFILE=$(TESTFILE) _test_notty ; \
-	fi
-	@echo "Ran tests" > t/rantests
+test_prep_reonly: $(MINIPERL_EXE) $(PERL_EXE) $(dynamic_ext_re) $(TEST_PERL_DLL)
+	$(MINIPERL) make_ext.pl $(dynamic_ext_re) MAKE=$(MAKE) LIBPERL_A=$(LIBPERL) LINKTYPE=dynamic
+	cd t && (rm -f $(PERL_EXE); $(LNS) ../$(PERL_EXE) $(PERL_EXE))
 
 test check: test_prep
-	PERL=./perl $(MAKE) _test
+	$(RUN_TESTS) choose
 
 test_tty: test_prep
-	PERL=./perl $(MAKE) _test_tty
+	$(RUN_TESTS) tty
 
 test_notty: test_prep
-	PERL=./perl $(MAKE) _test_notty
+	$(RUN_TESTS) no-tty
 
 utest ucheck test.utf8 check.utf8: test_prep
-	PERL=./perl TEST_ARGS=-utf8 $(MAKE) _test
+	TEST_ARGS=-utf8 $(RUN_TESTS) choose
 
 coretest: test_prep
-	PERL=./perl TEST_ARGS=-core $(MAKE) _test
+	TEST_ARGS=-core $(RUN_TESTS) choose
 
 test-prep:	test_prep
 
@@ -1407,85 +1398,89 @@
 # Torture testing
 
 test.torture torturetest:	test_prep
-	PERL=./perl TEST_ARGS=-torture $(MAKE) _test
+	TEST_ARGS=-torture $(RUN_TESTS) choose
 
 # Targets for UTF16 testing:
 
 minitest.utf16: minitest.prep
-	- cd t && (rm -f perl$(EXE_EXT); $(LNS) ../miniperl$(EXE_EXT) perl$(EXE_EXT)) \
-		&& $(LDLIBPTH) $(RUN) ./perl TEST -minitest -utf16 base/*.t comp/*.t cmd/*.t run/*.t io/*.t op/*.t uni/*.t </dev/tty
+	- cd t && (rm -f $(PERL_EXE); $(LNS) ../$(MINIPERL_EXE) $(PERL_EXE)) \
+		&& $(RUN_PERL) TEST -minitest -utf16 base/*.t comp/*.t cmd/*.t run/*.t io/*.t op/*.t uni/*.t </dev/tty
 
 test.utf16 check.utf16: test_prep
-	PERL=./perl $(MAKE) TEST_ARGS=-utf16 _test
+	TEST_ARGS=-utf16 $(RUN_TESTS) choose
 
 utest.utf16 ucheck.utf16: test_prep
-	PERL=./perl $(MAKE) TEST_ARGS="-utf8 -utf16" _test
+	TEST_ARGS="-utf8 -utf16" $(RUN_TESTS) choose
 
 # Targets for valgrind testing:
 
 test_prep.valgrind: test_prep perl.valgrind
-	PERL=./perl $(MAKE) _test_prep
 
 test.valgrind check.valgrind:	test_prep perl.valgrind.config
-	PERL=./perl PERL_DEBUG=PERL_VALGRIND=1 VALGRIND='$(VALGRIND)' $(MAKE) _test
+	PERL_VALGRIND=1 VALGRIND='$(VALGRIND)' $(RUN_TESTS) choose
 
 utest.valgrind ucheck.valgrind: test_prep.valgrind perl.valgrind.config
-	PERL=./perl PERL_DEBUG=PERL_VALGRIND=1 TEST_ARGS=-utf8 $(MAKE) _test
+	PERL_VALGRIND=1 TEST_ARGS=-utf8 $(RUN_TESTS) choose
 
 test_notty.valgrind: test_prep.valgrind perl.valgrind.config
-	PERL=./perl $(MAKE) PERL_DEBUG=PERL_VALGRIND=1 _test_notty
+	PERL_VALGRIND=1 $(RUN_TESTS) no-tty
 
 # Targets for Third Degree testing.
 
 test_prep.third: test_prep perl.third
-	PERL=./perl.third $(MAKE) _test_prep
+	cd t && (rm -f ./perl.third$(EXE_EXT); $(LNS) ../perl.third$(EXE_EXT) perl.third(EXE_EXT))
 
 test.third check.third:	test_prep.third perl.third
-	PERL=./perl.third PERL_DEBUG=PERL_3LOG=1 $(MAKE) _test
+	PERL=./perl.third PERL_3LOG=1 $(RUN_TESTS) choose
 
 utest.third ucheck.third: test_prep.third perl.third
-	PERL=./perl.third PERL_DEBUG=PERL_3LOG=1 TEST_ARGS=-utf8 $(MAKE) _test
+	PERL=./perl.third PERL_3LOG=1 TEST_ARGS=-utf8 $(RUN_TESTS) choose
 
 test_notty.third: test_prep.third perl.third
-	PERL=./perl.third $(MAKE) PERL_DEBUG=PERL_3LOG=1 _test_notty
+	PERL=./perl.third PERL_3LOG=1 $(RUN_TESTS) choose
 
 # Targets for Deparse testing.
 
 test.deparse:	test_prep
-	PERL=./perl TEST_ARGS=-deparse $(MAKE) _test
+	TEST_ARGS=-deparse $(RUN_TESTS) choose
 
 test_notty.deparse:	test_prep
-	PERL=./perl TEST_ARGS=-deparse $(MAKE) _test_notty
+	TEST_ARGS=-deparse $(RUN_TESTS) no-tty
 
 # Targets to run the test suite with -t
 
 test.taintwarn:	test_prep
-	PERL=./perl TEST_ARGS=-taintwarn $(MAKE) _test
+	TEST_ARGS=-taintwarn $(RUN_TESTS) choose
 
 minitest.prep:
-	-@test -f lib/lib.pm && test -f lib/Config.pm || \
-	  $(MAKE) lib/Config.pm lib/lib.pm $(unidatafiles)
+	-@test -f lib/Config.pm || $(MAKE) lib/Config.pm $(unidatafiles)
 	@echo " "
 	@echo "You may see some irrelevant test failures if you have been unable"
-	@echo "to build lib/Config.pm, lib/lib.pm or the Unicode data files."
+	@echo "to build lib/Config.pm, or the Unicode data files."
 	@echo " "
 
 # Can't depend on lib/Config.pm because that might be where miniperl
 # is crashing.
-minitest: miniperl$(EXE_EXT) lib/re.pm minitest.prep
-	- cd t && (rm -f perl$(EXE_EXT); $(LNS) ../miniperl$(EXE_EXT) perl$(EXE_EXT)) \
-		&& $(LDLIBPTH) $(RUN) ./perl TEST -minitest base/*.t comp/*.t cmd/*.t run/*.t io/*.t op/*.t uni/*.t </dev/tty
+minitest: $(MINIPERL_EXE) lib/re.pm minitest.prep
+	- cd t && (rm -f $(PERL_EXE); $(LNS) ../$(MINIPERL_EXE) $(PERL_EXE)) \
+		&& $(RUN_PERL) TEST -minitest base/*.t comp/*.t cmd/*.t run/*.t io/*.t re/*.t op/*.t uni/*.t </dev/tty
 
 # Test via harness
 
 test_harness: test_prep
-	PERL=./perl $(MAKE) TESTFILE=harness _test
+	TESTFILE=harness $(RUN_TESTS) choose
 
 test_harness_notty: test_prep
-	PERL=./perl HARNESS_NOTTY=1 $(MAKE) TESTFILE=harness _test
+	HARNESS_NOTTY=1 TESTFILE=harness $(RUN_TESTS) choose
+
+test-reonly: test_prep_reonly
+	TEST_ARGS='-re \bre\/' TESTFILE=harness $(RUN_TESTS) choose
+
+
+# Porting tests (well-formedness of pod, manifest, etc)
 
-test-reonly: test_prep
-	PERL=./perl TEST_ARGS='-re \\bpat\\b \\breg \\bre\b \\bsubst \\brxcode' $(MAKE) TESTFILE=harness _test
+test_porting: test_prep
+	cd t && $(RUN_PERL) harness porting/*.t
 
 # Handy way to run perlbug -ok without having to install and run the
 # installed perlbug. We don't re-run the tests here - we trust the user.
@@ -1495,28 +1490,28 @@
 .PHONY: ok okfile oknack okfilenack nok nokfile noknack nokfilenack
 
 ok:	utilities
-	$(LDLIBPTH) $(RUN) ./perl -Ilib utils/perlbug -ok -s '(UNINSTALLED)'
+	$(RUN_PERL) -Ilib utils/perlbug -ok -s '(UNINSTALLED)'
 
 okfile:	utilities
-	$(LDLIBPTH) $(RUN) ./perl -Ilib utils/perlbug -ok -s '(UNINSTALLED)' -F perl.ok
+	$(RUN_PERL) -Ilib utils/perlbug -ok -s '(UNINSTALLED)' -F perl.ok
 
 oknack:	utilities
-	$(LDLIBPTH) $(RUN) ./perl -Ilib utils/perlbug -ok -s '(UNINSTALLED)' -A
+	$(RUN_PERL) -Ilib utils/perlbug -ok -s '(UNINSTALLED)' -A
 
 okfilenack:	utilities
-	$(LDLIBPTH) $(RUN) ./perl -Ilib utils/perlbug -ok -s '(UNINSTALLED)' -F perl.ok -A
+	$(RUN_PERL) -Ilib utils/perlbug -ok -s '(UNINSTALLED)' -F perl.ok -A
 
 nok:	utilities
-	$(LDLIBPTH) $(RUN) ./perl -Ilib utils/perlbug -nok -s '(UNINSTALLED)'
+	$(RUN_PERL) -Ilib utils/perlbug -nok -s '(UNINSTALLED)'
 
 nokfile:	utilities
-	$(LDLIBPTH) $(RUN) ./perl -Ilib utils/perlbug -nok -s '(UNINSTALLED)' -F perl.nok
+	$(RUN_PERL) -Ilib utils/perlbug -nok -s '(UNINSTALLED)' -F perl.nok
 
 noknack:	utilities
-	$(LDLIBPTH) $(RUN) ./perl -Ilib utils/perlbug -nok -s '(UNINSTALLED)' -A
+	$(RUN_PERL) -Ilib utils/perlbug -nok -s '(UNINSTALLED)' -A
 
 nokfilenack:	utilities
-	$(LDLIBPTH) $(RUN) ./perl -Ilib utils/perlbug -nok -s '(UNINSTALLED)' -F perl.nok -A
+	$(RUN_PERL) -Ilib utils/perlbug -nok -s '(UNINSTALLED)' -F perl.nok -A
 
 .PHONY: clist hlist shlist pllist
 
Index: src/gnu/usr.bin/perl/Makefile.bsd-wrapper
diff -u src/gnu/usr.bin/perl/Makefile.bsd-wrapper:1.82 src/gnu/usr.bin/perl/Makefile.bsd-wrapper:1.83
--- Makefile.bsd-wrapper:1.82	Mon May 10 18:20:31 2010
+++ Makefile.bsd-wrapper	Fri Sep 24 15:06:39 2010
@@ -1,4 +1,4 @@
-# $OpenBSD: Makefile.bsd-wrapper,v 1.82 2010/05/10 18:20:31 drahn Exp $
+# $OpenBSD: Makefile.bsd-wrapper,v 1.83 2010/09/24 15:06:39 millert Exp $
 #
 # Build wrapper for Perl 5.10.0
 #
@@ -35,7 +35,7 @@
 SRCS1=	gv.c toke.c perly.c pad.c regcomp.c dump.c util.c mg.c reentr.c \
 	mro.c hv.c av.c run.c pp_hot.c sv.c pp.c scope.c pp_ctl.c \
 	pp_sys.c doop.c doio.c regexec.c utf8.c taint.c deb.c universal.c \
-	xsutils.c globals.c perlio.c perlapi.c numeric.c mathoms.c locale.c \
+	globals.c perlio.c perlapi.c numeric.c mathoms.c locale.c \
 	pp_pack.c pp_sort.c
 SRCS=	${SRCS1} op.c perl.c
 
@@ -57,7 +57,7 @@
 STRIPFLAGS='-s'
 .endif
 
-GEN_AFTER= 	config.h uudmap.h cflags makeaperl makedepend makedir \
+GEN_AFTER= 	bitcount.h config.h uudmap.h cflags makeaperl makedepend \
 		myconfig writemain Makefile Policy.sh pod/Makefile \
 		x2p/Makefile x2p/cflags
 
@@ -73,7 +73,7 @@
 man.build: perl.build
 	cd ${.CURDIR} && exec ${MAKE} -f Makefile.bsd-wrapper1 $@
 
-beforedepend: config.sh config.h uudmap.h Makefile makedepend x2p/Makefile writemain 
+beforedepend: config.sh config.h bitcount.h uudmap.h Makefile makedepend x2p/Makefile writemain 
 	cd ${.OBJDIR} && exec ${MAKE} depend
 
 perl.build:	perl.lib
@@ -92,8 +92,10 @@
 config.h: 
 	cd ${.OBJDIR} && exec /bin/sh config_h.SH
 
-uudmap.h: generate_uudmap
-	./generate_uudmap > uudmap.h
+uudmap.h: bitcount.h
+
+bitcount.h: generate_uudmap
+	./generate_uudmap uudmap.h bitcount.h
 
 generate_uudmap: generate_uudmap.o
 	${CC} -o generate_uudmap generate_uudmap.o
@@ -174,7 +176,9 @@
 	cd ${.OBJDIR} && exec ${MAKE} preplibrary
 
 DynaLoader.c: miniperl ${DYNALOADER} lib/Config.pm
-	./miniperl -Ilib lib/ExtUtils/xsubpp -noprototypes -typemap \
+	./miniperl -Ilib -Icpan/Cwd -Icpan/Cwd/lib -Icpan/ExtUtils-ParseXS/lib \
+	    -Icpan/Getopt-Long/lib -Idist/constant/lib \
+	    cpan/ExtUtils-ParseXS/lib/ExtUtils/xsubpp -noprototypes -typemap \
 	    ../../lib/ExtUtils/typemap ${DYNALOADER} | \
 	    sed -f ${.CURDIR}/DynaLoader.sed > $@
 
Index: src/gnu/usr.bin/perl/Makefile.bsd-wrapper1
diff -u src/gnu/usr.bin/perl/Makefile.bsd-wrapper1:1.8 src/gnu/usr.bin/perl/Makefile.bsd-wrapper1:1.9
--- Makefile.bsd-wrapper1:1.8	Tue Oct 13 16:46:05 2009
+++ Makefile.bsd-wrapper1	Fri Sep 24 15:06:39 2010
@@ -13,7 +13,7 @@
 
 MANLOCALBUILD=	yes
 
-MLINKS=		c2ph.1 pstruct.1 s2p.1 psed.1 perl5101delta.1 perldelta.1 \
+MLINKS=		c2ph.1 pstruct.1 s2p.1 psed.1 perl5121delta.1 perldelta.1 \
 		Carp.3p carp.3p Carp.3p cluck.3p Carp.3p croak.3p \
 		Carp.3p confess.3p Carp.3p shortmess.3p Carp.3p longmess.3p \
 		Getopt::Std.3p getopt.3p Getopt::Std.3p getopts.3p \
@@ -36,17 +36,17 @@
 .for page sect file in \
     a2p 1 			x2p/a2p.pod \
     c2ph 1			utils/c2ph \
-    config_data 1		lib/Module/Build/scripts/config_data \
+    config_data 1		cpan/Module-Build/scripts/config_data \
     corelist 1			utils/corelist \
-    cpan 1			lib/CPAN/bin/cpan \
+    cpan 1			cpan/CPAN/scripts/cpan \
     cpan2dist 1			utils/cpan2dist \
     cpanp 1			utils/cpanp \
     dprofpp 1 			utils/dprofpp \
-    enc2xs 1			ext/Encode/bin/enc2xs \
+    enc2xs 1			cpan/Encode/bin/enc2xs \
     find2perl 1			x2p/find2perl \
     h2ph 1			utils/h2ph \
     h2xs 1			utils/h2xs \
-    instmodsh 1			lib/ExtUtils/instmodsh \
+    instmodsh 1			cpan/ExtUtils-MakeMaker/bin/instmodsh \
     libnetcfg 1			utils/libnetcfg.PL \
     perl 1			pod/perl.pod \
     perl5004delta 1		pod/perl5004delta.pod \
@@ -75,6 +75,14 @@
     perl595delta 1		pod/perl595delta.pod \
     perl5100delta 1		pod/perl5100delta.pod \
     perl5101delta 1		pod/perl5101delta.pod \
+    perl5110delta 1		pod/perl5110delta.pod \
+    perl5111delta 1		pod/perl5111delta.pod \
+    perl5112delta 1		pod/perl5112delta.pod \
+    perl5113delta 1		pod/perl5113delta.pod \
+    perl5114delta 1		pod/perl5114delta.pod \
+    perl5115delta 1		pod/perl5115delta.pod \
+    perl5120delta 1		pod/perl5120delta.pod \
+    perl5121delta 1		pod/perl5121delta.pod \
     perlapi 1			pod/perlapi.pod \
     perlapio 1			pod/perlapio.pod \
     perlartistic 1		pod/perlartistic.pod \
@@ -136,11 +144,11 @@
     perlobj 1			pod/perlobj.pod \
     perlop 1			pod/perlop.pod \
     perlopentut 1		pod/perlopentut.pod \
-    perlothrtut 1		pod/perlothrtut.pod \
     perlpacktut 1		pod/perlpacktut.pod \
     perlperf 1			pod/perlperf.pod \
     perlpod 1			pod/perlpod.pod \
     perlpodspec 1		pod/perlpodspec.pod \
+    perlpolicy 1		pod/perlpolicy.pod \
     perlport 1			pod/perlport.pod \
     perlpragma 1		pod/perlpragma.pod \
     perlre 1			pod/perlre.pod \
@@ -170,12 +178,13 @@
     perlunicode 1		pod/perlunicode.pod \
     perlunifaq 1		pod/perlunifaq.pod \
     perluniintro 1		pod/perluniintro.pod \
+    perluniprops 1		pod/perluniprops.pod \
     perlunitut 1		pod/perlunitut.pod \
     perlutil 1			pod/perlutil.pod \
     perlvar 1			pod/perlvar.pod \
     perlxs 1			pod/perlxs.pod \
     perlxstut 1			pod/perlxstut.pod \
-    piconv 1			ext/Encode/bin/piconv \
+    piconv 1			cpan/Encode/bin/piconv \
     pl2pm 1			utils/pl2pm \
     pod2html 1			pod/pod2html \
     pod2latex 1			pod/pod2latex.PL \
@@ -184,29 +193,31 @@
     pod2usage 1			pod/pod2usage \
     podchecker 1		pod/podchecker \
     podselect 1			pod/podselect \
-    prove 1			ext/Test-Harness/bin/prove \
+    prove 1			cpan/Test-Harness/bin/prove \
     s2p	1			x2p/s2p \
     splain 1			utils/splain \
     xsubpp 1			lib/ExtUtils/xsubpp \
     AnyDBM_File	3p		lib/AnyDBM_File.pm \
-    App::Prove 3p		ext/Test-Harness/lib/App/Prove.pm \
-    App::Prove::State 3p	ext/Test-Harness/lib/App/Prove/State.pm \
-    App::Prove::State::Result 3p	ext/Test-Harness/lib/App/Prove/State/Result.pm \
-    App::Prove::State::Result::Test 3p	ext/Test-Harness/lib/App/Prove/State/Result/Test.pm \
+    App::Cpan 3p		lib/App/Cpan.pm \
+    App::Prove 3p		lib/App/Prove.pm \
+    App::Prove::State 3p	lib/App/Prove/State.pm \
+    App::Prove::State::Result 3p	lib/App/Prove/State/Result.pm \
+    App::Prove::State::Result::Test 3p	lib/App/Prove/State/Result/Test.pm \
     Archive::Extract 3p		lib/Archive/Extract.pm \
     Archive::Tar 3p		lib/Archive/Tar.pm \
     Archive::Tar::File 3p	lib/Archive/Tar/File.pm \
     Attribute::Handlers 3p	lib/Attribute/Handlers.pm \
     AutoLoader 3p		lib/AutoLoader.pm \
     AutoSplit 3p		lib/AutoSplit.pm \
-    B 3p			ext/B/B.pm \
-    B::Concise 3p		ext/B/B/Concise.pm \
-    B::Debug 3p			ext/B/B/Debug.pm \
-    B::Deparse 3p		ext/B/B/Deparse.pm \
-    B::Lint 3p			ext/B/B/Lint.pm \
-    B::Showlex 3p		ext/B/B/Showlex.pm \
-    B::Terse 3p			ext/B/B/Terse.pm \
-    B::Xref 3p			ext/B/B/Xref.pm \
+    B 3p			lib/B.pm \
+    B::Concise 3p		lib/B/Concise.pm \
+    B::Debug 3p			lib/B/Debug.pm \
+    B::Deparse 3p		lib/B/Deparse.pm \
+    B::Lint 3p			lib/B/Lint.pm \
+    B::Lint::Debug 3p		lib/B/Lint/Debug.pm \
+    B::Showlex 3p		lib/B/Showlex.pm \
+    B::Terse 3p			lib/B/Terse.pm \
+    B::Xref 3p			lib/B/Xref.pm \
     Benchmark 3p		lib/Benchmark.pm \
     CGI 3p			lib/CGI.pm \
     CGI::Apache 3p		lib/CGI/Apache.pm \
@@ -236,6 +247,7 @@
     CPANPLUS::Dist::Build 3p	lib/CPANPLUS/Dist/Build.pm \
     CPANPLUS::Dist::Build::Constants 3p lib/CPANPLUS/Dist/Build/Constants.pm \
     CPANPLUS::Dist::MM 3p	lib/CPANPLUS/Dist/MM.pm \
+    CPANPLUS::Dist::Sample 3p	lib/CPANPLUS/Dist/Sample.pm \
     CPANPLUS::Error 3p		lib/CPANPLUS/Error.pm \
     CPANPLUS::FAQ 3p		lib/CPANPLUS/FAQ.pod \
     CPANPLUS::Hacking 3p	lib/CPANPLUS/Hacking.pod \
@@ -262,10 +274,10 @@
     CPANPLUS::Shell::Default::Plugins::Remote 3p	lib/CPANPLUS/Shell/Default/Plugins/Remote.pm \
     CPANPLUS::Shell::Default::Plugins::Source 3p	lib/CPANPLUS/Shell/Default/Plugins/Source.pm \
     Carp 3p			lib/Carp.pm \
-    Carp::Heavy 3p		lib/Carp/Heavy.pm \
     Class::ISA 3p		lib/Class/ISA.pm \
     Class::Struct 3p		lib/Class/Struct.pm \
     Compress::Raw::Zlib 3p	lib/Compress/Raw/Zlib.pm \
+    Compress::Raw::Bzip2 3p	lib/Compress/Raw/Bzip2.pm \
     Compress::Zlib 3p		lib/Compress/Zlib.pm \
     Config 3p			lib/Config.pod \
     Config::Extensions 3p	lib/Config/Extensions.pm \
@@ -277,44 +289,46 @@
     DBM_Filter::int32 3p	lib/DBM_Filter/int32.pm \
     DBM_Filter::null 3p		lib/DBM_Filter/null.pm \
     DBM_Filter::utf8 3p		lib/DBM_Filter/utf8.pm \
-    DB_File 3p			ext/DB_File/DB_File.pm \
-    Data::Dumper 3p		ext/Data-Dumper/Dumper.pm \
-    Devel::DProf 3p		ext/Devel-DProf/DProf.pm \
+    DB_File 3p			lib/DB_File.pm \
+    Data::Dumper 3p		lib/Data/Dumper.pm \
+    Devel::DProf 3p		lib/Devel/DProf.pm \
     Devel::InnerPackage 3p	lib/Devel/InnerPackage.pm \
-    Devel::PPPort 3p		ext/Devel-PPPort/PPPort.pm \
-    Devel::Peek 3p		ext/Devel-Peek/Peek.pm \
+    Devel::PPPort 3p		lib/Devel/PPPort.pm \
+    Devel::Peek 3p		lib/Devel/Peek.pm \
     Devel::SelfStubber 3p	lib/Devel/SelfStubber.pm \
     Digest 3p			lib/Digest.pm \
-    Digest::MD5 3p		ext/Digest-MD5/MD5.pm \
-    Digest::SHA 3p		ext/Digest-SHA/lib/Digest/SHA.pm \
+    Digest::MD5 3p		lib/Digest/MD5.pm \
+    Digest::SHA 3p		lib/Digest/SHA.pm \
     Digest::base 3p		lib/Digest/base.pm \
     Digest::file 3p		lib/Digest/file.pm \
     DirHandle 3p		lib/DirHandle.pm \
     Dumpvalue 3p		lib/Dumpvalue.pm \
-    DynaLoader 3p		ext/DynaLoader/XSLoader_pm.PL \
-    Encode 3p			ext/Encode/Encode.pm \
-    Encode::Alias 3p		ext/Encode/lib/Encode/Alias.pm \
-    Encode::Byte 3p		ext/Encode/Byte/Byte.pm \
-    Encode::CN 3p		ext/Encode/CN/CN.pm \
-    Encode::CN::HZ 3p		ext/Encode/lib/Encode/CN/HZ.pm \
-    Encode::Config 3p		ext/Encode/lib/Encode/Config.pm \
-    Encode::EBCDIC 3p		ext/Encode/EBCDIC/EBCDIC.pm \
-    Encode::Encoder 3p		ext/Encode/lib/Encode/Encoder.pm \
-    Encode::Encoding 3p		ext/Encode/lib/Encode/Encoding.pm \
+    DynaLoader 3p		dist/XSLoader/XSLoader_pm.PL \
+    Encode 3p			lib/Encode.pm \
+    Encode::Alias 3p		lib/Encode/Alias.pm \
+    Encode::Byte 3p		lib/Encode/Byte.pm \
+    Encode::CN 3p		lib/Encode/CN.pm \
+    Encode::CN::HZ 3p		lib/Encode/CN/HZ.pm \
+    Encode::Config 3p		lib/Encode/Config.pm \
+    Encode::CJKConstants 3p	lib/Encode/CJKConstants.pm \
+    Encode::EBCDIC 3p		lib/Encode/EBCDIC.pm \
+    Encode::Encoder 3p		lib/Encode/Encoder.pm \
+    Encode::Encoding 3p		lib/Encode/Encoding.pm \
     Encode::GSM0338 3p		lib/Encode/GSM0338.pm \
-    Encode::Guess 3p		ext/Encode/lib/Encode/Guess.pm \
-    Encode::JP 3p		ext/Encode/JP/JP.pm \
-    Encode::JP::H2Z 3p		ext/Encode/lib/Encode/JP/H2Z.pm \
-    Encode::JP::JIS7 3p		ext/Encode/lib/Encode/JP/JIS7.pm \
-    Encode::KR 3p		ext/Encode/KR/KR.pm \
-    Encode::KR::2022_KR 3p	ext/Encode/lib/Encode/KR/2022_KR.pm \
-    Encode::MIME::Header 3p	ext/Encode/lib/Encode/MIME/Header.pm \
-    Encode::PerlIO 3p		ext/Encode/lib/Encode/PerlIO.pod \
-    Encode::Supported 3p	ext/Encode/lib/Encode/Supported.pod \
-    Encode::Symbol 3p		ext/Encode/Symbol/Symbol.pm \
-    Encode::TW 3p		ext/Encode/TW/TW.pm \
-    Encode::Unicode 3p		ext/Encode/Unicode/Unicode.pm \
-    Encode::Unicode::UTF7 3p	ext/Encode/lib/Encode/Unicode/UTF7.pm \
+    Encode::Guess 3p		lib/Encode/Guess.pm \
+    Encode::JP 3p		lib/Encode/JP.pm \
+    Encode::JP::H2Z 3p		lib/Encode/JP/H2Z.pm \
+    Encode::JP::JIS7 3p		lib/Encode/JP/JIS7.pm \
+    Encode::KR 3p		lib/Encode/KR.pm \
+    Encode::KR::2022_KR 3p	lib/Encode/KR/2022_KR.pm \
+    Encode::MIME::Header 3p	lib/Encode/MIME/Header.pm \
+    Encode::MIME::Name 3p	lib/Encode/MIME/Name.pm \
+    Encode::PerlIO 3p		lib/Encode/PerlIO.pod \
+    Encode::Supported 3p	lib/Encode/Supported.pod \
+    Encode::Symbol 3p		lib/Encode/Symbol.pm \
+    Encode::TW 3p		lib/Encode/TW.pm \
+    Encode::Unicode 3p		lib/Encode/Unicode.pm \
+    Encode::Unicode::UTF7 3p	lib/Encode/Unicode/UTF7.pm \
     English 3p			lib/English.pm \
     Env 3p			lib/Env.pm \
     Errno 3p			ext/Errno/Errno_pm.PL \
@@ -337,6 +351,7 @@
     ExtUtils::MM_Any 3p		lib/ExtUtils/MM_Any.pm \
     ExtUtils::MM_BeOS 3p	lib/ExtUtils/MM_BeOS.pm \
     ExtUtils::MM_Cygwin 3p	lib/ExtUtils/MM_Cygwin.pm \
+    ExtUtils::MM_Darwin 3p	lib/ExtUtils/MM_Darwin.pm \
     ExtUtils::MM_DOS 3p		lib/ExtUtils/MM_DOS.pm \
     ExtUtils::MM_MacOS 3p	lib/ExtUtils/MM_MacOS.pm \
     ExtUtils::MM_NW5 3p		lib/ExtUtils/MM_NW5.pm \
@@ -360,6 +375,7 @@
     ExtUtils::Packlist 3p	lib/ExtUtils/Packlist.pm \
     ExtUtils::ParseXS 3p	lib/ExtUtils/ParseXS.pm \
     ExtUtils::testlib 3p	lib/ExtUtils/testlib.pm \
+    ExtUtils::XSSymSet 3p	lib/ExtUtils/XSSymSet.pm \
     Fatal 3p			lib/Fatal.pm \
     Fcntl 3p			lib/Fcntl.pm \
     File::Basename 3p		lib/File/Basename.pm \
@@ -386,7 +402,7 @@
     FileCache 3p		lib/FileCache.pm \
     FileHandle 3p		lib/FileHandle.pm \
     Filter::Simple 3p		lib/Filter/Simple.pm \
-    Filter::Util::Call 3p	ext/Filter-Util-Call/Call.pm \
+    Filter::Util::Call 3p	lib/Filter/Util/Call.pm \
     FindBin 3p			lib/FindBin.pm \
     Getopt::Long 3p		lib/Getopt/Long.pm \
     Getopt::Std 3p		lib/Getopt/Std.pm \
@@ -396,9 +412,10 @@
     I18N::LangTags 3p		lib/I18N/LangTags.pm \
     I18N::LangTags::Detect 3p	lib/I18N/LangTags/Detect.pm \
     I18N::LangTags::List 3p	lib/I18N/LangTags/List.pm \
-    I18N::Langinfo 3p		ext/I18N-Langinfo/Langinfo.pm \
+    I18N::Langinfo 3p		lib/I18N/Langinfo.pm \
     IO 3p			lib/IO.pm \
     IO::Compress::Base 3p	lib/IO/Compress/Base.pm \
+    IO::Compress::Bzip2 3p	lib/IO/Compress/Bzip2.pm \
     IO::Compress::Deflate 3p	lib/IO/Compress/Deflate.pm \
     IO::Compress::Gzip 3p	lib/IO/Compress/Gzip.pm \
     IO::Compress::RawDeflate 3p	lib/IO/Compress/RawDeflate.pm \
@@ -416,6 +433,7 @@
     IO::Uncompress::AnyInflate 3p	lib/IO/Uncompress/AnyInflate.pm \
     IO::Uncompress::AnyUncompress 3p	lib/IO/Uncompress/AnyUncompress.pm \
     IO::Uncompress::Base 3p	lib/IO/Uncompress/Base.pm \
+    IO::Uncompress::Bunzip2 3p	lib/IO/Uncompress/Bunzip2.pm \
     IO::Uncompress::Gunzip 3p	lib/IO/Uncompress/Gunzip.pm \
     IO::Uncompress::Inflate 3p	lib/IO/Uncompress/Inflate.pm \
     IO::Uncompress::RawInflate 3p	lib/IO/Uncompress/RawInflate.pm \
@@ -428,8 +446,8 @@
     IPC::Semaphore 3p		lib/IPC/Semaphore.pm \
     IPC::SharedMem 3p		lib/IPC/SharedMem.pm \
     IPC::SysV 3p		lib/IPC/SysV.pm \
-    List::Util 3p		ext/List-Util/lib/List/Util.pm \
-    List::Util::XS 3p		ext/List-Util/lib/List/Util/XS.pm \
+    List::Util 3p		lib/List/Util.pm \
+    List::Util::XS 3p		lib/List/Util/XS.pm \
     Locale::Constants 3p	lib/Locale/Constants.pod \
     Locale::Country 3p		lib/Locale/Country.pod \
     Locale::Currency 3p		lib/Locale/Currency.pod \
@@ -443,8 +461,8 @@
     Log::Message::Handlers 3p	lib/Log/Message/Handlers.pm \
     Log::Message::Item 3p	lib/Log/Message/Item.pm \
     Log::Message::Simple 3p	lib/Log/Message/Simple.pm \
-    MIME::Base64 3p		ext/MIME-Base64/Base64.pm \
-    MIME::QuotedPrint 3p	ext/MIME-Base64/QuotedPrint.pm \
+    MIME::Base64 3p		lib/MIME/Base64.pm \
+    MIME::QuotedPrint 3p	lib/MIME/QuotedPrint.pm \
     Math::BigFloat 3p		lib/Math/BigFloat.pm \
     Math::BigInt 3p		lib/Math/BigInt.pm \
     Math::BigInt::Calc 3p	lib/Math/BigInt/Calc.pm \
@@ -465,6 +483,7 @@
     Module::Build::API 3p	lib/Module/Build/API.pod \
     Module::Build::Authoring 3p	lib/Module/Build/Authoring.pod \
     Module::Build::Base 3p	lib/Module/Build/Base.pm \
+    Module::Build::Bundling 3p	lib/Module/Build/Bundling.pod \
     Module::Build::Compat 3p	lib/Module/Build/Compat.pm \
     Module::Build::ConfigData 3p	lib/Module/Build/ConfigData.pm \
     Module::Build::Cookbook 3p	lib/Module/Build/Cookbook.pm \
@@ -473,7 +492,6 @@
     Module::Build::PPMMaker 3p	lib/Module/Build/PPMMaker.pm \
     Module::Build::Platform::Default 3p	lib/Module/Build/Platform/Default.pm \
     Module::Build::Platform::Unix 3p	lib/Module/Build/Platform/Unix.pm \
-    Module::Build::YAML 3p	lib/Module/Build/YAML.pm \
     Module::CoreList 3p		lib/Module/CoreList.pm \
     Module::Load 3p		lib/Module/Load.pm \
     Module::Load::Conditional 3p	lib/Module/Load/Conditional.pm \
@@ -506,9 +524,9 @@
     Params::Check 3p		lib/Params/Check.pm \
     Parse::CPAN::Meta 3p	lib/Parse/CPAN/Meta.pm \
     PerlIO 3p			lib/PerlIO.pm \
-    PerlIO::encoding 3p		ext/PerlIO-encoding/encoding.pm \
-    PerlIO::scalar 3p		ext/PerlIO-scalar/scalar.pm \
-    PerlIO::via 3p		ext/PerlIO-via/via.pm \
+    PerlIO::encoding 3p		lib/PerlIO/encoding.pm \
+    PerlIO::scalar 3p		lib/PerlIO/scalar.pm \
+    PerlIO::via 3p		lib/PerlIO/via.pm \
     PerlIO::via::QuotedPrint 3p	lib/PerlIO/via/QuotedPrint.pm \
     Pod::Checker 3p		lib/Pod/Checker.pm \
     Pod::Escapes 3p		lib/Pod/Escapes.pm \
@@ -520,6 +538,9 @@
     Pod::ParseLink 3p		lib/Pod/ParseLink.pm \
     Pod::ParseUtils 3p		lib/Pod/ParseUtils.pm \
     Pod::Parser 3p		lib/Pod/Parser.pm \
+    Pod::Perldoc 3p		lib/Pod/Perldoc.pm \
+    Pod::Perldoc::BaseTo 3p	lib/Pod/Perldoc/BaseTo.pm \
+    Pod::Perldoc::GetOptsOO 3p	lib/Pod/Perldoc/GetOptsOO.pm \
     Pod::Perldoc::ToChecker 3p	lib/Pod/Perldoc/ToChecker.pm \
     Pod::Perldoc::ToMan 3p	lib/Pod/Perldoc/ToMan.pm \
     Pod::Perldoc::ToNroff 3p	lib/Pod/Perldoc/ToNroff.pm \
@@ -560,55 +581,55 @@
     Pod::Usage 3p		lib/Pod/Usage.pm \
     SDBM_File 3p		lib/SDBM_File.pm \
     Safe 3p			lib/Safe.pm \
-    Scalar::Util 3p		ext/List-Util/lib/Scalar/Util.pm \
+    Scalar::Util 3p		lib/Scalar/Util.pm \
     Search::Dict 3p		lib/Search/Dict.pm \
     SelectSaver 3p		lib/SelectSaver.pm \
     SelfLoader 3p		lib/SelfLoader.pm \
     Shell 3p			lib/Shell.pm \
     Socket 3p			lib/Socket.pm \
-    Storable 3p			ext/Storable/Storable.pm \
+    Storable 3p			lib/Storable.pm \
     Switch 3p			lib/Switch.pm \
     Symbol 3p			lib/Symbol.pm \
     Sys::Hostname 3p		lib/Sys/Hostname.pm \
     Sys::Syslog 3p		lib/Sys/Syslog.pm \
-    TAP::Base 3p		ext/Test-Harness/lib/TAP/Base.pm \
-    TAP::Formatter::Base 3p	ext/Test-Harness/lib/TAP/Formatter/Base.pm \
-    TAP::Formatter::Color 3p	ext/Test-Harness/lib/TAP/Formatter/Color.pm \
-    TAP::Formatter::Console 3p	ext/Test-Harness/lib/TAP/Formatter/Console.pm \
-    TAP::Formatter::Console::ParallelSession 3p	ext/Test-Harness/lib/TAP/Formatter/Console/ParallelSession.pm \
-    TAP::Formatter::Console::Session 3p	ext/Test-Harness/lib/TAP/Formatter/Console/Session.pm \
-    TAP::Formatter::File 3p	ext/Test-Harness/lib/TAP/Formatter/File.pm \
-    TAP::Formatter::File::Session 3p ext/Test-Harness/lib/TAP/Formatter/File/Session.pm \
-    TAP::Formatter::Session 3p	ext/Test-Harness/lib/TAP/Formatter/Session.pm \
-    TAP::Harness 3p		ext/Test-Harness/lib/TAP/Harness.pm \
-    TAP::Object 3p		ext/Test-Harness/lib/TAP/Object.pm \
-    TAP::Parser 3p		ext/Test-Harness/lib/TAP/Parser.pm \
-    TAP::Parser::Aggregator 3p	ext/Test-Harness/lib/TAP/Parser/Aggregator.pm \
-    TAP::Parser::Grammar 3p	ext/Test-Harness/lib/TAP/Parser/Grammar.pm \
-    TAP::Parser::Iterator 3p	ext/Test-Harness/lib/TAP/Parser/Iterator.pm \
-    TAP::Parser::Iterator::Array 3p ext/Test-Harness/lib/TAP/Parser/Iterator/Array.pm \
-    TAP::Parser::Iterator::Process 3p ext/Test-Harness/lib/TAP/Parser/Iterator/Process.pm \
-    TAP::Parser::Iterator::Stream 3p ext/Test-Harness/lib/TAP/Parser/Iterator/Stream.pm \
-    TAP::Parser::IteratorFactory 3p ext/Test-Harness/lib/TAP/Parser/IteratorFactory.pm \
-    TAP::Parser::Multiplexer 3p	ext/Test-Harness/lib/TAP/Parser/Multiplexer.pm \
-    TAP::Parser::Result 3p	ext/Test-Harness/lib/TAP/Parser/Result.pm \
-    TAP::Parser::Result::Bailout 3p ext/Test-Harness/lib/TAP/Parser/Result/Bailout.pm \
-    TAP::Parser::Result::Comment 3p ext/Test-Harness/lib/TAP/Parser/Result/Comment.pm \
-    TAP::Parser::Result::Plan 3p ext/Test-Harness/lib/TAP/Parser/Result/Plan.pm \
-    TAP::Parser::Result::Pragma 3p ext/Test-Harness/lib/TAP/Parser/Result/Pragma.pm \
-    TAP::Parser::Result::Test 3p ext/Test-Harness/lib/TAP/Parser/Result/Test.pm \
-    TAP::Parser::Result::Unknown 3p ext/Test-Harness/lib/TAP/Parser/Result/Unknown.pm \
-    TAP::Parser::Result::Version 3p ext/Test-Harness/lib/TAP/Parser/Result/Version.pm \
-    TAP::Parser::Result::YAML 3p ext/Test-Harness/lib/TAP/Parser/Result/YAML.pm \
-    TAP::Parser::ResultFactory 3p ext/Test-Harness/lib/TAP/Parser/ResultFactory.pm \
-    TAP::Parser::Scheduler 3p	ext/Test-Harness/lib/TAP/Parser/Scheduler.pm \
-    TAP::Parser::Scheduler::Job 3p ext/Test-Harness/lib/TAP/Parser/Scheduler/Job.pm \
-    TAP::Parser::Scheduler::Spinner 3p ext/Test-Harness/lib/TAP/Parser/Scheduler/Spinner.pm \
-    TAP::Parser::Source 3p	ext/Test-Harness/lib/TAP/Parser/Source.pm \
-    TAP::Parser::Source::Perl 3p ext/Test-Harness/lib/TAP/Parser/Source/Perl.pm \
-    TAP::Parser::Utils 3p	ext/Test-Harness/lib/TAP/Parser/Utils.pm \
-    TAP::Parser::YAMLish::Reader 3p ext/Test-Harness/lib/TAP/Parser/YAMLish/Reader.pm \
-    TAP::Parser::YAMLish::Writer 3p ext/Test-Harness/lib/TAP/Parser/YAMLish/Writer.pm \
+    TAP::Base 3p		lib/TAP/Base.pm \
+    TAP::Formatter::Base 3p	lib/TAP/Formatter/Base.pm \
+    TAP::Formatter::Color 3p	lib/TAP/Formatter/Color.pm \
+    TAP::Formatter::Console 3p	lib/TAP/Formatter/Console.pm \
+    TAP::Formatter::Console::ParallelSession 3p	lib/TAP/Formatter/Console/ParallelSession.pm \
+    TAP::Formatter::Console::Session 3p	lib/TAP/Formatter/Console/Session.pm \
+    TAP::Formatter::File 3p	lib/TAP/Formatter/File.pm \
+    TAP::Formatter::File::Session 3p lib/TAP/Formatter/File/Session.pm \
+    TAP::Formatter::Session 3p	lib/TAP/Formatter/Session.pm \
+    TAP::Harness 3p		lib/TAP/Harness.pm \
+    TAP::Object 3p		lib/TAP/Object.pm \
+    TAP::Parser 3p		lib/TAP/Parser.pm \
+    TAP::Parser::Aggregator 3p	lib/TAP/Parser/Aggregator.pm \
+    TAP::Parser::Grammar 3p	lib/TAP/Parser/Grammar.pm \
+    TAP::Parser::Iterator 3p	lib/TAP/Parser/Iterator.pm \
+    TAP::Parser::Iterator::Array 3p lib/TAP/Parser/Iterator/Array.pm \
+    TAP::Parser::Iterator::Process 3p lib/TAP/Parser/Iterator/Process.pm \
+    TAP::Parser::Iterator::Stream 3p lib/TAP/Parser/Iterator/Stream.pm \
+    TAP::Parser::IteratorFactory 3p lib/TAP/Parser/IteratorFactory.pm \
+    TAP::Parser::Multiplexer 3p	lib/TAP/Parser/Multiplexer.pm \
+    TAP::Parser::Result 3p	lib/TAP/Parser/Result.pm \
+    TAP::Parser::Result::Bailout 3p lib/TAP/Parser/Result/Bailout.pm \
+    TAP::Parser::Result::Comment 3p lib/TAP/Parser/Result/Comment.pm \
+    TAP::Parser::Result::Plan 3p lib/TAP/Parser/Result/Plan.pm \
+    TAP::Parser::Result::Pragma 3p lib/TAP/Parser/Result/Pragma.pm \
+    TAP::Parser::Result::Test 3p lib/TAP/Parser/Result/Test.pm \
+    TAP::Parser::Result::Unknown 3p lib/TAP/Parser/Result/Unknown.pm \
+    TAP::Parser::Result::Version 3p lib/TAP/Parser/Result/Version.pm \
+    TAP::Parser::Result::YAML 3p lib/TAP/Parser/Result/YAML.pm \
+    TAP::Parser::ResultFactory 3p lib/TAP/Parser/ResultFactory.pm \
+    TAP::Parser::Scheduler 3p	lib/TAP/Parser/Scheduler.pm \
+    TAP::Parser::Scheduler::Job 3p lib/TAP/Parser/Scheduler/Job.pm \
+    TAP::Parser::Scheduler::Spinner 3p lib/TAP/Parser/Scheduler/Spinner.pm \
+    TAP::Parser::Source 3p	lib/TAP/Parser/Source.pm \
+    TAP::Parser::Source::Perl 3p lib/TAP/Parser/Source/Perl.pm \
+    TAP::Parser::Utils 3p	lib/TAP/Parser/Utils.pm \
+    TAP::Parser::YAMLish::Reader 3p lib/TAP/Parser/YAMLish/Reader.pm \
+    TAP::Parser::YAMLish::Writer 3p lib/TAP/Parser/YAMLish/Writer.pm \
     Term::ANSIColor 3p		lib/Term/ANSIColor.pm \
     Term::Cap 3p		lib/Term/Cap.pm \
     Term::Complete 3p		lib/Term/Complete.pm \
@@ -643,7 +664,7 @@
     Tie::Scalar 3p		lib/Tie/Scalar.pm \
     Tie::StdHandle 3p		lib/Tie/StdHandle.pm \
     Tie::SubstrHash 3p		lib/Tie/SubstrHash.pm \
-    Time::HiRes 3p		ext/Time-HiRes/HiRes.pm \
+    Time::HiRes 3p		lib/Time/HiRes.pm \
     Time::Local 3p		lib/Time/Local.pm \
     Time::Piece 3p		lib/Time/Piece.pm \
     Time::Seconds 3p		lib/Time/Seconds.pm \
@@ -652,15 +673,15 @@
     Time::tm 3p			lib/Time/tm.pm \
     UNIVERSAL 3p		lib/UNIVERSAL.pm \
     Unicode::Collate 3p		lib/Unicode/Collate.pm \
-    Unicode::Normalize 3p	ext/Unicode-Normalize/Normalize.pm \
+    Unicode::Normalize 3p	lib/Unicode/Normalize.pm \
     Unicode::UCD 3p		lib/Unicode/UCD.pm \
     User::grent 3p		lib/User/grent.pm \
     User::pwent 3p		lib/User/pwent.pm \
-    XS::APItest 3p		ext/XS-APItest/APItest.pm \
-    XS::Typemap 3p		ext/XS-Typemap/Typemap.pm \
+    XS::APItest 3p		lib/XS/APItest.pm \
+    XS::APItest::KeywordRPN 3p	lib/XS/APItest/KeywordRPN.pm \
+    XS::Typemap 3p		lib/XS/Typemap.pm \
     XSLoader 3p			lib/XSLoader.pm \
     attributes 3p		lib/attributes.pm \
-    attrs 3p			lib/attrs.pm \
     autodie 3p			lib/autodie.pm \
     autodie::exception 3p	lib/autodie/exception.pm \
     autodie::exception::system 3p lib/autodie/exception/system.pm \
@@ -674,13 +695,15 @@
     bytes 3p			lib/bytes.pm \
     charnames 3p		lib/charnames.pm \
     constant 3p			lib/constant.pm \
+    deprecate 3p		lib/deprecate.pm \
     diagnostics 3p		lib/diagnostics.pm \
-    encoding 3p			ext/Encode/encoding.pm \
+    encoding 3p			lib/encoding.pm \
     encoding::warnings 3p	lib/encoding/warnings.pm \
     feature 3p			lib/feature.pm \
     fields 3p			lib/fields.pm \
     filetest 3p			lib/filetest.pm \
     if 3p			lib/if.pm \
+    inc::latest 3p		lib/inc/latest.pm \
     integer 3p			lib/integer.pm \
     less 3p			lib/less.pm \
     lib 3p			lib/lib.pm \
@@ -696,8 +719,8 @@
     sort 3p			lib/sort.pm \
     strict 3p			lib/strict.pm \
     subs 3p			lib/subs.pm \
-    threads 3p			ext/threads/threads.pm \
-    threads::shared 3p		ext/threads-shared/shared.pm \
+    threads 3p			lib/threads.pm \
+    threads::shared 3p		lib/threads/shared.pm \
     utf8 3p			lib/utf8.pm \
     vars 3p			lib/vars.pm \
     version 3p			lib/version.pod \
Index: src/gnu/usr.bin/perl/README
diff -u src/gnu/usr.bin/perl/README:1.11 src/gnu/usr.bin/perl/README:1.12
--- README:1.11	Mon Oct 12 18:24:20 2009
+++ README	Fri Sep 24 15:06:39 2010
@@ -1,6 +1,6 @@
-Perl is Copyright (C) 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001,
-2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009 by Larry Wall and others.
-All rights reserved.
+Perl is Copyright (C) 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,
+2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 by Larry Wall
+and others.  All rights reserved.
 
 
 
@@ -22,7 +22,7 @@
 For an introduction to the language's features, see pod/perlintro.pod.
 
 For a discussion of the important changes in this release, see
-pod/perl5101delta.pod.  (This will also be installed as perldelta.pod).
+pod/perl5122delta.pod.  (This will also be installed as perldelta.pod).
 
 There are also many Perl books available, covering a wide variety of topics,
 from various publishers.  See pod/perlbook.pod for more information.
Index: src/gnu/usr.bin/perl/README.os2
diff -u src/gnu/usr.bin/perl/README.os2:1.12 src/gnu/usr.bin/perl/README.os2:1.13
--- README.os2:1.12	Mon Oct 12 18:24:20 2009
+++ README.os2	Fri Sep 24 15:06:39 2010
@@ -208,9 +208,8 @@
 
 One can get different parts of EMX from, say
 
-  http://www.leo.org/pub/comp/os/os2/leo/gnu/emx+gcc/
-  http://powerusersbbs.com/pub/os2/dev/   [EMX+GCC Development]
-  http://hobbes.nmsu.edu/pub/os2/dev/emx/v0.9d/
+  ftp://crydee.sai.msu.ru/pub/comp/os/os2/leo/gnu/emx+gcc/
+  http://hobbes.nmsu.edu/h-browse.php?dir=/pub/os2/dev/emx/v0.9d/
 
 The runtime component should have the name F<emxrt.zip>.
 
@@ -235,9 +234,8 @@
 
 One can get RSX from, say
 
-  ftp://ftp.cdrom.com/pub/os2/emx09c/contrib
-  ftp://ftp.uni-bielefeld.de/pub/systems/msdos/misc
-  ftp://ftp.leo.org/pub/comp/os/os2/leo/devtools/emx+gcc/contrib
+  http://cd.textfiles.com/hobbesos29804/disk1/EMX09C/
+  ftp://crydee.sai.msu.ru/pub/comp/os/os2/leo/gnu/emx+gcc/contrib/
 
 Contact the author on C<rainer@mathematik.uni-bielefeld.de>.
 
@@ -620,7 +618,7 @@
 
 =item Additional Perl modules
 
-  unzip perl_ste.zip -d f:/perllib/lib/site_perl/5.10.1/
+  unzip perl_ste.zip -d f:/perllib/lib/site_perl/5.12.2/
 
 Same remark as above applies.  Additionally, if this directory is not
 one of directories on @INC (and @INC is influenced by C<PERLLIB_PREFIX>), you
@@ -799,8 +797,7 @@
 
 =head1 BUILD
 
-Here we discuss how to build Perl under OS/2. There is an alternative
-(but maybe older) view on L<http://www.shadow.net/~troc/os2perl.html>.
+Here we discuss how to build Perl under OS/2.
 
 =head2 The short story
 
@@ -846,10 +843,11 @@
 
 Possible locations to get the files:
 
-  ftp://hobbes.nmsu.edu/os2/unix/
-  ftp://ftp.cdrom.com/pub/os2/unix/
-  ftp://ftp.cdrom.com/pub/os2/dev32/
-  ftp://ftp.cdrom.com/pub/os2/emx09c/
+
+  ftp://ftp.uni-heidelberg.de/pub/os2/unix/
+  http://hobbes.nmsu.edu/h-browse.php?dir=/pub/os2
+  http://cd.textfiles.com/hobbesos29804/disk1/DEV32/
+  http://cd.textfiles.com/hobbesos29804/disk1/EMX09C/
 
 It is reported that the following archives contain enough utils to
 build perl: F<gnufutil.zip>, F<gnusutil.zip>, F<gnututil.zip>, F<gnused.zip>,
@@ -857,7 +855,7 @@
 F<ksh527rt.zip> (or a later version).  Note that all these utilities are
 known to be available from LEO:
 
-  ftp://ftp.leo.org/pub/comp/os/os2/leo/gnu
+  ftp://crydee.sai.msu.ru/pub/comp/os/os2/leo/gnu/
 
 Note also that the F<db.lib> and F<db.a> from the EMX distribution
 are not suitable for multi-threaded compile (even single-threaded
@@ -901,8 +899,8 @@
 You need to fetch the latest perl source (including developers
 releases). With some probability it is located in 
 
-  http://www.cpan.org/src/5.0
-  http://www.cpan.org/src/5.0/unsupported
+  http://www.cpan.org/src/
+  http://www.cpan.org/src/unsupported
 
 If not, you may need to dig in the indices to find it in the directory
 of the current maintainer.
Index: src/gnu/usr.bin/perl/README.qnx
diff -u src/gnu/usr.bin/perl/README.qnx:1.3 src/gnu/usr.bin/perl/README.qnx:1.4
--- README.qnx:1.3	Wed Dec  3 03:02:19 2003
+++ README.qnx	Fri Sep 24 15:06:39 2010
@@ -86,7 +86,7 @@
 
 The following tests may report errors under QNX4:
 
-ext/Cwd/Cwd.t will complain if `pwd` and cwd don't give
+cpan/Cwd/Cwd.t will complain if `pwd` and cwd don't give
 the same results. cwd calls `fullpath -t`, so if you
 cd `fullpath -t` before running the test, it will
 pass.
Index: src/gnu/usr.bin/perl/README.vms
diff -u src/gnu/usr.bin/perl/README.vms:1.13 src/gnu/usr.bin/perl/README.vms:1.14
--- README.vms:1.13	Mon Oct 12 18:24:20 2009
+++ README.vms	Fri Sep 24 15:06:39 2010
@@ -27,7 +27,7 @@
 release by having a look at L<perldelta/VMS>.
 
 Also note that, as of Perl version 5.005 and later, an ANSI C compliant 
-compiler is required to build Perl.  VAX C is *not* ANSI compliant, as it 
+compiler is required to build Perl.  VAX C is I<not> ANSI compliant, as it 
 died a natural death some time before the standard was set.  Therefore 
 VAX C will not compile Perl 5.005 or later.  We are sorry about that.
 
@@ -56,10 +56,6 @@
 could use modules implementing useful VMS system services, so if you'd like
 to lend a hand we'd love to have you.  Join the Perl Porting Team Now!
 
-There are issues with various versions of DEC C, so if you're not running a
-relatively modern version, check the "DEC C issues" section later on in this
-document.
-
 =head2 Other required software for Compiling Perl on VMS
 
 In addition to VMS and DCL you will need two things:
@@ -69,6 +65,9 @@
 =item 1  A C compiler. 
 
 HP (formerly Compaq, more formerly DEC) C for VMS (VAX, Alpha, or Itanium).
+Various ancient versions of DEC C had some caveats, so if you're using a 
+version older than 7.x on Alpha or Itanium or 6.x on VAX, you may need to 
+upgrade to get a successful build.
 
 =item 2  A make tool. 
 
@@ -85,14 +84,13 @@
 
 =over 4
 
-=item 1  GUNZIP/GZIP.EXE for VMS 
+=item 1  GUNZIP/GZIP for VMS 
 
 A de-compressor for *.gz and *.tgz files available from a number 
 of web/ftp sites and is distributed on the OpenVMS Freeware CD-ROM 
 from HP.
 
     http://www.hp.com/go/openvms/freeware/
-    http://www.crinoid.com/utils/
 
 =item 2  VMS TAR 
 
@@ -109,25 +107,14 @@
 
     http://h71000.www7.hp.com/opensource/gnv.html
 
-=item 3  UNZIP.EXE for VMS
+=item 3  UNZIP for VMS
 
 A combination decompressor and archive reader/writer for *.zip files.  
 Unzip is available from a number of web/ftp sites.
 
     http://www.info-zip.org/UnZip.html
     http://www.hp.com/go/openvms/freeware/
-    ftp://ftp.hp.com/pub/openvms
-    ftp://ftp.process.com/vms-freeware/fileserv
-
-=item 4  MOST
-
-Most is an optional pager that is convenient to use with perldoc (unlike 
-TYPE/PAGE, MOST can go forward and backwards in a document and supports 
-regular expression searching).  Most builds with the slang 
-library on VMS.  Most and slang are available from:
-
-    ftp://space.mit.edu/pub/davis/
-    ftp://ftp.process.com/vms-freeware/narnia/
+    ftp://ftp.process.com/vms-freeware/fileserv/
 
 =item 5 GNU PATCH and DIFFUTILS for VMS
 
@@ -167,16 +154,12 @@
 provided with previous versions of Perl, do I<not> use the ODS-2
 compatability qualifier.  Instead, use a command like the following:
 
-    vmstar /extract/verbose perl-V^.VIII^.III.tar
-
-or:
-
-    vmstar -xvf perl-5^.10^.1.tar
+    vmstar -xvf perl-5^.12^.2.tar
 
 Then rename the top-level source directory like so:
 
-    set security/protection=(o:rwed) perl-5^.10^.1.dir
-    rename perl-5^.10^.1.dir perl-5_10_1.dir
+    set security/protection=(o:rwed) perl-5^.12^.2.dir
+    rename perl-5^.12^.2.dir perl-5_12_2.dir
 
 The reason for this last step is that while filenames with multiple dots
 are generally supported by Perl on VMS, I<directory> names with multiple
@@ -197,10 +180,6 @@
 of your C compiler and network stack) will determine how perl is custom 
 built for your machine.
 
-If you have multiple C compilers installed, you'll have your choice of
-which one to use.  Various older versions of DEC C had some caveats, so if
-you're using a version older than 5.2, check the "DEC C Issues" section.
-
 If you have any symbols or logical names in your environment that may 
 interfere with the build or regression testing of perl then configure.com 
 will try to warn you about them.  If a logical name is causing
@@ -329,7 +308,7 @@
 somehow and yield a dysfunctional Perl for you.
 
 Testing is very easy, though, as there's a full test suite in the perl
-distribution.  To run the tests, enter the *exact* MMS line you used to
+distribution.  To run the tests, enter the I<exact> MMS line you used to
 compile Perl and add the word "test" to the end, like this:
 
 If the compile command was:
@@ -360,7 +339,7 @@
 with the particular module or feature that reported failure. If the test suite
 hangs (some tests can take upwards of two or three minutes, or more if
 you're on an especially slow machine, depending on your machine speed, so
-don't be hasty), then the test *after* the last one displayed failed. Don't
+don't be hasty), then the test I<after> the last one displayed failed. Don't
 install Perl unless you're confident that you're OK. Regardless of how
 confident you are, make a bug report to the VMSPerl mailing list.
 
@@ -408,7 +387,7 @@
 =head2 Cleaning up and starting fresh (optional) installing Perl on VMS
 
 If you need to recompile from scratch, you have to make sure you clean up
-first.  There is a procedure to do it--enter the *exact* MMS line you used 
+first.  There is a procedure to do it--enter the I<exact> MMS line you used 
 to compile and add "realclean" at the end, like this:
 
 if the compile command was:
@@ -560,7 +539,7 @@
 =head1 CAVEATS
 
 Probably the single biggest gotcha in compiling Perl is giving the wrong
-switches to MMS/MMK when you build. Use *exactly* what the configure.com 
+switches to MMS/MMK when you build. Use I<exactly> what the configure.com 
 script prints!
 
 The next big gotcha is directory depth.  Perl can create directories four,
@@ -580,10 +559,8 @@
 warn you if you start out building a module too deep in a directory.
 
 As noted above ODS-5 escape sequences such as ^. can break the perl
-build.  Solutions include renaming files and directories as needed or
-being careful to use the -o switch or /ODS2 qualifier with latter
-versions of the vmstar utility when unpacking perl or CPAN modules
-on ODS-5 volumes.
+build.  Solutions include renaming files and directories as needed 
+when unpacking perl or CPAN modules on ODS-5 volumes.
 
 Be sure that the process that you use to build perl has a PGFLQ greater
 than 100000.  Be sure to have a correct local time zone to UTC offset
@@ -599,52 +576,13 @@
 build.  If things go wrong make sure you do a "(MMK|MMS|make) realclean"
 before you rebuild.
 
-=head2 DEC C issues with Perl on VMS
-
-Note to DEC C users: Some early versions (pre-5.2, some pre-4. If you're DEC
-C 5.x or higher, with current patches if any, you're fine) of the DECCRTL
-contained a few bugs which affect Perl performance:
-
-=over 4
-
-=item - pipes
-
-Newlines are lost on I/O through pipes, causing lines to run together.
-This shows up as RMS RTB errors when reading from a pipe.  You can
-work around this by having one process write data to a file, and
-then having the other read the file, instead of the pipe.  This is
-fixed in version 4 of DEC C.
-
-=item - modf()
-
-The modf() routine returns a non-integral value for some values above
-INT_MAX; the Perl "int" operator will return a non-integral value in
-these cases.  This is fixed in version 4 of DEC C.
-
-=item - ALPACRT ECO
-
-On the AXP, if SYSNAM privilege is enabled, the CRTL chdir() routine
-changes the process default device and directory permanently, even
-though the call specified that the change should not persist after
-Perl exited.  This is fixed by DEC CSC patch ALPACRT04_061 or later.
-See also:
-
-    http://ftp.support.compaq.com/patches/.new/openvms.shtml
-
-=back
-
-Please note that in later versions "DEC C" may also be known as 
-"Compaq C".
-
 =head2 GNU issues with Perl on VMS
 
 It has been a while since the GNU utilities such as GCC or GNU make
 were used to build perl on VMS.  Hence they may require a great deal
 of source code modification to work again.
 
-    http://slacvx.slac.stanford.edu/HELP/GCC
     http://www.progis.de/
-    http://www.lp.se/products/gnu.html
 
 =head2 Floating Point Considerations
 
@@ -655,10 +593,11 @@
 5.8.0, Alpha builds now use IEEE floating point formats by default, which in
 VMS parlance are S_FLOAT for singles and T_FLOAT for doubles.  IEEE is not
 available on VAX, so F_FLOAT and D_FLOAT remain the defaults for singles and
-doubles respectively.  The available non-default options are G_FLOAT on VAX
-and D_FLOAT or G_FLOAT on Alpha.
+doubles respectively.  Itanium builds have always used IEEE by default. The 
+available non-default options are G_FLOAT on VAX and D_FLOAT or G_FLOAT on 
+Alpha or Itanium.
 
-The use of IEEE on Alpha introduces NaN, infinity, and denormalization
+The use of IEEE on Alpha or Itanium introduces NaN, infinity, and denormalization
 capabilities not available with D_FLOAT and G_FLOAT.  When using one of those
 non-IEEE formats, silent underflow and overflow are emulated in the conversion
 of strings to numbers, but it is preferable to get the real thing by using
@@ -679,58 +618,6 @@
 answer to the "Any additional cc flags?" question.  For example, to obtain a
 G_FLOAT build on VAX, put in C</FLOAT=G_FLOAT>.
 
-=head2 Multinet issues with Perl on VMS
-
-Prior to the release of Perl 5.8.0 it was noted that the regression
-test for lib/Net/hostent (in file [.lib.Net]hostent.t) will fail owing
-to problems with the hostent structure returned by C calls to either
-gethostbyname() or gethostbyaddr() using DEC or Compaq C with a
-Multinet TCP/IP stack.  The problem was noted in Multinet 4.3A
-using either Compaq C 6.5 or DEC C 6.0, and with Multinet 4.2A
-using DEC C 5.2, but could easily affect other versions of Multinet.
-Process Software Inc. has acknowledged a bug in the Multinet version 
-of UCX$IPC_SHR and has provided an ECO for it. The ECO is called
-UCX_LIBRARY_EMULATION-010_A044 and is available from:
-
-    http://www.multinet.process.com/eco.html
-
-As of this writing, the ECO is only available for Multinet versions 
-4.3A and later.  You may determine the version of Multinet that you 
-are running using the command:
-
-    multinet show /version
-
-from the DCL command prompt.
-
-If the ECO is unavailable for your version of Multinet and you are 
-unable to upgrade, you might try using Perl programming constructs 
-such as:
-
-    $address = substr($gethostbyname_addr,0,4);
-
-to temporarily work around the problem, or if you are brave
-and do not mind the possibility of breaking IPv6 addresses,
-you might modify the pp_sys.c file to add an ad-hoc correction
-like so:
-
-
-    --- pp_sys.c;1        Thu May 30 14:42:17 2002
-    +++ pp_sys.c        Thu May 30 12:54:02 2002
-    @@ -4684,6 +4684,10 @@
-             }
-     #endif
-
-    +    if (hent) {
-    +        hent->h_length = 4;
-    +    }
-    +
-         if (GIMME != G_ARRAY) {
-             PUSHs(sv = sv_newmortal());
-             if (hent) {
-
-then re-compile and re-test your perl.  After the installation
-of the Multinet ECO you ought to back out any such changes though.
-
 =head1 Mailing Lists
 
 There are several mailing lists available to the Perl porter.  For VMS
@@ -756,7 +643,6 @@
     http://www.cpan.org/modules/by-module/VMS/
     http://www.xray.mpe.mpg.de/mailing-lists/vmsperl/
     http://www-ang.kfunigraz.ac.at/~binder/perl.html
-    http://lists.perl.org/showlist.cgi?name=vmsperl
     http://archive.develooper.com/vmsperl@perl.org/
     http://h71000.www7.hp.com/openvms/products/ips/apache/csws_modperl.html
 
Index: src/gnu/usr.bin/perl/README.win32
diff -u src/gnu/usr.bin/perl/README.win32:1.11 src/gnu/usr.bin/perl/README.win32:1.12
--- README.win32:1.11	Mon Oct 12 18:24:20 2009
+++ README.win32	Fri Sep 24 15:06:39 2010
@@ -1,1000 +1,1031 @@
-If you read this file _as_is_, just ignore the funny characters you
-see. It is written in the POD format (see pod/perlpod.pod) which is
-specially designed to be readable as is.
-
-=head1 NAME
-
-perlwin32 - Perl under Windows
-
-=head1 SYNOPSIS
-
-These are instructions for building Perl under Windows 9x/NT/2000/XP
-on the Intel x86 and Itanium architectures.
-
-=head1 DESCRIPTION
-
-Before you start, you should glance through the README file
-found in the top-level directory to which the Perl distribution
-was extracted.  Make sure you read and understand the terms under
-which this software is being distributed.
-
-Also make sure you read L<BUGS AND CAVEATS> below for the
-known limitations of this port.
-
-The INSTALL file in the perl top-level has much information that is
-only relevant to people building Perl on Unix-like systems.  In
-particular, you can safely ignore any information that talks about
-"Configure".
-
-You may also want to look at two other options for building
-a perl that will work on Windows NT:  the README.cygwin and
-README.os2 files, each of which give a different set of rules to
-build a Perl that will work on Win32 platforms.  Those two methods
-will probably enable you to build a more Unix-compatible perl, but
-you will also need to download and use various other build-time and
-run-time support software described in those files.
-
-This set of instructions is meant to describe a so-called "native"
-port of Perl to Win32 platforms.  This includes both 32-bit and
-64-bit Windows operating systems.  The resulting Perl requires no
-additional software to run (other than what came with your operating
-system).  Currently, this port is capable of using one of the
-following compilers on the Intel x86 architecture:
-
-      Borland C++           version 5.02 or later
-      Microsoft Visual C++  version 2.0 or later
-      MinGW with gcc        gcc version 2.95.2 or later
-
-The last of these is a high quality freeware compiler.  Use version
-3.2.x or later for the best results with this compiler.
-
-The Borland C++ and Microsoft Visual C++ compilers are also now being given
-away free.  The Borland compiler is available as "Borland C++ Compiler Free
-Command Line Tools" and is the same compiler that ships with the full
-"Borland C++ Builder" product.  The Microsoft compiler is available as
-"Visual C++ Toolkit 2003" or "Visual C++ 2005/2008 Express Edition" (and also
-as part of the ".NET Framework SDK") and is the same compiler that ships with
-"Visual C++ .NET 2003 Professional" or "Visual C++ 2005/2008 Professional"
-respectively.
-
-This port can also be built on the Intel IA64 using:
-
-      Microsoft Platform SDK	Nov 2001 (64-bit compiler and tools)
-
-The MS Platform SDK can be downloaded from http://www.microsoft.com/.
-
-This port fully supports MakeMaker (the set of modules that
-is used to build extensions to perl).  Therefore, you should be
-able to build and install most extensions found in the CPAN sites.
-See L<Usage Hints for Perl on Win32> below for general hints about this.
-
-=head2 Setting Up Perl on Win32
-
-=over 4
-
-=item Make
-
-You need a "make" program to build the sources.  If you are using
-Visual C++ or the Platform SDK tools under Windows NT/2000/XP, nmake
-will work.  All other builds need dmake.
-
-dmake is a freely available make that has very nice macro features
-and parallelability.
-
-A port of dmake for Windows is available from:
-
-    http://search.cpan.org/dist/dmake/
-
-Fetch and install dmake somewhere on your path.
-
-There exists a minor coexistence problem with dmake and Borland C++
-compilers.  Namely, if a distribution has C files named with mixed
-case letters, they will be compiled into appropriate .obj-files named
-with all lowercase letters, and every time dmake is invoked
-to bring files up to date, it will try to recompile such files again.
-For example, Tk distribution has a lot of such files, resulting in
-needless recompiles every time dmake is invoked.  To avoid this, you
-may use the script "sync_ext.pl" after a successful build.  It is
-available in the win32 subdirectory of the Perl source distribution.
-
-=item Command Shell
-
-Use the default "cmd" shell that comes with NT.  Some versions of the
-popular 4DOS/NT shell have incompatibilities that may cause you trouble.
-If the build fails under that shell, try building again with the cmd
-shell.
-
-The nmake Makefile also has known incompatibilities with the
-"command.com" shell that comes with Windows 9x.  You will need to
-use dmake and makefile.mk to build under Windows 9x.
-
-The surest way to build it is on Windows NT/2000/XP, using the cmd shell.
-
-Make sure the path to the build directory does not contain spaces.  The
-build usually works in this circumstance, but some tests will fail.
-
-=item Borland C++
-
-If you are using the Borland compiler, you will need dmake.
-(The make that Borland supplies is seriously crippled and will not
-work for MakeMaker builds.)
-
-See L</"Make"> above.
-
-=item Microsoft Visual C++
-
-The nmake that comes with Visual C++ will suffice for building.
-You will need to run the VCVARS32.BAT file, usually found somewhere
-like C:\MSDEV4.2\BIN or C:\Program Files\Microsoft Visual Studio\VC98\Bin.
-This will set your build environment.
-
-You can also use dmake to build using Visual C++; provided, however,
-you set OSRELEASE to "microsft" (or whatever the directory name
-under which the Visual C dmake configuration lives) in your environment
-and edit win32/config.vc to change "make=nmake" into "make=dmake".  The
-latter step is only essential if you want to use dmake as your default
-make for building extensions using MakeMaker.
-
-=item Microsoft Visual C++ 2008 Express Edition
-
-This free version of Visual C++ 2008 Professional contains the same compiler
-and linker that ship with the full version, and also contains everything
-necessary to build Perl, rather than requiring a separate download of the
-Platform SDK like previous versions did.
-
-This package can be downloaded by searching for "Visual Studio 2008 Express
-Edition" in the Download Center at
-http://www.microsoft.com/downloads/search.aspx?displaylang=en.  (Providing exact
-links to these packages has proven a pointless task because the links keep on
-changing so often.)
-
-Install Visual C++ 2008, then setup your environment using
-
-	C:\Program Files\Microsoft Visual Studio 9.0\Common7\Tools\vsvars32.bat
-
-(assuming the default installation location was chosen).
-
-Perl should now build using the win32/Makefile.  You will need to edit that
-file to set
-
-	CCTYPE = MSVC90FREE
-
-first.
-
-=item Microsoft Visual C++ 2005 Express Edition
-
-This free version of Visual C++ 2005 Professional contains the same compiler
-and linker that ship with the full version, but doesn't contain everything
-necessary to build Perl.
-
-You will also need to download the "Platform SDK" (the "Core SDK" and "MDAC
-SDK" components are required) for more header files and libraries.
-
-These packages can both be downloaded by searching in the Download Center at
-http://www.microsoft.com/downloads/search.aspx?displaylang=en.  (Providing exact
-links to these packages has proven a pointless task because the links keep on
-changing so often.)
-
-Try to obtain the latest version of the Platform SDK.  Sometimes these packages
-contain a particular Windows OS version in their name, but actually work on
-other OS versions too.  For example, the "Windows Server 2003 R2 Platform SDK"
-also runs on Windows XP SP2 and Windows 2000.
-
-According to the download pages these packages are only supported on Windows
-2000/XP/2003, so trying to use these tools on Windows 95/98/ME and even Windows
-NT probably won't work.
-
-Install Visual C++ 2005 first, then the Platform SDK.  Setup your environment
-as follows (assuming default installation locations were chosen):
-
-	SET PlatformSDKDir=C:\Program Files\Microsoft Platform SDK
-
-	SET PATH=%SystemRoot%\system32;%SystemRoot%;C:\Program Files\Microsoft Visual Studio 8\Common7\IDE;C:\Program Files\Microsoft Visual Studio 8\VC\BIN;C:\Program Files\Microsoft Visual Studio 8\Common7\Tools;C:\Program Files\Microsoft Visual Studio 8\SDK\v2.0\bin;C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727;C:\Program Files\Microsoft Visual Studio 8\VC\VCPackages;%PlatformSDKDir%\Bin
-
-	SET INCLUDE=C:\Program Files\Microsoft Visual Studio 8\VC\INCLUDE;%PlatformSDKDir%\include
-
-	SET LIB=C:\Program Files\Microsoft Visual Studio 8\VC\LIB;C:\Program Files\Microsoft Visual Studio 8\SDK\v2.0\lib;%PlatformSDKDir%\lib
-
-	SET LIBPATH=C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727
-
-(The PlatformSDKDir might need to be set differently depending on which version
-you are using. Earlier versions installed into "C:\Program Files\Microsoft SDK",
-while the latest versions install into version-specific locations such as
-"C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2".)
-
-Perl should now build using the win32/Makefile.  You will need to edit that
-file to set
-
-	CCTYPE = MSVC80FREE
-
-and to set CCHOME, CCINCDIR and CCLIBDIR as per the environment setup above.
-
-=item Microsoft Visual C++ Toolkit 2003
-
-This free toolkit contains the same compiler and linker that ship with
-Visual C++ .NET 2003 Professional, but doesn't contain everything
-necessary to build Perl.
-
-You will also need to download the "Platform SDK" (the "Core SDK" and "MDAC
-SDK" components are required) for header files, libraries and rc.exe, and
-".NET Framework SDK" for more libraries and nmake.exe.  Note that the latter
-(which also includes the free compiler and linker) requires the ".NET
-Framework Redistributable" to be installed first.  This can be downloaded and
-installed separately, but is included in the "Visual C++ Toolkit 2003" anyway.
-
-These packages can all be downloaded by searching in the Download Center at
-http://www.microsoft.com/downloads/search.aspx?displaylang=en.  (Providing exact
-links to these packages has proven a pointless task because the links keep on
-changing so often.)
-
-Try to obtain the latest version of the Platform SDK.  Sometimes these packages
-contain a particular Windows OS version in their name, but actually work on
-other OS versions too.  For example, the "Windows Server 2003 R2 Platform SDK"
-also runs on Windows XP SP2 and Windows 2000.
-
-According to the download pages these packages are only supported on Windows
-2000/XP/2003, so trying to use these tools on Windows 95/98/ME and even Windows
-NT probably won't work.
-
-Install the Toolkit first, then the Platform SDK, then the .NET Framework SDK.
-Setup your environment as follows (assuming default installation locations
-were chosen):
-
-	SET PlatformSDKDir=C:\Program Files\Microsoft Platform SDK
-
-	SET PATH=%SystemRoot%\system32;%SystemRoot%;C:\Program Files\Microsoft Visual C++ Toolkit 2003\bin;%PlatformSDKDir%\Bin;C:\Program Files\Microsoft.NET\SDK\v1.1\Bin
-
-	SET INCLUDE=C:\Program Files\Microsoft Visual C++ Toolkit 2003\include;%PlatformSDKDir%\include;C:\Program Files\Microsoft Visual Studio .NET 2003\Vc7\include
-
-	SET LIB=C:\Program Files\Microsoft Visual C++ Toolkit 2003\lib;%PlatformSDKDir%\lib;C:\Program Files\Microsoft Visual Studio .NET 2003\Vc7\lib
-
-(The PlatformSDKDir might need to be set differently depending on which version
-you are using. Earlier versions installed into "C:\Program Files\Microsoft SDK",
-while the latest versions install into version-specific locations such as
-"C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2".)
-
-Several required files will still be missing:
-
-=over 4
-
-=item *
-
-cvtres.exe is required by link.exe when using a .res file.  It is actually
-installed by the .NET Framework SDK, but into a location such as the
-following:
-
-	C:\WINDOWS\Microsoft.NET\Framework\v1.1.4322
-
-Copy it from there to %PlatformSDKDir%\Bin
-
-=item *
-
-lib.exe is normally used to build libraries, but link.exe with the /lib
-option also works, so change win32/config.vc to use it instead:
-
-Change the line reading:
-
-	ar='lib'
-
-to:
-
-	ar='link /lib'
-
-It may also be useful to create a batch file called lib.bat in
-C:\Program Files\Microsoft Visual C++ Toolkit 2003\bin containing:
-
-	@echo off
-	link /lib %*
-
-for the benefit of any naughty C extension modules that you might want to build
-later which explicitly reference "lib" rather than taking their value from
-$Config{ar}.
-
-=item *
-
-setargv.obj is required to build perlglob.exe (and perl.exe if the USE_SETARGV
-option is enabled).  The Platform SDK supplies this object file in source form
-in %PlatformSDKDir%\src\crt.  Copy setargv.c, cruntime.h and
-internal.h from there to some temporary location and build setargv.obj using
-
-	cl.exe /c /I. /D_CRTBLD setargv.c
-
-Then copy setargv.obj to %PlatformSDKDir%\lib
-
-Alternatively, if you don't need perlglob.exe and don't need to enable the
-USE_SETARGV option then you can safely just remove all mention of $(GLOBEXE)
-from win32/Makefile and setargv.obj won't be required anyway.
-
-=back
-
-Perl should now build using the win32/Makefile.  You will need to edit that
-file to set
-
-	CCTYPE = MSVC70FREE
-
-and to set CCHOME, CCINCDIR and CCLIBDIR as per the environment setup above.
-
-=item Microsoft Platform SDK 64-bit Compiler
-
-The nmake that comes with the Platform SDK will suffice for building
-Perl.  Make sure you are building within one of the "Build Environment"
-shells available after you install the Platform SDK from the Start Menu.
-
-=item MinGW release 3 with gcc
-
-The latest release of MinGW at the time of writing is 3.1.0, which contains
-gcc-3.2.3.  It can be downloaded here:
-
-    http://www.mingw.org/
-
-Perl also compiles with earlier releases of gcc (2.95.2 and up).  See below
-for notes about using earlier versions of MinGW/gcc.
-
-You also need dmake.  See L</"Make"> above on how to get it.
-
-=item MinGW release 1 with gcc
-
-The MinGW-1.1 bundle contains gcc-2.95.3.
-
-Make sure you install the binaries that work with MSVCRT.DLL as indicated
-in the README for the GCC bundle.  You may need to set up a few environment
-variables (usually ran from a batch file).
-
-There are a couple of problems with the version of gcc-2.95.2-msvcrt.exe
-released 7 November 1999:
-
-=over
-
-=item *
-
-It left out a fix for certain command line quotes.  To fix this, be sure
-to download and install the file fixes/quote-fix-msvcrt.exe from the above
-ftp location.
-
-=item *
-
-The definition of the fpos_t type in stdio.h may be wrong.  If your
-stdio.h has this problem, you will see an exception when running the
-test t/lib/io_xs.t.  To fix this, change the typedef for fpos_t from
-"long" to "long long" in the file i386-mingw32msvc/include/stdio.h,
-and rebuild.
-
-=back
-
-A potentially simpler to install (but probably soon-to-be-outdated) bundle
-of the above package with the mentioned fixes already applied is available
-here:
-
-    http://downloads.ActiveState.com/pub/staff/gsar/gcc-2.95.2-msvcrt.zip
-    ftp://ftp.ActiveState.com/pub/staff/gsar/gcc-2.95.2-msvcrt.zip
-
-=back
-
-=head2 Building
-
-=over 4
-
-=item *
-
-Make sure you are in the "win32" subdirectory under the perl toplevel.
-This directory contains a "Makefile" that will work with
-versions of nmake that come with Visual C++ or the Platform SDK, and
-a dmake "makefile.mk" that will work for all supported compilers.  The
-defaults in the dmake makefile are setup to build using MinGW/gcc.
-
-=item *
-
-Edit the makefile.mk (or Makefile, if you're using nmake) and change
-the values of INST_DRV and INST_TOP.   You can also enable various
-build flags.  These are explained in the makefiles.
-
-Note that it is generally not a good idea to try to build a perl with
-INST_DRV and INST_TOP set to a path that already exists from a previous
-build.  In particular, this may cause problems with the
-lib/ExtUtils/t/Embed.t test, which attempts to build a test program and
-may end up building against the installed perl's lib/CORE directory rather
-than the one being tested.
-
-You will have to make sure that CCTYPE is set correctly and that
-CCHOME points to wherever you installed your compiler.
-
-The default value for CCHOME in the makefiles for Visual C++
-may not be correct for some versions.  Make sure the default exists
-and is valid.
-
-You may also need to comment out the C<DELAYLOAD = ...> line in the
-Makefile if you're using VC++ 6.0 without the latest service pack and
-the linker reports an internal error.
-
-If you are using VC++ 4.2 or earlier then you'll have to change the /EHsc
-option in the CXX_FLAG macro to the equivalent /GX option.
-
-If you have either the source or a library that contains des_fcrypt(),
-enable the appropriate option in the makefile.  A ready-to-use version
-of fcrypt.c, based on the version originally written by Eric Young at
-ftp://ftp.funet.fi/pub/crypt/mirrors/dsi/libdes/, is bundled with the
-distribution and CRYPT_SRC is set to use it.
-Alternatively, if you have built a library that contains des_fcrypt(),
-you can set CRYPT_LIB to point to the library name.
-Perl will also build without des_fcrypt(), but the crypt() builtin will
-fail at run time.
-
-If you want build some core extensions statically into perl's dll, specify
-them in the STATIC_EXT macro.
-
-Be sure to read the instructions near the top of the makefiles carefully.
-
-=item *
-
-Type "dmake" (or "nmake" if you are using that make).
-
-This should build everything.  Specifically, it will create perl.exe,
-perl510.dll at the perl toplevel, and various other extension dll's
-under the lib\auto directory.  If the build fails for any reason, make
-sure you have done the previous steps correctly.
-
-=back
-
-=head2 Testing Perl on Win32
-
-Type "dmake test" (or "nmake test").  This will run most of the tests from
-the testsuite (many tests will be skipped).
-
-There should be no test failures when running under Windows NT/2000/XP.
-Many tests I<will> fail under Windows 9x due to the inferior command shell.
-
-Some test failures may occur if you use a command shell other than the
-native "cmd.exe", or if you are building from a path that contains
-spaces.  So don't do that.
-
-If you are running the tests from a emacs shell window, you may see
-failures in op/stat.t.  Run "dmake test-notty" in that case.
-
-If you're using the Borland compiler, you may see a failure in op/taint.t
-arising from the inability to find the Borland Runtime DLLs on the system
-default path.  You will need to copy the DLLs reported by the messages
-from where Borland chose to install it, into the Windows system directory
-(usually somewhere like C:\WINNT\SYSTEM32) and rerun the test.
-
-If you're using Borland compiler versions 5.2 and below, you may run into
-problems finding the correct header files when building extensions.  For
-example, building the "Tk" extension may fail because both perl and Tk
-contain a header file called "patchlevel.h".  The latest Borland compiler
-(v5.5) is free of this misbehaviour, and it even supports an
-option -VI- for backward (bugward) compatibility for using the old Borland
-search algorithm  to locate header files.
-
-If you run the tests on a FAT partition, you may see some failures for
-C<link()> related tests (I<op/write.t>, I<op/stat.t> ...). Testing on
-NTFS avoids these errors.
-
-Furthermore, you should make sure that during C<make test> you do not
-have any GNU tool packages in your path: some toolkits like Unixutils
-include some tools (C<type> for instance) which override the Windows
-ones and makes tests fail. Remove them from your path while testing to
-avoid these errors.
-
-Please report any other failures as described under L<BUGS AND CAVEATS>.
-
-=head2 Installation of Perl on Win32
-
-Type "dmake install" (or "nmake install").  This will put the newly
-built perl and the libraries under whatever C<INST_TOP> points to in the
-Makefile.  It will also install the pod documentation under
-C<$INST_TOP\$INST_VER\lib\pod> and HTML versions of the same under
-C<$INST_TOP\$INST_VER\lib\pod\html>.
-
-To use the Perl you just installed you will need to add a new entry to
-your PATH environment variable: C<$INST_TOP\bin>, e.g.
-
-    set PATH=c:\perl\bin;%PATH%
-
-If you opted to uncomment C<INST_VER> and C<INST_ARCH> in the makefile
-then the installation structure is a little more complicated and you will
-need to add two new PATH components instead: C<$INST_TOP\$INST_VER\bin> and
-C<$INST_TOP\$INST_VER\bin\$ARCHNAME>, e.g.
-
-    set PATH=c:\perl\5.6.0\bin;c:\perl\5.6.0\bin\MSWin32-x86;%PATH%
-
-=head2 Usage Hints for Perl on Win32
-
-=over 4
-
-=item Environment Variables
-
-The installation paths that you set during the build get compiled
-into perl, so you don't have to do anything additional to start
-using that perl (except add its location to your PATH variable).
-
-If you put extensions in unusual places, you can set PERL5LIB
-to a list of paths separated by semicolons where you want perl
-to look for libraries.  Look for descriptions of other environment
-variables you can set in L<perlrun>.
-
-You can also control the shell that perl uses to run system() and
-backtick commands via PERL5SHELL.  See L<perlrun>.
-
-Perl does not depend on the registry, but it can look up certain default
-values if you choose to put them there.  Perl attempts to read entries from
-C<HKEY_CURRENT_USER\Software\Perl> and C<HKEY_LOCAL_MACHINE\Software\Perl>.
-Entries in the former override entries in the latter.  One or more of the
-following entries (of type REG_SZ or REG_EXPAND_SZ) may be set:
-
-    lib-$]		version-specific standard library path to add to @INC
-    lib			standard library path to add to @INC
-    sitelib-$]		version-specific site library path to add to @INC
-    sitelib		site library path to add to @INC
-    vendorlib-$]	version-specific vendor library path to add to @INC
-    vendorlib		vendor library path to add to @INC
-    PERL*		fallback for all %ENV lookups that begin with "PERL"
-
-Note the C<$]> in the above is not literal.  Substitute whatever version
-of perl you want to honor that entry, e.g. C<5.6.0>.  Paths must be
-separated with semicolons, as usual on win32.
-
-=item File Globbing
-
-By default, perl handles file globbing using the File::Glob extension,
-which provides portable globbing.
-
-If you want perl to use globbing that emulates the quirks of DOS
-filename conventions, you might want to consider using File::DosGlob
-to override the internal glob() implementation.  See L<File::DosGlob> for
-details.
-
-=item Using perl from the command line
-
-If you are accustomed to using perl from various command-line
-shells found in UNIX environments, you will be less than pleased
-with what Windows offers by way of a command shell.
-
-The crucial thing to understand about the Windows environment is that
-the command line you type in is processed twice before Perl sees it.
-First, your command shell (usually CMD.EXE on Windows NT, and
-COMMAND.COM on Windows 9x) preprocesses the command line, to handle
-redirection, environment variable expansion, and location of the
-executable to run. Then, the perl executable splits the remaining
-command line into individual arguments, using the C runtime library
-upon which Perl was built.
-
-It is particularly important to note that neither the shell nor the C
-runtime do any wildcard expansions of command-line arguments (so
-wildcards need not be quoted).  Also, the quoting behaviours of the
-shell and the C runtime are rudimentary at best (and may, if you are
-using a non-standard shell, be inconsistent).  The only (useful) quote
-character is the double quote (").  It can be used to protect spaces
-and other special characters in arguments.
-
-The Windows NT documentation has almost no description of how the
-quoting rules are implemented, but here are some general observations
-based on experiments: The C runtime breaks arguments at spaces and
-passes them to programs in argc/argv.  Double quotes can be used to
-prevent arguments with spaces in them from being split up.  You can
-put a double quote in an argument by escaping it with a backslash and
-enclosing the whole argument within double quotes.  The backslash and
-the pair of double quotes surrounding the argument will be stripped by
-the C runtime.
-
-The file redirection characters "E<lt>", "E<gt>", and "|" can be quoted by
-double quotes (although there are suggestions that this may not always
-be true).  Single quotes are not treated as quotes by the shell or
-the C runtime, they don't get stripped by the shell (just to make
-this type of quoting completely useless).  The caret "^" has also
-been observed to behave as a quoting character, but this appears
-to be a shell feature, and the caret is not stripped from the command
-line, so Perl still sees it (and the C runtime phase does not treat
-the caret as a quote character).
-
-Here are some examples of usage of the "cmd" shell:
-
-This prints two doublequotes:
-
-    perl -e "print '\"\"' "
-
-This does the same:
-
-    perl -e "print \"\\\"\\\"\" "
-
-This prints "bar" and writes "foo" to the file "blurch":
-
-    perl -e "print 'foo'; print STDERR 'bar'" > blurch
-
-This prints "foo" ("bar" disappears into nowhereland):
-
-    perl -e "print 'foo'; print STDERR 'bar'" 2> nul
-
-This prints "bar" and writes "foo" into the file "blurch":
-
-    perl -e "print 'foo'; print STDERR 'bar'" 1> blurch
-
-This pipes "foo" to the "less" pager and prints "bar" on the console:
-
-    perl -e "print 'foo'; print STDERR 'bar'" | less
-
-This pipes "foo\nbar\n" to the less pager:
-
-    perl -le "print 'foo'; print STDERR 'bar'" 2>&1 | less
-
-This pipes "foo" to the pager and writes "bar" in the file "blurch":
-
-    perl -e "print 'foo'; print STDERR 'bar'" 2> blurch | less
-
-
-Discovering the usefulness of the "command.com" shell on Windows 9x
-is left as an exercise to the reader :)
-
-One particularly pernicious problem with the 4NT command shell for
-Windows NT is that it (nearly) always treats a % character as indicating
-that environment variable expansion is needed.  Under this shell, it is
-therefore important to always double any % characters which you want
-Perl to see (for example, for hash variables), even when they are
-quoted.
-
-=item Building Extensions
-
-The Comprehensive Perl Archive Network (CPAN) offers a wealth
-of extensions, some of which require a C compiler to build.
-Look in http://www.cpan.org/ for more information on CPAN.
-
-Note that not all of the extensions available from CPAN may work
-in the Win32 environment; you should check the information at
-http://testers.cpan.org/ before investing too much effort into
-porting modules that don't readily build.
-
-Most extensions (whether they require a C compiler or not) can
-be built, tested and installed with the standard mantra:
-
-    perl Makefile.PL
-    $MAKE
-    $MAKE test
-    $MAKE install
-
-where $MAKE is whatever 'make' program you have configured perl to
-use.  Use "perl -V:make" to find out what this is.  Some extensions
-may not provide a testsuite (so "$MAKE test" may not do anything or
-fail), but most serious ones do.
-
-It is important that you use a supported 'make' program, and
-ensure Config.pm knows about it.  If you don't have nmake, you can
-either get dmake from the location mentioned earlier or get an
-old version of nmake reportedly available from:
-
- http://download.microsoft.com/download/vc15/Patch/1.52/W95/EN-US/nmake15.exe
-
-Another option is to use the make written in Perl, available from
-CPAN.
-
-    http://www.cpan.org/modules/by-module/Make/
-
-You may also use dmake.  See L</"Make"> above on how to get it.
-
-Note that MakeMaker actually emits makefiles with different syntax
-depending on what 'make' it thinks you are using.  Therefore, it is
-important that one of the following values appears in Config.pm:
-
-    make='nmake'	# MakeMaker emits nmake syntax
-    make='dmake'	# MakeMaker emits dmake syntax
-    any other value	# MakeMaker emits generic make syntax
-    			    (e.g GNU make, or Perl make)
-
-If the value doesn't match the 'make' program you want to use,
-edit Config.pm to fix it.
-
-If a module implements XSUBs, you will need one of the supported
-C compilers.  You must make sure you have set up the environment for
-the compiler for command-line compilation.
-
-If a module does not build for some reason, look carefully for
-why it failed, and report problems to the module author.  If
-it looks like the extension building support is at fault, report
-that with full details of how the build failed using the perlbug
-utility.
-
-=item Command-line Wildcard Expansion
-
-The default command shells on DOS descendant operating systems (such
-as they are) usually do not expand wildcard arguments supplied to
-programs.  They consider it the application's job to handle that.
-This is commonly achieved by linking the application (in our case,
-perl) with startup code that the C runtime libraries usually provide.
-However, doing that results in incompatible perl versions (since the
-behavior of the argv expansion code differs depending on the
-compiler, and it is even buggy on some compilers).  Besides, it may
-be a source of frustration if you use such a perl binary with an
-alternate shell that *does* expand wildcards.
-
-Instead, the following solution works rather well. The nice things
-about it are 1) you can start using it right away; 2) it is more
-powerful, because it will do the right thing with a pattern like
-*/*/*.c; 3) you can decide whether you do/don't want to use it; and
-4) you can extend the method to add any customizations (or even
-entirely different kinds of wildcard expansion).
-
-	C:\> copy con c:\perl\lib\Wild.pm
-	# Wild.pm - emulate shell @ARGV expansion on shells that don't
-	use File::DosGlob;
-	@ARGV = map {
-		      my @g = File::DosGlob::glob($_) if /[*?]/;
-		      @g ? @g : $_;
-		    } @ARGV;
-	1;
-	^Z
-	C:\> set PERL5OPT=-MWild
-	C:\> perl -le "for (@ARGV) { print }" */*/perl*.c
-	p4view/perl/perl.c
-	p4view/perl/perlio.c
-	p4view/perl/perly.c
-	perl5.005/win32/perlglob.c
-	perl5.005/win32/perllib.c
-	perl5.005/win32/perlglob.c
-	perl5.005/win32/perllib.c
-	perl5.005/win32/perlglob.c
-	perl5.005/win32/perllib.c
-
-Note there are two distinct steps there: 1) You'll have to create
-Wild.pm and put it in your perl lib directory. 2) You'll need to
-set the PERL5OPT environment variable.  If you want argv expansion
-to be the default, just set PERL5OPT in your default startup
-environment.
-
-If you are using the Visual C compiler, you can get the C runtime's
-command line wildcard expansion built into perl binary.  The resulting
-binary will always expand unquoted command lines, which may not be
-what you want if you use a shell that does that for you.  The expansion
-done is also somewhat less powerful than the approach suggested above.
-
-=item Win32 Specific Extensions
-
-A number of extensions specific to the Win32 platform are available
-from CPAN.  You may find that many of these extensions are meant to
-be used under the Activeware port of Perl, which used to be the only
-native port for the Win32 platform.  Since the Activeware port does not
-have adequate support for Perl's extension building tools, these
-extensions typically do not support those tools either and, therefore,
-cannot be built using the generic steps shown in the previous section.
-
-To ensure smooth transitioning of existing code that uses the
-ActiveState port, there is a bundle of Win32 extensions that contains
-all of the ActiveState extensions and several other Win32 extensions from
-CPAN in source form, along with many added bugfixes, and with MakeMaker
-support.  The latest version of this bundle is available at:
-
-    http://search.cpan.org/dist/libwin32/
-
-See the README in that distribution for building and installation
-instructions.
-
-=item Notes on 64-bit Windows
-
-Windows .NET Server supports the LLP64 data model on the Intel Itanium
-architecture.
-
-The LLP64 data model is different from the LP64 data model that is the
-norm on 64-bit Unix platforms.  In the former, C<int> and C<long> are
-both 32-bit data types, while pointers are 64 bits wide.  In addition,
-there is a separate 64-bit wide integral type, C<__int64>.  In contrast,
-the LP64 data model that is pervasive on Unix platforms provides C<int>
-as the 32-bit type, while both the C<long> type and pointers are of
-64-bit precision.  Note that both models provide for 64-bits of
-addressability.
-
-64-bit Windows running on Itanium is capable of running 32-bit x86
-binaries transparently.  This means that you could use a 32-bit build
-of Perl on a 64-bit system.  Given this, why would one want to build
-a 64-bit build of Perl?  Here are some reasons why you would bother:
-
-=over
-
-=item *
-
-A 64-bit native application will run much more efficiently on
-Itanium hardware.
-
-=item *
-
-There is no 2GB limit on process size.
-
-=item *
-
-Perl automatically provides large file support when built under
-64-bit Windows.
-
-=item *
-
-Embedding Perl inside a 64-bit application.
-
-=back
-
-=back
-
-=head2 Running Perl Scripts
-
-Perl scripts on UNIX use the "#!" (a.k.a "shebang") line to
-indicate to the OS that it should execute the file using perl.
-Win32 has no comparable means to indicate arbitrary files are
-executables.
-
-Instead, all available methods to execute plain text files on
-Win32 rely on the file "extension".  There are three methods
-to use this to execute perl scripts:
-
-=over 8
-
-=item 1
-
-There is a facility called "file extension associations" that will
-work in Windows NT 4.0.  This can be manipulated via the two
-commands "assoc" and "ftype" that come standard with Windows NT
-4.0.  Type "ftype /?" for a complete example of how to set this
-up for perl scripts (Say what?  You thought Windows NT wasn't
-perl-ready? :).
-
-=item 2
-
-Since file associations don't work everywhere, and there are
-reportedly bugs with file associations where it does work, the
-old method of wrapping the perl script to make it look like a
-regular batch file to the OS, may be used.  The install process
-makes available the "pl2bat.bat" script which can be used to wrap
-perl scripts into batch files.  For example:
-
-	pl2bat foo.pl
-
-will create the file "FOO.BAT".  Note "pl2bat" strips any
-.pl suffix and adds a .bat suffix to the generated file.
-
-If you use the 4DOS/NT or similar command shell, note that
-"pl2bat" uses the "%*" variable in the generated batch file to
-refer to all the command line arguments, so you may need to make
-sure that construct works in batch files.  As of this writing,
-4DOS/NT users will need a "ParameterChar = *" statement in their
-4NT.INI file or will need to execute "setdos /p*" in the 4DOS/NT
-startup file to enable this to work.
-
-=item 3
-
-Using "pl2bat" has a few problems:  the file name gets changed,
-so scripts that rely on C<$0> to find what they must do may not
-run properly; running "pl2bat" replicates the contents of the
-original script, and so this process can be maintenance intensive
-if the originals get updated often.  A different approach that
-avoids both problems is possible.
-
-A script called "runperl.bat" is available that can be copied
-to any filename (along with the .bat suffix).  For example,
-if you call it "foo.bat", it will run the file "foo" when it is
-executed.  Since you can run batch files on Win32 platforms simply
-by typing the name (without the extension), this effectively
-runs the file "foo", when you type either "foo" or "foo.bat".
-With this method, "foo.bat" can even be in a different location
-than the file "foo", as long as "foo" is available somewhere on
-the PATH.  If your scripts are on a filesystem that allows symbolic
-links, you can even avoid copying "runperl.bat".
-
-Here's a diversion:  copy "runperl.bat" to "runperl", and type
-"runperl".  Explain the observed behavior, or lack thereof. :)
-Hint: .gnidnats llits er'uoy fi ,"lrepnur" eteled :tniH
-
-=back
-
-=head2 Miscellaneous Things
-
-A full set of HTML documentation is installed, so you should be
-able to use it if you have a web browser installed on your
-system.
-
-C<perldoc> is also a useful tool for browsing information contained
-in the documentation, especially in conjunction with a pager
-like C<less> (recent versions of which have Win32 support).  You may
-have to set the PAGER environment variable to use a specific pager.
-"perldoc -f foo" will print information about the perl operator
-"foo".
-
-One common mistake when using this port with a GUI library like C<Tk>
-is assuming that Perl's normal behavior of opening a command-line
-window will go away.  This isn't the case.  If you want to start a copy
-of C<perl> without opening a command-line window, use the C<wperl>
-executable built during the installation process.  Usage is exactly
-the same as normal C<perl> on Win32, except that options like C<-h>
-don't work (since they need a command-line window to print to).
-
-If you find bugs in perl, you can run C<perlbug> to create a
-bug report (you may have to send it manually if C<perlbug> cannot
-find a mailer on your system).
-
-=head1 BUGS AND CAVEATS
-
-Norton AntiVirus interferes with the build process, particularly if
-set to "AutoProtect, All Files, when Opened". Unlike large applications
-the perl build process opens and modifies a lot of files. Having the
-the AntiVirus scan each and every one slows build the process significantly.
-Worse, with PERLIO=stdio the build process fails with peculiar messages
-as the virus checker interacts badly with miniperl.exe writing configure
-files (it seems to either catch file part written and treat it as suspicious,
-or virus checker may have it "locked" in a way which inhibits miniperl
-updating it). The build does complete with
-
-   set PERLIO=perlio
-
-but that may be just luck. Other AntiVirus software may have similar issues.
-
-Some of the built-in functions do not act exactly as documented in
-L<perlfunc>, and a few are not implemented at all.  To avoid
-surprises, particularly if you have had prior exposure to Perl
-in other operating environments or if you intend to write code
-that will be portable to other environments, see L<perlport>
-for a reasonably definitive list of these differences.
-
-Not all extensions available from CPAN may build or work properly
-in the Win32 environment.  See L</"Building Extensions">.
-
-Most C<socket()> related calls are supported, but they may not
-behave as on Unix platforms.  See L<perlport> for the full list.
-Perl requires Winsock2 to be installed on the system. If you're
-running Win95, you can download Winsock upgrade from here:
-
-http://www.microsoft.com/windows95/downloads/contents/WUAdminTools/S_WUNetworkingTools/W95Sockets2/Default.asp
-
-Later OS versions already include Winsock2 support.
-
-Signal handling may not behave as on Unix platforms (where it
-doesn't exactly "behave", either :).  For instance, calling C<die()>
-or C<exit()> from signal handlers will cause an exception, since most
-implementations of C<signal()> on Win32 are severely crippled.
-Thus, signals may work only for simple things like setting a flag
-variable in the handler.  Using signals under this port should
-currently be considered unsupported.
-
-Please send detailed descriptions of any problems and solutions that
-you may find to E<lt>F<perlbug@perl.org>E<gt>, along with the output
-produced by C<perl -V>.
-
-=head1 ACKNOWLEDGEMENTS
-
-The use of a camel with the topic of Perl is a trademark
-of O'Reilly and Associates, Inc. Used with permission.
-
-=head1 AUTHORS
-
-=over 4
-
-=item Gary Ng E<lt>71564.1743@CompuServe.COME<gt>
-
-=item Gurusamy Sarathy E<lt>gsar@activestate.comE<gt>
-
-=item Nick Ing-Simmons E<lt>nick@ing-simmons.netE<gt>
-
-=item Jan Dubois E<lt>jand@activestate.comE<gt>
-
-=item Steve Hay E<lt>steve.hay@uk.radan.comE<gt>
-
-=back
-
-This document is maintained by Jan Dubois.
-
-=head1 SEE ALSO
-
-L<perl>
-
-=head1 HISTORY
-
-This port was originally contributed by Gary Ng around 5.003_24,
-and borrowed from the Hip Communications port that was available
-at the time.  Various people have made numerous and sundry hacks
-since then.
-
-Borland support was added in 5.004_01 (Gurusamy Sarathy).
-
-GCC/mingw32 support was added in 5.005 (Nick Ing-Simmons).
-
-Support for PERL_OBJECT was added in 5.005 (ActiveState Tool Corp).
-
-Support for fork() emulation was added in 5.6 (ActiveState Tool Corp).
-
-Win9x support was added in 5.6 (Benjamin Stuhl).
-
-Support for 64-bit Windows added in 5.8 (ActiveState Corp).
-
-Last updated: 29 August 2007
-
-=cut
+If you read this file _as_is_, just ignore the funny characters you
+see. It is written in the POD format (see pod/perlpod.pod) which is
+specially designed to be readable as is.
+
+=head1 NAME
+
+perlwin32 - Perl under Windows
+
+=head1 SYNOPSIS
+
+These are instructions for building Perl under Windows 9x/NT/2000/XP
+on the Intel x86 and Itanium architectures.
+
+=head1 DESCRIPTION
+
+Before you start, you should glance through the README file
+found in the top-level directory to which the Perl distribution
+was extracted.  Make sure you read and understand the terms under
+which this software is being distributed.
+
+Also make sure you read L<BUGS AND CAVEATS> below for the
+known limitations of this port.
+
+The INSTALL file in the perl top-level has much information that is
+only relevant to people building Perl on Unix-like systems.  In
+particular, you can safely ignore any information that talks about
+"Configure".
+
+You may also want to look at two other options for building
+a perl that will work on Windows NT:  the README.cygwin and
+README.os2 files, each of which give a different set of rules to
+build a Perl that will work on Win32 platforms.  Those two methods
+will probably enable you to build a more Unix-compatible perl, but
+you will also need to download and use various other build-time and
+run-time support software described in those files.
+
+This set of instructions is meant to describe a so-called "native"
+port of Perl to Win32 platforms.  This includes both 32-bit and
+64-bit Windows operating systems.  The resulting Perl requires no
+additional software to run (other than what came with your operating
+system).  Currently, this port is capable of using one of the
+following compilers on the Intel x86 architecture:
+
+      Borland C++           version 5.02 or later
+      Microsoft Visual C++  version 2.0 or later
+      MinGW with gcc        gcc version 2.95.2 or later
+      Gcc by mingw.org        gcc version 2.95.2 or later
+      Gcc by mingw-w64.sf.net gcc version 4.4.3 or later
+
+Note that the last two of these are actually competing projects both
+delivering complete gcc toolchain for MS Windows:
+- http://mingw.org - delivers gcc toolchain targeting 32-bit Windows
+  platform.
+  Use version 3.2.x or later for the best results with this compiler.
+- http://mingw-w64.sf.net - delivers gcc toolchain targeting both 64-bit
+  Windows and 32-bit Windows platforms (despite the project name "mingw-w64"
+  they are not only 64-bit oriented). They deliver the native gcc compilers
+  + cross-compilers that are also supported by perl's makefile.
+
+The Borland C++ and Microsoft Visual C++ compilers are also now being given
+away free.  The Borland compiler is available as "Borland C++ Compiler Free
+Command Line Tools" and is the same compiler that ships with the full
+"Borland C++ Builder" product.  The Microsoft compiler is available as
+"Visual C++ Toolkit 2003" or "Visual C++ 2005/2008 Express Edition" (and also
+as part of the ".NET Framework SDK") and is the same compiler that ships with
+"Visual C++ .NET 2003 Professional" or "Visual C++ 2005/2008 Professional"
+respectively.
+
+This port can also be built on IA64/AMD64 using:
+
+      Microsoft Platform SDK	Nov 2001 (64-bit compiler and tools)
+      MinGW64 compiler (gcc version 4.4.3 or later)
+
+The MS Platform SDK can be downloaded from http://www.microsoft.com/.
+The MinGW64 compiler is available at http://sourceforge.net/projects/mingw-w64.
+The latter is actually a cross-compiler targeting Win64. There's also a trimmed
+down compiler (no java, or gfortran) suitable for building perl available at:
+http://strawberryperl.com/package/kmx/64_gcctoolchain/mingw64-w64-20100123-kmx-v2.zip
+
+NOTE: If you're using a 32-bit compiler to build perl on a 64-bit Windows
+operating system, then you should set the WIN64 environment variable to "undef".
+Also, the trimmed down compiler only passes tests when USE_ITHREADS *= define
+(as opposed to undef) and when the CFG *= Debug line is commented out.
+
+This port fully supports MakeMaker (the set of modules that
+is used to build extensions to perl).  Therefore, you should be
+able to build and install most extensions found in the CPAN sites.
+See L<Usage Hints for Perl on Win32> below for general hints about this.
+
+=head2 Setting Up Perl on Win32
+
+=over 4
+
+=item Make
+
+You need a "make" program to build the sources.  If you are using
+Visual C++ or the Platform SDK tools under Windows NT/2000/XP, nmake
+will work.  All other builds need dmake.
+
+dmake is a freely available make that has very nice macro features
+and parallelability.
+
+A port of dmake for Windows is available from:
+
+    http://search.cpan.org/dist/dmake/
+
+Fetch and install dmake somewhere on your path.
+
+There exists a minor coexistence problem with dmake and Borland C++
+compilers.  Namely, if a distribution has C files named with mixed
+case letters, they will be compiled into appropriate .obj-files named
+with all lowercase letters, and every time dmake is invoked
+to bring files up to date, it will try to recompile such files again.
+For example, Tk distribution has a lot of such files, resulting in
+needless recompiles every time dmake is invoked.  To avoid this, you
+may use the script "sync_ext.pl" after a successful build.  It is
+available in the win32 subdirectory of the Perl source distribution.
+
+=item Command Shell
+
+Use the default "cmd" shell that comes with NT.  Some versions of the
+popular 4DOS/NT shell have incompatibilities that may cause you trouble.
+If the build fails under that shell, try building again with the cmd
+shell.
+
+The nmake Makefile also has known incompatibilities with the
+"command.com" shell that comes with Windows 9x.  You will need to
+use dmake and makefile.mk to build under Windows 9x.
+
+The surest way to build it is on Windows NT/2000/XP, using the cmd shell.
+
+Make sure the path to the build directory does not contain spaces.  The
+build usually works in this circumstance, but some tests will fail.
+
+=item Borland C++
+
+If you are using the Borland compiler, you will need dmake.
+(The make that Borland supplies is seriously crippled and will not
+work for MakeMaker builds.)
+
+See L</"Make"> above.
+
+=item Microsoft Visual C++
+
+The nmake that comes with Visual C++ will suffice for building.
+You will need to run the VCVARS32.BAT file, usually found somewhere
+like C:\MSDEV4.2\BIN or C:\Program Files\Microsoft Visual Studio\VC98\Bin.
+This will set your build environment.
+
+You can also use dmake to build using Visual C++; provided, however,
+you set OSRELEASE to "microsft" (or whatever the directory name
+under which the Visual C dmake configuration lives) in your environment
+and edit win32/config.vc to change "make=nmake" into "make=dmake".  The
+latter step is only essential if you want to use dmake as your default
+make for building extensions using MakeMaker.
+
+=item Microsoft Visual C++ 2008 Express Edition
+
+This free version of Visual C++ 2008 Professional contains the same compiler
+and linker that ship with the full version, and also contains everything
+necessary to build Perl, rather than requiring a separate download of the
+Platform SDK like previous versions did.
+
+This package can be downloaded by searching for "Visual Studio 2008 Express
+Edition" in the Download Center at
+http://www.microsoft.com/downloads/search.aspx?displaylang=en.  (Providing exact
+links to these packages has proven a pointless task because the links keep on
+changing so often.)
+
+Install Visual C++ 2008, then setup your environment using
+
+	C:\Program Files\Microsoft Visual Studio 9.0\Common7\Tools\vsvars32.bat
+
+(assuming the default installation location was chosen).
+
+Perl should now build using the win32/Makefile.  You will need to edit that
+file to set
+
+	CCTYPE = MSVC90FREE
+
+first.
+
+=item Microsoft Visual C++ 2005 Express Edition
+
+This free version of Visual C++ 2005 Professional contains the same compiler
+and linker that ship with the full version, but doesn't contain everything
+necessary to build Perl.
+
+You will also need to download the "Platform SDK" (the "Core SDK" and "MDAC
+SDK" components are required) for more header files and libraries.
+
+These packages can both be downloaded by searching in the Download Center at
+http://www.microsoft.com/downloads/search.aspx?displaylang=en.  (Providing exact
+links to these packages has proven a pointless task because the links keep on
+changing so often.)
+
+Try to obtain the latest version of the Platform SDK.  Sometimes these packages
+contain a particular Windows OS version in their name, but actually work on
+other OS versions too.  For example, the "Windows Server 2003 R2 Platform SDK"
+also runs on Windows XP SP2 and Windows 2000.
+
+According to the download pages these packages are only supported on Windows
+2000/XP/2003, so trying to use these tools on Windows 95/98/ME and even Windows
+NT probably won't work.
+
+Install Visual C++ 2005 first, then the Platform SDK.  Setup your environment
+as follows (assuming default installation locations were chosen):
+
+	SET PlatformSDKDir=C:\Program Files\Microsoft Platform SDK
+
+	SET PATH=%SystemRoot%\system32;%SystemRoot%;C:\Program Files\Microsoft Visual Studio 8\Common7\IDE;C:\Program Files\Microsoft Visual Studio 8\VC\BIN;C:\Program Files\Microsoft Visual Studio 8\Common7\Tools;C:\Program Files\Microsoft Visual Studio 8\SDK\v2.0\bin;C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727;C:\Program Files\Microsoft Visual Studio 8\VC\VCPackages;%PlatformSDKDir%\Bin
+
+	SET INCLUDE=C:\Program Files\Microsoft Visual Studio 8\VC\INCLUDE;%PlatformSDKDir%\include
+
+	SET LIB=C:\Program Files\Microsoft Visual Studio 8\VC\LIB;C:\Program Files\Microsoft Visual Studio 8\SDK\v2.0\lib;%PlatformSDKDir%\lib
+
+	SET LIBPATH=C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727
+
+(The PlatformSDKDir might need to be set differently depending on which version
+you are using. Earlier versions installed into "C:\Program Files\Microsoft SDK",
+while the latest versions install into version-specific locations such as
+"C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2".)
+
+Perl should now build using the win32/Makefile.  You will need to edit that
+file to set
+
+	CCTYPE = MSVC80FREE
+
+and to set CCHOME, CCINCDIR and CCLIBDIR as per the environment setup above.
+
+=item Microsoft Visual C++ Toolkit 2003
+
+This free toolkit contains the same compiler and linker that ship with
+Visual C++ .NET 2003 Professional, but doesn't contain everything
+necessary to build Perl.
+
+You will also need to download the "Platform SDK" (the "Core SDK" and "MDAC
+SDK" components are required) for header files, libraries and rc.exe, and
+".NET Framework SDK" for more libraries and nmake.exe.  Note that the latter
+(which also includes the free compiler and linker) requires the ".NET
+Framework Redistributable" to be installed first.  This can be downloaded and
+installed separately, but is included in the "Visual C++ Toolkit 2003" anyway.
+
+These packages can all be downloaded by searching in the Download Center at
+http://www.microsoft.com/downloads/search.aspx?displaylang=en.  (Providing exact
+links to these packages has proven a pointless task because the links keep on
+changing so often.)
+
+Try to obtain the latest version of the Platform SDK.  Sometimes these packages
+contain a particular Windows OS version in their name, but actually work on
+other OS versions too.  For example, the "Windows Server 2003 R2 Platform SDK"
+also runs on Windows XP SP2 and Windows 2000.
+
+According to the download pages these packages are only supported on Windows
+2000/XP/2003, so trying to use these tools on Windows 95/98/ME and even Windows
+NT probably won't work.
+
+Install the Toolkit first, then the Platform SDK, then the .NET Framework SDK.
+Setup your environment as follows (assuming default installation locations
+were chosen):
+
+	SET PlatformSDKDir=C:\Program Files\Microsoft Platform SDK
+
+	SET PATH=%SystemRoot%\system32;%SystemRoot%;C:\Program Files\Microsoft Visual C++ Toolkit 2003\bin;%PlatformSDKDir%\Bin;C:\Program Files\Microsoft.NET\SDK\v1.1\Bin
+
+	SET INCLUDE=C:\Program Files\Microsoft Visual C++ Toolkit 2003\include;%PlatformSDKDir%\include;C:\Program Files\Microsoft Visual Studio .NET 2003\Vc7\include
+
+	SET LIB=C:\Program Files\Microsoft Visual C++ Toolkit 2003\lib;%PlatformSDKDir%\lib;C:\Program Files\Microsoft Visual Studio .NET 2003\Vc7\lib
+
+(The PlatformSDKDir might need to be set differently depending on which version
+you are using. Earlier versions installed into "C:\Program Files\Microsoft SDK",
+while the latest versions install into version-specific locations such as
+"C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2".)
+
+Several required files will still be missing:
+
+=over 4
+
+=item *
+
+cvtres.exe is required by link.exe when using a .res file.  It is actually
+installed by the .NET Framework SDK, but into a location such as the
+following:
+
+	C:\WINDOWS\Microsoft.NET\Framework\v1.1.4322
+
+Copy it from there to %PlatformSDKDir%\Bin
+
+=item *
+
+lib.exe is normally used to build libraries, but link.exe with the /lib
+option also works, so change win32/config.vc to use it instead:
+
+Change the line reading:
+
+	ar='lib'
+
+to:
+
+	ar='link /lib'
+
+It may also be useful to create a batch file called lib.bat in
+C:\Program Files\Microsoft Visual C++ Toolkit 2003\bin containing:
+
+	@echo off
+	link /lib %*
+
+for the benefit of any naughty C extension modules that you might want to build
+later which explicitly reference "lib" rather than taking their value from
+$Config{ar}.
+
+=item *
+
+setargv.obj is required to build perlglob.exe (and perl.exe if the USE_SETARGV
+option is enabled).  The Platform SDK supplies this object file in source form
+in %PlatformSDKDir%\src\crt.  Copy setargv.c, cruntime.h and
+internal.h from there to some temporary location and build setargv.obj using
+
+	cl.exe /c /I. /D_CRTBLD setargv.c
+
+Then copy setargv.obj to %PlatformSDKDir%\lib
+
+Alternatively, if you don't need perlglob.exe and don't need to enable the
+USE_SETARGV option then you can safely just remove all mention of $(GLOBEXE)
+from win32/Makefile and setargv.obj won't be required anyway.
+
+=back
+
+Perl should now build using the win32/Makefile.  You will need to edit that
+file to set
+
+	CCTYPE = MSVC70FREE
+
+and to set CCHOME, CCINCDIR and CCLIBDIR as per the environment setup above.
+
+=item Microsoft Platform SDK 64-bit Compiler
+
+The nmake that comes with the Platform SDK will suffice for building
+Perl.  Make sure you are building within one of the "Build Environment"
+shells available after you install the Platform SDK from the Start Menu.
+
+=item MinGW release 3 with gcc
+
+The latest release of MinGW at the time of writing is 3.1.0, which contains
+gcc-3.2.3.  It can be downloaded here:
+
+    http://www.mingw.org/
+
+Perl also compiles with earlier releases of gcc (2.95.2 and up).  See below
+for notes about using earlier versions of MinGW/gcc.
+
+And perl also compiles with gcc-4.3.0 and up, and perhaps even some of the
+earlier 4.x.x versions.
+
+You also need dmake.  See L</"Make"> above on how to get it.
+
+=item MinGW release 1 with gcc
+
+The MinGW-1.1 bundle contains gcc-2.95.3.
+
+Make sure you install the binaries that work with MSVCRT.DLL as indicated
+in the README for the GCC bundle.  You may need to set up a few environment
+variables (usually ran from a batch file).
+
+There are a couple of problems with the version of gcc-2.95.2-msvcrt.exe
+released 7 November 1999:
+
+=over
+
+=item *
+
+It left out a fix for certain command line quotes.  To fix this, be sure
+to download and install the file fixes/quote-fix-msvcrt.exe from the above
+ftp location.
+
+=item *
+
+The definition of the fpos_t type in stdio.h may be wrong.  If your
+stdio.h has this problem, you will see an exception when running the
+test t/lib/io_xs.t.  To fix this, change the typedef for fpos_t from
+"long" to "long long" in the file i386-mingw32msvc/include/stdio.h,
+and rebuild.
+
+=back
+
+A potentially simpler to install (but probably soon-to-be-outdated) bundle
+of the above package with the mentioned fixes already applied is available
+here:
+
+    http://downloads.ActiveState.com/pub/staff/gsar/gcc-2.95.2-msvcrt.zip
+    ftp://ftp.ActiveState.com/pub/staff/gsar/gcc-2.95.2-msvcrt.zip
+
+=back
+
+=head2 Building
+
+=over 4
+
+=item *
+
+Make sure you are in the "win32" subdirectory under the perl toplevel.
+This directory contains a "Makefile" that will work with
+versions of nmake that come with Visual C++ or the Platform SDK, and
+a dmake "makefile.mk" that will work for all supported compilers.  The
+defaults in the dmake makefile are setup to build using MinGW/gcc.
+
+=item *
+
+Edit the makefile.mk (or Makefile, if you're using nmake) and change
+the values of INST_DRV and INST_TOP.   You can also enable various
+build flags.  These are explained in the makefiles.
+
+Note that it is generally not a good idea to try to build a perl with
+INST_DRV and INST_TOP set to a path that already exists from a previous
+build.  In particular, this may cause problems with the
+lib/ExtUtils/t/Embed.t test, which attempts to build a test program and
+may end up building against the installed perl's lib/CORE directory rather
+than the one being tested.
+
+You will have to make sure that CCTYPE is set correctly and that
+CCHOME points to wherever you installed your compiler. If building with
+gcc-4.x.x, you'll also need to uncomment the assignment to GCC_4XX and
+uncomment the assignment to the appropriate GCCHELPERDLL in the makefile.mk.
+
+If building with the cross-compiler provided by
+mingw-w64.sourceforge.net you'll need to uncomment the line that sets
+GCCCROSS in the makefile.mk. Do this only if it's the cross-compiler - ie
+only if the bin folder doesn't contain a gcc.exe. (The cross-compiler
+does not provide a gcc.exe, g++.exe, ar.exe, etc. Instead, all of these
+executables are prefixed with 'x86_64-w64-mingw32-'.)
+
+The default value for CCHOME in the makefiles for Visual C++
+may not be correct for some versions.  Make sure the default exists
+and is valid.
+
+You may also need to comment out the C<DELAYLOAD = ...> line in the
+Makefile if you're using VC++ 6.0 without the latest service pack and
+the linker reports an internal error.
+
+If you are using VC++ 4.2 or earlier then you'll have to change the /EHsc
+option in the CXX_FLAG macro to the equivalent /GX option.
+
+If you have either the source or a library that contains des_fcrypt(),
+enable the appropriate option in the makefile.  A ready-to-use version
+of fcrypt.c, based on the version originally written by Eric Young at
+ftp://ftp.funet.fi/pub/crypt/mirrors/dsi/libdes/, is bundled with the
+distribution and CRYPT_SRC is set to use it.
+Alternatively, if you have built a library that contains des_fcrypt(),
+you can set CRYPT_LIB to point to the library name.
+Perl will also build without des_fcrypt(), but the crypt() builtin will
+fail at run time.
+
+If you want build some core extensions statically into perl's dll, specify
+them in the STATIC_EXT macro.
+
+Be sure to read the instructions near the top of the makefiles carefully.
+
+=item *
+
+Type "dmake" (or "nmake" if you are using that make).
+
+This should build everything.  Specifically, it will create perl.exe,
+perl512.dll at the perl toplevel, and various other extension dll's
+under the lib\auto directory.  If the build fails for any reason, make
+sure you have done the previous steps correctly.
+
+=back
+
+=head2 Testing Perl on Win32
+
+Type "dmake test" (or "nmake test").  This will run most of the tests from
+the testsuite (many tests will be skipped).
+
+There should be no test failures when running under Windows NT/2000/XP.
+Many tests I<will> fail under Windows 9x due to the inferior command shell.
+
+Some test failures may occur if you use a command shell other than the
+native "cmd.exe", or if you are building from a path that contains
+spaces.  So don't do that.
+
+If you are running the tests from a emacs shell window, you may see
+failures in op/stat.t.  Run "dmake test-notty" in that case.
+
+If you're using the Borland compiler, you may see a failure in op/taint.t
+arising from the inability to find the Borland Runtime DLLs on the system
+default path.  You will need to copy the DLLs reported by the messages
+from where Borland chose to install it, into the Windows system directory
+(usually somewhere like C:\WINNT\SYSTEM32) and rerun the test.
+
+If you're using Borland compiler versions 5.2 and below, you may run into
+problems finding the correct header files when building extensions.  For
+example, building the "Tk" extension may fail because both perl and Tk
+contain a header file called "patchlevel.h".  The latest Borland compiler
+(v5.5) is free of this misbehaviour, and it even supports an
+option -VI- for backward (bugward) compatibility for using the old Borland
+search algorithm  to locate header files.
+
+If you run the tests on a FAT partition, you may see some failures for
+C<link()> related tests (I<op/write.t>, I<op/stat.t> ...). Testing on
+NTFS avoids these errors.
+
+Furthermore, you should make sure that during C<make test> you do not
+have any GNU tool packages in your path: some toolkits like Unixutils
+include some tools (C<type> for instance) which override the Windows
+ones and makes tests fail. Remove them from your path while testing to
+avoid these errors.
+
+Please report any other failures as described under L<BUGS AND CAVEATS>.
+
+=head2 Installation of Perl on Win32
+
+Type "dmake install" (or "nmake install").  This will put the newly
+built perl and the libraries under whatever C<INST_TOP> points to in the
+Makefile.  It will also install the pod documentation under
+C<$INST_TOP\$INST_VER\lib\pod> and HTML versions of the same under
+C<$INST_TOP\$INST_VER\lib\pod\html>.
+
+To use the Perl you just installed you will need to add a new entry to
+your PATH environment variable: C<$INST_TOP\bin>, e.g.
+
+    set PATH=c:\perl\bin;%PATH%
+
+If you opted to uncomment C<INST_VER> and C<INST_ARCH> in the makefile
+then the installation structure is a little more complicated and you will
+need to add two new PATH components instead: C<$INST_TOP\$INST_VER\bin> and
+C<$INST_TOP\$INST_VER\bin\$ARCHNAME>, e.g.
+
+    set PATH=c:\perl\5.6.0\bin;c:\perl\5.6.0\bin\MSWin32-x86;%PATH%
+
+=head2 Usage Hints for Perl on Win32
+
+=over 4
+
+=item Environment Variables
+
+The installation paths that you set during the build get compiled
+into perl, so you don't have to do anything additional to start
+using that perl (except add its location to your PATH variable).
+
+If you put extensions in unusual places, you can set PERL5LIB
+to a list of paths separated by semicolons where you want perl
+to look for libraries.  Look for descriptions of other environment
+variables you can set in L<perlrun>.
+
+You can also control the shell that perl uses to run system() and
+backtick commands via PERL5SHELL.  See L<perlrun>.
+
+Perl does not depend on the registry, but it can look up certain default
+values if you choose to put them there.  Perl attempts to read entries from
+C<HKEY_CURRENT_USER\Software\Perl> and C<HKEY_LOCAL_MACHINE\Software\Perl>.
+Entries in the former override entries in the latter.  One or more of the
+following entries (of type REG_SZ or REG_EXPAND_SZ) may be set:
+
+    lib-$]		version-specific standard library path to add to @INC
+    lib			standard library path to add to @INC
+    sitelib-$]		version-specific site library path to add to @INC
+    sitelib		site library path to add to @INC
+    vendorlib-$]	version-specific vendor library path to add to @INC
+    vendorlib		vendor library path to add to @INC
+    PERL*		fallback for all %ENV lookups that begin with "PERL"
+
+Note the C<$]> in the above is not literal.  Substitute whatever version
+of perl you want to honor that entry, e.g. C<5.6.0>.  Paths must be
+separated with semicolons, as usual on win32.
+
+=item File Globbing
+
+By default, perl handles file globbing using the File::Glob extension,
+which provides portable globbing.
+
+If you want perl to use globbing that emulates the quirks of DOS
+filename conventions, you might want to consider using File::DosGlob
+to override the internal glob() implementation.  See L<File::DosGlob> for
+details.
+
+=item Using perl from the command line
+
+If you are accustomed to using perl from various command-line
+shells found in UNIX environments, you will be less than pleased
+with what Windows offers by way of a command shell.
+
+The crucial thing to understand about the Windows environment is that
+the command line you type in is processed twice before Perl sees it.
+First, your command shell (usually CMD.EXE on Windows NT, and
+COMMAND.COM on Windows 9x) preprocesses the command line, to handle
+redirection, environment variable expansion, and location of the
+executable to run. Then, the perl executable splits the remaining
+command line into individual arguments, using the C runtime library
+upon which Perl was built.
+
+It is particularly important to note that neither the shell nor the C
+runtime do any wildcard expansions of command-line arguments (so
+wildcards need not be quoted).  Also, the quoting behaviours of the
+shell and the C runtime are rudimentary at best (and may, if you are
+using a non-standard shell, be inconsistent).  The only (useful) quote
+character is the double quote (").  It can be used to protect spaces
+and other special characters in arguments.
+
+The Windows NT documentation has almost no description of how the
+quoting rules are implemented, but here are some general observations
+based on experiments: The C runtime breaks arguments at spaces and
+passes them to programs in argc/argv.  Double quotes can be used to
+prevent arguments with spaces in them from being split up.  You can
+put a double quote in an argument by escaping it with a backslash and
+enclosing the whole argument within double quotes.  The backslash and
+the pair of double quotes surrounding the argument will be stripped by
+the C runtime.
+
+The file redirection characters "E<lt>", "E<gt>", and "|" can be quoted by
+double quotes (although there are suggestions that this may not always
+be true).  Single quotes are not treated as quotes by the shell or
+the C runtime, they don't get stripped by the shell (just to make
+this type of quoting completely useless).  The caret "^" has also
+been observed to behave as a quoting character, but this appears
+to be a shell feature, and the caret is not stripped from the command
+line, so Perl still sees it (and the C runtime phase does not treat
+the caret as a quote character).
+
+Here are some examples of usage of the "cmd" shell:
+
+This prints two doublequotes:
+
+    perl -e "print '\"\"' "
+
+This does the same:
+
+    perl -e "print \"\\\"\\\"\" "
+
+This prints "bar" and writes "foo" to the file "blurch":
+
+    perl -e "print 'foo'; print STDERR 'bar'" > blurch
+
+This prints "foo" ("bar" disappears into nowhereland):
+
+    perl -e "print 'foo'; print STDERR 'bar'" 2> nul
+
+This prints "bar" and writes "foo" into the file "blurch":
+
+    perl -e "print 'foo'; print STDERR 'bar'" 1> blurch
+
+This pipes "foo" to the "less" pager and prints "bar" on the console:
+
+    perl -e "print 'foo'; print STDERR 'bar'" | less
+
+This pipes "foo\nbar\n" to the less pager:
+
+    perl -le "print 'foo'; print STDERR 'bar'" 2>&1 | less
+
+This pipes "foo" to the pager and writes "bar" in the file "blurch":
+
+    perl -e "print 'foo'; print STDERR 'bar'" 2> blurch | less
+
+
+Discovering the usefulness of the "command.com" shell on Windows 9x
+is left as an exercise to the reader :)
+
+One particularly pernicious problem with the 4NT command shell for
+Windows NT is that it (nearly) always treats a % character as indicating
+that environment variable expansion is needed.  Under this shell, it is
+therefore important to always double any % characters which you want
+Perl to see (for example, for hash variables), even when they are
+quoted.
+
+=item Building Extensions
+
+The Comprehensive Perl Archive Network (CPAN) offers a wealth
+of extensions, some of which require a C compiler to build.
+Look in http://www.cpan.org/ for more information on CPAN.
+
+Note that not all of the extensions available from CPAN may work
+in the Win32 environment; you should check the information at
+http://testers.cpan.org/ before investing too much effort into
+porting modules that don't readily build.
+
+Most extensions (whether they require a C compiler or not) can
+be built, tested and installed with the standard mantra:
+
+    perl Makefile.PL
+    $MAKE
+    $MAKE test
+    $MAKE install
+
+where $MAKE is whatever 'make' program you have configured perl to
+use.  Use "perl -V:make" to find out what this is.  Some extensions
+may not provide a testsuite (so "$MAKE test" may not do anything or
+fail), but most serious ones do.
+
+It is important that you use a supported 'make' program, and
+ensure Config.pm knows about it.  If you don't have nmake, you can
+either get dmake from the location mentioned earlier or get an
+old version of nmake reportedly available from:
+
+ http://download.microsoft.com/download/vc15/Patch/1.52/W95/EN-US/nmake15.exe
+
+Another option is to use the make written in Perl, available from
+CPAN.
+
+    http://www.cpan.org/modules/by-module/Make/
+
+You may also use dmake.  See L</"Make"> above on how to get it.
+
+Note that MakeMaker actually emits makefiles with different syntax
+depending on what 'make' it thinks you are using.  Therefore, it is
+important that one of the following values appears in Config.pm:
+
+    make='nmake'	# MakeMaker emits nmake syntax
+    make='dmake'	# MakeMaker emits dmake syntax
+    any other value	# MakeMaker emits generic make syntax
+    			    (e.g GNU make, or Perl make)
+
+If the value doesn't match the 'make' program you want to use,
+edit Config.pm to fix it.
+
+If a module implements XSUBs, you will need one of the supported
+C compilers.  You must make sure you have set up the environment for
+the compiler for command-line compilation.
+
+If a module does not build for some reason, look carefully for
+why it failed, and report problems to the module author.  If
+it looks like the extension building support is at fault, report
+that with full details of how the build failed using the perlbug
+utility.
+
+=item Command-line Wildcard Expansion
+
+The default command shells on DOS descendant operating systems (such
+as they are) usually do not expand wildcard arguments supplied to
+programs.  They consider it the application's job to handle that.
+This is commonly achieved by linking the application (in our case,
+perl) with startup code that the C runtime libraries usually provide.
+However, doing that results in incompatible perl versions (since the
+behavior of the argv expansion code differs depending on the
+compiler, and it is even buggy on some compilers).  Besides, it may
+be a source of frustration if you use such a perl binary with an
+alternate shell that *does* expand wildcards.
+
+Instead, the following solution works rather well. The nice things
+about it are 1) you can start using it right away; 2) it is more
+powerful, because it will do the right thing with a pattern like
+*/*/*.c; 3) you can decide whether you do/don't want to use it; and
+4) you can extend the method to add any customizations (or even
+entirely different kinds of wildcard expansion).
+
+	C:\> copy con c:\perl\lib\Wild.pm
+	# Wild.pm - emulate shell @ARGV expansion on shells that don't
+	use File::DosGlob;
+	@ARGV = map {
+		      my @g = File::DosGlob::glob($_) if /[*?]/;
+		      @g ? @g : $_;
+		    } @ARGV;
+	1;
+	^Z
+	C:\> set PERL5OPT=-MWild
+	C:\> perl -le "for (@ARGV) { print }" */*/perl*.c
+	p4view/perl/perl.c
+	p4view/perl/perlio.c
+	p4view/perl/perly.c
+	perl5.005/win32/perlglob.c
+	perl5.005/win32/perllib.c
+	perl5.005/win32/perlglob.c
+	perl5.005/win32/perllib.c
+	perl5.005/win32/perlglob.c
+	perl5.005/win32/perllib.c
+
+Note there are two distinct steps there: 1) You'll have to create
+Wild.pm and put it in your perl lib directory. 2) You'll need to
+set the PERL5OPT environment variable.  If you want argv expansion
+to be the default, just set PERL5OPT in your default startup
+environment.
+
+If you are using the Visual C compiler, you can get the C runtime's
+command line wildcard expansion built into perl binary.  The resulting
+binary will always expand unquoted command lines, which may not be
+what you want if you use a shell that does that for you.  The expansion
+done is also somewhat less powerful than the approach suggested above.
+
+=item Win32 Specific Extensions
+
+A number of extensions specific to the Win32 platform are available
+from CPAN.  You may find that many of these extensions are meant to
+be used under the Activeware port of Perl, which used to be the only
+native port for the Win32 platform.  Since the Activeware port does not
+have adequate support for Perl's extension building tools, these
+extensions typically do not support those tools either and, therefore,
+cannot be built using the generic steps shown in the previous section.
+
+To ensure smooth transitioning of existing code that uses the
+ActiveState port, there is a bundle of Win32 extensions that contains
+all of the ActiveState extensions and several other Win32 extensions from
+CPAN in source form, along with many added bugfixes, and with MakeMaker
+support.  The latest version of this bundle is available at:
+
+    http://search.cpan.org/dist/libwin32/
+
+See the README in that distribution for building and installation
+instructions.
+
+=item Notes on 64-bit Windows
+
+Windows .NET Server supports the LLP64 data model on the Intel Itanium
+architecture.
+
+The LLP64 data model is different from the LP64 data model that is the
+norm on 64-bit Unix platforms.  In the former, C<int> and C<long> are
+both 32-bit data types, while pointers are 64 bits wide.  In addition,
+there is a separate 64-bit wide integral type, C<__int64>.  In contrast,
+the LP64 data model that is pervasive on Unix platforms provides C<int>
+as the 32-bit type, while both the C<long> type and pointers are of
+64-bit precision.  Note that both models provide for 64-bits of
+addressability.
+
+64-bit Windows running on Itanium is capable of running 32-bit x86
+binaries transparently.  This means that you could use a 32-bit build
+of Perl on a 64-bit system.  Given this, why would one want to build
+a 64-bit build of Perl?  Here are some reasons why you would bother:
+
+=over
+
+=item *
+
+A 64-bit native application will run much more efficiently on
+Itanium hardware.
+
+=item *
+
+There is no 2GB limit on process size.
+
+=item *
+
+Perl automatically provides large file support when built under
+64-bit Windows.
+
+=item *
+
+Embedding Perl inside a 64-bit application.
+
+=back
+
+=back
+
+=head2 Running Perl Scripts
+
+Perl scripts on UNIX use the "#!" (a.k.a "shebang") line to
+indicate to the OS that it should execute the file using perl.
+Win32 has no comparable means to indicate arbitrary files are
+executables.
+
+Instead, all available methods to execute plain text files on
+Win32 rely on the file "extension".  There are three methods
+to use this to execute perl scripts:
+
+=over 8
+
+=item 1
+
+There is a facility called "file extension associations" that will
+work in Windows NT 4.0.  This can be manipulated via the two
+commands "assoc" and "ftype" that come standard with Windows NT
+4.0.  Type "ftype /?" for a complete example of how to set this
+up for perl scripts (Say what?  You thought Windows NT wasn't
+perl-ready? :).
+
+=item 2
+
+Since file associations don't work everywhere, and there are
+reportedly bugs with file associations where it does work, the
+old method of wrapping the perl script to make it look like a
+regular batch file to the OS, may be used.  The install process
+makes available the "pl2bat.bat" script which can be used to wrap
+perl scripts into batch files.  For example:
+
+	pl2bat foo.pl
+
+will create the file "FOO.BAT".  Note "pl2bat" strips any
+.pl suffix and adds a .bat suffix to the generated file.
+
+If you use the 4DOS/NT or similar command shell, note that
+"pl2bat" uses the "%*" variable in the generated batch file to
+refer to all the command line arguments, so you may need to make
+sure that construct works in batch files.  As of this writing,
+4DOS/NT users will need a "ParameterChar = *" statement in their
+4NT.INI file or will need to execute "setdos /p*" in the 4DOS/NT
+startup file to enable this to work.
+
+=item 3
+
+Using "pl2bat" has a few problems:  the file name gets changed,
+so scripts that rely on C<$0> to find what they must do may not
+run properly; running "pl2bat" replicates the contents of the
+original script, and so this process can be maintenance intensive
+if the originals get updated often.  A different approach that
+avoids both problems is possible.
+
+A script called "runperl.bat" is available that can be copied
+to any filename (along with the .bat suffix).  For example,
+if you call it "foo.bat", it will run the file "foo" when it is
+executed.  Since you can run batch files on Win32 platforms simply
+by typing the name (without the extension), this effectively
+runs the file "foo", when you type either "foo" or "foo.bat".
+With this method, "foo.bat" can even be in a different location
+than the file "foo", as long as "foo" is available somewhere on
+the PATH.  If your scripts are on a filesystem that allows symbolic
+links, you can even avoid copying "runperl.bat".
+
+Here's a diversion:  copy "runperl.bat" to "runperl", and type
+"runperl".  Explain the observed behavior, or lack thereof. :)
+Hint: .gnidnats llits er'uoy fi ,"lrepnur" eteled :tniH
+
+=back
+
+=head2 Miscellaneous Things
+
+A full set of HTML documentation is installed, so you should be
+able to use it if you have a web browser installed on your
+system.
+
+C<perldoc> is also a useful tool for browsing information contained
+in the documentation, especially in conjunction with a pager
+like C<less> (recent versions of which have Win32 support).  You may
+have to set the PAGER environment variable to use a specific pager.
+"perldoc -f foo" will print information about the perl operator
+"foo".
+
+One common mistake when using this port with a GUI library like C<Tk>
+is assuming that Perl's normal behavior of opening a command-line
+window will go away.  This isn't the case.  If you want to start a copy
+of C<perl> without opening a command-line window, use the C<wperl>
+executable built during the installation process.  Usage is exactly
+the same as normal C<perl> on Win32, except that options like C<-h>
+don't work (since they need a command-line window to print to).
+
+If you find bugs in perl, you can run C<perlbug> to create a
+bug report (you may have to send it manually if C<perlbug> cannot
+find a mailer on your system).
+
+=head1 BUGS AND CAVEATS
+
+Norton AntiVirus interferes with the build process, particularly if
+set to "AutoProtect, All Files, when Opened". Unlike large applications
+the perl build process opens and modifies a lot of files. Having the
+the AntiVirus scan each and every one slows build the process significantly.
+Worse, with PERLIO=stdio the build process fails with peculiar messages
+as the virus checker interacts badly with miniperl.exe writing configure
+files (it seems to either catch file part written and treat it as suspicious,
+or virus checker may have it "locked" in a way which inhibits miniperl
+updating it). The build does complete with
+
+   set PERLIO=perlio
+
+but that may be just luck. Other AntiVirus software may have similar issues.
+
+Some of the built-in functions do not act exactly as documented in
+L<perlfunc>, and a few are not implemented at all.  To avoid
+surprises, particularly if you have had prior exposure to Perl
+in other operating environments or if you intend to write code
+that will be portable to other environments, see L<perlport>
+for a reasonably definitive list of these differences.
+
+Not all extensions available from CPAN may build or work properly
+in the Win32 environment.  See L</"Building Extensions">.
+
+Most C<socket()> related calls are supported, but they may not
+behave as on Unix platforms.  See L<perlport> for the full list.
+Perl requires Winsock2 to be installed on the system. If you're
+running Win95, you can download Winsock upgrade from here:
+
+http://www.microsoft.com/windows95/downloads/contents/WUAdminTools/S_WUNetworkingTools/W95Sockets2/Default.asp
+
+Later OS versions already include Winsock2 support.
+
+Signal handling may not behave as on Unix platforms (where it
+doesn't exactly "behave", either :).  For instance, calling C<die()>
+or C<exit()> from signal handlers will cause an exception, since most
+implementations of C<signal()> on Win32 are severely crippled.
+Thus, signals may work only for simple things like setting a flag
+variable in the handler.  Using signals under this port should
+currently be considered unsupported.
+
+Please send detailed descriptions of any problems and solutions that
+you may find to E<lt>F<perlbug@perl.org>E<gt>, along with the output
+produced by C<perl -V>.
+
+=head1 ACKNOWLEDGEMENTS
+
+The use of a camel with the topic of Perl is a trademark
+of O'Reilly and Associates, Inc. Used with permission.
+
+=head1 AUTHORS
+
+=over 4
+
+=item Gary Ng E<lt>71564.1743@CompuServe.COME<gt>
+
+=item Gurusamy Sarathy E<lt>gsar@activestate.comE<gt>
+
+=item Nick Ing-Simmons E<lt>nick@ing-simmons.netE<gt>
+
+=item Jan Dubois E<lt>jand@activestate.comE<gt>
+
+=item Steve Hay E<lt>steve.hay@uk.radan.comE<gt>
+
+=back
+
+This document is maintained by Jan Dubois.
+
+=head1 SEE ALSO
+
+L<perl>
+
+=head1 HISTORY
+
+This port was originally contributed by Gary Ng around 5.003_24,
+and borrowed from the Hip Communications port that was available
+at the time.  Various people have made numerous and sundry hacks
+since then.
+
+Borland support was added in 5.004_01 (Gurusamy Sarathy).
+
+GCC/mingw32 support was added in 5.005 (Nick Ing-Simmons).
+
+Support for PERL_OBJECT was added in 5.005 (ActiveState Tool Corp).
+
+Support for fork() emulation was added in 5.6 (ActiveState Tool Corp).
+
+Win9x support was added in 5.6 (Benjamin Stuhl).
+
+Support for 64-bit Windows added in 5.8 (ActiveState Corp).
+
+Last updated: 29 August 2007
+
+=cut
Index: src/gnu/usr.bin/perl/XSUB.h
diff -u src/gnu/usr.bin/perl/XSUB.h:1.12 src/gnu/usr.bin/perl/XSUB.h:1.13
--- XSUB.h:1.12	Mon Oct 12 18:24:20 2009
+++ XSUB.h	Fri Sep 24 15:06:39 2010
@@ -294,7 +294,7 @@
 #define newXSproto(a,b,c,d)	newXS_flags(a,b,c,d,0)
 
 #ifdef XS_VERSION
-#  define XS_VERSION_BOOTCHECK \
+#  define XS_VERSION_BOOTCHECK						\
     STMT_START {							\
 	SV *_sv;							\
 	const char *vn = NULL, *module = SvPV_nolen_const(ST(0));	\
@@ -305,19 +305,31 @@
 	    _sv = get_sv(Perl_form(aTHX_ "%s::%s", module,		\
 				vn = "XS_VERSION"), FALSE);		\
 	    if (!_sv || !SvOK(_sv))					\
-		_sv = get_sv(Perl_form(aTHX_ "%s::%s", module,	\
+		_sv = get_sv(Perl_form(aTHX_ "%s::%s", module,		\
 				    vn = "VERSION"), FALSE);		\
 	}								\
 	if (_sv) {							\
-	    SV *xssv = Perl_newSVpv(aTHX_ XS_VERSION, 0);		\
-	    xssv = new_version(xssv);					\
-	    if ( !sv_derived_from(_sv, "version") )			\
-		_sv = new_version(_sv);				\
-	    if ( vcmp(_sv,xssv) )					\
-		Perl_croak(aTHX_ "%s object version %"SVf" does not match %s%s%s%s %"SVf,\
-		      module, SVfARG(vstringify(xssv)),			\
-		      vn ? "$" : "", vn ? module : "", vn ? "::" : "",	\
-		      vn ? vn : "bootstrap parameter", SVfARG(vstringify(_sv)));\
+	    SV *xpt = NULL;						\
+	    SV *xssv = Perl_newSVpvn(aTHX_ STR_WITH_LEN(XS_VERSION));	\
+	    SV *pmsv = sv_derived_from(_sv, "version")			\
+		? SvREFCNT_inc_simple_NN(_sv)				\
+		: new_version(_sv);					\
+	    xssv = upg_version(xssv, 0);				\
+	    if ( vcmp(pmsv,xssv) ) {	 				\
+		xpt = Perl_newSVpvf(aTHX_ "%s object version %"SVf	\
+				    " does not match %s%s%s%s %"SVf,	\
+				    module,				\
+				    SVfARG(Perl_sv_2mortal(aTHX_ vstringify(xssv))), \
+				    vn ? "$" : "", vn ? module : "",	\
+				    vn ? "::" : "",			\
+				    vn ? vn : "bootstrap parameter",	\
+				    SVfARG(Perl_sv_2mortal(aTHX_ vstringify(pmsv)))); \
+		Perl_sv_2mortal(aTHX_ xpt);				\
+	    }								\
+	    SvREFCNT_dec(xssv);						\
+	    SvREFCNT_dec(pmsv);						\
+	    if (xpt)							\
+		Perl_croak(aTHX_ "%s", SvPVX(xpt));			\
 	}                                                               \
     } STMT_END
 #else
@@ -478,6 +490,12 @@
 #	undef setservent
 #endif	/* NETWARE */
 
+/* to avoid warnings: "xyz" redefined */
+#ifdef WIN32
+#    undef  popen
+#    undef  pclose
+#endif /* WIN32 */
+
 #    undef  socketpair
 
 #    define mkdir		PerlDir_mkdir
@@ -501,6 +519,7 @@
 #    define ferror		PerlSIO_ferror
 #    define clearerr		PerlSIO_clearerr
 #    define getc		PerlSIO_getc
+#    define fgets		PerlSIO_fgets
 #    define fputc		PerlSIO_fputc
 #    define fputs		PerlSIO_fputs
 #    define fflush		PerlSIO_fflush
Index: src/gnu/usr.bin/perl/av.c
diff -u src/gnu/usr.bin/perl/av.c:1.12 src/gnu/usr.bin/perl/av.c:1.13
--- av.c:1.12	Mon Oct 12 18:24:20 2009
+++ av.c	Fri Sep 24 15:06:39 2010
@@ -35,8 +35,8 @@
     if (AvREAL(av))
 	return;
 #ifdef DEBUGGING
-    if (SvTIED_mg((const SV *)av, PERL_MAGIC_tied) && ckWARN_d(WARN_DEBUGGING))
-	Perl_warner(aTHX_ packWARN(WARN_DEBUGGING), "av_reify called on tied array");
+    if (SvTIED_mg((const SV *)av, PERL_MAGIC_tied))
+	Perl_ck_warner_d(aTHX_ packWARN(WARN_DEBUGGING), "av_reify called on tied array");
 #endif
     key = AvMAX(av) + 1;
     while (key > AvFILLp(av) + 1)
@@ -404,8 +404,14 @@
 	AvFILLp(av) = AvMAX(av) = size - 1;
 	for (i = 0; i < size; i++) {
 	    assert (*strp);
+
+	    /* Don't let sv_setsv swipe, since our source array might
+	       have multiple references to the same temp scalar (e.g.
+	       from a list slice) */
+
 	    ary[i] = newSV(0);
-	    sv_setsv(ary[i], *strp);
+	    sv_setsv_flags(ary[i], *strp,
+			   SV_GMAGIC|SV_DO_COW_SVSETSV|SV_NOSTEAL);
 	    strp++;
 	}
     }
@@ -431,8 +437,8 @@
     assert(SvTYPE(av) == SVt_PVAV);
 
 #ifdef DEBUGGING
-    if (SvREFCNT(av) == 0 && ckWARN_d(WARN_DEBUGGING)) {
-	Perl_warner(aTHX_ packWARN(WARN_DEBUGGING), "Attempt to clear deleted array");
+    if (SvREFCNT(av) == 0) {
+	Perl_ck_warner_d(aTHX_ packWARN(WARN_DEBUGGING), "Attempt to clear deleted array");
     }
 #endif
 
@@ -583,7 +589,7 @@
 
     if (SvREADONLY(av))
 	Perl_croak(aTHX_ "%s", PL_no_modify);
-    if ((mg = SvTIED_mg((const SV*)av, PERL_MAGIC_tied))) {
+    if ((mg = SvTIED_mg((const SV *)av, PERL_MAGIC_tied))) {
 	dSP;    
 	PUSHSTACKi(PERLSI_MAGIC);
 	PUSHMARK(SP);
@@ -725,7 +731,7 @@
 
     if (SvREADONLY(av))
 	Perl_croak(aTHX_ "%s", PL_no_modify);
-    if ((mg = SvTIED_mg((const SV*)av, PERL_MAGIC_tied))) {
+    if ((mg = SvTIED_mg((const SV *)av, PERL_MAGIC_tied))) {
 	dSP;
 	PUSHSTACKi(PERLSI_MAGIC);
 	PUSHMARK(SP);
@@ -764,7 +770,7 @@
 */
 
 I32
-Perl_av_len(pTHX_ register const AV *av)
+Perl_av_len(pTHX_ AV *av)
 {
     PERL_ARGS_ASSERT_AV_LEN;
     assert(SvTYPE(av) == SVt_PVAV);
@@ -992,12 +998,12 @@
 	return FALSE;
 }
 
-SV **
-Perl_av_arylen_p(pTHX_ AV *av) {
+static MAGIC *
+S_get_aux_mg(pTHX_ AV *av) {
     dVAR;
     MAGIC *mg;
 
-    PERL_ARGS_ASSERT_AV_ARYLEN_P;
+    PERL_ARGS_ASSERT_GET_AUX_MG;
     assert(SvTYPE(av) == SVt_PVAV);
 
     mg = mg_find((const SV *)av, PERL_MAGIC_arylen_p);
@@ -1009,7 +1015,37 @@
 	/* sv_magicext won't set this for us because we pass in a NULL obj  */
 	mg->mg_flags |= MGf_REFCOUNTED;
     }
+    return mg;
+}
+
+SV **
+Perl_av_arylen_p(pTHX_ AV *av) {
+    MAGIC *const mg = get_aux_mg(av);
+
+    PERL_ARGS_ASSERT_AV_ARYLEN_P;
+    assert(SvTYPE(av) == SVt_PVAV);
+
     return &(mg->mg_obj);
+}
+
+IV *
+Perl_av_iter_p(pTHX_ AV *av) {
+    MAGIC *const mg = get_aux_mg(av);
+
+    PERL_ARGS_ASSERT_AV_ITER_P;
+    assert(SvTYPE(av) == SVt_PVAV);
+
+#if IVSIZE == I32SIZE
+    return (IV *)&(mg->mg_len);
+#else
+    if (!mg->mg_ptr) {
+	IV *temp;
+	mg->mg_len = IVSIZE;
+	Newxz(temp, 1, IV);
+	mg->mg_ptr = (char *) temp;
+    }
+    return (IV *)mg->mg_ptr;
+#endif
 }
 
 /*
Index: src/gnu/usr.bin/perl/av.h
diff -u src/gnu/usr.bin/perl/av.h:1.9 src/gnu/usr.bin/perl/av.h:1.10
--- av.h:1.9	Mon Oct 12 18:24:20 2009
+++ av.h	Fri Sep 24 15:06:39 2010
@@ -9,52 +9,12 @@
  */
 
 struct xpvav {
-    union {
-	NV	xnv_nv;		/* numeric value, if any */
-	HV *	xgv_stash;
-	struct {
-	    U32	xlow;
-	    U32	xhigh;
-	}	xpad_cop_seq;	/* used by pad.c for cop_sequence */
-	struct {
-	    U32 xbm_previous;	/* how many characters in string before rare? */
-	    U8	xbm_flags;
-	    U8	xbm_rare;	/* rarest character in string */
-	}	xbm_s;		/* fields from PVBM */
-    }		xnv_u;
+    union _xnvu xnv_u;
     SSize_t	xav_fill;       /* Index of last element present */
     SSize_t	xav_max;        /* max index for which array has space */
-    union {
-	IV	xivu_iv;	/* integer value or pv offset */
-	UV	xivu_uv;
-	void *	xivu_p1;
-	I32	xivu_i32;
-	HEK *	xivu_namehek;
-    }		xiv_u;
-    union {
-	MAGIC*	xmg_magic;	/* linked list of magicalness */
-	HV*	xmg_ourstash;	/* Stash for our (when SvPAD_OUR is true) */
-    } xmg_u;
-    HV*		xmg_stash;	/* class package */
+    _XPVMG_HEAD;
 };
 
-typedef struct {
-    SSize_t	xav_fill;       /* Index of last element present */
-    SSize_t	xav_max;        /* max index for which array has space */
-    union {
-	IV	xivu_iv;	/* integer value or pv offset */
-	UV	xivu_uv;
-	void *	xivu_p1;
-	I32	xivu_i32;
-	HEK *	xivu_namehek;
-    }		xiv_u;
-    union {
-	MAGIC*	xmg_magic;	/* linked list of magicalness */
-	HV*	xmg_ourstash;	/* Stash for our (when SvPAD_OUR is true) */
-    } xmg_u;
-    HV*		xmg_stash;	/* class package */
-} xpvav_allocated;
-
 /* SV**	xav_alloc; */
 #define xav_alloc xiv_u.xivu_p1
 /* SV*	xav_arylen; */
@@ -83,6 +43,8 @@
 =for apidoc AmU||Nullav
 Null AV pointer.
 
+(deprecated - use C<(AV *)NULL> instead)
+
 =head1 Array Manipulation Functions
 
 =for apidoc Am|int|AvFILL|AV* av
@@ -91,7 +53,9 @@
 =cut
 */
 
-#define Nullav Null(AV*)
+#ifndef PERL_CORE
+#  define Nullav Null(AV*)
+#endif
 
 #define AvARRAY(av)	((av)->sv_u.svu_array)
 #define AvALLOC(av)	(*((SV***)&((XPVAV*)  SvANY(av))->xav_alloc))
Index: src/gnu/usr.bin/perl/cflags.SH
diff -u src/gnu/usr.bin/perl/cflags.SH:1.10 src/gnu/usr.bin/perl/cflags.SH:1.11
--- cflags.SH:1.10	Mon Oct 12 18:24:20 2009
+++ cflags.SH	Fri Sep 24 15:06:39 2010
@@ -319,7 +319,6 @@
     usersub) ;;
     utf8) ;;
     util) ;;
-    xsutils) ;;
     *) ;;
     esac
 
Index: src/gnu/usr.bin/perl/config_h.SH
diff -u src/gnu/usr.bin/perl/config_h.SH:1.12 src/gnu/usr.bin/perl/config_h.SH:1.13
--- config_h.SH:1.12	Mon Oct 12 18:24:20 2009
+++ config_h.SH	Fri Sep 24 15:06:39 2010
@@ -894,6 +894,28 @@
  */
 #$i_vfork I_VFORK	/**/
 
+/* CAN_VAPROTO:
+ *	This variable is defined on systems supporting prototype declaration
+ *	of functions with a variable number of arguments.
+ */
+/* _V:
+ *	This macro is used to declare function parameters in prototypes for
+ *	functions with a variable number of parameters. Use double parentheses.
+ *	For example:
+ *
+ *		int printf _V((char *fmt, ...));
+ *
+ *	Remember to use the plain simple _() macro when declaring a function
+ *	with no variable number of arguments, since it might be possible to
+ *	have a non-effect _V() macro and still get prototypes via _().
+ */
+#$vaproto CAN_VAPROTO	/**/
+#ifdef CAN_VAPROTO
+#define	_V(args) args
+#else
+#define	_V(args) ()
+#endif
+
 /* INTSIZE:
  *	This symbol contains the value of sizeof(int) so that the C
  *	preprocessor can make decisions based on it.
@@ -2942,6 +2964,12 @@
 #else
 #define BYTEORDER 0x$byteorder	/* large digits for MSB */
 #endif /* NeXT */
+
+/* CHARBITS:
+ *	This symbol contains the size of a char, so that the C preprocessor
+ *	can make decisions based on it.
+ */
+#define CHARBITS $charbits		/**/
 
 /* CASTI32:
  *	This symbol is defined if the C compiler can cast negative
Index: src/gnu/usr.bin/perl/configpm
diff -u src/gnu/usr.bin/perl/configpm:1.14 src/gnu/usr.bin/perl/configpm:1.15
--- configpm:1.14	Mon Oct 12 18:24:20 2009
+++ configpm	Fri Sep 24 15:06:39 2010
@@ -34,6 +34,7 @@
 usage: $0  [ options ]
     --cross=PLATFORM    cross-compile for a different platform
     --no-glossary       don't include Porting/Glossary in lib/Config.pod
+    --chdir=dir         change directory before writing files
 EOF
 
 use strict;
@@ -65,6 +66,7 @@
     'cross'    => '', # --cross=PLATFORM - crosscompiling for PLATFORM
     'glossary' => 1,  # --no-glossary  - no glossary file inclusion,
                       #                  for compactness
+    'chdir'    => '', # --chdir=dir    - change directory before writing files
 );
 
 sub opts {
@@ -90,6 +92,10 @@
 
 my %Opts = opts();
 
+if ($Opts{chdir}) {
+    chdir $Opts{chdir} or die "$0: could not chdir $Opts{chdir}: $!"
+}
+
 my ($Config_SH, $Config_PM, $Config_heavy, $Config_POD);
 my $Glossary = 'Porting/Glossary';
 
@@ -121,6 +127,45 @@
 use strict;
 # use warnings; Pulls in Carp
 # use vars pulls in Carp
+
+sub _V {
+    my ($bincompat, $non_bincompat, $date, @patches) = Internals::V();
+
+    my $opts = join ' ', sort split ' ', "$bincompat $non_bincompat";
+
+    # wrap at 76 columns.
+
+    $opts =~ s/(?=.{53})(.{1,53}) /$1\n                        /mg;
+
+    print Config::myconfig();
+    if ($^O eq 'VMS') {
+        print "\nCharacteristics of this PERLSHR image: \n";
+    } else {
+        print "\nCharacteristics of this binary (from libperl): \n";
+    }
+
+    print "  Compile-time options: $opts\n";
+
+    if (@patches) {
+        print "  Locally applied patches:\n";
+        print "\t$_\n" foreach @patches;
+    }
+
+    print "  Built under $^O\n";
+
+    print "  $date\n" if defined $date;
+
+    my @env = map { "$_=\"$ENV{$_}\"" } sort grep {/^PERL/} keys %ENV;
+    push @env, "CYGWIN=\"$ENV{CYGWIN}\"" if $^O eq 'cygwin';
+
+    if (@env) {
+        print "  \%ENV:\n";
+        print "    $_\n" foreach @env;
+    }
+    print "  \@INC:\n";
+    print "    $_\n" foreach @INC;
+}
+
 ENDOFBEG
 
 my $myver = sprintf "%vd", $^V;
Index: src/gnu/usr.bin/perl/cop.h
diff -u src/gnu/usr.bin/perl/cop.h:1.12 src/gnu/usr.bin/perl/cop.h:1.13
--- cop.h:1.12	Mon Oct 12 18:24:20 2009
+++ cop.h	Fri Sep 24 15:06:39 2010
@@ -1,13 +1,13 @@
 /*    cop.h
  *
  *    Copyright (C) 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,
- *    2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008 by Larry Wall and others
+ *    2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009 by Larry Wall and others
  *
  *    You may distribute under the terms of either the GNU General Public
  *    License or the Artistic License, as specified in the README file.
  *
- * Control ops (cops) are one of the three ops OP_NEXTSTATE, OP_DBSTATE,
- * and OP_SETSTATE that (loosely speaking) are separate statements.
+ * Control ops (cops) are one of the two ops OP_NEXTSTATE and OP_DBSTATE,
+ * that (loosely speaking) are separate statements.
  * They hold information important for lexical state and error reporting.
  * At run time, PL_curcop is set to point to the most recently executed cop,
  * and thus can be used to determine our current state.
@@ -99,8 +99,9 @@
 
 #define JMPENV_PUSH(v) \
     STMT_START {							\
-	DEBUG_l(Perl_deb(aTHX_ "Setting up jumplevel %p, was %p\n",	\
-			 (void*)&cur_env, (void*)PL_top_env));			\
+	DEBUG_l(Perl_deb(aTHX_ "Setting up jumplevel %p, was %p at %s:%d\n",	\
+		         (void*)&cur_env, (void*)PL_top_env,			\
+		         __FILE__, __LINE__));					\
 	cur_env.je_prev = PL_top_env;					\
 	OP_REG_TO_MEM;							\
 	cur_env.je_ret = PerlProc_setjmp(cur_env.je_buf, SCOPE_SAVES_SIGNAL_MASK);		\
@@ -112,8 +113,10 @@
 
 #define JMPENV_POP \
     STMT_START {							\
-	DEBUG_l(Perl_deb(aTHX_ "popping jumplevel was %p, now %p\n",	\
-			 (void*)PL_top_env, (void*)cur_env.je_prev));			\
+	DEBUG_l(Perl_deb(aTHX_ "popping jumplevel was %p, now %p at %s:%d\n",	\
+		         (void*)PL_top_env, (void*)cur_env.je_prev,		\
+		         __FILE__, __LINE__));					\
+	assert(PL_top_env == &cur_env);					\
 	PL_top_env = cur_env.je_prev;					\
     } STMT_END
 
@@ -139,7 +142,7 @@
     /* On LP64 putting this here takes advantage of the fact that BASEOP isn't
        an exact multiple of 8 bytes to save structure padding.  */
     line_t      cop_line;       /* line # of this command */
-    char *	cop_label;	/* label for this construct */
+    /* label for this construct is now stored in cop_hints_hash */
 #ifdef USE_ITHREADS
     char *	cop_stashpv;	/* package line was compiled in */
     char *	cop_file;	/* file name the following line # is from */
@@ -191,18 +194,12 @@
 				 ? gv_stashpv(CopSTASHPV(c),GV_ADD) : NULL)
 #  define CopSTASH_set(c,hv)	CopSTASHPV_set(c, (hv) ? HvNAME_get(hv) : NULL)
 #  define CopSTASH_eq(c,hv)	((hv) && stashpv_hvname_match(c,hv))
-#  define CopLABEL(c)		((c)->cop_label)
-#  define CopLABEL_set(c,pv)	(CopLABEL(c) = (pv))
 #  ifdef NETWARE
 #    define CopSTASH_free(c) SAVECOPSTASH_FREE(c)
 #    define CopFILE_free(c) SAVECOPFILE_FREE(c)
-#    define CopLABEL_free(c) SAVECOPLABEL_FREE(c)
-#    define CopLABEL_alloc(pv)	((pv)?savepv(pv):NULL)
 #  else
 #    define CopSTASH_free(c)	PerlMemShared_free(CopSTASHPV(c))
 #    define CopFILE_free(c)	(PerlMemShared_free(CopFILE(c)),(CopFILE(c) = NULL))
-#    define CopLABEL_free(c)	(PerlMemShared_free(CopLABEL(c)),(CopLABEL(c) = NULL))
-#    define CopLABEL_alloc(pv)	((pv)?savesharedpv(pv):NULL)
 #  endif
 #else
 #  define CopFILEGV(c)		((c)->cop_filegv)
@@ -219,19 +216,17 @@
 #  define CopFILE(c)		(CopFILEGV(c) && GvSV(CopFILEGV(c)) \
 				    ? SvPVX(GvSV(CopFILEGV(c))) : NULL)
 #  define CopSTASH(c)		((c)->cop_stash)
-#  define CopLABEL(c)		((c)->cop_label)
 #  define CopSTASH_set(c,hv)	((c)->cop_stash = (hv))
 #  define CopSTASHPV(c)		(CopSTASH(c) ? HvNAME_get(CopSTASH(c)) : NULL)
    /* cop_stash is not refcounted */
 #  define CopSTASHPV_set(c,pv)	CopSTASH_set((c), gv_stashpv(pv,GV_ADD))
 #  define CopSTASH_eq(c,hv)	(CopSTASH(c) == (hv))
-#  define CopLABEL_alloc(pv)	((pv)?savepv(pv):NULL)
-#  define CopLABEL_set(c,pv)	(CopLABEL(c) = (pv))
 #  define CopSTASH_free(c)	
 #  define CopFILE_free(c)	(SvREFCNT_dec(CopFILEGV(c)),(CopFILEGV(c) = NULL))
-#  define CopLABEL_free(c)	(Safefree(CopLABEL(c)),(CopLABEL(c) = NULL))
 
 #endif /* USE_ITHREADS */
+#define CopLABEL(c)  Perl_fetch_cop_label(aTHX_ (c)->cop_hints_hash, NULL, NULL)
+#define CopLABEL_alloc(pv)	((pv)?savepv(pv):NULL)
 
 #define CopSTASH_ne(c,hv)	(!CopSTASH_eq(c,hv))
 #define CopLINE(c)		((c)->cop_line)
@@ -240,11 +235,7 @@
 #define CopLINE_set(c,l)	(CopLINE(c) = (l))
 
 /* OutCopFILE() is CopFILE for output (caller, die, warn, etc.) */
-#ifdef MACOS_TRADITIONAL
-#  define OutCopFILE(c) MacPerl_MPWFileName(CopFILE(c))
-#else
-#  define OutCopFILE(c) CopFILE(c)
-#endif
+#define OutCopFILE(c) CopFILE(c)
 
 /* If $[ is non-zero, it's stored in cop_hints under the key "$[", and
    HINT_ARYBASE is set to indicate this.
@@ -258,12 +249,17 @@
 #define CopARYBASE_set(c, b) STMT_START { \
 	if (b || ((c)->cop_hints & HINT_ARYBASE)) {			\
 	    (c)->cop_hints |= HINT_ARYBASE;				\
-	    if ((c) == &PL_compiling)					\
-		PL_hints |= HINT_LOCALIZE_HH | HINT_ARYBASE;		\
-	    (c)->cop_hints_hash						\
-	       = Perl_refcounted_he_new(aTHX_ (c)->cop_hints_hash,	\
+	    if ((c) == &PL_compiling) {					\
+		SV *val = newSViv(b);					\
+		(void)hv_stores(GvHV(PL_hintgv), "$[", val);		\
+		mg_set(val);						\
+		PL_hints |= HINT_ARYBASE;				\
+	    } else {							\
+		(c)->cop_hints_hash					\
+		   = Perl_refcounted_he_new(aTHX_ (c)->cop_hints_hash,	\
 					newSVpvs_flags("$[", SVs_TEMP),	\
 					sv_2mortal(newSViv(b)));	\
+	    }								\
 	}								\
     } STMT_END
 
@@ -279,16 +275,25 @@
 
 /* subroutine context */
 struct block_sub {
+    OP *	retop;	/* op to execute on exit from sub */
+    /* Above here is the same for sub, format and eval.  */
     CV *	cv;
-    GV *	gv;
-    GV *	dfoutgv;
+    /* Above here is the same for sub and format.  */
     AV *	savearray;
     AV *	argarray;
     I32		olddepth;
-    U8		hasargs;
-    U8		lval;		/* XXX merge lval and hasargs? */
     PAD		*oldcomppad;
+};
+
+
+/* format context */
+struct block_format {
     OP *	retop;	/* op to execute on exit from sub */
+    /* Above here is the same for sub, format and eval.  */
+    CV *	cv;
+    /* Above here is the same for sub and format.  */
+    GV *	gv;
+    GV *	dfoutgv;
 };
 
 /* base for the next two macros. Don't use directly.
@@ -302,7 +307,7 @@
 									\
 	cx->blk_sub.cv = cv;						\
 	cx->blk_sub.olddepth = CvDEPTH(cv);				\
-	cx->blk_sub.hasargs = hasargs;					\
+	cx->cx_type |= (hasargs) ? CXp_HASARGS : 0;			\
 	cx->blk_sub.retop = NULL;					\
 	if (!CvDEPTH(cv)) {						\
 	    SvREFCNT_inc_simple_void_NN(cv);				\
@@ -313,22 +318,21 @@
 
 #define PUSHSUB(cx)							\
 	PUSHSUB_BASE(cx)						\
-	cx->blk_sub.lval = PL_op->op_private &                          \
+	cx->blk_u16 = PL_op->op_private &				\
 	                      (OPpLVAL_INTRO|OPpENTERSUB_INARGS);
 
 /* variant for use by OP_DBSTATE, where op_private holds hint bits */
 #define PUSHSUB_DB(cx)							\
 	PUSHSUB_BASE(cx)						\
-	cx->blk_sub.lval = 0;
+	cx->blk_u16 = 0;
 
 
-#define PUSHFORMAT(cx)							\
-	cx->blk_sub.cv = cv;						\
-	cx->blk_sub.gv = gv;						\
-	cx->blk_sub.retop = NULL;					\
-	cx->blk_sub.hasargs = 0;					\
-	cx->blk_sub.dfoutgv = PL_defoutgv;				\
-	SvREFCNT_inc_void(cx->blk_sub.dfoutgv)
+#define PUSHFORMAT(cx, retop)						\
+	cx->blk_format.cv = cv;						\
+	cx->blk_format.gv = gv;						\
+	cx->blk_format.retop = (retop);					\
+	cx->blk_format.dfoutgv = PL_defoutgv;				\
+	SvREFCNT_inc_void(cx->blk_format.dfoutgv)
 
 #define POP_SAVEARRAY()						\
     STMT_START {							\
@@ -378,28 +382,32 @@
     } STMT_END
 
 #define POPFORMAT(cx)							\
-	setdefout(cx->blk_sub.dfoutgv);					\
-	SvREFCNT_dec(cx->blk_sub.dfoutgv);
+	setdefout(cx->blk_format.dfoutgv);				\
+	SvREFCNT_dec(cx->blk_format.dfoutgv);
 
 /* eval context */
 struct block_eval {
-    U8		old_in_eval;
-    U16		old_op_type;
+    OP *	retop;	/* op to execute on exit from eval */
+    /* Above here is the same for sub, format and eval.  */
     SV *	old_namesv;
     OP *	old_eval_root;
     SV *	cur_text;
     CV *	cv;
-    OP *	retop;	/* op to execute on exit from eval */
     JMPENV *	cur_top_env; /* value of PL_top_env when eval CX created */
 };
 
-#define CxOLD_IN_EVAL(cx)	(0 + (cx)->blk_eval.old_in_eval)
-#define CxOLD_OP_TYPE(cx)	(0 + (cx)->blk_eval.old_op_type)
+/* If we ever need more than 512 op types, change the shift from 7.
+   blku_gimme is actually also only 2 bits, so could be merged with something.
+*/
+
+#define CxOLD_IN_EVAL(cx)	(((cx)->blk_u16) & 0x7F)
+#define CxOLD_OP_TYPE(cx)	(((cx)->blk_u16) >> 7)
 
-#define PUSHEVAL(cx,n,fgv)						\
+#define PUSHEVAL(cx,n)							\
     STMT_START {							\
-	cx->blk_eval.old_in_eval = PL_in_eval;				\
-	cx->blk_eval.old_op_type = PL_op->op_type;			\
+	assert(!(PL_in_eval & ~0x7F));					\
+	assert(!(PL_op->op_type & ~0x1FF));				\
+	cx->blk_u16 = (PL_in_eval & 0x7F) | ((U16)PL_op->op_type << 7);	\
 	cx->blk_eval.old_namesv = (n ? newSVpv(n,0) : NULL);		\
 	cx->blk_eval.old_eval_root = PL_eval_root;			\
 	cx->blk_eval.cur_text = PL_parser ? PL_parser->linestr : NULL;	\
@@ -419,66 +427,54 @@
 
 /* loop context */
 struct block_loop {
-    char *	label;
     I32		resetsp;
     LOOP *	my_op;	/* My op, that contains redo, next and last ops.  */
     /* (except for non_ithreads we need to modify next_op in pp_ctl.c, hence
 	why next_op is conditionally defined below.)  */
 #ifdef USE_ITHREADS
-    void *	iterdata;
-    PAD		*oldcomppad;
+    PAD		*oldcomppad; /* Also used for the GV, if targoffset is 0 */
+    /* This is also accesible via cx->blk_loop.my_op->op_targ */
+    PADOFFSET	targoffset;
 #else
     OP *	next_op;
     SV **	itervar;
 #endif
-    /* Eliminated in blead by change 33080, but for binary compatibility
-       reasons we can't remove it from the middle of a struct in a maintenance
-       release, so it gets to stay, and be set to NULL.  */
-    SV *	itersave;
-    /* (from inspection of source code) for a .. range of strings this is the
-       current string.  */
-    SV *	iterlval;
-    /* (from inspection of source code) for a foreach loop this is the array
-       being iterated over. For a .. range of numbers it's the current value.
-       A check is often made on the SvTYPE of iterary to determine whether
-       we are iterating over an array or a range. (numbers or strings)  */
-    AV *	iterary;
-    IV		iterix;
-    /* (from inspection of source code) for a .. range of numbers this is the
-       maximum value.  */
-    IV		itermax;
+    union {
+	struct { /* valid if type is LOOP_FOR or LOOP_PLAIN (but {NULL,0})*/
+	    AV * ary; /* use the stack if this is NULL */
+	    IV ix;
+	} ary;
+	struct { /* valid if type is LOOP_LAZYIV */
+	    IV cur;
+	    IV end;
+	} lazyiv;
+	struct { /* valid if type if LOOP_LAZYSV */
+	    SV * cur;
+	    SV * end; /* maxiumum value (or minimum in reverse) */
+	} lazysv;
+    } state_u;
 };
-/* It might be possible to squeeze this structure further. As best I can tell
-   itermax and iterlval are never used at the same time, so it might be possible
-   to make them into a union. However, I'm not confident that there are enough
-   flag bits/NULLable pointers in this structure alone to encode which is
-   active. There is, however, U8 of space free in struct block, which could be
-   used. Right now it may not be worth squeezing this structure further, as it's
-   the largest part of struct block, and currently struct block is 64 bytes on
-   an ILP32 system, which will give good cache alignment.
-*/
 
 #ifdef USE_ITHREADS
 #  define CxITERVAR(c)							\
-	((c)->blk_loop.iterdata						\
-	 ? (CxPADLOOP(cx) 						\
-	    ? &CX_CURPAD_SV( (c)->blk_loop, 				\
-		    INT2PTR(PADOFFSET, (c)->blk_loop.iterdata))		\
-	    : &GvSV((GV*)(c)->blk_loop.iterdata))			\
+	((c)->blk_loop.oldcomppad					\
+	 ? (CxPADLOOP(c) 						\
+	    ? &CX_CURPAD_SV( (c)->blk_loop, (c)->blk_loop.targoffset )	\
+	    : &GvSV((GV*)(c)->blk_loop.oldcomppad))			\
 	 : (SV**)NULL)
-#  define CX_ITERDATA_SET(cx,idata)					\
-	CX_CURPAD_SAVE(cx->blk_loop);					\
-	cx->blk_loop.itersave = NULL;					\
-	cx->blk_loop.iterdata = (idata);
+#  define CX_ITERDATA_SET(cx,idata,o)					\
+	if ((cx->blk_loop.targoffset = (o)))				\
+	    CX_CURPAD_SAVE(cx->blk_loop);				\
+	else								\
+	    cx->blk_loop.oldcomppad = (idata);
 #else
 #  define CxITERVAR(c)		((c)->blk_loop.itervar)
-#  define CX_ITERDATA_SET(cx,ivar)					\
-	cx->blk_loop.itersave = NULL;					\
+#  define CX_ITERDATA_SET(cx,ivar,o)					\
 	cx->blk_loop.itervar = (SV**)(ivar);
 #endif
-#define CxLABEL(c)	(0 + (c)->blk_loop.label)
-#define CxHASARGS(c)	(0 + (c)->blk_sub.hasargs)
-#define CxLVAL(c)	(0 + (c)->blk_sub.lval)
+#define CxLABEL(c)	(0 + CopLABEL((c)->blk_oldcop))
+#define CxHASARGS(c)	(((c)->cx_type & CXp_HASARGS) == CXp_HASARGS)
+#define CxLVAL(c)	(0 + (c)->blk_u16)
 
 #ifdef USE_ITHREADS
 #  define PUSHLOOP_OP_NEXT		/* No need to do anything.  */
@@ -488,20 +484,29 @@
 #  define CX_LOOP_NEXTOP_GET(cx)	((cx)->blk_loop.next_op + 0)
 #endif
 
-#define PUSHLOOP(cx, dat, s)						\
-	cx->blk_loop.label = PL_curcop->cop_label;			\
+#define PUSHLOOP_PLAIN(cx, s)						\
+	cx->blk_loop.resetsp = s - PL_stack_base;			\
+	cx->blk_loop.my_op = cLOOP;					\
+	PUSHLOOP_OP_NEXT;						\
+	cx->blk_loop.state_u.ary.ary = NULL;				\
+	cx->blk_loop.state_u.ary.ix = 0;				\
+	CX_ITERDATA_SET(cx, NULL, 0);
+
+#define PUSHLOOP_FOR(cx, dat, s, offset)				\
 	cx->blk_loop.resetsp = s - PL_stack_base;			\
 	cx->blk_loop.my_op = cLOOP;					\
 	PUSHLOOP_OP_NEXT;						\
-	cx->blk_loop.iterlval = NULL;					\
-	cx->blk_loop.iterary = NULL;					\
-	cx->blk_loop.iterix = -1;					\
-	CX_ITERDATA_SET(cx,dat);
+	cx->blk_loop.state_u.ary.ary = NULL;				\
+	cx->blk_loop.state_u.ary.ix = 0;				\
+	CX_ITERDATA_SET(cx, dat, offset);
 
 #define POPLOOP(cx)							\
-	SvREFCNT_dec(cx->blk_loop.iterlval);				\
-	if (cx->blk_loop.iterary && cx->blk_loop.iterary != PL_curstack)\
-	    SvREFCNT_dec(cx->blk_loop.iterary);
+	if (CxTYPE(cx) == CXt_LOOP_LAZYSV) {				\
+	    SvREFCNT_dec(cx->blk_loop.state_u.lazysv.cur);		\
+	    SvREFCNT_dec(cx->blk_loop.state_u.lazysv.end);		\
+	}								\
+	if (CxTYPE(cx) == CXt_LOOP_FOR)					\
+	    SvREFCNT_dec(cx->blk_loop.state_u.ary.ary);
 
 /* given/when context */
 struct block_givwhen {
@@ -515,9 +520,9 @@
 
 /* context common to subroutines, evals and loops */
 struct block {
-    U16		blku_type;	/* what kind of context this is */
+    U8		blku_type;	/* what kind of context this is */
     U8		blku_gimme;	/* is this block running in list context? */
-    U8		blku_spare;	/* Padding to match with struct subst */
+    U16		blku_u16;	/* used by block_sub and block_eval (so far) */
     I32		blku_oldsp;	/* stack pointer to copy stuff down to */
     COP *	blku_oldcop;	/* old curcop pointer */
     I32		blku_oldmarksp;	/* mark stack index */
@@ -526,6 +531,7 @@
 
     union {
 	struct block_sub	blku_sub;
+	struct block_format	blku_format;
 	struct block_eval	blku_eval;
 	struct block_loop	blku_loop;
 	struct block_givwhen	blku_givwhen;
@@ -537,7 +543,9 @@
 #define blk_oldscopesp	cx_u.cx_blk.blku_oldscopesp
 #define blk_oldpm	cx_u.cx_blk.blku_oldpm
 #define blk_gimme	cx_u.cx_blk.blku_gimme
+#define blk_u16		cx_u.cx_blk.blku_u16
 #define blk_sub		cx_u.cx_blk.blk_u.blku_sub
+#define blk_format	cx_u.cx_blk.blk_u.blku_format
 #define blk_eval	cx_u.cx_blk.blk_u.blku_eval
 #define blk_loop	cx_u.cx_blk.blk_u.blku_loop
 #define blk_givwhen	cx_u.cx_blk.blk_u.blku_givwhen
@@ -576,12 +584,11 @@
 
 /* substitution context */
 struct subst {
-    U16		sbu_type;	/* what kind of context this is */
-    U8		sbu_once;	/* Actually both booleans, but U8 to matches */
-    U8		sbu_rxtainted;	/* struct block */
+    U8		sbu_type;	/* what kind of context this is */
+    U8		sbu_rflags;
+    U16		sbu_rxtainted;	/* matches struct block */
     I32		sbu_iters;
     I32		sbu_maxiters;
-    I32		sbu_rflags;
     I32		sbu_oldsave;
     char *	sbu_orig;
     SV *	sbu_dstr;
@@ -607,12 +614,12 @@
 #define sb_rxres	cx_u.cx_subst.sbu_rxres
 #define sb_rx		cx_u.cx_subst.sbu_rx
 
-#define PUSHSUBST(cx) CXINC, cx = &cxstack[cxstack_ix],			\
+#ifdef PERL_CORE
+#  define PUSHSUBST(cx) CXINC, cx = &cxstack[cxstack_ix],		\
 	cx->sb_iters		= iters,				\
 	cx->sb_maxiters		= maxiters,				\
 	cx->sb_rflags		= r_flags,				\
 	cx->sb_oldsave		= oldsave,				\
-	cx->sb_once		= once,					\
 	cx->sb_rxtainted	= rxtainted,				\
 	cx->sb_orig		= orig,					\
 	cx->sb_dstr		= dstr,					\
@@ -622,15 +629,16 @@
 	cx->sb_strend		= strend,				\
 	cx->sb_rxres		= NULL,					\
 	cx->sb_rx		= rx,					\
-	cx->cx_type		= CXt_SUBST;				\
+	cx->cx_type		= CXt_SUBST | (once ? CXp_ONCE : 0);	\
 	rxres_save(&cx->sb_rxres, rx);					\
 	(void)ReREFCNT_inc(rx)
 
-#define CxONCE(cx)		(0 + cx->sb_once)
-
-#define POPSUBST(cx) cx = &cxstack[cxstack_ix--];			\
+#  define POPSUBST(cx) cx = &cxstack[cxstack_ix--];			\
 	rxres_free(&cx->sb_rxres);					\
 	ReREFCNT_dec(cx->sb_rx)
+#endif
+
+#define CxONCE(cx)		((cx)->cx_type & CXp_ONCE)
 
 struct context {
     union {
@@ -640,47 +648,62 @@
 };
 #define cx_type cx_u.cx_subst.sbu_type
 
-#define CXTYPEMASK	0xff
+/* If you re-order these, there is also an array of uppercase names in perl.h
+   and a static array of context names in pp_ctl.c  */
+#define CXTYPEMASK	0xf
 #define CXt_NULL	0
-#define CXt_SUB		1
-#define CXt_EVAL	2
-#define CXt_LOOP	3
-#define CXt_SUBST	4
-#define CXt_BLOCK	5
-#define CXt_FORMAT	6
-#define CXt_GIVEN	7
-#define CXt_WHEN	8
-
-/* private flags for CXt_SUB and CXt_NULL */
-#define CXp_MULTICALL	0x00000400	/* part of a multicall (so don't
-					   tear down context on exit). */ 
+#define CXt_WHEN	1
+#define CXt_BLOCK	2
+/* When micro-optimising :-) keep GIVEN next to the LOOPs, as these 5 share a
+   jump table in pp_ctl.c
+   The first 4 don't have a 'case' in at least one switch statement in pp_ctl.c
+*/
+#define CXt_GIVEN	3
+/* This is first so that CXt_LOOP_FOR|CXt_LOOP_LAZYIV is CXt_LOOP_LAZYIV */
+#define CXt_LOOP_FOR	4
+#define CXt_LOOP_PLAIN	5
+#define CXt_LOOP_LAZYSV	6
+#define CXt_LOOP_LAZYIV	7
+#define CXt_SUB		8
+#define CXt_FORMAT      9
+#define CXt_EVAL       10
+#define CXt_SUBST      11
+/* SUBST doesn't feature in all switch statements.  */
+
+/* private flags for CXt_SUB and CXt_NULL
+   However, this is checked in many places which do not check the type, so
+   this bit needs to be kept clear for most everything else. For reasons I
+   haven't investigated, it can coexist with CXp_FOR_DEF */
+#define CXp_MULTICALL	0x10	/* part of a multicall (so don't
+				   tear down context on exit). */ 
+
+/* private flags for CXt_SUB and CXt_FORMAT */
+#define CXp_HASARGS	0x20
 
 /* private flags for CXt_EVAL */
-#define CXp_REAL	0x00000100	/* truly eval'', not a lookalike */
-#define CXp_TRYBLOCK	0x00000200	/* eval{}, not eval'' or similar */
+#define CXp_REAL	0x20	/* truly eval'', not a lookalike */
+#define CXp_TRYBLOCK	0x40	/* eval{}, not eval'' or similar */
 
 /* private flags for CXt_LOOP */
-#define CXp_FOREACH	0x00000200	/* a foreach loop */
-#define CXp_FOR_DEF	0x00000400	/* foreach using $_ */
+#define CXp_FOR_DEF	0x10	/* foreach using $_ */
 #ifdef USE_ITHREADS
-#  define CXp_PADVAR	0x00000100	/* itervar lives on pad, iterdata
-					   has pad offset; if not set,
-					   iterdata holds GV* */
-#  define CxPADLOOP(c)	(((c)->cx_type & (CXt_LOOP|CXp_PADVAR))		\
-			 == (CXt_LOOP|CXp_PADVAR))
+#  define CxPADLOOP(c)	((c)->blk_loop.targoffset)
 #endif
 
+/* private flags for CXt_SUBST */
+#define CXp_ONCE	0x10	/* What was sbu_once in struct subst */
+
 #define CxTYPE(c)	((c)->cx_type & CXTYPEMASK)
+#define CxTYPE_is_LOOP(c)	(((c)->cx_type & 0xC) == 0x4)
 #define CxMULTICALL(c)	(((c)->cx_type & CXp_MULTICALL)			\
 			 == CXp_MULTICALL)
 #define CxREALEVAL(c)	(((c)->cx_type & (CXTYPEMASK|CXp_REAL))		\
 			 == (CXt_EVAL|CXp_REAL))
 #define CxTRYBLOCK(c)	(((c)->cx_type & (CXTYPEMASK|CXp_TRYBLOCK))	\
 			 == (CXt_EVAL|CXp_TRYBLOCK))
-#define CxFOREACH(c)	(((c)->cx_type & (CXTYPEMASK|CXp_FOREACH))	\
-                         == (CXt_LOOP|CXp_FOREACH))
-#define CxFOREACHDEF(c)	(((c)->cx_type & (CXTYPEMASK|CXp_FOREACH|CXp_FOR_DEF))\
-			 == (CXt_LOOP|CXp_FOREACH|CXp_FOR_DEF))
+#define CxFOREACH(c)	(CxTYPE_is_LOOP(c) && CxTYPE(c) != CXt_LOOP_PLAIN)
+#define CxFOREACHDEF(c)	((CxTYPE_is_LOOP(c) && CxTYPE(c) != CXt_LOOP_PLAIN) \
+			 && ((c)->cx_type & CXp_FOR_DEF))
 
 #define CXINC (cxstack_ix < cxstack_max ? ++cxstack_ix : (cxstack_ix = cxinc()))
 
@@ -717,20 +740,20 @@
 =cut
 */
 
-#define G_SCALAR	0
-#define G_ARRAY		1
-#define G_VOID		128	/* skip this bit when adding flags below */
-#define G_WANT		(128|1)
+#define G_SCALAR	2
+#define G_ARRAY		3
+#define G_VOID		1
+#define G_WANT		3
 
 /* extra flags for Perl_call_* routines */
-#define G_DISCARD	2	/* Call FREETMPS.
+#define G_DISCARD	4	/* Call FREETMPS.
 				   Don't change this without consulting the
 				   hash actions codes defined in hv.h */
-#define G_EVAL		4	/* Assume eval {} around subroutine call. */
-#define G_NOARGS	8	/* Don't construct a @_ array. */
-#define G_KEEPERR      16	/* Append errors to $@, don't overwrite it */
-#define G_NODEBUG      32	/* Disable debugging at toplevel.  */
-#define G_METHOD       64       /* Calling method. */
+#define G_EVAL		8	/* Assume eval {} around subroutine call. */
+#define G_NOARGS       16	/* Don't construct a @_ array. */
+#define G_KEEPERR      32	/* Append errors to $@, don't overwrite it */
+#define G_NODEBUG      64	/* Disable debugging at toplevel.  */
+#define G_METHOD      128       /* Calling method. */
 #define G_FAKINGEVAL  256	/* Faking an eval context for call_sv or
 				   fold_constants. */
 
Index: src/gnu/usr.bin/perl/cv.h
diff -u src/gnu/usr.bin/perl/cv.h:1.11 src/gnu/usr.bin/perl/cv.h:1.12
--- cv.h:1.11	Mon Oct 12 18:24:20 2009
+++ cv.h	Fri Sep 24 15:06:39 2010
@@ -11,94 +11,19 @@
 /* This structure must the beginning of XPVFM in sv.h  */
 
 struct xpvcv {
-    union {
-	NV	xnv_nv;		/* numeric value, if any */
-	HV *	xgv_stash;
-	struct {
-	    U32	xlow;
-	    U32	xhigh;
-	}	xpad_cop_seq;	/* used by pad.c for cop_sequence */
-	struct {
-	    U32 xbm_previous;	/* how many characters in string before rare? */
-	    U8	xbm_flags;
-	    U8	xbm_rare;	/* rarest character in string */
-	}	xbm_s;		/* fields from PVBM */
-    }		xnv_u;
-    STRLEN	xpv_cur;	/* length of xp_pv as a C string */
-    STRLEN	xpv_len;	/* allocated size */
-    union {
-	IV	xivu_iv;
-	UV	xivu_uv;
-	void *	xivu_p1;
-	I32	xivu_i32;	/* depth, >= 2 indicates recursive call */
-	HEK *	xivu_namehek;
-    }		xiv_u;
-    union {
-	MAGIC*	xmg_magic;	/* linked list of magicalness */
-	HV*	xmg_ourstash;	/* Stash for our (when SvPAD_OUR is true) */
-    } xmg_u;
-    HV*		xmg_stash;	/* class package */
-
-    HV *	xcv_stash;
-    union {
-	OP *	xcv_start;
-	ANY	xcv_xsubany;
-    }		xcv_start_u;
-    union {
-	OP *	xcv_root;
-	void	(*xcv_xsub) (pTHX_ CV*);
-    }		xcv_root_u;
-    GV *	xcv_gv;
-    char *	xcv_file;
-    PADLIST *	xcv_padlist;
-    CV *	xcv_outside;
-    U32		xcv_outside_seq; /* the COP sequence (at the point of our
-				  * compilation) in the lexically enclosing
-				  * sub */
-    cv_flags_t	xcv_flags;
+    _XPV_HEAD;
+    _XPVMG_HEAD;
+    _XPVCV_COMMON;
 };
 
-typedef struct {
-    STRLEN	xpv_cur;	/* length of xp_pv as a C string */
-    STRLEN	xpv_len;	/* allocated size */
-    union {
-	IV	xivu_iv;
-	UV	xivu_uv;
-	void *	xivu_p1;
-	I32	xivu_i32;	/* depth, >= 2 indicates recursive call */
-	HEK *	xivu_namehek;
-    }		xiv_u;
-    union {
-	MAGIC*	xmg_magic;	/* linked list of magicalness */
-	HV*	xmg_ourstash;	/* Stash for our (when SvPAD_OUR is true) */
-    } xmg_u;
-    HV*		xmg_stash;	/* class package */
-
-    HV *	xcv_stash;
-    union {
-	OP *	xcv_start;
-	ANY	xcv_xsubany;
-    }		xcv_start_u;
-    union {
-	OP *	xcv_root;
-	void	(*xcv_xsub) (pTHX_ CV*);
-    }		xcv_root_u;
-    GV *	xcv_gv;
-    char *	xcv_file;
-    PADLIST *	xcv_padlist;
-    CV *	xcv_outside;
-    U32		xcv_outside_seq; /* the COP sequence (at the point of our
-				  * compilation) in the lexically enclosing
-				  * sub */
-    cv_flags_t	xcv_flags;
-} xpvcv_allocated;
-
 /*
 =head1 Handy Values
 
 =for apidoc AmU||Nullcv
 Null CV pointer.
 
+(deprecated - use C<(CV *)NULL> instead)
+
 =head1 CV Manipulation Functions
 
 =for apidoc Am|HV*|CvSTASH|CV* cv
@@ -107,7 +32,9 @@
 =cut
 */
 
-#define Nullcv Null(CV*)
+#ifndef PERL_CORE
+#  define Nullcv Null(CV*)
+#endif
 
 #define CvSTASH(sv)	((XPVCV*)MUTABLE_PTR(SvANY(sv)))->xcv_stash
 #define CvSTART(sv)	((XPVCV*)MUTABLE_PTR(SvANY(sv)))->xcv_start_u.xcv_start
@@ -136,7 +63,6 @@
 #define CvOUTSIDE_SEQ(sv) ((XPVCV*)MUTABLE_PTR(SvANY(sv)))->xcv_outside_seq
 
 #define CVf_METHOD	0x0001	/* CV is explicitly marked as a method */
-#define CVf_LOCKED	0x0002	/* CV locks itself or first arg on entry */
 #define CVf_LVALUE	0x0004  /* CV return value can be used as lvalue */
 
 #define CVf_WEAKOUTSIDE	0x0010  /* CvOUTSIDE isn't ref counted */
@@ -151,7 +77,7 @@
 #define CVf_ISXSUB	0x0800	/* CV is an XSUB, not pure perl.  */
 
 /* This symbol for optimised communication between toke.c and op.c: */
-#define CVf_BUILTIN_ATTRS	(CVf_METHOD|CVf_LOCKED|CVf_LVALUE)
+#define CVf_BUILTIN_ATTRS	(CVf_METHOD|CVf_LVALUE)
 
 #define CvCLONE(cv)		(CvFLAGS(cv) & CVf_CLONE)
 #define CvCLONE_on(cv)		(CvFLAGS(cv) |= CVf_CLONE)
@@ -176,10 +102,6 @@
 #define CvMETHOD(cv)		(CvFLAGS(cv) & CVf_METHOD)
 #define CvMETHOD_on(cv)		(CvFLAGS(cv) |= CVf_METHOD)
 #define CvMETHOD_off(cv)	(CvFLAGS(cv) &= ~CVf_METHOD)
-
-#define CvLOCKED(cv)		(CvFLAGS(cv) & CVf_LOCKED)
-#define CvLOCKED_on(cv)		(CvFLAGS(cv) |= CVf_LOCKED)
-#define CvLOCKED_off(cv)	(CvFLAGS(cv) &= ~CVf_LOCKED)
 
 #define CvLVALUE(cv)		(CvFLAGS(cv) & CVf_LVALUE)
 #define CvLVALUE_on(cv)		(CvFLAGS(cv) |= CVf_LVALUE)
Index: src/gnu/usr.bin/perl/deb.c
diff -u src/gnu/usr.bin/perl/deb.c:1.11 src/gnu/usr.bin/perl/deb.c:1.12
--- deb.c:1.11	Mon Oct 12 18:24:20 2009
+++ deb.c	Fri Sep 24 15:06:39 2010
@@ -302,8 +302,7 @@
 		if (CxTYPE(cx) == CXt_EVAL || CxTYPE(cx) == CXt_SUB
 			|| CxTYPE(cx) == CXt_FORMAT)
 		{
-		    const OP * const retop = (CxTYPE(cx) == CXt_EVAL)
-			    ? cx->blk_eval.retop : cx->blk_sub.retop;
+		    const OP * const retop = cx->blk_sub.retop;
 
 		    PerlIO_printf(Perl_debug_log, "  retop=%s\n",
 			    retop ? OP_NAME(retop) : "(null)"
Index: src/gnu/usr.bin/perl/doio.c
diff -u src/gnu/usr.bin/perl/doio.c:1.14 src/gnu/usr.bin/perl/doio.c:1.15
--- doio.c:1.14	Mon Oct 12 18:24:20 2009
+++ doio.c	Fri Sep 24 15:06:40 2010
@@ -312,6 +312,7 @@
 		else {
 		    PerlIO *that_fp = NULL;
 		    if (num_svs > 1) {
+			/* diag_listed_as: More than one argument to '%s' open */
 			Perl_croak(aTHX_ "More than one argument to '%c&' open",IoTYPE(io));
 		    }
 		    while (isSPACE(*type))
@@ -398,6 +399,7 @@
 		    fp = PerlIO_stdout();
 		    IoTYPE(io) = IoTYPE_STD;
 		    if (num_svs > 1) {
+			/* diag_listed_as: More than one argument to '%s' open */
 			Perl_croak(aTHX_ "More than one argument to '>%c' open",IoTYPE_STD);
 		    }
 		}
@@ -431,6 +433,7 @@
 		fp = PerlIO_stdin();
 		IoTYPE(io) = IoTYPE_STD;
 		if (num_svs > 1) {
+		    /* diag_listed_as: More than one argument to '%s' open */
 		    Perl_croak(aTHX_ "More than one argument to '<%c' open",IoTYPE_STD);
 		}
 	    }
@@ -626,7 +629,6 @@
                 Pid_t pid;
                 SV *sv;
 
-                LOCK_FDPID_MUTEX;
                 sv = *av_fetch(PL_fdpid,fd,TRUE);
                 SvUPGRADE(sv, SVt_IV);
                 pid = SvIVX(sv);
@@ -634,7 +636,6 @@
                 sv = *av_fetch(PL_fdpid,savefd,TRUE);
                 SvUPGRADE(sv, SVt_IV);
                 SvIV_set(sv, pid);
-                UNLOCK_FDPID_MUTEX;
             }
 #endif
 
@@ -757,14 +758,13 @@
 		fileuid = PL_statbuf.st_uid;
 		filegid = PL_statbuf.st_gid;
 		if (!S_ISREG(PL_filemode)) {
-		    if (ckWARN_d(WARN_INPLACE))	
-		        Perl_warner(aTHX_ packWARN(WARN_INPLACE),
-			    "Can't do inplace edit: %s is not a regular file",
-		            PL_oldname );
+		    Perl_ck_warner_d(aTHX_ packWARN(WARN_INPLACE),
+				     "Can't do inplace edit: %s is not a regular file",
+				     PL_oldname );
 		    do_close(gv,FALSE);
 		    continue;
 		}
-		if (*PL_inplace) {
+		if (*PL_inplace && strNE(PL_inplace, "*")) {
 		    const char *star = strchr(PL_inplace, '*');
 		    if (star) {
 			const char *begin = PL_inplace;
@@ -789,10 +789,9 @@
 #endif
                       )
 		    {
-			if (ckWARN_d(WARN_INPLACE))	
-			    Perl_warner(aTHX_ packWARN(WARN_INPLACE),
-			      "Can't do inplace edit: %"SVf" would not be unique",
-			      SVfARG(sv));
+			Perl_ck_warner_d(aTHX_ packWARN(WARN_INPLACE),
+					 "Can't do inplace edit: %"SVf" would not be unique",
+					 SVfARG(sv));
 			do_close(gv,FALSE);
 			continue;
 		    }
@@ -800,10 +799,9 @@
 #ifdef HAS_RENAME
 #if !defined(DOSISH) && !defined(__CYGWIN__) && !defined(EPOC)
 		    if (PerlLIO_rename(PL_oldname,SvPVX_const(sv)) < 0) {
-		        if (ckWARN_d(WARN_INPLACE))	
-			    Perl_warner(aTHX_ packWARN(WARN_INPLACE),
-			      "Can't rename %s to %"SVf": %s, skipping file",
-			      PL_oldname, SVfARG(sv), Strerror(errno));
+			Perl_ck_warner_d(aTHX_ packWARN(WARN_INPLACE),
+					 "Can't rename %s to %"SVf": %s, skipping file",
+					 PL_oldname, SVfARG(sv), Strerror(errno));
 			do_close(gv,FALSE);
 			continue;
 		    }
@@ -816,10 +814,9 @@
 #else
 		    (void)UNLINK(SvPVX_const(sv));
 		    if (link(PL_oldname,SvPVX_const(sv)) < 0) {
-		        if (ckWARN_d(WARN_INPLACE))	
-			    Perl_warner(aTHX_ packWARN(WARN_INPLACE),
-			      "Can't rename %s to %"SVf": %s, skipping file",
-			      PL_oldname, SVfARG(sv), Strerror(errno) );
+			Perl_ck_warner_d(aTHX_ packWARN(WARN_INPLACE),
+					 "Can't rename %s to %"SVf": %s, skipping file",
+					 PL_oldname, SVfARG(sv), Strerror(errno) );
 			do_close(gv,FALSE);
 			continue;
 		    }
@@ -830,10 +827,9 @@
 #if !defined(DOSISH) && !defined(AMIGAOS)
 #  ifndef VMS  /* Don't delete; use automatic file versioning */
 		    if (UNLINK(PL_oldname) < 0) {
-		        if (ckWARN_d(WARN_INPLACE))	
-			    Perl_warner(aTHX_ packWARN(WARN_INPLACE),
-			      "Can't remove %s: %s, skipping file",
-			      PL_oldname, Strerror(errno) );
+			Perl_ck_warner_d(aTHX_ packWARN(WARN_INPLACE),
+					 "Can't remove %s: %s, skipping file",
+					 PL_oldname, Strerror(errno) );
 			do_close(gv,FALSE);
 			continue;
 		    }
@@ -853,9 +849,8 @@
 				   O_WRONLY|O_CREAT|OPEN_EXCL,0600,
 #endif
 				   NULL, NULL, 0)) {
-		    if (ckWARN_d(WARN_INPLACE))	
-		        Perl_warner(aTHX_ packWARN(WARN_INPLACE), "Can't do inplace edit on %s: %s",
-		          PL_oldname, Strerror(errno) );
+		    Perl_ck_warner_d(aTHX_ packWARN(WARN_INPLACE), "Can't do inplace edit on %s: %s",
+				     PL_oldname, Strerror(errno) );
 		    do_close(gv,FALSE);
 		    continue;
 		}
@@ -1095,12 +1090,10 @@
 }
 
 int
-Perl_mode_from_discipline(pTHX_ SV *discp)
+Perl_mode_from_discipline(pTHX_ const char *s, STRLEN len)
 {
     int mode = O_BINARY;
-    if (discp) {
-	STRLEN len;
-	const char *s = SvPV_const(discp,len);
+    if (s) {
 	while (*s) {
 	    if (*s == ':') {
 		switch (s[1]) {
@@ -1246,10 +1239,8 @@
 	    }
 	    else {
 		assert((char *)result == tmps);
-		if (ckWARN_d(WARN_UTF8)) {
-		    Perl_warner(aTHX_ packWARN(WARN_UTF8),
-				"Wide character in print");
-		}
+		Perl_ck_warner_d(aTHX_ packWARN(WARN_UTF8),
+				 "Wide character in print");
 	    }
 	}
 	/* To detect whether the process is about to overstep its
@@ -1397,7 +1388,7 @@
 {
     dVAR;
     PERL_ARGS_ASSERT_DO_AEXEC5;
-#if defined(MACOS_TRADITIONAL) || defined(__SYMBIAN32__) || defined(__LIBCATAMOUNT__)
+#if defined(__SYMBIAN32__) || defined(__LIBCATAMOUNT__)
     Perl_croak(aTHX_ "exec? I'm not *that* kind of operating system");
 #else
     if (sp > mark) {
@@ -1727,8 +1718,11 @@
 	     * CRTL's emulation of Unix-style signals and kill()
 	     */
 	    while (++mark <= sp) {
-		I32 proc = SvIV(*mark);
+		I32 proc;
 		register unsigned long int __vmssts;
+		if (!(SvIOK(*mark) || SvNOK(*mark) || looks_like_number(*mark)))
+		    Perl_croak(aTHX_ "Can't kill a non-numeric process ID");
+		proc = SvIV(*mark);
 		APPLY_TAINT_PROPER();
 		if (!((__vmssts = sys$delprc(&proc,0)) & 1)) {
 		    tot--;
@@ -1751,7 +1745,10 @@
 	if (val < 0) {
 	    val = -val;
 	    while (++mark <= sp) {
-		const I32 proc = SvIV(*mark);
+		I32 proc;
+		if (!(SvIOK(*mark) || SvNOK(*mark) || looks_like_number(*mark)))
+		    Perl_croak(aTHX_ "Can't kill a non-numeric process ID");
+		proc = SvIV(*mark);
 		APPLY_TAINT_PROPER();
 #ifdef HAS_KILLPG
 		if (PerlProc_killpg(proc,val))	/* BSD */
@@ -1763,7 +1760,10 @@
 	}
 	else {
 	    while (++mark <= sp) {
-		const I32 proc = SvIV(*mark);
+		I32 proc;
+		if (!(SvIOK(*mark) || SvNOK(*mark) || looks_like_number(*mark)))
+		    Perl_croak(aTHX_ "Can't kill a non-numeric process ID");
+		proc = SvIV(*mark);
 		APPLY_TAINT_PROPER();
 		if (PerlProc_kill(proc, val))
 		    tot--;
@@ -1918,7 +1918,11 @@
      return (mode & statbufp->st_mode) ? TRUE : FALSE;
 
 #else /* ! DOSISH */
+# ifdef __CYGWIN__
+    if (ingroup(544,effective)) {     /* member of Administrators */
+# else
     if ((effective ? PL_euid : PL_uid) == 0) {	/* root is special */
+# endif
 	if (mode == S_IXUSR) {
 	    if (statbufp->st_mode & 0111 || S_ISDIR(statbufp->st_mode))
 		return TRUE;
@@ -1942,13 +1946,9 @@
 }
 #endif /* ! VMS */
 
-bool
-Perl_ingroup(pTHX_ Gid_t testgid, bool effective)
+static bool
+S_ingroup(pTHX_ Gid_t testgid, bool effective)
 {
-#ifdef MACOS_TRADITIONAL
-    /* This is simply not correct for AppleShare, but fix it yerself. */
-    return TRUE;
-#else
     dVAR;
     if (testgid == (effective ? PL_egid : PL_gid))
 	return TRUE;
@@ -1973,7 +1973,6 @@
 #else
     return FALSE;
 #endif
-#endif
 }
 
 #if defined(HAS_MSG) || defined(HAS_SEM) || defined(HAS_SHM)
@@ -2006,6 +2005,7 @@
 #endif
 #if !defined(HAS_MSG) || !defined(HAS_SEM) || !defined(HAS_SHM)
     default:
+        /* diag_listed_as: msg%s not implemented */
 	Perl_croak(aTHX_ "%s not implemented", PL_op_desc[optype]);
 #endif
     }
@@ -2066,12 +2066,14 @@
 		   than guessing about u_?short(_t)? */
 	}
 #else
+        /* diag_listed_as: sem%s not implemented */
 	Perl_croak(aTHX_ "%s not implemented", PL_op_desc[optype]);
 #endif
 	break;
 #endif
 #if !defined(HAS_MSG) || !defined(HAS_SEM) || !defined(HAS_SHM)
     default:
+        /* diag_listed_as: shm%s not implemented */
 	Perl_croak(aTHX_ "%s not implemented", PL_op_desc[optype]);
 #endif
     }
@@ -2119,6 +2121,7 @@
 #endif
 	    ret = Semctl(id, n, cmd, unsemds);
 #else
+	    /* diag_listed_as: sem%s not implemented */
 	    Perl_croak(aTHX_ "%s not implemented", PL_op_desc[optype]);
 #endif
         }
@@ -2160,6 +2163,7 @@
 #else
     PERL_UNUSED_ARG(sp);
     PERL_UNUSED_ARG(mark);
+    /* diag_listed_as: msg%s not implemented */
     Perl_croak(aTHX_ "msgsnd not implemented");
 #endif
 }
@@ -2201,6 +2205,7 @@
 #else
     PERL_UNUSED_ARG(sp);
     PERL_UNUSED_ARG(mark);
+    /* diag_listed_as: msg%s not implemented */
     Perl_croak(aTHX_ "msgrcv not implemented");
 #endif
 }
@@ -2255,6 +2260,7 @@
         return result;
     }
 #else
+    /* diag_listed_as: sem%s not implemented */
     Perl_croak(aTHX_ "semop not implemented");
 #endif
 }
@@ -2313,6 +2319,7 @@
     }
     return shmdt(shm);
 #else
+    /* diag_listed_as: shm%s not implemented */
     Perl_croak(aTHX_ "shm I/O not implemented");
 #endif
 }
@@ -2354,11 +2361,6 @@
     fp = Perl_vms_start_glob(aTHX_ tmpglob, io);
 
 #else /* !VMS */
-#ifdef MACOS_TRADITIONAL
-    sv_setpv(tmpcmd, "glob ");
-    sv_catsv(tmpcmd, tmpglob);
-    sv_catpv(tmpcmd, " |");
-#else
 #ifdef DOSISH
 #ifdef OS2
     sv_setpv(tmpcmd, "for a in ");
@@ -2390,7 +2392,6 @@
 #endif
 #endif /* !CSH */
 #endif /* !DOSISH */
-#endif /* MACOS_TRADITIONAL */
     (void)do_open(PL_last_in_gv, (char*)SvPVX_const(tmpcmd), SvCUR(tmpcmd),
 		  FALSE, O_RDONLY, 0, NULL);
     fp = IoIFP(io);
Index: src/gnu/usr.bin/perl/doop.c
diff -u src/gnu/usr.bin/perl/doop.c:1.13 src/gnu/usr.bin/perl/doop.c:1.14
--- doop.c:1.13	Mon Oct 12 18:24:20 2009
+++ doop.c	Fri Sep 24 15:06:40 2010
@@ -203,10 +203,6 @@
 	if (complement && !del)
 	    rlen = tbl[0x100];
 
-#ifdef MACOS_TRADITIONAL
-#define comp CoMP   /* "comp" is a keyword in some compilers ... */
-#endif
-
 	if (PL_op->op_private & OPpTRANS_SQUASH) {
 	    UV pch = 0xfeedface;
 	    while (s < send) {
@@ -811,9 +807,8 @@
 	    }
 #ifdef UV_IS_QUAD
 	    else if (size == 64) {
-		if (ckWARN(WARN_PORTABLE))
-		    Perl_warner(aTHX_ packWARN(WARN_PORTABLE),
-				"Bit vector size > 32 non-portable");
+		Perl_ck_warner(aTHX_ packWARN(WARN_PORTABLE),
+			       "Bit vector size > 32 non-portable");
 		if (uoffset >= srclen)
 		    retnum = 0;
 		else if (uoffset + 1 >= srclen)
@@ -879,9 +874,8 @@
 		      s[uoffset + 3];
 #ifdef UV_IS_QUAD
 	else if (size == 64) {
-	    if (ckWARN(WARN_PORTABLE))
-		Perl_warner(aTHX_ packWARN(WARN_PORTABLE),
-			    "Bit vector size > 32 non-portable");
+	    Perl_ck_warner(aTHX_ packWARN(WARN_PORTABLE),
+			   "Bit vector size > 32 non-portable");
 	    retnum =
 		((UV) s[uoffset    ] << 56) +
 		((UV) s[uoffset + 1] << 48) +
@@ -972,9 +966,8 @@
 	}
 #ifdef UV_IS_QUAD
 	else if (size == 64) {
-	    if (ckWARN(WARN_PORTABLE))
-		Perl_warner(aTHX_ packWARN(WARN_PORTABLE),
-			    "Bit vector size > 32 non-portable");
+	    Perl_ck_warner(aTHX_ packWARN(WARN_PORTABLE),
+			   "Bit vector size > 32 non-portable");
 	    s[offset  ] = (U8)((lval >> 56) & 0xff);
 	    s[offset+1] = (U8)((lval >> 48) & 0xff);
 	    s[offset+2] = (U8)((lval >> 40) & 0xff);
@@ -1198,8 +1191,7 @@
     }
   nope:
 
-    if (svrecode)
-	 SvREFCNT_dec(svrecode);
+    SvREFCNT_dec(svrecode);
 
     Safefree(temp_buffer);
     return count;
@@ -1474,8 +1466,7 @@
 	    }
 	    LvTYPE(TARG) = 'k';
 	    if (LvTARG(TARG) != (const SV *)keys) {
-		if (LvTARG(TARG))
-		    SvREFCNT_dec(LvTARG(TARG));
+		SvREFCNT_dec(LvTARG(TARG));
 		LvTARG(TARG) = SvREFCNT_inc_simple(keys);
 	    }
 	    PUSHs(TARG);
Index: src/gnu/usr.bin/perl/dump.c
diff -u src/gnu/usr.bin/perl/dump.c:1.12 src/gnu/usr.bin/perl/dump.c:1.13
--- dump.c:1.12	Mon Oct 12 18:24:20 2009
+++ dump.c	Fri Sep 24 15:06:40 2010
@@ -34,11 +34,11 @@
     "BIND",
     "IV",
     "NV",
-    "RV",
     "PV",
     "PVIV",
     "PVNV",
     "PVMG",
+    "REGEXP",
     "PVGV",
     "PVLV",
     "PVAV",
@@ -54,11 +54,11 @@
     "BIND",
     "IV",
     "NV",
-    "RV",
     "PV",
     "PVIV",
     "PVNV",
     "PVMG",
+    "REGEXP",
     "GV",
     "PVLV",
     "AV",
@@ -92,20 +92,34 @@
 void
 Perl_dump_all(pTHX)
 {
+    dump_all_perl(FALSE);
+}
+
+void
+Perl_dump_all_perl(pTHX_ bool justperl)
+{
+
     dVAR;
     PerlIO_setlinebuf(Perl_debug_log);
     if (PL_main_root)
 	op_dump(PL_main_root);
-    dump_packsubs(PL_defstash);
+    dump_packsubs_perl(PL_defstash, justperl);
 }
 
 void
 Perl_dump_packsubs(pTHX_ const HV *stash)
 {
+    PERL_ARGS_ASSERT_DUMP_PACKSUBS;
+    dump_packsubs_perl(stash, FALSE);
+}
+
+void
+Perl_dump_packsubs_perl(pTHX_ const HV *stash, bool justperl)
+{
     dVAR;
     I32	i;
 
-    PERL_ARGS_ASSERT_DUMP_PACKSUBS;
+    PERL_ARGS_ASSERT_DUMP_PACKSUBS_PERL;
 
     if (!HvARRAY(stash))
 	return;
@@ -116,13 +130,13 @@
 	    if (SvTYPE(gv) != SVt_PVGV || !GvGP(gv))
 		continue;
 	    if (GvCVu(gv))
-		dump_sub(gv);
+		dump_sub_perl(gv, justperl);
 	    if (GvFORM(gv))
 		dump_form(gv);
 	    if (HeKEY(entry)[HeKLEN(entry)-1] == ':') {
 		const HV * const hv = GvHV(gv);
 		if (hv && (hv != PL_defstash))
-		    dump_packsubs(hv);		/* nested package */
+		    dump_packsubs_perl(hv, justperl); /* nested package */
 	    }
 	}
     }
@@ -131,10 +145,21 @@
 void
 Perl_dump_sub(pTHX_ const GV *gv)
 {
-    SV * const sv = sv_newmortal();
-
     PERL_ARGS_ASSERT_DUMP_SUB;
+    dump_sub_perl(gv, FALSE);
+}
 
+void
+Perl_dump_sub_perl(pTHX_ const GV *gv, bool justperl)
+{
+    SV * sv;
+
+    PERL_ARGS_ASSERT_DUMP_SUB_PERL;
+
+    if (justperl && (CvISXSUB(GvCV(gv)) || !CvROOT(GvCV(gv))))
+	return;
+
+    sv = sv_newmortal();
     gv_fullname3(sv, gv, NULL);
     Perl_dump_indent(aTHX_ 0, Perl_debug_log, "\nSUB %s = ", SvPVX_const(sv));
     if (CvISXSUB(GvCV(gv)))
@@ -505,8 +530,11 @@
 	else {
 	    SV * const tmp = newSVpvs("");
 	    sv_catpv(t, "(");
-	    if (SvOOK(sv))
-		Perl_sv_catpvf(aTHX_ t, "[%s]", pv_display(tmp, SvPVX_const(sv)-SvIVX(sv), SvIVX(sv), 0, 127));
+	    if (SvOOK(sv)) {
+		STRLEN delta;
+		SvOOK_offset(sv, delta);
+		Perl_sv_catpvf(aTHX_ t, "[%s]", pv_display(tmp, SvPVX_const(sv)-delta, delta, 0, 127));
+	    }
 	    Perl_sv_catpvf(aTHX_ t, "%s)", pv_display(tmp, SvPVX_const(sv), SvCUR(sv), SvLEN(sv), 127));
 	    if (SvUTF8(sv))
 		Perl_sv_catpvf(aTHX_ t, " [UTF8 \"%s\"]",
@@ -978,7 +1006,7 @@
 		sv_catpv(tmpsv, ",HUSH_VMSISH");
 	}
 	else if (PL_check[optype] != MEMBER_TO_FPTR(Perl_ck_ftst)) {
-	    if (OP_IS_FILETEST_ACCESS(o) && o->op_private & OPpFT_ACCESS)
+	    if (OP_IS_FILETEST_ACCESS(o->op_type) && o->op_private & OPpFT_ACCESS)
 		sv_catpv(tmpsv, ",FT_ACCESS");
 	    if (o->op_private & OPpFT_STACKED)
 		sv_catpv(tmpsv, ",FT_STACKED");
@@ -1061,6 +1089,7 @@
 #endif
 	break;
     case OP_CONST:
+    case OP_HINTSEVAL:
     case OP_METHOD_NAMED:
 #ifndef USE_ITHREADS
 	/* with ITHREADS, consts are stored in the pad, and the right pad
@@ -1068,7 +1097,6 @@
 	Perl_dump_indent(aTHX_ level, file, "SV = %s\n", SvPEEK(cSVOPo_sv));
 #endif
 	break;
-    case OP_SETSTATE:
     case OP_NEXTSTATE:
     case OP_DBSTATE:
 	if (CopLINE(cCOPo))
@@ -1258,6 +1286,7 @@
 	    else if (v == &PL_vtbl_utf8)       s = "utf8";
             else if (v == &PL_vtbl_arylen_p)   s = "arylen_p";
             else if (v == &PL_vtbl_hintselem)  s = "hintselem";
+            else if (v == &PL_vtbl_hints)      s = "hints";
 	    else			       s = NULL;
 	    if (s)
 	        Perl_dump_indent(aTHX_ level, file, "    MG_VIRTUAL = &PL_vtbl_%s\n", s);
@@ -1477,7 +1506,6 @@
 	if (SvCOMPILED(sv))	sv_catpv(d, "COMPILED,");
 	if (CvLVALUE(sv))	sv_catpv(d, "LVALUE,");
 	if (CvMETHOD(sv))	sv_catpv(d, "METHOD,");
-	if (CvLOCKED(sv))	sv_catpv(d, "LOCKED,");
 	if (CvWEAKOUTSIDE(sv))	sv_catpv(d, "WEAKOUTSIDE,");
 	break;
     case SVt_PVHV:
@@ -1492,7 +1520,6 @@
 	if (isGV_with_GP(sv)) {
 	    if (GvINTRO(sv))	sv_catpv(d, "INTRO,");
 	    if (GvMULTI(sv))	sv_catpv(d, "MULTI,");
-	    if (GvUNIQUE(sv))   sv_catpv(d, "UNIQUE,");
 	    if (GvASSUMECV(sv))	sv_catpv(d, "ASSUMECV,");
 	    if (GvIN_PAD(sv))   sv_catpv(d, "IN_PAD,");
 	}
@@ -1539,12 +1566,15 @@
     s = SvPVX_const(d);
 
 #ifdef DEBUG_LEAKING_SCALARS
-    Perl_dump_indent(aTHX_ level, file, "ALLOCATED at %s:%d %s %s%s\n",
+    Perl_dump_indent(aTHX_ level, file,
+	"ALLOCATED at %s:%d %s %s%s; serial %"UVuf"\n",
 	sv->sv_debug_file ? sv->sv_debug_file : "(unknown)",
 	sv->sv_debug_line,
 	sv->sv_debug_inpad ? "for" : "by",
 	sv->sv_debug_optype ? PL_op_name[sv->sv_debug_optype]: "(none)",
-	sv->sv_debug_cloned ? " (cloned)" : "");
+	sv->sv_debug_cloned ? " (cloned)" : "",
+	sv->sv_debug_serial
+    );
 #endif
     Perl_dump_indent(aTHX_ level, file, "SV = ");
     if (type < SVt_LAST) {
@@ -1560,8 +1590,9 @@
 	return;
     }
     if ((type >= SVt_PVIV && type != SVt_PVAV && type != SVt_PVHV
-	 && type != SVt_PVCV && !isGV_with_GP(sv))
-	|| type == SVt_IV) {
+	 && type != SVt_PVCV && !isGV_with_GP(sv) && type != SVt_PVFM
+	 && type != SVt_PVIO)
+	|| (type == SVt_IV && !SvROK(sv))) {
 	if (SvIsUV(sv)
 #ifdef PERL_OLD_COPY_ON_WRITE
 	               || SvIsCOW(sv)
@@ -1570,8 +1601,6 @@
 	    Perl_dump_indent(aTHX_ level, file, "  UV = %"UVuf, (UV)SvUVX(sv));
 	else
 	    Perl_dump_indent(aTHX_ level, file, "  IV = %"IVdf, (IV)SvIVX(sv));
-	if (SvOOK(sv))
-	    PerlIO_printf(file, "  (OFFSET)");
 #ifdef PERL_OLD_COPY_ON_WRITE
 	if (SvIsCOW_shared_hash(sv))
 	    PerlIO_printf(file, "  (HASH)");
@@ -1586,8 +1615,8 @@
 	Perl_dump_indent(aTHX_ level, file, "  COP_HIGH = %"UVuf"\n",
 			 (UV) COP_SEQ_RANGE_HIGH(sv));
     } else if ((type >= SVt_PVNV && type != SVt_PVAV && type != SVt_PVHV
-		&& type != SVt_PVCV && type != SVt_PVFM && !isGV_with_GP(sv)
-		&& !SvVALID(sv))
+		&& type != SVt_PVCV && type != SVt_PVFM  && type != SVt_REGEXP
+		&& type != SVt_PVIO && !isGV_with_GP(sv) && !SvVALID(sv))
 	       || type == SVt_NV) {
 	STORE_NUMERIC_LOCAL_SET_STANDARD();
 	/* %Vg doesn't work? --jhi */
@@ -1609,9 +1638,20 @@
     }
     if ((type <= SVt_PVLV && !isGV_with_GP(sv)) || type == SVt_PVFM) {
 	if (SvPVX_const(sv)) {
+	    STRLEN delta;
+	    if (SvOOK(sv)) {
+		SvOOK_offset(sv, delta);
+		Perl_dump_indent(aTHX_ level, file,"  OFFSET = %"UVuf"\n",
+				 (UV) delta);
+	    } else {
+		delta = 0;
+	    }
 	    Perl_dump_indent(aTHX_ level, file,"  PV = 0x%"UVxf" ", PTR2UV(SvPVX_const(sv)));
-	    if (SvOOK(sv))
-		PerlIO_printf(file, "( %s . ) ", pv_display(d, SvPVX_const(sv)-SvIVX(sv), SvIVX(sv), 0, pvlim));
+	    if (SvOOK(sv)) {
+		PerlIO_printf(file, "( %s . ) ",
+			      pv_display(d, SvPVX_const(sv) - delta, delta, 0,
+					 pvlim));
+	    }
 	    PerlIO_printf(file, "%s", pv_display(d, SvPVX_const(sv), SvCUR(sv), SvLEN(sv), pvlim));
 	    if (SvUTF8(sv)) /* the 6?  \x{....} */
 	        PerlIO_printf(file, " [UTF8 \"%s\"]", sv_uni_display(d, sv, 6 * SvCUR(sv), UNI_DISPLAY_QQ));
@@ -1622,6 +1662,12 @@
 	else
 	    Perl_dump_indent(aTHX_ level, file, "  PV = 0\n");
     }
+    if (type == SVt_REGEXP) {
+	/* FIXME dumping
+	    Perl_dump_indent(aTHX_ level, file, "  REGEXP = 0x%"UVxf"\n",
+			     PTR2UV(((struct regexp *)SvANY(sv))->xrx_regexp));
+	*/
+    }
     if (type >= SVt_PVMG) {
 	if (type == SVt_PVMG && SvPAD_OUR(sv)) {
 	    HV * const ost = SvOURSTASH(sv);
@@ -1737,12 +1783,48 @@
 	if (SvOOK(sv)) {
 	    AV * const backrefs
 		= *Perl_hv_backreferences_p(aTHX_ MUTABLE_HV(sv));
+	    struct mro_meta * const meta = HvAUX(sv)->xhv_mro_meta;
 	    if (backrefs) {
 		Perl_dump_indent(aTHX_ level, file, "  BACKREFS = 0x%"UVxf"\n",
 				 PTR2UV(backrefs));
 		do_sv_dump(level+1, file, MUTABLE_SV(backrefs), nest+1, maxnest,
 			   dumpops, pvlim);
 	    }
+	    if (meta) {
+		/* FIXME - mro_algs kflags can signal a UTF-8 name.  */
+		Perl_dump_indent(aTHX_ level, file, "  MRO_WHICH = \"%.*s\" (0x%"UVxf")\n",
+				 (int)meta->mro_which->length,
+				 meta->mro_which->name,
+				 PTR2UV(meta->mro_which));
+		Perl_dump_indent(aTHX_ level, file, "  CACHE_GEN = 0x%"UVxf"\n",
+				 (UV)meta->cache_gen);
+		Perl_dump_indent(aTHX_ level, file, "  PKG_GEN = 0x%"UVxf"\n",
+				 (UV)meta->pkg_gen);
+		if (meta->mro_linear_all) {
+		    Perl_dump_indent(aTHX_ level, file, "  MRO_LINEAR_ALL = 0x%"UVxf"\n",
+				 PTR2UV(meta->mro_linear_all));
+		do_sv_dump(level+1, file, MUTABLE_SV(meta->mro_linear_all), nest+1, maxnest,
+			   dumpops, pvlim);
+		}
+		if (meta->mro_linear_current) {
+		    Perl_dump_indent(aTHX_ level, file, "  MRO_LINEAR_CURRENT = 0x%"UVxf"\n",
+				 PTR2UV(meta->mro_linear_current));
+		do_sv_dump(level+1, file, MUTABLE_SV(meta->mro_linear_current), nest+1, maxnest,
+			   dumpops, pvlim);
+		}
+		if (meta->mro_nextmethod) {
+		    Perl_dump_indent(aTHX_ level, file, "  MRO_NEXTMETHOD = 0x%"UVxf"\n",
+				 PTR2UV(meta->mro_nextmethod));
+		do_sv_dump(level+1, file, MUTABLE_SV(meta->mro_nextmethod), nest+1, maxnest,
+			   dumpops, pvlim);
+		}
+		if (meta->isa) {
+		    Perl_dump_indent(aTHX_ level, file, "  ISA = 0x%"UVxf"\n",
+				 PTR2UV(meta->isa));
+		do_sv_dump(level+1, file, MUTABLE_SV(meta->isa), nest+1, maxnest,
+			   dumpops, pvlim);
+		}
+	    }
 	}
 	if (nest < maxnest && !HvEITER_get(sv)) { /* Try to preserve iterator */
 	    HE *he;
@@ -1792,7 +1874,7 @@
 		do_op_dump(level+1, file, CvROOT(sv));
 	    }
 	} else {
-	    SV * const constant = cv_const_sv((CV *)sv);
+	    SV * const constant = cv_const_sv((const CV *)sv);
 
 	    Perl_dump_indent(aTHX_ level, file, "  XSUB = 0x%"UVxf"\n", PTR2UV(CvXSUB(sv)));
 
@@ -1938,8 +2020,7 @@
 {
     dVAR;
     if (!PL_op) {
-	if (ckWARN_d(WARN_DEBUGGING))
-	    Perl_warner(aTHX_ packWARN(WARN_DEBUGGING), "NULL OP IN RUN");
+	Perl_ck_warner_d(aTHX_ packWARN(WARN_DEBUGGING), "NULL OP IN RUN");
 	return 0;
     }
 
@@ -1985,6 +2066,7 @@
     Perl_deb(aTHX_ "%s", OP_NAME(o));
     switch (o->op_type) {
     case OP_CONST:
+    case OP_HINTSEVAL:
 	/* With ITHREADS, consts are stored in the pad, and the right pad
 	 * may not be active here, so check.
 	 * Looks like only during compiling the pads are illegal.
@@ -2136,9 +2218,16 @@
 void
 Perl_xmldump_all(pTHX)
 {
+    xmldump_all_perl(FALSE);
+}
+
+void
+Perl_xmldump_all_perl(pTHX_ bool justperl)
+{
     PerlIO_setlinebuf(PL_xmlfp);
     if (PL_main_root)
 	op_xmldump(PL_main_root);
+    xmldump_packsubs_perl(PL_defstash, justperl);
     if (PL_xmlfp != (PerlIO*)PerlIO_stdout())
 	PerlIO_close(PL_xmlfp);
     PL_xmlfp = 0;
@@ -2147,10 +2236,17 @@
 void
 Perl_xmldump_packsubs(pTHX_ const HV *stash)
 {
+    PERL_ARGS_ASSERT_XMLDUMP_PACKSUBS;
+    xmldump_packsubs_perl(stash, FALSE);
+}
+
+void
+Perl_xmldump_packsubs_perl(pTHX_ const HV *stash, bool justperl)
+{
     I32	i;
     HE	*entry;
 
-    PERL_ARGS_ASSERT_XMLDUMP_PACKSUBS;
+    PERL_ARGS_ASSERT_XMLDUMP_PACKSUBS_PERL;
 
     if (!HvARRAY(stash))
 	return;
@@ -2161,12 +2257,12 @@
 	    if (SvTYPE(gv) != SVt_PVGV || !GvGP(gv))
 		continue;
 	    if (GvCVu(gv))
-		xmldump_sub(gv);
+		xmldump_sub_perl(gv, justperl);
 	    if (GvFORM(gv))
 		xmldump_form(gv);
 	    if (HeKEY(entry)[HeKLEN(entry)-1] == ':'
 		&& (hv = GvHV(gv)) && hv != PL_defstash)
-		xmldump_packsubs(hv);		/* nested package */
+		xmldump_packsubs_perl(hv, justperl);	/* nested package */
 	}
     }
 }
@@ -2174,10 +2270,21 @@
 void
 Perl_xmldump_sub(pTHX_ const GV *gv)
 {
-    SV * const sv = sv_newmortal();
-
     PERL_ARGS_ASSERT_XMLDUMP_SUB;
+    xmldump_sub_perl(gv, FALSE);
+}
+
+void
+Perl_xmldump_sub_perl(pTHX_ const GV *gv, bool justperl)
+{
+    SV * sv;
+
+    PERL_ARGS_ASSERT_XMLDUMP_SUB_PERL;
+
+    if (justperl && (CvISXSUB(GvCV(gv)) || !CvROOT(GvCV(gv))))
+	return;
 
+    sv = sv_newmortal();
     gv_fullname3(sv, gv, NULL);
     Perl_xmldump_indent(aTHX_ 0, PL_xmlfp, "\nSUB %s = ", SvPVX(sv));
     if (CvXSUB(GvCV(gv)))
@@ -2441,9 +2548,6 @@
     case SVt_NV:
 	sv_catpv(t, " NV=\"");
 	break;
-    case SVt_RV:
-	sv_catpv(t, " RV=\"");
-	break;
     case SVt_PV:
 	sv_catpv(t, " PV=\"");
 	break;
@@ -2477,6 +2581,9 @@
     case SVt_BIND:
 	sv_catpv(t, " BIND=\"");
 	break;
+    case SVt_REGEXP:
+	sv_catpv(t, " ORANGE=\"");
+	break;
     case SVt_PVFM:
 	sv_catpv(t, " FM=\"");
 	break;
@@ -2524,9 +2631,8 @@
     level++;
     if (PM_GETRE(pm)) {
 	REGEXP *const r = PM_GETRE(pm);
-	SV * const tmpsv
-	    = newSVpvn_utf8(RX_PRECOMP(r), RX_PRELEN(r), RX_UTF8(r));
-	sv_utf8_upgrade(tmpsv);
+	SV * const tmpsv = newSVpvn_utf8("", 0, TRUE);
+	sv_catxmlsv(tmpsv, MUTABLE_SV(r));
 	Perl_xmldump_indent(aTHX_ level, file, "pre=\"%s\"\n",
 	     SvPVX(tmpsv));
 	SvREFCNT_dec(tmpsv);
@@ -2791,7 +2897,7 @@
 		sv_catpv(tmpsv, ",HUSH_VMSISH");
 	}
 	else if (PL_check[o->op_type] != MEMBER_TO_FPTR(Perl_ck_ftst)) {
-	    if (OP_IS_FILETEST_ACCESS(o) && o->op_private & OPpFT_ACCESS)
+	    if (OP_IS_FILETEST_ACCESS(o->op_type) && o->op_private & OPpFT_ACCESS)
 		sv_catpv(tmpsv, ",FT_ACCESS");
 	    if (o->op_private & OPpFT_STACKED)
 		sv_catpv(tmpsv, ",FT_STACKED");
@@ -2832,6 +2938,7 @@
 #endif
 	break;
     case OP_CONST:
+    case OP_HINTSEVAL:
     case OP_METHOD_NAMED:
 #ifndef USE_ITHREADS
 	/* with ITHREADS, consts are stored in the pad, and the right pad
@@ -2846,7 +2953,6 @@
 	}
 	do_op_xmldump(level+1, file, CvROOT(cSVOPo_sv));
 	break;
-    case OP_SETSTATE:
     case OP_NEXTSTATE:
     case OP_DBSTATE:
 	if (CopLINE(cCOPo))
Index: src/gnu/usr.bin/perl/embed.h
diff -u src/gnu/usr.bin/perl/embed.h:1.13 src/gnu/usr.bin/perl/embed.h:1.14
--- embed.h:1.13	Mon Oct 12 18:24:20 2009
+++ embed.h	Fri Sep 24 15:06:40 2010
@@ -43,6 +43,9 @@
 #endif
 #define get_context		Perl_get_context
 #define set_context		Perl_set_context
+#if defined(PERL_CORE) || defined(PERL_EXT)
+#define regcurly		Perl_regcurly
+#endif
 #define amagic_call		Perl_amagic_call
 #define Gv_AMupdate		Perl_Gv_AMupdate
 #define gv_handler		Perl_gv_handler
@@ -56,9 +59,6 @@
 #define av_delete		Perl_av_delete
 #define av_exists		Perl_av_exists
 #define av_extend		Perl_av_extend
-#ifdef PERL_CORE
-#define av_fake			Perl_av_fake
-#endif
 #define av_fetch		Perl_av_fetch
 #define av_fill			Perl_av_fill
 #define av_len			Perl_av_len
@@ -72,6 +72,11 @@
 #define av_store		Perl_av_store
 #define av_undef		Perl_av_undef
 #define av_unshift		Perl_av_unshift
+#if defined(PERL_IN_AV_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define get_aux_mg		S_get_aux_mg
+#endif
+#endif
 #ifdef PERL_CORE
 #define bind_match		Perl_bind_match
 #define block_end		Perl_block_end
@@ -118,7 +123,6 @@
 #define printf_nocontext	Perl_printf_nocontext
 #endif
 #ifdef PERL_CORE
-#define cv_ckproto		Perl_cv_ckproto
 #define cv_ckproto_len		Perl_cv_ckproto_len
 #define cv_clone		Perl_cv_clone
 #endif
@@ -139,9 +143,7 @@
 #define get_opargs		Perl_get_opargs
 #endif
 #define get_ppaddr		Perl_get_ppaddr
-#if defined(PERL_CORE) || defined(PERL_EXT)
 #define cxinc			Perl_cxinc
-#endif
 #define deb			Perl_deb
 #define vdeb			Perl_vdeb
 #define debprofdump		Perl_debprofdump
@@ -151,12 +153,14 @@
 #define delimcpy		Perl_delimcpy
 #ifdef PERL_CORE
 #define delete_eval_scope	Perl_delete_eval_scope
-#define deprecate		Perl_deprecate
-#define deprecate_old		Perl_deprecate_old
 #endif
 #define die			Perl_die
+#if defined(PERL_IN_UTIL_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define vdie			S_vdie
+#endif
+#endif
 #ifdef PERL_CORE
-#define vdie			Perl_vdie
 #define die_where		Perl_die_where
 #endif
 #define dounwind		Perl_dounwind
@@ -229,6 +233,9 @@
 #endif
 #define dowantarray		Perl_dowantarray
 #define dump_all		Perl_dump_all
+#ifdef PERL_CORE
+#define dump_all_perl		Perl_dump_all_perl
+#endif
 #define dump_eval		Perl_dump_eval
 #if defined(DUMP_FDS)
 #define dump_fds		Perl_dump_fds
@@ -238,19 +245,31 @@
 #define op_dump			Perl_op_dump
 #define pmop_dump		Perl_pmop_dump
 #define dump_packsubs		Perl_dump_packsubs
+#ifdef PERL_CORE
+#define dump_packsubs_perl	Perl_dump_packsubs_perl
+#endif
 #define dump_sub		Perl_dump_sub
+#ifdef PERL_CORE
+#define dump_sub_perl		Perl_dump_sub_perl
+#endif
 #define fbm_compile		Perl_fbm_compile
 #define fbm_instr		Perl_fbm_instr
 #ifdef PERL_CORE
 #define find_script		Perl_find_script
-#define force_list		Perl_force_list
-#define fold_constants		Perl_fold_constants
+#endif
+#if defined(PERL_IN_OP_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define force_list		S_force_list
+#define fold_constants		S_fold_constants
+#endif
 #endif
 #define form			Perl_form
 #define vform			Perl_vform
 #define free_tmps		Perl_free_tmps
+#if defined(PERL_IN_OP_C) || defined(PERL_DECL_PROT)
 #ifdef PERL_CORE
-#define gen_constant_list	Perl_gen_constant_list
+#define gen_constant_list	S_gen_constant_list
+#endif
 #endif
 #if !defined(HAS_GETENV_LEN)
 #ifdef PERL_CORE
@@ -259,9 +278,7 @@
 #endif
 #define gp_free			Perl_gp_free
 #define gp_ref			Perl_gp_ref
-#define gv_AVadd		Perl_gv_AVadd
-#define gv_HVadd		Perl_gv_HVadd
-#define gv_IOadd		Perl_gv_IOadd
+#define gv_add_by_type		Perl_gv_add_by_type
 #define gv_autoload4		Perl_gv_autoload4
 #define gv_check		Perl_gv_check
 #define gv_efullname		Perl_gv_efullname
@@ -271,11 +288,15 @@
 #define gv_fetchmeth		Perl_gv_fetchmeth
 #define gv_fetchmeth_autoload	Perl_gv_fetchmeth_autoload
 #define gv_fetchmethod_autoload	Perl_gv_fetchmethod_autoload
+#define gv_fetchmethod_flags	Perl_gv_fetchmethod_flags
 #define gv_fetchpv		Perl_gv_fetchpv
 #define gv_fullname		Perl_gv_fullname
 #define gv_fullname4		Perl_gv_fullname4
 #define gv_init			Perl_gv_init
 #define gv_name_set		Perl_gv_name_set
+#ifdef PERL_CORE
+#define gv_try_downgrade	Perl_gv_try_downgrade
+#endif
 #define gv_stashpv		Perl_gv_stashpv
 #define gv_stashpvn		Perl_gv_stashpvn
 #define gv_stashsv		Perl_gv_stashsv
@@ -291,13 +312,24 @@
 #define hv_iternext_flags	Perl_hv_iternext_flags
 #define hv_iterval		Perl_hv_iterval
 #define hv_ksplit		Perl_hv_ksplit
+#if defined(PERL_IN_HV_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define refcounted_he_new_common	S_refcounted_he_new_common
+#endif
+#endif
 #define hv_undef		Perl_hv_undef
 #define ibcmp			Perl_ibcmp
 #define ibcmp_locale		Perl_ibcmp_locale
 #define ibcmp_utf8		Perl_ibcmp_utf8
+#if defined(PERL_IN_DOIO_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define ingroup			S_ingroup
+#endif
+#endif
 #ifdef PERL_CORE
-#define ingroup			Perl_ingroup
 #define init_argv_symbols	Perl_init_argv_symbols
+#endif
+#ifdef PERL_CORE
 #define init_debugger		Perl_init_debugger
 #endif
 #define init_stacks		Perl_init_stacks
@@ -309,14 +341,12 @@
 #ifdef PERL_CORE
 #define io_close		Perl_io_close
 #define invert			Perl_invert
-#define is_gv_magical		Perl_is_gv_magical
 #endif
 #define is_lvalue_sub		Perl_is_lvalue_sub
 #define to_uni_upper_lc		Perl_to_uni_upper_lc
 #define to_uni_title_lc		Perl_to_uni_title_lc
 #define to_uni_lower_lc		Perl_to_uni_lower_lc
 #define is_uni_alnum		Perl_is_uni_alnum
-#define is_uni_alnumc		Perl_is_uni_alnumc
 #define is_uni_idfirst		Perl_is_uni_idfirst
 #define is_uni_alpha		Perl_is_uni_alpha
 #define is_uni_ascii		Perl_is_uni_ascii
@@ -334,7 +364,6 @@
 #define to_uni_lower		Perl_to_uni_lower
 #define to_uni_fold		Perl_to_uni_fold
 #define is_uni_alnum_lc		Perl_is_uni_alnum_lc
-#define is_uni_alnumc_lc	Perl_is_uni_alnumc_lc
 #define is_uni_idfirst_lc	Perl_is_uni_idfirst_lc
 #define is_uni_alpha_lc		Perl_is_uni_alpha_lc
 #define is_uni_ascii_lc		Perl_is_uni_ascii_lc
@@ -347,18 +376,21 @@
 #define is_uni_print_lc		Perl_is_uni_print_lc
 #define is_uni_punct_lc		Perl_is_uni_punct_lc
 #define is_uni_xdigit_lc	Perl_is_uni_xdigit_lc
+#define is_ascii_string		Perl_is_ascii_string
 #define is_utf8_char		Perl_is_utf8_char
 #define is_utf8_string		Perl_is_utf8_string
 #define is_utf8_string_loclen	Perl_is_utf8_string_loclen
 #define is_utf8_alnum		Perl_is_utf8_alnum
-#define is_utf8_alnumc		Perl_is_utf8_alnumc
 #define is_utf8_idfirst		Perl_is_utf8_idfirst
 #define is_utf8_idcont		Perl_is_utf8_idcont
 #define is_utf8_alpha		Perl_is_utf8_alpha
 #define is_utf8_ascii		Perl_is_utf8_ascii
 #define is_utf8_space		Perl_is_utf8_space
+#define is_utf8_perl_space	Perl_is_utf8_perl_space
+#define is_utf8_perl_word	Perl_is_utf8_perl_word
 #define is_utf8_cntrl		Perl_is_utf8_cntrl
 #define is_utf8_digit		Perl_is_utf8_digit
+#define is_utf8_posix_digit	Perl_is_utf8_posix_digit
 #define is_utf8_graph		Perl_is_utf8_graph
 #define is_utf8_upper		Perl_is_utf8_upper
 #define is_utf8_lower		Perl_is_utf8_lower
@@ -366,10 +398,28 @@
 #define is_utf8_punct		Perl_is_utf8_punct
 #define is_utf8_xdigit		Perl_is_utf8_xdigit
 #define is_utf8_mark		Perl_is_utf8_mark
+#if defined(PERL_CORE) || defined(PERL_EXT)
+#define is_utf8_X_begin		Perl_is_utf8_X_begin
+#define is_utf8_X_extend	Perl_is_utf8_X_extend
+#define is_utf8_X_prepend	Perl_is_utf8_X_prepend
+#define is_utf8_X_non_hangul	Perl_is_utf8_X_non_hangul
+#define is_utf8_X_L		Perl_is_utf8_X_L
+#define is_utf8_X_LV		Perl_is_utf8_X_LV
+#define is_utf8_X_LVT		Perl_is_utf8_X_LVT
+#define is_utf8_X_LV_LVT_V	Perl_is_utf8_X_LV_LVT_V
+#define is_utf8_X_T		Perl_is_utf8_X_T
+#define is_utf8_X_V		Perl_is_utf8_X_V
+#endif
 #ifdef PERL_CORE
 #define jmaybe			Perl_jmaybe
 #define keyword			Perl_keyword
 #endif
+#if defined(PERL_IN_OP_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define opt_scalarhv		S_opt_scalarhv
+#define is_inplace_av		S_is_inplace_av
+#endif
+#endif
 #define leave_scope		Perl_leave_scope
 #if defined(PERL_CORE) || defined(PERL_EXT)
 #define lex_end			Perl_lex_end
@@ -377,16 +427,31 @@
 #ifdef PERL_CORE
 #define lex_start		Perl_lex_start
 #endif
+#define lex_bufutf8		Perl_lex_bufutf8
+#define lex_grow_linestr	Perl_lex_grow_linestr
+#define lex_stuff_pvn		Perl_lex_stuff_pvn
+#define lex_stuff_sv		Perl_lex_stuff_sv
+#define lex_unstuff		Perl_lex_unstuff
+#define lex_read_to		Perl_lex_read_to
+#define lex_discard_to		Perl_lex_discard_to
+#define lex_next_chunk		Perl_lex_next_chunk
+#define lex_peek_unichar	Perl_lex_peek_unichar
+#define lex_read_unichar	Perl_lex_read_unichar
+#define lex_read_space		Perl_lex_read_space
 #define op_null			Perl_op_null
 #if defined(PERL_CORE) || defined(PERL_EXT)
 #define op_clear		Perl_op_clear
 #endif
 #define op_refcnt_lock		Perl_op_refcnt_lock
 #define op_refcnt_unlock	Perl_op_refcnt_unlock
+#if defined(PERL_IN_OP_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define linklist		S_linklist
+#define listkids		S_listkids
+#endif
+#endif
 #ifdef PERL_CORE
-#define linklist		Perl_linklist
 #define list			Perl_list
-#define listkids		Perl_listkids
 #endif
 #define load_module		Perl_load_module
 #define vload_module		Perl_vload_module
@@ -403,11 +468,11 @@
 #define magic_clearenv		Perl_magic_clearenv
 #define magic_clear_all_env	Perl_magic_clear_all_env
 #define magic_clearhint		Perl_magic_clearhint
+#define magic_clearhints	Perl_magic_clearhints
 #define magic_clearisa		Perl_magic_clearisa
 #define magic_clearpack		Perl_magic_clearpack
 #define magic_clearsig		Perl_magic_clearsig
 #define magic_existspack	Perl_magic_existspack
-#define magic_freeregexp	Perl_magic_freeregexp
 #define magic_freeovrld		Perl_magic_freeovrld
 #define magic_get		Perl_magic_get
 #define magic_getarylen		Perl_magic_getarylen
@@ -429,26 +494,11 @@
 #define magic_setamagic		Perl_magic_setamagic
 #define magic_setarylen		Perl_magic_setarylen
 #define magic_freearylen_p	Perl_magic_freearylen_p
-#endif
-#ifndef NO_MATHOMS
-#ifdef PERL_CORE
-#define magic_setbm		Perl_magic_setbm
-#define magic_setfm		Perl_magic_setfm
-#endif
-#endif
-#ifdef PERL_CORE
 #define magic_setdbline		Perl_magic_setdbline
 #define magic_setdefelem	Perl_magic_setdefelem
 #define magic_setenv		Perl_magic_setenv
 #define magic_sethint		Perl_magic_sethint
 #define magic_setisa		Perl_magic_setisa
-#endif
-#ifndef NO_MATHOMS
-#ifdef PERL_CORE
-#define magic_setglob		Perl_magic_setglob
-#endif
-#endif
-#ifdef PERL_CORE
 #define magic_setmglob		Perl_magic_setmglob
 #define magic_setnkeys		Perl_magic_setnkeys
 #define magic_setpack		Perl_magic_setpack
@@ -463,7 +513,6 @@
 #define magic_set_all_env	Perl_magic_set_all_env
 #define magic_sizepack		Perl_magic_sizepack
 #define magic_wipepack		Perl_magic_wipepack
-#define magicname		Perl_magicname
 #endif
 #define markstack_grow		Perl_markstack_grow
 #if defined(USE_LOCALE_COLLATE)
@@ -499,9 +548,6 @@
 #define mode_from_discipline	Perl_mode_from_discipline
 #endif
 #define moreswitches		Perl_moreswitches
-#ifdef PERL_CORE
-#define my			Perl_my
-#endif
 #define my_atof			Perl_my_atof
 #if (!defined(HAS_MEMCPY) && !defined(HAS_BCOPY)) || (!defined(HAS_MEMMOVE) && !defined(HAS_SAFE_MEMCPY) && !defined(HAS_SAFE_BCOPY))
 #define my_bcopy		Perl_my_bcopy
@@ -569,7 +615,6 @@
 #define newGVREF		Perl_newGVREF
 #define newHVREF		Perl_newHVREF
 #define newHVhv			Perl_newHVhv
-#define newIO			Perl_newIO
 #define newLISTOP		Perl_newLISTOP
 #ifdef USE_ITHREADS
 #define newPADOP		Perl_newPADOP
@@ -600,6 +645,7 @@
 #define new_stackinfo		Perl_new_stackinfo
 #define scan_vstring		Perl_scan_vstring
 #define scan_version		Perl_scan_version
+#define prescan_version		Perl_prescan_version
 #define new_version		Perl_new_version
 #define upg_version		Perl_upg_version
 #define vverify			Perl_vverify
@@ -611,9 +657,6 @@
 #define nextargv		Perl_nextargv
 #endif
 #define ninstr			Perl_ninstr
-#ifdef PERL_CORE
-#define oopsCV			Perl_oopsCV
-#endif
 #define op_free			Perl_op_free
 #ifdef PERL_MAD
 #ifdef PERL_CORE
@@ -625,20 +668,29 @@
 #endif
 #endif
 #ifdef PERL_CORE
+#define package_version		Perl_package_version
 #define pad_alloc		Perl_pad_alloc
 #define allocmy			Perl_allocmy
-#define pad_findmy		Perl_pad_findmy
 #endif
+#define pad_findmy		Perl_pad_findmy
 #define find_rundefsvoffset	Perl_find_rundefsvoffset
 #ifdef PERL_CORE
 #define oopsAV			Perl_oopsAV
 #define oopsHV			Perl_oopsHV
 #define pad_leavemy		Perl_pad_leavemy
 #endif
+#ifdef DEBUGGING
 #define pad_sv			Perl_pad_sv
+#endif
 #ifdef PERL_CORE
 #define pad_free		Perl_pad_free
-#define pad_reset		Perl_pad_reset
+#endif
+#if defined(PERL_IN_PAD_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define pad_reset		S_pad_reset
+#endif
+#endif
+#ifdef PERL_CORE
 #define pad_swipe		Perl_pad_swipe
 #define peep			Perl_peep
 #endif
@@ -673,34 +725,39 @@
 #define require_pv		Perl_require_pv
 #define pack_cat		Perl_pack_cat
 #define packlist		Perl_packlist
-#ifdef PERL_USES_PL_PIDSTATUS
+#if defined(PERL_USES_PL_PIDSTATUS) && defined(PERL_IN_UTIL_C)
 #ifdef PERL_CORE
-#define pidgone			Perl_pidgone
+#define pidgone			S_pidgone
 #endif
 #endif
-#define pmflag			Perl_pmflag
 #ifdef PERL_CORE
 #define pmruntime		Perl_pmruntime
-#define pmtrans			Perl_pmtrans
+#endif
+#if defined(PERL_IN_OP_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define pmtrans			S_pmtrans
+#endif
 #endif
 #define pop_scope		Perl_pop_scope
 #ifdef PERL_CORE
 #define prepend_elem		Perl_prepend_elem
 #endif
 #define push_scope		Perl_push_scope
+#if defined(PERL_IN_OP_C) || defined(PERL_DECL_PROT)
 #ifdef PERL_CORE
-#define refkids			Perl_refkids
+#define refkids			S_refkids
+#endif
 #endif
 #define regdump			Perl_regdump
 #define regdump			Perl_regdump
 #define regclass_swash		Perl_regclass_swash
 #define pregexec		Perl_pregexec
 #define pregfree		Perl_pregfree
+#define pregfree2		Perl_pregfree2
 #if defined(PERL_CORE) || defined(PERL_EXT)
 #define reg_temp_copy		Perl_reg_temp_copy
 #endif
 #define regfree_internal	Perl_regfree_internal
-#define reg_stringify		Perl_reg_stringify
 #if defined(USE_ITHREADS)
 #define regdupe_internal	Perl_regdupe_internal
 #endif
@@ -739,9 +796,13 @@
 #define rsignal_save		Perl_rsignal_save
 #endif
 #define rsignal_state		Perl_rsignal_state
+#if defined(PERL_IN_PP_CTL_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define rxres_free		S_rxres_free
+#define rxres_restore		S_rxres_restore
+#endif
+#endif
 #ifdef PERL_CORE
-#define rxres_free		Perl_rxres_free
-#define rxres_restore		Perl_rxres_restore
 #define rxres_save		Perl_rxres_save
 #endif
 #if !defined(HAS_RENAME)
@@ -756,13 +817,15 @@
 #define savesvpv		Perl_savesvpv
 #define savestack_grow		Perl_savestack_grow
 #define savestack_grow_cnt	Perl_savestack_grow_cnt
-#define save_aelem		Perl_save_aelem
+#define save_aelem_flags	Perl_save_aelem_flags
 #define save_alloc		Perl_save_alloc
 #define save_aptr		Perl_save_aptr
 #define save_ary		Perl_save_ary
 #define save_bool		Perl_save_bool
 #define save_clearsv		Perl_save_clearsv
 #define save_delete		Perl_save_delete
+#define save_hdelete		Perl_save_hdelete
+#define save_adelete		Perl_save_adelete
 #define save_destructor		Perl_save_destructor
 #define save_destructor_x	Perl_save_destructor_x
 #define save_generic_svref	Perl_save_generic_svref
@@ -773,7 +836,7 @@
 #ifdef PERL_CORE
 #define save_hints		Perl_save_hints
 #endif
-#define save_helem		Perl_save_helem
+#define save_helem_flags	Perl_save_helem_flags
 #define save_hptr		Perl_save_hptr
 #define save_I16		Perl_save_I16
 #define save_I32		Perl_save_I32
@@ -788,7 +851,6 @@
 #define save_pptr		Perl_save_pptr
 #define save_vptr		Perl_save_vptr
 #define save_re_context		Perl_save_re_context
-#define save_padsv		Perl_save_padsv
 #define save_padsv_and_mortalize	Perl_save_padsv_and_mortalize
 #define save_sptr		Perl_save_sptr
 #define save_svref		Perl_save_svref
@@ -805,8 +867,14 @@
 #ifdef PERL_CORE
 #define sawparens		Perl_sawparens
 #define scalar			Perl_scalar
-#define scalarkids		Perl_scalarkids
-#define scalarseq		Perl_scalarseq
+#endif
+#if defined(PERL_IN_OP_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define scalarkids		S_scalarkids
+#define scalarseq		S_scalarseq
+#endif
+#endif
+#ifdef PERL_CORE
 #define scalarvoid		Perl_scalarvoid
 #endif
 #define scan_bin		Perl_scan_bin
@@ -817,14 +885,7 @@
 #define scope			Perl_scope
 #endif
 #define screaminstr		Perl_screaminstr
-#if !defined(VMS)
-#ifdef PERL_CORE
-#define setenv_getix		Perl_setenv_getix
-#endif
-#endif
-#if defined(PERL_CORE) || defined(PERL_EXT)
 #define setdefout		Perl_setdefout
-#endif
 #define share_hek		Perl_share_hek
 #if defined(HAS_SIGACTION) && defined(SA_SIGINFO)
 #ifdef PERL_CORE
@@ -848,7 +909,6 @@
 #if defined(PERL_IN_SV_C) || defined(PERL_DECL_PROT)
 #ifdef PERL_CORE
 #define glob_2number		S_glob_2number
-#define glob_2pv		S_glob_2pv
 #endif
 #endif
 #define sv_2iv_flags		Perl_sv_2iv_flags
@@ -869,8 +929,10 @@
 #define sv_pvutf8n		Perl_sv_pvutf8n
 #define sv_pvbyten		Perl_sv_pvbyten
 #define sv_true			Perl_sv_true
+#if defined(PERL_IN_SV_C) || defined(PERL_DECL_PROT)
 #ifdef PERL_CORE
-#define sv_add_arena		Perl_sv_add_arena
+#define sv_add_arena		S_sv_add_arena
+#endif
 #endif
 #define sv_backoff		Perl_sv_backoff
 #define sv_bless		Perl_sv_bless
@@ -914,6 +976,7 @@
 #define sv_newref		Perl_sv_newref
 #define sv_peek			Perl_sv_peek
 #define sv_pos_u2b		Perl_sv_pos_u2b
+#define sv_pos_u2b_flags	Perl_sv_pos_u2b_flags
 #define sv_pos_b2u		Perl_sv_pos_b2u
 #define sv_pvutf8n_force	Perl_sv_pvutf8n_force
 #define sv_pvbyten_force	Perl_sv_pvbyten_force
@@ -1014,6 +1077,8 @@
 #define warn			Perl_warn
 #define vwarn			Perl_vwarn
 #define warner			Perl_warner
+#define ck_warner		Perl_ck_warner
+#define ck_warner_d		Perl_ck_warner_d
 #define vwarner			Perl_vwarner
 #ifdef PERL_CORE
 #define watch			Perl_watch
@@ -1029,7 +1094,11 @@
 #ifdef PERL_CORE
 #define yyparse			Perl_yyparse
 #define parser_free		Perl_parser_free
-#define yywarn			Perl_yywarn
+#endif
+#if defined(PERL_IN_TOKE_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define yywarn			S_yywarn
+#endif
 #endif
 #if defined(MYMALLOC)
 #define dump_mstats		Perl_dump_mstats
@@ -1091,7 +1160,6 @@
 #endif
 #ifdef PERL_CORE
 #define my_attrs		Perl_my_attrs
-#define boot_core_xsutils	Perl_boot_core_xsutils
 #endif
 #if defined(USE_ITHREADS)
 #define cx_dup			Perl_cx_dup
@@ -1100,11 +1168,16 @@
 #define any_dup			Perl_any_dup
 #define he_dup			Perl_he_dup
 #define hek_dup			Perl_hek_dup
-#define re_dup			Perl_re_dup
+#define re_dup_guts		Perl_re_dup_guts
 #define fp_dup			Perl_fp_dup
 #define dirp_dup		Perl_dirp_dup
 #define gp_dup			Perl_gp_dup
 #define mg_dup			Perl_mg_dup
+#if defined(PERL_IN_SV_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define sv_dup_inc_multiple	S_sv_dup_inc_multiple
+#endif
+#endif
 #define sv_dup			Perl_sv_dup
 #define rvpv_dup		Perl_rvpv_dup
 #define parser_dup		Perl_parser_dup
@@ -1154,6 +1227,7 @@
 #ifdef PERL_CORE
 #define hsplit			S_hsplit
 #define hfreeentries		S_hfreeentries
+#define anonymise_cv		S_anonymise_cv
 #define new_he			S_new_he
 #define save_hek_flags		S_save_hek_flags
 #define hv_magic_check		S_hv_magic_check
@@ -1194,7 +1268,6 @@
 #define ck_grep			Perl_ck_grep
 #define ck_index		Perl_ck_index
 #define ck_join			Perl_ck_join
-#define ck_lengthconst		Perl_ck_lengthconst
 #define ck_lfun			Perl_ck_lfun
 #define ck_listiob		Perl_ck_listiob
 #define ck_match		Perl_ck_match
@@ -1218,6 +1291,7 @@
 #define ck_svconst		Perl_ck_svconst
 #define ck_trunc		Perl_ck_trunc
 #define ck_unpack		Perl_ck_unpack
+#define ck_each			Perl_ck_each
 #define is_handle_constructor	S_is_handle_constructor
 #define is_list_assignment	S_is_list_assignment
 #endif
@@ -1266,6 +1340,7 @@
 #define find_beginning		S_find_beginning
 #define forbid_setid		S_forbid_setid
 #define incpush			S_incpush
+#define incpush_use_sep		S_incpush_use_sep
 #define init_interp		S_init_interp
 #define init_ids		S_init_ids
 #define init_main_stash		S_init_main_stash
@@ -1277,19 +1352,8 @@
 #define open_script		S_open_script
 #define usage			S_usage
 #endif
-#ifdef DOSUID
-#  ifdef IAMSUID
-#  else
-#  endif
-#else
-#  ifndef SETUID_SCRIPTS_ARE_SECURE_NOW
-#  endif
-#endif
-#  if defined(IAMSUID)
-#ifdef PERL_CORE
-#define fd_on_nosuid_fs		S_fd_on_nosuid_fs
+#ifndef SETUID_SCRIPTS_ARE_SECURE_NOW
 #endif
-#  endif
 #ifdef PERL_CORE
 #define parse_body		S_parse_body
 #define run_body		S_run_body
@@ -1298,6 +1362,7 @@
 #endif
 #if defined(PERL_IN_PP_C) || defined(PERL_DECL_PROT)
 #ifdef PERL_CORE
+#define do_delete_local		S_do_delete_local
 #define refto			S_refto
 #endif
 #endif
@@ -1391,7 +1456,6 @@
 #define regbranch		S_regbranch
 #define reguni			S_reguni
 #define regclass		S_regclass
-#define regcurly		S_regcurly
 #define reg_node		S_reg_node
 #define reg_recode		S_reg_recode
 #define regpiece		S_regpiece
@@ -1452,7 +1516,6 @@
 #if defined(PERL_CORE) || defined(PERL_EXT)
 #define reghopmaybe3		S_reghopmaybe3
 #define find_byclass		S_find_byclass
-#define swap_match_buff		S_swap_match_buff
 #define to_utf8_substr		S_to_utf8_substr
 #define to_byte_substr		S_to_byte_substr
 #define reg_check_named_buff_matched	S_reg_check_named_buff_matched
@@ -1538,6 +1601,7 @@
 #define check_uni		S_check_uni
 #define force_next		S_force_next
 #define force_version		S_force_version
+#define force_strict_version	S_force_strict_version
 #define force_word		S_force_word
 #define tokeq			S_tokeq
 #define readpipe_override	S_readpipe_override
@@ -1554,6 +1618,14 @@
 #define update_debugger_info	S_update_debugger_info
 #define skipspace		S_skipspace
 #define swallow_bom		S_swallow_bom
+#endif
+#ifndef PERL_NO_UTF16_FILTER
+#ifdef PERL_CORE
+#define utf16_textfilter	S_utf16_textfilter
+#define add_utf16_textfilter	S_add_utf16_textfilter
+#endif
+#endif
+#ifdef PERL_CORE
 #define checkcomma		S_checkcomma
 #define feature_is_enabled	S_feature_is_enabled
 #define force_ident		S_force_ident
@@ -1571,6 +1643,7 @@
 #define tokenize_use		S_tokenize_use
 #endif
 #ifdef PERL_CORE
+#define deprecate_commaless_var_list	S_deprecate_commaless_var_list
 #define ao			S_ao
 #endif
 #  if defined(PERL_CR_FILTER)
@@ -1606,7 +1679,7 @@
 #define vdie_common		S_vdie_common
 #define write_no_mem		S_write_no_mem
 #endif
-#if defined(PERL_MEM_LOG) && defined(PERL_MEM_LOG_STDERR)
+#if defined(PERL_MEM_LOG) && !defined(PERL_MEM_LOG_NOIMPL)
 #ifdef PERL_CORE
 #define mem_log_common		S_mem_log_common
 #endif
@@ -1627,7 +1700,7 @@
 #define sv_setsv_flags		Perl_sv_setsv_flags
 #define sv_catpvn_flags		Perl_sv_catpvn_flags
 #define sv_catsv_flags		Perl_sv_catsv_flags
-#define sv_utf8_upgrade_flags	Perl_sv_utf8_upgrade_flags
+#define sv_utf8_upgrade_flags_grow	Perl_sv_utf8_upgrade_flags_grow
 #define sv_pvn_force_flags	Perl_sv_pvn_force_flags
 #define sv_copypv		Perl_sv_copypv
 #define my_atof2		Perl_my_atof2
@@ -1675,7 +1748,11 @@
 #define pad_undef		Perl_pad_undef
 #define pad_add_name		Perl_pad_add_name
 #define pad_add_anon		Perl_pad_add_anon
-#define pad_check_dup		Perl_pad_check_dup
+#endif
+#if defined(PERL_IN_PAD_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define pad_check_dup		S_pad_check_dup
+#endif
 #endif
 #ifdef DEBUGGING
 #ifdef PERL_CORE
@@ -1695,6 +1772,7 @@
 #if defined(PERL_IN_PAD_C) || defined(PERL_DECL_PROT)
 #ifdef PERL_CORE
 #define pad_findlex		S_pad_findlex
+#define pad_add_name_sv		S_pad_add_name_sv
 #endif
 #  if defined(DEBUGGING)
 #ifdef PERL_CORE
@@ -1712,6 +1790,8 @@
 #endif
 #endif
 #define save_set_svflags	Perl_save_set_svflags
+#ifdef DEBUGGING
+#endif
 #define hv_scalar		Perl_hv_scalar
 #define hv_name_set		Perl_hv_name_set
 #if defined(PERL_IN_DUMP_C) || defined(PERL_IN_HV_C) || defined(PERL_IN_SV_C) || defined(PERL_DECL_PROT)
@@ -1862,7 +1942,11 @@
 #endif
 #endif
 #ifdef PERL_DONT_CREATE_GVSV
-#define gv_SVadd		Perl_gv_SVadd
+#endif
+#if defined(PERL_IN_UTIL_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define ckwarn_common		S_ckwarn_common
+#endif
 #endif
 #ifdef PERL_CORE
 #define offer_nice_chunk	Perl_offer_nice_chunk
@@ -1894,8 +1978,11 @@
 #define xmldump_indent		Perl_xmldump_indent
 #define xmldump_vindent		Perl_xmldump_vindent
 #define xmldump_all		Perl_xmldump_all
+#define xmldump_all_perl	Perl_xmldump_all_perl
 #define xmldump_packsubs	Perl_xmldump_packsubs
+#define xmldump_packsubs_perl	Perl_xmldump_packsubs_perl
 #define xmldump_sub		Perl_xmldump_sub
+#define xmldump_sub_perl	Perl_xmldump_sub_perl
 #define xmldump_form		Perl_xmldump_form
 #define xmldump_eval		Perl_xmldump_eval
 #define sv_catxmlsv		Perl_sv_catxmlsv
@@ -1960,6 +2047,7 @@
 #define ck_defined		Perl_ck_defined
 #define ck_delete		Perl_ck_delete
 #define ck_die			Perl_ck_die
+#define ck_each			Perl_ck_each
 #define ck_eof			Perl_ck_eof
 #define ck_eval			Perl_ck_eval
 #define ck_exec			Perl_ck_exec
@@ -1971,7 +2059,6 @@
 #define ck_grep			Perl_ck_grep
 #define ck_index		Perl_ck_index
 #define ck_join			Perl_ck_join
-#define ck_lengthconst		Perl_ck_lengthconst
 #define ck_lfun			Perl_ck_lfun
 #define ck_listiob		Perl_ck_listiob
 #define ck_match		Perl_ck_match
@@ -2000,8 +2087,10 @@
 #define pp_abs			Perl_pp_abs
 #define pp_accept		Perl_pp_accept
 #define pp_add			Perl_pp_add
+#define pp_aeach		Perl_pp_aeach
 #define pp_aelem		Perl_pp_aelem
 #define pp_aelemfast		Perl_pp_aelemfast
+#define pp_akeys		Perl_pp_akeys
 #define pp_alarm		Perl_pp_alarm
 #define pp_and			Perl_pp_and
 #define pp_andassign		Perl_pp_andassign
@@ -2011,6 +2100,7 @@
 #define pp_aslice		Perl_pp_aslice
 #define pp_atan2		Perl_pp_atan2
 #define pp_av2arylen		Perl_pp_av2arylen
+#define pp_avalues		Perl_pp_avalues
 #define pp_backtick		Perl_pp_backtick
 #define pp_bind			Perl_pp_bind
 #define pp_binmode		Perl_pp_binmode
@@ -2018,6 +2108,7 @@
 #define pp_bit_or		Perl_pp_bit_or
 #define pp_bit_xor		Perl_pp_bit_xor
 #define pp_bless		Perl_pp_bless
+#define pp_boolkeys		Perl_pp_boolkeys
 #define pp_break		Perl_pp_break
 #define pp_caller		Perl_pp_caller
 #define pp_chdir		Perl_pp_chdir
@@ -2142,6 +2233,7 @@
 #define pp_gvsv			Perl_pp_gvsv
 #define pp_helem		Perl_pp_helem
 #define pp_hex			Perl_pp_hex
+#define pp_hintseval		Perl_pp_hintseval
 #define pp_hslice		Perl_pp_hslice
 #define pp_i_add		Perl_pp_i_add
 #define pp_i_divide		Perl_pp_i_divide
@@ -2281,7 +2373,6 @@
 #define pp_seq			Perl_pp_seq
 #define pp_setpgrp		Perl_pp_setpgrp
 #define pp_setpriority		Perl_pp_setpriority
-#define pp_setstate		Perl_pp_setstate
 #define pp_sge			Perl_pp_sge
 #define pp_sgrent		Perl_pp_sgrent
 #define pp_sgt			Perl_pp_sgt
@@ -2371,8 +2462,11 @@
 #endif
 #define get_context		Perl_get_context
 #define set_context		Perl_set_context
+#if defined(PERL_CORE) || defined(PERL_EXT)
+#define regcurly		Perl_regcurly
+#endif
 #define amagic_call(a,b,c,d)	Perl_amagic_call(aTHX_ a,b,c,d)
-#define Gv_AMupdate(a)		Perl_Gv_AMupdate(aTHX_ a)
+#define Gv_AMupdate(a,b)	Perl_Gv_AMupdate(aTHX_ a,b)
 #define gv_handler(a,b)		Perl_gv_handler(aTHX_ a,b)
 #ifdef PERL_CORE
 #define append_elem(a,b,c)	Perl_append_elem(aTHX_ a,b,c)
@@ -2384,9 +2478,6 @@
 #define av_delete(a,b,c)	Perl_av_delete(aTHX_ a,b,c)
 #define av_exists(a,b)		Perl_av_exists(aTHX_ a,b)
 #define av_extend(a,b)		Perl_av_extend(aTHX_ a,b)
-#ifdef PERL_CORE
-#define av_fake(a,b)		Perl_av_fake(aTHX_ a,b)
-#endif
 #define av_fetch(a,b,c)		Perl_av_fetch(aTHX_ a,b,c)
 #define av_fill(a,b)		Perl_av_fill(aTHX_ a,b)
 #define av_len(a)		Perl_av_len(aTHX_ a)
@@ -2400,6 +2491,11 @@
 #define av_store(a,b,c)		Perl_av_store(aTHX_ a,b,c)
 #define av_undef(a)		Perl_av_undef(aTHX_ a)
 #define av_unshift(a,b)		Perl_av_unshift(aTHX_ a,b)
+#if defined(PERL_IN_AV_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define get_aux_mg(a)		S_get_aux_mg(aTHX_ a)
+#endif
+#endif
 #ifdef PERL_CORE
 #define bind_match(a,b,c)	Perl_bind_match(aTHX_ a,b,c)
 #define block_end(a,b)		Perl_block_end(aTHX_ a,b)
@@ -2430,7 +2526,6 @@
 #if defined(PERL_IMPLICIT_CONTEXT)
 #endif
 #ifdef PERL_CORE
-#define cv_ckproto(a,b,c)	Perl_cv_ckproto(aTHX_ a,b,c)
 #define cv_ckproto_len(a,b,c,d)	Perl_cv_ckproto_len(aTHX_ a,b,c,d)
 #define cv_clone(a)		Perl_cv_clone(aTHX_ a)
 #endif
@@ -2451,23 +2546,23 @@
 #define get_opargs()		Perl_get_opargs(aTHX)
 #endif
 #define get_ppaddr()		Perl_get_ppaddr(aTHX)
-#if defined(PERL_CORE) || defined(PERL_EXT)
 #define cxinc()			Perl_cxinc(aTHX)
-#endif
 #define vdeb(a,b)		Perl_vdeb(aTHX_ a,b)
 #define debprofdump()		Perl_debprofdump(aTHX)
 #define debop(a)		Perl_debop(aTHX_ a)
 #define debstack()		Perl_debstack(aTHX)
 #define debstackptrs()		Perl_debstackptrs(aTHX)
-#define delimcpy(a,b,c,d,e,f)	Perl_delimcpy(aTHX_ a,b,c,d,e,f)
+#define delimcpy		Perl_delimcpy
 #ifdef PERL_CORE
 #define delete_eval_scope()	Perl_delete_eval_scope(aTHX)
-#define deprecate(a)		Perl_deprecate(aTHX_ a)
-#define deprecate_old(a)	Perl_deprecate_old(aTHX_ a)
 #endif
+#if defined(PERL_IN_UTIL_C) || defined(PERL_DECL_PROT)
 #ifdef PERL_CORE
-#define vdie(a,b)		Perl_vdie(aTHX_ a,b)
-#define die_where(a,b)		Perl_die_where(aTHX_ a,b)
+#define vdie(a,b)		S_vdie(aTHX_ a,b)
+#endif
+#endif
+#ifdef PERL_CORE
+#define die_where(a)		Perl_die_where(aTHX_ a)
 #endif
 #define dounwind(a)		Perl_dounwind(aTHX_ a)
 #ifdef PERL_CORE
@@ -2541,6 +2636,9 @@
 #endif
 #define dowantarray()		Perl_dowantarray(aTHX)
 #define dump_all()		Perl_dump_all(aTHX)
+#ifdef PERL_CORE
+#define dump_all_perl(a)	Perl_dump_all_perl(aTHX_ a)
+#endif
 #define dump_eval()		Perl_dump_eval(aTHX)
 #if defined(DUMP_FDS)
 #define dump_fds(a)		Perl_dump_fds(aTHX_ a)
@@ -2550,18 +2648,30 @@
 #define op_dump(a)		Perl_op_dump(aTHX_ a)
 #define pmop_dump(a)		Perl_pmop_dump(aTHX_ a)
 #define dump_packsubs(a)	Perl_dump_packsubs(aTHX_ a)
+#ifdef PERL_CORE
+#define dump_packsubs_perl(a,b)	Perl_dump_packsubs_perl(aTHX_ a,b)
+#endif
 #define dump_sub(a)		Perl_dump_sub(aTHX_ a)
+#ifdef PERL_CORE
+#define dump_sub_perl(a,b)	Perl_dump_sub_perl(aTHX_ a,b)
+#endif
 #define fbm_compile(a,b)	Perl_fbm_compile(aTHX_ a,b)
 #define fbm_instr(a,b,c,d)	Perl_fbm_instr(aTHX_ a,b,c,d)
 #ifdef PERL_CORE
 #define find_script(a,b,c,d)	Perl_find_script(aTHX_ a,b,c,d)
-#define force_list(a)		Perl_force_list(aTHX_ a)
-#define fold_constants(a)	Perl_fold_constants(aTHX_ a)
+#endif
+#if defined(PERL_IN_OP_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define force_list(a)		S_force_list(aTHX_ a)
+#define fold_constants(a)	S_fold_constants(aTHX_ a)
+#endif
 #endif
 #define vform(a,b)		Perl_vform(aTHX_ a,b)
 #define free_tmps()		Perl_free_tmps(aTHX)
+#if defined(PERL_IN_OP_C) || defined(PERL_DECL_PROT)
 #ifdef PERL_CORE
-#define gen_constant_list(a)	Perl_gen_constant_list(aTHX_ a)
+#define gen_constant_list(a)	S_gen_constant_list(aTHX_ a)
+#endif
 #endif
 #if !defined(HAS_GETENV_LEN)
 #ifdef PERL_CORE
@@ -2572,9 +2682,7 @@
 #endif
 #define gp_free(a)		Perl_gp_free(aTHX_ a)
 #define gp_ref(a)		Perl_gp_ref(aTHX_ a)
-#define gv_AVadd(a)		Perl_gv_AVadd(aTHX_ a)
-#define gv_HVadd(a)		Perl_gv_HVadd(aTHX_ a)
-#define gv_IOadd(a)		Perl_gv_IOadd(aTHX_ a)
+#define gv_add_by_type(a,b)	Perl_gv_add_by_type(aTHX_ a,b)
 #define gv_autoload4(a,b,c,d)	Perl_gv_autoload4(aTHX_ a,b,c,d)
 #define gv_check(a)		Perl_gv_check(aTHX_ a)
 #define gv_efullname(a,b)	Perl_gv_efullname(aTHX_ a,b)
@@ -2584,6 +2692,7 @@
 #define gv_fetchmeth(a,b,c,d)	Perl_gv_fetchmeth(aTHX_ a,b,c,d)
 #define gv_fetchmeth_autoload(a,b,c,d)	Perl_gv_fetchmeth_autoload(aTHX_ a,b,c,d)
 #define gv_fetchmethod_autoload(a,b,c)	Perl_gv_fetchmethod_autoload(aTHX_ a,b,c)
+#define gv_fetchmethod_flags(a,b,c)	Perl_gv_fetchmethod_flags(aTHX_ a,b,c)
 #define gv_fetchpv(a,b,c)	Perl_gv_fetchpv(aTHX_ a,b,c)
 #define gv_fullname(a,b)	Perl_gv_fullname(aTHX_ a,b)
 #define gv_fullname4(a,b,c,d)	Perl_gv_fullname4(aTHX_ a,b,c,d)
@@ -2591,6 +2700,9 @@
 #endif
 #define gv_init(a,b,c,d,e)	Perl_gv_init(aTHX_ a,b,c,d,e)
 #define gv_name_set(a,b,c,d)	Perl_gv_name_set(aTHX_ a,b,c,d)
+#ifdef PERL_CORE
+#define gv_try_downgrade(a)	Perl_gv_try_downgrade(aTHX_ a)
+#endif
 #define gv_stashpv(a,b)		Perl_gv_stashpv(aTHX_ a,b)
 #define gv_stashpvn(a,b,c)	Perl_gv_stashpvn(aTHX_ a,b,c)
 #define gv_stashsv(a,b)		Perl_gv_stashsv(aTHX_ a,b)
@@ -2614,12 +2726,21 @@
 #endif
 #if defined(PERL_CORE) || defined(PERL_EXT)
 #endif
+#if defined(PERL_IN_HV_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define refcounted_he_new_common(a,b,c,d,e,f,g)	S_refcounted_he_new_common(aTHX_ a,b,c,d,e,f,g)
+#endif
+#endif
 #define hv_undef(a)		Perl_hv_undef(aTHX_ a)
-#define ibcmp(a,b,c)		Perl_ibcmp(aTHX_ a,b,c)
-#define ibcmp_locale(a,b,c)	Perl_ibcmp_locale(aTHX_ a,b,c)
+#define ibcmp			Perl_ibcmp
+#define ibcmp_locale		Perl_ibcmp_locale
 #define ibcmp_utf8(a,b,c,d,e,f,g,h)	Perl_ibcmp_utf8(aTHX_ a,b,c,d,e,f,g,h)
+#if defined(PERL_IN_DOIO_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define ingroup(a,b)		S_ingroup(aTHX_ a,b)
+#endif
+#endif
 #ifdef PERL_CORE
-#define ingroup(a,b)		Perl_ingroup(aTHX_ a,b)
 #define init_argv_symbols(a,b)	Perl_init_argv_symbols(aTHX_ a,b)
 #define init_debugger()		Perl_init_debugger(aTHX)
 #endif
@@ -2628,18 +2749,16 @@
 #ifdef PERL_CORE
 #define intro_my()		Perl_intro_my(aTHX)
 #endif
-#define instr(a,b)		Perl_instr(aTHX_ a,b)
+#define instr			Perl_instr
 #ifdef PERL_CORE
 #define io_close(a,b)		Perl_io_close(aTHX_ a,b)
 #define invert(a)		Perl_invert(aTHX_ a)
-#define is_gv_magical(a,b,c)	Perl_is_gv_magical(aTHX_ a,b,c)
 #endif
 #define is_lvalue_sub()		Perl_is_lvalue_sub(aTHX)
 #define to_uni_upper_lc(a)	Perl_to_uni_upper_lc(aTHX_ a)
 #define to_uni_title_lc(a)	Perl_to_uni_title_lc(aTHX_ a)
 #define to_uni_lower_lc(a)	Perl_to_uni_lower_lc(aTHX_ a)
 #define is_uni_alnum(a)		Perl_is_uni_alnum(aTHX_ a)
-#define is_uni_alnumc(a)	Perl_is_uni_alnumc(aTHX_ a)
 #define is_uni_idfirst(a)	Perl_is_uni_idfirst(aTHX_ a)
 #define is_uni_alpha(a)		Perl_is_uni_alpha(aTHX_ a)
 #define is_uni_ascii(a)		Perl_is_uni_ascii(aTHX_ a)
@@ -2657,7 +2776,6 @@
 #define to_uni_lower(a,b,c)	Perl_to_uni_lower(aTHX_ a,b,c)
 #define to_uni_fold(a,b,c)	Perl_to_uni_fold(aTHX_ a,b,c)
 #define is_uni_alnum_lc(a)	Perl_is_uni_alnum_lc(aTHX_ a)
-#define is_uni_alnumc_lc(a)	Perl_is_uni_alnumc_lc(aTHX_ a)
 #define is_uni_idfirst_lc(a)	Perl_is_uni_idfirst_lc(aTHX_ a)
 #define is_uni_alpha_lc(a)	Perl_is_uni_alpha_lc(aTHX_ a)
 #define is_uni_ascii_lc(a)	Perl_is_uni_ascii_lc(aTHX_ a)
@@ -2670,18 +2788,21 @@
 #define is_uni_print_lc(a)	Perl_is_uni_print_lc(aTHX_ a)
 #define is_uni_punct_lc(a)	Perl_is_uni_punct_lc(aTHX_ a)
 #define is_uni_xdigit_lc(a)	Perl_is_uni_xdigit_lc(aTHX_ a)
-#define is_utf8_char(a)		Perl_is_utf8_char(aTHX_ a)
-#define is_utf8_string(a,b)	Perl_is_utf8_string(aTHX_ a,b)
-#define is_utf8_string_loclen(a,b,c,d)	Perl_is_utf8_string_loclen(aTHX_ a,b,c,d)
+#define is_ascii_string		Perl_is_ascii_string
+#define is_utf8_char		Perl_is_utf8_char
+#define is_utf8_string		Perl_is_utf8_string
+#define is_utf8_string_loclen	Perl_is_utf8_string_loclen
 #define is_utf8_alnum(a)	Perl_is_utf8_alnum(aTHX_ a)
-#define is_utf8_alnumc(a)	Perl_is_utf8_alnumc(aTHX_ a)
 #define is_utf8_idfirst(a)	Perl_is_utf8_idfirst(aTHX_ a)
 #define is_utf8_idcont(a)	Perl_is_utf8_idcont(aTHX_ a)
 #define is_utf8_alpha(a)	Perl_is_utf8_alpha(aTHX_ a)
 #define is_utf8_ascii(a)	Perl_is_utf8_ascii(aTHX_ a)
 #define is_utf8_space(a)	Perl_is_utf8_space(aTHX_ a)
+#define is_utf8_perl_space(a)	Perl_is_utf8_perl_space(aTHX_ a)
+#define is_utf8_perl_word(a)	Perl_is_utf8_perl_word(aTHX_ a)
 #define is_utf8_cntrl(a)	Perl_is_utf8_cntrl(aTHX_ a)
 #define is_utf8_digit(a)	Perl_is_utf8_digit(aTHX_ a)
+#define is_utf8_posix_digit(a)	Perl_is_utf8_posix_digit(aTHX_ a)
 #define is_utf8_graph(a)	Perl_is_utf8_graph(aTHX_ a)
 #define is_utf8_upper(a)	Perl_is_utf8_upper(aTHX_ a)
 #define is_utf8_lower(a)	Perl_is_utf8_lower(aTHX_ a)
@@ -2689,10 +2810,28 @@
 #define is_utf8_punct(a)	Perl_is_utf8_punct(aTHX_ a)
 #define is_utf8_xdigit(a)	Perl_is_utf8_xdigit(aTHX_ a)
 #define is_utf8_mark(a)		Perl_is_utf8_mark(aTHX_ a)
+#if defined(PERL_CORE) || defined(PERL_EXT)
+#define is_utf8_X_begin(a)	Perl_is_utf8_X_begin(aTHX_ a)
+#define is_utf8_X_extend(a)	Perl_is_utf8_X_extend(aTHX_ a)
+#define is_utf8_X_prepend(a)	Perl_is_utf8_X_prepend(aTHX_ a)
+#define is_utf8_X_non_hangul(a)	Perl_is_utf8_X_non_hangul(aTHX_ a)
+#define is_utf8_X_L(a)		Perl_is_utf8_X_L(aTHX_ a)
+#define is_utf8_X_LV(a)		Perl_is_utf8_X_LV(aTHX_ a)
+#define is_utf8_X_LVT(a)	Perl_is_utf8_X_LVT(aTHX_ a)
+#define is_utf8_X_LV_LVT_V(a)	Perl_is_utf8_X_LV_LVT_V(aTHX_ a)
+#define is_utf8_X_T(a)		Perl_is_utf8_X_T(aTHX_ a)
+#define is_utf8_X_V(a)		Perl_is_utf8_X_V(aTHX_ a)
+#endif
 #ifdef PERL_CORE
 #define jmaybe(a)		Perl_jmaybe(aTHX_ a)
 #define keyword(a,b,c)		Perl_keyword(aTHX_ a,b,c)
 #endif
+#if defined(PERL_IN_OP_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define opt_scalarhv(a)		S_opt_scalarhv(aTHX_ a)
+#define is_inplace_av(a,b)	S_is_inplace_av(aTHX_ a,b)
+#endif
+#endif
 #define leave_scope(a)		Perl_leave_scope(aTHX_ a)
 #if defined(PERL_CORE) || defined(PERL_EXT)
 #define lex_end()		Perl_lex_end(aTHX)
@@ -2700,16 +2839,31 @@
 #ifdef PERL_CORE
 #define lex_start(a,b,c)	Perl_lex_start(aTHX_ a,b,c)
 #endif
+#define lex_bufutf8()		Perl_lex_bufutf8(aTHX)
+#define lex_grow_linestr(a)	Perl_lex_grow_linestr(aTHX_ a)
+#define lex_stuff_pvn(a,b,c)	Perl_lex_stuff_pvn(aTHX_ a,b,c)
+#define lex_stuff_sv(a,b)	Perl_lex_stuff_sv(aTHX_ a,b)
+#define lex_unstuff(a)		Perl_lex_unstuff(aTHX_ a)
+#define lex_read_to(a)		Perl_lex_read_to(aTHX_ a)
+#define lex_discard_to(a)	Perl_lex_discard_to(aTHX_ a)
+#define lex_next_chunk(a)	Perl_lex_next_chunk(aTHX_ a)
+#define lex_peek_unichar(a)	Perl_lex_peek_unichar(aTHX_ a)
+#define lex_read_unichar(a)	Perl_lex_read_unichar(aTHX_ a)
+#define lex_read_space(a)	Perl_lex_read_space(aTHX_ a)
 #define op_null(a)		Perl_op_null(aTHX_ a)
 #if defined(PERL_CORE) || defined(PERL_EXT)
 #define op_clear(a)		Perl_op_clear(aTHX_ a)
 #endif
 #define op_refcnt_lock()	Perl_op_refcnt_lock(aTHX)
 #define op_refcnt_unlock()	Perl_op_refcnt_unlock(aTHX)
+#if defined(PERL_IN_OP_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define linklist(a)		S_linklist(aTHX_ a)
+#define listkids(a)		S_listkids(aTHX_ a)
+#endif
+#endif
 #ifdef PERL_CORE
-#define linklist(a)		Perl_linklist(aTHX_ a)
 #define list(a)			Perl_list(aTHX_ a)
-#define listkids(a)		Perl_listkids(aTHX_ a)
 #endif
 #define vload_module(a,b,c,d)	Perl_vload_module(aTHX_ a,b,c,d)
 #ifdef PERL_CORE
@@ -2725,11 +2879,11 @@
 #define magic_clearenv(a,b)	Perl_magic_clearenv(aTHX_ a,b)
 #define magic_clear_all_env(a,b)	Perl_magic_clear_all_env(aTHX_ a,b)
 #define magic_clearhint(a,b)	Perl_magic_clearhint(aTHX_ a,b)
+#define magic_clearhints(a,b)	Perl_magic_clearhints(aTHX_ a,b)
 #define magic_clearisa(a,b)	Perl_magic_clearisa(aTHX_ a,b)
 #define magic_clearpack(a,b)	Perl_magic_clearpack(aTHX_ a,b)
 #define magic_clearsig(a,b)	Perl_magic_clearsig(aTHX_ a,b)
 #define magic_existspack(a,b)	Perl_magic_existspack(aTHX_ a,b)
-#define magic_freeregexp(a,b)	Perl_magic_freeregexp(aTHX_ a,b)
 #define magic_freeovrld(a,b)	Perl_magic_freeovrld(aTHX_ a,b)
 #define magic_get(a,b)		Perl_magic_get(aTHX_ a,b)
 #define magic_getarylen(a,b)	Perl_magic_getarylen(aTHX_ a,b)
@@ -2751,26 +2905,11 @@
 #define magic_setamagic(a,b)	Perl_magic_setamagic(aTHX_ a,b)
 #define magic_setarylen(a,b)	Perl_magic_setarylen(aTHX_ a,b)
 #define magic_freearylen_p(a,b)	Perl_magic_freearylen_p(aTHX_ a,b)
-#endif
-#ifndef NO_MATHOMS
-#ifdef PERL_CORE
-#define magic_setbm(a,b)	Perl_magic_setbm(aTHX_ a,b)
-#define magic_setfm(a,b)	Perl_magic_setfm(aTHX_ a,b)
-#endif
-#endif
-#ifdef PERL_CORE
 #define magic_setdbline(a,b)	Perl_magic_setdbline(aTHX_ a,b)
 #define magic_setdefelem(a,b)	Perl_magic_setdefelem(aTHX_ a,b)
 #define magic_setenv(a,b)	Perl_magic_setenv(aTHX_ a,b)
 #define magic_sethint(a,b)	Perl_magic_sethint(aTHX_ a,b)
 #define magic_setisa(a,b)	Perl_magic_setisa(aTHX_ a,b)
-#endif
-#ifndef NO_MATHOMS
-#ifdef PERL_CORE
-#define magic_setglob(a,b)	Perl_magic_setglob(aTHX_ a,b)
-#endif
-#endif
-#ifdef PERL_CORE
 #define magic_setmglob(a,b)	Perl_magic_setmglob(aTHX_ a,b)
 #define magic_setnkeys(a,b)	Perl_magic_setnkeys(aTHX_ a,b)
 #define magic_setpack(a,b)	Perl_magic_setpack(aTHX_ a,b)
@@ -2785,7 +2924,6 @@
 #define magic_set_all_env(a,b)	Perl_magic_set_all_env(aTHX_ a,b)
 #define magic_sizepack(a,b)	Perl_magic_sizepack(aTHX_ a,b)
 #define magic_wipepack(a,b)	Perl_magic_wipepack(aTHX_ a,b)
-#define magicname(a,b,c)	Perl_magicname(aTHX_ a,b,c)
 #endif
 #define markstack_grow()	Perl_markstack_grow(aTHX)
 #if defined(USE_LOCALE_COLLATE)
@@ -2803,7 +2941,7 @@
 #define mg_clear(a)		Perl_mg_clear(aTHX_ a)
 #define mg_copy(a,b,c,d)	Perl_mg_copy(aTHX_ a,b,c,d)
 #ifdef PERL_CORE
-#define mg_localize(a,b)	Perl_mg_localize(aTHX_ a,b)
+#define mg_localize(a,b,c)	Perl_mg_localize(aTHX_ a,b,c)
 #endif
 #define mg_find(a,b)		Perl_mg_find(aTHX_ a,b)
 #define mg_free(a)		Perl_mg_free(aTHX_ a)
@@ -2817,12 +2955,9 @@
 #define mod(a,b)		Perl_mod(aTHX_ a,b)
 #endif
 #ifdef PERL_CORE
-#define mode_from_discipline(a)	Perl_mode_from_discipline(aTHX_ a)
+#define mode_from_discipline(a,b)	Perl_mode_from_discipline(aTHX_ a,b)
 #endif
 #define moreswitches(a)		Perl_moreswitches(aTHX_ a)
-#ifdef PERL_CORE
-#define my(a)			Perl_my(aTHX_ a)
-#endif
 #define my_atof(a)		Perl_my_atof(aTHX_ a)
 #if (!defined(HAS_MEMCPY) && !defined(HAS_BCOPY)) || (!defined(HAS_MEMMOVE) && !defined(HAS_SAFE_MEMCPY) && !defined(HAS_SAFE_BCOPY))
 #define my_bcopy		Perl_my_bcopy
@@ -2890,7 +3025,6 @@
 #define newGVREF(a,b)		Perl_newGVREF(aTHX_ a,b)
 #define newHVREF(a)		Perl_newHVREF(aTHX_ a)
 #define newHVhv(a)		Perl_newHVhv(aTHX_ a)
-#define newIO()			Perl_newIO(aTHX)
 #define newLISTOP(a,b,c,d)	Perl_newLISTOP(aTHX_ a,b,c,d)
 #ifdef USE_ITHREADS
 #define newPADOP(a,b,c)		Perl_newPADOP(aTHX_ a,b,c)
@@ -2920,6 +3054,7 @@
 #define new_stackinfo(a,b)	Perl_new_stackinfo(aTHX_ a,b)
 #define scan_vstring(a,b,c)	Perl_scan_vstring(aTHX_ a,b,c)
 #define scan_version(a,b,c)	Perl_scan_version(aTHX_ a,b,c)
+#define prescan_version(a,b,c,d,e,f,g)	Perl_prescan_version(aTHX_ a,b,c,d,e,f,g)
 #define new_version(a)		Perl_new_version(aTHX_ a)
 #define upg_version(a,b)	Perl_upg_version(aTHX_ a,b)
 #define vverify(a)		Perl_vverify(aTHX_ a)
@@ -2930,10 +3065,7 @@
 #ifdef PERL_CORE
 #define nextargv(a)		Perl_nextargv(aTHX_ a)
 #endif
-#define ninstr(a,b,c,d)		Perl_ninstr(aTHX_ a,b,c,d)
-#ifdef PERL_CORE
-#define oopsCV(a)		Perl_oopsCV(aTHX_ a)
-#endif
+#define ninstr			Perl_ninstr
 #define op_free(a)		Perl_op_free(aTHX_ a)
 #ifdef PERL_MAD
 #ifdef PERL_CORE
@@ -2945,20 +3077,29 @@
 #endif
 #endif
 #ifdef PERL_CORE
+#define package_version(a)	Perl_package_version(aTHX_ a)
 #define pad_alloc(a,b)		Perl_pad_alloc(aTHX_ a,b)
-#define allocmy(a)		Perl_allocmy(aTHX_ a)
-#define pad_findmy(a)		Perl_pad_findmy(aTHX_ a)
+#define allocmy(a,b,c)		Perl_allocmy(aTHX_ a,b,c)
 #endif
+#define pad_findmy(a,b,c)	Perl_pad_findmy(aTHX_ a,b,c)
 #define find_rundefsvoffset()	Perl_find_rundefsvoffset(aTHX)
 #ifdef PERL_CORE
 #define oopsAV(a)		Perl_oopsAV(aTHX_ a)
 #define oopsHV(a)		Perl_oopsHV(aTHX_ a)
 #define pad_leavemy()		Perl_pad_leavemy(aTHX)
 #endif
+#ifdef DEBUGGING
 #define pad_sv(a)		Perl_pad_sv(aTHX_ a)
+#endif
 #ifdef PERL_CORE
 #define pad_free(a)		Perl_pad_free(aTHX_ a)
-#define pad_reset()		Perl_pad_reset(aTHX)
+#endif
+#if defined(PERL_IN_PAD_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define pad_reset()		S_pad_reset(aTHX)
+#endif
+#endif
+#ifdef PERL_CORE
 #define pad_swipe(a,b)		Perl_pad_swipe(aTHX_ a,b)
 #define peep(a)			Perl_peep(aTHX_ a)
 #endif
@@ -2992,34 +3133,39 @@
 #define require_pv(a)		Perl_require_pv(aTHX_ a)
 #define pack_cat(a,b,c,d,e,f,g)	Perl_pack_cat(aTHX_ a,b,c,d,e,f,g)
 #define packlist(a,b,c,d,e)	Perl_packlist(aTHX_ a,b,c,d,e)
-#ifdef PERL_USES_PL_PIDSTATUS
+#if defined(PERL_USES_PL_PIDSTATUS) && defined(PERL_IN_UTIL_C)
 #ifdef PERL_CORE
-#define pidgone(a,b)		Perl_pidgone(aTHX_ a,b)
+#define pidgone(a,b)		S_pidgone(aTHX_ a,b)
 #endif
 #endif
-#define pmflag(a,b)		Perl_pmflag(aTHX_ a,b)
 #ifdef PERL_CORE
 #define pmruntime(a,b,c)	Perl_pmruntime(aTHX_ a,b,c)
-#define pmtrans(a,b,c)		Perl_pmtrans(aTHX_ a,b,c)
+#endif
+#if defined(PERL_IN_OP_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define pmtrans(a,b,c)		S_pmtrans(aTHX_ a,b,c)
+#endif
 #endif
 #define pop_scope()		Perl_pop_scope(aTHX)
 #ifdef PERL_CORE
 #define prepend_elem(a,b,c)	Perl_prepend_elem(aTHX_ a,b,c)
 #endif
 #define push_scope()		Perl_push_scope(aTHX)
+#if defined(PERL_IN_OP_C) || defined(PERL_DECL_PROT)
 #ifdef PERL_CORE
-#define refkids(a,b)		Perl_refkids(aTHX_ a,b)
+#define refkids(a,b)		S_refkids(aTHX_ a,b)
+#endif
 #endif
 #define regdump(a)		Perl_regdump(aTHX_ a)
 #define regdump(a)		Perl_regdump(aTHX_ a)
 #define regclass_swash(a,b,c,d,e)	Perl_regclass_swash(aTHX_ a,b,c,d,e)
 #define pregexec(a,b,c,d,e,f,g)	Perl_pregexec(aTHX_ a,b,c,d,e,f,g)
 #define pregfree(a)		Perl_pregfree(aTHX_ a)
+#define pregfree2(a)		Perl_pregfree2(aTHX_ a)
 #if defined(PERL_CORE) || defined(PERL_EXT)
-#define reg_temp_copy(a)	Perl_reg_temp_copy(aTHX_ a)
+#define reg_temp_copy(a,b)	Perl_reg_temp_copy(aTHX_ a,b)
 #endif
 #define regfree_internal(a)	Perl_regfree_internal(aTHX_ a)
-#define reg_stringify(a,b,c,d)	Perl_reg_stringify(aTHX_ a,b,c,d)
 #if defined(USE_ITHREADS)
 #define regdupe_internal(a,b)	Perl_regdupe_internal(aTHX_ a,b)
 #endif
@@ -3050,17 +3196,21 @@
 #if defined(PERL_CORE) || defined(PERL_EXT)
 #define regprop(a,b,c)		Perl_regprop(aTHX_ a,b,c)
 #endif
-#define repeatcpy(a,b,c,d)	Perl_repeatcpy(aTHX_ a,b,c,d)
-#define rninstr(a,b,c,d)	Perl_rninstr(aTHX_ a,b,c,d)
+#define repeatcpy		Perl_repeatcpy
+#define rninstr			Perl_rninstr
 #define rsignal(a,b)		Perl_rsignal(aTHX_ a,b)
 #ifdef PERL_CORE
 #define rsignal_restore(a,b)	Perl_rsignal_restore(aTHX_ a,b)
 #define rsignal_save(a,b,c)	Perl_rsignal_save(aTHX_ a,b,c)
 #endif
 #define rsignal_state(a)	Perl_rsignal_state(aTHX_ a)
+#if defined(PERL_IN_PP_CTL_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define rxres_free(a)		S_rxres_free(aTHX_ a)
+#define rxres_restore(a,b)	S_rxres_restore(aTHX_ a,b)
+#endif
+#endif
 #ifdef PERL_CORE
-#define rxres_free(a)		Perl_rxres_free(aTHX_ a)
-#define rxres_restore(a,b)	Perl_rxres_restore(aTHX_ a,b)
 #define rxres_save(a,b)		Perl_rxres_save(aTHX_ a,b)
 #endif
 #if !defined(HAS_RENAME)
@@ -3075,13 +3225,15 @@
 #define savesvpv(a)		Perl_savesvpv(aTHX_ a)
 #define savestack_grow()	Perl_savestack_grow(aTHX)
 #define savestack_grow_cnt(a)	Perl_savestack_grow_cnt(aTHX_ a)
-#define save_aelem(a,b,c)	Perl_save_aelem(aTHX_ a,b,c)
+#define save_aelem_flags(a,b,c,d)	Perl_save_aelem_flags(aTHX_ a,b,c,d)
 #define save_alloc(a,b)		Perl_save_alloc(aTHX_ a,b)
 #define save_aptr(a)		Perl_save_aptr(aTHX_ a)
 #define save_ary(a)		Perl_save_ary(aTHX_ a)
 #define save_bool(a)		Perl_save_bool(aTHX_ a)
 #define save_clearsv(a)		Perl_save_clearsv(aTHX_ a)
 #define save_delete(a,b,c)	Perl_save_delete(aTHX_ a,b,c)
+#define save_hdelete(a,b)	Perl_save_hdelete(aTHX_ a,b)
+#define save_adelete(a,b)	Perl_save_adelete(aTHX_ a,b)
 #define save_destructor(a,b)	Perl_save_destructor(aTHX_ a,b)
 #define save_destructor_x(a,b)	Perl_save_destructor_x(aTHX_ a,b)
 #ifdef PERL_CORE
@@ -3094,7 +3246,7 @@
 #ifdef PERL_CORE
 #define save_hints()		Perl_save_hints(aTHX)
 #endif
-#define save_helem(a,b,c)	Perl_save_helem(aTHX_ a,b,c)
+#define save_helem_flags(a,b,c,d)	Perl_save_helem_flags(aTHX_ a,b,c,d)
 #define save_hptr(a)		Perl_save_hptr(aTHX_ a)
 #define save_I16(a)		Perl_save_I16(aTHX_ a)
 #define save_I32(a)		Perl_save_I32(aTHX_ a)
@@ -3111,7 +3263,6 @@
 #define save_pptr(a)		Perl_save_pptr(aTHX_ a)
 #define save_vptr(a)		Perl_save_vptr(aTHX_ a)
 #define save_re_context()	Perl_save_re_context(aTHX)
-#define save_padsv(a)		Perl_save_padsv(aTHX_ a)
 #define save_padsv_and_mortalize(a)	Perl_save_padsv_and_mortalize(aTHX_ a)
 #define save_sptr(a)		Perl_save_sptr(aTHX_ a)
 #define save_svref(a)		Perl_save_svref(aTHX_ a)
@@ -3128,8 +3279,14 @@
 #ifdef PERL_CORE
 #define sawparens(a)		Perl_sawparens(aTHX_ a)
 #define scalar(a)		Perl_scalar(aTHX_ a)
-#define scalarkids(a)		Perl_scalarkids(aTHX_ a)
-#define scalarseq(a)		Perl_scalarseq(aTHX_ a)
+#endif
+#if defined(PERL_IN_OP_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define scalarkids(a)		S_scalarkids(aTHX_ a)
+#define scalarseq(a)		S_scalarseq(aTHX_ a)
+#endif
+#endif
+#ifdef PERL_CORE
 #define scalarvoid(a)		Perl_scalarvoid(aTHX_ a)
 #endif
 #define scan_bin(a,b,c)		Perl_scan_bin(aTHX_ a,b,c)
@@ -3140,14 +3297,7 @@
 #define scope(a)		Perl_scope(aTHX_ a)
 #endif
 #define screaminstr(a,b,c,d,e,f)	Perl_screaminstr(aTHX_ a,b,c,d,e,f)
-#if !defined(VMS)
-#ifdef PERL_CORE
-#define setenv_getix(a)		Perl_setenv_getix(aTHX_ a)
-#endif
-#endif
-#if defined(PERL_CORE) || defined(PERL_EXT)
 #define setdefout(a)		Perl_setdefout(aTHX_ a)
-#endif
 #define share_hek(a,b,c)	Perl_share_hek(aTHX_ a,b,c)
 #if defined(HAS_SIGACTION) && defined(SA_SIGINFO)
 #ifdef PERL_CORE
@@ -3171,7 +3321,6 @@
 #if defined(PERL_IN_SV_C) || defined(PERL_DECL_PROT)
 #ifdef PERL_CORE
 #define glob_2number(a)		S_glob_2number(aTHX_ a)
-#define glob_2pv(a,b)		S_glob_2pv(aTHX_ a,b)
 #endif
 #endif
 #define sv_2iv_flags(a,b)	Perl_sv_2iv_flags(aTHX_ a,b)
@@ -3192,8 +3341,10 @@
 #define sv_pvutf8n(a,b)		Perl_sv_pvutf8n(aTHX_ a,b)
 #define sv_pvbyten(a,b)		Perl_sv_pvbyten(aTHX_ a,b)
 #define sv_true(a)		Perl_sv_true(aTHX_ a)
+#if defined(PERL_IN_SV_C) || defined(PERL_DECL_PROT)
 #ifdef PERL_CORE
-#define sv_add_arena(a,b,c)	Perl_sv_add_arena(aTHX_ a,b,c)
+#define sv_add_arena(a,b,c)	S_sv_add_arena(aTHX_ a,b,c)
+#endif
 #endif
 #define sv_backoff(a)		Perl_sv_backoff(aTHX_ a)
 #define sv_bless(a,b)		Perl_sv_bless(aTHX_ a,b)
@@ -3236,6 +3387,7 @@
 #define sv_newref(a)		Perl_sv_newref(aTHX_ a)
 #define sv_peek(a)		Perl_sv_peek(aTHX_ a)
 #define sv_pos_u2b(a,b,c)	Perl_sv_pos_u2b(aTHX_ a,b,c)
+#define sv_pos_u2b_flags(a,b,c,d)	Perl_sv_pos_u2b_flags(aTHX_ a,b,c,d)
 #define sv_pos_b2u(a,b)		Perl_sv_pos_b2u(aTHX_ a,b)
 #define sv_pvutf8n_force(a,b)	Perl_sv_pvutf8n_force(aTHX_ a,b)
 #define sv_pvbyten_force(a,b)	Perl_sv_pvbyten_force(aTHX_ a,b)
@@ -3339,7 +3491,7 @@
 #endif
 #define whichsig(a)		Perl_whichsig(aTHX_ a)
 #ifdef PERL_CORE
-#define write_to_stderr(a,b)	Perl_write_to_stderr(aTHX_ a,b)
+#define write_to_stderr(a)	Perl_write_to_stderr(aTHX_ a)
 #define yyerror(a)		Perl_yyerror(aTHX_ a)
 #endif
 #if defined(PERL_CORE) || defined(PERL_EXT)
@@ -3348,7 +3500,11 @@
 #ifdef PERL_CORE
 #define yyparse()		Perl_yyparse(aTHX)
 #define parser_free(a)		Perl_parser_free(aTHX_ a)
-#define yywarn(a)		Perl_yywarn(aTHX_ a)
+#endif
+#if defined(PERL_IN_TOKE_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define yywarn(a)		S_yywarn(aTHX_ a)
+#endif
 #endif
 #if defined(MYMALLOC)
 #define dump_mstats(a)		Perl_dump_mstats(aTHX_ a)
@@ -3407,7 +3563,6 @@
 #endif
 #ifdef PERL_CORE
 #define my_attrs(a,b)		Perl_my_attrs(aTHX_ a,b)
-#define boot_core_xsutils()	Perl_boot_core_xsutils(aTHX)
 #endif
 #if defined(USE_ITHREADS)
 #define cx_dup(a,b,c,d)		Perl_cx_dup(aTHX_ a,b,c,d)
@@ -3416,11 +3571,16 @@
 #define any_dup(a,b)		Perl_any_dup(aTHX_ a,b)
 #define he_dup(a,b,c)		Perl_he_dup(aTHX_ a,b,c)
 #define hek_dup(a,b)		Perl_hek_dup(aTHX_ a,b)
-#define re_dup(a,b)		Perl_re_dup(aTHX_ a,b)
+#define re_dup_guts(a,b,c)	Perl_re_dup_guts(aTHX_ a,b,c)
 #define fp_dup(a,b,c)		Perl_fp_dup(aTHX_ a,b,c)
 #define dirp_dup(a)		Perl_dirp_dup(aTHX_ a)
 #define gp_dup(a,b)		Perl_gp_dup(aTHX_ a,b)
 #define mg_dup(a,b)		Perl_mg_dup(aTHX_ a,b)
+#if defined(PERL_IN_SV_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define sv_dup_inc_multiple(a,b,c,d)	S_sv_dup_inc_multiple(aTHX_ a,b,c,d)
+#endif
+#endif
 #define sv_dup(a,b)		Perl_sv_dup(aTHX_ a,b)
 #define rvpv_dup(a,b,c)		Perl_rvpv_dup(aTHX_ a,b,c)
 #define parser_dup(a,b)		Perl_parser_dup(aTHX_ a,b)
@@ -3472,6 +3632,7 @@
 #ifdef PERL_CORE
 #define hsplit(a)		S_hsplit(aTHX_ a)
 #define hfreeentries(a)		S_hfreeentries(aTHX_ a)
+#define anonymise_cv(a,b)	S_anonymise_cv(aTHX_ a,b)
 #define new_he()		S_new_he(aTHX)
 #define save_hek_flags		S_save_hek_flags
 #define hv_magic_check		S_hv_magic_check
@@ -3512,7 +3673,6 @@
 #define ck_grep(a)		Perl_ck_grep(aTHX_ a)
 #define ck_index(a)		Perl_ck_index(aTHX_ a)
 #define ck_join(a)		Perl_ck_join(aTHX_ a)
-#define ck_lengthconst(a)	Perl_ck_lengthconst(aTHX_ a)
 #define ck_lfun(a)		Perl_ck_lfun(aTHX_ a)
 #define ck_listiob(a)		Perl_ck_listiob(aTHX_ a)
 #define ck_match(a)		Perl_ck_match(aTHX_ a)
@@ -3536,6 +3696,7 @@
 #define ck_svconst(a)		Perl_ck_svconst(aTHX_ a)
 #define ck_trunc(a)		Perl_ck_trunc(aTHX_ a)
 #define ck_unpack(a)		Perl_ck_unpack(aTHX_ a)
+#define ck_each(a)		Perl_ck_each(aTHX_ a)
 #define is_handle_constructor	S_is_handle_constructor
 #define is_list_assignment(a)	S_is_list_assignment(aTHX_ a)
 #endif
@@ -3589,7 +3750,8 @@
 #ifdef PERL_CORE
 #define find_beginning(a,b)	S_find_beginning(aTHX_ a,b)
 #define forbid_setid(a,b)	S_forbid_setid(aTHX_ a,b)
-#define incpush(a,b,c,d,e)	S_incpush(aTHX_ a,b,c,d,e)
+#define incpush(a,b,c)		S_incpush(aTHX_ a,b,c)
+#define incpush_use_sep(a,b,c)	S_incpush_use_sep(aTHX_ a,b,c)
 #define init_interp()		S_init_interp(aTHX)
 #define init_ids()		S_init_ids(aTHX)
 #define init_main_stash()	S_init_main_stash(aTHX)
@@ -3598,36 +3760,22 @@
 #define init_predump_symbols()	S_init_predump_symbols(aTHX)
 #define my_exit_jump()		S_my_exit_jump(aTHX)
 #define nuke_stacks()		S_nuke_stacks(aTHX)
-#define open_script(a,b,c,d,e)	S_open_script(aTHX_ a,b,c,d,e)
+#define open_script(a,b,c,d)	S_open_script(aTHX_ a,b,c,d)
 #define usage(a)		S_usage(aTHX_ a)
 #endif
-#ifdef DOSUID
-#  ifdef IAMSUID
-#ifdef PERL_CORE
-#endif
-#  else
-#ifdef PERL_CORE
-#endif
-#  endif
-#else
-#  ifndef SETUID_SCRIPTS_ARE_SECURE_NOW
+#ifndef SETUID_SCRIPTS_ARE_SECURE_NOW
 #ifdef PERL_CORE
 #endif
-#  endif
-#endif
-#  if defined(IAMSUID)
-#ifdef PERL_CORE
-#define fd_on_nosuid_fs(a)	S_fd_on_nosuid_fs(aTHX_ a)
 #endif
-#  endif
 #ifdef PERL_CORE
 #define parse_body(a,b)		S_parse_body(aTHX_ a,b)
 #define run_body(a)		S_run_body(aTHX_ a)
-#define incpush_if_exists(a)	S_incpush_if_exists(aTHX_ a)
+#define incpush_if_exists(a,b,c)	S_incpush_if_exists(aTHX_ a,b,c)
 #endif
 #endif
 #if defined(PERL_IN_PP_C) || defined(PERL_DECL_PROT)
 #ifdef PERL_CORE
+#define do_delete_local()	S_do_delete_local(aTHX)
 #define refto(a)		S_refto(aTHX_ a)
 #endif
 #endif
@@ -3723,11 +3871,10 @@
 #define regbranch(a,b,c,d)	S_regbranch(aTHX_ a,b,c,d)
 #define reguni(a,b,c)		S_reguni(aTHX_ a,b,c)
 #define regclass(a,b)		S_regclass(aTHX_ a,b)
-#define regcurly		S_regcurly
 #define reg_node(a,b)		S_reg_node(aTHX_ a,b)
 #define reg_recode(a,b)		S_reg_recode(aTHX_ a,b)
 #define regpiece(a,b,c)		S_regpiece(aTHX_ a,b,c)
-#define reg_namedseq(a,b)	S_reg_namedseq(aTHX_ a,b)
+#define reg_namedseq(a,b,c)	S_reg_namedseq(aTHX_ a,b,c)
 #define reginsert(a,b,c,d)	S_reginsert(aTHX_ a,b,c,d)
 #define regtail(a,b,c,d)	S_regtail(aTHX_ a,b,c,d)
 #define reg_scan_name(a,b)	S_reg_scan_name(aTHX_ a,b)
@@ -3783,7 +3930,6 @@
 #if defined(PERL_CORE) || defined(PERL_EXT)
 #define reghopmaybe3		S_reghopmaybe3
 #define find_byclass(a,b,c,d,e)	S_find_byclass(aTHX_ a,b,c,d,e)
-#define swap_match_buff(a)	S_swap_match_buff(aTHX_ a)
 #define to_utf8_substr(a)	S_to_utf8_substr(aTHX_ a)
 #define to_byte_substr(a)	S_to_byte_substr(aTHX_ a)
 #define reg_check_named_buff_matched(a,b)	S_reg_check_named_buff_matched(aTHX_ a,b)
@@ -3807,7 +3953,7 @@
 #endif
 #if defined(PERL_IN_SCOPE_C) || defined(PERL_DECL_PROT)
 #ifdef PERL_CORE
-#define save_scalar_at(a)	S_save_scalar_at(aTHX_ a)
+#define save_scalar_at(a,b)	S_save_scalar_at(aTHX_ a,b)
 #endif
 #endif
 #if defined(PERL_IN_GV_C) || defined(PERL_IN_SV_C) || defined(PERL_IN_PAD_C) || defined(PERL_DECL_PROT)
@@ -3873,6 +4019,7 @@
 #define check_uni()		S_check_uni(aTHX)
 #define force_next(a)		S_force_next(aTHX_ a)
 #define force_version(a,b)	S_force_version(aTHX_ a,b)
+#define force_strict_version(a)	S_force_strict_version(aTHX_ a)
 #define force_word(a,b,c,d,e)	S_force_word(aTHX_ a,b,c,d,e)
 #define tokeq(a)		S_tokeq(aTHX_ a)
 #define readpipe_override()	S_readpipe_override(aTHX)
@@ -3889,6 +4036,14 @@
 #define update_debugger_info(a,b,c)	S_update_debugger_info(aTHX_ a,b,c)
 #define skipspace(a)		S_skipspace(aTHX_ a)
 #define swallow_bom(a)		S_swallow_bom(aTHX_ a)
+#endif
+#ifndef PERL_NO_UTF16_FILTER
+#ifdef PERL_CORE
+#define utf16_textfilter(a,b,c)	S_utf16_textfilter(aTHX_ a,b,c)
+#define add_utf16_textfilter(a,b)	S_add_utf16_textfilter(aTHX_ a,b)
+#endif
+#endif
+#ifdef PERL_CORE
 #define checkcomma(a,b,c)	S_checkcomma(aTHX_ a,b,c)
 #define feature_is_enabled(a,b)	S_feature_is_enabled(aTHX_ a,b)
 #define force_ident(a,b)	S_force_ident(aTHX_ a,b)
@@ -3901,9 +4056,10 @@
 #define sublex_done()		S_sublex_done(aTHX)
 #define sublex_push()		S_sublex_push(aTHX)
 #define sublex_start()		S_sublex_start(aTHX)
-#define filter_gets(a,b,c)	S_filter_gets(aTHX_ a,b,c)
+#define filter_gets(a,b)	S_filter_gets(aTHX_ a,b)
 #define find_in_my_stash(a,b)	S_find_in_my_stash(aTHX_ a,b)
 #define tokenize_use(a,b)	S_tokenize_use(aTHX_ a,b)
+#define deprecate_commaless_var_list()	S_deprecate_commaless_var_list(aTHX)
 #define ao(a)			S_ao(aTHX_ a)
 #endif
 #  if defined(PERL_CR_FILTER)
@@ -3935,11 +4091,11 @@
 #ifdef PERL_CORE
 #define closest_cop(a,b)	S_closest_cop(aTHX_ a,b)
 #define mess_alloc()		S_mess_alloc(aTHX)
-#define vdie_croak_common(a,b,c,d)	S_vdie_croak_common(aTHX_ a,b,c,d)
-#define vdie_common(a,b,c,d)	S_vdie_common(aTHX_ a,b,c,d)
+#define vdie_croak_common(a,b)	S_vdie_croak_common(aTHX_ a,b)
+#define vdie_common(a,b)	S_vdie_common(aTHX_ a,b)
 #define write_no_mem()		S_write_no_mem(aTHX)
 #endif
-#if defined(PERL_MEM_LOG) && defined(PERL_MEM_LOG_STDERR)
+#if defined(PERL_MEM_LOG) && !defined(PERL_MEM_LOG_NOIMPL)
 #ifdef PERL_CORE
 #define mem_log_common		S_mem_log_common
 #endif
@@ -3960,7 +4116,7 @@
 #define sv_setsv_flags(a,b,c)	Perl_sv_setsv_flags(aTHX_ a,b,c)
 #define sv_catpvn_flags(a,b,c,d)	Perl_sv_catpvn_flags(aTHX_ a,b,c,d)
 #define sv_catsv_flags(a,b,c)	Perl_sv_catsv_flags(aTHX_ a,b,c)
-#define sv_utf8_upgrade_flags(a,b)	Perl_sv_utf8_upgrade_flags(aTHX_ a,b)
+#define sv_utf8_upgrade_flags_grow(a,b,c)	Perl_sv_utf8_upgrade_flags_grow(aTHX_ a,b,c)
 #define sv_pvn_force_flags(a,b,c)	Perl_sv_pvn_force_flags(aTHX_ a,b,c)
 #define sv_copypv(a,b)		Perl_sv_copypv(aTHX_ a,b)
 #define my_atof2(a,b)		Perl_my_atof2(aTHX_ a,b)
@@ -4008,7 +4164,11 @@
 #define pad_undef(a)		Perl_pad_undef(aTHX_ a)
 #define pad_add_name(a,b,c,d,e)	Perl_pad_add_name(aTHX_ a,b,c,d,e)
 #define pad_add_anon(a,b)	Perl_pad_add_anon(aTHX_ a,b)
-#define pad_check_dup(a,b,c)	Perl_pad_check_dup(aTHX_ a,b,c)
+#endif
+#if defined(PERL_IN_PAD_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define pad_check_dup(a,b,c)	S_pad_check_dup(aTHX_ a,b,c)
+#endif
 #endif
 #ifdef DEBUGGING
 #ifdef PERL_CORE
@@ -4028,6 +4188,7 @@
 #if defined(PERL_IN_PAD_C) || defined(PERL_DECL_PROT)
 #ifdef PERL_CORE
 #define pad_findlex(a,b,c,d,e,f,g)	S_pad_findlex(aTHX_ a,b,c,d,e,f,g)
+#define pad_add_name_sv(a,b,c,d)	S_pad_add_name_sv(aTHX_ a,b,c,d)
 #endif
 #  if defined(DEBUGGING)
 #ifdef PERL_CORE
@@ -4045,6 +4206,8 @@
 #endif
 #endif
 #define save_set_svflags(a,b,c)	Perl_save_set_svflags(aTHX_ a,b,c)
+#ifdef DEBUGGING
+#endif
 #define hv_scalar(a)		Perl_hv_scalar(aTHX_ a)
 #define hv_name_set(a,b,c,d)	Perl_hv_name_set(aTHX_ a,b,c,d)
 #ifdef PERL_CORE
@@ -4199,7 +4362,11 @@
 #endif
 #endif
 #ifdef PERL_DONT_CREATE_GVSV
-#define gv_SVadd(a)		Perl_gv_SVadd(aTHX_ a)
+#endif
+#if defined(PERL_IN_UTIL_C) || defined(PERL_DECL_PROT)
+#ifdef PERL_CORE
+#define ckwarn_common(a)	S_ckwarn_common(aTHX_ a)
+#endif
 #endif
 #if defined(PERL_CORE) || defined(PERL_EXT)
 #endif
@@ -4231,8 +4398,11 @@
 #ifdef PERL_CORE
 #define xmldump_vindent(a,b,c,d)	Perl_xmldump_vindent(aTHX_ a,b,c,d)
 #define xmldump_all()		Perl_xmldump_all(aTHX)
+#define xmldump_all_perl(a)	Perl_xmldump_all_perl(aTHX_ a)
 #define xmldump_packsubs(a)	Perl_xmldump_packsubs(aTHX_ a)
+#define xmldump_packsubs_perl(a,b)	Perl_xmldump_packsubs_perl(aTHX_ a,b)
 #define xmldump_sub(a)		Perl_xmldump_sub(aTHX_ a)
+#define xmldump_sub_perl(a,b)	Perl_xmldump_sub_perl(aTHX_ a,b)
 #define xmldump_form(a)		Perl_xmldump_form(aTHX_ a)
 #define xmldump_eval()		Perl_xmldump_eval(aTHX)
 #define sv_catxmlsv(a,b)	Perl_sv_catxmlsv(aTHX_ a,b)
@@ -4294,6 +4464,10 @@
 #ifdef PERL_CORE
 #define boot_core_mro()		Perl_boot_core_mro(aTHX)
 #endif
+#ifdef PERL_CORE
+#endif
+#ifdef PERL_CORE
+#endif
 #define ck_anoncode(a)		Perl_ck_anoncode(aTHX_ a)
 #define ck_bitop(a)		Perl_ck_bitop(aTHX_ a)
 #define ck_chdir(a)		Perl_ck_chdir(aTHX_ a)
@@ -4301,6 +4475,7 @@
 #define ck_defined(a)		Perl_ck_defined(aTHX_ a)
 #define ck_delete(a)		Perl_ck_delete(aTHX_ a)
 #define ck_die(a)		Perl_ck_die(aTHX_ a)
+#define ck_each(a)		Perl_ck_each(aTHX_ a)
 #define ck_eof(a)		Perl_ck_eof(aTHX_ a)
 #define ck_eval(a)		Perl_ck_eval(aTHX_ a)
 #define ck_exec(a)		Perl_ck_exec(aTHX_ a)
@@ -4312,7 +4487,6 @@
 #define ck_grep(a)		Perl_ck_grep(aTHX_ a)
 #define ck_index(a)		Perl_ck_index(aTHX_ a)
 #define ck_join(a)		Perl_ck_join(aTHX_ a)
-#define ck_lengthconst(a)	Perl_ck_lengthconst(aTHX_ a)
 #define ck_lfun(a)		Perl_ck_lfun(aTHX_ a)
 #define ck_listiob(a)		Perl_ck_listiob(aTHX_ a)
 #define ck_match(a)		Perl_ck_match(aTHX_ a)
@@ -4341,8 +4515,10 @@
 #define pp_abs()		Perl_pp_abs(aTHX)
 #define pp_accept()		Perl_pp_accept(aTHX)
 #define pp_add()		Perl_pp_add(aTHX)
+#define pp_aeach()		Perl_pp_aeach(aTHX)
 #define pp_aelem()		Perl_pp_aelem(aTHX)
 #define pp_aelemfast()		Perl_pp_aelemfast(aTHX)
+#define pp_akeys()		Perl_pp_akeys(aTHX)
 #define pp_alarm()		Perl_pp_alarm(aTHX)
 #define pp_and()		Perl_pp_and(aTHX)
 #define pp_andassign()		Perl_pp_andassign(aTHX)
@@ -4352,6 +4528,7 @@
 #define pp_aslice()		Perl_pp_aslice(aTHX)
 #define pp_atan2()		Perl_pp_atan2(aTHX)
 #define pp_av2arylen()		Perl_pp_av2arylen(aTHX)
+#define pp_avalues()		Perl_pp_avalues(aTHX)
 #define pp_backtick()		Perl_pp_backtick(aTHX)
 #define pp_bind()		Perl_pp_bind(aTHX)
 #define pp_binmode()		Perl_pp_binmode(aTHX)
@@ -4359,6 +4536,7 @@
 #define pp_bit_or()		Perl_pp_bit_or(aTHX)
 #define pp_bit_xor()		Perl_pp_bit_xor(aTHX)
 #define pp_bless()		Perl_pp_bless(aTHX)
+#define pp_boolkeys()		Perl_pp_boolkeys(aTHX)
 #define pp_break()		Perl_pp_break(aTHX)
 #define pp_caller()		Perl_pp_caller(aTHX)
 #define pp_chdir()		Perl_pp_chdir(aTHX)
@@ -4483,6 +4661,7 @@
 #define pp_gvsv()		Perl_pp_gvsv(aTHX)
 #define pp_helem()		Perl_pp_helem(aTHX)
 #define pp_hex()		Perl_pp_hex(aTHX)
+#define pp_hintseval()		Perl_pp_hintseval(aTHX)
 #define pp_hslice()		Perl_pp_hslice(aTHX)
 #define pp_i_add()		Perl_pp_i_add(aTHX)
 #define pp_i_divide()		Perl_pp_i_divide(aTHX)
@@ -4622,7 +4801,6 @@
 #define pp_seq()		Perl_pp_seq(aTHX)
 #define pp_setpgrp()		Perl_pp_setpgrp(aTHX)
 #define pp_setpriority()	Perl_pp_setpriority(aTHX)
-#define pp_setstate()		Perl_pp_setstate(aTHX)
 #define pp_sge()		Perl_pp_sge(aTHX)
 #define pp_sgrent()		Perl_pp_sgrent(aTHX)
 #define pp_sgt()		Perl_pp_sgt(aTHX)
Index: src/gnu/usr.bin/perl/embed.pl
diff -u src/gnu/usr.bin/perl/embed.pl:1.11 src/gnu/usr.bin/perl/embed.pl:1.12
--- embed.pl:1.11	Mon Oct 12 18:24:20 2009
+++ embed.pl	Fri Sep 24 15:06:40 2010
@@ -253,6 +253,9 @@
 	if ( $flags =~ /r/ ) {
 	    push @attrs, "__attribute__noreturn__";
 	}
+	if ( $flags =~ /D/ ) {
+	    push @attrs, "__attribute__deprecated__";
+	}
 	if ( $is_malloc ) {
 	    push @attrs, "__attribute__malloc__";
 	}
Index: src/gnu/usr.bin/perl/git_version.h
diff -u src/gnu/usr.bin/perl/git_version.h:1.1 src/gnu/usr.bin/perl/git_version.h:1.2
--- git_version.h:1.1	Mon Oct 12 18:24:20 2009
+++ git_version.h	Fri Sep 24 15:06:40 2010
@@ -5,4 +5,4 @@
 #define PERL_GIT_UNCOMMITTED_CHANGES 
 #define PERL_PATCHNUM ""
 #define PERL_GIT_UNPUSHED_COMMITS		\
-/*no-op*//*leave-this-comment*/
+    /*leave-this-comment*/
Index: src/gnu/usr.bin/perl/global.sym
diff -u src/gnu/usr.bin/perl/global.sym:1.12 src/gnu/usr.bin/perl/global.sym:1.13
--- global.sym:1.12	Mon Oct 12 18:24:20 2009
+++ global.sym	Fri Sep 24 15:06:40 2010
@@ -31,6 +31,7 @@
 Perl_mfree
 Perl_get_context
 Perl_set_context
+Perl_regcurly
 Perl_amagic_call
 Perl_Gv_AMupdate
 Perl_gv_handler
@@ -51,6 +52,7 @@
 Perl_av_undef
 Perl_av_unshift
 Perl_av_arylen_p
+Perl_av_iter_p
 Perl_block_gimme
 Perl_call_list
 Perl_cast_ulong
@@ -76,7 +78,6 @@
 Perl_sv_setpvf_mg_nocontext
 Perl_fprintf_nocontext
 Perl_printf_nocontext
-Perl_cv_ckproto
 Perl_gv_const_sv
 Perl_cv_const_sv
 Perl_cv_undef
@@ -126,6 +127,7 @@
 Perl_free_tmps
 Perl_gp_free
 Perl_gp_ref
+Perl_gv_add_by_type
 Perl_gv_AVadd
 Perl_gv_HVadd
 Perl_gv_IOadd
@@ -140,12 +142,14 @@
 Perl_gv_fetchmeth_autoload
 Perl_gv_fetchmethod
 Perl_gv_fetchmethod_autoload
+Perl_gv_fetchmethod_flags
 Perl_gv_fetchpv
 Perl_gv_fullname
 Perl_gv_fullname3
 Perl_gv_fullname4
 Perl_gv_init
 Perl_gv_name_set
+Perl_gv_try_downgrade
 Perl_gv_stashpv
 Perl_gv_stashpvn
 Perl_gv_stashsv
@@ -187,7 +191,6 @@
 Perl_to_uni_title_lc
 Perl_to_uni_lower_lc
 Perl_is_uni_alnum
-Perl_is_uni_alnumc
 Perl_is_uni_idfirst
 Perl_is_uni_alpha
 Perl_is_uni_ascii
@@ -205,7 +208,6 @@
 Perl_to_uni_lower
 Perl_to_uni_fold
 Perl_is_uni_alnum_lc
-Perl_is_uni_alnumc_lc
 Perl_is_uni_idfirst_lc
 Perl_is_uni_alpha_lc
 Perl_is_uni_ascii_lc
@@ -218,19 +220,22 @@
 Perl_is_uni_print_lc
 Perl_is_uni_punct_lc
 Perl_is_uni_xdigit_lc
+Perl_is_ascii_string
 Perl_is_utf8_char
 Perl_is_utf8_string
 Perl_is_utf8_string_loc
 Perl_is_utf8_string_loclen
 Perl_is_utf8_alnum
-Perl_is_utf8_alnumc
 Perl_is_utf8_idfirst
 Perl_is_utf8_idcont
 Perl_is_utf8_alpha
 Perl_is_utf8_ascii
 Perl_is_utf8_space
+Perl_is_utf8_perl_space
+Perl_is_utf8_perl_word
 Perl_is_utf8_cntrl
 Perl_is_utf8_digit
+Perl_is_utf8_posix_digit
 Perl_is_utf8_graph
 Perl_is_utf8_upper
 Perl_is_utf8_lower
@@ -238,8 +243,29 @@
 Perl_is_utf8_punct
 Perl_is_utf8_xdigit
 Perl_is_utf8_mark
+Perl_is_utf8_X_begin
+Perl_is_utf8_X_extend
+Perl_is_utf8_X_prepend
+Perl_is_utf8_X_non_hangul
+Perl_is_utf8_X_L
+Perl_is_utf8_X_LV
+Perl_is_utf8_X_LVT
+Perl_is_utf8_X_LV_LVT_V
+Perl_is_utf8_X_T
+Perl_is_utf8_X_V
 Perl_leave_scope
 Perl_lex_end
+Perl_lex_bufutf8
+Perl_lex_grow_linestr
+Perl_lex_stuff_pvn
+Perl_lex_stuff_sv
+Perl_lex_unstuff
+Perl_lex_read_to
+Perl_lex_discard_to
+Perl_lex_next_chunk
+Perl_lex_peek_unichar
+Perl_lex_read_unichar
+Perl_lex_read_space
 Perl_op_null
 Perl_op_clear
 Perl_op_refcnt_lock
@@ -351,6 +377,7 @@
 Perl_new_stackinfo
 Perl_scan_vstring
 Perl_scan_version
+Perl_prescan_version
 Perl_new_version
 Perl_upg_version
 Perl_vverify
@@ -360,6 +387,7 @@
 Perl_vcmp
 Perl_ninstr
 Perl_op_free
+Perl_pad_findmy
 Perl_find_rundefsvoffset
 Perl_pad_sv
 Perl_reentrant_size
@@ -399,9 +427,9 @@
 Perl_regclass_swash
 Perl_pregexec
 Perl_pregfree
+Perl_pregfree2
 Perl_reg_temp_copy
 Perl_regfree_internal
-Perl_reg_stringify
 Perl_regdupe_internal
 Perl_pregcomp
 Perl_re_compile
@@ -432,13 +460,15 @@
 Perl_savesvpv
 Perl_savestack_grow
 Perl_savestack_grow_cnt
-Perl_save_aelem
+Perl_save_aelem_flags
 Perl_save_alloc
 Perl_save_aptr
 Perl_save_ary
 Perl_save_bool
 Perl_save_clearsv
 Perl_save_delete
+Perl_save_hdelete
+Perl_save_adelete
 Perl_save_destructor
 Perl_save_destructor_x
 Perl_save_freesv
@@ -449,7 +479,7 @@
 Perl_save_shared_pvref
 Perl_save_gp
 Perl_save_hash
-Perl_save_helem
+Perl_save_helem_flags
 Perl_save_hptr
 Perl_save_I16
 Perl_save_I32
@@ -466,7 +496,6 @@
 Perl_save_pptr
 Perl_save_vptr
 Perl_save_re_context
-Perl_save_padsv
 Perl_save_padsv_and_mortalize
 Perl_save_sptr
 Perl_save_svref
@@ -539,6 +568,7 @@
 Perl_sv_newref
 Perl_sv_peek
 Perl_sv_pos_u2b
+Perl_sv_pos_u2b_flags
 Perl_sv_pos_b2u
 Perl_sv_pvn_force
 Perl_sv_pvutf8n_force
@@ -612,6 +642,8 @@
 Perl_warn
 Perl_vwarn
 Perl_warner
+Perl_ck_warner
+Perl_ck_warner_d
 Perl_vwarner
 Perl_whichsig
 Perl_yylex
@@ -679,7 +711,7 @@
 Perl_any_dup
 Perl_he_dup
 Perl_hek_dup
-Perl_re_dup
+Perl_re_dup_guts
 Perl_fp_dup
 Perl_dirp_dup
 Perl_gp_dup
@@ -708,7 +740,7 @@
 Perl_sv_setsv_flags
 Perl_sv_catpvn_flags
 Perl_sv_catsv_flags
-Perl_sv_utf8_upgrade_flags
+Perl_sv_utf8_upgrade_flags_grow
 Perl_sv_pvn_force_flags
 Perl_sv_copypv
 Perl_my_atof2
@@ -780,4 +812,5 @@
 Perl_sys_init
 Perl_sys_init3
 Perl_sys_term
+Perl_fetch_cop_label
 # ex: set ro:
Index: src/gnu/usr.bin/perl/globvar.sym
diff -u src/gnu/usr.bin/perl/globvar.sym:1.5 src/gnu/usr.bin/perl/globvar.sym:1.6
--- globvar.sym:1.5	Mon Oct 12 18:24:20 2009
+++ globvar.sym	Fri Sep 24 15:06:40 2010
@@ -9,6 +9,7 @@
 fold
 fold_locale
 freq
+keyword_plugin
 memory_wrap
 no_aelem
 no_dir_func
Index: src/gnu/usr.bin/perl/gv.c
diff -u src/gnu/usr.bin/perl/gv.c:1.12 src/gnu/usr.bin/perl/gv.c:1.13
--- gv.c:1.12	Mon Oct 12 18:24:21 2009
+++ gv.c	Fri Sep 24 15:06:40 2010
@@ -40,76 +40,45 @@
 static const char S_autoload[] = "AUTOLOAD";
 static const STRLEN S_autolen = sizeof(S_autoload)-1;
 
-
-#ifdef PERL_DONT_CREATE_GVSV
-GV *
-Perl_gv_SVadd(pTHX_ GV *gv)
-{
-    PERL_ARGS_ASSERT_GV_SVADD;
-
-    if (!gv || SvTYPE((const SV *)gv) != SVt_PVGV)
-	Perl_croak(aTHX_ "Bad symbol for scalar");
-    if (!GvSV(gv))
-	GvSV(gv) = newSV(0);
-    return gv;
-}
-#endif
-
-GV *
-Perl_gv_AVadd(pTHX_ register GV *gv)
-{
-    PERL_ARGS_ASSERT_GV_AVADD;
-
-    if (!gv || SvTYPE((const SV *)gv) != SVt_PVGV)
-	Perl_croak(aTHX_ "Bad symbol for array");
-    if (!GvAV(gv))
-	GvAV(gv) = newAV();
-    return gv;
-}
-
-GV *
-Perl_gv_HVadd(pTHX_ register GV *gv)
-{
-    PERL_ARGS_ASSERT_GV_HVADD;
-
-    if (!gv || SvTYPE((const SV *)gv) != SVt_PVGV)
-	Perl_croak(aTHX_ "Bad symbol for hash");
-    if (!GvHV(gv))
-	GvHV(gv) = newHV();
-    return gv;
-}
-
 GV *
-Perl_gv_IOadd(pTHX_ register GV *gv)
+Perl_gv_add_by_type(pTHX_ GV *gv, svtype type)
 {
-    dVAR;
-
-    PERL_ARGS_ASSERT_GV_IOADD;
+    SV **where;
 
     if (!gv || SvTYPE((const SV *)gv) != SVt_PVGV) {
-
-        /*
-         * if it walks like a dirhandle, then let's assume that
-         * this is a dirhandle.
-         */
-	const char * const fh =
-			 PL_op->op_type ==  OP_READDIR ||
-                         PL_op->op_type ==  OP_TELLDIR ||
-                         PL_op->op_type ==  OP_SEEKDIR ||
-                         PL_op->op_type ==  OP_REWINDDIR ||
-                         PL_op->op_type ==  OP_CLOSEDIR ?
-                         "dirhandle" : "filehandle";
-        Perl_croak(aTHX_ "Bad symbol for %s", fh);
+	const char *what;
+	if (type == SVt_PVIO) {
+	    /*
+	     * if it walks like a dirhandle, then let's assume that
+	     * this is a dirhandle.
+	     */
+	    what = PL_op->op_type ==  OP_READDIR ||
+		PL_op->op_type ==  OP_TELLDIR ||
+		PL_op->op_type ==  OP_SEEKDIR ||
+		PL_op->op_type ==  OP_REWINDDIR ||
+		PL_op->op_type ==  OP_CLOSEDIR ?
+		"dirhandle" : "filehandle";
+	    /* diag_listed_as: Bad symbol for filehandle */
+	} else if (type == SVt_PVHV) {
+	    what = "hash";
+	} else {
+	    what = type == SVt_PVAV ? "array" : "scalar";
+	}
+	Perl_croak(aTHX_ "Bad symbol for %s", what);
     }
 
-    if (!GvIOp(gv)) {
-#ifdef GV_UNIQUE_CHECK
-        if (GvUNIQUE(gv)) {
-            Perl_croak(aTHX_ "Bad symbol for filehandle (GV is unique)");
-        }
-#endif
-	GvIOp(gv) = newIO();
+    if (type == SVt_PVHV) {
+	where = (SV **)&GvHV(gv);
+    } else if (type == SVt_PVAV) {
+	where = (SV **)&GvAV(gv);
+    } else if (type == SVt_PVIO) {
+	where = (SV **)&GvIOp(gv);
+    } else {
+	where = &GvSV(gv);
     }
+
+    if (!*where)
+	*where = newSV_type(type);
     return gv;
 }
 
@@ -306,7 +275,7 @@
 }
 
 STATIC void
-S_gv_init_sv(pTHX_ GV *gv, I32 sv_type)
+S_gv_init_sv(pTHX_ GV *gv, const svtype sv_type)
 {
     PERL_ARGS_ASSERT_GV_INIT_SV;
 
@@ -444,9 +413,8 @@
         cstash = gv_stashsv(linear_sv, 0);
 
         if (!cstash) {
-            if (ckWARN(WARN_SYNTAX))
-                Perl_warner(aTHX_ packWARN(WARN_SYNTAX), "Can't locate package %"SVf" for @%s::ISA",
-                    SVfARG(linear_sv), hvname);
+	    Perl_ck_warner(aTHX_ packWARN(WARN_SYNTAX), "Can't locate package %"SVf" for @%s::ISA",
+			   SVfARG(linear_sv), hvname);
             continue;
         }
 
@@ -601,19 +569,18 @@
     return stash;
 }
 
-/* FIXME. If changing this function note the comment in pp_hot's
-   S_method_common:
-
-   This code tries to figure out just what went wrong with
-   gv_fetchmethod.  It therefore needs to duplicate a lot of
-   the internals of that function. ...
+GV *
+Perl_gv_fetchmethod_autoload(pTHX_ HV *stash, const char *name, I32 autoload)
+{
+    PERL_ARGS_ASSERT_GV_FETCHMETHOD_AUTOLOAD;
 
-   I'd guess that with one more flag bit that could all be moved inside
-   here.
-*/
+    return gv_fetchmethod_flags(stash, name, autoload ? GV_AUTOLOAD : 0);
+}
 
+/* Don't merge this yet, as it's likely to get a len parameter, and possibly
+   even a U32 hash */
 GV *
-Perl_gv_fetchmethod_autoload(pTHX_ HV *stash, const char *name, I32 autoload)
+Perl_gv_fetchmethod_flags(pTHX_ HV *stash, const char *name, U32 flags)
 {
     dVAR;
     register const char *nend;
@@ -621,11 +588,19 @@
     GV* gv;
     HV* ostash = stash;
     const char * const origname = name;
+    SV *const error_report = MUTABLE_SV(stash);
+    const U32 autoload = flags & GV_AUTOLOAD;
+    const U32 do_croak = flags & GV_CROAK;
 
-    PERL_ARGS_ASSERT_GV_FETCHMETHOD_AUTOLOAD;
+    PERL_ARGS_ASSERT_GV_FETCHMETHOD_FLAGS;
 
-    if (stash && SvTYPE(stash) < SVt_PVHV)
+    if (SvTYPE(stash) < SVt_PVHV)
 	stash = NULL;
+    else {
+	/* The only way stash can become NULL later on is if nsplit is set,
+	   which in turn means that there is no need for a SVt_PVHV case
+	   the error reporting code.  */
+    }
 
     for (nend = name; *nend; nend++) {
 	if (*nend == '\'') {
@@ -667,6 +642,31 @@
 	    gv = MUTABLE_GV(&PL_sv_yes);
 	else if (autoload)
 	    gv = gv_autoload4(ostash, name, nend - name, TRUE);
+	if (!gv && do_croak) {
+	    /* Right now this is exclusively for the benefit of S_method_common
+	       in pp_hot.c  */
+	    if (stash) {
+		Perl_croak(aTHX_
+			   "Can't locate object method \"%s\" via package \"%.*s\"",
+			   name, (int)HvNAMELEN_get(stash), HvNAME_get(stash));
+	    }
+	    else {
+		STRLEN packlen;
+		const char *packname;
+
+		if (nsplit) {
+		    packlen = nsplit - origname;
+		    packname = origname;
+		} else {
+		    packname = SvPV_const(error_report, packlen);
+		}
+
+		Perl_croak(aTHX_
+			   "Can't locate object method \"%s\" via package \"%.*s\""
+			   " (perhaps you forgot to load \"%.*s\"?)",
+			   name, (int)packlen, packname, (int)packlen, packname);
+	    }
+	}
     }
     else if (autoload) {
 	CV* const cv = GvCV(gv);
@@ -728,11 +728,10 @@
      * Inheriting AUTOLOAD for non-methods works ... for now.
      */
     if (!method && (GvCVGEN(gv) || GvSTASH(gv) != stash)
-	&& ckWARN2(WARN_DEPRECATED, WARN_SYNTAX)
     )
-	Perl_warner(aTHX_ packWARN2(WARN_DEPRECATED, WARN_SYNTAX),
-	  "Use of inherited AUTOLOAD for non-method %s::%.*s() is deprecated",
-	     packname, (int)len, name);
+	Perl_ck_warner_d(aTHX_ packWARN(WARN_DEPRECATED),
+			 "Use of inherited AUTOLOAD for non-method %s::%.*s() is deprecated",
+			 packname, (int)len, name);
 
     if (CvISXSUB(cv)) {
         /* rather than lookup/init $AUTOLOAD here
@@ -854,17 +853,18 @@
     char *tmpbuf;
     HV *stash;
     GV *tmpgv;
+    U32 tmplen = namelen + 2;
 
     PERL_ARGS_ASSERT_GV_STASHPVN;
 
-    if (namelen + 2 <= sizeof smallbuf)
+    if (tmplen <= sizeof smallbuf)
 	tmpbuf = smallbuf;
     else
-	Newx(tmpbuf, namelen + 2, char);
-    Copy(name,tmpbuf,namelen,char);
-    tmpbuf[namelen++] = ':';
-    tmpbuf[namelen++] = ':';
-    tmpgv = gv_fetchpvn_flags(tmpbuf, namelen, flags, SVt_PVHV);
+	Newx(tmpbuf, tmplen, char);
+    Copy(name, tmpbuf, namelen, char);
+    tmpbuf[namelen]   = ':';
+    tmpbuf[namelen+1] = ':';
+    tmpgv = gv_fetchpvn_flags(tmpbuf, tmplen, flags, SVt_PVHV);
     if (tmpbuf != smallbuf)
 	Safefree(tmpbuf);
     if (!tmpgv)
@@ -898,13 +898,13 @@
 
 
 GV *
-Perl_gv_fetchpv(pTHX_ const char *nambeg, I32 add, I32 sv_type) {
+Perl_gv_fetchpv(pTHX_ const char *nambeg, I32 add, const svtype sv_type) {
     PERL_ARGS_ASSERT_GV_FETCHPV;
     return gv_fetchpvn_flags(nambeg, strlen(nambeg), add, sv_type);
 }
 
 GV *
-Perl_gv_fetchsv(pTHX_ SV *name, I32 flags, I32 sv_type) {
+Perl_gv_fetchsv(pTHX_ SV *name, I32 flags, const svtype sv_type) {
     STRLEN len;
     const char * const nambeg = SvPV_const(name, len);
     PERL_ARGS_ASSERT_GV_FETCHSV;
@@ -913,7 +913,7 @@
 
 GV *
 Perl_gv_fetchpvn_flags(pTHX_ const char *nambeg, STRLEN full_len, I32 flags,
-		       I32 sv_type)
+		       const svtype sv_type)
 {
     dVAR;
     register const char *name = nambeg;
@@ -1060,6 +1060,7 @@
 			     (sv_type == SVt_PVAV && !GvIMPORTED_AV(*gvp)) ||
 			     (sv_type == SVt_PVHV && !GvIMPORTED_HV(*gvp)) )
 		    {
+			/* diag_listed_as: Variable "%s" is not imported%s */
 			Perl_warn(aTHX_ "Variable \"%c%s\" is not imported",
 			    sv_type == SVt_PVAV ? '@' :
 			    sv_type == SVt_PVHV ? '%' : '$',
@@ -1136,8 +1137,8 @@
 
     faking_it = SvOK(gv);
 
-    if (add & GV_ADDWARN && ckWARN_d(WARN_INTERNAL))
-	Perl_warner(aTHX_ packWARN(WARN_INTERNAL), "Had to create %s unexpectedly", nambeg);
+    if (add & GV_ADDWARN)
+	Perl_ck_warner_d(aTHX_ packWARN(WARN_INTERNAL), "Had to create %s unexpectedly", nambeg);
     gv_init(gv, stash, name, len, add & GV_ADDMULTI);
     gv_init_sv(gv, faking_it ? SVt_PVCV : sv_type);
 
@@ -1205,10 +1206,22 @@
 		if (strEQ(name2, "IG")) {
 		    HV *hv;
 		    I32 i;
-		    if (!PL_psig_ptr) {
-			Newxz(PL_psig_ptr,  SIG_SIZE, SV*);
-			Newxz(PL_psig_name, SIG_SIZE, SV*);
+		    if (!PL_psig_name) {
+			Newxz(PL_psig_name, 2 * SIG_SIZE, SV*);
 			Newxz(PL_psig_pend, SIG_SIZE, int);
+			PL_psig_ptr = PL_psig_name + SIG_SIZE;
+		    } else {
+			/* I think that the only way to get here is to re-use an
+			   embedded perl interpreter, where the previous
+			   use didn't clean up fully because
+			   PL_perl_destruct_level was 0. I'm not sure that we
+			   "support" that, in that I suspect in that scenario
+			   there are sufficient other garbage values left in the
+			   interpreter structure that something else will crash
+			   before we get here. I suspect that this is one of
+			   those "doctor, it hurts when I do this" bugs.  */
+			Zero(PL_psig_name, 2 * SIG_SIZE, SV*);
+			Zero(PL_psig_pend, SIG_SIZE, int);
 		    }
 		    GvMULTI_on(gv);
 		    hv = GvHVn(gv);
@@ -1217,9 +1230,6 @@
 			SV * const * const init = hv_fetch(hv, PL_sig_name[i], strlen(PL_sig_name[i]), 1);
 			if (init)
 			    sv_setsv(*init, &PL_sv_undef);
-			PL_psig_ptr[i] = 0;
-			PL_psig_name[i] = 0;
-			PL_psig_pend[i] = 0;
 		    }
 		}
 		break;
@@ -1286,9 +1296,9 @@
 	/* Names of length 1.  (Or 0. But name is NUL terminated, so that will
 	   be case '\0' in this switch statement (ie a default case)  */
 	switch (*name) {
-	case '&':
-	case '`':
-	case '\'':
+	case '&':		/* $& */
+	case '`':		/* $` */
+	case '\'':		/* $' */
 	    if (
 		sv_type == SVt_PVAV ||
 		sv_type == SVt_PVHV ||
@@ -1299,17 +1309,17 @@
 	    PL_sawampersand = TRUE;
 	    goto magicalize;
 
-	case ':':
+	case ':':		/* $: */
 	    sv_setpv(GvSVn(gv),PL_chopset);
 	    goto magicalize;
 
-	case '?':
+	case '?':		/* $? */
 #ifdef COMPLEX_STATUS
 	    SvUPGRADE(GvSVn(gv), SVt_PVLV);
 #endif
 	    goto magicalize;
 
-	case '!':
+	case '!':		/* $! */
 	    GvMULTI_on(gv);
 	    /* If %! has been used, automatically load Errno.pm. */
 
@@ -1320,8 +1330,8 @@
 		require_tie_mod(gv, "!", newSVpvs("Errno"), "TIEHASH", 1);
 
 	    break;
-	case '-':
-	case '+':
+	case '-':		/* $- */
+	case '+':		/* $+ */
 	GvMULTI_on(gv); /* no used once warnings here */
         {
             AV* const av = GvAVn(gv);
@@ -1338,13 +1348,13 @@
 
             break;
 	}
-	case '*':
-	case '#':
-	    if (sv_type == SVt_PV && ckWARN2_d(WARN_DEPRECATED, WARN_SYNTAX))
-		Perl_warner(aTHX_ packWARN2(WARN_DEPRECATED, WARN_SYNTAX),
-			    "$%c is no longer supported", *name);
+	case '*':		/* $* */
+	case '#':		/* $# */
+	    if (sv_type == SVt_PV)
+		Perl_ck_warner_d(aTHX_ packWARN2(WARN_DEPRECATED, WARN_SYNTAX),
+				 "$%c is no longer supported", *name);
 	    break;
-	case '|':
+	case '|':		/* $| */
 	    sv_setiv(GvSVn(gv), (IV)(IoFLAGS(GvIOp(PL_defoutgv)) & IOf_FLUSH) != 0);
 	    goto magicalize;
 
@@ -1358,28 +1368,28 @@
 	ro_magicalize:
 	    SvREADONLY_on(GvSVn(gv));
 	    /* FALL THROUGH */
-	case '1':
-	case '2':
-	case '3':
-	case '4':
-	case '5':
-	case '6':
-	case '7':
-	case '8':
-	case '9':
-	case '[':
-	case '^':
-	case '~':
-	case '=':
-	case '%':
-	case '.':
-	case '(':
-	case ')':
-	case '<':
-	case '>':
-	case ',':
-	case '\\':
-	case '/':
+	case '0':		/* $0 */
+	case '1':		/* $1 */
+	case '2':		/* $2 */
+	case '3':		/* $3 */
+	case '4':		/* $4 */
+	case '5':		/* $5 */
+	case '6':		/* $6 */
+	case '7':		/* $7 */
+	case '8':		/* $8 */
+	case '9':		/* $9 */
+	case '[':		/* $[ */
+	case '^':		/* $^ */
+	case '~':		/* $~ */
+	case '=':		/* $= */
+	case '%':		/* $% */
+	case '.':		/* $. */
+	case '(':		/* $( */
+	case ')':		/* $) */
+	case '<':		/* $< */
+	case '>':		/* $> */
+	case '\\':		/* $\ */
+	case '/':		/* $/ */
 	case '\001':	/* $^A */
 	case '\003':	/* $^C */
 	case '\004':	/* $^D */
@@ -1399,10 +1409,10 @@
 	    sv_setpvs(GvSVn(gv),"\f");
 	    PL_formfeed = GvSVn(gv);
 	    break;
-	case ';':
+	case ';':		/* $; */
 	    sv_setpvs(GvSVn(gv),"\034");
 	    break;
-	case ']':
+	case ']':		/* $] */
 	{
 	    SV * const sv = GvSVn(gv);
 	    if (!sv_derived_from(PL_patchlevel, "version"))
@@ -1465,27 +1475,6 @@
     gv_fullname4(sv, egv ? egv : gv, prefix, keepmain);
 }
 
-IO *
-Perl_newIO(pTHX)
-{
-    dVAR;
-    GV *iogv;
-    IO * const io = MUTABLE_IO(newSV_type(SVt_PVIO));
-    /* This used to read SvREFCNT(io) = 1;
-       It's not clear why the reference count needed an explicit reset. NWC
-    */
-    assert (SvREFCNT(io) == 1);
-    SvOBJECT_on(io);
-    /* Clear the stashcache because a new IO could overrule a package name */
-    hv_clear(PL_stashcache);
-    iogv = gv_fetchpvs("FileHandle::", 0, SVt_PVHV);
-    /* unless exists($main::{FileHandle}) and defined(%main::FileHandle::) */
-    if (!(iogv && GvHV(iogv) && HvARRAY(GvHV(iogv))))
-      iogv = gv_fetchpvs("IO::Handle::", GV_ADD, SVt_PVHV);
-    SvSTASH_set(io, MUTABLE_HV(SvREFCNT_inc(GvHV(iogv))));
-    return io;
-}
-
 void
 Perl_gv_check(pTHX_ const HV *stash)
 {
@@ -1570,10 +1559,9 @@
     if (!gv || !isGV_with_GP(gv) || !(gp = GvGP(gv)))
 	return;
     if (gp->gp_refcnt == 0) {
-	if (ckWARN_d(WARN_INTERNAL))
-	    Perl_warner(aTHX_ packWARN(WARN_INTERNAL),
-			"Attempt to free unreferenced glob pointers"
-                        pTHX__FORMAT pTHX__VALUE);
+	Perl_ck_warner_d(aTHX_ packWARN(WARN_INTERNAL),
+			 "Attempt to free unreferenced glob pointers"
+			 pTHX__FORMAT pTHX__VALUE);
         return;
     }
     if (--gp->gp_refcnt > 0) {
@@ -1626,9 +1614,14 @@
 }
 
 /* Updates and caches the CV's */
+/* Returns:
+ * 1 on success and there is some overload
+ * 0 if there is no overload
+ * -1 if some error occurred and it couldn't croak
+ */
 
-bool
-Perl_Gv_AMupdate(pTHX_ HV *stash)
+int
+Perl_Gv_AMupdate(pTHX_ HV *stash, bool destructing)
 {
   dVAR;
   MAGIC* const mg = mg_find((const SV *)stash, PERL_MAGIC_overload_table);
@@ -1643,7 +1636,7 @@
       const AMT * const amtp = (AMT*)mg->mg_ptr;
       if (amtp->was_ok_am == PL_amagic_generation
 	  && amtp->was_ok_sub == newgen) {
-	  return (bool)AMT_OVERLOADED(amtp);
+	  return AMT_OVERLOADED(amtp) ? 1 : 0;
       }
       sv_unmagic(MUTABLE_SV(stash), PERL_MAGIC_overload_table);
   }
@@ -1719,12 +1712,17 @@
 						       FALSE)))
 		{
 		    /* Can be an import stub (created by "can"). */
-		    const char * const name = (gvsv && SvPOK(gvsv)) ?  SvPVX_const(gvsv) : "???";
-		    Perl_croak(aTHX_ "%s method \"%.256s\" overloading \"%s\" "\
-				"in package \"%.256s\"",
-			       (GvCVGEN(gv) ? "Stub found while resolving"
-				: "Can't resolve"),
-			       name, cp, hvname);
+		    if (destructing) {
+			return -1;
+		    }
+		    else {
+			const char * const name = (gvsv && SvPOK(gvsv)) ?  SvPVX_const(gvsv) : "???";
+			Perl_croak(aTHX_ "%s method \"%.256s\" overloading \"%s\" "\
+				    "in package \"%.256s\"",
+				   (GvCVGEN(gv) ? "Stub found while resolving"
+				    : "Can't resolve"),
+				   name, cp, hvname);
+		    }
 		}
 		cv = GvCV(gv = ngv);
 	    }
@@ -1754,7 +1752,7 @@
   AMT_AMAGIC_off(&amt);
   sv_magic(MUTABLE_SV(stash), 0, PERL_MAGIC_overload_table,
 						(char*)&amt, sizeof(AMTS));
-  return FALSE;
+  return 0;
 }
 
 
@@ -1776,7 +1774,19 @@
     mg = mg_find((const SV *)stash, PERL_MAGIC_overload_table);
     if (!mg) {
       do_update:
-	Gv_AMupdate(stash);
+	/* If we're looking up a destructor to invoke, we must avoid
+	 * that Gv_AMupdate croaks, because we might be dying already */
+	if (Gv_AMupdate(stash, id == DESTROY_amg) == -1) {
+	    /* and if it didn't found a destructor, we fall back
+	     * to a simpler method that will only look for the
+	     * destructor instead of the whole magic */
+	    if (id == DESTROY_amg) {
+		GV * const gv = gv_fetchmethod(stash, "DESTROY");
+		if (gv)
+		    return GvCV(gv);
+	    }
+	    return NULL;
+	}
 	mg = mg_find((const SV *)stash, PERL_MAGIC_overload_table);
     }
     assert(mg);
@@ -1892,7 +1902,8 @@
            (void)((cv = cvp[off=bool__amg])
                   || (cv = cvp[off=numer_amg])
                   || (cv = cvp[off=string_amg]));
-           postpr = 1;
+           if (cv)
+               postpr = 1;
            break;
 	 case copy_amg:
 	   {
@@ -1952,6 +1963,8 @@
 	   break;
 	 case int_amg:
 	 case iter_amg:			/* XXXX Eventually should do to_gv. */
+	 case ftest_amg:		/* XXXX Eventually should do to_gv. */
+	 case regexp_amg:
 	     /* FAIL safe */
 	     return NULL;	/* Delegate operation to standard mechanisms. */
 	     break;
@@ -1995,35 +2008,24 @@
 	 case ge_amg:
 	 case eq_amg:
 	 case ne_amg:
-	   postpr = 1; off=ncmp_amg; break;
+             off = ncmp_amg;
+             break;
 	 case slt_amg:
 	 case sle_amg:
 	 case sgt_amg:
 	 case sge_amg:
 	 case seq_amg:
 	 case sne_amg:
-	   postpr = 1; off=scmp_amg; break;
+             off = scmp_amg;
+             break;
 	 }
-      if (off != -1) cv = cvp[off];
-      if (!cv) {
-	goto not_found;
-      }
+      if ((off != -1) && (cv = cvp[off]))
+          postpr = 1;
+      else
+          goto not_found;
     } else {
     not_found:			/* No method found, either report or croak */
       switch (method) {
-	 case lt_amg:
-	 case le_amg:
-	 case gt_amg:
-	 case ge_amg:
-	 case eq_amg:
-	 case ne_amg:
-	 case slt_amg:
-	 case sle_amg:
-	 case sgt_amg:
-	 case sge_amg:
-	 case seq_amg:
-	 case sne_amg:
-	   postpr = 0; break;
 	 case to_sv_amg:
 	 case to_av_amg:
 	 case to_hv_amg:
@@ -2200,25 +2202,6 @@
 /*
 =for apidoc is_gv_magical_sv
 
-Returns C<TRUE> if given the name of a magical GV. Calls is_gv_magical.
-
-=cut
-*/
-
-bool
-Perl_is_gv_magical_sv(pTHX_ SV *name, U32 flags)
-{
-    STRLEN len;
-    const char * const temp = SvPV_const(name, len);
-
-    PERL_ARGS_ASSERT_IS_GV_MAGICAL_SV;
-
-    return is_gv_magical(temp, len, flags);
-}
-
-/*
-=for apidoc is_gv_magical
-
 Returns C<TRUE> if given the name of a magical GV.
 
 Currently only useful internally when determining if a GV should be
@@ -2233,13 +2216,15 @@
 
 =cut
 */
+
 bool
-Perl_is_gv_magical(pTHX_ const char *name, STRLEN len, U32 flags)
+Perl_is_gv_magical_sv(pTHX_ SV *const name_sv, U32 flags)
 {
-    PERL_UNUSED_CONTEXT;
-    PERL_UNUSED_ARG(flags);
+    STRLEN len;
+    const char *const name = SvPV_const(name_sv, len);
 
-    PERL_ARGS_ASSERT_IS_GV_MAGICAL;
+    PERL_UNUSED_ARG(flags);
+    PERL_ARGS_ASSERT_IS_GV_MAGICAL_SV;
 
     if (len > 1) {
 	const char * const name1 = name + 1;
@@ -2317,7 +2302,6 @@
 	case ')':
 	case '<':
 	case '>':
-	case ',':
 	case '\\':
 	case '/':
 	case '|':
@@ -2375,6 +2359,66 @@
 
     PERL_HASH(hash, name, len);
     GvNAME_HEK(gv) = share_hek(name, len, hash);
+}
+
+/*
+=for apidoc gv_try_downgrade
+
+If the typeglob C<gv> can be expressed more succinctly, by having
+something other than a real GV in its place in the stash, replace it
+with the optimised form.  Basic requirements for this are that C<gv>
+is a real typeglob, is sufficiently ordinary, and is only referenced
+from its package.  This function is meant to be used when a GV has been
+looked up in part to see what was there, causing upgrading, but based
+on what was found it turns out that the real GV isn't required after all.
+
+If C<gv> is a completely empty typeglob, it is deleted from the stash.
+
+If C<gv> is a typeglob containing only a sufficiently-ordinary constant
+sub, the typeglob is replaced with a scalar-reference placeholder that
+more compactly represents the same thing.
+
+=cut
+*/
+
+void
+Perl_gv_try_downgrade(pTHX_ GV *gv)
+{
+    HV *stash;
+    CV *cv;
+    HEK *namehek;
+    SV **gvp;
+    PERL_ARGS_ASSERT_GV_TRY_DOWNGRADE;
+    if (!(SvREFCNT(gv) == 1 && SvTYPE(gv) == SVt_PVGV && !SvFAKE(gv) &&
+	    !SvOBJECT(gv) && !SvMAGICAL(gv) && !SvREADONLY(gv) &&
+	    isGV_with_GP(gv) && GvGP(gv) &&
+	    !GvINTRO(gv) && GvREFCNT(gv) == 1 &&
+	    !GvSV(gv) && !GvAV(gv) && !GvHV(gv) && !GvIOp(gv) && !GvFORM(gv) &&
+	    GvEGV(gv) == gv && (stash = GvSTASH(gv))))
+	return;
+    cv = GvCV(gv);
+    if (!cv) {
+	HEK *gvnhek = GvNAME_HEK(gv);
+	(void)hv_delete(stash, HEK_KEY(gvnhek),
+	    HEK_UTF8(gvnhek) ? -HEK_LEN(gvnhek) : HEK_LEN(gvnhek), G_DISCARD);
+    } else if (GvMULTI(gv) && cv &&
+	    !SvOBJECT(cv) && !SvMAGICAL(cv) && !SvREADONLY(cv) &&
+	    CvSTASH(cv) == stash && CvGV(cv) == gv &&
+	    CvCONST(cv) && !CvMETHOD(cv) && !CvLVALUE(cv) && !CvUNIQUE(cv) &&
+	    !CvNODEBUG(cv) && !CvCLONE(cv) && !CvCLONED(cv) && !CvANON(cv) &&
+	    (namehek = GvNAME_HEK(gv)) &&
+	    (gvp = hv_fetch(stash, HEK_KEY(namehek),
+			HEK_LEN(namehek)*(HEK_UTF8(namehek) ? -1 : 1), 0)) &&
+	    *gvp == (SV*)gv) {
+	SV *value = SvREFCNT_inc(CvXSUBANY(cv).any_ptr);
+	SvREFCNT(gv) = 0;
+	sv_clear((SV*)gv);
+	SvREFCNT(gv) = 1;
+	SvFLAGS(gv) = SVt_IV|SVf_ROK;
+	SvANY(gv) = (XPVGV*)((char*)&(gv->sv_u.svu_iv) -
+				STRUCT_OFFSET(XPVIV, xiv_iv));
+	SvRV_set(gv, value);
+    }
 }
 
 /*
Index: src/gnu/usr.bin/perl/gv.h
diff -u src/gnu/usr.bin/perl/gv.h:1.10 src/gnu/usr.bin/perl/gv.h:1.11
--- gv.h:1.10	Mon Oct 12 18:24:21 2009
+++ gv.h	Fri Sep 24 15:06:40 2010
@@ -49,7 +49,7 @@
 	   assert(!SvVALID(_gvname_hek));				\
 	   &(GvXPVGV(_gvname_hek)->xiv_u.xivu_namehek);			\
 	 }))
-#  define GvNAME_get(gv)	({ assert(GvNAME_HEK(gv)); HEK_KEY(GvNAME_HEK(gv)); })
+#  define GvNAME_get(gv)	({ assert(GvNAME_HEK(gv)); (char *)HEK_KEY(GvNAME_HEK(gv)); })
 #  define GvNAMELEN_get(gv)	({ assert(GvNAME_HEK(gv)); HEK_LEN(GvNAME_HEK(gv)); })
 #else
 #  define GvGP(gv)	((gv)->sv_u.svu_gp)
@@ -95,9 +95,6 @@
 #define GvFORM(gv)	(GvGP(gv)->gp_form)
 #define GvAV(gv)	(GvGP(gv)->gp_av)
 
-/* This macro is deprecated.  Do not use! */
-#define GvREFCNT_inc(gv) ((GV*)SvREFCNT_inc(gv))	/* DO NOT USE */
-
 #define GvAVn(gv)	(GvGP(gv)->gp_av ? \
 			 GvGP(gv)->gp_av : \
 			 GvGP(gv_AVadd(gv))->gp_av)
@@ -166,18 +163,10 @@
 #define GvIN_PAD_on(gv)		(GvFLAGS(gv) |= GVf_IN_PAD)
 #define GvIN_PAD_off(gv)	(GvFLAGS(gv) &= ~GVf_IN_PAD)
 
-#define GvUNIQUE(gv)            0
-#define GvUNIQUE_on(gv)         NOOP
-#define GvUNIQUE_off(gv)        NOOP
-
-#ifdef USE_ITHREADS
-#define GV_UNIQUE_CHECK
-#else
-#undef  GV_UNIQUE_CHECK
+#ifndef PERL_CORE
+#  define Nullgv Null(GV*)
 #endif
 
-#define Nullgv Null(GV*)
-
 #define DM_UID   0x003
 #define DM_RUID   0x001
 #define DM_EUID   0x002
@@ -204,6 +193,8 @@
 #define GV_NOEXPAND	0x40	/* Don't expand SvOK() entries to PVGV */
 #define GV_NOTQUAL	0x80	/* A plain symbol name, not qualified with a
 				   package (so skip checks for :: and ')  */
+#define GV_AUTOLOAD	0x100	/* gv_fetchmethod_flags() should AUTOLOAD  */
+#define GV_CROAK	0x200	/* gv_fetchmethod_flags() should croak  */
 
 /*      SVf_UTF8 (more accurately the return value from SvUTF8) is also valid
 	as a flag to gv_fetch_pvn_flags, so ensure it lies outside this range.
@@ -215,6 +206,11 @@
 #define gv_fullname3(sv,gv,prefix) gv_fullname4(sv,gv,prefix,TRUE)
 #define gv_efullname3(sv,gv,prefix) gv_efullname4(sv,gv,prefix,TRUE)
 #define gv_fetchmethod(stash, name) gv_fetchmethod_autoload(stash, name, TRUE)
+
+#define gv_AVadd(gv) gv_add_by_type((gv), SVt_PVAV)
+#define gv_HVadd(gv) gv_add_by_type((gv), SVt_PVHV)
+#define gv_IOadd(gv) gv_add_by_type((gv), SVt_PVIO)
+#define gv_SVadd(gv) gv_add_by_type((gv), SVt_NULL)
 
 /*
  * Local variables:
Index: src/gnu/usr.bin/perl/handy.h
diff -u src/gnu/usr.bin/perl/handy.h:1.12 src/gnu/usr.bin/perl/handy.h:1.13
--- handy.h:1.12	Mon Oct 12 18:24:21 2009
+++ handy.h	Fri Sep 24 15:06:40 2010
@@ -19,23 +19,25 @@
 #endif
 #endif
 
-#define Null(type) ((type)NULL)
+#ifndef PERL_CORE
+#  define Null(type) ((type)NULL)
 
 /*
 =head1 Handy Values
 
 =for apidoc AmU||Nullch
-Null character pointer.
+Null character pointer. (No longer available when C<PERL_CORE> is defined.)
 
 =for apidoc AmU||Nullsv
-Null SV pointer.
+Null SV pointer. (No longer available when C<PERL_CORE> is defined.)
 
 =cut
 */
 
-#define Nullch Null(char*)
-#define Nullfp Null(PerlIO*)
-#define Nullsv Null(SV*)
+#  define Nullch Null(char*)
+#  define Nullfp Null(PerlIO*)
+#  define Nullsv Null(SV*)
+#endif
 
 #ifdef TRUE
 #undef TRUE
@@ -55,9 +57,7 @@
  * AV *av2 = MUTABLE_AV(sv); <== GOOD: it may warn
  */
 
-/* For 5.10.x, disable the const cast checking that MUTABLE_PTR does in
- * blead */
-#if 0 && defined(__GNUC__) && !defined(PERL_GCC_BRACE_GROUPS_FORBIDDEN)
+#if defined(__GNUC__) && !defined(PERL_GCC_BRACE_GROUPS_FORBIDDEN)
 #  define MUTABLE_PTR(p) ({ void *_p = (p); _p; })
 #else
 #  define MUTABLE_PTR(p) ((void *) (p))
@@ -190,8 +190,13 @@
 #               define INT64_C(c)	CAT2(c,L)
 #               define UINT64_C(c)	CAT2(c,UL)
 #           else
-#               define INT64_C(c)	((I64TYPE)(c))
-#               define UINT64_C(c)	((U64TYPE)(c))
+#               if defined(_WIN64) && defined(_MSC_VER)
+#                   define INT64_C(c)	CAT2(c,I64)
+#                   define UINT64_C(c)	CAT2(c,UI64)
+#               else
+#                   define INT64_C(c)	((I64TYPE)(c))
+#                   define UINT64_C(c)	((U64TYPE)(c))
+#               endif
 #           endif
 #       endif
 #   endif
@@ -203,7 +208,7 @@
  * GMTIME_MAX	GMTIME_MIN	LOCALTIME_MAX	LOCALTIME_MIN
  * HAS_CTIME64	HAS_LOCALTIME64	HAS_GMTIME64	HAS_DIFFTIME64
  * HAS_MKTIME64	HAS_ASCTIME64	HAS_GETADDRINFO	HAS_GETNAMEINFO
- * HAS_INETNTOP	HAS_INETPTON
+ * HAS_INETNTOP	HAS_INETPTON	CHARBITS
  * Not (yet) used at top level, but mention them for metaconfig
  */
 
@@ -333,6 +338,8 @@
   ((SV **)Perl_hv_common(aTHX_ (hv), NULL, STR_WITH_LEN(key), 0,	\
 			 (HV_FETCH_ISSTORE|HV_FETCH_JUST_SV), (val), 0))
 
+#define get_cvs(str, flags)					\
+	Perl_get_cvn_flags(aTHX_ STR_WITH_LEN(str), (flags))
 
 /*
 =head1 Miscellaneous Functions
@@ -422,7 +429,7 @@
 alphanumeric character (including underscore) or digit.
 
 =for apidoc Am|bool|isALPHA|char ch
-Returns a boolean indicating whether the C C<char> is a US-ASCII (Basic Latin) 
+Returns a boolean indicating whether the C C<char> is a US-ASCII (Basic Latin)
 alphabetic character.
 
 =for apidoc Am|bool|isSPACE|char ch
@@ -455,6 +462,18 @@
 #define isALNUM(c)	(isALPHA(c) || isDIGIT(c) || (c) == '_')
 #define isIDFIRST(c)	(isALPHA(c) || (c) == '_')
 #define isALPHA(c)	(isUPPER(c) || isLOWER(c))
+/* ALPHAU includes Unicode semantics for latin1 characters.  It has an extra
+ * >= AA test to speed up ASCII-only tests at the expense of the others */
+#define isALPHAU(c)	(isALPHA(c) || (NATIVE_TO_UNI((U8) c) >= 0xAA \
+    && ((NATIVE_TO_UNI((U8) c) >= 0xC0 \
+	    && NATIVE_TO_UNI((U8) c) != 0xD7 && NATIVE_TO_UNI((U8) c) != 0xF7) \
+	|| NATIVE_TO_UNI((U8) c) == 0xAA \
+	|| NATIVE_TO_UNI((U8) c) == 0xB5 \
+	|| NATIVE_TO_UNI((U8) c) == 0xBA)))
+#define isALNUMU(c)	(isDIGIT(c) || isALPHAU(c) || (c) == '_')
+
+/* continuation character for legal NAME in \N{NAME} */
+#define isCHARNAME_CONT(c) (isALNUMU(c) || (c) == ' ' || (c) == '-' || (c) == '(' || (c) == ')' || (c) == ':' || NATIVE_TO_UNI((U8) c) == 0xA0)
 #define isSPACE(c) \
 	((c) == ' ' || (c) == '\t' || (c) == '\n' || (c) =='\r' || (c) == '\f')
 #define isPSXSPC(c)	(isSPACE(c) || (c) == '\v')
@@ -472,7 +491,9 @@
 #   define isPUNCT(c)	ispunct(c)
 #   define isXDIGIT(c)	isxdigit(c)
 #   define toUPPER(c)	toupper(c)
+#   define toUPPER_LATIN1_MOD(c)    UNI_TO_NATIVE(PL_mod_latin1_uc[(U8) NATIVE_TO_UNI(c)])
 #   define toLOWER(c)	tolower(c)
+#   define toLOWER_LATIN1(c)	UNI_TO_NATIVE(PL_latin1_lc[(U8) NATIVE_TO_UNI(c)])
 #else
 #   define isUPPER(c)	((c) >= 'A' && (c) <= 'Z')
 #   define isLOWER(c)	((c) >= 'a' && (c) <= 'z')
@@ -483,6 +504,15 @@
 #   define isPRINT(c)	(((c) >= 32 && (c) < 127))
 #   define isPUNCT(c)	(((c) >= 33 && (c) <= 47) || ((c) >= 58 && (c) <= 64)  || ((c) >= 91 && (c) <= 96) || ((c) >= 123 && (c) <= 126))
 #   define isXDIGIT(c)  (isDIGIT(c) || ((c) >= 'a' && (c) <= 'f') || ((c) >= 'A' && (c) <= 'F'))
+
+/* Use table lookup for speed */
+#   define toLOWER_LATIN1(c)	(PL_latin1_lc[(U8) c])
+
+/* Modified uc.  Is correct uc except for three non-ascii chars which are
+ * all mapped to one of them, and these need special handling */
+#   define toUPPER_LATIN1_MOD(c)    (PL_mod_latin1_uc[(U8) c])
+
+/* ASCII casing. */
 #   define toUPPER(c)	(isLOWER(c) ? (c) - ('a' - 'A') : (c))
 #   define toLOWER(c)	(isUPPER(c) ? (c) + ('a' - 'A') : (c))
 #endif
@@ -555,7 +585,6 @@
 #define isDIGIT_uni(c)		is_uni_digit(c)
 #define isUPPER_uni(c)		is_uni_upper(c)
 #define isLOWER_uni(c)		is_uni_lower(c)
-#define isALNUMC_uni(c)		is_uni_alnumc(c)
 #define isASCII_uni(c)		is_uni_ascii(c)
 #define isCNTRL_uni(c)		is_uni_cntrl(c)
 #define isGRAPH_uni(c)		is_uni_graph(c)
@@ -577,7 +606,6 @@
 #define isDIGIT_LC_uvchr(c)	(c < 256 ? isDIGIT_LC(c) : is_uni_digit_lc(c))
 #define isUPPER_LC_uvchr(c)	(c < 256 ? isUPPER_LC(c) : is_uni_upper_lc(c))
 #define isLOWER_LC_uvchr(c)	(c < 256 ? isLOWER_LC(c) : is_uni_lower_lc(c))
-#define isALNUMC_LC_uvchr(c)	(c < 256 ? isALNUMC_LC(c) : is_uni_alnumc_lc(c))
 #define isCNTRL_LC_uvchr(c)	(c < 256 ? isCNTRL_LC(c) : is_uni_cntrl_lc(c))
 #define isGRAPH_LC_uvchr(c)	(c < 256 ? isGRAPH_LC(c) : is_uni_graph_lc(c))
 #define isPRINT_LC_uvchr(c)	(c < 256 ? isPRINT_LC(c) : is_uni_print_lc(c))
@@ -596,7 +624,6 @@
 #define isDIGIT_utf8(p)		is_utf8_digit(p)
 #define isUPPER_utf8(p)		is_utf8_upper(p)
 #define isLOWER_utf8(p)		is_utf8_lower(p)
-#define isALNUMC_utf8(p)	is_utf8_alnumc(p)
 #define isASCII_utf8(p)		is_utf8_ascii(p)
 #define isCNTRL_utf8(p)		is_utf8_cntrl(p)
 #define isGRAPH_utf8(p)		is_utf8_graph(p)
@@ -641,6 +668,18 @@
 typedef U32 line_t;
 #define NOLINE ((line_t) 4294967295UL)
 
+/* Helpful alias for version prescan */
+#define is_LAX_VERSION(a,b) \
+	(a != Perl_prescan_version(aTHX_ a, FALSE, b, NULL, NULL, NULL, NULL))
+
+#define is_STRICT_VERSION(a,b) \
+	(a != Perl_prescan_version(aTHX_ a, TRUE, b, NULL, NULL, NULL, NULL))
+
+#define BADVERSION(a,b,c) \
+	if (b) { \
+	    *b = c; \
+	} \
+	return a;
 
 /*
 =head1 Memory Management
@@ -759,12 +798,12 @@
  * which more importantly get the immediate calling environment (file and
  * line number, and C function name if available) passed in.  This info can
  * then be used for logging the calls, for which one gets a sample
- * implementation if PERL_MEM_LOG_STDERR is defined.
+ * implementation unless -DPERL_MEM_LOG_NOIMPL is also defined.
  *
  * Known problems:
- * - all memory allocs do not get logged, only those
+ * - not all memory allocs get logged, only those
  *   that go through Newx() and derivatives (while all
- *  Safefrees do get logged)
+ *   Safefrees do get logged)
  * - __FILE__ and __LINE__ do not work everywhere
  * - __func__ or __FUNCTION__ even less so
  * - I think more goes on after the perlio frees but
@@ -781,6 +820,8 @@
  *   (keyed by the allocation address?), and maintain that
  *   through reallocs and frees, but how to do that without
  *   any News() happening...?
+ * - lots of -Ddefines to get useful/controllable output
+ * - lots of ENV reads
  */
 
 PERL_EXPORT_C Malloc_t Perl_mem_log_alloc(const UV n, const UV typesize, const char *type_name, Malloc_t newalloc, const char *filename, const int linenumber, const char *funcname);
@@ -790,7 +831,7 @@
 PERL_EXPORT_C Malloc_t Perl_mem_log_free(Malloc_t oldalloc, const char *filename, const int linenumber, const char *funcname);
 
 # ifdef PERL_CORE
-#  ifdef PERL_MEM_LOG_STDERR
+#  ifndef PERL_MEM_LOG_NOIMPL
 enum mem_log_type {
   MLT_ALLOC,
   MLT_REALLOC,
@@ -900,6 +941,13 @@
 #define pTHX__VALUE_
 #define pTHX__VALUE
 #endif /* USE_ITHREADS */
+
+/* Perl_deprecate was not part of the public API, and did not have a deprecate()
+   shortcut macro defined without -DPERL_CORE. Neither codesearch.google.com nor
+   CPAN::Unpack show any users outside the core.  */
+#ifdef PERL_CORE
+#  define deprecate(s) Perl_ck_warner_d(aTHX_ packWARN(WARN_DEPRECATED), "Use of " s " is deprecated")
+#endif
 
 /*
  * Local variables:
Index: src/gnu/usr.bin/perl/hv.c
diff -u src/gnu/usr.bin/perl/hv.c:1.13 src/gnu/usr.bin/perl/hv.c:1.14
--- hv.c:1.13	Mon Oct 12 18:24:21 2009
+++ hv.c	Fri Sep 24 15:06:40 2010
@@ -1346,6 +1346,7 @@
 HV *
 Perl_newHVhv(pTHX_ HV *ohv)
 {
+    dVAR;
     HV * const hv = newHV();
     STRLEN hv_max, hv_fill;
 
@@ -1379,8 +1380,9 @@
 		const STRLEN len = HeKLEN(oent);
 		const int flags  = HeKFLAGS(oent);
 		HE * const ent   = new_HE();
+		SV *const val    = HeVAL(oent);
 
-		HeVAL(ent)     = newSVsv(HeVAL(oent));
+		HeVAL(ent) = SvIMMORTAL(val) ? val : newSVsv(val);
 		HeKEY_hek(ent)
                     = shared ? share_hek_flags(key, len, hash, flags)
                              :  save_hek_flags(key, len, hash, flags);
@@ -1411,9 +1413,10 @@
 
 	hv_iterinit(ohv);
 	while ((entry = hv_iternext_flags(ohv, 0))) {
+	    SV *const val = HeVAL(entry);
 	    (void)hv_store_flags(hv, HeKEY(entry), HeKLEN(entry),
-			         newSVsv(HeVAL(entry)), HeHASH(entry),
-			         HeKFLAGS(entry));
+			         SvIMMORTAL(val) ? val : newSVsv(val),
+				 HeHASH(entry), HeKFLAGS(entry));
 	}
 	HvRITER_set(ohv, riter);
 	HvEITER_set(ohv, eiter);
@@ -1468,8 +1471,8 @@
     if (!entry)
 	return;
     val = HeVAL(entry);
-    if (val && isGV(val) && isGV_with_GP(val) && GvCVu(val) && HvNAME_get(hv))
-        mro_method_changed_in(hv);	/* deletion of method from stash */
+    if (HvNAME(hv) && anonymise_cv(HvNAME_HEK(hv), val) && GvCVu(val))
+	mro_method_changed_in(hv);
     SvREFCNT_dec(val);
     if (HeKLEN(entry) == HEf_SVKEY) {
 	SvREFCNT_dec(HeKEY_sv(entry));
@@ -1482,6 +1485,34 @@
     del_HE(entry);
 }
 
+static I32
+S_anonymise_cv(pTHX_ HEK *stash, SV *val)
+{
+    CV *cv;
+
+    PERL_ARGS_ASSERT_ANONYMISE_CV;
+
+    if (val && isGV(val) && isGV_with_GP(val) && (cv = GvCV(val))) {
+	if ((SV *)CvGV(cv) == val) {
+	    GV *anongv;
+
+	    if (stash) {
+		SV *gvname = newSVhek(stash);
+		sv_catpvs(gvname, "::__ANON__");
+		anongv = gv_fetchsv(gvname, GV_ADDMULTI, SVt_PVCV);
+		SvREFCNT_dec(gvname);
+	    } else {
+		anongv = gv_fetchpvs("__ANON__::__ANON__", GV_ADDMULTI,
+				     SVt_PVCV);
+	    }
+	    CvGV(cv) = anongv;
+	    CvANON_on(cv);
+	    return 1;
+	}
+    }
+    return 0;
+}
+
 void
 Perl_hv_delayfree_ent(pTHX_ HV *hv, register HE *entry)
 {
@@ -1646,6 +1677,22 @@
     if (!orig_array)
 	return;
 
+    if (HvNAME(hv) && orig_array != NULL) {
+	/* symbol table: make all the contained subs ANON */
+	STRLEN i;
+	XPVHV *xhv = (XPVHV*)SvANY(hv);
+
+	for (i = 0; i <= xhv->xhv_max; i++) {
+	    HE *entry = (HvARRAY(hv))[i];
+	    for (; entry; entry = HeNEXT(entry)) {
+		SV *val = HeVAL(entry);
+		/* we need to put the subs in the __ANON__ symtable, as
+		 * this one is being cleared. */
+		anonymise_cv(NULL, val);
+	    }
+	}
+    }
+
     if (SvOOK(hv)) {
 	/* If the hash is actually a symbol table with a name, look after the
 	   name.  */
@@ -1709,16 +1756,16 @@
 	    iter->xhv_eiter = NULL;	/* HvEITER(hv) = NULL */
 
             if((meta = iter->xhv_mro_meta)) {
-		if (meta->mro_linear_dfs) {
-		    SvREFCNT_dec(MUTABLE_SV(meta->mro_linear_dfs));
-		    meta->mro_linear_dfs = NULL;
+		if (meta->mro_linear_all) {
+		    SvREFCNT_dec(MUTABLE_SV(meta->mro_linear_all));
+		    meta->mro_linear_all = NULL;
 		    /* This is just acting as a shortcut pointer.  */
-		    meta->mro_linear_c3 = NULL;
-		} else if (meta->mro_linear_c3) {
+		    meta->mro_linear_current = NULL;
+		} else if (meta->mro_linear_current) {
 		    /* Only the current MRO is stored, so this owns the data.
 		     */
-		    SvREFCNT_dec(MUTABLE_SV(meta->mro_linear_c3));
-		    meta->mro_linear_c3 = NULL;
+		    SvREFCNT_dec(meta->mro_linear_current);
+		    meta->mro_linear_current = NULL;
 		}
                 if(meta->mro_nextmethod) SvREFCNT_dec(meta->mro_nextmethod);
                 SvREFCNT_dec(meta->isa);
@@ -2103,8 +2150,7 @@
                 HeSVKEY_set(entry, SvREFCNT_inc_simple_NN(key));
                 return entry;               /* beware, hent_val is not set */
             }
-            if (HeVAL(entry))
-                SvREFCNT_dec(HeVAL(entry));
+            SvREFCNT_dec(HeVAL(entry));
             Safefree(HeKEY_hek(entry));
             del_HE(entry);
             iter->xhv_eiter = NULL; /* HvEITER(hv) = NULL */
@@ -2143,26 +2189,31 @@
             }
 	}
     }
-    while (!entry) {
-	/* OK. Come to the end of the current list.  Grab the next one.  */
 
-	iter->xhv_riter++; /* HvRITER(hv)++ */
-	if (iter->xhv_riter > (I32)xhv->xhv_max /* HvRITER(hv) > HvMAX(hv) */) {
-	    /* There is no next one.  End of the hash.  */
-	    iter->xhv_riter = -1; /* HvRITER(hv) = -1 */
-	    break;
-	}
-	entry = (HvARRAY(hv))[iter->xhv_riter];
+    /* Skip the entire loop if the hash is empty.   */
+    if ((flags & HV_ITERNEXT_WANTPLACEHOLDERS)
+	? HvTOTALKEYS(hv) : HvUSEDKEYS(hv)) {
+	while (!entry) {
+	    /* OK. Come to the end of the current list.  Grab the next one.  */
+
+	    iter->xhv_riter++; /* HvRITER(hv)++ */
+	    if (iter->xhv_riter > (I32)xhv->xhv_max /* HvRITER(hv) > HvMAX(hv) */) {
+		/* There is no next one.  End of the hash.  */
+		iter->xhv_riter = -1; /* HvRITER(hv) = -1 */
+		break;
+	    }
+	    entry = (HvARRAY(hv))[iter->xhv_riter];
 
-        if (!(flags & HV_ITERNEXT_WANTPLACEHOLDERS)) {
-            /* If we have an entry, but it's a placeholder, don't count it.
-	       Try the next.  */
-	    while (entry && HeVAL(entry) == &PL_sv_placeholder)
-		entry = HeNEXT(entry);
+	    if (!(flags & HV_ITERNEXT_WANTPLACEHOLDERS)) {
+		/* If we have an entry, but it's a placeholder, don't count it.
+		   Try the next.  */
+		while (entry && HeVAL(entry) == &PL_sv_placeholder)
+		    entry = HeNEXT(entry);
+	    }
+	    /* Will loop again if this linked list starts NULL
+	       (for HV_ITERNEXT_WANTPLACEHOLDERS)
+	       or if we run through it and find only placeholders.  */
 	}
-	/* Will loop again if this linked list starts NULL
-	   (for HV_ITERNEXT_WANTPLACEHOLDERS)
-	   or if we run through it and find only placeholders.  */
     }
 
     if (oldentry && HvLAZYDEL(hv)) {		/* was deleted earlier? */
@@ -2326,13 +2377,10 @@
 	   shared hek  */
 	assert (he->shared_he_he.hent_hek == hek);
 
-	LOCK_STRTAB_MUTEX;
 	if (he->shared_he_he.he_valu.hent_refcount - 1) {
 	    --he->shared_he_he.he_valu.hent_refcount;
-	    UNLOCK_STRTAB_MUTEX;
 	    return;
 	}
-	UNLOCK_STRTAB_MUTEX;
 
         hash = HEK_HASH(hek);
     } else if (len < 0) {
@@ -2354,7 +2402,6 @@
     } */
     xhv = (XPVHV*)SvANY(PL_strtab);
     /* assert(xhv_array != 0) */
-    LOCK_STRTAB_MUTEX;
     first = oentry = &(HvARRAY(PL_strtab))[hash & (I32) HvMAX(PL_strtab)];
     if (he) {
 	const HE *const he_he = &(he->shared_he_he);
@@ -2389,13 +2436,12 @@
         }
     }
 
-    UNLOCK_STRTAB_MUTEX;
-    if (!entry && ckWARN_d(WARN_INTERNAL))
-	Perl_warner(aTHX_ packWARN(WARN_INTERNAL),
-                    "Attempt to free non-existent shared string '%s'%s"
-                    pTHX__FORMAT,
-                    hek ? HEK_KEY(hek) : str,
-                    ((k_flags & HVhek_UTF8) ? " (utf8)" : "") pTHX__VALUE);
+    if (!entry)
+	Perl_ck_warner_d(aTHX_ packWARN(WARN_INTERNAL),
+			 "Attempt to free non-existent shared string '%s'%s"
+			 pTHX__FORMAT,
+			 hek ? HEK_KEY(hek) : str,
+			 ((k_flags & HVhek_UTF8) ? " (utf8)" : "") pTHX__VALUE);
     if (k_flags & HVhek_FREEKEY)
 	Safefree(str);
 }
@@ -2454,7 +2500,6 @@
     */
 
     /* assert(xhv_array != 0) */
-    LOCK_STRTAB_MUTEX;
     entry = (HvARRAY(PL_strtab))[hindex];
     for (;entry; entry = HeNEXT(entry)) {
 	if (HeHASH(entry) != hash)		/* strings can't be equal */
@@ -2512,7 +2557,6 @@
     }
 
     ++entry->he_valu.hent_refcount;
-    UNLOCK_STRTAB_MUTEX;
 
     if (flags & HVhek_FREEKEY)
 	Safefree(str);
@@ -2540,10 +2584,10 @@
 
 
 I32
-Perl_hv_placeholders_get(pTHX_ HV *hv)
+Perl_hv_placeholders_get(pTHX_ const HV *hv)
 {
     dVAR;
-    MAGIC * const mg = mg_find((SV*)hv, PERL_MAGIC_rhash);
+    MAGIC * const mg = mg_find((const SV *)hv, PERL_MAGIC_rhash);
 
     PERL_ARGS_ASSERT_HV_PLACEHOLDERS_GET;
 
@@ -2791,21 +2835,18 @@
 Perl_refcounted_he_new(pTHX_ struct refcounted_he *const parent,
 		       SV *const key, SV *const value) {
     dVAR;
-    struct refcounted_he *he;
     STRLEN key_len;
     const char *key_p = SvPV_const(key, key_len);
     STRLEN value_len = 0;
     const char *value_p = NULL;
     char value_type;
     char flags;
-    STRLEN key_offset;
-    U32 hash;
     bool is_utf8 = SvUTF8(key) ? TRUE : FALSE;
 
     if (SvPOK(value)) {
 	value_type = HVrhek_PV;
     } else if (SvIOK(value)) {
-	value_type = HVrhek_IV;
+	value_type = SvUOK((const SV *)value) ? HVrhek_UV : HVrhek_IV;
     } else if (value == &PL_sv_placeholder) {
 	value_type = HVrhek_delete;
     } else if (!SvOK(value)) {
@@ -2815,12 +2856,41 @@
     }
 
     if (value_type == HVrhek_PV) {
+	/* Do it this way so that the SvUTF8() test is after the SvPV, in case
+	   the value is overloaded, and doesn't yet have the UTF-8flag set.  */
 	value_p = SvPV_const(value, value_len);
-	key_offset = value_len + 2;
-    } else {
-	value_len = 0;
-	key_offset = 1;
+	if (SvUTF8(value))
+	    value_type = HVrhek_PV_UTF8;
     }
+    flags = value_type;
+
+    if (is_utf8) {
+	/* Hash keys are always stored normalised to (yes) ISO-8859-1.
+	   As we're going to be building hash keys from this value in future,
+	   normalise it now.  */
+	key_p = (char*)bytes_from_utf8((const U8*)key_p, &key_len, &is_utf8);
+	flags |= is_utf8 ? HVhek_UTF8 : HVhek_WASUTF8;
+    }
+
+    return refcounted_he_new_common(parent, key_p, key_len, flags, value_type,
+				    ((value_type == HVrhek_PV
+				      || value_type == HVrhek_PV_UTF8) ?
+				     (void *)value_p : (void *)value),
+				    value_len);
+}
+
+static struct refcounted_he *
+S_refcounted_he_new_common(pTHX_ struct refcounted_he *const parent,
+			   const char *const key_p, const STRLEN key_len,
+			   const char flags, char value_type,
+			   const void *value, const STRLEN value_len) {
+    dVAR;
+    struct refcounted_he *he;
+    U32 hash;
+    const bool is_pv = value_type == HVrhek_PV || value_type == HVrhek_PV_UTF8;
+    STRLEN key_offset = is_pv ? value_len + 2 : 1;
+
+    PERL_ARGS_ASSERT_REFCOUNTED_HE_NEW_COMMON;
 
 #ifdef USE_ITHREADS
     he = (struct refcounted_he*)
@@ -2833,33 +2903,17 @@
 			     + key_offset);
 #endif
 
-
     he->refcounted_he_next = parent;
 
-    if (value_type == HVrhek_PV) {
-	Copy(value_p, he->refcounted_he_data + 1, value_len + 1, char);
+    if (is_pv) {
+	Copy((char *)value, he->refcounted_he_data + 1, value_len + 1, char);
 	he->refcounted_he_val.refcounted_he_u_len = value_len;
-	/* Do it this way so that the SvUTF8() test is after the SvPV, in case
-	   the value is overloaded, and doesn't yet have the UTF-8flag set.  */
-	if (SvUTF8(value))
-	    value_type = HVrhek_PV_UTF8;
     } else if (value_type == HVrhek_IV) {
-	if (SvUOK(value)) {
-	    he->refcounted_he_val.refcounted_he_u_uv = SvUVX(value);
-	    value_type = HVrhek_UV;
-	} else {
-	    he->refcounted_he_val.refcounted_he_u_iv = SvIVX(value);
-	}
+	he->refcounted_he_val.refcounted_he_u_iv = SvIVX((const SV *)value);
+    } else if (value_type == HVrhek_UV) {
+	he->refcounted_he_val.refcounted_he_u_uv = SvUVX((const SV *)value);
     }
-    flags = value_type;
 
-    if (is_utf8) {
-	/* Hash keys are always stored normalised to (yes) ISO-8859-1.
-	   As we're going to be building hash keys from this value in future,
-	   normalise it now.  */
-	key_p = (char*)bytes_from_utf8((const U8*)key_p, &key_len, &is_utf8);
-	flags |= is_utf8 ? HVhek_UTF8 : HVhek_WASUTF8;
-    }
     PERL_HASH(hash, key_p, key_len);
 
 #ifdef USE_ITHREADS
@@ -2916,6 +2970,51 @@
 	he = he->refcounted_he_next;
 	PerlMemShared_free(copy);
     }
+}
+
+/* pp_entereval is aware that labels are stored with a key ':' at the top of
+   the linked list.  */
+const char *
+Perl_fetch_cop_label(pTHX_ struct refcounted_he *const chain, STRLEN *len,
+		     U32 *flags) {
+    if (!chain)
+	return NULL;
+#ifdef USE_ITHREADS
+    if (chain->refcounted_he_keylen != 1)
+	return NULL;
+    if (*REF_HE_KEY(chain) != ':')
+	return NULL;
+#else
+    if ((STRLEN)HEK_LEN(chain->refcounted_he_hek) != 1)
+	return NULL;
+    if (*HEK_KEY(chain->refcounted_he_hek) != ':')
+	return NULL;
+#endif
+    /* Stop anyone trying to really mess us up by adding their own value for
+       ':' into %^H  */
+    if ((chain->refcounted_he_data[0] & HVrhek_typemask) != HVrhek_PV
+	&& (chain->refcounted_he_data[0] & HVrhek_typemask) != HVrhek_PV_UTF8)
+	return NULL;
+
+    if (len)
+	*len = chain->refcounted_he_val.refcounted_he_u_len;
+    if (flags) {
+	*flags = ((chain->refcounted_he_data[0] & HVrhek_typemask)
+		  == HVrhek_PV_UTF8) ? SVf_UTF8 : 0;
+    }
+    return chain->refcounted_he_data + 1;
+}
+
+/* As newSTATEOP currently gets passed plain char* labels, we will only provide
+   that interface. Once it works out how to pass in length and UTF-8 ness, this
+   function will need superseding.  */
+struct refcounted_he *
+Perl_store_cop_label(pTHX_ struct refcounted_he *const chain, const char *label)
+{
+    PERL_ARGS_ASSERT_STORE_COP_LABEL;
+
+    return refcounted_he_new_common(chain, ":", 1, HVrhek_PV, HVrhek_PV,
+				    label, strlen(label));
 }
 
 /*
Index: src/gnu/usr.bin/perl/hv.h
diff -u src/gnu/usr.bin/perl/hv.h:1.10 src/gnu/usr.bin/perl/hv.h:1.11
--- hv.h:1.10	Mon Oct 12 18:24:21 2009
+++ hv.h	Fri Sep 24 15:06:40 2010
@@ -50,10 +50,12 @@
 };
 
 struct mro_meta {
-    /* repurposed as a hash holding the different MROs private data. */
-    AV      *mro_linear_dfs; /* cached dfs @ISA linearization */
-    /* repurposed as a pointer directly to the current MROs private data.  */
-    AV      *mro_linear_c3;  /* cached c3 @ISA linearization */
+    /* a hash holding the different MROs private data.  */
+    HV      *mro_linear_all;
+    /* a pointer directly to the current MROs private data.  If mro_linear_all
+       is NULL, this owns the SV reference, else it is just a pointer to a
+       value stored in and owned by mro_linear_all.  */
+    SV      *mro_linear_current;
     HV      *mro_nextmethod; /* next::method caching */
     U32     cache_gen;       /* Bumping this invalidates our method cache */
     U32     pkg_gen;         /* Bumps when local methods/@ISA change */
@@ -63,7 +65,7 @@
 
 #define MRO_GET_PRIVATE_DATA(smeta, which)		   \
     (((smeta)->mro_which && (which) == (smeta)->mro_which) \
-     ? MUTABLE_SV((smeta)->mro_linear_c3)		   \
+     ? (smeta)->mro_linear_current			   \
      : Perl_mro_get_private_data(aTHX_ (smeta), (which)))
 
 /* Subject to change.
@@ -81,54 +83,14 @@
 /* hash structure: */
 /* This structure must match the beginning of struct xpvmg in sv.h. */
 struct xpvhv {
-    union {
-	NV	xnv_nv;		/* numeric value, if any */
-	HV *	xgv_stash;
-	struct {
-	    U32	xlow;
-	    U32	xhigh;
-	}	xpad_cop_seq;	/* used by pad.c for cop_sequence */
-	struct {
-	    U32 xbm_previous;	/* how many characters in string before rare? */
-	    U8	xbm_flags;
-	    U8	xbm_rare;	/* rarest character in string */
-	}	xbm_s;		/* fields from PVBM */
-    }		xnv_u;
-    STRLEN	xhv_fill;	/* how full xhv_array currently is */
-    STRLEN	xhv_max;	/* subscript of last element of xhv_array */
-    union {
-	IV	xivu_iv;	/* integer value or pv offset */
-	UV	xivu_uv;
-	void *	xivu_p1;
-	I32	xivu_i32;
-	HEK *	xivu_namehek;
-    }		xiv_u;
-    union {
-	MAGIC*	xmg_magic;	/* linked list of magicalness */
-	HV*	xmg_ourstash;	/* Stash for our (when SvPAD_OUR is true) */
-    } xmg_u;
-    HV*		xmg_stash;	/* class package */
+    union _xnvu xnv_u;
+    STRLEN      xhv_fill;       /* how full xhv_array currently is */
+    STRLEN      xhv_max;        /* subscript of last element of xhv_array */
+    _XPVMG_HEAD;
 };
 
 #define xhv_keys xiv_u.xivu_iv
 
-typedef struct {
-    STRLEN	xhv_fill;	/* how full xhv_array currently is */
-    STRLEN	xhv_max;	/* subscript of last element of xhv_array */
-    union {
-	IV	xivu_iv;	/* integer value or pv offset */
-	UV	xivu_uv;
-	void *	xivu_p1;
-	I32	xivu_i32;
-	HEK *	xivu_namehek;
-    }		xiv_u;
-    union {
-	MAGIC*	xmg_magic;	/* linked list of magicalness */
-	HV*	xmg_ourstash;	/* Stash for our (when SvPAD_OUR is true) */
-    } xmg_u;
-    HV*		xmg_stash;	/* class package */
-} xpvhv_allocated;
-
 /* hash a key */
 /* FYI: This is the "One-at-a-Time" algorithm by Bob Jenkins
  * from requirements by Colin Plumb.
@@ -203,6 +165,8 @@
 =for apidoc AmU||Nullhv
 Null HV pointer.
 
+(deprecated - use C<(HV *)NULL> instead)
+
 =head1 Hash Manipulation Functions
 
 =for apidoc Am|char*|HvNAME|HV* stash
@@ -242,7 +206,7 @@
 new SV, you should consider using C<newSVhek(HeKEY_hek(he))> as it is more
 efficient.
 
-=for apidoc Am|char*|HeUTF8|HE* he|STRLEN len
+=for apidoc Am|char*|HeUTF8|HE* he
 Returns whether the C<char *> value returned by C<HePV> is encoded in UTF-8,
 doing any necessary dereferencing of possibly C<SV*> keys.  The value returned
 will be 0 or non-0, not necessarily 1 (or even a value with any low bits set),
@@ -268,8 +232,9 @@
 /* these hash entry flags ride on hent_klen (for use only in magic/tied HVs) */
 #define HEf_SVKEY	-2	/* hent_key is an SV* */
 
-
-#define Nullhv Null(HV*)
+#ifndef PERL_CORE
+#  define Nullhv Null(HV*)
+#endif
 #define HvARRAY(hv)	((hv)->sv_u.svu_hash)
 #define HvFILL(hv)	((XPVHV*)  SvANY(hv))->xhv_fill
 #define HvMAX(hv)	((XPVHV*)  SvANY(hv))->xhv_max
@@ -311,7 +276,7 @@
 #define HvUSEDKEYS(hv)		(HvTOTALKEYS(hv) - HvPLACEHOLDERS_get(hv))
 #define HvTOTALKEYS(hv)		XHvTOTALKEYS((XPVHV*)  SvANY(hv))
 #define HvPLACEHOLDERS(hv)	(*Perl_hv_placeholders_p(aTHX_ MUTABLE_HV(hv)))
-#define HvPLACEHOLDERS_get(hv)	(SvMAGIC(hv) ? Perl_hv_placeholders_get(aTHX_ (HV *)hv) : 0)
+#define HvPLACEHOLDERS_get(hv)	(SvMAGIC(hv) ? Perl_hv_placeholders_get(aTHX_ (const HV *)hv) : 0)
 #define HvPLACEHOLDERS_set(hv,p)	Perl_hv_placeholders_set(aTHX_ MUTABLE_HV(hv), p)
 
 #define HvSHAREKEYS(hv)		(SvFLAGS(hv) & SVphv_SHAREKEYS)
@@ -338,7 +303,9 @@
 #define HvREHASH_on(hv)		(SvFLAGS(hv) |= SVphv_REHASH)
 #define HvREHASH_off(hv)	(SvFLAGS(hv) &= ~SVphv_REHASH)
 
-#define Nullhe Null(HE*)
+#ifndef PERL_CORE
+#  define Nullhe Null(HE*)
+#endif
 #define HeNEXT(he)		(he)->hent_next
 #define HeKEY_hek(he)		(he)->hent_hek
 #define HeKEY(he)		HEK_KEY(HeKEY_hek(he))
@@ -370,7 +337,9 @@
 				 &PL_sv_undef)
 #define HeSVKEY_set(he,sv)	((HeKLEN(he) = HEf_SVKEY), (HeKEY_sv(he) = sv))
 
-#define Nullhek Null(HEK*)
+#ifndef PERL_CORE
+#  define Nullhek Null(HEK*)
+#endif
 #define HEK_BASESIZE		STRUCT_OFFSET(HEK, hek_key[0])
 #define HEK_HASH(hek)		(hek)->hek_hash
 #define HEK_LEN(hek)		(hek)->hek_len
Index: src/gnu/usr.bin/perl/installperl
diff -u src/gnu/usr.bin/perl/installperl:1.25 src/gnu/usr.bin/perl/installperl:1.26
--- installperl:1.25	Wed Oct 14 19:08:07 2009
+++ installperl	Fri Sep 24 15:06:40 2010
@@ -156,30 +156,33 @@
 # Exclude nonxs extensions that are not architecture dependent
 my @nonxs = grep(!/^(Errno|IO\/Compress)$/, split(' ', $Config{'nonxs_ext'}));
 
-find(sub {
-    if (($File::Find::name =~ m{^ext\b(.*)/([^/]+)\.pm$}) &&
-        ! grep { (my $dir = $_) =~ s/\//-/g;
-                 $File::Find::name =~ /^ext\/$dir/ } @nonxs)
-    {
-	my($path, $modname) = ($1,$2);
-
-	# Change hypenated name like Filter-Util-Call to nested
-	# directory name Filter/Util/Call
-	$path =~ s{-}{/}g;
-
-	# strip to optional "/lib", or remove trailing component
-	$path =~ s{.*/lib\b}{} or $path =~ s{/[^/]*$}{};
-
-	# strip any leading /
-	$path =~ s{^/}{};
+my @ext_dirs = qw(cpan dist ext);
+foreach my $ext_dir (@ext_dirs) {
+    find(sub {
+	if (($File::Find::name =~ m{^$ext_dir\b(.*)/([^/]+)\.pm$}) &&
+	    ! grep { (my $dir = $_) =~ s/\//-/g;
+		     $File::Find::name =~ /^$ext_dir\/$dir\// } @nonxs)
+	{
+	    my($path, $modname) = ($1,$2);
+
+	    # Change hypenated name like Filter-Util-Call to nested
+	    # directory name Filter/Util/Call
+	    $path =~ s{-}{/}g;
+
+	    # strip to optional "/lib", or remove trailing component
+	    $path =~ s{.*/lib\b}{} or $path =~ s{/[^/]*$}{};
 
-	# reconstitute canonical module name
-	$modname = "$path/$modname" if length $path;
+	    # strip any leading /
+	    $path =~ s{^/}{};
 
-	# remember it
-	$archpms{$modname} = 1;
-    }
-}, 'ext');
+	    # reconstitute canonical module name
+	    $modname = "$path/$modname" if length $path;
+
+	    # remember it
+	    $archpms{$modname} = 1;
+	}
+    }, $ext_dir);
+}
 
 # print "[$_]\n" for sort keys %archpms;
 
@@ -222,7 +225,6 @@
     $installsitelib = $Config{installnwlib};
 }
 
-my $d_dosuid = $Config{d_dosuid};
 my $binexp = $Config{binexp};
 
 if ($Is_VMS) {  # Hang in there until File::Spec hits the big time
@@ -235,8 +237,6 @@
 
 # Do some quick sanity checks.
 
-if (!$opts{notify} && $d_dosuid && $>) { die "You must run as root to install suidperl\n"; }
-
    $installbin		|| die "No installbin directory in config.sh\n";
 -d $installbin		|| mkpath($installbin, $opts{verbose}, 0777);
 -d $installbin		|| $opts{notify} || die "$installbin is not a directory\n";
@@ -253,7 +253,6 @@
         -x $dbg . 'perl' . $exe_ext	|| die "${dbg}perl$exe_ext isn't executable!\n";
     }
 }
--x 'suidperl' . $exe_ext|| die "suidperl isn't executable!\n" if $d_dosuid;
 
 #-f 't/rantests'		|| $Is_W32
 #			|| warn "WARNING: You've never run 'make test' or",
@@ -343,12 +342,6 @@
     copy("perl.exe", "$installbin/$perl.exe");
 }
 
-safe_unlink("$installbin/s$perl_verbase$ver$exe_ext");
-if ($d_dosuid) {
-    install("perl$exe_ext", "$installbin/s$perl_verbase$ver$exe_ext",
-	"04711", $dostrip);
-}
-
 # Install library files.
 
 my ($do_installarchlib, $do_installprivlib) = (0, 0);
@@ -446,9 +439,6 @@
 	link("$installbin/$perl_verbase$ver$exe_ext",
 		"$installbin/$perl$exe_ext");
     }
-    link("$installbin/$perl_verbase$ver$exe_ext",
-	    "$installbin/suid$perl$exe_ext")
-      if $d_dosuid;
 }
 
 # For development purposes it can be very useful to have multiple perls
@@ -579,21 +569,6 @@
 if ( !$versiononly || ($installprivlib =~ m/\Q$vershort/)) {
     mkpath("${installprivlib}/$pod", $opts{verbose}, 0777);
 
-    # If Perl 5.003's perldiag.pod is there, rename it.
-    if (open POD, "${installprivlib}/$pod/perldiag.pod") {
-	read POD, $_, 4000;
-	close POD;
-	# Some of Perl 5.003's diagnostic messages ended with periods.
-	if (/^=.*\.$/m) {
-	    my ($from, $to) = ("${installprivlib}/$pod/perldiag.pod",
-			       "${installprivlib}/$pod/perldiag-5.003.pod");
-	    print "  rename $from $to";
-	    rename($from, $to)
-		or warn "Couldn't rename $from to $to: $!\n"
-		unless $opts{notify};
-	}
-    }
-
     for (@pods) {
 	# $_ is a name like  pod/perl.pod
 	(my $base = $_) =~ s#.*/##;
@@ -745,7 +720,7 @@
 
     # ignore patch backups, RCS files, emacs backup & temp files and the
     # .exists files, .PL files, and test files.
-    return if $name =~ m{\.orig$|\.rej$|~$|^#.+#$|,v$|^\.exists|\.PL$|\.plc$|\.t$|^test\.pl$|^dbm_filter_util.pl$} ||
+    return if $name =~ m{\.orig$|\.rej$|~$|^#.+#$|,v$|^\.exists|\.PL$|\.plc$|\.t$|^test\.pl$|^dbm_filter_util\.pl$|^filter-util\.pl$|^uupacktool\.pl$|^\.gitignore$} ||
 	      $dir  =~ m{/t(?:/|$)};
     # ignore the cpan script in lib/CPAN/bin, the instmodsh and xsubpp
     # scripts in lib/ExtUtils, the prove script in lib/Test/Harness,
Index: src/gnu/usr.bin/perl/makedef.pl
diff -u src/gnu/usr.bin/perl/makedef.pl:1.5 src/gnu/usr.bin/perl/makedef.pl:1.6
--- makedef.pl:1.5	Mon Oct 12 18:24:21 2009
+++ makedef.pl	Fri Sep 24 15:06:40 2010
@@ -34,6 +34,7 @@
 
 
 BEGIN { unshift @INC, "lib" }
+use Config;
 use strict;
 
 use vars qw($PLATFORM $CCTYPE $FILETYPE $CONFIG_ARGS $ARCHNAME $PATCHLEVEL);
@@ -75,7 +76,11 @@
 	# the user might have chosen to disable because the canned configs are
 	# minimal configs that don't include any of those options.
 	my $opts = ($PLATFORM eq 'wince' ? '-MCross' : ''); # for wince need Cross.pm to get Config.pm
-	my $config = `$^X $opts -Ilib -V`;
+
+	$ENV{PERL5LIB} = join $Config{path_sep}, @INC;
+	my $cmd = "$^X $opts -V";
+	my $config = `$cmd`
+	    or die "Couldn't run [$cmd]: $!";
 	my($options) = $config =~ /^  Compile-time options: (.*?)\n^  \S/ms;
 	$options =~ s/\s+/ /g;
 	print STDERR "Options: ($options)\n";
@@ -184,7 +189,7 @@
 print STDERR "Defines: (" . join(' ', sort keys %define) . ")\n";
 
 if ($PLATFORM =~ /^win(?:32|ce)$/) {
-    (my $dll = ($define{PERL_DLL} || "perl510")) =~ s/\.dll$//i;
+    (my $dll = ($define{PERL_DLL} || "perl512")) =~ s/\.dll$//i;
     print "LIBRARY $dll\n";
     # The DESCRIPTION module definition file statement is not supported
     # by VC7 onwards.
@@ -240,7 +245,7 @@
 }
 elsif ($PLATFORM eq 'netware') {
 	if ($FILETYPE eq 'def') {
-	print "LIBRARY perl510\n";
+	print "LIBRARY perl512\n";
 	print "DESCRIPTION 'Perl interpreter for NetWare'\n";
 	print "EXPORTS\n";
 	}
@@ -753,6 +758,7 @@
 		    PL_sharedsv_space_mutex
 		    PL_dollarzero_mutex
 		    PL_hints_mutex
+		    PL_my_ctx_mutex
 		    PL_perlio_mutex
 		    PL_regdupe
 		    Perl_parser_dup
@@ -766,7 +772,7 @@
 		    Perl_he_dup
 		    Perl_mg_dup
 		    Perl_mro_meta_dup
-		    Perl_re_dup
+		    Perl_re_dup_guts
 		    Perl_sv_dup
 		    Perl_rvpv_dup
 		    Perl_hek_dup
@@ -788,7 +794,6 @@
 
 unless ($define{'PERL_IMPLICIT_CONTEXT'}) {
     skip_symbols [qw(
-		    PL_my_ctx_mutex
 		    PL_my_cxt_index
 		    PL_my_cxt_list
 		    PL_my_cxt_size
@@ -1218,6 +1223,10 @@
 	my $glob = readvar($f, sub { "Perl_" . $_[1] . $_[2] . "_ptr" });
 	emit_symbols $glob;
     }
+    unless ($define{'USE_ITHREADS'}) {
+	# XXX needed for XS extensions that define PERL_CORE
+	emit_symbol("PL_curinterp");
+    }
     # XXX AIX seems to want the perlvars.h symbols, for some reason
     if ($PLATFORM eq 'aix' or $PLATFORM eq 'os2') {	# OS/2 needs PL_thr_key
 	my $glob = readvar($perlvars_h);
@@ -1279,6 +1288,7 @@
 			    win32_open
 			    win32_close
 			    win32_eof
+			    win32_isatty
 			    win32_read
 			    win32_write
 			    win32_spawnvp
Index: src/gnu/usr.bin/perl/malloc.c
diff -u src/gnu/usr.bin/perl/malloc.c:1.11 src/gnu/usr.bin/perl/malloc.c:1.12
--- malloc.c:1.11	Mon Oct 12 18:24:21 2009
+++ malloc.c	Fri Sep 24 15:06:40 2010
@@ -264,7 +264,7 @@
 #define MIN_BUC_POW2 (sizeof(void*) > 4 ? 3 : 2) /* Allow for 4-byte arena. */
 #define MIN_BUCKET (MIN_BUC_POW2 * BUCKETS_PER_POW2)
 
-#if !(defined(I286) || defined(atarist) || defined(__MINT__))
+#if !(defined(I286) || defined(atarist))
 	/* take 2k unless the block is bigger than that */
 #  define LOG_OF_MIN_ARENA 11
 #else
@@ -552,7 +552,7 @@
 #define u_short unsigned short
 
 /* 286 and atarist like big chunks, which gives too much overhead. */
-#if (defined(RCHECK) || defined(I286) || defined(atarist) || defined(__MINT__)) && defined(PACK_MALLOC)
+#if (defined(RCHECK) || defined(I286) || defined(atarist)) && defined(PACK_MALLOC)
 #  undef PACK_MALLOC
 #endif 
 
@@ -1734,7 +1734,7 @@
 	/* Second, check alignment. */
 	slack = 0;
 
-#if !defined(atarist) && !defined(__MINT__) /* on the atari we dont have to worry about this */
+#if !defined(atarist) /* on the atari we dont have to worry about this */
 #  ifndef I286 	/* The sbrk(0) call on the I286 always returns the next segment */
 	/* WANTED_ALIGNMENT may be more than NEEDED_ALIGNMENT, but this may
 	   improve performance of memory access. */
@@ -1743,7 +1743,7 @@
 	    add += slack;
 	}
 #  endif
-#endif /* !atarist && !MINT */
+#endif /* !atarist */
 		
 	if (add) {
 	    DEBUG_m(PerlIO_printf(Perl_debug_log, 
@@ -2056,10 +2056,10 @@
 #ifdef PERL_CORE
 		{
 		    dTHX;
-		    if (!PERL_IS_ALIVE || !PL_curcop || ckWARN_d(WARN_MALLOC))
-			Perl_warner(aTHX_ packWARN(WARN_MALLOC), "%s free() ignored (RMAGIC, PERL_CORE)",
-				    ovp->ov_rmagic == RMAGIC - 1 ?
-				    "Duplicate" : "Bad");
+		    if (!PERL_IS_ALIVE || !PL_curcop)
+			Perl_ck_warner_d(aTHX_ packWARN(WARN_MALLOC), "%s free() ignored (RMAGIC, PERL_CORE)",
+					 ovp->ov_rmagic == RMAGIC - 1 ?
+					 "Duplicate" : "Bad");
 		}
 #else
 		warn("%s free() ignored (RMAGIC)",
@@ -2069,8 +2069,8 @@
 #ifdef PERL_CORE
 		{
 		    dTHX;
-		    if (!PERL_IS_ALIVE || !PL_curcop || ckWARN_d(WARN_MALLOC))
-			Perl_warner(aTHX_ packWARN(WARN_MALLOC), "%s", "Bad free() ignored (PERL_CORE)");
+		    if (!PERL_IS_ALIVE || !PL_curcop)
+			Perl_ck_warner_d(aTHX_ packWARN(WARN_MALLOC), "%s", "Bad free() ignored (PERL_CORE)");
 		}
 #else
 		warn("%s", "Bad free() ignored");
@@ -2163,11 +2163,11 @@
 #ifdef PERL_CORE
 		{
 		    dTHX;
-		    if (!PERL_IS_ALIVE || !PL_curcop || ckWARN_d(WARN_MALLOC))
-			Perl_warner(aTHX_ packWARN(WARN_MALLOC), "%srealloc() %signored",
-				    (ovp->ov_rmagic == RMAGIC - 1 ? "" : "Bad "),
-				    ovp->ov_rmagic == RMAGIC - 1
-				    ? "of freed memory " : "");
+		    if (!PERL_IS_ALIVE || !PL_curcop)
+			Perl_ck_warner_d(aTHX_ packWARN(WARN_MALLOC), "%srealloc() %signored",
+					 (ovp->ov_rmagic == RMAGIC - 1 ? "" : "Bad "),
+					 ovp->ov_rmagic == RMAGIC - 1
+					 ? "of freed memory " : "");
 		}
 #else
 		warn2("%srealloc() %signored",
@@ -2178,9 +2178,9 @@
 #ifdef PERL_CORE
 		{
 		    dTHX;
-		    if (!PERL_IS_ALIVE || !PL_curcop || ckWARN_d(WARN_MALLOC))
-			Perl_warner(aTHX_ packWARN(WARN_MALLOC), "%s",
-				    "Bad realloc() ignored");
+		    if (!PERL_IS_ALIVE || !PL_curcop)
+			Perl_ck_warner_d(aTHX_ packWARN(WARN_MALLOC), "%s",
+					 "Bad realloc() ignored");
 		}
 #else
 		warn("%s", "Bad realloc() ignored");
@@ -2467,7 +2467,7 @@
  * frees for each size category.
  */
 void
-Perl_dump_mstats(pTHX_ char *s)
+Perl_dump_mstats(pTHX_ const char *s)
 {
 #ifdef DEBUGGING_MSTATS
   	register int i;
@@ -2536,7 +2536,7 @@
 
 #ifdef USE_PERL_SBRK
 
-#   if defined(__MACHTEN_PPC__) || defined(NeXT) || defined(__NeXT__) || defined(PURIFY)
+#   if defined(NeXT) || defined(__NeXT__) || defined(PURIFY)
 #      define PERL_SBRK_VIA_MALLOC
 #   endif
 
Index: src/gnu/usr.bin/perl/mg.c
diff -u src/gnu/usr.bin/perl/mg.c:1.15 src/gnu/usr.bin/perl/mg.c:1.16
--- mg.c:1.15	Mon Oct 12 18:24:21 2009
+++ mg.c	Fri Sep 24 15:06:40 2010
@@ -77,8 +77,9 @@
 
 struct magic_state {
     SV* mgs_sv;
-    U32 mgs_flags;
     I32 mgs_ss_ix;
+    U32 mgs_magical;
+    bool mgs_readonly;
 };
 /* MGS is typedef'ed to struct magic_state in perl.h */
 
@@ -100,7 +101,8 @@
 
     mgs = SSPTR(mgs_ix, MGS*);
     mgs->mgs_sv = sv;
-    mgs->mgs_flags = SvMAGICAL(sv) | SvREADONLY(sv);
+    mgs->mgs_magical = SvMAGICAL(sv);
+    mgs->mgs_readonly = SvREADONLY(sv) != 0;
     mgs->mgs_ss_ix = PL_savestack_ix;   /* points after the saved destructor */
 
     SvMAGICAL_off(sv);
@@ -125,8 +127,9 @@
     const MAGIC* mg;
     PERL_ARGS_ASSERT_MG_MAGICAL;
     PERL_UNUSED_CONTEXT;
+
+    SvMAGICAL_off(sv);
     if ((mg = SvMAGIC(sv))) {
-	SvRMAGICAL_off(sv);
 	do {
 	    const MGVTBL* const vtbl = mg->mg_virtual;
 	    if (vtbl) {
@@ -191,7 +194,7 @@
     dVAR;
     const I32 mgs_ix = SSNEW(sizeof(MGS));
     const bool was_temp = (bool)SvTEMP(sv);
-    int have_new = 0;
+    bool have_new = 0;
     MAGIC *newmg, *head, *cur, *mg;
     /* guard against sv having being freed midway by holding a private
        reference. */
@@ -216,21 +219,24 @@
     newmg = cur = head = mg = SvMAGIC(sv);
     while (mg) {
 	const MGVTBL * const vtbl = mg->mg_virtual;
+	MAGIC * const nextmg = mg->mg_moremagic;	/* it may delete itself */
 
 	if (!(mg->mg_flags & MGf_GSKIP) && vtbl && vtbl->svt_get) {
 	    CALL_FPTR(vtbl->svt_get)(aTHX_ sv, mg);
 
 	    /* guard against magic having been deleted - eg FETCH calling
 	     * untie */
-	    if (!SvMAGIC(sv))
+	    if (!SvMAGIC(sv)) {
+		(SSPTR(mgs_ix, MGS *))->mgs_magical = 0; /* recalculate flags */
 		break;
+	    }
 
-	    /* Don't restore the flags for this entry if it was deleted. */
+	    /* recalculate flags if this entry was deleted. */
 	    if (mg->mg_flags & MGf_GSKIP)
-		(SSPTR(mgs_ix, MGS *))->mgs_flags = 0;
+		(SSPTR(mgs_ix, MGS *))->mgs_magical = 0;
 	}
 
-	mg = mg->mg_moremagic;
+	mg = nextmg;
 
 	if (have_new) {
 	    /* Have we finished with the new entries we saw? Start again
@@ -247,6 +253,7 @@
 	    have_new = 1;
 	    cur = mg;
 	    mg  = newmg;
+	    (SSPTR(mgs_ix, MGS *))->mgs_magical = 0; /* recalculate flags */
 	}
     }
 
@@ -285,7 +292,7 @@
 	nextmg = mg->mg_moremagic;	/* it may delete itself */
 	if (mg->mg_flags & MGf_GSKIP) {
 	    mg->mg_flags &= ~MGf_GSKIP;	/* setting requires another read */
-	    (SSPTR(mgs_ix, MGS*))->mgs_flags = 0;
+	    (SSPTR(mgs_ix, MGS*))->mgs_magical = 0;
 	}
 	if (PL_localizing == 2 && !S_is_container_magic(mg))
 	    continue;
@@ -383,15 +390,18 @@
 {
     const I32 mgs_ix = SSNEW(sizeof(MGS));
     MAGIC* mg;
+    MAGIC *nextmg;
 
     PERL_ARGS_ASSERT_MG_CLEAR;
 
     save_magic(mgs_ix, sv);
 
-    for (mg = SvMAGIC(sv); mg; mg = mg->mg_moremagic) {
+    for (mg = SvMAGIC(sv); mg; mg = nextmg) {
         const MGVTBL* const vtbl = mg->mg_virtual;
 	/* omit GSKIP -- never set here */
 
+	nextmg = mg->mg_moremagic; /* it may delete itself */
+
 	if (vtbl && vtbl->svt_clear)
 	    CALL_FPTR(vtbl->svt_clear)(aTHX_ sv, mg);
     }
@@ -463,15 +473,19 @@
 /*
 =for apidoc mg_localize
 
-Copy some of the magic from an existing SV to new localized version of
-that SV. Container magic (eg %ENV, $1, tie) gets copied, value magic
-doesn't (eg taint, pos).
+Copy some of the magic from an existing SV to new localized version of that
+SV. Container magic (eg %ENV, $1, tie) gets copied, value magic doesn't (eg
+taint, pos).
+
+If setmagic is false then no set magic will be called on the new (empty) SV.
+This typically means that assignment will soon follow (e.g. 'local $x = $y'),
+and that will handle the magic.
 
 =cut
 */
 
 void
-Perl_mg_localize(pTHX_ SV *sv, SV *nsv)
+Perl_mg_localize(pTHX_ SV *sv, SV *nsv, bool setmagic)
 {
     dVAR;
     MAGIC *mg;
@@ -495,9 +509,11 @@
 
     if (SvTYPE(nsv) >= SVt_PVMG && SvMAGIC(nsv)) {
 	SvFLAGS(nsv) |= SvMAGICAL(sv);
-	PL_localizing = 1;
-	SvSETMAGIC(nsv);
-	PL_localizing = 0;
+	if (setmagic) {
+	    PL_localizing = 1;
+	    SvSETMAGIC(nsv);
+	    PL_localizing = 0;
+	}
     }	    
 }
 
@@ -766,14 +782,7 @@
 	break;
     case '\005':  /* ^E */
 	 if (nextchar == '\0') {
-#if defined(MACOS_TRADITIONAL)
-	     {
-		  char msg[256];
-
-		  sv_setnv(sv,(double)gMacPerl_OSErr);
-		  sv_setpv(sv, gMacPerl_OSErr ? GetSysErrText(gMacPerl_OSErr, msg) : "");
-	     }
-#elif defined(VMS)
+#if defined(VMS)
 	     {
 #	          include <descrip.h>
 #	          include <starlet.h>
@@ -1021,29 +1030,29 @@
 	if (GvIOp(PL_defoutgv))
 	    sv_setiv(sv, (IV)(IoFLAGS(GvIOp(PL_defoutgv)) & IOf_FLUSH) != 0 );
 	break;
-    case ',':
-	break;
     case '\\':
 	if (PL_ors_sv)
 	    sv_copypv(sv, PL_ors_sv);
 	break;
     case '!':
+	{
+	dSAVE_ERRNO;
 #ifdef VMS
 	sv_setnv(sv, (NV)((errno == EVMSERR) ? vaxc$errno : errno));
-	sv_setpv(sv, errno ? Strerror(errno) : "");
 #else
-	{
-	dSAVE_ERRNO;
 	sv_setnv(sv, (NV)errno);
+#endif
 #ifdef OS2
 	if (errno == errno_isOS2 || errno == errno_isOS2_set)
 	    sv_setpv(sv, os2error(Perl_rc));
 	else
 #endif
 	sv_setpv(sv, errno ? Strerror(errno) : "");
+	if (SvPOKp(sv))
+	    SvPOK_on(sv);    /* may have got removed during taint processing */
 	RESTORE_ERRNO;
 	}
-#endif
+
 	SvRTRIM(sv);
 	SvNOK_on(sv);	/* what a wonderful hack! */
 	break;
@@ -1072,10 +1081,8 @@
 	(void)SvIOK_on(sv);	/* what a wonderful hack! */
 #endif
 	break;
-#ifndef MACOS_TRADITIONAL
     case '0':
 	break;
-#endif
     }
     return 0;
 }
@@ -1240,10 +1247,14 @@
 {
     dVAR;
     /* Are we fetching a signal entry? */
-    const I32 i = whichsig(MgPV_nolen_const(mg));
+    int i = (I16)mg->mg_private;
 
     PERL_ARGS_ASSERT_MAGIC_GETSIG;
 
+    if (!i) {
+	mg->mg_private = i = whichsig(MgPV_nolen_const(mg));
+    }
+
     if (i > 0) {
     	if(PL_psig_ptr[i])
     	    sv_setsv(sv,PL_psig_ptr[i]);
@@ -1271,66 +1282,11 @@
 int
 Perl_magic_clearsig(pTHX_ SV *sv, MAGIC *mg)
 {
-    /* XXX Some of this code was copied from Perl_magic_setsig. A little
-     * refactoring might be in order.
-     */
-    dVAR;
-    register const char * const s = MgPV_nolen_const(mg);
     PERL_ARGS_ASSERT_MAGIC_CLEARSIG;
     PERL_UNUSED_ARG(sv);
-    if (*s == '_') {
-	SV** svp = NULL;
-	if (strEQ(s,"__DIE__"))
-	    svp = &PL_diehook;
-	else if (strEQ(s,"__WARN__") && PL_warnhook != PERL_WARNHOOK_FATAL)
-	    svp = &PL_warnhook;
-	if (svp && *svp) {
-	    SV *const to_dec = *svp;
-	    *svp = NULL;
-	    SvREFCNT_dec(to_dec);
-	}
-    }
-    else {
-	/* Are we clearing a signal entry? */
-	const I32 i = whichsig(s);
-	if (i > 0) {
-#ifdef HAS_SIGPROCMASK
-	    sigset_t set, save;
-	    SV* save_sv;
-	    /* Avoid having the signal arrive at a bad time, if possible. */
-	    sigemptyset(&set);
-	    sigaddset(&set,i);
-	    sigprocmask(SIG_BLOCK, &set, &save);
-	    ENTER;
-	    save_sv = newSVpvn((char *)(&save), sizeof(sigset_t));
-	    SAVEFREESV(save_sv);
-	    SAVEDESTRUCTOR_X(restore_sigmask, save_sv);
-#endif
-	    PERL_ASYNC_CHECK();
-#if defined(FAKE_PERSISTENT_SIGNAL_HANDLERS) || defined(FAKE_DEFAULT_SIGNAL_HANDLERS)
-	    if (!PL_sig_handlers_initted) Perl_csighandler_init();
-#endif
-#ifdef FAKE_DEFAULT_SIGNAL_HANDLERS
-	    PL_sig_defaulting[i] = 1;
-	    (void)rsignal(i, PL_csighandlerp);
-#else
-	    (void)rsignal(i, (Sighandler_t) SIG_DFL);
-#endif
-    	    if(PL_psig_name[i]) {
-    		SvREFCNT_dec(PL_psig_name[i]);
-    		PL_psig_name[i]=0;
-    	    }
-    	    if(PL_psig_ptr[i]) {
-		SV * const to_dec=PL_psig_ptr[i];
-    		PL_psig_ptr[i]=0;
-		LEAVE;
-    		SvREFCNT_dec(to_dec);
-    	    }
-	    else
-		LEAVE;
-	}
-    }
-    return 0;
+
+    magic_setsig(NULL, mg);
+    return sv_unmagic(sv, mg->mg_type);
 }
 
 Signal_t
@@ -1369,13 +1325,14 @@
 #endif
 	   (PL_signals & PERL_SIGNALS_UNSAFE_FLAG))
 	/* Call the perl level handler now--
-	 * with risk we may be in malloc() etc. */
+	 * with risk we may be in malloc() or being destructed etc. */
 #if defined(HAS_SIGACTION) && defined(SA_SIGINFO)
 	(*PL_sighandlerp)(sig, NULL, NULL);
 #else
 	(*PL_sighandlerp)(sig);
 #endif
     else {
+	if (!PL_psig_pend) return;
 	/* Set a flag to say this signal is pending, that is awaiting delivery after
 	 * the current Perl opcode completes */
 	PL_psig_pend[sig]++;
@@ -1383,7 +1340,7 @@
 #ifndef SIG_PENDING_DIE_COUNT
 #  define SIG_PENDING_DIE_COUNT 120
 #endif
-	/* And one to say _a_ signal is pending */
+	/* Add one to say _a_ signal is pending */
 	if (++PL_sig_pending >= SIG_PENDING_DIE_COUNT)
 	    Perl_croak(aTHX_ "Maximal count of pending signals (%lu) exceeded",
 		       (unsigned long)SIG_PENDING_DIE_COUNT);
@@ -1432,6 +1389,7 @@
     }
 }
 
+/* sv of NULL signifies that we're acting as magic_clearsig.  */
 int
 Perl_magic_setsig(pTHX_ SV *sv, MAGIC *mg)
 {
@@ -1455,22 +1413,32 @@
     if (*s == '_') {
 	if (strEQ(s,"__DIE__"))
 	    svp = &PL_diehook;
-	else if (strEQ(s,"__WARN__"))
+	else if (strEQ(s,"__WARN__")
+		 && (sv ? 1 : PL_warnhook != PERL_WARNHOOK_FATAL)) {
+	    /* Merge the existing behaviours, which are as follows:
+	       magic_setsig, we always set svp to &PL_warnhook
+	       (hence we always change the warnings handler)
+	       For magic_clearsig, we don't change the warnings handler if it's
+	       set to the &PL_warnhook.  */
 	    svp = &PL_warnhook;
-	else
+	} else if (sv)
 	    Perl_croak(aTHX_ "No such hook: %s", s);
 	i = 0;
-	if (*svp) {
+	if (svp && *svp) {
 	    if (*svp != PERL_WARNHOOK_FATAL)
 		to_dec = *svp;
 	    *svp = NULL;
 	}
     }
     else {
-	i = whichsig(s);	/* ...no, a brick */
+	i = (I16)mg->mg_private;
+	if (!i) {
+	    i = whichsig(s);	/* ...no, a brick */
+	    mg->mg_private = (U16)i;
+	}
 	if (i <= 0) {
-	    if (ckWARN(WARN_SIGNAL))
-		Perl_warner(aTHX_ packWARN(WARN_SIGNAL), "No such signal: SIG%s", s);
+	    if (sv)
+		Perl_ck_warner(aTHX_ packWARN(WARN_SIGNAL), "No such signal: SIG%s", s);
 	    return 0;
 	}
 #ifdef HAS_SIGPROCMASK
@@ -1493,68 +1461,80 @@
 #ifdef FAKE_DEFAULT_SIGNAL_HANDLERS
 	PL_sig_defaulting[i] = 0;
 #endif
-	SvREFCNT_dec(PL_psig_name[i]);
 	to_dec = PL_psig_ptr[i];
-	PL_psig_ptr[i] = SvREFCNT_inc_simple_NN(sv);
-	SvTEMP_off(sv); /* Make sure it doesn't go away on us */
-	PL_psig_name[i] = newSVpvn(s, len);
-	SvREADONLY_on(PL_psig_name[i]);
+	if (sv) {
+	    PL_psig_ptr[i] = SvREFCNT_inc_simple_NN(sv);
+	    SvTEMP_off(sv); /* Make sure it doesn't go away on us */
+
+	    /* Signals don't change name during the program's execution, so once
+	       they're cached in the appropriate slot of PL_psig_name, they can
+	       stay there.
+
+	       Ideally we'd find some way of making SVs at (C) compile time, or
+	       at least, doing most of the work.  */
+	    if (!PL_psig_name[i]) {
+		PL_psig_name[i] = newSVpvn(s, len);
+		SvREADONLY_on(PL_psig_name[i]);
+	    }
+	} else {
+	    SvREFCNT_dec(PL_psig_name[i]);
+	    PL_psig_name[i] = NULL;
+	    PL_psig_ptr[i] = NULL;
+	}
     }
-    if (isGV_with_GP(sv) || SvROK(sv)) {
+    if (sv && (isGV_with_GP(sv) || SvROK(sv))) {
 	if (i) {
 	    (void)rsignal(i, PL_csighandlerp);
-#ifdef HAS_SIGPROCMASK
-	    LEAVE;
-#endif
 	}
 	else
 	    *svp = SvREFCNT_inc_simple_NN(sv);
-	if(to_dec)
-	    SvREFCNT_dec(to_dec);
-	return 0;
-    }
-    s = SvOK(sv) ? SvPV_force(sv,len) : "DEFAULT";
-    if (strEQ(s,"IGNORE")) {
-	if (i) {
+    } else {
+	if (sv && SvOK(sv)) {
+	    s = SvPV_force(sv, len);
+	} else {
+	    sv = NULL;
+	}
+	if (sv && strEQ(s,"IGNORE")) {
+	    if (i) {
 #ifdef FAKE_PERSISTENT_SIGNAL_HANDLERS
-	    PL_sig_ignoring[i] = 1;
-	    (void)rsignal(i, PL_csighandlerp);
+		PL_sig_ignoring[i] = 1;
+		(void)rsignal(i, PL_csighandlerp);
 #else
-	    (void)rsignal(i, (Sighandler_t) SIG_IGN);
+		(void)rsignal(i, (Sighandler_t) SIG_IGN);
 #endif
+	    }
 	}
-    }
-    else if (strEQ(s,"DEFAULT") || !*s) {
-	if (i)
+	else if (!sv || strEQ(s,"DEFAULT") || !len) {
+	    if (i) {
 #ifdef FAKE_DEFAULT_SIGNAL_HANDLERS
-	  {
-	    PL_sig_defaulting[i] = 1;
-	    (void)rsignal(i, PL_csighandlerp);
-	  }
+		PL_sig_defaulting[i] = 1;
+		(void)rsignal(i, PL_csighandlerp);
 #else
-	    (void)rsignal(i, (Sighandler_t) SIG_DFL);
+		(void)rsignal(i, (Sighandler_t) SIG_DFL);
 #endif
+	    }
+	}
+	else {
+	    /*
+	     * We should warn if HINT_STRICT_REFS, but without
+	     * access to a known hint bit in a known OP, we can't
+	     * tell whether HINT_STRICT_REFS is in force or not.
+	     */
+	    if (!strchr(s,':') && !strchr(s,'\''))
+		Perl_sv_insert_flags(aTHX_ sv, 0, 0, STR_WITH_LEN("main::"),
+				     SV_GMAGIC);
+	    if (i)
+		(void)rsignal(i, PL_csighandlerp);
+	    else
+		*svp = SvREFCNT_inc_simple_NN(sv);
+	}
     }
-    else {
-	/*
-	 * We should warn if HINT_STRICT_REFS, but without
-	 * access to a known hint bit in a known OP, we can't
-	 * tell whether HINT_STRICT_REFS is in force or not.
-	 */
-	if (!strchr(s,':') && !strchr(s,'\''))
-	    Perl_sv_insert_flags(aTHX_ sv, 0, 0, STR_WITH_LEN("main::"),
-				 SV_GMAGIC);
-	if (i)
-	    (void)rsignal(i, PL_csighandlerp);
-	else
-	    *svp = SvREFCNT_inc_simple_NN(sv);
-    }
+
 #ifdef HAS_SIGPROCMASK
     if(i)
 	LEAVE;
 #endif
-    if(to_dec)
-	SvREFCNT_dec(to_dec);
+    SvREFCNT_dec(to_dec);
     return 0;
 }
 #endif /* !PERL_MICRO */
@@ -1563,38 +1543,17 @@
 Perl_magic_setisa(pTHX_ SV *sv, MAGIC *mg)
 {
     dVAR;
-    HV* stash;
-
     PERL_ARGS_ASSERT_MAGIC_SETISA;
     PERL_UNUSED_ARG(sv);
 
-    /* Bail out if destruction is going on */
-    if(PL_dirty) return 0;
-
     /* Skip _isaelem because _isa will handle it shortly */
     if (PL_delaymagic & DM_ARRAY && mg->mg_type == PERL_MAGIC_isaelem)
 	return 0;
 
-    /* XXX Once it's possible, we need to
-       detect that our @ISA is aliased in
-       other stashes, and act on the stashes
-       of all of the aliases */
-
-    /* The first case occurs via setisa,
-       the second via setisa_elem, which
-       calls this same magic */
-    stash = GvSTASH(
-        SvTYPE(mg->mg_obj) == SVt_PVGV
-            ? (const GV *)mg->mg_obj
-            : (const GV *)mg_find(mg->mg_obj, PERL_MAGIC_isa)->mg_obj
-    );
-
-    if (stash)
-	mro_isa_changed_in(stash);
-
-    return 0;
+    return magic_clearisa(NULL, mg);
 }
 
+/* sv of NULL signifies that we're acting as magic_setisa.  */
 int
 Perl_magic_clearisa(pTHX_ SV *sv, MAGIC *mg)
 {
@@ -1606,9 +1565,17 @@
     /* Bail out if destruction is going on */
     if(PL_dirty) return 0;
 
-    av_clear(MUTABLE_AV(sv));
+    if (sv)
+	av_clear(MUTABLE_AV(sv));
 
-    /* XXX see comments in magic_setisa */
+    /* XXX Once it's possible, we need to
+       detect that our @ISA is aliased in
+       other stashes, and act on the stashes
+       of all of the aliases */
+
+    /* The first case occurs via setisa,
+       the second via setisa_elem, which
+       calls this same magic */
     stash = GvSTASH(
         SvTYPE(mg->mg_obj) == SVt_PVGV
             ? (const GV *)mg->mg_obj
@@ -1898,7 +1865,7 @@
 Perl_magic_getarylen(pTHX_ SV *sv, const MAGIC *mg)
 {
     dVAR;
-    const AV * const obj = MUTABLE_AV(mg->mg_obj);
+    AV * const obj = MUTABLE_AV(mg->mg_obj);
 
     PERL_ARGS_ASSERT_MAGIC_GETARYLEN;
 
@@ -1921,9 +1888,8 @@
     if (obj) {
 	av_fill(obj, SvIV(sv) - CopARYBASE_get(PL_curcop));
     } else {
-	if (ckWARN(WARN_MISC))
-	    Perl_warner(aTHX_ packWARN(WARN_MISC),
-			"Attempt to set length of freed array");
+	Perl_ck_warner(aTHX_ packWARN(WARN_MISC),
+		       "Attempt to set length of freed array");
     }
     return 0;
 }
@@ -2043,19 +2009,19 @@
     STRLEN len;
     SV * const lsv = LvTARG(sv);
     const char * const tmps = SvPV_const(lsv,len);
-    I32 offs = LvTARGOFF(sv);
-    I32 rem = LvTARGLEN(sv);
+    STRLEN offs = LvTARGOFF(sv);
+    STRLEN rem = LvTARGLEN(sv);
 
     PERL_ARGS_ASSERT_MAGIC_GETSUBSTR;
     PERL_UNUSED_ARG(mg);
 
     if (SvUTF8(lsv))
-	sv_pos_u2b(lsv, &offs, &rem);
-    if (offs > (I32)len)
+	offs = sv_pos_u2b_flags(lsv, offs, &rem, SV_CONST_RETURN);
+    if (offs > len)
 	offs = len;
-    if (rem + offs > (I32)len)
+    if (rem > len - offs)
 	rem = len - offs;
-    sv_setpvn(sv, tmps + offs, (STRLEN)rem);
+    sv_setpvn(sv, tmps + offs, rem);
     if (SvUTF8(lsv))
         SvUTF8_on(sv);
     return 0;
@@ -2068,22 +2034,22 @@
     STRLEN len;
     const char * const tmps = SvPV_const(sv, len);
     SV * const lsv = LvTARG(sv);
-    I32 lvoff = LvTARGOFF(sv);
-    I32 lvlen = LvTARGLEN(sv);
+    STRLEN lvoff = LvTARGOFF(sv);
+    STRLEN lvlen = LvTARGLEN(sv);
 
     PERL_ARGS_ASSERT_MAGIC_SETSUBSTR;
     PERL_UNUSED_ARG(mg);
 
     if (DO_UTF8(sv)) {
 	sv_utf8_upgrade(lsv);
- 	sv_pos_u2b(lsv, &lvoff, &lvlen);
+	lvoff = sv_pos_u2b_flags(lsv, lvoff, &lvlen, SV_CONST_RETURN);
 	sv_insert(lsv, lvoff, lvlen, tmps, len);
 	LvTARGLEN(sv) = sv_len_utf8(sv);
 	SvUTF8_on(lsv);
     }
     else if (lsv && SvUTF8(lsv)) {
 	const char *utf8;
-	sv_pos_u2b(lsv, &lvoff, &lvlen);
+	lvoff = sv_pos_u2b_flags(lsv, lvoff, &lvlen, SV_CONST_RETURN);
 	LvTARGLEN(sv) = len;
 	utf8 = (char*)bytes_to_utf8((U8*)tmps, &len);
 	sv_insert(lsv, lvoff, lvlen, utf8, len);
@@ -2094,7 +2060,6 @@
 	LvTARGLEN(sv) = len;
     }
 
-
     return 0;
 }
 
@@ -2252,7 +2217,8 @@
     PERL_ARGS_ASSERT_MAGIC_SETMGLOB;
     PERL_UNUSED_CONTEXT;
     mg->mg_len = -1;
-    SvSCREAM_off(sv);
+    if (!isGV_with_GP(sv))
+	SvSCREAM_off(sv);
     return 0;
 }
 
@@ -2286,17 +2252,6 @@
     return sv_unmagic(sv, type);
 }
 
-int
-Perl_magic_freeregexp(pTHX_ SV *sv, MAGIC *mg)
-{
-    dVAR;
-    regexp * const re = (regexp *)mg->mg_obj;
-    PERL_UNUSED_ARG(sv);
-
-    ReREFCNT_dec(re);
-    return 0;
-}
-
 #ifdef USE_LOCALE_COLLATE
 int
 Perl_magic_setcollxfrm(pTHX_ SV *sv, MAGIC *mg)
@@ -2386,35 +2341,31 @@
 #ifdef DEBUGGING
 	s = SvPV_nolen_const(sv);
 	PL_debug = get_debug_opts(&s, 0) | DEBUG_TOP_FLAG;
-	DEBUG_x(dump_all());
+	if (DEBUG_x_TEST || DEBUG_B_TEST)
+	    dump_all_perl(!DEBUG_B_TEST);
 #else
 	PL_debug = (SvIV(sv)) | DEBUG_TOP_FLAG;
 #endif
 	break;
     case '\005':  /* ^E */
 	if (*(mg->mg_ptr+1) == '\0') {
-#ifdef MACOS_TRADITIONAL
-	    gMacPerl_OSErr = SvIV(sv);
-#else
-#  ifdef VMS
+#ifdef VMS
 	    set_vaxc_errno(SvIV(sv));
-#  else
-#    ifdef WIN32
+#else
+#  ifdef WIN32
 	    SetLastError( SvIV(sv) );
-#    else
-#      ifdef OS2
+#  else
+#    ifdef OS2
 	    os2_setsyserrno(SvIV(sv));
-#      else
+#    else
 	    /* will anyone ever use this? */
 	    SETERRNO(SvIV(sv), 4);
-#      endif
 #    endif
 #  endif
 #endif
 	}
 	else if (strEQ(mg->mg_ptr+1, "NCODING")) {
-	    if (PL_encoding)
-		SvREFCNT_dec(PL_encoding);
+	    SvREFCNT_dec(PL_encoding);
 	    if (SvOK(sv) || SvGMAGICAL(sv)) {
 		PL_encoding = newSVsv(sv);
 	    }
@@ -2447,31 +2398,23 @@
 	    const char *const start = SvPV(sv, len);
 	    const char *out = (const char*)memchr(start, '\0', len);
 	    SV *tmp;
-	    struct refcounted_he *tmp_he;
 
 
 	    PL_compiling.cop_hints |= HINT_LEXICAL_IO_IN | HINT_LEXICAL_IO_OUT;
-	    PL_hints
-		|= HINT_LOCALIZE_HH | HINT_LEXICAL_IO_IN | HINT_LEXICAL_IO_OUT;
+	    PL_hints |= HINT_LEXICAL_IO_IN | HINT_LEXICAL_IO_OUT;
 
 	    /* Opening for input is more common than opening for output, so
 	       ensure that hints for input are sooner on linked list.  */
 	    tmp = out ? newSVpvn_flags(out + 1, start + len - out - 1,
-				       SVs_TEMP | SvUTF8(sv))
-		: newSVpvs_flags("", SVs_TEMP | SvUTF8(sv));
-
-	    tmp_he
-		= Perl_refcounted_he_new(aTHX_ PL_compiling.cop_hints_hash, 
-					 newSVpvs_flags("open>", SVs_TEMP),
-					 tmp);
-
-	    /* The UTF-8 setting is carried over  */
-	    sv_setpvn(tmp, start, out ? (STRLEN)(out - start) : len);
-
-	    PL_compiling.cop_hints_hash
-		= Perl_refcounted_he_new(aTHX_ tmp_he,
-					 newSVpvs_flags("open<", SVs_TEMP),
-					 tmp);
+				       SvUTF8(sv))
+		: newSVpvs_flags("", SvUTF8(sv));
+	    (void)hv_stores(GvHV(PL_hintgv), "open>", tmp);
+	    mg_set(tmp);
+
+	    tmp = newSVpvn_flags(start, out ? (STRLEN)(out - start) : len,
+				        SvUTF8(sv));
+	    (void)hv_stores(GvHV(PL_hintgv), "open<", tmp);
+	    mg_set(tmp);
 	}
 	break;
     case '\020':	/* ^P */
@@ -2601,8 +2544,7 @@
 	PL_rs = newSVsv(sv);
 	break;
     case '\\':
-	if (PL_ors_sv)
-	    SvREFCNT_dec(PL_ors_sv);
+	SvREFCNT_dec(PL_ors_sv);
 	if (SvOK(sv) || SvGMAGICAL(sv)) {
 	    PL_ors_sv = newSVsv(sv);
 	}
@@ -2610,16 +2552,6 @@
 	    PL_ors_sv = NULL;
 	}
 	break;
-    case ',':
-	if (PL_ofs_sv)
-	    SvREFCNT_dec(PL_ofs_sv);
-	if (SvOK(sv) || SvGMAGICAL(sv)) {
-	    PL_ofs_sv = newSVsv(sv);
-	}
-	else {
-	    PL_ofs_sv = NULL;
-	}
-	break;
     case '[':
 	CopARYBASE_set(&PL_compiling, SvIV(sv));
 	break;
@@ -2741,11 +2673,19 @@
 	{
 	    const char *p = SvPV_const(sv, len);
             Groups_t *gary = NULL;
+#ifdef _SC_NGROUPS_MAX
+           int maxgrp = sysconf(_SC_NGROUPS_MAX);
+
+           if (maxgrp < 0)
+               maxgrp = NGROUPS;
+#else
+           int maxgrp = NGROUPS;
+#endif
 
             while (isSPACE(*p))
                 ++p;
             PL_egid = Atol(p);
-            for (i = 0; i < NGROUPS; ++i) {
+            for (i = 0; i < maxgrp; ++i) {
                 while (*p && !isSPACE(*p))
                     ++p;
                 while (isSPACE(*p))
@@ -2793,7 +2733,6 @@
     case ':':
 	PL_chopset = SvPV_force(sv,len);
 	break;
-#ifndef MACOS_TRADITIONAL
     case '0':
 	LOCK_DOLLARZERO_MUTEX;
 #ifdef HAS_SETPROCTITLE
@@ -2859,7 +2798,6 @@
 #endif
 	UNLOCK_DOLLARZERO_MUTEX;
 	break;
-#endif
     }
     return 0;
 }
@@ -2938,12 +2876,11 @@
     }
 
     if (!cv || !CvROOT(cv)) {
-	if (ckWARN(WARN_SIGNAL))
-	    Perl_warner(aTHX_ packWARN(WARN_SIGNAL), "SIG%s handler \"%s\" not defined.\n",
-		PL_sig_name[sig], (gv ? GvENAME(gv)
-				: ((cv && CvGV(cv))
-				   ? GvENAME(CvGV(cv))
-				   : "__ANON__")));
+	Perl_ck_warner(aTHX_ packWARN(WARN_SIGNAL), "SIG%s handler \"%s\" not defined.\n",
+		       PL_sig_name[sig], (gv ? GvENAME(gv)
+					  : ((cv && CvGV(cv))
+					     ? GvENAME(CvGV(cv))
+					     : "__ANON__")));
 	goto cleanup;
     }
 
@@ -3049,8 +2986,10 @@
 	    sv_force_normal_flags(sv, 0);
 #endif
 
-	if (mgs->mgs_flags)
-	    SvFLAGS(sv) |= mgs->mgs_flags;
+	if (mgs->mgs_readonly)
+	    SvREADONLY_on(sv);
+	if (mgs->mgs_magical)
+	    SvFLAGS(sv) |= mgs->mgs_magical;
 	else
 	    mg_magical(sv);
 	if (SvGMAGICAL(sv)) {
@@ -3160,6 +3099,26 @@
     PL_compiling.cop_hints_hash
 	= Perl_refcounted_he_new(aTHX_ PL_compiling.cop_hints_hash,
 				 MUTABLE_SV(mg->mg_ptr), &PL_sv_placeholder);
+    return 0;
+}
+
+/*
+=for apidoc magic_clearhints
+
+Triggered by clearing %^H, resets C<PL_compiling.cop_hints_hash>.
+
+=cut
+*/
+int
+Perl_magic_clearhints(pTHX_ SV *sv, MAGIC *mg)
+{
+    PERL_ARGS_ASSERT_MAGIC_CLEARHINTS;
+    PERL_UNUSED_ARG(sv);
+    PERL_UNUSED_ARG(mg);
+    if (PL_compiling.cop_hints_hash) {
+	Perl_refcounted_he_free(aTHX_ PL_compiling.cop_hints_hash);
+	PL_compiling.cop_hints_hash = NULL;
+    }
     return 0;
 }
 
Index: src/gnu/usr.bin/perl/mg.h
diff -u src/gnu/usr.bin/perl/mg.h:1.10 src/gnu/usr.bin/perl/mg.h:1.11
--- mg.h:1.10	Mon Oct 12 18:24:21 2009
+++ mg.h	Fri Sep 24 15:06:40 2010
@@ -18,7 +18,7 @@
     int		(CPERLscope(*svt_clear))(pTHX_ SV *sv, MAGIC* mg);
     int		(CPERLscope(*svt_free))	(pTHX_ SV *sv, MAGIC* mg);
     int		(CPERLscope(*svt_copy))	(pTHX_ SV *sv, MAGIC* mg,
-    					SV *nsv, const char *name, int namlen);
+    					SV *nsv, const char *name, I32 namlen);
     int		(CPERLscope(*svt_dup))	(pTHX_ MAGIC *mg, CLONE_PARAMS *param);
     int		(CPERLscope(*svt_local))(pTHX_ SV *nsv, MAGIC *mg);
 };
Index: src/gnu/usr.bin/perl/miniperlmain.c
diff -u src/gnu/usr.bin/perl/miniperlmain.c:1.10 src/gnu/usr.bin/perl/miniperlmain.c:1.11
--- miniperlmain.c:1.10	Mon Oct 12 18:24:21 2009
+++ miniperlmain.c	Fri Sep 24 15:06:40 2010
@@ -42,7 +42,7 @@
 static void xs_init (pTHX);
 static PerlInterpreter *my_perl;
 
-#if defined (__MINT__) || defined (atarist)
+#if defined (atarist)
 /* The Atari operating system doesn't have a dynamic stack.  The
    stack size is determined from this value.  */
 long _stksize = 64 * 1024;
@@ -67,7 +67,7 @@
 #endif
 {
     dVAR;
-    int exitstatus;
+    int exitstatus, i;
 #ifdef PERL_GLOBAL_STRUCT
     struct perl_vars *plvarsp = init_global_struct();
 #  ifdef PERL_GLOBAL_STRUCT_PRIVATE
@@ -115,6 +115,13 @@
     exitstatus = perl_parse(my_perl, xs_init, argc, argv, (char **)NULL);
     if (!exitstatus)
         perl_run(my_perl);
+
+    /* Unregister our signal handler before destroying my_perl */
+    for (i = 0; PL_sig_name[i]; i++) {
+	if (rsignal_state(PL_sig_num[i]) == (Sighandler_t) PL_csighandlerp) {
+	    rsignal(PL_sig_num[i], (Sighandler_t) SIG_DFL);
+	}
+    }
 
     exitstatus = perl_destruct(my_perl);
 
Index: src/gnu/usr.bin/perl/op.c
diff -u src/gnu/usr.bin/perl/op.c:1.14 src/gnu/usr.bin/perl/op.c:1.15
--- op.c:1.14	Mon Oct 12 18:24:21 2009
+++ op.c	Fri Sep 24 15:06:40 2010
@@ -1,3 +1,4 @@
+#line 2 "op.c"
 /*    op.c
  *
  *    Copyright (C) 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,
@@ -57,7 +58,7 @@
 backward in the execution order.  (The bottom-up parser builds that
 part of the execution order it knows about, but if you follow the "next"
 links around, you'll find it's actually a closed loop through the
-top level node.
+top level node.)
 
 Whenever the bottom-up parser gets to a node that supplies context to
 its components, it invokes that portion of the top-down pass that applies
@@ -103,6 +104,7 @@
 #include "keywords.h"
 
 #define CALL_PEEP(o) CALL_FPTR(PL_peepp)(aTHX_ o)
+#define CALL_OPFREEHOOK(o) if (PL_opfreehook) CALL_FPTR(PL_opfreehook)(aTHX_ o)
 
 #if defined(PL_OP_SLAB_ALLOC)
 
@@ -370,7 +372,7 @@
 /* "register" allocation */
 
 PADOFFSET
-Perl_allocmy(pTHX_ const char *const name)
+Perl_allocmy(pTHX_ const char *const name, const STRLEN len, const U32 flags)
 {
     dVAR;
     PADOFFSET off;
@@ -378,46 +380,43 @@
 
     PERL_ARGS_ASSERT_ALLOCMY;
 
+    if (flags)
+	Perl_croak(aTHX_ "panic: allocmy illegal flag bits 0x%" UVxf,
+		   (UV)flags);
+
+    /* Until we're using the length for real, cross check that we're being
+       told the truth.  */
+    assert(strlen(name) == len);
+
     /* complain about "my $<special_var>" etc etc */
-    if (*name &&
+    if (len &&
 	!(is_our ||
 	  isALPHA(name[1]) ||
 	  (USE_UTF8_IN_NAMES && UTF8_IS_START(name[1])) ||
-	  (name[1] == '_' && (*name == '$' || name[2]))))
+	  (name[1] == '_' && (*name == '$' || len > 2))))
     {
 	/* name[2] is true if strlen(name) > 2  */
 	if (!isPRINT(name[1]) || strchr("\t\n\r\f", name[1])) {
-	    yyerror(Perl_form(aTHX_ "Can't use global %c^%c%s in \"%s\"",
-			      name[0], toCTRL(name[1]), name + 2,
+	    yyerror(Perl_form(aTHX_ "Can't use global %c^%c%.*s in \"%s\"",
+			      name[0], toCTRL(name[1]), (int)(len - 2), name + 2,
 			      PL_parser->in_my == KEY_state ? "state" : "my"));
 	} else {
-	    yyerror(Perl_form(aTHX_ "Can't use global %s in \"%s\"",name,
+	    yyerror(Perl_form(aTHX_ "Can't use global %.*s in \"%s\"", (int) len, name,
 			      PL_parser->in_my == KEY_state ? "state" : "my"));
 	}
     }
 
-    /* check for duplicate declaration */
-    pad_check_dup(name, is_our, (PL_curstash ? PL_curstash : PL_defstash));
-
-    if (PL_parser->in_my_stash && *name != '$') {
-	yyerror(Perl_form(aTHX_
-		    "Can't declare class for non-scalar %s in \"%s\"",
- 		     name,
- 		     is_our ? "our"
-			    : PL_parser->in_my == KEY_state ? "state" : "my"));
-    }
-
     /* allocate a spare slot and store the name in that slot */
 
-    off = pad_add_name(name,
+    off = pad_add_name(name, len,
+		       is_our ? padadd_OUR :
+		       PL_parser->in_my == KEY_state ? padadd_STATE : 0,
 		    PL_parser->in_my_stash,
 		    (is_our
 		        /* $_ is always in main::, even with our */
 			? (PL_curstash && !strEQ(name,"$_") ? PL_curstash : PL_defstash)
 			: NULL
-		    ),
-		    0, /*  not fake */
-		    PL_parser->in_my == KEY_state
+		    )
     );
     /* anon sub prototypes contains state vars should always be cloned,
      * otherwise the state var would be shared between anon subs */
@@ -490,6 +489,11 @@
 	}
     }
 
+    /* Call the op_free hook if it has been set. Do it now so that it's called
+     * at the right time for refcounted ops, but still before all of the kids
+     * are freed. */
+    CALL_OPFREEHOOK(o);
+
     if (o->op_flags & OPf_KIDS) {
         register OP *kid, *nextkid;
 	for (kid = cUNOPo->op_first; kid; kid = nextkid) {
@@ -504,10 +508,9 @@
 
     /* COP* is not cleared by op_clear() so that we may track line
      * numbers etc even after null() */
-    if (type == OP_NEXTSTATE || type == OP_SETSTATE || type == OP_DBSTATE
+    if (type == OP_NEXTSTATE || type == OP_DBSTATE
 	    || (type == OP_NULL /* the COP might have been null'ed */
 		&& ((OPCODE)o->op_targ == OP_NEXTSTATE
-		    || (OPCODE)o->op_targ == OP_SETSTATE
 		    || (OPCODE)o->op_targ == OP_DBSTATE))) {
 	cop_free((COP*)o);
     }
@@ -559,6 +562,7 @@
 	    o->op_targ = 0;
 	    goto retry;
 	}
+    case OP_ENTERTRY:
     case OP_ENTEREVAL:	/* Was holding hints. */
 	o->op_targ = 0;
 	break;
@@ -572,6 +576,29 @@
     case OP_AELEMFAST:
 	if (! (o->op_type == OP_AELEMFAST && o->op_flags & OPf_SPECIAL)) {
 	    /* not an OP_PADAV replacement */
+	    GV *gv = (o->op_type == OP_GV || o->op_type == OP_GVSV)
+#ifdef USE_ITHREADS
+			&& PL_curpad
+#endif
+			? cGVOPo_gv : NULL;
+	    /* It's possible during global destruction that the GV is freed
+	       before the optree. Whilst the SvREFCNT_inc is happy to bump from
+	       0 to 1 on a freed SV, the corresponding SvREFCNT_dec from 1 to 0
+	       will trigger an assertion failure, because the entry to sv_clear
+	       checks that the scalar is not already freed.  A check of for
+	       !SvIS_FREED(gv) turns out to be invalid, because during global
+	       destruction the reference count can be forced down to zero
+	       (with SVf_BREAK set).  In which case raising to 1 and then
+	       dropping to 0 triggers cleanup before it should happen.  I
+	       *think* that this might actually be a general, systematic,
+	       weakness of the whole idea of SVf_BREAK, in that code *is*
+	       allowed to raise and lower references during global destruction,
+	       so any *valid* code that happens to do this during global
+	       destruction might well trigger premature cleanup.  */
+	    bool still_valid = gv && SvREFCNT(gv);
+
+	    if (still_valid)
+		SvREFCNT_inc_simple_void(gv);
 #ifdef USE_ITHREADS
 	    if (cPADOPo->op_padix > 0) {
 		/* No GvIN_PAD_off(cGVOPo_gv) here, because other references
@@ -583,10 +610,17 @@
 	    SvREFCNT_dec(cSVOPo->op_sv);
 	    cSVOPo->op_sv = NULL;
 #endif
+	    if (still_valid) {
+		int try_downgrade = SvREFCNT(gv) == 2;
+		SvREFCNT_dec(gv);
+		if (try_downgrade)
+		    gv_try_downgrade(gv);
+	    }
 	}
 	break;
     case OP_METHOD_NAMED:
     case OP_CONST:
+    case OP_HINTSEVAL:
 	SvREFCNT_dec(cSVOPo->op_sv);
 	cSVOPo->op_sv = NULL;
 #ifdef USE_ITHREADS
@@ -653,11 +687,11 @@
          */
 #ifdef USE_ITHREADS
 	if(PL_regex_pad) {        /* We could be in destruction */
+	    const IV offset = (cPMOPo)->op_pmoffset;
 	    ReREFCNT_dec(PM_GETRE(cPMOPo));
-            av_push((AV*) PL_regex_pad[0],(SV*) PL_regex_pad[(cPMOPo)->op_pmoffset]);
-            SvREADONLY_off(PL_regex_pad[(cPMOPo)->op_pmoffset]);
-	    SvREPADTMP_on(PL_regex_pad[(cPMOPo)->op_pmoffset]);
-            PM_SETRE_OFFSET(cPMOPo, (cPMOPo)->op_pmoffset);
+	    PL_regex_pad[offset] = &PL_sv_undef;
+            sv_catpvn_nomg(PL_regex_pad[0], (const char *)&offset,
+			   sizeof(offset));
         }
 #else
 	ReREFCNT_dec(PM_GETRE(cPMOPo));
@@ -678,7 +712,6 @@
 {
     PERL_ARGS_ASSERT_COP_FREE;
 
-    CopLABEL_free(cop);
     CopFILE_free(cop);
     CopSTASH_free(cop);
     if (! specialWARN(cop->cop_warnings))
@@ -786,8 +819,8 @@
 
 #define LINKLIST(o) ((o)->op_next ? (o)->op_next : linklist((OP*)o))
 
-OP *
-Perl_linklist(pTHX_ OP *o)
+static OP *
+S_linklist(pTHX_ OP *o)
 {
     OP *first;
 
@@ -818,8 +851,8 @@
     return o->op_next;
 }
 
-OP *
-Perl_scalarkids(pTHX_ OP *o)
+static OP *
+S_scalarkids(pTHX_ OP *o)
 {
     if (o && o->op_flags & OPf_KIDS) {
         OP *kid;
@@ -875,12 +908,8 @@
 	for (kid = cUNOPo->op_first->op_sibling; kid; kid = kid->op_sibling)
 	    scalar(kid);
 	break;
-    case OP_SPLIT:
-	if ((kid = cLISTOPo->op_first) && kid->op_type == OP_PUSHRE) {
-	    if (!kPMOP->op_pmreplrootu.op_pmreplroot)
-		deprecate_old("implicit split to @_");
-	}
 	/* FALL THROUGH */
+    case OP_SPLIT:
     case OP_MATCH:
     case OP_QR:
     case OP_SUBST:
@@ -915,8 +944,7 @@
 	PL_curcop = &PL_compiling;
 	break;
     case OP_SORT:
-	if (ckWARN(WARN_VOID))
-	    Perl_warner(aTHX_ packWARN(WARN_VOID), "Useless use of sort in scalar context");
+	Perl_ck_warner(aTHX_ packWARN(WARN_VOID), "Useless use of sort in scalar context");
 	break;
     }
     return o;
@@ -949,10 +977,8 @@
     }
 
     if (o->op_type == OP_NEXTSTATE
-	|| o->op_type == OP_SETSTATE
 	|| o->op_type == OP_DBSTATE
 	|| (o->op_type == OP_NULL && (o->op_targ == OP_NEXTSTATE
-				      || o->op_targ == OP_SETSTATE
 				      || o->op_targ == OP_DBSTATE)))
 	PL_curcop = (COP*)o;		/* for warning below */
 
@@ -960,7 +986,7 @@
     want = o->op_flags & OPf_WANT;
     if ((want && want != OPf_WANT_SCALAR)
 	 || (PL_parser && PL_parser->error_count)
-	 || o->op_type == OP_RETURN)
+	 || o->op_type == OP_RETURN || o->op_type == OP_REQUIRE)
     {
 	return o;
     }
@@ -1061,6 +1087,17 @@
 	    useless = OP_DESC(o);
 	break;
 
+    case OP_SPLIT:
+	kid = cLISTOPo->op_first;
+	if (kid && kid->op_type == OP_PUSHRE
+#ifdef USE_ITHREADS
+		&& !((PMOP*)kid)->op_pmreplrootu.op_pmtargetoff)
+#else
+		&& !((PMOP*)kid)->op_pmreplrootu.op_pmtargetgv)
+#endif
+	    useless = OP_DESC(o);
+	break;
+
     case OP_NOT:
        kid = cUNOPo->op_first;
        if (kid->op_type != OP_MATCH && kid->op_type != OP_SUBST &&
@@ -1085,7 +1122,13 @@
 	    no_bareword_allowed(o);
 	else {
 	    if (ckWARN(WARN_VOID)) {
-		useless = "a constant";
+		if (SvOK(sv)) {
+		    SV* msv = sv_2mortal(Perl_newSVpvf(aTHX_
+				"a constant (%"SVf")", sv));
+		    useless = SvPV_nolen(msv);
+		}
+		else
+		    useless = "a constant (undef)";
 		if (o->op_private & OPpCONST_ARYBASE)
 		    useless = NULL;
 		/* don't warn on optimised away booleans, eg 
@@ -1137,6 +1180,20 @@
 
     case OP_OR:
     case OP_AND:
+	kid = cLOGOPo->op_first;
+	if (kid->op_type == OP_NOT
+	    && (kid->op_flags & OPf_KIDS)
+	    && !PL_madskills) {
+	    if (o->op_type == OP_AND) {
+		o->op_type = OP_OR;
+		o->op_ppaddr = PL_ppaddr[OP_OR];
+	    } else {
+		o->op_type = OP_AND;
+		o->op_ppaddr = PL_ppaddr[OP_AND];
+	    }
+	    op_null(kid);
+	}
+
     case OP_DOR:
     case OP_COND_EXPR:
     case OP_ENTERGIVEN:
@@ -1170,26 +1227,16 @@
     case OP_ENTEREVAL:
 	scalarkids(o);
 	break;
-    case OP_REQUIRE:
-	/* all requires must return a boolean value */
-	o->op_flags &= ~OPf_WANT;
-	/* FALL THROUGH */
     case OP_SCALAR:
 	return scalar(o);
-    case OP_SPLIT:
-	if ((kid = cLISTOPo->op_first) && kid->op_type == OP_PUSHRE) {
-	    if (!kPMOP->op_pmreplrootu.op_pmreplroot)
-		deprecate_old("implicit split to @_");
-	}
-	break;
     }
-    if (useless && ckWARN(WARN_VOID))
-	Perl_warner(aTHX_ packWARN(WARN_VOID), "Useless use of %s in void context", useless);
+    if (useless)
+	Perl_ck_warner(aTHX_ packWARN(WARN_VOID), "Useless use of %s in void context", useless);
     return o;
 }
 
-OP *
-Perl_listkids(pTHX_ OP *o)
+static OP *
+S_listkids(pTHX_ OP *o)
 {
     if (o && o->op_flags & OPf_KIDS) {
         OP *kid;
@@ -1268,16 +1315,12 @@
 	}
 	PL_curcop = &PL_compiling;
 	break;
-    case OP_REQUIRE:
-	/* all requires must return a boolean value */
-	o->op_flags &= ~OPf_WANT;
-	return scalar(o);
     }
     return o;
 }
 
-OP *
-Perl_scalarseq(pTHX_ OP *o)
+static OP *
+S_scalarseq(pTHX_ OP *o)
 {
     dVAR;
     if (o) {
@@ -1536,12 +1579,17 @@
     case OP_DBSTATE:
        PL_modcount = RETURN_UNLIMITED_NUMBER;
 	break;
+    case OP_AV2ARYLEN:
+	PL_hints |= HINT_BLOCK_SCOPE;
+	if (type == OP_LEAVESUBLV)
+	    o->op_private |= OPpMAYBE_LVSUB;
+	PL_modcount++;
+	break;
     case OP_RV2SV:
 	ref(cUNOPo->op_first, o->op_type);
 	localize = 1;
 	/* FALL THROUGH */
     case OP_GV:
-    case OP_AV2ARYLEN:
 	PL_hints |= HINT_BLOCK_SCOPE;
     case OP_SASSIGN:
     case OP_ANDASSIGN:
@@ -1662,10 +1710,8 @@
 	case 0:
 	    break;
 	case -1:
-	    if (ckWARN(WARN_SYNTAX)) {
-		Perl_warner(aTHX_ packWARN(WARN_SYNTAX),
-		    "Useless localization of %s", OP_DESC(o));
-	    }
+	    Perl_ck_warner(aTHX_ packWARN(WARN_SYNTAX),
+			   "Useless localization of %s", OP_DESC(o));
 	}
     }
     else if (type != OP_GREPSTART && type != OP_ENTERSUB
@@ -1749,8 +1795,8 @@
     }
 }
 
-OP *
-Perl_refkids(pTHX_ OP *o, I32 type)
+static OP *
+S_refkids(pTHX_ OP *o, I32 type)
 {
     if (o && o->op_flags & OPf_KIDS) {
         OP *kid;
@@ -2135,14 +2181,6 @@
 }
 
 OP *
-Perl_my(pTHX_ OP *o)
-{
-    PERL_ARGS_ASSERT_MY;
-
-    return my_attrs(o, NULL);
-}
-
-OP *
 Perl_sawparens(pTHX_ OP *o)
 {
     PERL_UNUSED_CONTEXT;
@@ -2281,7 +2319,7 @@
 S_newDEFSVOP(pTHX)
 {
     dVAR;
-    const PADOFFSET offset = pad_findmy("$_");
+    const PADOFFSET offset = Perl_pad_findmy(aTHX_ STR_WITH_LEN("$_"), 0);
     if (offset == NOT_IN_PAD || PAD_COMPNAME_FLAGS_isOUR(offset)) {
 	return newSVREF(newGVOP(OP_GV, 0, PL_defgv));
     }
@@ -2329,8 +2367,7 @@
 
 	/* Register with debugger */
 	if (PERLDB_INTER) {
-	    CV * const cv
-		= Perl_get_cvn_flags(aTHX_ STR_WITH_LEN("DB::postponed"), 0);
+	    CV * const cv = get_cvs("DB::postponed", 0);
 	    if (cv) {
 		dSP;
 		PUSHMARK(SP);
@@ -2417,8 +2454,8 @@
     return o;
 }
 
-OP *
-Perl_fold_constants(pTHX_ register OP *o)
+static OP *
+S_fold_constants(pTHX_ register OP *o)
 {
     dVAR;
     register OP * VOL curop;
@@ -2558,8 +2595,8 @@
     return o;
 }
 
-OP *
-Perl_gen_constant_list(pTHX_ register OP *o)
+static OP *
+S_gen_constant_list(pTHX_ register OP *o)
 {
     dVAR;
     register OP *curop;
@@ -2764,7 +2801,7 @@
     /* faked up qw list? */
     if (slot == '(' &&
 	tm->mad_type == MAD_SV &&
-	SvPVX((const SV *)tm->mad_val)[0] == 'q')
+	SvPVX((SV *)tm->mad_val)[0] == 'q')
 	    slot = 'x';
 
     if (o) {
@@ -2921,7 +2958,7 @@
 }
 
 MADPROP *
-Perl_newMADPROP(pTHX_ char key, char type, const void* val, I32 vlen)
+Perl_newMADPROP(pTHX_ char key, char type, void* val, I32 vlen)
 {
     MADPROP *mp;
     Newxz(mp, 1, MADPROP);
@@ -2972,8 +3009,8 @@
     return newOP(OP_STUB, 0);
 }
 
-OP *
-Perl_force_list(pTHX_ OP *o)
+static OP *
+S_force_list(pTHX_ OP *o)
 {
     if (!o || o->op_type != OP_LIST)
 	o = newLISTOP(OP_LIST, 0, o, NULL);
@@ -2987,6 +3024,8 @@
     dVAR;
     LISTOP *listop;
 
+    assert((PL_opargs[type] & OA_CLASS_MASK) == OA_LISTOP);
+
     NewOp(1101, listop, 1, LISTOP);
 
     listop->op_type = (OPCODE)type;
@@ -3020,6 +3059,12 @@
 {
     dVAR;
     OP *o;
+
+    assert((PL_opargs[type] & OA_CLASS_MASK) == OA_BASEOP
+	|| (PL_opargs[type] & OA_CLASS_MASK) == OA_BASEOP_OR_UNOP
+	|| (PL_opargs[type] & OA_CLASS_MASK) == OA_FILESTATOP
+	|| (PL_opargs[type] & OA_CLASS_MASK) == OA_LOOPEXOP);
+
     NewOp(1101, o, 1, OP);
     o->op_type = (OPCODE)type;
     o->op_ppaddr = PL_ppaddr[type];
@@ -3043,6 +3088,14 @@
     dVAR;
     UNOP *unop;
 
+    assert((PL_opargs[type] & OA_CLASS_MASK) == OA_UNOP
+	|| (PL_opargs[type] & OA_CLASS_MASK) == OA_BASEOP_OR_UNOP
+	|| (PL_opargs[type] & OA_CLASS_MASK) == OA_FILESTATOP
+	|| (PL_opargs[type] & OA_CLASS_MASK) == OA_LOOPEXOP
+	|| type == OP_SASSIGN
+	|| type == OP_ENTERTRY
+	|| type == OP_NULL );
+
     if (!first)
 	first = newOP(OP_STUB, 0);
     if (PL_opargs[type] & OA_MARK)
@@ -3066,6 +3119,10 @@
 {
     dVAR;
     BINOP *binop;
+
+    assert((PL_opargs[type] & OA_CLASS_MASK) == OA_BINOP
+	|| type == OP_SASSIGN || type == OP_NULL );
+
     NewOp(1101, binop, 1, BINOP);
 
     if (!first)
@@ -3110,8 +3167,8 @@
     return 0;
 }
 
-OP *
-Perl_pmtrans(pTHX_ OP *o, OP *expr, OP *repl)
+static OP *
+S_pmtrans(pTHX_ OP *o, OP *expr, OP *repl)
 {
     dVAR;
     SV * const tstr = ((SVOP*)expr)->op_sv;
@@ -3435,6 +3492,13 @@
 	    }
 	}
     }
+
+    if(del && rlen == tlen) {
+	Perl_ck_warner(aTHX_ packWARN(WARN_MISC), "Useless use of /d modifier in transliteration operator"); 
+    } else if(rlen > tlen) {
+	Perl_ck_warner(aTHX_ packWARN(WARN_MISC), "Replacement list is longer than search list");
+    }
+
     if (grows)
 	o->op_private |= OPpTRANS_GROWS;
 #ifdef PERL_MAD
@@ -3454,6 +3518,8 @@
     dVAR;
     PMOP *pmop;
 
+    assert((PL_opargs[type] & OA_CLASS_MASK) == OA_PMOP);
+
     NewOp(1101, pmop, 1, PMOP);
     pmop->op_type = (OPCODE)type;
     pmop->op_ppaddr = PL_ppaddr[type];
@@ -3467,14 +3533,23 @@
 
 
 #ifdef USE_ITHREADS
-    if (av_len((AV*) PL_regex_pad[0]) > -1) {
-	SV * const repointer = av_pop((AV*)PL_regex_pad[0]);
-	pmop->op_pmoffset = SvIV(repointer);
-	SvREPADTMP_off(repointer);
-	sv_setiv(repointer,0);
+    assert(SvPOK(PL_regex_pad[0]));
+    if (SvCUR(PL_regex_pad[0])) {
+	/* Pop off the "packed" IV from the end.  */
+	SV *const repointer_list = PL_regex_pad[0];
+	const char *p = SvEND(repointer_list) - sizeof(IV);
+	const IV offset = *((IV*)p);
+
+	assert(SvCUR(repointer_list) % sizeof(IV) == 0);
+
+	SvEND_set(repointer_list, p);
+
+	pmop->op_pmoffset = offset;
+	/* This slot should be free, so assert this:  */
+	assert(PL_regex_pad[offset] == &PL_sv_undef);
     } else {
-	SV * const repointer = newSViv(0);
-	av_push(PL_regex_padav, SvREFCNT_inc_simple_NN(repointer));
+	SV * const repointer = &PL_sv_undef;
+	av_push(PL_regex_padav, repointer);
 	pmop->op_pmoffset = av_len(PL_regex_padav);
 	PL_regex_pad = AvARRAY(PL_regex_padav);
     }
@@ -3541,14 +3616,23 @@
     pm = (PMOP*)o;
 
     if (expr->op_type == OP_CONST) {
-	SV * const pat = ((SVOP*)expr)->op_sv;
+	SV *pat = ((SVOP*)expr)->op_sv;
 	U32 pm_flags = pm->op_pmflags & PMf_COMPILETIME;
 
 	if (o->op_flags & OPf_SPECIAL)
 	    pm_flags |= RXf_SPLIT;
 
-	if (DO_UTF8(pat))
-	    pm_flags |= RXf_UTF8;
+	if (DO_UTF8(pat)) {
+	    assert (SvUTF8(pat));
+	} else if (SvUTF8(pat)) {
+	    /* Not doing UTF-8, despite what the SV says. Is this only if we're
+	       trapped in use 'bytes'?  */
+	    /* Make a copy of the octet sequence, but without the flag on, as
+	       the compiler now honours the SvUTF8 flag on pat.  */
+	    STRLEN len;
+	    const char *const p = SvPV(pat, len);
+	    pat = newSVpvn_flags(p, len, SVs_TEMP);
+	}
 
 	PM_SETRE(pm, CALLREGCOMP(pat, pm_flags));
 
@@ -3680,6 +3764,10 @@
 
     PERL_ARGS_ASSERT_NEWSVOP;
 
+    assert((PL_opargs[type] & OA_CLASS_MASK) == OA_SVOP
+	|| (PL_opargs[type] & OA_CLASS_MASK) == OA_PVOP_OR_SVOP
+	|| (PL_opargs[type] & OA_CLASS_MASK) == OA_FILESTATOP);
+
     NewOp(1101, svop, 1, SVOP);
     svop->op_type = (OPCODE)type;
     svop->op_ppaddr = PL_ppaddr[type];
@@ -3702,6 +3790,10 @@
 
     PERL_ARGS_ASSERT_NEWPADOP;
 
+    assert((PL_opargs[type] & OA_CLASS_MASK) == OA_SVOP
+	|| (PL_opargs[type] & OA_CLASS_MASK) == OA_PVOP_OR_SVOP
+	|| (PL_opargs[type] & OA_CLASS_MASK) == OA_FILESTATOP);
+
     NewOp(1101, padop, 1, PADOP);
     padop->op_type = (OPCODE)type;
     padop->op_ppaddr = PL_ppaddr[type];
@@ -3740,6 +3832,10 @@
 {
     dVAR;
     PVOP *pvop;
+
+    assert((PL_opargs[type] & OA_CLASS_MASK) == OA_PVOP_OR_SVOP
+	|| (PL_opargs[type] & OA_CLASS_MASK) == OA_LOOPEXOP);
+
     NewOp(1101, pvop, 1, PVOP);
     pvop->op_type = (OPCODE)type;
     pvop->op_ppaddr = PL_ppaddr[type];
@@ -3793,6 +3889,18 @@
 #endif
 }
 
+void
+Perl_package_version( pTHX_ OP *v )
+{
+    dVAR;
+    U32 savehints = PL_hints;
+    PERL_ARGS_ASSERT_PACKAGE_VERSION;
+    PL_hints &= ~HINT_STRICT_VARS;
+    sv_setsv( GvSV(gv_fetchpvs("VERSION", GV_ADDMULTI, SVt_PV)), cSVOPx(v)->op_sv );
+    PL_hints = savehints;
+    op_free(v);
+}
+
 #ifdef PERL_MAD
 OP*
 #else
@@ -3831,7 +3939,7 @@
 	    SV *meth;
 
 	    if (version->op_type != OP_CONST || !SvNIOKp(vesv))
-		Perl_croak(aTHX_ "Version number must be constant number");
+		Perl_croak(aTHX_ "Version number must be a constant number");
 
 	    /* Make copy of idop so we don't free it twice */
 	    pack = newSVOP(OP_CONST, 0, newSVsv(((SVOP*)idop)->op_sv));
@@ -4171,7 +4279,7 @@
 		    || left->op_type == OP_PADHV
 		    || left->op_type == OP_PADANY))
 	{
-	    maybe_common_vars = FALSE;
+	    if (left->op_type == OP_PADSV) maybe_common_vars = FALSE;
 	    if (left->op_private & OPpPAD_STATE) {
 		/* All single variable list context state assignments, hence
 		   state ($a) = ...
@@ -4325,6 +4433,7 @@
 	    PL_eval_start = 0;
 	else {
 	    if (!PL_madskills) { /* assignment to $[ is ignored when making a mad dump */
+		deprecate("assignment to $[");
 		op_free(o);
 		o = newSVOP(OP_CONST, 0, newSViv(CopARYBASE_get(&PL_compiling)));
 		o->op_private |= OPpCONST_ARYBASE;
@@ -4358,10 +4467,6 @@
     CopHINTS_set(&PL_compiling, CopHINTS_get(cop));
     cop->op_next = (OP*)cop;
 
-    if (label) {
-	CopLABEL_set(cop, label);
-	PL_hints |= HINT_BLOCK_SCOPE;
-    }
     cop->cop_seq = seq;
     /* CopARYBASE is now "virtual", in that it's stored as a flag bit in
        CopHINTS and a possible value in cop_hints_hash, so no need to copy it.
@@ -4373,6 +4478,16 @@
 	cop->cop_hints_hash->refcounted_he_refcnt++;
 	HINTS_REFCNT_UNLOCK;
     }
+    if (label) {
+	cop->cop_hints_hash
+	    = Perl_store_cop_label(aTHX_ cop->cop_hints_hash, label);
+						     
+	PL_hints |= HINT_BLOCK_SCOPE;
+	/* It seems that we need to defer freeing this pointer, as other parts
+	   of the grammar end up wanting to copy it after this op has been
+	   created. */
+	SAVEFREEPV(label);
+    }
 
     if (PL_parser && PL_parser->copline == NOLINE)
         CopLINE_set(cop, CopLINE(PL_curcop));
@@ -4419,6 +4534,8 @@
 STATIC OP *
 S_search_const(pTHX_ OP *o)
 {
+    PERL_ARGS_ASSERT_SEARCH_CONST;
+
     switch (o->op_type) {
 	case OP_CONST:
 	    return o;
@@ -4466,40 +4583,43 @@
     OP *first;
     OP *other;
     OP *cstop = NULL;
+    int prepend_not = 0;
+
+    PERL_ARGS_ASSERT_NEW_LOGOP;
 
     first = *firstp;
     other = *otherp;
 
-    PERL_ARGS_ASSERT_NEW_LOGOP;
-
     if (type == OP_XOR)		/* Not short circuit, but here by precedence. */
 	return newBINOP(type, flags, scalar(first), scalar(other));
 
+    assert((PL_opargs[type] & OA_CLASS_MASK) == OA_LOGOP);
+
     scalarboolean(first);
-    /* optimize "!a && b" to "a || b", and "!a || b" to "a && b" */
+    /* optimize AND and OR ops that have NOTs as children */
     if (first->op_type == OP_NOT
-	&& (first->op_flags & OPf_SPECIAL)
 	&& (first->op_flags & OPf_KIDS)
+	&& ((first->op_flags & OPf_SPECIAL) /* unless ($x) { } */
+	    || (other->op_type == OP_NOT))  /* if (!$x && !$y) { } */
 	&& !PL_madskills) {
 	if (type == OP_AND || type == OP_OR) {
 	    if (type == OP_AND)
 		type = OP_OR;
 	    else
 		type = OP_AND;
-	    o = first;
-	    first = *firstp = cUNOPo->op_first;
-	    if (o->op_next)
-		first->op_next = o->op_next;
-	    cUNOPo->op_first = NULL;
-	    op_free(o);
+	    op_null(first);
+	    if (other->op_type == OP_NOT) { /* !a AND|OR !b => !(a OR|AND b) */
+		op_null(other);
+		prepend_not = 1; /* prepend a NOT op later */
+	    }
 	}
     }
     /* search for a constant op that could let us fold the test */
     if ((cstop = search_const(first))) {
 	if (cstop->op_private & OPpCONST_STRICT)
 	    no_bareword_allowed(cstop);
-	else if ((cstop->op_private & OPpCONST_BARE) && ckWARN(WARN_BAREWORD))
-		Perl_warner(aTHX_ packWARN(WARN_BAREWORD), "Bareword found in conditional");
+	else if ((cstop->op_private & OPpCONST_BARE))
+		Perl_ck_warner(aTHX_ packWARN(WARN_BAREWORD), "Bareword found in conditional");
 	if ((type == OP_AND &&  SvTRUE(((SVOP*)cstop)->op_sv)) ||
 	    (type == OP_OR  && !SvTRUE(((SVOP*)cstop)->op_sv)) ||
 	    (type == OP_DOR && !SvOK(((SVOP*)cstop)->op_sv))) {
@@ -4513,6 +4633,8 @@
 		return newop;
 	    }
 	    op_free(first);
+	    if (other->op_type == OP_LEAVE)
+		other = newUNOP(OP_NULL, OPf_SPECIAL, other);
 	    return other;
 	}
 	else {
@@ -4527,11 +4649,10 @@
 	    if ((o2->op_type == OP_PADSV || o2->op_type == OP_PADAV
 			|| o2->op_type == OP_PADHV)
 		&& o2->op_private & OPpLVAL_INTRO
-		&& !(o2->op_private & OPpPAD_STATE)
-		&& ckWARN(WARN_DEPRECATED))
+		&& !(o2->op_private & OPpPAD_STATE))
 	    {
-		Perl_warner(aTHX_ packWARN(WARN_DEPRECATED),
-			    "Deprecated use of my() in false conditional");
+		Perl_ck_warner_d(aTHX_ packWARN(WARN_DEPRECATED),
+				 "Deprecated use of my() in false conditional");
 	    }
 
 	    *otherp = NULL;
@@ -4609,7 +4730,7 @@
 
     CHECKOP(type,logop);
 
-    o = newUNOP(OP_NULL, 0, (OP*)logop);
+    o = newUNOP(prepend_not ? OP_NOT : OP_NULL, 0, (OP*)logop);
     other->op_next = o;
 
     return o;
@@ -4650,6 +4771,8 @@
 	    op_free(first);
 	    op_free(dead);
 	}
+	if (live->op_type == OP_LEAVE)
+	    live = newUNOP(OP_NULL, OPf_SPECIAL, live);
 	return live;
     }
     NewOp(1101, logop, 1, LOGOP);
@@ -4741,7 +4864,9 @@
     if (expr) {
 	if (once && expr->op_type == OP_CONST && !SvTRUE(((SVOP*)expr)->op_sv))
 	    return block;	/* do {} while 0 does once */
-	if (expr->op_type == OP_READLINE || expr->op_type == OP_GLOB
+	if (expr->op_type == OP_READLINE
+	    || expr->op_type == OP_READDIR
+	    || expr->op_type == OP_GLOB
 	    || (expr->op_type == OP_NULL && expr->op_targ == OP_GLOB)) {
 	    expr = newUNOP(OP_DEFINED, 0,
 		newASSIGNOP(0, newDEFSVOP(), 0, expr) );
@@ -4750,7 +4875,7 @@
 	    const OP * const k2 = k1 ? k1->op_sibling : NULL;
 	    switch (expr->op_type) {
 	      case OP_NULL:
-		if (k2 && k2->op_type == OP_READLINE
+		if (k2 && (k2->op_type == OP_READLINE || k2->op_type == OP_READDIR)
 		      && (k2->op_flags & OPf_STACKED)
 		      && ((k1->op_flags & OPf_WANT) == OPf_WANT_SCALAR))
 		    expr = newUNOP(OP_DEFINED, 0, expr);
@@ -4803,7 +4928,9 @@
     PERL_UNUSED_ARG(debuggable);
 
     if (expr) {
-	if (expr->op_type == OP_READLINE || expr->op_type == OP_GLOB
+	if (expr->op_type == OP_READLINE
+         || expr->op_type == OP_READDIR
+         || expr->op_type == OP_GLOB
 		     || (expr->op_type == OP_NULL && expr->op_targ == OP_GLOB)) {
 	    expr = newUNOP(OP_DEFINED, 0,
 		newASSIGNOP(0, newDEFSVOP(), 0, expr) );
@@ -4812,7 +4939,7 @@
 	    const OP * const k2 = (k1) ? k1->op_sibling : NULL;
 	    switch (expr->op_type) {
 	      case OP_NULL:
-		if (k2 && k2->op_type == OP_READLINE
+		if (k2 && (k2->op_type == OP_READLINE || k2->op_type == OP_READDIR)
 		      && (k2->op_flags & OPf_STACKED)
 		      && ((k1->op_flags & OPf_WANT) == OPf_WANT_SCALAR))
 		    expr = newUNOP(OP_DEFINED, 0, expr);
@@ -4942,7 +5069,7 @@
 	}
     }
     else {
-        const PADOFFSET offset = pad_findmy("$_");
+        const PADOFFSET offset = Perl_pad_findmy(aTHX_ STR_WITH_LEN("$_"), 0);
 	if (offset == NOT_IN_PAD || PAD_COMPNAME_FLAGS_isOUR(offset)) {
 	    sv = newGVOP(OP_GV, 0, PL_defgv);
 	}
@@ -5024,6 +5151,8 @@
 
     PERL_ARGS_ASSERT_NEWLOOPEX;
 
+    assert((PL_opargs[type] & OA_CLASS_MASK) == OA_LOOPEXOP);
+
     if (type != OP_GOTO || label->op_type == OP_CONST) {
 	/* "last()" means "last" */
 	if (label->op_type == OP_STUB && (label->op_flags & OPf_PARENS))
@@ -5153,6 +5282,7 @@
 	     && looks_like_bool(cLOGOPo->op_first->op_sibling));
 
 	case OP_NULL:
+	case OP_SCALAR:
 	    return (
 		o->op_flags & OPf_KIDS
 	    && looks_like_bool(cUNOPo->op_first));
@@ -5353,7 +5483,7 @@
 =cut
 */
 SV *
-Perl_cv_const_sv(pTHX_ CV *cv)
+Perl_cv_const_sv(pTHX_ const CV *const cv)
 {
     PERL_UNUSED_CONTEXT;
     if (!cv)
@@ -5481,7 +5611,6 @@
 Perl_newATTRSUB(pTHX_ I32 floor, OP *o, OP *proto, OP *attrs, OP *block)
 {
     dVAR;
-    const char *aname;
     GV *gv;
     const char *ps;
     STRLEN ps_len;
@@ -5497,6 +5626,7 @@
 	   || PL_madskills)
 	? GV_ADDMULTI : GV_ADDMULTI | GV_NOINIT;
     const char * const name = o ? SvPV_nolen_const(cSVOPo->op_sv) : NULL;
+    bool has_name;
 
     if (proto) {
 	assert(proto->op_type == OP_CONST);
@@ -5505,20 +5635,23 @@
     else
 	ps = NULL;
 
-    if (!name && PERLDB_NAMEANON && CopLINE(PL_curcop)) {
+    if (name) {
+	gv = gv_fetchsv(cSVOPo->op_sv, gv_fetch_flags, SVt_PVCV);
+	has_name = TRUE;
+    } else if (PERLDB_NAMEANON && CopLINE(PL_curcop)) {
 	SV * const sv = sv_newmortal();
 	Perl_sv_setpvf(aTHX_ sv, "%s[%s:%"IVdf"]",
 		       PL_curstash ? "__ANON__" : "__ANON__::__ANON__",
 		       CopFILE(PL_curcop), (IV)CopLINE(PL_curcop));
-	aname = SvPVX_const(sv);
+	gv = gv_fetchsv(sv, gv_fetch_flags, SVt_PVCV);
+	has_name = TRUE;
+    } else if (PL_curstash) {
+	gv = gv_fetchpvs("__ANON__", gv_fetch_flags, SVt_PVCV);
+	has_name = FALSE;
+    } else {
+	gv = gv_fetchpvs("__ANON__::__ANON__", gv_fetch_flags, SVt_PVCV);
+	has_name = FALSE;
     }
-    else
-	aname = NULL;
-
-    gv = name ? gv_fetchsv(cSVOPo->op_sv, gv_fetch_flags, SVt_PVCV)
-	: gv_fetchpv(aname ? aname
-		     : (PL_curstash ? "__ANON__" : "__ANON__::__ANON__"),
-		     gv_fetch_flags, SVt_PVCV);
 
     if (!PL_madskills) {
 	if (o)
@@ -5533,10 +5666,9 @@
 					   maximum a prototype before. */
 	if (SvTYPE(gv) > SVt_NULL) {
 	    if (!SvPOK((const SV *)gv)
-		&& !(SvIOK((const SV *)gv) && SvIVX((const SV *)gv) == -1)
-		&& ckWARN_d(WARN_PROTOTYPE))
+		&& !(SvIOK((const SV *)gv) && SvIVX((const SV *)gv) == -1))
 	    {
-		Perl_warner(aTHX_ packWARN(WARN_PROTOTYPE), "Runaway prototype");
+		Perl_ck_warner_d(aTHX_ packWARN(WARN_PROTOTYPE), "Runaway prototype");
 	    }
 	    cv_ckproto_len((const CV *)gv, NULL, ps, ps_len);
 	}
@@ -5552,12 +5684,6 @@
 
     cv = (!name || GvCVGEN(gv)) ? NULL : GvCV(gv);
 
-#ifdef GV_UNIQUE_CHECK
-    if (cv && GvUNIQUE(gv) && SvREADONLY(cv)) {
-        Perl_croak(aTHX_ "Can't define subroutine %s (GV is unique)", name);
-    }
-#endif
-
     if (!block || !ps || *ps || attrs
 	|| (CvFLAGS(PL_compcv) & CVf_BUILTIN_ATTRS)
 #ifdef PERL_MAD
@@ -5571,12 +5697,6 @@
     if (cv) {
         const bool exists = CvROOT(cv) || CvXSUB(cv);
 
-#ifdef GV_UNIQUE_CHECK
-        if (exists && GvUNIQUE(gv)) {
-            Perl_croak(aTHX_ "Can't redefine unique subroutine %s", name);
-        }
-#endif
-
         /* if the subroutine doesn't exist and wasn't pre-declared
          * with a prototype, assume it will be AUTOLOADed,
          * skipping the prototype check
@@ -5592,7 +5712,9 @@
 		 )&& !attrs) {
 		if (CvFLAGS(PL_compcv)) {
 		    /* might have had built-in attrs applied */
-		    CvFLAGS(cv) |= (CvFLAGS(PL_compcv) & CVf_BUILTIN_ATTRS);
+		    if (CvLVALUE(PL_compcv) && ! CvLVALUE(cv) && ckWARN(WARN_MISC))
+			Perl_warner(aTHX_ packWARN(WARN_MISC), "lvalue attribute ignored after the subroutine has been defined");
+		    CvFLAGS(cv) |= (CvFLAGS(PL_compcv) & CVf_BUILTIN_ATTRS & ~CVf_LVALUE);
 		}
 		/* just a "sub foo;" when &foo is already defined */
 		SAVEFREESV(PL_compcv);
@@ -5654,69 +5776,35 @@
 	PL_compcv = NULL;
 	goto done;
     }
-    if (attrs) {
-	HV *stash;
-	SV *rcv;
-
-	/* Need to do a C<use attributes $stash_of_cv,\&cv,@attrs>
-	 * before we clobber PL_compcv.
-	 */
-	if (cv && (!block
+    if (cv) {				/* must reuse cv if autoloaded */
+	/* transfer PL_compcv to cv */
+	if (block
 #ifdef PERL_MAD
-		    || block->op_type == OP_NULL
+                  && block->op_type != OP_NULL
 #endif
-		    )) {
-	    rcv = MUTABLE_SV(cv);
-	    /* Might have had built-in attributes applied -- propagate them. */
-	    CvFLAGS(cv) |= (CvFLAGS(PL_compcv) & CVf_BUILTIN_ATTRS);
-	    if (CvGV(cv) && GvSTASH(CvGV(cv)))
-		stash = GvSTASH(CvGV(cv));
-	    else if (CvSTASH(cv))
-		stash = CvSTASH(cv);
-	    else
-		stash = PL_curstash;
+	) {
+	    cv_flags_t existing_builtin_attrs = CvFLAGS(cv) & CVf_BUILTIN_ATTRS;
+	    cv_undef(cv);
+	    CvFLAGS(cv) = CvFLAGS(PL_compcv) | existing_builtin_attrs;
+	    if (!CvWEAKOUTSIDE(cv))
+		SvREFCNT_dec(CvOUTSIDE(cv));
+	    CvOUTSIDE(cv) = CvOUTSIDE(PL_compcv);
+	    CvOUTSIDE_SEQ(cv) = CvOUTSIDE_SEQ(PL_compcv);
+	    CvOUTSIDE(PL_compcv) = 0;
+	    CvPADLIST(cv) = CvPADLIST(PL_compcv);
+	    CvPADLIST(PL_compcv) = 0;
+	    /* inner references to PL_compcv must be fixed up ... */
+	    pad_fixup_inner_anons(CvPADLIST(cv), PL_compcv, cv);
+	    if (PERLDB_INTER)/* Advice debugger on the new sub. */
+	      ++PL_sub_generation;
 	}
 	else {
-	    /* possibly about to re-define existing subr -- ignore old cv */
-	    rcv = MUTABLE_SV(PL_compcv);
-	    if (name && GvSTASH(gv))
-		stash = GvSTASH(gv);
-	    else
-		stash = PL_curstash;
-	}
-	apply_attrs(stash, rcv, attrs, FALSE);
-    }
-    if (cv) {				/* must reuse cv if autoloaded */
-	if (
-#ifdef PERL_MAD
-	    (
-#endif
-	     !block
-#ifdef PERL_MAD
-	     || block->op_type == OP_NULL) && !PL_madskills
-#endif
-	     ) {
-	    /* got here with just attrs -- work done, so bug out */
-	    SAVEFREESV(PL_compcv);
-	    goto done;
+	    /* Might have had built-in attributes applied -- propagate them. */
+	    CvFLAGS(cv) |= (CvFLAGS(PL_compcv) & CVf_BUILTIN_ATTRS);
 	}
-	/* transfer PL_compcv to cv */
-	cv_undef(cv);
-	CvFLAGS(cv) = CvFLAGS(PL_compcv);
-	if (!CvWEAKOUTSIDE(cv))
-	    SvREFCNT_dec(CvOUTSIDE(cv));
-	CvOUTSIDE(cv) = CvOUTSIDE(PL_compcv);
-	CvOUTSIDE_SEQ(cv) = CvOUTSIDE_SEQ(PL_compcv);
-	CvOUTSIDE(PL_compcv) = 0;
-	CvPADLIST(cv) = CvPADLIST(PL_compcv);
-	CvPADLIST(PL_compcv) = 0;
-	/* inner references to PL_compcv must be fixed up ... */
-	pad_fixup_inner_anons(CvPADLIST(cv), PL_compcv, cv);
 	/* ... before we throw it away */
 	SvREFCNT_dec(PL_compcv);
 	PL_compcv = cv;
-	if (PERLDB_INTER)/* Advice debugger on the new sub. */
-	  ++PL_sub_generation;
     }
     else {
 	cv = PL_compcv;
@@ -5725,16 +5813,24 @@
 	    if (PL_madskills) {
 		if (strEQ(name, "import")) {
 		    PL_formfeed = MUTABLE_SV(cv);
-		    Perl_warner(aTHX_ packWARN(WARN_VOID), "%lx\n", (long)cv);
+		    /* diag_listed_as: SKIPME */
+		    Perl_warner(aTHX_ packWARN(WARN_VOID), "0x%"UVxf"\n", PTR2UV(cv));
 		}
 	    }
 	    GvCVGEN(gv) = 0;
             mro_method_changed_in(GvSTASH(gv)); /* sub Foo::bar { (shift)+1 } */
 	}
     }
-    CvGV(cv) = gv;
-    CvFILE_set_from_cop(cv, PL_curcop);
-    CvSTASH(cv) = PL_curstash;
+    if (!CvGV(cv)) {
+	CvGV(cv) = gv;
+	CvFILE_set_from_cop(cv, PL_curcop);
+	CvSTASH(cv) = PL_curstash;
+    }
+    if (attrs) {
+	/* Need to do a C<use attributes $stash_of_cv,\&cv,@attrs>. */
+	HV *stash = name && GvSTASH(CvGV(cv)) ? GvSTASH(CvGV(cv)) : PL_curstash;
+	apply_attrs(stash, MUTABLE_SV(cv), attrs, FALSE);
+    }
 
     if (ps)
 	sv_setpvn(MUTABLE_SV(cv), ps, ps_len);
@@ -5804,7 +5900,7 @@
 	    CvCONST_on(cv);
     }
 
-    if (name || aname) {
+    if (has_name) {
 	if (PERLDB_SUBLINE && PL_curstash != PL_debstash) {
 	    SV * const sv = newSV(0);
 	    SV * const tmpstr = sv_newmortal();
@@ -5885,18 +5981,18 @@
 		return;
 	} else if (*name == 'C') {
 	    if (strEQ(name, "CHECK")) {
-		if (PL_main_start && ckWARN(WARN_VOID))
-		    Perl_warner(aTHX_ packWARN(WARN_VOID),
-				"Too late to run CHECK block");
+		if (PL_main_start)
+		    Perl_ck_warner(aTHX_ packWARN(WARN_VOID),
+				   "Too late to run CHECK block");
 		Perl_av_create_and_unshift_one(aTHX_ &PL_checkav, MUTABLE_SV(cv));
 	    }
 	    else
 		return;
 	} else if (*name == 'I') {
 	    if (strEQ(name, "INIT")) {
-		if (PL_main_start && ckWARN(WARN_VOID))
-		    Perl_warner(aTHX_ packWARN(WARN_VOID),
-				"Too late to run INIT block");
+		if (PL_main_start)
+		    Perl_ck_warner(aTHX_ packWARN(WARN_VOID),
+				   "Too late to run INIT block");
 		Perl_av_create_and_push(aTHX_ &PL_initav, MUTABLE_SV(cv));
 	    }
 	    else
@@ -5914,6 +6010,11 @@
 Creates a constant sub equivalent to Perl C<sub FOO () { 123 }> which is
 eligible for inlining at compile-time.
 
+Passing NULL for SV creates a constant sub equivalent to C<sub BAR () {}>,
+which won't be called if used as a destructor, but will suppress the overhead
+of a call to C<AUTOLOAD>.  (This form, however, isn't eligible for inlining at
+compile time.)
+
 =cut
 */
 
@@ -6114,11 +6215,6 @@
 	? gv_fetchsv(cSVOPo->op_sv, GV_ADD, SVt_PVFM)
 	: gv_fetchpvs("STDOUT", GV_ADD|GV_NOTQUAL, SVt_PVFM);
 
-#ifdef GV_UNIQUE_CHECK
-    if (GvUNIQUE(gv)) {
-        Perl_croak(aTHX_ "Bad symbol for form (GV is unique)");
-    }
-#endif
     GvMULTI_on(gv);
     if ((cv = GvFORM(gv))) {
 	if (ckWARN(WARN_REDEFINE)) {
@@ -6209,8 +6305,7 @@
 	break;
 
     default:
-	if (ckWARN_d(WARN_INTERNAL))
-	    Perl_warner(aTHX_ packWARN(WARN_INTERNAL), "oops: oopsAV");
+	Perl_ck_warner_d(aTHX_ packWARN(WARN_INTERNAL), "oops: oopsAV");
 	break;
     }
     return o;
@@ -6238,8 +6333,7 @@
 	break;
 
     default:
-	if (ckWARN_d(WARN_INTERNAL))
-	    Perl_warner(aTHX_ packWARN(WARN_INTERNAL), "oops: oopsHV");
+	Perl_ck_warner_d(aTHX_ packWARN(WARN_INTERNAL), "oops: oopsHV");
 	break;
     }
     return o;
@@ -6257,10 +6351,9 @@
 	o->op_ppaddr = PL_ppaddr[OP_PADAV];
 	return o;
     }
-    else if ((o->op_type == OP_RV2AV || o->op_type == OP_PADAV)
-		&& ckWARN(WARN_DEPRECATED)) {
-	Perl_warner(aTHX_ packWARN(WARN_DEPRECATED),
-		"Using an array as a reference is deprecated");
+    else if ((o->op_type == OP_RV2AV || o->op_type == OP_PADAV)) {
+	Perl_ck_warner_d(aTHX_ packWARN(WARN_DEPRECATED),
+		       "Using an array as a reference is deprecated");
     }
     return newUNOP(OP_RV2AV, 0, scalar(o));
 }
@@ -6285,10 +6378,9 @@
 	o->op_ppaddr = PL_ppaddr[OP_PADHV];
 	return o;
     }
-    else if ((o->op_type == OP_RV2HV || o->op_type == OP_PADHV)
-		&& ckWARN(WARN_DEPRECATED)) {
-	Perl_warner(aTHX_ packWARN(WARN_DEPRECATED),
-		"Using a hash as a reference is deprecated");
+    else if ((o->op_type == OP_RV2HV || o->op_type == OP_PADHV)) {
+	Perl_ck_warner_d(aTHX_ packWARN(WARN_DEPRECATED),
+		       "Using a hash as a reference is deprecated");
     }
     return newUNOP(OP_RV2HV, 0, scalar(o));
 }
@@ -6355,12 +6447,11 @@
 		(left->op_flags & OPf_PARENS) == 0) ||
 	    (OP_IS_NUMCOMPARE(right->op_type) &&
 		(right->op_flags & OPf_PARENS) == 0))
-	    if (ckWARN(WARN_PRECEDENCE))
-		Perl_warner(aTHX_ packWARN(WARN_PRECEDENCE),
-			"Possible precedence problem on bitwise %c operator",
-			o->op_type == OP_BIT_OR ? '|'
-			    : o->op_type == OP_BIT_AND ? '&' : '^'
-			);
+	    Perl_ck_warner(aTHX_ packWARN(WARN_PRECEDENCE),
+			   "Possible precedence problem on bitwise %c operator",
+			   o->op_type == OP_BIT_OR ? '|'
+			   : o->op_type == OP_BIT_AND ? '&' : '^'
+			   );
     }
     return o;
 }
@@ -6436,6 +6527,8 @@
 	    Perl_croak(aTHX_ "%s argument is not a HASH or ARRAY element or slice",
 		  OP_DESC(o));
 	}
+	if (kid->op_private & OPpLVAL_INTRO)
+	    o->op_private |= OPpLVAL_INTRO;
 	op_null(kid);
     }
     return o;
@@ -6509,8 +6602,6 @@
 	    /* establish postfix order */
 	    enter->op_next = (OP*)enter;
 
-	    CHECKOP(OP_ENTERTRY, enter);
-
 	    o = prepend_elem(OP_LINESEQ, (OP*)enter, (OP*)kid);
 	    o->op_type = OP_LEAVETRY;
 	    o->op_ppaddr = PL_ppaddr[OP_LEAVETRY];
@@ -6534,11 +6625,8 @@
     }
     o->op_targ = (PADOFFSET)PL_hints;
     if ((PL_hints & HINT_LOCALIZE_HH) != 0 && GvHV(PL_hintgv)) {
-	/* Store a copy of %^H that pp_entereval can pick up.
-	   OPf_SPECIAL flags the opcode as being for this purpose,
-	   so that it in turn will return a copy at every
-	   eval.*/
-	OP *hhop = newSVOP(OP_CONST, OPf_SPECIAL,
+	/* Store a copy of %^H that pp_entereval can pick up. */
+	OP *hhop = newSVOP(OP_HINTSEVAL, 0,
 			   MUTABLE_SV(Perl_hv_copy_hints_hv(aTHX_ GvHV(PL_hintgv))));
 	cUNOPo->op_first->op_sibling = hhop;
 	o->op_private |= OPpEVAL_HAS_HH;
@@ -6751,7 +6839,7 @@
 #endif
 	    return newop;
 	}
-	if ((PL_hints & HINT_FILETEST_ACCESS) && OP_IS_FILETEST_ACCESS(o))
+	if ((PL_hints & HINT_FILETEST_ACCESS) && OP_IS_FILETEST_ACCESS(o->op_type))
 	    o->op_private |= OPpFT_ACCESS;
 	if (PL_check[kidtype] == MEMBER_TO_FPTR(Perl_ck_ftst)
 		&& kidtype != OP_STAT && kidtype != OP_LSTAT)
@@ -6832,20 +6920,19 @@
 		break;
 	    case OA_AVREF:
 		if ((type == OP_PUSH || type == OP_UNSHIFT)
-		    && !kid->op_sibling && ckWARN(WARN_SYNTAX))
-		    Perl_warner(aTHX_ packWARN(WARN_SYNTAX),
-			"Useless use of %s with no values",
-			PL_op_desc[type]);
+		    && !kid->op_sibling)
+		    Perl_ck_warner(aTHX_ packWARN(WARN_SYNTAX),
+				   "Useless use of %s with no values",
+				   PL_op_desc[type]);
 
 		if (kid->op_type == OP_CONST &&
 		    (kid->op_private & OPpCONST_BARE))
 		{
 		    OP * const newop = newAVREF(newGVOP(OP_GV, 0,
 			gv_fetchsv(((SVOP*)kid)->op_sv, GV_ADD, SVt_PVAV) ));
-		    if (ckWARN2(WARN_DEPRECATED, WARN_SYNTAX))
-			Perl_warner(aTHX_ packWARN2(WARN_DEPRECATED, WARN_SYNTAX),
-			    "Array @%"SVf" missing the @ in argument %"IVdf" of %s()",
-			    SVfARG(((SVOP*)kid)->op_sv), (IV)numargs, PL_op_desc[type]);
+		    Perl_ck_warner_d(aTHX_ packWARN(WARN_DEPRECATED),
+				   "Array @%"SVf" missing the @ in argument %"IVdf" of %s()",
+				   SVfARG(((SVOP*)kid)->op_sv), (IV)numargs, PL_op_desc[type]);
 #ifdef PERL_MAD
 		    op_getmad(kid,newop,'K');
 #else
@@ -6865,10 +6952,9 @@
 		{
 		    OP * const newop = newHVREF(newGVOP(OP_GV, 0,
 			gv_fetchsv(((SVOP*)kid)->op_sv, GV_ADD, SVt_PVHV) ));
-		    if (ckWARN2(WARN_DEPRECATED, WARN_SYNTAX))
-			Perl_warner(aTHX_ packWARN2(WARN_DEPRECATED, WARN_SYNTAX),
-			    "Hash %%%"SVf" missing the %% in argument %"IVdf" of %s()",
-			    SVfARG(((SVOP*)kid)->op_sv), (IV)numargs, PL_op_desc[type]);
+		    Perl_ck_warner_d(aTHX_ packWARN(WARN_DEPRECATED),
+				   "Hash %%%"SVf" missing the %% in argument %"IVdf" of %s()",
+				   SVfARG(((SVOP*)kid)->op_sv), (IV)numargs, PL_op_desc[type]);
 #ifdef PERL_MAD
 		    op_getmad(kid,newop,'K');
 #else
@@ -7075,11 +7161,12 @@
 	ENTER;
 	Perl_load_module(aTHX_ PERL_LOADMOD_NOIMPORT,
 		newSVpvs("File::Glob"), NULL, NULL, NULL);
-	gv = gv_fetchpvs("CORE::GLOBAL::glob", 0, SVt_PVCV);
-	glob_gv = gv_fetchpvs("File::Glob::csh_glob", 0, SVt_PVCV);
-	GvCV(gv) = GvCV(glob_gv);
-	SvREFCNT_inc_void(MUTABLE_SV(GvCV(gv)));
-	GvIMPORTED_CV_on(gv);
+	if((glob_gv = gv_fetchpvs("File::Glob::csh_glob", 0, SVt_PVCV))) {
+	    gv = gv_fetchpvs("CORE::GLOBAL::glob", 0, SVt_PVCV);
+	    GvCV(gv) = GvCV(glob_gv);
+	    SvREFCNT_inc_void(MUTABLE_SV(GvCV(gv)));
+	    GvIMPORTED_CV_on(gv);
+	}
 	LEAVE;
     }
 #endif /* PERL_EXTERNAL_GLOB */
@@ -7124,10 +7211,10 @@
     if (o->op_flags & OPf_STACKED) {
 	OP* k;
 	o = ck_sort(o);
-        kid = cLISTOPo->op_first->op_sibling;
-	if (!cUNOPx(kid)->op_next)
-	    Perl_croak(aTHX_ "panic: ck_grep");
-	for (k = cUNOPx(kid)->op_first; k; k = k->op_next) {
+        kid = cUNOPx(cLISTOPo->op_first->op_sibling)->op_first;
+	if (kid->op_type != OP_SCOPE && kid->op_type != OP_LEAVE)
+	    return no_fh_allowed(o);
+	for (k = kid; k; k = k->op_next) {
 	    kid = k;
 	}
 	NewOp(1101, gwop, 1, LOGOP);
@@ -7155,7 +7242,7 @@
     gwop->op_flags |= OPf_KIDS;
     gwop->op_other = LINKLIST(kid);
     kid->op_next = (OP*)gwop;
-    offset = pad_findmy("$_");
+    offset = Perl_pad_findmy(aTHX_ STR_WITH_LEN("$_"), 0);
     if (offset == NOT_IN_PAD || PAD_COMPNAME_FLAGS_isOUR(offset)) {
 	o->op_private = gwop->op_private = 0;
 	gwop->op_targ = pad_alloc(type, SVs_PADTMP);
@@ -7190,15 +7277,6 @@
 }
 
 OP *
-Perl_ck_lengthconst(pTHX_ OP *o)
-{
-    PERL_ARGS_ASSERT_CK_LENGTHCONST;
-
-    /* XXX length optimization goes here */
-    return ck_fun(o);
-}
-
-OP *
 Perl_ck_lfun(pTHX_ OP *o)
 {
     const OPCODE type = o->op_type;
@@ -7213,7 +7291,7 @@
 {
     PERL_ARGS_ASSERT_CK_DEFINED;
 
-    if ((o->op_flags & OPf_KIDS) && ckWARN2(WARN_DEPRECATED, WARN_SYNTAX)) {
+    if ((o->op_flags & OPf_KIDS)) {
 	switch (cUNOPo->op_first->op_type) {
 	case OP_RV2AV:
 	    /* This is needed for
@@ -7223,22 +7301,17 @@
 	    break;                      /* Globals via GV can be undef */
 	case OP_PADAV:
 	case OP_AASSIGN:		/* Is this a good idea? */
-	    Perl_warner(aTHX_ packWARN2(WARN_DEPRECATED, WARN_SYNTAX),
-			"defined(@array) is deprecated");
-	    Perl_warner(aTHX_ packWARN2(WARN_DEPRECATED, WARN_SYNTAX),
-			"\t(Maybe you should just omit the defined()?)\n");
+	    Perl_ck_warner_d(aTHX_ packWARN(WARN_DEPRECATED),
+			   "defined(@array) is deprecated");
+	    Perl_ck_warner_d(aTHX_ packWARN(WARN_DEPRECATED),
+			   "\t(Maybe you should just omit the defined()?)\n");
 	break;
 	case OP_RV2HV:
-	    /* This is needed for
-	       if (defined %stash::)
-	       to work.   Do not break Tk.
-	       */
-	    break;                      /* Globals via GV can be undef */
 	case OP_PADHV:
-	    Perl_warner(aTHX_ packWARN2(WARN_DEPRECATED, WARN_SYNTAX),
-			"defined(%%hash) is deprecated");
-	    Perl_warner(aTHX_ packWARN2(WARN_DEPRECATED, WARN_SYNTAX),
-			"\t(Maybe you should just omit the defined()?)\n");
+	    Perl_ck_warner_d(aTHX_ packWARN(WARN_DEPRECATED),
+			   "defined(%%hash) is deprecated");
+	    Perl_ck_warner_d(aTHX_ packWARN(WARN_DEPRECATED),
+			   "\t(Maybe you should just omit the defined()?)\n");
 	    break;
 	default:
 	    /* no warning */
@@ -7409,7 +7482,7 @@
     PERL_ARGS_ASSERT_CK_MATCH;
 
     if (o->op_type != OP_QR && PL_compcv) {
-	const PADOFFSET offset = pad_findmy("$_");
+	const PADOFFSET offset = Perl_pad_findmy(aTHX_ STR_WITH_LEN("$_"), 0);
 	if (offset != NOT_IN_PAD && !(PAD_COMPNAME_FLAGS_isOUR(offset))) {
 	    o->op_targ = offset;
 	    o->op_private |= OPpTARGET_MY;
@@ -7469,7 +7542,9 @@
     if (table) {
 	SV **svp = hv_fetchs(table, "open_IN", FALSE);
 	if (svp && *svp) {
-	    const I32 mode = mode_from_discipline(*svp);
+	    STRLEN len = 0;
+	    const char *d = SvPV_const(*svp, len);
+	    const I32 mode = mode_from_discipline(d, len);
 	    if (mode & O_BINARY)
 		o->op_private |= OPpOPEN_IN_RAW;
 	    else if (mode & O_TEXT)
@@ -7478,7 +7553,9 @@
 
 	svp = hv_fetchs(table, "open_OUT", FALSE);
 	if (svp && *svp) {
-	    const I32 mode = mode_from_discipline(*svp);
+	    STRLEN len = 0;
+	    const char *d = SvPV_const(*svp, len);
+	    const I32 mode = mode_from_discipline(d, len);
 	    if (mode & O_BINARY)
 		o->op_private |= OPpOPEN_OUT_RAW;
 	    else if (mode & O_TEXT)
@@ -7604,21 +7681,36 @@
 	return newop;
     }
 
-    return ck_fun(o);
+    return scalar(ck_fun(o));
 }
 
 OP *
 Perl_ck_return(pTHX_ OP *o)
 {
     dVAR;
+    OP *kid;
 
     PERL_ARGS_ASSERT_CK_RETURN;
 
+    kid = cLISTOPo->op_first->op_sibling;
     if (CvLVALUE(PL_compcv)) {
-        OP *kid;
-	for (kid = cLISTOPo->op_first->op_sibling; kid; kid = kid->op_sibling)
+	for (; kid; kid = kid->op_sibling)
 	    mod(kid, OP_LEAVESUBLV);
+    } else {
+	for (; kid; kid = kid->op_sibling)
+	    if ((kid->op_type == OP_NULL)
+		&& ((kid->op_flags & (OPf_SPECIAL|OPf_KIDS)) == (OPf_SPECIAL|OPf_KIDS))) {
+		/* This is a do block */
+		OP *op = kUNOP->op_first;
+		if (op->op_type == OP_LEAVE && op->op_flags & OPf_KIDS) {
+		    op = cUNOPx(op)->op_first;
+		    assert(op->op_type == OP_ENTER && !(op->op_flags & OPf_SPECIAL));
+		    /* Force the use of the caller's context */
+		    op->op_flags |= OPf_SPECIAL;
+		}
+	    }
     }
+
     return o;
 }
 
@@ -7655,20 +7747,15 @@
     PERL_ARGS_ASSERT_CK_SHIFT;
 
     if (!(o->op_flags & OPf_KIDS)) {
-	OP *argop;
-	/* FIXME - this can be refactored to reduce code in #ifdefs  */
-#ifdef PERL_MAD
-	OP * const oldo = o;
-#else
-	op_free(o);
-#endif
-	argop = newUNOP(OP_RV2AV, 0,
+	OP *argop = newUNOP(OP_RV2AV, 0,
 	    scalar(newGVOP(OP_GV, 0, CvUNIQUE(PL_compcv) ? PL_argvgv : PL_defgv)));
 #ifdef PERL_MAD
+	OP * const oldo = o;
 	o = newUNOP(type, 0, scalar(argop));
 	op_getmad(oldo,o,'O');
 	return o;
 #else
+	op_free(o);
 	return newUNOP(type, 0, scalar(argop));
 #endif
     }
@@ -7867,9 +7954,9 @@
     kid->op_type = OP_PUSHRE;
     kid->op_ppaddr = PL_ppaddr[OP_PUSHRE];
     scalar(kid);
-    if (((PMOP *)kid)->op_pmflags & PMf_GLOBAL && ckWARN(WARN_REGEXP)) {
-      Perl_warner(aTHX_ packWARN(WARN_REGEXP),
-                  "Use of /g modifier is meaningless in split");
+    if (((PMOP *)kid)->op_pmflags & PMf_GLOBAL) {
+      Perl_ck_warner(aTHX_ packWARN(WARN_REGEXP),
+		     "Use of /g modifier is meaningless in split");
     }
 
     if (!kid->op_sibling)
@@ -7934,22 +8021,29 @@
     o->op_private |= OPpENTERSUB_HASTARG;
     for (cvop = o2; cvop->op_sibling; cvop = cvop->op_sibling) ;
     if (cvop->op_type == OP_RV2CV) {
-	SVOP* tmpop;
 	o->op_private |= (cvop->op_private & OPpENTERSUB_AMPER);
 	op_null(cvop);		/* disable rv2cv */
-	tmpop = (SVOP*)((UNOP*)cvop)->op_first;
-	if (tmpop->op_type == OP_GV && !(o->op_private & OPpENTERSUB_AMPER)) {
-	    GV *gv = cGVOPx_gv(tmpop);
-	    cv = GvCVu(gv);
-	    if (!cv)
-		tmpop->op_private |= OPpEARLY_CV;
-	    else {
-		if (SvPOK(cv)) {
-		    STRLEN len;
-		    namegv = CvANON(cv) ? gv : CvGV(cv);
-		    proto = SvPV(MUTABLE_SV(cv), len);
-		    proto_end = proto + len;
-		}
+	if (!(o->op_private & OPpENTERSUB_AMPER)) {
+	    SVOP *tmpop = (SVOP*)((UNOP*)cvop)->op_first;
+	    GV *gv = NULL;
+	    switch (tmpop->op_type) {
+		case OP_GV: {
+		    gv = cGVOPx_gv(tmpop);
+		    cv = GvCVu(gv);
+		    if (!cv)
+			tmpop->op_private |= OPpEARLY_CV;
+		} break;
+		case OP_CONST: {
+		    SV *sv = cSVOPx_sv(tmpop);
+		    if (SvROK(sv) && SvTYPE(SvRV(sv)) == SVt_PVCV)
+			cv = (CV*)SvRV(sv);
+		} break;
+	    }
+	    if (cv && SvPOK(cv)) {
+		STRLEN len;
+		namegv = gv && CvANON(cv) ? gv : CvGV(cv);
+		proto = SvPV(MUTABLE_SV(cv), len);
+		proto_end = proto + len;
 	    }
 	}
     }
@@ -8245,6 +8339,131 @@
     return o;
 }
 
+OP *
+Perl_ck_each(pTHX_ OP *o)
+{
+    dVAR;
+    OP *kid = o->op_flags & OPf_KIDS ? cLISTOPo->op_first : NULL;
+
+    PERL_ARGS_ASSERT_CK_EACH;
+
+    if (kid) {
+	if (kid->op_type == OP_PADAV || kid->op_type == OP_RV2AV) {
+	    const unsigned new_type = o->op_type == OP_EACH ? OP_AEACH
+		: o->op_type == OP_KEYS ? OP_AKEYS : OP_AVALUES;
+	    o->op_type = new_type;
+	    o->op_ppaddr = PL_ppaddr[new_type];
+	}
+	else if (!(kid->op_type == OP_PADHV || kid->op_type == OP_RV2HV
+		    || (kid->op_type == OP_CONST && kid->op_private & OPpCONST_BARE)
+		  )) {
+	    bad_type(1, "hash or array", PL_op_desc[o->op_type], kid);
+	    return o;
+	}
+    }
+    return ck_fun(o);
+}
+
+/* caller is supposed to assign the return to the 
+   container of the rep_op var */
+STATIC OP *
+S_opt_scalarhv(pTHX_ OP *rep_op) {
+    dVAR;
+    UNOP *unop;
+
+    PERL_ARGS_ASSERT_OPT_SCALARHV;
+
+    NewOp(1101, unop, 1, UNOP);
+    unop->op_type = (OPCODE)OP_BOOLKEYS;
+    unop->op_ppaddr = PL_ppaddr[OP_BOOLKEYS];
+    unop->op_flags = (U8)(OPf_WANT_SCALAR | OPf_KIDS );
+    unop->op_private = (U8)(1 | ((OPf_WANT_SCALAR | OPf_KIDS) >> 8));
+    unop->op_first = rep_op;
+    unop->op_next = rep_op->op_next;
+    rep_op->op_next = (OP*)unop;
+    rep_op->op_flags|=(OPf_REF | OPf_MOD);
+    unop->op_sibling = rep_op->op_sibling;
+    rep_op->op_sibling = NULL;
+    /* unop->op_targ = pad_alloc(OP_BOOLKEYS, SVs_PADTMP); */
+    if (rep_op->op_type == OP_PADHV) { 
+        rep_op->op_flags &= ~OPf_WANT_SCALAR;
+        rep_op->op_flags |= OPf_WANT_LIST;
+    }
+    return (OP*)unop;
+}                        
+
+/* Checks if o acts as an in-place operator on an array. oright points to the
+ * beginning of the right-hand side. Returns the left-hand side of the
+ * assignment if o acts in-place, or NULL otherwise. */
+
+STATIC OP *
+S_is_inplace_av(pTHX_ OP *o, OP *oright) {
+    OP *o2;
+    OP *oleft = NULL;
+
+    PERL_ARGS_ASSERT_IS_INPLACE_AV;
+
+    if (!oright ||
+	(oright->op_type != OP_RV2AV && oright->op_type != OP_PADAV)
+	|| oright->op_next != o
+	|| (oright->op_private & OPpLVAL_INTRO)
+    )
+	return NULL;
+
+    /* o2 follows the chain of op_nexts through the LHS of the
+     * assign (if any) to the aassign op itself */
+    o2 = o->op_next;
+    if (!o2 || o2->op_type != OP_NULL)
+	return NULL;
+    o2 = o2->op_next;
+    if (!o2 || o2->op_type != OP_PUSHMARK)
+	return NULL;
+    o2 = o2->op_next;
+    if (o2 && o2->op_type == OP_GV)
+	o2 = o2->op_next;
+    if (!o2
+	|| (o2->op_type != OP_PADAV && o2->op_type != OP_RV2AV)
+	|| (o2->op_private & OPpLVAL_INTRO)
+    )
+	return NULL;
+    oleft = o2;
+    o2 = o2->op_next;
+    if (!o2 || o2->op_type != OP_NULL)
+	return NULL;
+    o2 = o2->op_next;
+    if (!o2 || o2->op_type != OP_AASSIGN
+	    || (o2->op_flags & OPf_WANT) != OPf_WANT_VOID)
+	return NULL;
+
+    /* check that the sort is the first arg on RHS of assign */
+
+    o2 = cUNOPx(o2)->op_first;
+    if (!o2 || o2->op_type != OP_NULL)
+	return NULL;
+    o2 = cUNOPx(o2)->op_first;
+    if (!o2 || o2->op_type != OP_PUSHMARK)
+	return NULL;
+    if (o2->op_sibling != o)
+	return NULL;
+
+    /* check the array is the same on both sides */
+    if (oleft->op_type == OP_RV2AV) {
+	if (oright->op_type != OP_RV2AV
+	    || !cUNOPx(oright)->op_first
+	    || cUNOPx(oright)->op_first->op_type != OP_GV
+	    || cGVOPx_gv(cUNOPx(oleft)->op_first) !=
+	       cGVOPx_gv(cUNOPx(oright)->op_first)
+	)
+	    return NULL;
+    }
+    else if (oright->op_type != OP_PADAV
+	|| oright->op_targ != oleft->op_targ
+    )
+	return NULL;
+
+    return oleft;
+}
+
 /* A peephole optimizer.  We visit the ops in the order they're to execute.
  * See the comments at the top of this file for more details about when
  * peep() is called */
@@ -8268,7 +8487,6 @@
 	o->op_opt = 1;
 	PL_op = o;
 	switch (o->op_type) {
-	case OP_SETSTATE:
 	case OP_NEXTSTATE:
 	case OP_DBSTATE:
 	    PL_curcop = ((COP*)o);		/* for warnings */
@@ -8278,20 +8496,21 @@
 	    if (cSVOPo->op_private & OPpCONST_STRICT)
 		no_bareword_allowed(o);
 #ifdef USE_ITHREADS
+	case OP_HINTSEVAL:
 	case OP_METHOD_NAMED:
 	    /* Relocate sv to the pad for thread safety.
 	     * Despite being a "constant", the SV is written to,
 	     * for reference counts, sv_upgrade() etc. */
 	    if (cSVOP->op_sv) {
 		const PADOFFSET ix = pad_alloc(OP_CONST, SVs_PADTMP);
-		if (o->op_type == OP_CONST && SvPADTMP(cSVOPo->op_sv)) {
+		if (o->op_type != OP_METHOD_NAMED && SvPADTMP(cSVOPo->op_sv)) {
 		    /* If op_sv is already a PADTMP then it is being used by
 		     * some pad, so make a copy. */
 		    sv_setsv(PAD_SVl(ix),cSVOPo->op_sv);
 		    SvREADONLY_on(PAD_SVl(ix));
 		    SvREFCNT_dec(cSVOPo->op_sv);
 		}
-		else if (o->op_type == OP_CONST
+		else if (o->op_type != OP_METHOD_NAMED
 			 && cSVOPo->op_sv == &PL_sv_undef) {
 		    /* PL_sv_undef is hack - it's unsafe to store it in the
 		       AV that is the pad, because av_fetch treats values of
@@ -8338,8 +8557,7 @@
 	    goto nothin;
 	case OP_NULL:
 	    if (o->op_targ == OP_NEXTSTATE
-		|| o->op_targ == OP_DBSTATE
-		|| o->op_targ == OP_SETSTATE)
+		|| o->op_targ == OP_DBSTATE)
 	    {
 		PL_curcop = ((COP*)o);
 	    }
@@ -8432,12 +8650,67 @@
 	    }
 
 	    break;
+        
+        {
+            OP *fop;
+            OP *sop;
+            
+        case OP_NOT:
+            fop = cUNOP->op_first;
+            sop = NULL;
+            goto stitch_keys;
+            break;
 
-	case OP_MAPWHILE:
-	case OP_GREPWHILE:
-	case OP_AND:
+        case OP_AND:
 	case OP_OR:
 	case OP_DOR:
+            fop = cLOGOP->op_first;
+            sop = fop->op_sibling;
+	    while (cLOGOP->op_other->op_type == OP_NULL)
+		cLOGOP->op_other = cLOGOP->op_other->op_next;
+	    peep(cLOGOP->op_other); /* Recursive calls are not replaced by fptr calls */
+          
+          stitch_keys:	    
+	    o->op_opt = 1;
+            if ((fop->op_type == OP_PADHV || fop->op_type == OP_RV2HV)
+                || ( sop && 
+                     (sop->op_type == OP_PADHV || sop->op_type == OP_RV2HV)
+                    )
+            ){	
+                OP * nop = o;
+                OP * lop = o;
+                if (!((nop->op_flags & OPf_WANT) == OPf_WANT_VOID)) {
+                    while (nop && nop->op_next) {
+                        switch (nop->op_next->op_type) {
+                            case OP_NOT:
+                            case OP_AND:
+                            case OP_OR:
+                            case OP_DOR:
+                                lop = nop = nop->op_next;
+                                break;
+                            case OP_NULL:
+                                nop = nop->op_next;
+                                break;
+                            default:
+                                nop = NULL;
+                                break;
+                        }
+                    }            
+                }
+                if ((lop->op_flags & OPf_WANT) == OPf_WANT_VOID) {
+                    if (fop->op_type == OP_PADHV || fop->op_type == OP_RV2HV) 
+                        cLOGOP->op_first = opt_scalarhv(fop);
+                    if (sop && (sop->op_type == OP_PADHV || sop->op_type == OP_RV2HV)) 
+                        cLOGOP->op_first->op_sibling = opt_scalarhv(sop);
+                }                                        
+            }                  
+            
+	    
+	    break;
+	}    
+	
+	case OP_MAPWHILE:
+	case OP_GREPWHILE:
 	case OP_ANDASSIGN:
 	case OP_ORASSIGN:
 	case OP_DORASSIGN:
@@ -8503,7 +8776,7 @@
 
 	    /* Make the CONST have a shared SV */
 	    svp = cSVOPx_svp(((BINOP*)o)->op_last);
-	    if ((!SvFAKE(sv = *svp) || !SvREADONLY(sv)) && !IS_PADCONST(sv)) {
+	    if (!SvFAKE(sv = *svp) || !SvREADONLY(sv)) {
 		key = SvPV_const(sv, keylen);
 		lexname = newSVpvn_share(key,
 					 SvUTF8(sv) ? -(I32)keylen : (I32)keylen,
@@ -8631,62 +8904,8 @@
 		oright = cUNOPx(oright)->op_sibling;
 	    }
 
-	    if (!oright ||
-		(oright->op_type != OP_RV2AV && oright->op_type != OP_PADAV)
-		|| oright->op_next != o
-		|| (oright->op_private & OPpLVAL_INTRO)
-	    )
-		break;
-
-	    /* o2 follows the chain of op_nexts through the LHS of the
-	     * assign (if any) to the aassign op itself */
-	    o2 = o->op_next;
-	    if (!o2 || o2->op_type != OP_NULL)
-		break;
-	    o2 = o2->op_next;
-	    if (!o2 || o2->op_type != OP_PUSHMARK)
-		break;
-	    o2 = o2->op_next;
-	    if (o2 && o2->op_type == OP_GV)
-		o2 = o2->op_next;
-	    if (!o2
-		|| (o2->op_type != OP_PADAV && o2->op_type != OP_RV2AV)
-		|| (o2->op_private & OPpLVAL_INTRO)
-	    )
-		break;
-	    oleft = o2;
-	    o2 = o2->op_next;
-	    if (!o2 || o2->op_type != OP_NULL)
-		break;
-	    o2 = o2->op_next;
-	    if (!o2 || o2->op_type != OP_AASSIGN
-		    || (o2->op_flags & OPf_WANT) != OPf_WANT_VOID)
-		break;
-
-	    /* check that the sort is the first arg on RHS of assign */
-
-	    o2 = cUNOPx(o2)->op_first;
-	    if (!o2 || o2->op_type != OP_NULL)
-		break;
-	    o2 = cUNOPx(o2)->op_first;
-	    if (!o2 || o2->op_type != OP_PUSHMARK)
-		break;
-	    if (o2->op_sibling != o)
-		break;
-
-	    /* check the array is the same on both sides */
-	    if (oleft->op_type == OP_RV2AV) {
-		if (oright->op_type != OP_RV2AV
-		    || !cUNOPx(oright)->op_first
-		    || cUNOPx(oright)->op_first->op_type != OP_GV
-		    ||  cGVOPx_gv(cUNOPx(oleft)->op_first) !=
-		       	cGVOPx_gv(cUNOPx(oright)->op_first)
-		)
-		    break;
-	    }
-	    else if (oright->op_type != OP_PADAV
-		|| oright->op_targ != oleft->op_targ
-	    )
+	    oleft = is_inplace_av(o, oright);
+	    if (!oleft)
 		break;
 
 	    /* transfer MODishness etc from LHS arg to RHS arg */
@@ -8713,8 +8932,36 @@
 	case OP_REVERSE: {
 	    OP *ourmark, *theirmark, *ourlast, *iter, *expushmark, *rv2av;
 	    OP *gvop = NULL;
+	    OP *oleft, *oright;
 	    LISTOP *enter, *exlist;
 
+	    /* @a = reverse @a */
+	    if ((oright = cLISTOPo->op_first)
+		    && (oright->op_type == OP_PUSHMARK)
+		    && (oright = oright->op_sibling)
+		    && (oleft = is_inplace_av(o, oright))) {
+		OP *o2;
+
+		/* transfer MODishness etc from LHS arg to RHS arg */
+		oright->op_flags = oleft->op_flags;
+		o->op_private |= OPpREVERSE_INPLACE;
+
+		/* excise push->gv->rv2av->null->aassign */
+		o2 = o->op_next->op_next;
+		op_null(o2); /* PUSHMARK */
+		o2 = o2->op_next;
+		if (o2->op_type == OP_GV) {
+		    op_null(o2); /* GV */
+		    o2 = o2->op_next;
+		}
+		op_null(o2); /* RV2AV or PADAV */
+		o2 = o2->op_next->op_next;
+		op_null(o2); /* AASSIGN */
+
+		o->op_next = o2->op_next;
+		break;
+	    }
+
 	    enter = (LISTOP *) o->op_next;
 	    if (!enter)
 		break;
@@ -8908,15 +9155,20 @@
 {
     dVAR;
     dXSARGS;
+    SV *const sv = MUTABLE_SV(XSANY.any_ptr);
     if (items != 0) {
 	NOOP;
 #if 0
+	/* diag_listed_as: SKIPME */
         Perl_croak(aTHX_ "usage: %s::%s()",
                    HvNAME_get(GvSTASH(CvGV(cv))), GvNAME(CvGV(cv)));
 #endif
     }
+    if (!sv) {
+	XSRETURN(0);
+    }
     EXTEND(sp, 1);
-    ST(0) = MUTABLE_SV(XSANY.any_ptr);
+    ST(0) = sv;
     XSRETURN(1);
 }
 
Index: src/gnu/usr.bin/perl/op.h
diff -u src/gnu/usr.bin/perl/op.h:1.12 src/gnu/usr.bin/perl/op.h:1.13
--- op.h:1.12	Mon Oct 12 18:24:21 2009
+++ op.h	Fri Sep 24 15:06:40 2010
@@ -77,10 +77,7 @@
 	 ((op)->op_flags & OPf_WANT) == OPf_WANT_LIST   ? G_ARRAY   : \
 	 dfl)
 
-#define OP_GIMME_REVERSE(flags)			\
-	((flags & G_VOID) ? OPf_WANT_VOID :	\
-	(flags & G_ARRAY) ? OPf_WANT_LIST :	\
-			    OPf_WANT_SCALAR)
+#define OP_GIMME_REVERSE(flags)	((flags) & G_WANT)
 
 /*
 =head1 "Gimme" Values
@@ -115,8 +112,6 @@
 #define OPf_STACKED	64	/* Some arg is arriving on the stack. */
 #define OPf_SPECIAL	128	/* Do something weird for this op: */
 				/*  On local LVAL, don't init local value. */
-				/*  On OP_CONST, value is the hints hash for
-				    eval, so return a copy from pp_const() */
 				/*  On OP_SORT, subroutine is inlined. */
 				/*  On OP_NOT, inversion was implicit. */
 				/*  On OP_LEAVE, don't restore curpm. */
@@ -142,6 +137,10 @@
 				/*  On OP_SMARTMATCH, an implicit smartmatch */
 				/*  On OP_ANONHASH and OP_ANONLIST, create a
 				    reference to the new anon hash or array */
+				/*  On OP_ENTER, store caller context */
+				/*  On OP_HELEM and OP_HSLICE, localization will be followed
+				    by assignment, so do not wipe the target if it is special
+				    (e.g. a glob or a magic SV) */
 
 /* old names; don't use in new code, but don't break them, either */
 #define OPf_LIST	OPf_WANT_LIST
@@ -245,6 +244,7 @@
 
 /* Private for OP_DELETE */
 #define OPpSLICE		64	/* Operating on a list of keys */
+/* Also OPpLVAL_INTRO (128) */
 
 /* Private for OP_EXISTS */
 #define OPpEXISTS_SUB		64	/* Checking for &sub, not {} or [].  */
@@ -258,6 +258,9 @@
 #define OPpSORT_QSORT		32	/* Use quicksort (not mergesort) */
 #define OPpSORT_STABLE		64	/* Use a stable algorithm */
 
+/* Private for OP_REVERSE */
+#define OPpREVERSE_INPLACE	8	/* reverse in-place (@a = reverse @a) */
+
 /* Private for OP_OPEN and OP_BACKTICK */
 #define OPpOPEN_IN_RAW		16	/* binmode(F,":raw") on input fh */
 #define OPpOPEN_IN_CRLF		32	/* binmode(F,":crlf") on input fh */
@@ -271,13 +274,6 @@
 /* Private for OP_FTXXX */
 #define OPpFT_ACCESS		2	/* use filetest 'access' */
 #define OPpFT_STACKED		4	/* stacked filetest, as in "-f -x $f" */
-#define OP_IS_FILETEST_ACCESS(op) 		\
-	(((op)->op_type) == OP_FTRREAD  ||	\
-	 ((op)->op_type) == OP_FTRWRITE ||	\
-	 ((op)->op_type) == OP_FTREXEC  ||	\
-	 ((op)->op_type) == OP_FTEREAD  ||	\
-	 ((op)->op_type) == OP_FTEWRITE ||	\
-	 ((op)->op_type) == OP_FTEEXEC)
 
 /* Private for OP_(MAP|GREP)(WHILE|START) */
 #define OPpGREP_LEX		2	/* iterate over lexical $_ */
@@ -341,65 +337,56 @@
 };
 
 #ifdef USE_ITHREADS
-#define PM_GETRE(o)     (INT2PTR(REGEXP*,SvIVX(PL_regex_pad[(o)->op_pmoffset])))
+#define PM_GETRE(o)	(SvTYPE(PL_regex_pad[(o)->op_pmoffset]) == SVt_REGEXP \
+		 	 ? (REGEXP*)(PL_regex_pad[(o)->op_pmoffset]) : NULL)
 /* The assignment is just to enforce type safety (or at least get a warning).
  */
+/* With first class regexps not via a reference one needs to assign
+   &PL_sv_undef under ithreads. (This would probably work unthreaded, but NULL
+   is cheaper. I guess we could allow NULL, but the check above would get
+   more complex, and we'd have an AV with (SV*)NULL in it, which feels bad */
+/* BEWARE - something that calls this macro passes (r) which has a side
+   effect.  */
 #define PM_SETRE(o,r)	STMT_START {					\
-                            const REGEXP *const slosh = (r);		\
-                            PM_SETRE_OFFSET((o), PTR2IV(slosh));	\
-                        } STMT_END
-/* Actually you can assign any IV, not just an offset. And really should it be
-   UV? */
-#define PM_SETRE_OFFSET(o,iv) \
-			STMT_START { \
-                            SV* const sv = PL_regex_pad[(o)->op_pmoffset]; \
-                            sv_setiv(sv, (iv)); \
+                            REGEXP *const _pm_setre = (r);		\
+                            assert(_pm_setre);				\
+			    PL_regex_pad[(o)->op_pmoffset] = MUTABLE_SV(_pm_setre); \
                         } STMT_END
-
-#  ifndef PERL_CORE
-/* No longer used anywhere in the core.  Migrate to Devel::PPPort?  */
-#define PM_GETRE_SAFE(o) (PL_regex_pad ? PM_GETRE(o) : (REGEXP*)0)
-#define PM_SETRE_SAFE(o,r) if (PL_regex_pad) PM_SETRE(o,r)
-#  endif
 #else
 #define PM_GETRE(o)     ((o)->op_pmregexp)
 #define PM_SETRE(o,r)   ((o)->op_pmregexp = (r))
-#  ifndef PERL_CORE
-#define PM_GETRE_SAFE PM_GETRE
-#define PM_SETRE_SAFE PM_SETRE
-#  endif
 #endif
 
 
-#define PMf_RETAINT	0x0001		/* taint $1 etc. if target tainted */
-#define PMf_ONCE	0x0002		/* match successfully only once per
+#define PMf_RETAINT	0x00000040	/* taint $1 etc. if target tainted */
+#define PMf_ONCE	0x00000080	/* match successfully only once per
                                            reset, with related flag RXf_USED
                                            in re->extflags holding state.
 					   This is used only for ?? matches,
 					   and only on OP_MATCH and OP_QR */
 
-#define PMf_UNUSED	0x0004		/* free for use */
-#define PMf_MAYBE_CONST	0x0008		/* replacement contains variables */
+#define PMf_UNUSED	0x00000100	/* free for use */
+#define PMf_MAYBE_CONST	0x00000200	/* replacement contains variables */
 
-#define PMf_USED        0x0010          /* PMf_ONCE has matched successfully.
+#define PMf_USED        0x00000400	/* PMf_ONCE has matched successfully.
                                            Not used under threading. */
 
-#define PMf_CONST	0x0040		/* subst replacement is constant */
-#define PMf_KEEP	0x0080		/* keep 1st runtime pattern forever */
-#define PMf_GLOBAL	0x0100		/* pattern had a g modifier */
-#define PMf_CONTINUE	0x0200		/* don't reset pos() if //g fails */
-#define PMf_EVAL	0x0400		/* evaluating replacement as expr */
+#define PMf_CONST	0x00000800	/* subst replacement is constant */
+#define PMf_KEEP	0x00001000	/* keep 1st runtime pattern forever */
+#define PMf_GLOBAL	0x00002000	/* pattern had a g modifier */
+#define PMf_CONTINUE	0x00004000	/* don't reset pos() if //g fails */
+#define PMf_EVAL	0x00008000	/* evaluating replacement as expr */
 
 /* The following flags have exact equivalents in regcomp.h with the prefix RXf_
  * which are stored in the regexp->extflags member. If you change them here,
  * you have to change them there, and vice versa.
  */
-#define PMf_LOCALE	0x00800		/* use locale for character types */
-#define PMf_MULTILINE	0x01000		/* assume multiple lines */
-#define PMf_SINGLELINE	0x02000		/* assume single line */
-#define PMf_FOLD	0x04000		/* case insensitivity */
-#define PMf_EXTENDED	0x08000		/* chuck embedded whitespace */
-#define PMf_KEEPCOPY	0x10000		/* copy the string when matching */
+#define PMf_MULTILINE	0x00000001	/* assume multiple lines */
+#define PMf_SINGLELINE	0x00000002	/* assume single line */
+#define PMf_FOLD	0x00000004	/* case insensitivity */
+#define PMf_EXTENDED	0x00000008	/* chuck embedded whitespace */
+#define PMf_KEEPCOPY	0x00000010	/* copy the string when matching */
+#define PMf_LOCALE	0x00000020	/* use locale for character types */
 
 /* mask of bits that need to be transfered to re->extflags */
 #define PMf_COMPILETIME	(PMf_MULTILINE|PMf_SINGLELINE|PMf_LOCALE|PMf_FOLD|PMf_EXTENDED|PMf_KEEPCOPY)
@@ -534,7 +521,9 @@
 #define cSVOPo_sv		cSVOPx_sv(o)
 #define kSVOP_sv		cSVOPx_sv(kid)
 
-#define Nullop ((OP*)NULL)
+#ifndef PERL_CORE
+#  define Nullop ((OP*)NULL)
+#endif
 
 /* Lowest byte-and-a-bit of PL_opargs */
 #define OA_MARK 1
@@ -629,6 +618,10 @@
    cv_ckproto_len((cv), (gv), (p), (p) ? strlen(p) : 0)
 #endif
 
+#ifdef PERL_CORE
+#  define my(o)	my_attrs((o), NULL)
+#endif
+
 #ifdef USE_REENTRANT_API
 #include "reentr.h"
 #endif
@@ -656,7 +649,7 @@
 
 struct madprop {
     MADPROP* mad_next;
-    const void *mad_val;
+    void *mad_val;
     U32 mad_vlen;
 /*    short mad_count; */
     char mad_key;
Index: src/gnu/usr.bin/perl/opcode.h
diff -u src/gnu/usr.bin/perl/opcode.h:1.12 src/gnu/usr.bin/perl/opcode.h:1.13
--- opcode.h:1.12	Mon Oct 12 18:24:21 2009
+++ opcode.h	Fri Sep 24 15:06:40 2010
@@ -163,6 +163,9 @@
 	"aelemfast",
 	"aelem",
 	"aslice",
+	"aeach",
+	"akeys",
+	"avalues",
 	"each",
 	"values",
 	"keys",
@@ -171,6 +174,7 @@
 	"rv2hv",
 	"helem",
 	"hslice",
+	"boolkeys",
 	"unpack",
 	"pack",
 	"split",
@@ -227,7 +231,6 @@
 	"dump",
 	"goto",
 	"exit",
-	"setstate",
 	"method_named",
 	"entergiven",
 	"leavegiven",
@@ -259,8 +262,6 @@
 	"sysseek",
 	"sysread",
 	"syswrite",
-	"send",
-	"recv",
 	"eof",
 	"tell",
 	"seek",
@@ -268,6 +269,8 @@
 	"fcntl",
 	"ioctl",
 	"flock",
+	"send",
+	"recv",
 	"socket",
 	"sockpair",
 	"bind",
@@ -356,6 +359,7 @@
 	"semctl",
 	"require",
 	"dofile",
+	"hintseval",
 	"entereval",
 	"leaveeval",
 	"entertry",
@@ -532,6 +536,9 @@
 	"constant array element",
 	"array element",
 	"array slice",
+	"each on array",
+	"keys on array",
+	"values on array",
 	"each",
 	"values",
 	"keys",
@@ -540,6 +547,7 @@
 	"hash dereference",
 	"hash element",
 	"hash slice",
+	"boolkeys",
 	"unpack",
 	"pack",
 	"split",
@@ -596,7 +604,6 @@
 	"dump",
 	"goto",
 	"exit",
-	"set statement info",
 	"method with known name",
 	"given()",
 	"leave given block",
@@ -628,8 +635,6 @@
 	"sysseek",
 	"sysread",
 	"syswrite",
-	"send",
-	"recv",
 	"eof",
 	"tell",
 	"seek",
@@ -637,6 +642,8 @@
 	"fcntl",
 	"ioctl",
 	"flock",
+	"send",
+	"recv",
 	"socket",
 	"socketpair",
 	"bind",
@@ -725,6 +732,7 @@
 	"semctl",
 	"require",
 	"do \"file\"",
+	"eval hints",
 	"eval \"string\"",
 	"eval \"string\" exit",
 	"eval {block}",
@@ -915,6 +923,9 @@
 	MEMBER_TO_FPTR(Perl_pp_aelemfast),
 	MEMBER_TO_FPTR(Perl_pp_aelem),
 	MEMBER_TO_FPTR(Perl_pp_aslice),
+	MEMBER_TO_FPTR(Perl_pp_aeach),
+	MEMBER_TO_FPTR(Perl_pp_akeys),
+	MEMBER_TO_FPTR(Perl_pp_akeys),	/* Perl_pp_avalues */
 	MEMBER_TO_FPTR(Perl_pp_each),
 	MEMBER_TO_FPTR(Perl_do_kv),	/* Perl_pp_values */
 	MEMBER_TO_FPTR(Perl_do_kv),	/* Perl_pp_keys */
@@ -923,6 +934,7 @@
 	MEMBER_TO_FPTR(Perl_pp_rv2av),	/* Perl_pp_rv2hv */
 	MEMBER_TO_FPTR(Perl_pp_helem),
 	MEMBER_TO_FPTR(Perl_pp_hslice),
+	MEMBER_TO_FPTR(Perl_pp_boolkeys),
 	MEMBER_TO_FPTR(Perl_pp_unpack),
 	MEMBER_TO_FPTR(Perl_pp_pack),
 	MEMBER_TO_FPTR(Perl_pp_split),
@@ -979,7 +991,6 @@
 	MEMBER_TO_FPTR(Perl_pp_goto),	/* Perl_pp_dump */
 	MEMBER_TO_FPTR(Perl_pp_goto),
 	MEMBER_TO_FPTR(Perl_pp_exit),
-	MEMBER_TO_FPTR(Perl_pp_setstate),
 	MEMBER_TO_FPTR(Perl_pp_method_named),
 	MEMBER_TO_FPTR(Perl_pp_entergiven),
 	MEMBER_TO_FPTR(Perl_pp_leavegiven),
@@ -1011,8 +1022,6 @@
 	MEMBER_TO_FPTR(Perl_pp_sysseek),
 	MEMBER_TO_FPTR(Perl_pp_sysread),
 	MEMBER_TO_FPTR(Perl_pp_send),	/* Perl_pp_syswrite */
-	MEMBER_TO_FPTR(Perl_pp_send),
-	MEMBER_TO_FPTR(Perl_pp_sysread),	/* Perl_pp_recv */
 	MEMBER_TO_FPTR(Perl_pp_eof),
 	MEMBER_TO_FPTR(Perl_pp_tell),
 	MEMBER_TO_FPTR(Perl_pp_sysseek),	/* Perl_pp_seek */
@@ -1020,6 +1029,8 @@
 	MEMBER_TO_FPTR(Perl_pp_ioctl),	/* Perl_pp_fcntl */
 	MEMBER_TO_FPTR(Perl_pp_ioctl),
 	MEMBER_TO_FPTR(Perl_pp_flock),
+	MEMBER_TO_FPTR(Perl_pp_send),
+	MEMBER_TO_FPTR(Perl_pp_sysread),	/* Perl_pp_recv */
 	MEMBER_TO_FPTR(Perl_pp_socket),
 	MEMBER_TO_FPTR(Perl_pp_sockpair),
 	MEMBER_TO_FPTR(Perl_pp_bind),
@@ -1108,6 +1119,7 @@
 	MEMBER_TO_FPTR(Perl_pp_semctl),
 	MEMBER_TO_FPTR(Perl_pp_require),
 	MEMBER_TO_FPTR(Perl_pp_require),	/* Perl_pp_dofile */
+	MEMBER_TO_FPTR(Perl_pp_hintseval),
 	MEMBER_TO_FPTR(Perl_pp_entereval),
 	MEMBER_TO_FPTR(Perl_pp_leaveeval),
 	MEMBER_TO_FPTR(Perl_pp_entertry),
@@ -1276,7 +1288,7 @@
 	MEMBER_TO_FPTR(Perl_ck_fun),	/* hex */
 	MEMBER_TO_FPTR(Perl_ck_fun),	/* oct */
 	MEMBER_TO_FPTR(Perl_ck_fun),	/* abs */
-	MEMBER_TO_FPTR(Perl_ck_lengthconst),	/* length */
+	MEMBER_TO_FPTR(Perl_ck_fun),	/* length */
 	MEMBER_TO_FPTR(Perl_ck_substr),	/* substr */
 	MEMBER_TO_FPTR(Perl_ck_fun),	/* vec */
 	MEMBER_TO_FPTR(Perl_ck_index),	/* index */
@@ -1295,14 +1307,18 @@
 	MEMBER_TO_FPTR(Perl_ck_null),	/* aelemfast */
 	MEMBER_TO_FPTR(Perl_ck_null),	/* aelem */
 	MEMBER_TO_FPTR(Perl_ck_null),	/* aslice */
-	MEMBER_TO_FPTR(Perl_ck_fun),	/* each */
-	MEMBER_TO_FPTR(Perl_ck_fun),	/* values */
-	MEMBER_TO_FPTR(Perl_ck_fun),	/* keys */
+	MEMBER_TO_FPTR(Perl_ck_each),	/* aeach */
+	MEMBER_TO_FPTR(Perl_ck_each),	/* akeys */
+	MEMBER_TO_FPTR(Perl_ck_each),	/* avalues */
+	MEMBER_TO_FPTR(Perl_ck_each),	/* each */
+	MEMBER_TO_FPTR(Perl_ck_each),	/* values */
+	MEMBER_TO_FPTR(Perl_ck_each),	/* keys */
 	MEMBER_TO_FPTR(Perl_ck_delete),	/* delete */
 	MEMBER_TO_FPTR(Perl_ck_exists),	/* exists */
 	MEMBER_TO_FPTR(Perl_ck_rvconst),	/* rv2hv */
 	MEMBER_TO_FPTR(Perl_ck_null),	/* helem */
 	MEMBER_TO_FPTR(Perl_ck_null),	/* hslice */
+	MEMBER_TO_FPTR(Perl_ck_fun),	/* boolkeys */
 	MEMBER_TO_FPTR(Perl_ck_unpack),	/* unpack */
 	MEMBER_TO_FPTR(Perl_ck_fun),	/* pack */
 	MEMBER_TO_FPTR(Perl_ck_split),	/* split */
@@ -1359,7 +1375,6 @@
 	MEMBER_TO_FPTR(Perl_ck_null),	/* dump */
 	MEMBER_TO_FPTR(Perl_ck_null),	/* goto */
 	MEMBER_TO_FPTR(Perl_ck_exit),	/* exit */
-	MEMBER_TO_FPTR(Perl_ck_null),	/* setstate */
 	MEMBER_TO_FPTR(Perl_ck_null),	/* method_named */
 	MEMBER_TO_FPTR(Perl_ck_null),	/* entergiven */
 	MEMBER_TO_FPTR(Perl_ck_null),	/* leavegiven */
@@ -1391,8 +1406,6 @@
 	MEMBER_TO_FPTR(Perl_ck_fun),	/* sysseek */
 	MEMBER_TO_FPTR(Perl_ck_fun),	/* sysread */
 	MEMBER_TO_FPTR(Perl_ck_fun),	/* syswrite */
-	MEMBER_TO_FPTR(Perl_ck_fun),	/* send */
-	MEMBER_TO_FPTR(Perl_ck_fun),	/* recv */
 	MEMBER_TO_FPTR(Perl_ck_eof),	/* eof */
 	MEMBER_TO_FPTR(Perl_ck_fun),	/* tell */
 	MEMBER_TO_FPTR(Perl_ck_fun),	/* seek */
@@ -1400,6 +1413,8 @@
 	MEMBER_TO_FPTR(Perl_ck_fun),	/* fcntl */
 	MEMBER_TO_FPTR(Perl_ck_fun),	/* ioctl */
 	MEMBER_TO_FPTR(Perl_ck_fun),	/* flock */
+	MEMBER_TO_FPTR(Perl_ck_fun),	/* send */
+	MEMBER_TO_FPTR(Perl_ck_fun),	/* recv */
 	MEMBER_TO_FPTR(Perl_ck_fun),	/* socket */
 	MEMBER_TO_FPTR(Perl_ck_fun),	/* sockpair */
 	MEMBER_TO_FPTR(Perl_ck_fun),	/* bind */
@@ -1488,9 +1503,10 @@
 	MEMBER_TO_FPTR(Perl_ck_fun),	/* semctl */
 	MEMBER_TO_FPTR(Perl_ck_require),	/* require */
 	MEMBER_TO_FPTR(Perl_ck_fun),	/* dofile */
+	MEMBER_TO_FPTR(Perl_ck_svconst),	/* hintseval */
 	MEMBER_TO_FPTR(Perl_ck_eval),	/* entereval */
 	MEMBER_TO_FPTR(Perl_ck_null),	/* leaveeval */
-	MEMBER_TO_FPTR(Perl_ck_null),	/* entertry */
+	MEMBER_TO_FPTR(Perl_ck_eval),	/* entertry */
 	MEMBER_TO_FPTR(Perl_ck_null),	/* leavetry */
 	MEMBER_TO_FPTR(Perl_ck_fun),	/* ghbyname */
 	MEMBER_TO_FPTR(Perl_ck_fun),	/* ghbyaddr */
@@ -1669,6 +1685,9 @@
 	0x00026c04,	/* aelemfast */
 	0x00026404,	/* aelem */
 	0x00046801,	/* aslice */
+	0x00007600,	/* aeach */
+	0x00007608,	/* akeys */
+	0x00007608,	/* avalues */
 	0x00009600,	/* each */
 	0x00009608,	/* values */
 	0x00009608,	/* keys */
@@ -1677,6 +1696,7 @@
 	0x00000248,	/* rv2hv */
 	0x00028404,	/* helem */
 	0x00048801,	/* hslice */
+	0x00009600,	/* boolkeys */
 	0x00122800,	/* unpack */
 	0x0004280d,	/* pack */
 	0x00222808,	/* split */
@@ -1733,7 +1753,6 @@
 	0x00001a44,	/* dump */
 	0x00001a44,	/* goto */
 	0x00013644,	/* exit */
-	0x00001404,	/* setstate */
 	0x00000c40,	/* method_named */
 	0x00000640,	/* entergiven */
 	0x00000200,	/* leavegiven */
@@ -1765,8 +1784,6 @@
 	0x0022c804,	/* sysseek */
 	0x122ec81d,	/* sysread */
 	0x1322c81d,	/* syswrite */
-	0x1222c81d,	/* send */
-	0x022ec81d,	/* recv */
 	0x0001d614,	/* eof */
 	0x0001d60c,	/* tell */
 	0x0022c804,	/* seek */
@@ -1774,6 +1791,8 @@
 	0x0022c80c,	/* fcntl */
 	0x0022c80c,	/* ioctl */
 	0x0002c91c,	/* flock */
+	0x1222c81d,	/* send */
+	0x022ec81d,	/* recv */
 	0x0222c814,	/* socket */
 	0x222cc814,	/* sockpair */
 	0x0002c814,	/* bind */
@@ -1862,9 +1881,10 @@
 	0x0222281d,	/* semctl */
 	0x000136c0,	/* require */
 	0x00002240,	/* dofile */
+	0x00000c04,	/* hintseval */
 	0x00003640,	/* entereval */
 	0x00002200,	/* leaveeval */
-	0x00000600,	/* entertry */
+	0x00001640,	/* entertry */
 	0x00000800,	/* leavetry */
 	0x00003600,	/* ghbyname */
 	0x00022800,	/* ghbyaddr */
Index: src/gnu/usr.bin/perl/opcode.pl
diff -u src/gnu/usr.bin/perl/opcode.pl:1.12 src/gnu/usr.bin/perl/opcode.pl:1.13
--- opcode.pl:1.12	Mon Oct 12 18:24:21 2009
+++ opcode.pl	Fri Sep 24 15:06:40 2010
@@ -30,7 +30,7 @@
 # Read data.
 
 my %seen;
-my (@ops, %desc, %check, %ckname, %flags, %args);
+my (@ops, %desc, %check, %ckname, %flags, %args, %opnum);
 
 while (<DATA>) {
     chop;
@@ -45,6 +45,7 @@
     $seen{$key} = qq[opcode "$key"];
 
     push(@ops, $key);
+    $opnum{$key} = $#ops;
     $desc{$key} = $desc;
     $check{$key} = $check;
     $ckname{$check}++;
@@ -104,6 +105,7 @@
 		 Perl_pp_sin => [qw(cos exp log sqrt)],
 		 Perl_pp_bit_or => ['bit_xor'],
 		 Perl_pp_rv2av => ['rv2hv'],
+		 Perl_pp_akeys => ['avalues'],
 		);
 
 while (my ($func, $names) = splice @raw_alias, 0, 2) {
@@ -161,7 +163,8 @@
 
 my $i = 0;
 for (@ops) {
-    print $on "\t", &tab(3,"OP_\U$_,"), "/* ", $i++, " */\n";
+    # print $on "\t", &tab(3,"OP_\U$_,"), "/* ", $i++, " */\n";
+      print $on "\t", &tab(3,"OP_\U$_"), " = ", $i++, ",\n";
 }
 print $on "\t", &tab(3,"OP_max"), "\n";
 print $on "} opcode;\n";
@@ -354,6 +357,7 @@
 
 my %OP_IS_SOCKET;
 my %OP_IS_FILETEST;
+my %OP_IS_FT_ACCESS;
 my $OCSHIFT = 9;
 my $OASHIFT = 13;
 
@@ -373,8 +377,10 @@
     my $argshift = $OASHIFT;
     for my $arg (split(' ',$args{$op})) {
 	if ($arg =~ /^F/) {
-           $OP_IS_SOCKET{$op}   = 1 if $arg =~ s/s//;
-           $OP_IS_FILETEST{$op} = 1 if $arg =~ s/-//;
+	    # record opnums of these opnames
+	    $OP_IS_SOCKET{$op}   = $opnum{$op} if $arg =~ s/s//;
+	    $OP_IS_FILETEST{$op} = $opnum{$op} if $arg =~ s/-//;
+	    $OP_IS_FT_ACCESS{$op} = $opnum{$op} if $arg =~ s/\+//;
         }
 	my $argnum = ($arg =~ s/\?//) ? 8 : 0;
         die "op = $op, arg = $arg\n"
@@ -400,18 +406,48 @@
 
 END
 
-if (keys %OP_IS_SOCKET) {
-    print $on "\n#define OP_IS_SOCKET(op)	\\\n\t(";
-    print $on join(" || \\\n\t ",
-               map { "(op) == OP_" . uc() } sort keys %OP_IS_SOCKET);
-    print $on ")\n\n";
-}
+# Emit OP_IS_* macros
+
+print $on <<EO_OP_IS_COMMENT;
 
-if (keys %OP_IS_FILETEST) {
-    print $on "\n#define OP_IS_FILETEST(op)	\\\n\t(";
-    print $on join(" || \\\n\t ",
-               map { "(op) == OP_" . uc() } sort keys %OP_IS_FILETEST);
-    print $on ")\n\n";
+/* the OP_IS_(SOCKET|FILETEST) macros are optimized to a simple range
+    check because all the member OPs are contiguous in opcode.pl
+    <DATA> table.  opcode.pl verifies the range contiguity.  */
+
+EO_OP_IS_COMMENT
+
+gen_op_is_macro( \%OP_IS_SOCKET, 'OP_IS_SOCKET');
+gen_op_is_macro( \%OP_IS_FILETEST, 'OP_IS_FILETEST');
+gen_op_is_macro( \%OP_IS_FT_ACCESS, 'OP_IS_FILETEST_ACCESS');
+
+sub gen_op_is_macro {
+    my ($op_is, $macname) = @_;
+    if (keys %$op_is) {
+	
+	# get opnames whose numbers are lowest and highest
+	my ($first, @rest) = sort {
+	    $op_is->{$a} <=> $op_is->{$b}
+	} keys %$op_is;
+	
+	my $last = pop @rest;	# @rest slurped, get its last
+	die "Invalid range of ops: $first .. $last\n" unless $last;
+
+	print $on "#define $macname(op)	\\\n\t(";
+
+	# verify that op-ct matches 1st..last range (and fencepost)
+	# (we know there are no dups)
+	if ( $op_is->{$last} - $op_is->{$first} == scalar @rest + 1) {
+	    
+	    # contiguous ops -> optimized version
+	    print $on "(op) >= OP_" . uc($first) . " && (op) <= OP_" . uc($last);
+	    print $on ")\n\n";
+	}
+	else {
+	    print $on join(" || \\\n\t ",
+			  map { "(op) == OP_" . uc() } sort keys %$op_is);
+	    print $on ")\n\n";
+	}
+    }
 }
 
 print $oc "/* ex: set ro: */\n";
@@ -575,7 +611,9 @@
 # Values for the operands are:
 # scalar      - S            list     - L            array     - A
 # hash        - H            sub (CV) - C            file      - F
-# socket      - Fs           filetest - F-           reference - R
+# socket      - Fs           filetest - F-           filetest_access - F-+
+
+# reference - R
 # "?" denotes an optional operand.
 
 # Nothing.
@@ -733,7 +771,7 @@
 
 # String stuff.
 
-length		length			ck_lengthconst	ifsTu%	S?
+length		length			ck_fun		ifsTu%	S?
 substr		substr			ck_substr	st@	S S S? S?
 vec		vec			ck_fun		ist@	S S S
 
@@ -758,16 +796,21 @@
 aelem		array element		ck_null		s2	A S
 aslice		array slice		ck_null		m@	A L
 
+aeach		each on array		ck_each		%	A
+akeys		keys on array		ck_each		t%	A
+avalues		values on array		ck_each		t%	A
+
 # Hashes.
 
-each		each			ck_fun		%	H
-values		values			ck_fun		t%	H
-keys		keys			ck_fun		t%	H
+each		each			ck_each		%	H
+values		values			ck_each		t%	H
+keys		keys			ck_each		t%	H
 delete		delete			ck_delete	%	S
 exists		exists			ck_exists	is%	S
 rv2hv		hash dereference	ck_rvconst	dt1	
 helem		hash element		ck_null		s2	H S
 hslice		hash slice		ck_null		m@	H L
+boolkeys	boolkeys		ck_fun		%	H
 
 # Explosives and implosives.
 
@@ -841,7 +884,6 @@
 dump		dump			ck_null		ds}	
 goto		goto			ck_null		ds}	
 exit		exit			ck_exit		ds%	S?
-setstate	set statement info	ck_null		s;
 method_named	method with known name	ck_null		d$
 
 entergiven	given()			ck_null		d|
@@ -884,9 +926,6 @@
 sysread		sysread			ck_fun		imst@	F R S S?
 syswrite	syswrite		ck_fun		imst@	F S S? S?
 
-send		send			ck_fun		imst@	Fs S S S?
-recv		recv			ck_fun		imst@	Fs R S S
-
 eof		eof			ck_eof		is%	F?
 tell		tell			ck_fun		st%	F?
 seek		seek			ck_fun		s@	F S S
@@ -897,7 +936,10 @@
 ioctl		ioctl			ck_fun		st@	F S S
 flock		flock			ck_fun		isT@	F S
 
-# Sockets.
+# Sockets.  OP_IS_SOCKET wants them consecutive (so moved 1st 2)
+
+send		send			ck_fun		imst@	Fs S S S?
+recv		recv			ck_fun		imst@	Fs R S S
 
 socket		socket			ck_fun		is@	Fs S S S
 sockpair	socketpair		ck_fun		is@	Fs Fs S S S
@@ -914,16 +956,16 @@
 getsockname	getsockname		ck_fun		is%	Fs
 getpeername	getpeername		ck_fun		is%	Fs
 
-# Stat calls.
+# Stat calls.  OP_IS_FILETEST wants them consecutive.
 
 lstat		lstat			ck_ftst		u-	F
 stat		stat			ck_ftst		u-	F
-ftrread		-R			ck_ftst		isu-	F-
-ftrwrite	-W			ck_ftst		isu-	F-
-ftrexec		-X			ck_ftst		isu-	F-
-fteread		-r			ck_ftst		isu-	F-
-ftewrite	-w			ck_ftst		isu-	F-
-fteexec		-x			ck_ftst		isu-	F-
+ftrread		-R			ck_ftst		isu-	F-+
+ftrwrite	-W			ck_ftst		isu-	F-+
+ftrexec		-X			ck_ftst		isu-	F-+
+fteread		-r			ck_ftst		isu-	F-+
+ftewrite	-w			ck_ftst		isu-	F-+
+fteexec		-x			ck_ftst		isu-	F-+
 ftis		-e			ck_ftst		isu-	F-
 ftsize		-s			ck_ftst		istu-	F-
 ftmtime		-M			ck_ftst		stu-	F-
@@ -1022,10 +1064,11 @@
 
 require		require			ck_require	du%	S?
 dofile		do "file"		ck_fun		d1	S
+hintseval	eval hints		ck_svconst	s$
 entereval	eval "string"		ck_eval		d%	S
 leaveeval	eval "string" exit	ck_null		1	S
 #evalonce	eval constant string	ck_null		d1	S
-entertry	eval {block}		ck_null		|	
+entertry	eval {block}		ck_eval		d%	
 leavetry	eval {block} exit	ck_null		@	
 
 # Get system info.
Index: src/gnu/usr.bin/perl/patchlevel.h
diff -u src/gnu/usr.bin/perl/patchlevel.h:1.17 src/gnu/usr.bin/perl/patchlevel.h:1.18
--- patchlevel.h:1.17	Mon Oct 12 18:24:21 2009
+++ patchlevel.h	Fri Sep 24 15:06:40 2010
@@ -14,8 +14,8 @@
  * exactly on the third column */
 
 #define PERL_REVISION	5		/* age */
-#define PERL_VERSION	10		/* epoch */
-#define PERL_SUBVERSION	1		/* generation */
+#define PERL_VERSION	12		/* epoch */
+#define PERL_SUBVERSION	2		/* generation */
 
 /* The following numbers describe the earliest compatible version of
    Perl ("compatibility" here being defined as sufficient binary/API
@@ -31,7 +31,7 @@
    to include in @INC.  See INSTALL for how this works.
 */
 #define PERL_API_REVISION	5	/* Adjust manually as needed.  */
-#define PERL_API_VERSION	10	/* Adjust manually as needed.  */
+#define PERL_API_VERSION	12	/* Adjust manually as needed.  */
 #define PERL_API_SUBVERSION	0	/* Adjust manually as needed.  */
 /*
    XXX Note:  The selection of non-default Configure options, such
@@ -118,19 +118,19 @@
 #if !defined(PERL_PATCHLEVEL_H_IMPLICIT) && !defined(LOCAL_PATCH_COUNT)
 #  if defined(PERL_IS_MINIPERL)
 #    define PERL_PATCHNUM "UNKNOWN-miniperl"
-#    define PERL_GIT_UNCOMMITTED_CHANGES ,"UNKNOWN"
 #    define PERL_GIT_UNPUSHED_COMMITS /*leave-this-comment*/
 #  elif defined(PERL_MICRO)
 #    define PERL_PATCHNUM "UNKNOWN-microperl"
-#    define PERL_GIT_UNCOMMITTED_CHANGES ,"UNKNOWN"
 #    define PERL_GIT_UNPUSHED_COMMITS /*leave-this-comment*/
 #  else
 #include "git_version.h"
 #  endif
 static const char * const local_patches[] = {
 	NULL
+#ifdef PERL_GIT_UNCOMMITTED_CHANGES
+	,"uncommitted-changes"
+#endif
 	PERL_GIT_UNPUSHED_COMMITS    	/* do not remove this line */
-        PERL_GIT_UNCOMMITTED_CHANGES	/* do not remove this line */
 	,NULL
 };
 
Index: src/gnu/usr.bin/perl/perl.c
diff -u src/gnu/usr.bin/perl/perl.c:1.20 src/gnu/usr.bin/perl/perl.c:1.21
--- perl.c:1.20	Tue Oct 13 01:25:48 2009
+++ perl.c	Fri Sep 24 15:06:40 2010
@@ -1,7 +1,9 @@
+#line 2 "perl.c"
 /*    perl.c
  *
  *    Copyright (C) 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
- *    2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009 by Larry Wall and others
+ *    2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 by Larry Wall
+ *    and others
  *
  *    You may distribute under the terms of either the GNU General Public
  *    License or the Artistic License, as specified in the README file.
@@ -22,73 +24,14 @@
  * function of the interpreter; that can be found in perlmain.c
  */
 
-/* PSz 12 Nov 03
- * 
- * Be proud that perl(1) may proclaim:
- *   Setuid Perl scripts are safer than C programs ...
- * Do not abandon (deprecate) suidperl. Do not advocate C wrappers.
- * 
- * The flow was: perl starts, notices script is suid, execs suidperl with same
- * arguments; suidperl opens script, checks many things, sets itself with
- * right UID, execs perl with similar arguments but with script pre-opened on
- * /dev/fd/xxx; perl checks script is as should be and does work. This was
- * insecure: see perlsec(1) for many problems with this approach.
- * 
- * The "correct" flow should be: perl starts, opens script and notices it is
- * suid, checks many things, execs suidperl with similar arguments but with
- * script on /dev/fd/xxx; suidperl checks script and /dev/fd/xxx object are
- * same, checks arguments match #! line, sets itself with right UID, execs
- * perl with same arguments; perl checks many things and does work.
- * 
- * (Opening the script in perl instead of suidperl, we "lose" scripts that
- * are readable to the target UID but not to the invoker. Where did
- * unreadable scripts work anyway?)
- * 
- * For now, suidperl and perl are pretty much the same large and cumbersome
- * program, so suidperl can check its argument list (see comments elsewhere).
- * 
- * References:
- * Original bug report:
- *   http://bugs.perl.org/index.html?req=bug_id&bug_id=20010322.218
- *   http://rt.perl.org/rt2/Ticket/Display.html?id=6511
- * Comments and discussion with Debian:
- *   http://bugs.debian.org/203426
- *   http://bugs.debian.org/220486
- * Debian Security Advisory DSA 431-1 (does not fully fix problem):
- *   http://www.debian.org/security/2004/dsa-431
- * CVE candidate:
- *   http://cve.mitre.org/cgi-bin/cvename.cgi?name=CAN-2003-0618
- * Previous versions of this patch sent to perl5-porters:
- *   http://www.mail-archive.com/perl5-porters@perl.org/msg71953.html
- *   http://www.mail-archive.com/perl5-porters@perl.org/msg75245.html
- *   http://www.mail-archive.com/perl5-porters@perl.org/msg75563.html
- *   http://www.mail-archive.com/perl5-porters@perl.org/msg75635.html
- * 
-Paul Szabo - psz@maths.usyd.edu.au  http://www.maths.usyd.edu.au:8000/u/psz/
-School of Mathematics and Statistics  University of Sydney   2006  Australia
- * 
- */
-/* PSz 13 Nov 03
- * Use truthful, neat, specific error messages.
- * Cannot always hide the truth; security must not depend on doing so.
- */
-
-/* PSz 18 Feb 04
- * Use global(?), thread-local fdscript for easier checks.
- * (I do not understand how we could possibly get a thread race:
- * do not all threads go through the same initialization? Or in
- * fact, are not threads started only after we get the script and
- * so know what to do? Oh well, make things super-safe...)
- */
-
 #include "EXTERN.h"
 #define PERL_IN_PERL_C
 #include "perl.h"
 #include "patchlevel.h"			/* for local_patches */
+#include "XSUB.h"
 
 #ifdef NETWARE
 #include "nwutil.h"	
-char *nw_get_sitelib(const char *pl);
 #endif
 
 /* XXX If this causes problems, set i_unistd=undef in the hint file.  */
@@ -129,22 +72,12 @@
 
 static I32 read_e_script(pTHX_ int idx, SV *buf_sv, int maxlen);
 
-#ifdef DOSUID
-#  ifdef IAMSUID
-/* Drop scriptname */
-#    define validate_suid(validarg, scriptname, fdscript, suidscript, linestr_sv, rsfp) S_validate_suid(aTHX_ validarg, fdscript, suidscript, linestr_sv, rsfp)
-#  else
-/* Drop suidscript */
-#    define validate_suid(validarg, scriptname, fdscript, suidscript, linestr_sv, rsfp) S_validate_suid(aTHX_ validarg, scriptname, fdscript, linestr_sv, rsfp)
-#  endif
-#else
-#  ifdef SETUID_SCRIPTS_ARE_SECURE_NOW
+#ifdef SETUID_SCRIPTS_ARE_SECURE_NOW
 /* Drop everything. Heck, don't even try to call it */
-#    define validate_suid(validarg, scriptname, fdscript, suidscript, linestr_sv, rsfp) NOOP
-#  else
+#  define validate_suid(validarg, scriptname, fdscript, suidscript, linestr_sv, rsfp) NOOP
+#else
 /* Drop almost everything */
-#    define validate_suid(validarg, scriptname, fdscript, suidscript, linestr_sv, rsfp) S_validate_suid(aTHX_ rsfp)
-#  endif
+#  define validate_suid(validarg, scriptname, fdscript, suidscript, linestr_sv, rsfp) S_validate_suid(aTHX_ rsfp)
 #endif
 
 #define CALL_BODY_EVAL(myop) \
@@ -176,8 +109,6 @@
 	OP_REFCNT_INIT;
 	HINTS_REFCNT_INIT;
 	MUTEX_INIT(&PL_dollarzero_mutex);
-#  endif
-#ifdef PERL_IMPLICIT_CONTEXT
 	MUTEX_INIT(&PL_my_ctx_mutex);
 #  endif
     }
@@ -375,8 +306,9 @@
     sv_setpvs(PERL_DEBUG_PAD(1), "");	/* ext/re needs these */
     sv_setpvs(PERL_DEBUG_PAD(2), "");	/* even without DEBUGGING. */
 #ifdef USE_ITHREADS
-    /* First entry is an array of empty elements */
-    Perl_av_create_and_push(aTHX_ &PL_regex_padav,(SV*)newAV());
+    /* First entry is a list of empty elements. It needs to be initialised
+       else all hell breaks loose in S_find_uninit_var().  */
+    Perl_av_create_and_push(aTHX_ &PL_regex_padav, newSVpvs(""));
     PL_regex_pad = AvARRAY(PL_regex_padav);
 #endif
 #ifdef USE_REENTRANT_API
@@ -459,6 +391,8 @@
     PL_timesbase.tms_cstime = 0;
 #endif
 
+    PL_osname = Perl_savepvn(aTHX_ STR_WITH_LEN(OSNAME));
+
     PL_registered_mros = newHV();
     /* Start with 1 bucket, for DFS.  It's unlikely we'll need more.  */
     HvMAX(PL_registered_mros) = 0;
@@ -605,6 +539,8 @@
     PERL_UNUSED_ARG(my_perl);
 #endif
 
+    assert(PL_scopestack_ix == 1);
+
     /* wait for all pseudo-forked children to finish */
     PERL_WAIT_FOR_CHILDREN;
 
@@ -632,6 +568,7 @@
     }
     LEAVE;
     FREETMPS;
+    assert(PL_scopestack_ix == 0);
 
     /* Need to flush since END blocks can produce output */
     my_fflush_all();
@@ -904,22 +841,6 @@
      * REGEXPs in the parent interpreter
      * we need to manually ReREFCNT_dec for the clones
      */
-    {
-        I32 i = AvFILLp(PL_regex_padav) + 1;
-        SV * const * const ary = AvARRAY(PL_regex_padav);
-
-        while (i) {
-            SV * const resv = ary[--i];
-
-	    if(SvREPADTMP(resv)) {
-	      SvREPADTMP_off(resv);
-	    }
-            else if(SvIOKp(resv)) {
-		REGEXP *re = INT2PTR(REGEXP *,SvIVX(resv));
-                ReREFCNT_dec(re);
-            }
-        }
-    }
     SvREFCNT_dec(PL_regex_padav);
     PL_regex_padav = NULL;
     PL_regex_pad = NULL;
@@ -942,7 +863,6 @@
     }
 
     /* switches */
-    PL_preprocess   = FALSE;
     PL_minus_n      = FALSE;
     PL_minus_p      = FALSE;
     PL_minus_l      = FALSE;
@@ -967,8 +887,8 @@
 
     /* magical thingies */
 
-    SvREFCNT_dec(PL_ofs_sv);	/* $, */
-    PL_ofs_sv = NULL;
+    SvREFCNT_dec(PL_ofsgv);	/* *, */
+    PL_ofsgv = NULL;
 
     SvREFCNT_dec(PL_ors_sv);	/* $\ */
     PL_ors_sv = NULL;
@@ -1071,7 +991,6 @@
 
     /* clear utf8 character classes */
     SvREFCNT_dec(PL_utf8_alnum);
-    SvREFCNT_dec(PL_utf8_alnumc);
     SvREFCNT_dec(PL_utf8_ascii);
     SvREFCNT_dec(PL_utf8_alpha);
     SvREFCNT_dec(PL_utf8_space);
@@ -1091,7 +1010,6 @@
     SvREFCNT_dec(PL_utf8_idstart);
     SvREFCNT_dec(PL_utf8_idcont);
     PL_utf8_alnum	= NULL;
-    PL_utf8_alnumc	= NULL;
     PL_utf8_ascii	= NULL;
     PL_utf8_alpha	= NULL;
     PL_utf8_space	= NULL;
@@ -1134,21 +1052,21 @@
     SvREFCNT_dec(PL_isarev);
 
     FREETMPS;
-    if (destruct_level >= 2 && ckWARN_d(WARN_INTERNAL)) {
+    if (destruct_level >= 2) {
 	if (PL_scopestack_ix != 0)
-	    Perl_warner(aTHX_ packWARN(WARN_INTERNAL),
-	         "Unbalanced scopes: %ld more ENTERs than LEAVEs\n",
-		 (long)PL_scopestack_ix);
+	    Perl_ck_warner_d(aTHX_ packWARN(WARN_INTERNAL),
+			     "Unbalanced scopes: %ld more ENTERs than LEAVEs\n",
+			     (long)PL_scopestack_ix);
 	if (PL_savestack_ix != 0)
-	    Perl_warner(aTHX_ packWARN(WARN_INTERNAL),
-		 "Unbalanced saves: %ld more saves than restores\n",
-		 (long)PL_savestack_ix);
+	    Perl_ck_warner_d(aTHX_ packWARN(WARN_INTERNAL),
+			     "Unbalanced saves: %ld more saves than restores\n",
+			     (long)PL_savestack_ix);
 	if (PL_tmps_floor != -1)
-	    Perl_warner(aTHX_ packWARN(WARN_INTERNAL),"Unbalanced tmps: %ld more allocs than frees\n",
-		 (long)PL_tmps_floor + 1);
+	    Perl_ck_warner_d(aTHX_ packWARN(WARN_INTERNAL),"Unbalanced tmps: %ld more allocs than frees\n",
+			     (long)PL_tmps_floor + 1);
 	if (cxstack_ix != -1)
-	    Perl_warner(aTHX_ packWARN(WARN_INTERNAL),"Unbalanced context: %ld more PUSHes than POPs\n",
-		 (long)cxstack_ix + 1);
+	    Perl_ck_warner_d(aTHX_ packWARN(WARN_INTERNAL),"Unbalanced context: %ld more PUSHes than POPs\n",
+			     (long)cxstack_ix + 1);
     }
 
     /* Now absolutely destruct everything, somehow or other, loops or no. */
@@ -1245,7 +1163,7 @@
 		    PerlIO_printf(Perl_debug_log, "leaked: sv=0x%p"
 			" flags=0x%"UVxf
 			" refcnt=%"UVuf pTHX__FORMAT "\n"
-			"\tallocated at %s:%d %s %s%s\n",
+			"\tallocated at %s:%d %s %s%s; serial %"UVuf"\n",
 			(void*)sv, (UV)sv->sv_flags, (UV)sv->sv_refcnt
 			pTHX__VALUE,
 			sv->sv_debug_file ? sv->sv_debug_file : "(unknown)",
@@ -1253,7 +1171,8 @@
 			sv->sv_debug_inpad ? "for" : "by",
 			sv->sv_debug_optype ?
 			    PL_op_name[sv->sv_debug_optype]: "(none)",
-			sv->sv_debug_cloned ? " (cloned)" : ""
+			sv->sv_debug_cloned ? " (cloned)" : "",
+			sv->sv_debug_serial
 		    );
 #ifdef DEBUG_LEAKING_SCALARS_FORK_DUMP
 		    Perl_dump_sv_child(aTHX_ sv);
@@ -1314,14 +1233,18 @@
     Safefree(PL_reg_poscache);
     free_tied_hv_pool();
     Safefree(PL_op_mask);
-    Safefree(PL_psig_ptr);
-    PL_psig_ptr = (SV**)NULL;
     Safefree(PL_psig_name);
     PL_psig_name = (SV**)NULL;
-    Safefree(PL_bitcount);
-    PL_bitcount = NULL;
+    PL_psig_ptr = (SV**)NULL;
     Safefree(PL_psig_pend);
     PL_psig_pend = (int*)NULL;
+    {
+	/* We need to NULL PL_psig_pend first, so that
+	   signal handlers know not to use it */
+	int *psig_save = PL_psig_pend;
+	PL_psig_pend = (int*)NULL;
+	Safefree(psig_save);
+    }
     PL_formfeed = NULL;
     nuke_stacks();
     PL_tainting = FALSE;
@@ -1539,11 +1462,6 @@
     PERL_UNUSED_ARG(my_perl);
 #endif
 
-#ifdef SETUID_SCRIPTS_ARE_SECURE_NOW_AND_IAMSUID
-    Perl_croak(aTHX_ "suidperl is no longer needed since the kernel can now "
-	       "execute\nsetuid perl scripts securely.\n");
-#endif
-
 #if defined(USE_HASH_SEED) || defined(USE_HASH_SEED_EXPLICIT)
     /* [perl #22371] Algorimic Complexity Attack on Perl 5.6.1, 5.8.0
      * This MUST be done before any hash stores or fetches take place.
@@ -1715,6 +1633,105 @@
     return ret;
 }
 
+/* This needs to stay in perl.c, as perl.c is compiled with different flags for
+   miniperl, and we need to see those flags reflected in the values here.  */
+
+/* What this returns is subject to change.  Use the public interface in Config.
+ */
+static void
+S_Internals_V(pTHX_ CV *cv)
+{
+    dXSARGS;
+#ifdef LOCAL_PATCH_COUNT
+    const int local_patch_count = LOCAL_PATCH_COUNT;
+#else
+    const int local_patch_count = 0;
+#endif
+    const int entries = 3 + local_patch_count;
+    int i;
+    static char non_bincompat_options[] = 
+#  ifdef DEBUGGING
+			     " DEBUGGING"
+#  endif
+#  ifdef NO_MATHOMS
+			     " NO_MATHOMS"
+#  endif
+#  ifdef PERL_DISABLE_PMC
+			     " PERL_DISABLE_PMC"
+#  endif
+#  ifdef PERL_DONT_CREATE_GVSV
+			     " PERL_DONT_CREATE_GVSV"
+#  endif
+#  ifdef PERL_IS_MINIPERL
+			     " PERL_IS_MINIPERL"
+#  endif
+#  ifdef PERL_MALLOC_WRAP
+			     " PERL_MALLOC_WRAP"
+#  endif
+#  ifdef PERL_MEM_LOG
+			     " PERL_MEM_LOG"
+#  endif
+#  ifdef PERL_MEM_LOG_NOIMPL
+			     " PERL_MEM_LOG_NOIMPL"
+#  endif
+#  ifdef PERL_USE_DEVEL
+			     " PERL_USE_DEVEL"
+#  endif
+#  ifdef PERL_USE_SAFE_PUTENV
+			     " PERL_USE_SAFE_PUTENV"
+#  endif
+#  ifdef USE_ATTRIBUTES_FOR_PERLIO
+			     " USE_ATTRIBUTES_FOR_PERLIO"
+#  endif
+#  ifdef USE_FAST_STDIO
+			     " USE_FAST_STDIO"
+#  endif	       
+#  ifdef USE_PERL_ATOF
+			     " USE_PERL_ATOF"
+#  endif	       
+#  ifdef USE_SITECUSTOMIZE
+			     " USE_SITECUSTOMIZE"
+#  endif	       
+	;
+    PERL_UNUSED_ARG(cv);
+    PERL_UNUSED_ARG(items);
+
+    EXTEND(SP, entries);
+
+    PUSHs(sv_2mortal(newSVpv(PL_bincompat_options, 0)));
+    PUSHs(Perl_newSVpvn_flags(aTHX_ non_bincompat_options,
+			      sizeof(non_bincompat_options) - 1, SVs_TEMP));
+
+#if defined(__DATE__) && !defined(__OpenBSD__)
+#  ifdef __TIME__
+    PUSHs(Perl_newSVpvn_flags(aTHX_
+			      STR_WITH_LEN("Compiled at " __DATE__ " " __TIME__),
+			      SVs_TEMP));
+#  else
+    PUSHs(Perl_newSVpvn_flags(aTHX_ STR_WITH_LEN("Compiled on " __DATE__),
+			      SVs_TEMP));
+#  endif
+#else
+    PUSHs(&PL_sv_undef);
+#endif
+
+    for (i = 1; i <= local_patch_count; i++) {
+	/* This will be an undef, if PL_localpatches[i] is NULL.  */
+	PUSHs(sv_2mortal(newSVpv(PL_localpatches[i], 0)));
+    }
+
+    XSRETURN(entries);
+}
+
+#define INCPUSH_UNSHIFT			0x01
+#define INCPUSH_ADD_OLD_VERS		0x02
+#define INCPUSH_ADD_VERSIONED_SUB_DIRS	0x04
+#define INCPUSH_ADD_ARCHONLY_SUB_DIRS	0x08
+#define INCPUSH_NOT_BASEDIR		0x10
+#define INCPUSH_CAN_RELOCATE		0x20
+#define INCPUSH_ADD_SUB_DIRS	\
+    (INCPUSH_ADD_VERSIONED_SUB_DIRS|INCPUSH_ADD_ARCHONLY_SUB_DIRS)
+
 STATIC void *
 S_parse_body(pTHX_ char **env, XSINIT_t xsinit)
 {
@@ -1724,10 +1741,6 @@
     char **argv = PL_origargv;
     const char *scriptname = NULL;
     VOL bool dosearch = FALSE;
-#ifdef DOSUID
-    const char *validarg = "";
-#endif
-    register SV *sv;
     register char c;
     const char *cddir = NULL;
 #ifdef USE_SITECUSTOMIZE
@@ -1739,8 +1752,6 @@
     SvGROW(linestr_sv, 80);
     sv_setpvs(linestr_sv,"");
 
-    sv = newSVpvs("");		/* first used for -I flags */
-    SAVEFREESV(sv);
     init_main_stash();
 
     {
@@ -1748,18 +1759,6 @@
     for (argc--,argv++; argc > 0; argc--,argv++) {
 	if (argv[0][0] != '-' || !argv[0][1])
 	    break;
-#ifdef DOSUID
-    if (*validarg)
-	validarg = " PHOOEY ";
-    else
-	validarg = argv[0];
-    /*
-     * Can we rely on the kernel to start scripts with argv[1] set to
-     * contain all #! line switches (the whole line)? (argv[0] is set to
-     * the interpreter name, argv[2] to the script name; argv[3] and
-     * above may contain other arguments.)
-     */
-#endif
 	s = argv[0]+1;
       reswitch:
 	switch ((c = *s)) {
@@ -1811,11 +1810,6 @@
 	    PL_minus_E = TRUE;
 	    /* FALL THROUGH */
 	case 'e':
-#ifdef MACOS_TRADITIONAL
-	    /* ignore -e for Dev:Pseudo argument */
-	    if (argv[1] && !strcmp(argv[1], "Dev:Pseudo"))
-		break;
-#endif
 	    forbid_setid('e', FALSE);
 	    if (!PL_e_script) {
 		PL_e_script = newSVpvs("");
@@ -1846,22 +1840,11 @@
 	    }
 	    if (s && *s) {
 		STRLEN len = strlen(s);
-		const char * const p = savepvn(s, len);
-		incpush(p, TRUE, TRUE, FALSE, FALSE);
-		sv_catpvs(sv, "-I");
-		sv_catpvn(sv, p, len);
-		sv_catpvs(sv, " ");
-		Safefree(p);
+		incpush(s, len, INCPUSH_ADD_SUB_DIRS|INCPUSH_ADD_OLD_VERS);
 	    }
 	    else
 		Perl_croak(aTHX_ "No directory specified for -I");
 	    break;
-	case 'P':
-	    forbid_setid('P', FALSE);
-	    PL_preprocess = TRUE;
-	    s++;
-	    deprecate("-P");
-	    goto reswitch;
 	case 'S':
 	    forbid_setid('S', FALSE);
 	    dosearch = TRUE;
@@ -1871,108 +1854,17 @@
 	    {
 		SV *opts_prog;
 
-		Perl_av_create_and_push(aTHX_ &PL_preambleav, newSVpvs("use Config;"));
 		if (*++s != ':')  {
-		    /* Can't do newSVpvs() as that would involve pre-processor
-		       condititionals inside a macro expansion.  */
-		    opts_prog = Perl_newSVpv(aTHX_ "$_ = join ' ', sort qw("
-#  ifdef DEBUGGING
-			     " DEBUGGING"
-#  endif
-#  ifdef NO_MATHOMS
-                            " NO_MATHOMS"
-#  endif
-#  ifdef PERL_DONT_CREATE_GVSV
-			     " PERL_DONT_CREATE_GVSV"
-#  endif
-#  ifdef PERL_MALLOC_WRAP
-			     " PERL_MALLOC_WRAP"
-#  endif
-#  ifdef PERL_MEM_LOG
-			     " PERL_MEM_LOG"
-#  endif
-#  ifdef PERL_MEM_LOG_ENV
-			     " PERL_MEM_LOG_ENV"
-#  endif
-#  ifdef PERL_MEM_LOG_ENV_FD
-			     " PERL_MEM_LOG_ENV_FD"
-#  endif
-#  ifdef PERL_MEM_LOG_STDERR
-			     " PERL_MEM_LOG_STDERR"
-#  endif
-#  ifdef PERL_MEM_LOG_TIMESTAMP
-			     " PERL_MEM_LOG_TIMESTAMP"
-#  endif
-#  ifdef PERL_USE_DEVEL
-			     " PERL_USE_DEVEL"
-#  endif
-#  ifdef PERL_USE_SAFE_PUTENV
-			     " PERL_USE_SAFE_PUTENV"
-#  endif
-#  ifdef USE_SITECUSTOMIZE
-			     " USE_SITECUSTOMIZE"
-#  endif	       
-#  ifdef USE_FAST_STDIO
-			     " USE_FAST_STDIO"
-#  endif	       
-					     , 0);
-
-		    sv_catpv(opts_prog, PL_bincompat_options);
-		    /* Terminate the qw(, and then wrap at 76 columns.  */
-		    sv_catpvs(opts_prog, "); s/(?=.{53})(.{1,53}) /$1\\n                        /mg;print Config::myconfig(),");
-#ifdef VMS
-		    sv_catpvs(opts_prog,"\"\\nCharacteristics of this PERLSHR image: \\n");
-#else
-		    sv_catpvs(opts_prog,"\"\\nCharacteristics of this binary (from libperl): \\n");
-#endif
-		    sv_catpvs(opts_prog,"  Compile-time options: $_\\n\",");
-
-#if defined(LOCAL_PATCH_COUNT)
-		    if (LOCAL_PATCH_COUNT > 0) {
-			int i;
-			sv_catpvs(opts_prog,
-				 "\"  Locally applied patches:\\n\",");
-			for (i = 1; i <= LOCAL_PATCH_COUNT; i++) {
-			    if (PL_localpatches[i])
-				Perl_sv_catpvf(aTHX_ opts_prog,"q%c\t%s\n%c,",
-				    0, PL_localpatches[i], 0);
-			}
-		    }
-#endif
-#ifdef __OpenBSD__
-		    Perl_sv_catpvf(aTHX_ opts_prog,
-				   "\"  Built under OpenBSD\\n\"");
-#else
-		    Perl_sv_catpvf(aTHX_ opts_prog,
-				   "\"  Built under %s\\n",OSNAME);
-#ifdef __DATE__
-#  ifdef __TIME__
-		    sv_catpvs(opts_prog,
-			      "  Compiled at " __DATE__ " " __TIME__ "\\n\"");
-#  else
-		    sv_catpvs(opts_prog, "  Compiled on " __DATE__ "\\n\"");
-#  endif
-#endif
-#endif
-		    sv_catpvs(opts_prog, "; $\"=\"\\n    \"; "
-			     "@env = map { \"$_=\\\"$ENV{$_}\\\"\" } "
-			     "sort grep {/^PERL/} keys %ENV; ");
-#ifdef __CYGWIN__
-		    sv_catpvs(opts_prog,
-			     "push @env, \"CYGWIN=\\\"$ENV{CYGWIN}\\\"\";");
-#endif
-		    sv_catpvs(opts_prog, 
-			     "print \"  \\%ENV:\\n    @env\\n\" if @env;"
-			     "print \"  \\@INC:\\n    @INC\\n\";");
+		    opts_prog = newSVpvs("use Config; Config::_V()");
 		}
 		else {
 		    ++s;
 		    opts_prog = Perl_newSVpvf(aTHX_
-					      "Config::config_vars(qw%c%s%c)",
+					      "use Config; Config::config_vars(qw%c%s%c)",
 					      0, s, 0);
 		    s += strlen(s);
 		}
-		av_push(PL_preambleav, opts_prog);
+		Perl_av_create_and_push(aTHX_ &PL_preambleav, opts_prog);
 		/* don't look for script or read stdin */
 		scriptname = BIT_BUCKET;
 		goto reswitch;
@@ -2039,7 +1931,7 @@
 		d = s;
 		if (!*s)
 		    break;
-		if (!strchr("CDIMUdmtw", *s))
+		if (!strchr("CDIMUdmtwW", *s))
 		    Perl_croak(aTHX_ "Illegal switch in PERL5OPT: -%c", *s);
 		while (++s && *s) {
 		    if (isSPACE(*s)) {
@@ -2065,10 +1957,15 @@
     }
     }
 
-#ifdef USE_SITECUSTOMIZE
+#if defined(USE_SITECUSTOMIZE) && !defined(PERL_IS_MINIPERL)
     if (!minus_f) {
+	/* SITELIB_EXP is a function call on Win32.
+	   The games with local $! are to avoid setting errno if there is no
+	   sitecustomize script.  */
+	const char *const sitelib = SITELIB_EXP;
 	(void)Perl_av_create_and_unshift_one(aTHX_ &PL_preambleav,
-					     Perl_newSVpvf(aTHX_ "BEGIN { do '%s/sitecustomize.pl' }", SITELIB_EXP));
+					     Perl_newSVpvf(aTHX_
+							   "BEGIN { do {local $!; -f '%s/sitecustomize.pl'} && do '%s/sitecustomize.pl' }", sitelib, sitelib));
     }
 #endif
 
@@ -2096,13 +1993,10 @@
     {
 	bool suidscript = FALSE;
 
-#ifdef DOSUID
-	const int fdscript =
-#endif
-	    open_script(scriptname, dosearch, sv, &suidscript, &rsfp);
+	open_script(scriptname, dosearch, &suidscript, &rsfp);
 
 	validate_suid(validarg, scriptname, fdscript, suidscript,
-		linestr_sv, rsfp);
+		      linestr_sv, rsfp);
 
 #ifndef PERL_MICRO
 #  if defined(SIGCHLD) || defined(SIGCLD)
@@ -2112,20 +2006,15 @@
 #  endif
 	    Sighandler_t sigstate = rsignal_state(SIGCHLD);
 	    if (sigstate == (Sighandler_t) SIG_IGN) {
-		if (ckWARN(WARN_SIGNAL))
-		    Perl_warner(aTHX_ packWARN(WARN_SIGNAL),
-				"Can't ignore signal CHLD, forcing to default");
+		Perl_ck_warner(aTHX_ packWARN(WARN_SIGNAL),
+			       "Can't ignore signal CHLD, forcing to default");
 		(void)rsignal(SIGCHLD, (Sighandler_t)SIG_DFL);
 	    }
 	}
 #  endif
 #endif
 
-	if (PL_doextract
-#ifdef MACOS_TRADITIONAL
-	    || gMacPerl_AlwaysExtract
-#endif
-	    ) {
+	if (PL_doextract) {
 
 	    /* This will croak if suidscript is true, as -x cannot be used with
 	       setuid scripts.  */
@@ -2147,8 +2036,8 @@
 
     boot_core_PerlIO();
     boot_core_UNIVERSAL();
-    boot_core_xsutils();
     boot_core_mro();
+    newXS("Internals::V", S_Internals_V, __FILE__);
 
     if (xsinit)
 	(*xsinit)(aTHX);	/* in case linked C routines want magical variables */
@@ -2180,6 +2069,7 @@
 #if defined(__SYMBIAN32__)
     PL_unicode = PERL_UNICODE_STD_FLAG; /* See PERL_SYMBIAN_CONSOLE_UTF8. */
 #endif
+#  ifndef PERL_IS_MINIPERL
     if (PL_unicode) {
 	 /* Requires init_predump_symbols(). */
 	 if (!(PL_unicode & PERL_UNICODE_LOCALE_FLAG) || PL_utf8locale) {
@@ -2218,6 +2108,7 @@
 	      }
 	 }
     }
+#endif
 
     {
 	const char *s;
@@ -2266,16 +2157,6 @@
     /* now parse the script */
 
     SETERRNO(0,SS_NORMAL);
-#ifdef MACOS_TRADITIONAL
-    if (gMacPerl_SyntaxError = (yyparse() || PL_parser->error_count)) {
-	if (PL_minus_c)
-	    Perl_croak(aTHX_ "%s had compilation errors.\n", MacPerl_MPWFileName(PL_origfilename));
-	else {
-	    Perl_croak(aTHX_ "Execution of %s aborted due to compilation errors.\n",
-		       MacPerl_MPWFileName(PL_origfilename));
-	}
-    }
-#else
     if (yyparse() || PL_parser->error_count) {
 	if (PL_minus_c)
 	    Perl_croak(aTHX_ "%s had compilation errors.\n", PL_origfilename);
@@ -2284,10 +2165,8 @@
 		       PL_origfilename);
 	}
     }
-#endif
     CopLINE_set(PL_curcop, 0);
     PL_curstash = PL_defstash;
-    PL_preprocess = FALSE;
     if (PL_e_script) {
 	SvREFCNT_dec(PL_e_script);
 	PL_e_script = NULL;
@@ -2396,22 +2275,15 @@
 	    exit(0);	/* less likely to core dump than my_exit(0) */
 	}
 #endif
-	DEBUG_x(dump_all());
 #ifdef DEBUGGING
+	if (DEBUG_x_TEST || DEBUG_B_TEST)
+	    dump_all_perl(!DEBUG_B_TEST);
 	if (!DEBUG_q_TEST)
 	  PERL_DEBUG(PerlIO_printf(Perl_debug_log, "\nEXECUTING...\n\n"));
 #endif
-	DEBUG_S(PerlIO_printf(Perl_debug_log, "main thread is 0x%"UVxf"\n",
-			      PTR2UV(thr)));
 
 	if (PL_minus_c) {
-#ifdef MACOS_TRADITIONAL
-	    PerlIO_printf(Perl_error_log, "%s%s syntax OK\n",
-		(gMacPerl_ErrorFormat ? "# " : ""),
-		MacPerl_MPWFileName(PL_origfilename));
-#else
 	    PerlIO_printf(Perl_error_log, "%s syntax OK\n", PL_origfilename);
-#endif
 	    my_exit(0);
 	}
 	if (PERLDB_SINGLE && PL_DBsingle)
@@ -2558,6 +2430,8 @@
     return NULL;
 }
 
+/* Nothing in core calls this now, but we can't replace it with a macro and
+   move it to mathoms.c as a macro would evaluate name twice.  */
 CV*
 Perl_get_cv(pTHX_ const char *name, I32 flags)
 {
@@ -2633,9 +2507,13 @@
                		/* name of the subroutine */
           		/* See G_* flags in cop.h */
 {
+    STRLEN len;
     PERL_ARGS_ASSERT_CALL_METHOD;
 
-    return call_sv(sv_2mortal(newSVpv(methname,0)), flags | G_METHOD);
+    len = strlen(methname);
+
+    /* XXX: sv_2mortal(newSVpvn_share(methname, len)) can be faster */
+    return call_sv(newSVpvn_flags(methname, len, SVs_TEMP), flags | G_METHOD);
 }
 
 /* May be called with any of a CV, a GV, or an SV containing the name. */
@@ -2669,6 +2547,11 @@
 	ENTER;
 	SAVETMPS;
     }
+    if (!(flags & G_WANT)) {
+	/* Backwards compatibility - as G_SCALAR was 0, it could be omitted.
+	 */
+	flags |= G_SCALAR;
+    }
 
     Zero(&myop, 1, LOGOP);
     myop.op_next = NULL;
@@ -2733,8 +2616,6 @@
 	    PL_curstash = PL_defstash;
 	    FREETMPS;
 	    JMPENV_POP;
-	    if (PL_statusvalue && !(PL_exit_flags & PERL_EXIT_EXPECTED))
-		Perl_croak(aTHX_ "Callback called exit");
 	    my_exit_jump();
 	    /* NOTREACHED */
 	case 3:
@@ -2835,8 +2716,6 @@
 	PL_curstash = PL_defstash;
 	FREETMPS;
 	JMPENV_POP;
-	if (PL_statusvalue && !(PL_exit_flags & PERL_EXIT_EXPECTED))
-	    Perl_croak(aTHX_ "Callback called exit");
 	my_exit_jump();
 	/* NOTREACHED */
     case 3:
@@ -2927,17 +2806,6 @@
     POPSTACK;
 }
 
-void
-Perl_magicname(pTHX_ const char *sym, const char *name, I32 namlen)
-{
-    register GV * const gv = gv_fetchpv(sym, GV_ADD, SVt_PV);
-
-    PERL_ARGS_ASSERT_MAGICNAME;
-
-    if (gv)
-	sv_magic(GvSV(gv), MUTABLE_SV(gv), PERL_MAGIC_sv, name, namlen);
-}
-
 STATIC void
 S_usage(pTHX_ const char *name)		/* XXX move this out into a module ? */
 {
@@ -2961,7 +2829,6 @@
 "-[mM][-]module    execute \"use/no module...\" before executing program",
 "-n                assume \"while (<>) { ... }\" loop around program",
 "-p                assume loop like -n but print line also, like sed",
-"-P                run program through C preprocessor before compilation",
 "-s                enable rudimentary parsing for switches after programfile",
 "-S                look for programfile using PATH environment variable",
 "-t                enable tainting warnings",
@@ -3003,7 +2870,7 @@
       "  t  Trace execution",
       "  o  Method and overloading resolution",
       "  c  String/numeric conversions",
-      "  P  Print profiling info, preprocessor command for -P, source file input state",
+      "  P  Print profiling info, source file input state",
       "  m  Memory and SV allocation",
       "  f  Format processing",
       "  r  Regular expression parsing and execution",
@@ -3012,7 +2879,6 @@
       "  H  Hash dump -- usurps values()",
       "  X  Scratchpad allocation",
       "  D  Cleaning up",
-      "  S  Thread synchronization",
       "  T  Tokenising",
       "  R  Include reference counts of dumped variables (eg when using -Ds)",
       "  J  Do not s,t,P-debug (Jump over) opcodes within package DB",
@@ -3020,6 +2886,8 @@
       "  C  Copy On Write",
       "  A  Consistency checks on internal structures",
       "  q  quiet - currently only suppresses the 'EXECUTING' message",
+      "  M  trace smart match resolution",
+      "  B  dump suBroutine definitions, including special Blocks like BEGIN",
       NULL
     };
     int i = 0;
@@ -3028,7 +2896,7 @@
 
     if (isALPHA(**s)) {
 	/* if adding extra options, remember to update DEBUG_MASK */
-	static const char debopts[] = "psltocPmfrxuUHXDSTRJvCAq";
+	static const char debopts[] = "psltocPmfrxuUHXDSTRJvCAqMB";
 
 	for (; isALNUM(**s); (*s)++) {
 	    const char * const d = strchr(debopts,**s);
@@ -3219,9 +3087,8 @@
 		while (isSPACE(*p))
 		    p++;
 	    } while (*p && *p != '-');
-	    e = savepvn(s, e-s);
-	    incpush(e, TRUE, TRUE, FALSE, FALSE);
-	    Safefree(e);
+	    incpush(s, e-s,
+		    INCPUSH_ADD_SUB_DIRS|INCPUSH_ADD_OLD_VERS|INCPUSH_UNSHIFT);
 	    s = p;
 	    if (*s == '-')
 		s++;
@@ -3332,9 +3199,6 @@
 	s++;
 	return s;
     case 'u':
-#ifdef MACOS_TRADITIONAL
-	Perl_croak(aTHX_ "Believe me, you don't want to use \"-u\" on a Macintosh");
-#endif
 	PL_do_undump = TRUE;
 	s++;
 	return s;
@@ -3364,10 +3228,11 @@
 	    }
  #endif
 	    PerlIO_printf(PerlIO_stdout(),
-		"\nThis is perl, %"SVf
-		" built for %s",
-		level,
-		ARCHNAME);
+		"\nThis is perl "	STRINGIFY(PERL_REVISION)
+		", version "		STRINGIFY(PERL_VERSION)
+		", subversion "		STRINGIFY(PERL_SUBVERSION)
+		" (%"SVf") built for "	ARCHNAME, level
+		);
 	    SvREFCNT_dec(level);
 	}
 #else /* DGUX */
@@ -3392,12 +3257,7 @@
 #endif
 
 	PerlIO_printf(PerlIO_stdout(),
-		      "\n\nCopyright 1987-2009, Larry Wall\n");
-#ifdef MACOS_TRADITIONAL
-	PerlIO_printf(PerlIO_stdout(),
-		      "\nMac OS port Copyright 1991-2002, Matthias Neeracher;\n"
-		      "maintained by Chris Nandor\n");
-#endif
+		      "\n\nCopyright 1987-2010, Larry Wall\n");
 #ifdef MSDOS
 	PerlIO_printf(PerlIO_stdout(),
 		      "\nMS-DOS port Copyright (c) 1989, 1990, Diomidis Spinellis\n");
@@ -3440,10 +3300,6 @@
 	PerlIO_printf(PerlIO_stdout(),
 		      "BS2000 (POSIX) port by Start Amadeus GmbH, 1998-1999\n");
 #endif
-#ifdef __MINT__
-	PerlIO_printf(PerlIO_stdout(),
-		      "MiNT port by Guido Flohr, 1997-1999\n");
-#endif
 #ifdef EPOC
 	PerlIO_printf(PerlIO_stdout(),
 		      "EPOC port by Olaf Flebbe, 1999-2002\n");
@@ -3507,10 +3363,6 @@
     case 'S':			/* OS/2 needs -S on "extproc" line. */
 	break;
 #endif
-    case 'P':
-	if (PL_preprocess)
-	    return s+1;
-	/* FALL THROUGH */
     default:
 	Perl_croak(aTHX_ "Can't emulate -%.1s on #! line",s);
     }
@@ -3637,15 +3489,9 @@
 }
 
 STATIC int
-S_open_script(pTHX_ const char *scriptname, bool dosearch, SV *sv,
+S_open_script(pTHX_ const char *scriptname, bool dosearch,
 	      bool *suidscript, PerlIO **rsfpp)
 {
-#ifndef IAMSUID
-    const char *quote;
-    const char *code;
-    const char *cpp_discard_flag;
-    const char *perl;
-#endif
     int fdscript = -1;
     dVAR;
 
@@ -3703,89 +3549,6 @@
 	        fcntl(PerlIO_fileno(*rsfpp),F_SETFD,1);
 #       endif
     }
-#ifdef IAMSUID
-    else {
-	Perl_croak(aTHX_ "sperl needs fd script\n"
-		   "You should not call sperl directly; do you need to "
-		   "change a #! line\nfrom sperl to perl?\n");
-
-/* PSz 11 Nov 03
- * Do not open (or do other fancy stuff) while setuid.
- * Perl does the open, and hands script to suidperl on a fd;
- * suidperl only does some checks, sets up UIDs and re-execs
- * perl with that fd as it has always done.
- */
-    }
-    if (!*suidscript) {
-	Perl_croak(aTHX_ "suidperl needs (suid) fd script\n");
-    }
-#else /* IAMSUID */
-    else if (PL_preprocess) {
-	const char * const cpp_cfg = CPPSTDIN;
-	SV * const cpp = newSVpvs("");
-	SV * const cmd = newSV(0);
-
-	if (cpp_cfg[0] == 0) /* PERL_MICRO? */
-	     Perl_croak(aTHX_ "Can't run with cpp -P with CPPSTDIN undefined");
-	if (strEQ(cpp_cfg, "cppstdin"))
-	    Perl_sv_catpvf(aTHX_ cpp, "%s/", BIN_EXP);
-	sv_catpv(cpp, cpp_cfg);
-
-#       ifndef VMS
-	    sv_catpvs(sv, "-I");
-	    sv_catpv(sv,PRIVLIB_EXP);
-#       endif
-
-	DEBUG_P(PerlIO_printf(Perl_debug_log,
-			      "PL_preprocess: scriptname=\"%s\", cpp=\"%s\", sv=\"%s\", CPPMINUS=\"%s\"\n",
-			      scriptname, SvPVX_const (cpp), SvPVX_const (sv),
-			      CPPMINUS));
-
-#       if defined(MSDOS) || defined(WIN32) || defined(VMS)
-            quote = "\"";
-#       else
-            quote = "'";
-#       endif
-
-#       ifdef VMS
-            cpp_discard_flag = "";
-#       else
-            cpp_discard_flag = "-C";
-#       endif
-
-#       ifdef OS2
-            perl = os2_execname(aTHX);
-#       else
-            perl = PL_origargv[0];
-#       endif
-
-
-        /* This strips off Perl comments which might interfere with
-           the C pre-processor, including #!.  #line directives are
-           deliberately stripped to avoid confusion with Perl's version
-           of #line.  FWP played some golf with it so it will fit
-           into VMS's 255 character buffer.
-        */
-        if( PL_doextract )
-            code = "(1../^#!.*perl/i)|/^\\s*#(?!\\s*((ifn?|un)def|(el|end)?if|define|include|else|error|pragma)\\b)/||!($|=1)||print";
-        else
-            code = "/^\\s*#(?!\\s*((ifn?|un)def|(el|end)?if|define|include|else|error|pragma)\\b)/||!($|=1)||print";
-
-        Perl_sv_setpvf(aTHX_ cmd, "\
-%s -ne%s%s%s %s | %"SVf" %s %"SVf" %s",
-                       perl, quote, code, quote, scriptname, SVfARG(cpp),
-                       cpp_discard_flag, SVfARG(sv), CPPMINUS);
-
-	PL_doextract = FALSE;
-
-        DEBUG_P(PerlIO_printf(Perl_debug_log,
-                              "PL_preprocess: cmd=\"%s\"\n",
-                              SvPVX_const(cmd)));
-
-	*rsfpp = PerlProc_popen((char *)SvPVX_const(cmd), (char *)"r");
-	SvREFCNT_dec(cmd);
-	SvREFCNT_dec(cpp);
-    }
     else if (!*scriptname) {
 	forbid_setid(0, *suidscript);
 	*rsfpp = PerlIO_stdin();
@@ -3838,7 +3601,6 @@
 	        fcntl(PerlIO_fileno(*rsfpp),F_SETFD,1);
 #       endif
     }
-#endif /* IAMSUID */
     if (!*rsfpp) {
 	/* PSz 16 Sep 03  Keep neat error message */
 	if (PL_e_script)
@@ -3857,523 +3619,10 @@
  * I_MNTENT	HAS_GETMNTENT	HAS_HASMNTOPT
  * here so that metaconfig picks them up. */
 
-#ifdef IAMSUID
-STATIC int
-S_fd_on_nosuid_fs(pTHX_ int fd)
-{
-/* PSz 27 Feb 04
- * We used to do this as "plain" user (after swapping UIDs with setreuid);
- * but is needed also on machines without setreuid.
- * Seems safe enough to run as root.
- */
-    int check_okay = 0; /* able to do all the required sys/libcalls */
-    int on_nosuid  = 0; /* the fd is on a nosuid fs */
-    /* PSz 12 Nov 03
-     * Need to check noexec also: nosuid might not be set, the average
-     * sysadmin would say that nosuid is irrelevant once he sets noexec.
-     */
-    int on_noexec  = 0; /* the fd is on a noexec fs */
-
-/*
- * Preferred order: fstatvfs(), fstatfs(), ustat()+getmnt(), getmntent().
- * fstatvfs() is UNIX98.
- * fstatfs() is 4.3 BSD.
- * ustat()+getmnt() is pre-4.3 BSD.
- * getmntent() is O(number-of-mounted-filesystems) and can hang on
- * an irrelevant filesystem while trying to reach the right one.
- */
-
-#undef FD_ON_NOSUID_CHECK_OKAY  /* found the syscalls to do the check? */
-
-#   if !defined(FD_ON_NOSUID_CHECK_OKAY) && \
-        defined(HAS_FSTATVFS)
-#   define FD_ON_NOSUID_CHECK_OKAY
-    struct statvfs stfs;
-
-    check_okay = fstatvfs(fd, &stfs) == 0;
-    on_nosuid  = check_okay && (stfs.f_flag  & ST_NOSUID);
-#ifdef ST_NOEXEC
-    /* ST_NOEXEC certainly absent on AIX 5.1, and doesn't seem to be documented
-       on platforms where it is present.  */
-    on_noexec  = check_okay && (stfs.f_flag  & ST_NOEXEC);
-#endif
-#   endif /* fstatvfs */
-
-#   if !defined(FD_ON_NOSUID_CHECK_OKAY) && \
-        defined(PERL_MOUNT_NOSUID)	&& \
-        defined(PERL_MOUNT_NOEXEC)	&& \
-        defined(HAS_FSTATFS) 		&& \
-        defined(HAS_STRUCT_STATFS)	&& \
-        defined(HAS_STRUCT_STATFS_F_FLAGS)
-#   define FD_ON_NOSUID_CHECK_OKAY
-    struct statfs  stfs;
-
-    check_okay = fstatfs(fd, &stfs)  == 0;
-    on_nosuid  = check_okay && (stfs.f_flags & PERL_MOUNT_NOSUID);
-    on_noexec  = check_okay && (stfs.f_flags & PERL_MOUNT_NOEXEC);
-#   endif /* fstatfs */
-
-#   if !defined(FD_ON_NOSUID_CHECK_OKAY) && \
-        defined(PERL_MOUNT_NOSUID)	&& \
-        defined(PERL_MOUNT_NOEXEC)	&& \
-        defined(HAS_FSTAT)		&& \
-        defined(HAS_USTAT)		&& \
-        defined(HAS_GETMNT)		&& \
-        defined(HAS_STRUCT_FS_DATA)	&& \
-        defined(NOSTAT_ONE)
-#   define FD_ON_NOSUID_CHECK_OKAY
-    Stat_t fdst;
-
-    if (fstat(fd, &fdst) == 0) {
-        struct ustat us;
-        if (ustat(fdst.st_dev, &us) == 0) {
-            struct fs_data fsd;
-            /* NOSTAT_ONE here because we're not examining fields which
-             * vary between that case and STAT_ONE. */
-            if (getmnt((int*)0, &fsd, (int)0, NOSTAT_ONE, us.f_fname) == 0) {
-                size_t cmplen = sizeof(us.f_fname);
-                if (sizeof(fsd.fd_req.path) < cmplen)
-                    cmplen = sizeof(fsd.fd_req.path);
-                if (strnEQ(fsd.fd_req.path, us.f_fname, cmplen) &&
-                    fdst.st_dev == fsd.fd_req.dev) {
-                    check_okay = 1;
-                    on_nosuid = fsd.fd_req.flags & PERL_MOUNT_NOSUID;
-                    on_noexec = fsd.fd_req.flags & PERL_MOUNT_NOEXEC;
-                }
-            }
-        }
-    }
-#   endif /* fstat+ustat+getmnt */
-
-#   if !defined(FD_ON_NOSUID_CHECK_OKAY) && \
-        defined(HAS_GETMNTENT)		&& \
-        defined(HAS_HASMNTOPT)		&& \
-        defined(MNTOPT_NOSUID)		&& \
-        defined(MNTOPT_NOEXEC)
-#   define FD_ON_NOSUID_CHECK_OKAY
-    FILE                *mtab = fopen("/etc/mtab", "r");
-    struct mntent       *entry;
-    Stat_t              stb, fsb;
-
-    if (mtab && (fstat(fd, &stb) == 0)) {
-        while (entry = getmntent(mtab)) {
-            if (stat(entry->mnt_dir, &fsb) == 0
-                && fsb.st_dev == stb.st_dev)
-            {
-                /* found the filesystem */
-                check_okay = 1;
-                if (hasmntopt(entry, MNTOPT_NOSUID))
-                    on_nosuid = 1;
-                if (hasmntopt(entry, MNTOPT_NOEXEC))
-                    on_noexec = 1;
-                break;
-            } /* A single fs may well fail its stat(). */
-        }
-    }
-    if (mtab)
-        fclose(mtab);
-#   endif /* getmntent+hasmntopt */
-
-    if (!check_okay)
-	Perl_croak(aTHX_ "Can't check filesystem of script \"%s\" for nosuid/noexec", PL_origfilename);
-    if (on_nosuid)
-	Perl_croak(aTHX_ "Setuid script \"%s\" on nosuid filesystem", PL_origfilename);
-    if (on_noexec)
-	Perl_croak(aTHX_ "Setuid script \"%s\" on noexec filesystem", PL_origfilename);
-    return ((!check_okay) || on_nosuid || on_noexec);
-}
-#endif /* IAMSUID */
-
-#ifdef DOSUID
-STATIC void
-S_validate_suid(pTHX_ const char *validarg,
-#  ifndef IAMSUID
-		const char *scriptname,
-#  endif
-		int fdscript,
-#  ifdef IAMSUID
-		bool suidscript,
-#  endif
-		SV *linestr_sv, PerlIO *rsfp)
-{
-    dVAR;
-    const char *s, *s2;
-
-    PERL_ARGS_ASSERT_VALIDATE_SUID;
-
-    /* do we need to emulate setuid on scripts? */
-
-    /* This code is for those BSD systems that have setuid #! scripts disabled
-     * in the kernel because of a security problem.  Merely defining DOSUID
-     * in perl will not fix that problem, but if you have disabled setuid
-     * scripts in the kernel, this will attempt to emulate setuid and setgid
-     * on scripts that have those now-otherwise-useless bits set.  The setuid
-     * root version must be called suidperl or sperlN.NNN.  If regular perl
-     * discovers that it has opened a setuid script, it calls suidperl with
-     * the same argv that it had.  If suidperl finds that the script it has
-     * just opened is NOT setuid root, it sets the effective uid back to the
-     * uid.  We don't just make perl setuid root because that loses the
-     * effective uid we had before invoking perl, if it was different from the
-     * uid.
-     * PSz 27 Feb 04
-     * Description/comments above do not match current workings:
-     *   suidperl must be hardlinked to sperlN.NNN (that is what we exec);
-     *   suidperl called with script open and name changed to /dev/fd/N/X;
-     *   suidperl croaks if script is not setuid;
-     *   making perl setuid would be a huge security risk (and yes, that
-     *     would lose any euid we might have had).
-     *
-     * DOSUID must be defined in both perl and suidperl, and IAMSUID must
-     * be defined in suidperl only.  suidperl must be setuid root.  The
-     * Configure script will set this up for you if you want it.
-     */
-
-    if (PerlLIO_fstat(PerlIO_fileno(rsfp),&PL_statbuf) < 0)	/* normal stat is insecure */
-	Perl_croak(aTHX_ "Can't stat script \"%s\"",PL_origfilename);
-    if (PL_statbuf.st_mode & (S_ISUID|S_ISGID)) {
-	I32 len;
-	const char *linestr;
-	const char *s_end;
-
-#  ifdef IAMSUID
-	if (fdscript < 0 || !suidscript)
-	    Perl_croak(aTHX_ "Need (suid) fdscript in suidperl\n");	/* We already checked this */
-	/* PSz 11 Nov 03
-	 * Since the script is opened by perl, not suidperl, some of these
-	 * checks are superfluous. Leaving them in probably does not lower
-	 * security(?!).
-	 */
-	/* PSz 27 Feb 04
-	 * Do checks even for systems with no HAS_SETREUID.
-	 * We used to swap, then re-swap UIDs with
-#    ifdef HAS_SETREUID
-	    if (setreuid(PL_euid,PL_uid) < 0
-		|| PerlProc_getuid() != PL_euid || PerlProc_geteuid() != PL_uid)
-		Perl_croak(aTHX_ "Can't swap uid and euid");
-#    endif
-#    ifdef HAS_SETREUID
-	    if (setreuid(PL_uid,PL_euid) < 0
-		|| PerlProc_getuid() != PL_uid || PerlProc_geteuid() != PL_euid)
-		Perl_croak(aTHX_ "Can't reswap uid and euid");
-#    endif
-	 */
-
-	/* On this access check to make sure the directories are readable,
-	 * there is actually a small window that the user could use to make
-	 * filename point to an accessible directory.  So there is a faint
-	 * chance that someone could execute a setuid script down in a
-	 * non-accessible directory.  I don't know what to do about that.
-	 * But I don't think it's too important.  The manual lies when
-	 * it says access() is useful in setuid programs.
-	 * 
-	 * So, access() is pretty useless... but not harmful... do anyway.
-	 */
-	if (PerlLIO_access(CopFILE(PL_curcop),1)) { /*double check*/
-	    Perl_croak(aTHX_ "Can't access() script\n");
-	}
-
-	/* If we can swap euid and uid, then we can determine access rights
-	 * with a simple stat of the file, and then compare device and
-	 * inode to make sure we did stat() on the same file we opened.
-	 * Then we just have to make sure he or she can execute it.
-	 * 
-	 * PSz 24 Feb 04
-	 * As the script is opened by perl, not suidperl, we do not need to
-	 * care much about access rights.
-	 * 
-	 * The 'script changed' check is needed, or we can get lied to
-	 * about $0 with e.g.
-	 *  suidperl /dev/fd/4//bin/x 4<setuidscript
-	 * Without HAS_SETREUID, is it safe to stat() as root?
-	 * 
-	 * Are there any operating systems that pass /dev/fd/xxx for setuid
-	 * scripts, as suggested/described in perlsec(1)? Surely they do not
-	 * pass the script name as we do, so the "script changed" test would
-	 * fail for them... but we never get here with
-	 * SETUID_SCRIPTS_ARE_SECURE_NOW defined.
-	 * 
-	 * This is one place where we must "lie" about return status: not
-	 * say if the stat() failed. We are doing this as root, and could
-	 * be tricked into reporting existence or not of files that the
-	 * "plain" user cannot even see.
-	 */
-	{
-	    Stat_t tmpstatbuf;
-	    if (PerlLIO_stat(CopFILE(PL_curcop),&tmpstatbuf) < 0 ||
-		tmpstatbuf.st_dev != PL_statbuf.st_dev ||
-		tmpstatbuf.st_ino != PL_statbuf.st_ino) {
-		Perl_croak(aTHX_ "Setuid script changed\n");
-	    }
 
-	}
-	if (!cando(S_IXUSR,FALSE,&PL_statbuf))		/* can real uid exec? */
-	    Perl_croak(aTHX_ "Real UID cannot exec script\n");
-
-	/* PSz 27 Feb 04
-	 * We used to do this check as the "plain" user (after swapping
-	 * UIDs). But the check for nosuid and noexec filesystem is needed,
-	 * and should be done even without HAS_SETREUID. (Maybe those
-	 * operating systems do not have such mount options anyway...)
-	 * Seems safe enough to do as root.
-	 */
-#    if !defined(NO_NOSUID_CHECK)
-	if (fd_on_nosuid_fs(PerlIO_fileno(rsfp))) {
-	    Perl_croak(aTHX_ "Setuid script on nosuid or noexec filesystem\n");
-	}
-#    endif
-#  endif /* IAMSUID */
-
-	if (!S_ISREG(PL_statbuf.st_mode)) {
-	    Perl_croak(aTHX_ "Setuid script not plain file\n");
-	}
-	if (PL_statbuf.st_mode & S_IWOTH)
-	    Perl_croak(aTHX_ "Setuid/gid script is writable by world");
-	PL_doswitches = FALSE;		/* -s is insecure in suid */
-	/* PSz 13 Nov 03  But -s was caught elsewhere ... so unsetting it here is useless(?!) */
-	CopLINE_inc(PL_curcop);
-	if (sv_gets(linestr_sv, rsfp, 0) == NULL)
-	    Perl_croak(aTHX_ "No #! line");
-	linestr = SvPV_nolen_const(linestr_sv);
-	/* required even on Sys V */
-	if (!*linestr || !linestr[1] || strnNE(linestr,"#!",2))
-	    Perl_croak(aTHX_ "No #! line");
-	linestr += 2;
-	s = linestr;
-	/* PSz 27 Feb 04 */
-	/* Sanity check on line length */
-	s_end = s + strlen(s);
-	if (s_end == s || (s_end - s) > 4000)
-	    Perl_croak(aTHX_ "Very long #! line");
-	/* Allow more than a single space after #! */
-	while (isSPACE(*s)) s++;
-	/* Sanity check on buffer end */
-	while ((*s) && !isSPACE(*s)) s++;
-	for (s2 = s;  (s2 > linestr &&
-		       (isDIGIT(s2[-1]) || s2[-1] == '.' || s2[-1] == '_'
-			|| s2[-1] == '-'));  s2--) ;
-	/* Sanity check on buffer start */
-	if ( (s2-4 < linestr || strnNE(s2-4,"perl",4)) &&
-	      (s-9 < linestr || strnNE(s-9,"perl",4)) )
-	    Perl_croak(aTHX_ "Not a perl script");
-	while (*s == ' ' || *s == '\t') s++;
-	/*
-	 * #! arg must be what we saw above.  They can invoke it by
-	 * mentioning suidperl explicitly, but they may not add any strange
-	 * arguments beyond what #! says if they do invoke suidperl that way.
-	 */
-	/*
-	 * The way validarg was set up, we rely on the kernel to start
-	 * scripts with argv[1] set to contain all #! line switches (the
-	 * whole line).
-	 */
-	/*
-	 * Check that we got all the arguments listed in the #! line (not
-	 * just that there are no extraneous arguments). Might not matter
-	 * much, as switches from #! line seem to be acted upon (also), and
-	 * so may be checked and trapped in perl. But, security checks must
-	 * be done in suidperl and not deferred to perl. Note that suidperl
-	 * does not get around to parsing (and checking) the switches on
-	 * the #! line (but execs perl sooner).
-	 * Allow (require) a trailing newline (which may be of two
-	 * characters on some architectures?) (but no other trailing
-	 * whitespace).
-	 */
-	len = strlen(validarg);
-	if (strEQ(validarg," PHOOEY ") ||
-	    strnNE(s,validarg,len) || !isSPACE(s[len]) ||
-	    !((s_end - s) == len+1
-	      || ((s_end - s) == len+2 && isSPACE(s[len+1]))))
-	    Perl_croak(aTHX_ "Args must match #! line");
-
-#  ifndef IAMSUID
-	if (fdscript < 0 &&
-	    PL_euid != PL_uid && (PL_statbuf.st_mode & S_ISUID) &&
-	    PL_euid == PL_statbuf.st_uid)
-	    if (!PL_do_undump)
-		Perl_croak(aTHX_ "YOU HAVEN'T DISABLED SET-ID SCRIPTS IN THE KERNEL YET!\n\
-FIX YOUR KERNEL, OR PUT A C WRAPPER AROUND THIS SCRIPT!\n");
-#  endif /* IAMSUID */
-
-	if (fdscript < 0 &&
-	    PL_euid) {	/* oops, we're not the setuid root perl */
-	    /* PSz 18 Feb 04
-	     * When root runs a setuid script, we do not go through the same
-	     * steps of execing sperl and then perl with fd scripts, but
-	     * simply set up UIDs within the same perl invocation; so do
-	     * not have the same checks (on options, whatever) that we have
-	     * for plain users. No problem really: would have to be a script
-	     * that does not actually work for plain users; and if root is
-	     * foolish and can be persuaded to run such an unsafe script, he
-	     * might run also non-setuid ones, and deserves what he gets.
-	     * 
-	     * Or, we might drop the PL_euid check above (and rely just on
-	     * fdscript to avoid loops), and do the execs
-	     * even for root.
-	     */
-#  ifndef IAMSUID
-	    int which;
-	    /* PSz 11 Nov 03
-	     * Pass fd script to suidperl.
-	     * Exec suidperl, substituting fd script for scriptname.
-	     * Pass script name as "subdir" of fd, which perl will grok;
-	     * in fact will use that to distinguish this from "normal"
-	     * usage, see comments above.
-	     */
-	    PerlIO_rewind(rsfp);
-	    PerlLIO_lseek(PerlIO_fileno(rsfp),(Off_t)0,0);  /* just in case rewind didn't */
-	    /* PSz 27 Feb 04  Sanity checks on scriptname */
-	    if ((!scriptname) || (!*scriptname) ) {
-		Perl_croak(aTHX_ "No setuid script name\n");
-	    }
-	    if (*scriptname == '-') {
-		Perl_croak(aTHX_ "Setuid script name may not begin with dash\n");
-		/* Or we might confuse it with an option when replacing
-		 * name in argument list, below (though we do pointer, not
-		 * string, comparisons).
-		 */
-	    }
-	    for (which = 1; PL_origargv[which] && PL_origargv[which] != scriptname; which++) ;
-	    if (!PL_origargv[which]) {
-		Perl_croak(aTHX_ "Can't change argv to have fd script\n");
-	    }
-	    PL_origargv[which] = savepv(Perl_form(aTHX_ "/dev/fd/%d/%s",
-					  PerlIO_fileno(rsfp), PL_origargv[which]));
-#    if defined(HAS_FCNTL) && defined(F_SETFD)
-	    fcntl(PerlIO_fileno(rsfp),F_SETFD,0);	/* ensure no close-on-exec */
-#    endif
-	    PERL_FPU_PRE_EXEC
-	    PerlProc_execv(BIN_EXP "/sperl" PERL_FS_VERSION, PL_origargv);
-	    PERL_FPU_POST_EXEC
-#  endif /* IAMSUID */
-	    Perl_croak(aTHX_ "Can't do setuid (cannot exec sperl)\n");
-	}
-
-	if (PL_statbuf.st_mode & S_ISGID && PL_statbuf.st_gid != PL_egid) {
-/* PSz 26 Feb 04
- * This seems back to front: we try HAS_SETEGID first; if not available
- * then try HAS_SETREGID; as a last chance we try HAS_SETRESGID. May be OK
- * in the sense that we only want to set EGID; but are there any machines
- * with either of the latter, but not the former? Same with UID, later.
- */
-#  ifdef HAS_SETEGID
-	    (void)setegid(PL_statbuf.st_gid);
-#  else
-#    ifdef HAS_SETREGID
-           (void)setregid((Gid_t)-1,PL_statbuf.st_gid);
-#    else
-#      ifdef HAS_SETRESGID
-           (void)setresgid((Gid_t)-1,PL_statbuf.st_gid,(Gid_t)-1);
-#      else
-	    PerlProc_setgid(PL_statbuf.st_gid);
-#      endif
-#    endif
-#  endif
-	    if (PerlProc_getegid() != PL_statbuf.st_gid)
-		Perl_croak(aTHX_ "Can't do setegid!\n");
-	}
-	if (PL_statbuf.st_mode & S_ISUID) {
-	    if (PL_statbuf.st_uid != PL_euid)
-#  ifdef HAS_SETEUID
-		(void)seteuid(PL_statbuf.st_uid);	/* all that for this */
-#  else
-#    ifdef HAS_SETREUID
-                (void)setreuid((Uid_t)-1,PL_statbuf.st_uid);
-#    else
-#      ifdef HAS_SETRESUID
-                (void)setresuid((Uid_t)-1,PL_statbuf.st_uid,(Uid_t)-1);
-#      else
-		PerlProc_setuid(PL_statbuf.st_uid);
-#      endif
-#    endif
-#  endif
-	    if (PerlProc_geteuid() != PL_statbuf.st_uid)
-		Perl_croak(aTHX_ "Can't do seteuid!\n");
-	}
-	else if (PL_uid) {			/* oops, mustn't run as root */
-#  ifdef HAS_SETEUID
-          (void)seteuid((Uid_t)PL_uid);
-#  else
-#    ifdef HAS_SETREUID
-          (void)setreuid((Uid_t)-1,(Uid_t)PL_uid);
-#    else
-#      ifdef HAS_SETRESUID
-          (void)setresuid((Uid_t)-1,(Uid_t)PL_uid,(Uid_t)-1);
-#      else
-          PerlProc_setuid((Uid_t)PL_uid);
-#      endif
-#    endif
-#  endif
-	    if (PerlProc_geteuid() != PL_uid)
-		Perl_croak(aTHX_ "Can't do seteuid!\n");
-	}
-	init_ids();
-	if (!cando(S_IXUSR,TRUE,&PL_statbuf))
-	    Perl_croak(aTHX_ "Effective UID cannot exec script\n");	/* they can't do this */
-    }
-#  ifdef IAMSUID
-    else if (PL_preprocess)	/* PSz 13 Nov 03  Caught elsewhere, useless(?!) here */
-	Perl_croak(aTHX_ "-P not allowed for setuid/setgid script\n");
-    else if (fdscript < 0 || !suidscript)
-	/* PSz 13 Nov 03  Caught elsewhere, useless(?!) here */
-	Perl_croak(aTHX_ "(suid) fdscript needed in suidperl\n");
-    else {
-/* PSz 16 Sep 03  Keep neat error message */
-	Perl_croak(aTHX_ "Script is not setuid/setgid in suidperl\n");
-    }
-
-    /* We absolutely must clear out any saved ids here, so we */
-    /* exec the real perl, substituting fd script for scriptname. */
-    /* (We pass script name as "subdir" of fd, which perl will grok.) */
-    /* 
-     * It might be thought that using setresgid and/or setresuid (changed to
-     * set the saved IDs) above might obviate the need to exec, and we could
-     * go on to "do the perl thing".
-     * 
-     * Is there such a thing as "saved GID", and is that set for setuid (but
-     * not setgid) execution like suidperl? Without exec, it would not be
-     * cleared for setuid (but not setgid) scripts (or might need a dummy
-     * setresgid).
-     * 
-     * We need suidperl to do the exact same argument checking that perl
-     * does. Thus it cannot be very small; while it could be significantly
-     * smaller, it is safer (simpler?) to make it essentially the same
-     * binary as perl (but they are not identical). - Maybe could defer that
-     * check to the invoked perl, and suidperl be a tiny wrapper instead;
-     * but prefer to do thorough checks in suidperl itself. Such deferral
-     * would make suidperl security rely on perl, a design no-no.
-     * 
-     * Setuid things should be short and simple, thus easy to understand and
-     * verify. They should do their "own thing", without influence by
-     * attackers. It may help if their internal execution flow is fixed,
-     * regardless of platform: it may be best to exec anyway.
-     * 
-     * Suidperl should at least be conceptually simple: a wrapper only,
-     * never to do any real perl. Maybe we should put
-     * #ifdef IAMSUID
-     *         Perl_croak(aTHX_ "Suidperl should never do real perl\n");
-     * #endif
-     * into the perly bits.
-     */
-    PerlIO_rewind(rsfp);
-    PerlLIO_lseek(PerlIO_fileno(rsfp),(Off_t)0,0);  /* just in case rewind didn't */
-    /* PSz 11 Nov 03
-     * Keep original arguments: suidperl already has fd script.
-     */
-#  if defined(HAS_FCNTL) && defined(F_SETFD)
-    fcntl(PerlIO_fileno(rsfp),F_SETFD,0);	/* ensure no close-on-exec */
-#  endif
-    PERL_FPU_PRE_EXEC
-    PerlProc_execv(BIN_EXP "/perl" PERL_FS_VERSION, PL_origargv);/* try again */
-    PERL_FPU_POST_EXEC
-    Perl_croak(aTHX_ "Can't do setuid (suidperl cannot exec perl)\n");
-#  endif /* IAMSUID */
-}
-
-#else /* !DOSUID */
-
-#  ifdef SETUID_SCRIPTS_ARE_SECURE_NOW
+#ifdef SETUID_SCRIPTS_ARE_SECURE_NOW
 /* Don't even need this function.  */
-#  else
+#else
 STATIC void
 S_validate_suid(pTHX_ PerlIO *rsfp)
 {
@@ -4393,8 +3642,7 @@
 	/* not set-id, must be wrapped */
     }
 }
-#  endif /* SETUID_SCRIPTS_ARE_SECURE_NOW */
-#endif /* DOSUID */
+#endif /* SETUID_SCRIPTS_ARE_SECURE_NOW */
 
 STATIC void
 S_find_beginning(pTHX_ SV* linestr_sv, PerlIO *rsfp)
@@ -4402,38 +3650,14 @@
     dVAR;
     const char *s;
     register const char *s2;
-#ifdef MACOS_TRADITIONAL
-    int maclines = 0;
-#endif
 
     PERL_ARGS_ASSERT_FIND_BEGINNING;
 
     /* skip forward in input to the real script? */
 
-#ifdef MACOS_TRADITIONAL
-    /* Since the Mac OS does not honor #! arguments for us, we do it ourselves */
-
-    while (PL_doextract || gMacPerl_AlwaysExtract) {
-	if ((s = sv_gets(linestr_sv, rsfp, 0)) == NULL) {
-	    if (!gMacPerl_AlwaysExtract)
-		Perl_croak(aTHX_ "No Perl script found in input\n");
-
-	    if (PL_doextract)			/* require explicit override ? */
-		if (!OverrideExtract(PL_origfilename))
-		    Perl_croak(aTHX_ "User aborted script\n");
-		else
-		    PL_doextract = FALSE;
-
-	    /* Pater peccavi, file does not have #! */
-	    PerlIO_rewind(rsfp);
-
-	    break;
-	}
-#else
     while (PL_doextract) {
 	if ((s = sv_gets(linestr_sv, rsfp, 0)) == NULL)
 	    Perl_croak(aTHX_ "No Perl script found in input\n");
-#endif
 	s2 = s;
 	if (*s == '#' && s[1] == '!' && ((s = instr(s,"perl")) || (s = instr(s2,"PERL")))) {
 	    PerlIO_ungetc(rsfp, '\n');		/* to keep line count right */
@@ -4448,20 +3672,6 @@
 		    while ((s = moreswitches(s)))
 			;
 	    }
-#ifdef MACOS_TRADITIONAL
-	    /* We are always searching for the #!perl line in MacPerl,
-	     * so if we find it, still keep the line count correct
-	     * by counting lines we already skipped over
-	     */
-	    for (; maclines > 0 ; maclines--)
-		PerlIO_ungetc(rsfp, '\n');
-
-	    break;
-
-	/* gMacPerl_AlwaysExtract is false in MPW tool */
-	} else if (gMacPerl_AlwaysExtract) {
-	    ++maclines;
-#endif
 	}
     }
 }
@@ -4552,34 +3762,24 @@
     if (PL_egid != PL_gid)
         Perl_croak(aTHX_ "No %s allowed while running setgid", message);
 #endif /* SETUID_SCRIPTS_ARE_SECURE_NOW */
-    /* PSz 29 Feb 04
-     * Checks for UID/GID above "wrong": why disallow
-     *   perl -e 'print "Hello\n"'
-     * from within setuid things?? Simply drop them: replaced by
-     * fdscript/suidscript and #ifdef IAMSUID checks below.
-     * 
-     * This may be too late for command-line switches. Will catch those on
-     * the #! line, after finding the script name and setting up
-     * fdscript/suidscript. Note that suidperl does not get around to
-     * parsing (and checking) the switches on the #! line, but checks that
-     * the two sets are identical.
-     * 
-     * With SETUID_SCRIPTS_ARE_SECURE_NOW, could we use fdscript, also or
-     * instead, or would that be "too late"? (We never have suidscript, can
-     * we be sure to have fdscript?)
-     * 
-     * Catch things with suidscript (in descendant of suidperl), even with
-     * right UID/GID. Was already checked in suidperl, with #ifdef IAMSUID,
-     * below; but I am paranoid.
-     * 
-     * Also see comments about root running a setuid script, elsewhere.
-     */
     if (suidscript)
         Perl_croak(aTHX_ "No %s allowed with (suid) fdscript", message);
-#ifdef IAMSUID
-    /* PSz 11 Nov 03  Catch it in suidperl, always! */
-    Perl_croak(aTHX_ "No %s allowed in suidperl", message);
-#endif /* IAMSUID */
+}
+
+void
+Perl_init_dbargs(pTHX)
+{
+    AV *const args = PL_dbargs = GvAV(gv_AVadd((gv_fetchpvs("DB::args",
+							    GV_ADDMULTI,
+							    SVt_PVAV))));
+
+    if (AvREAL(args)) {
+	/* Someone has already created it.
+	   It might have entries, and if we just turn off AvREAL(), they will
+	   "leak" until global destruction.  */
+	av_clear(args);
+    }
+    AvREAL_off(PL_dbargs);	/* XXX should be REIFY (see av.h) */
 }
 
 void
@@ -4589,9 +3789,8 @@
     HV * const ostash = PL_curstash;
 
     PL_curstash = PL_debstash;
-    PL_dbargs = GvAV(gv_AVadd((gv_fetchpvs("DB::args", GV_ADDMULTI,
-					   SVt_PVAV))));
-    AvREAL_off(PL_dbargs);
+
+    Perl_init_dbargs(aTHX);
     PL_DBgv = gv_fetchpvs("DB::DB", GV_ADDMULTI, SVt_PVGV);
     PL_DBline = gv_fetchpvs("DB::dbline", GV_ADDMULTI, SVt_PVAV);
     PL_DBsub = gv_HVadd(gv_fetchpvs("DB::sub", GV_ADDMULTI, SVt_PVHV));
@@ -4637,6 +3836,9 @@
     SET_MARK_OFFSET;
 
     Newx(PL_scopestack,REASONABLE(32),I32);
+#ifdef DEBUGGING
+    Newx(PL_scopestack_name,REASONABLE(32),const char*);
+#endif
     PL_scopestack_ix = 0;
     PL_scopestack_max = REASONABLE(32);
 
@@ -4663,6 +3865,9 @@
     Safefree(PL_tmps_stack);
     Safefree(PL_markstack);
     Safefree(PL_scopestack);
+#ifdef DEBUGGING
+    Safefree(PL_scopestack_name);
+#endif
     Safefree(PL_savestack);
 }
 
@@ -4673,8 +3878,34 @@
     dVAR;
     GV *tmpgv;
     IO *io;
+    AV *isa;
 
     sv_setpvs(get_sv("\"", GV_ADD), " ");
+    PL_ofsgv = (GV*)SvREFCNT_inc(gv_fetchpvs(",", GV_ADD|GV_NOTQUAL, SVt_PV));
+
+
+    /* Historically, PVIOs were blessed into IO::Handle, unless
+       FileHandle was loaded, in which case they were blessed into
+       that. Action at a distance.
+       However, if we simply bless into IO::Handle, we break code
+       that assumes that PVIOs will have (among others) a seek
+       method. IO::File inherits from IO::Handle and IO::Seekable,
+       and provides the needed methods. But if we simply bless into
+       it, then we break code that assumed that by loading
+       IO::Handle, *it* would work.
+       So a compromise is to set up the correct @IO::File::ISA,
+       so that code that does C<use IO::Handle>; will still work.
+    */
+		   
+    isa = get_av("IO::File::ISA", GV_ADD | GV_ADDMULTI);
+    av_push(isa, newSVpvs("IO::Handle"));
+    av_push(isa, newSVpvs("IO::Seekable"));
+    av_push(isa, newSVpvs("Exporter"));
+    (void) gv_fetchpvs("IO::Handle::", GV_ADD, SVt_PVGV);
+    (void) gv_fetchpvs("IO::Seekable::", GV_ADD, SVt_PVGV);
+    (void) gv_fetchpvs("Exporter::", GV_ADD, SVt_PVGV);
+
+
     PL_stdingv = gv_fetchpvs("STDIN", GV_ADD|GV_NOTQUAL, SVt_PVIO);
     GvMULTI_on(PL_stdingv);
     io = GvIOp(PL_stdingv);
@@ -4704,9 +3935,6 @@
     GvIOp(tmpgv) = MUTABLE_IO(SvREFCNT_inc_simple(io));
 
     PL_statname = newSV(0);		/* last filename we did stat on */
-
-    Safefree(PL_osname);
-    PL_osname = savepv(OSNAME);
 }
 
 void
@@ -4771,13 +3999,7 @@
     init_argv_symbols(argc,argv);
 
     if ((tmpgv = gv_fetchpvs("0", GV_ADD|GV_NOTQUAL, SVt_PV))) {
-#ifdef MACOS_TRADITIONAL
-	/* $0 is not majick on a Mac */
-	sv_setpv(GvSV(tmpgv),MacPerl_MPWFileName(PL_origfilename));
-#else
 	sv_setpv(GvSV(tmpgv),PL_origfilename);
-	magicname("0", "0", 1);
-#endif
     }
     if ((PL_envgv = gv_fetchpvs("ENV", GV_ADD|GV_NOTQUAL, SVt_PVHV))) {
 	HV *hv;
@@ -4846,23 +4068,33 @@
 S_init_perllib(pTHX)
 {
     dVAR;
-    char *s;
+#ifndef VMS
+    const char *perl5lib = NULL;
+#endif
+    const char *s;
+#if defined(WIN32) && !defined(PERL_IS_MINIPERL)
+    STRLEN len;
+#endif
+
     if (!PL_tainting) {
 #ifndef VMS
-	s = PerlEnv_getenv("PERL5LIB");
+	perl5lib = PerlEnv_getenv("PERL5LIB");
 /*
  * It isn't possible to delete an environment variable with
  * PERL_USE_SAFE_PUTENV set unless unsetenv() is also available, so in that
  * case we treat PERL5LIB as undefined if it has a zero-length value.
  */
 #if defined(PERL_USE_SAFE_PUTENV) && ! defined(HAS_UNSETENV)
-	if (s && *s != '\0')
+	if (perl5lib && *perl5lib != '\0')
 #else
-	if (s)
+	if (perl5lib)
 #endif
-	    incpush(s, TRUE, TRUE, TRUE, FALSE);
-	else
-	    incpush(PerlEnv_getenv("PERLLIB"), FALSE, FALSE, TRUE, FALSE);
+	    incpush_use_sep(perl5lib, 0, INCPUSH_ADD_SUB_DIRS);
+	else {
+	    s = PerlEnv_getenv("PERLLIB");
+	    if (s)
+		incpush_use_sep(s, 0, 0);
+	}
 #else /* VMS */
 	/* Treat PERL5?LIB as a possible search list logical name -- the
 	 * "natural" VMS idiom for a Unix path string.  We allow each
@@ -4871,101 +4103,154 @@
 	char buf[256];
 	int idx = 0;
 	if (my_trnlnm("PERL5LIB",buf,0))
-	    do { incpush(buf,TRUE,TRUE,TRUE,FALSE); } while (my_trnlnm("PERL5LIB",buf,++idx));
-	else
-	    while (my_trnlnm("PERLLIB",buf,idx++)) incpush(buf,FALSE,FALSE,TRUE,FALSE);
+	    do {
+		incpush_use_sep(buf, 0, INCPUSH_ADD_SUB_DIRS);
+	    } while (my_trnlnm("PERL5LIB",buf,++idx));
+	else {
+	    while (my_trnlnm("PERLLIB",buf,idx++))
+		incpush_use_sep(buf, 0, 0);
+	}
 #endif /* VMS */
     }
 
+#ifndef PERL_IS_MINIPERL
+    /* miniperl gets just -I..., the split of $ENV{PERL5LIB}, and "." in @INC
+       (and not the architecture specific directories from $ENV{PERL5LIB}) */
+
 /* Use the ~-expanded versions of APPLLIB (undocumented),
-    ARCHLIB PRIVLIB SITEARCH SITELIB VENDORARCH and VENDORLIB
+    SITEARCH, SITELIB, VENDORARCH, VENDORLIB, ARCHLIB and PRIVLIB
 */
 #ifdef APPLLIB_EXP
-    incpush(APPLLIB_EXP, TRUE, TRUE, TRUE, TRUE);
-#endif
-
-#ifdef ARCHLIB_EXP
-    incpush(ARCHLIB_EXP, FALSE, FALSE, TRUE, TRUE);
-#endif
-#ifdef MACOS_TRADITIONAL
-    {
-	Stat_t tmpstatbuf;
-    	SV * privdir = newSV(0);
-	char * macperl = PerlEnv_getenv("MACPERL");
-	
-	if (!macperl)
-	    macperl = "";
-	
-	Perl_sv_setpvf(aTHX_ privdir, "%slib:", macperl);
-	if (PerlLIO_stat(SvPVX(privdir), &tmpstatbuf) >= 0 && S_ISDIR(tmpstatbuf.st_mode))
-	    incpush(SvPVX(privdir), TRUE, FALSE, TRUE, FALSE);
-	Perl_sv_setpvf(aTHX_ privdir, "%ssite_perl:", macperl);
-	if (PerlLIO_stat(SvPVX(privdir), &tmpstatbuf) >= 0 && S_ISDIR(tmpstatbuf.st_mode))
-	    incpush(SvPVX(privdir), TRUE, FALSE, TRUE, FALSE);
-	
-   	SvREFCNT_dec(privdir);
-    }
-    if (!PL_tainting)
-	incpush(":", FALSE, FALSE, TRUE, FALSE);
-#else
-#ifndef PRIVLIB_EXP
-#  define PRIVLIB_EXP "/usr/local/lib/perl5:/usr/local/lib/perl"
-#endif
-#if defined(WIN32)
-    incpush(PRIVLIB_EXP, TRUE, FALSE, TRUE, TRUE);
-#else
-    incpush(PRIVLIB_EXP, FALSE, FALSE, TRUE, TRUE);
+    S_incpush_use_sep(aTHX_ STR_WITH_LEN(APPLLIB_EXP),
+		      INCPUSH_ADD_SUB_DIRS|INCPUSH_CAN_RELOCATE);
 #endif
 
 #ifdef SITEARCH_EXP
     /* sitearch is always relative to sitelib on Windows for
      * DLL-based path intuition to work correctly */
 #  if !defined(WIN32)
-    incpush(SITEARCH_EXP, FALSE, FALSE, TRUE, TRUE);
+	S_incpush_use_sep(aTHX_ STR_WITH_LEN(SITEARCH_EXP),
+			  INCPUSH_CAN_RELOCATE);
 #  endif
 #endif
 
 #ifdef SITELIB_EXP
 #  if defined(WIN32)
     /* this picks up sitearch as well */
-    incpush(SITELIB_EXP, TRUE, FALSE, TRUE, TRUE);
+	s = win32_get_sitelib(PERL_FS_VERSION, &len);
+	if (s)
+	    incpush_use_sep(s, len, INCPUSH_ADD_SUB_DIRS|INCPUSH_CAN_RELOCATE);
 #  else
-    incpush(SITELIB_EXP, FALSE, FALSE, TRUE, TRUE);
+	S_incpush_use_sep(aTHX_ STR_WITH_LEN(SITELIB_EXP), INCPUSH_CAN_RELOCATE);
 #  endif
 #endif
 
-#if defined(SITELIB_STEM) && defined(PERL_INC_VERSION_LIST)
-    /* Search for version-specific dirs below here */
-    incpush(SITELIB_STEM, FALSE, TRUE, TRUE, TRUE);
-#endif
-
 #ifdef PERL_VENDORARCH_EXP
     /* vendorarch is always relative to vendorlib on Windows for
      * DLL-based path intuition to work correctly */
 #  if !defined(WIN32)
-    incpush(PERL_VENDORARCH_EXP, FALSE, FALSE, TRUE, TRUE);
+    S_incpush_use_sep(aTHX_ STR_WITH_LEN(PERL_VENDORARCH_EXP),
+		      INCPUSH_CAN_RELOCATE);
 #  endif
 #endif
 
 #ifdef PERL_VENDORLIB_EXP
 #  if defined(WIN32)
-    incpush(PERL_VENDORLIB_EXP, TRUE, FALSE, TRUE, TRUE);	/* this picks up vendorarch as well */
+    /* this picks up vendorarch as well */
+	s = win32_get_vendorlib(PERL_FS_VERSION, &len);
+	if (s)
+	    incpush_use_sep(s, len, INCPUSH_ADD_SUB_DIRS|INCPUSH_CAN_RELOCATE);
 #  else
-    incpush(PERL_VENDORLIB_EXP, FALSE, FALSE, TRUE, TRUE);
+	S_incpush_use_sep(aTHX_ STR_WITH_LEN(PERL_VENDORLIB_EXP),
+			  INCPUSH_CAN_RELOCATE);
 #  endif
 #endif
 
-#ifdef PERL_VENDORLIB_STEM /* Search for version-specific dirs below here */
-    incpush(PERL_VENDORLIB_STEM, FALSE, TRUE, TRUE, TRUE);
+#ifdef ARCHLIB_EXP
+    S_incpush_use_sep(aTHX_ STR_WITH_LEN(ARCHLIB_EXP), INCPUSH_CAN_RELOCATE);
+#endif
+
+#ifndef PRIVLIB_EXP
+#  define PRIVLIB_EXP "/usr/local/lib/perl5:/usr/local/lib/perl"
+#endif
+
+#if defined(WIN32)
+    s = win32_get_privlib(PERL_FS_VERSION, &len);
+    if (s)
+	incpush_use_sep(s, len, INCPUSH_ADD_SUB_DIRS|INCPUSH_CAN_RELOCATE);
+#else
+#  ifdef NETWARE
+    S_incpush_use_sep(aTHX_ PRIVLIB_EXP, 0, INCPUSH_CAN_RELOCATE);
+#  else
+    S_incpush_use_sep(aTHX_ STR_WITH_LEN(PRIVLIB_EXP), INCPUSH_CAN_RELOCATE);
+#  endif
 #endif
 
 #ifdef PERL_OTHERLIBDIRS
-    incpush(PERL_OTHERLIBDIRS, TRUE, TRUE, TRUE, TRUE);
+    S_incpush_use_sep(aTHX_ STR_WITH_LEN(PERL_OTHERLIBDIRS),
+		      INCPUSH_ADD_VERSIONED_SUB_DIRS|INCPUSH_NOT_BASEDIR
+		      |INCPUSH_CAN_RELOCATE);
+#endif
+
+    if (!PL_tainting) {
+#ifndef VMS
+/*
+ * It isn't possible to delete an environment variable with
+ * PERL_USE_SAFE_PUTENV set unless unsetenv() is also available, so in that
+ * case we treat PERL5LIB as undefined if it has a zero-length value.
+ */
+#if defined(PERL_USE_SAFE_PUTENV) && ! defined(HAS_UNSETENV)
+	if (perl5lib && *perl5lib != '\0')
+#else
+	if (perl5lib)
 #endif
+	    incpush_use_sep(perl5lib, 0,
+			    INCPUSH_ADD_OLD_VERS|INCPUSH_NOT_BASEDIR);
+#else /* VMS */
+	/* Treat PERL5?LIB as a possible search list logical name -- the
+	 * "natural" VMS idiom for a Unix path string.  We allow each
+	 * element to be a set of |-separated directories for compatibility.
+	 */
+	char buf[256];
+	int idx = 0;
+	if (my_trnlnm("PERL5LIB",buf,0))
+	    do {
+		incpush_use_sep(buf, 0,
+				INCPUSH_ADD_OLD_VERS|INCPUSH_NOT_BASEDIR);
+	    } while (my_trnlnm("PERL5LIB",buf,++idx));
+#endif /* VMS */
+    }
+
+/* Use the ~-expanded versions of APPLLIB (undocumented),
+    SITELIB and VENDORLIB for older versions
+*/
+#ifdef APPLLIB_EXP
+    S_incpush_use_sep(aTHX_ STR_WITH_LEN(APPLLIB_EXP), INCPUSH_ADD_OLD_VERS
+		      |INCPUSH_NOT_BASEDIR|INCPUSH_CAN_RELOCATE);
+#endif
+
+#if defined(SITELIB_STEM) && defined(PERL_INC_VERSION_LIST)
+    /* Search for version-specific dirs below here */
+    S_incpush_use_sep(aTHX_ STR_WITH_LEN(SITELIB_STEM),
+		      INCPUSH_ADD_OLD_VERS|INCPUSH_CAN_RELOCATE);
+#endif
+
+
+#if defined(PERL_VENDORLIB_STEM) && defined(PERL_INC_VERSION_LIST)
+    /* Search for version-specific dirs below here */
+    S_incpush_use_sep(aTHX_ STR_WITH_LEN(PERL_VENDORLIB_STEM),
+		      INCPUSH_ADD_OLD_VERS|INCPUSH_CAN_RELOCATE);
+#endif
+
+#ifdef PERL_OTHERLIBDIRS
+    S_incpush_use_sep(aTHX_ STR_WITH_LEN(PERL_OTHERLIBDIRS),
+		      INCPUSH_ADD_OLD_VERS|INCPUSH_ADD_ARCHONLY_SUB_DIRS
+		      |INCPUSH_CAN_RELOCATE);
+#endif
+#endif /* !PERL_IS_MINIPERL */
 
     if (!PL_tainting)
-	incpush(".", FALSE, FALSE, TRUE, FALSE);
-#endif /* MACOS_TRADITIONAL */
+	S_incpush(aTHX_ STR_WITH_LEN("."), 0);
 }
 
 #if defined(DOSISH) || defined(EPOC) || defined(__SYMBIAN32__)
@@ -4974,11 +4259,7 @@
 #  if defined(VMS)
 #    define PERLLIB_SEP '|'
 #  else
-#    if defined(MACOS_TRADITIONAL)
-#      define PERLLIB_SEP ','
-#    else
-#      define PERLLIB_SEP ':'
-#    endif
+#    define PERLLIB_SEP ':'
 #  endif
 #endif
 #ifndef PERLLIB_MANGLE
@@ -4989,7 +4270,7 @@
    Generate a new SV if we do this, to save needing to copy the SV we push
    onto @INC  */
 STATIC SV *
-S_incpush_if_exists(pTHX_ SV *dir)
+S_incpush_if_exists(pTHX_ AV *const av, SV *dir, SV *const stem)
 {
     dVAR;
     Stat_t tmpstatbuf;
@@ -4998,59 +4279,60 @@
 
     if (PerlLIO_stat(SvPVX_const(dir), &tmpstatbuf) >= 0 &&
 	S_ISDIR(tmpstatbuf.st_mode)) {
-	av_push(GvAVn(PL_incgv), dir);
-	dir = newSV(0);
+	av_push(av, dir);
+	dir = newSVsv(stem);
+    } else {
+	/* Truncate dir back to stem.  */
+	SvCUR_set(dir, SvCUR(stem));
     }
     return dir;
 }
 
 STATIC void
-S_incpush(pTHX_ const char *dir, bool addsubdirs, bool addoldvers, bool usesep,
-	  bool canrelocate)
+S_incpush(pTHX_ const char *const dir, STRLEN len, U32 flags)
 {
     dVAR;
-    SV *subdir = NULL;
-    const char *p = dir;
-
-    if (!p || !*p)
-	return;
-
-    if (addsubdirs || addoldvers) {
-	subdir = newSV(0);
-    }
-
-    /* Break at all separators */
-    while (p && *p) {
-	SV *libdir = newSV(0);
-        const char *s;
-
-	/* skip any consecutive separators */
-	if (usesep) {
-	    while ( *p == PERLLIB_SEP ) {
-		/* Uncomment the next line for PATH semantics */
-		/* av_push(GvAVn(PL_incgv), newSVpvs(".")); */
-		p++;
-	    }
-	}
+    const U8 using_sub_dirs
+	= (U8)flags & (INCPUSH_ADD_VERSIONED_SUB_DIRS
+		       |INCPUSH_ADD_ARCHONLY_SUB_DIRS|INCPUSH_ADD_OLD_VERS);
+    const U8 add_versioned_sub_dirs
+	= (U8)flags & INCPUSH_ADD_VERSIONED_SUB_DIRS;
+    const U8 add_archonly_sub_dirs
+	= (U8)flags & INCPUSH_ADD_ARCHONLY_SUB_DIRS;
+#ifdef PERL_INC_VERSION_LIST
+    const U8 addoldvers  = (U8)flags & INCPUSH_ADD_OLD_VERS;
+#endif
+    const U8 canrelocate = (U8)flags & INCPUSH_CAN_RELOCATE;
+    const U8 unshift     = (U8)flags & INCPUSH_UNSHIFT;
+    const U8 push_basedir = (flags & INCPUSH_NOT_BASEDIR) ? 0 : 1;
+    AV *const inc = GvAVn(PL_incgv);
 
-	if ( usesep && (s = strchr(p, PERLLIB_SEP)) != NULL ) {
-	    sv_setpvn(libdir, PERLLIB_MANGLE(p, (STRLEN)(s - p)),
-		      (STRLEN)(s - p));
-	    p = s + 1;
-	}
-	else {
-	    sv_setpv(libdir, PERLLIB_MANGLE(p, 0));
-	    p = NULL;	/* break out */
-	}
-#ifdef MACOS_TRADITIONAL
-	if (!strchr(SvPVX(libdir), ':')) {
-	    char buf[256];
+    PERL_ARGS_ASSERT_INCPUSH;
+    assert(len > 0);
 
-	    sv_setpv(libdir, MacPerl_CanonDir(SvPVX(libdir), buf, 0));
+    /* Could remove this vestigial extra block, if we don't mind a lot of
+       re-indenting diff noise.  */
+    {
+	SV *libdir;
+	/* Change 20189146be79a0596543441fa369c6bf7f85103f, to fix RT#6665,
+	   arranged to unshift #! line -I onto the front of @INC. However,
+	   -I can add version and architecture specific libraries, and they
+	   need to go first. The old code assumed that it was always
+	   pushing. Hence to make it work, need to push the architecture
+	   (etc) libraries onto a temporary array, then "unshift" that onto
+	   the front of @INC.  */
+	AV *const av = (using_sub_dirs) ? (unshift ? newAV() : inc) : NULL;
+
+	if (len) {
+	    /* I am not convinced that this is valid when PERLLIB_MANGLE is
+	       defined to so something (in os2/os2.c), but the code has been
+	       this way, ignoring any possible changed of length, since
+	       760ac839baf413929cd31cc32ffd6dba6b781a81 (5.003_02) so I'll leave
+	       it be.  */
+	    libdir = newSVpvn(PERLLIB_MANGLE(dir, len), len);
+	} else {
+	    libdir = newSVpv(PERLLIB_MANGLE(dir, 0), 0);
 	}
-	if (SvPVX(libdir)[SvCUR(libdir)-1] != ':')
-	    sv_catpvs(libdir, ":");
-#endif
 
 	/* Do the if() outside the #ifdef to avoid warnings about an unused
 	   parameter.  */
@@ -5155,7 +4437,8 @@
 	 * BEFORE pushing libdir onto @INC we may first push version- and
 	 * archname-specific sub-directories.
 	 */
-	if (addsubdirs || addoldvers) {
+	if (using_sub_dirs) {
+	    SV *subdir;
 #ifdef PERL_INC_VERSION_LIST
 	    /* Configure terminates PERL_INC_VERSION_LIST with a NULL */
 	    const char * const incverlist[] = { PERL_INC_VERSION_LIST };
@@ -5165,6 +4448,7 @@
 	    char *unix;
 	    STRLEN len;
 
+
 	    if ((unix = tounixspec_ts(SvPV(libdir,len),NULL)) != NULL) {
 		len = strlen(unix);
 		while (unix[len-1] == '/') len--;  /* Cosmetic */
@@ -5175,57 +4459,104 @@
 		              "Failed to unixify @INC element \"%s\"\n",
 			      SvPV(libdir,len));
 #endif
-	    if (addsubdirs) {
-#ifdef MACOS_TRADITIONAL
-#define PERL_ARCH_FMT_PREFIX	""
-#define PERL_ARCH_FMT_SUFFIX	":"
-#define PERL_ARCH_FMT_PATH	PERL_FS_VERSION ""
-#else
-#define PERL_ARCH_FMT_PREFIX	"/"
-#define PERL_ARCH_FMT_SUFFIX	""
-#define PERL_ARCH_FMT_PATH	"/" PERL_FS_VERSION
-#endif
-		/* .../version/archname if -d .../version/archname */
-		sv_setsv(subdir, libdir);
-		sv_catpvs(subdir, PERL_ARCH_FMT_PATH \
-			  PERL_ARCH_FMT_PREFIX ARCHNAME PERL_ARCH_FMT_SUFFIX);
-		subdir = S_incpush_if_exists(aTHX_ subdir);
 
-		/* .../version if -d .../version */
-		sv_setsv(subdir, libdir);
-		sv_catpvs(subdir, PERL_ARCH_FMT_PATH);
-		subdir = S_incpush_if_exists(aTHX_ subdir);
+	    subdir = newSVsv(libdir);
 
-		/* .../archname if -d .../archname */
-		sv_setsv(subdir, libdir);
-		sv_catpvs(subdir,
-			  PERL_ARCH_FMT_PREFIX ARCHNAME PERL_ARCH_FMT_SUFFIX);
-		subdir = S_incpush_if_exists(aTHX_ subdir);
+	    if (add_versioned_sub_dirs) {
+		/* .../version/archname if -d .../version/archname */
+		sv_catpvs(subdir, "/" PERL_FS_VERSION "/" ARCHNAME);
+		subdir = S_incpush_if_exists(aTHX_ av, subdir, libdir);
 
+		/* .../version if -d .../version */
+		sv_catpvs(subdir, "/" PERL_FS_VERSION);
+		subdir = S_incpush_if_exists(aTHX_ av, subdir, libdir);
 	    }
 
 #ifdef PERL_INC_VERSION_LIST
 	    if (addoldvers) {
 		for (incver = incverlist; *incver; incver++) {
 		    /* .../xxx if -d .../xxx */
-		    Perl_sv_setpvf(aTHX_ subdir, "%"SVf PERL_ARCH_FMT_PREFIX \
-				   "%s" PERL_ARCH_FMT_SUFFIX,
-				   SVfARG(libdir), *incver);
-		    subdir = S_incpush_if_exists(aTHX_ subdir);
+		    Perl_sv_catpvf(aTHX_ subdir, "/%s", *incver);
+		    subdir = S_incpush_if_exists(aTHX_ av, subdir, libdir);
 		}
 	    }
 #endif
+
+	    if (add_archonly_sub_dirs) {
+		/* .../archname if -d .../archname */
+		sv_catpvs(subdir, "/" ARCHNAME);
+		subdir = S_incpush_if_exists(aTHX_ av, subdir, libdir);
+
+	    }
+
+	    assert (SvREFCNT(subdir) == 1);
+	    SvREFCNT_dec(subdir);
 	}
 
-	/* finally push this lib directory on the end of @INC */
-	av_push(GvAVn(PL_incgv), libdir);
-    }
-    if (subdir) {
-	assert (SvREFCNT(subdir) == 1);
-	SvREFCNT_dec(subdir);
+	/* finally add this lib directory at the end of @INC */
+	if (unshift) {
+	    U32 extra = av_len(av) + 1;
+	    av_unshift(inc, extra + push_basedir);
+	    if (push_basedir)
+		av_store(inc, extra, libdir);
+	    while (extra--) {
+		/* av owns a reference, av_store() expects to be donated a
+		   reference, and av expects to be sane when it's cleared.
+		   If I wanted to be naughty and wrong, I could peek inside the
+		   implementation of av_clear(), realise that it uses
+		   SvREFCNT_dec() too, so av's array could be a run of NULLs,
+		   and so directly steal from it (with a memcpy() to inc, and
+		   then memset() to NULL them out. But people copy code from the
+		   core expecting it to be best practise, so let's use the API.
+		   Although studious readers will note that I'm not checking any
+		   return codes.  */
+		av_store(inc, extra, SvREFCNT_inc(*av_fetch(av, extra, FALSE)));
+	    }
+	    SvREFCNT_dec(av);
+	}
+	else if (push_basedir) {
+	    av_push(inc, libdir);
+	}
+
+	if (!push_basedir) {
+	    assert (SvREFCNT(libdir) == 1);
+	    SvREFCNT_dec(libdir);
+	}
     }
 }
 
+STATIC void
+S_incpush_use_sep(pTHX_ const char *p, STRLEN len, U32 flags)
+{
+    const char *s;
+    const char *end;
+    /* This logic has been broken out from S_incpush(). It may be possible to
+       simplify it.  */
+
+    PERL_ARGS_ASSERT_INCPUSH_USE_SEP;
+
+    if (!len)
+	len = strlen(p);
+
+    end = p + len;
+
+    /* Break at all separators */
+    while ((s = (const char*)memchr(p, PERLLIB_SEP, end - p))) {
+	if (s == p) {
+	    /* skip any consecutive separators */
+
+	    /* Uncomment the next line for PATH semantics */
+	    /* But you'll need to write tests */
+	    /* av_push(GvAVn(PL_incgv), newSVpvs(".")); */
+	} else {
+	    incpush(p, (STRLEN)(s - p), flags);
+	}
+	p = s + 1;
+    }
+    if (p != end)
+	incpush(p, (STRLEN)(end - p), flags);
+
+}
 
 void
 Perl_call_list(pTHX_ I32 oldscope, AV *paramList)
@@ -5303,16 +4634,6 @@
 	    PL_curcop = &PL_compiling;
 	    CopLINE_set(PL_curcop, oldline);
 	    JMPENV_POP;
-	    if (PL_statusvalue && !(PL_exit_flags & PERL_EXIT_EXPECTED)) {
-		if (paramList == PL_beginav)
-		    Perl_croak(aTHX_ "BEGIN failed--compilation aborted");
-		else
-		    Perl_croak(aTHX_ "%s failed--call queue aborted",
-			       paramList == PL_checkav ? "CHECK"
-			       : paramList == PL_initav ? "INIT"
-			       : paramList == PL_unitcheckav ? "UNITCHECK"
-			       : "END");
-	    }
 	    my_exit_jump();
 	    /* NOTREACHED */
 	case 3:
@@ -5333,8 +4654,6 @@
 Perl_my_exit(pTHX_ U32 status)
 {
     dVAR;
-    DEBUG_S(PerlIO_printf(Perl_debug_log, "my_exit: thread %p, status %lu\n",
-			  (void*)thr, (unsigned long) status));
     switch (status) {
     case 0:
 	STATUS_ALL_SUCCESS;
Index: src/gnu/usr.bin/perl/perl.h
diff -u src/gnu/usr.bin/perl/perl.h:1.15 src/gnu/usr.bin/perl/perl.h:1.16
--- perl.h:1.15	Mon Oct 12 18:24:21 2009
+++ perl.h	Fri Sep 24 15:06:41 2010
@@ -28,7 +28,7 @@
 
 #ifdef VOIDUSED
 #   undef VOIDUSED
-#endif 
+#endif
 #define VOIDUSED 1
 
 #ifdef PERL_MICRO
@@ -41,24 +41,6 @@
 #   endif
 #endif
 
-/* This logic needs to come after reading config.h, but before including
-   proto.h  */
-#ifdef IAMSUID
-#  ifndef DOSUID
-#    define DOSUID
-#  endif
-#endif
-
-#ifdef SETUID_SCRIPTS_ARE_SECURE_NOW
-#  ifdef DOSUID
-#    undef DOSUID
-#  endif
-#  ifdef IAMSUID
-#    undef IAMSUID
-#    define SETUID_SCRIPTS_ARE_SECURE_NOW_AND_IAMSUID
-#  endif
-#endif
-
 /* See L<perlguts/"The Perl API"> for detailed notes on
  * PERL_IMPLICIT_CONTEXT and PERL_IMPLICIT_SYS */
 
@@ -240,10 +222,6 @@
 #define CALLREG_INTUIT_STRING(prog) \
     CALL_FPTR(RX_ENGINE(prog)->checkstr)(aTHX_ (prog))
 
-#define CALLREG_AS_STR(mg,lp,flags,haseval) \
-        Perl_reg_stringify(aTHX_ (mg), (lp), (flags), (haseval))
-#define CALLREG_STRINGIFY(mg,lp,flags) CALLREG_AS_STR(mg,lp,flags,0)
-
 #define CALLREGFREE(prog) \
     Perl_pregfree(aTHX_ (prog))
 
@@ -292,13 +270,13 @@
 #define CALLREG_PACKAGE(rx) \
     CALL_FPTR(RX_ENGINE(rx)->qr_package)(aTHX_ (rx))
 
-#if defined(USE_ITHREADS)         
+#if defined(USE_ITHREADS)
 #define CALLREGDUPE(prog,param) \
     Perl_re_dup(aTHX_ (prog),(param))
 
 #define CALLREGDUPE_PVT(prog,param) \
     (prog ? CALL_FPTR(RX_ENGINE(prog)->dupe)(aTHX_ (prog),(param)) \
-          : (REGEXP *)NULL) 
+          : (REGEXP *)NULL)
 #endif
 
 
@@ -332,7 +310,7 @@
 #    define PERL_UNUSED_DECL
 #  endif
 #endif
- 
+
 /* gcc -Wall:
  * for silencing unused variables that are actually used most of the time,
  * but we cannot quite get rid of, such as "ax" in PPCODE+noargs xsubs
@@ -965,11 +943,11 @@
 #define PERL_USES_PL_PIDSTATUS
 #endif
 
-#if !defined(OS2) && !defined(WIN32) && !defined(DJGPP) && !defined(EPOC) && !defined(__SYMBIAN32__) && !defined(MACOS_TRADITIONAL)
+#if !defined(OS2) && !defined(WIN32) && !defined(DJGPP) && !defined(EPOC) && !defined(__SYMBIAN32__)
 #define PERL_DEFAULT_DO_EXEC3_IMPLEMENTATION
 #endif
 
-/* Cannot include embed.h here on Win32 as win32.h has not 
+/* Cannot include embed.h here on Win32 as win32.h has not
    yet been included and defines some config variables e.g. HAVE_INTERP_INTERN
  */
 #if !defined(PERL_FOR_X2P) && !(defined(WIN32)||defined(VMS))
@@ -1049,6 +1027,7 @@
 #  define MALLOC_CHECK_TAINT(argc,argv,env)
 #endif /* MYMALLOC */
 
+/* diag_listed_as: "-T" is on the #! line, it must also be used on the command line */
 #define TOO_LATE_FOR_(ch,what)	Perl_croak(aTHX_ "\"-%c\" is on the #! line, it must also be used on the command line%s", (char)(ch), what)
 #define TOO_LATE_FOR(ch)	TOO_LATE_FOR_(ch, "")
 #define MALLOC_TOO_LATE_FOR(ch)	TOO_LATE_FOR_(ch, " with $ENV{PERL_MALLOC_OPT}")
@@ -1165,6 +1144,13 @@
 #   include <sys/stat.h>
 #endif
 
+/* Microsoft VC's sys/stat.h defines all S_Ixxx macros except S_IFIFO.
+   This definition should ideally go into win32/win32.h, but S_IFIFO is
+   used later here in perl.h before win32/win32.h is being included. */
+#if !defined(S_IFIFO) && defined(_S_IFIFO)
+#   define S_IFIFO _S_IFIFO
+#endif
+
 /* The stat macros for Amdahl UTS, Unisoft System V/88 (and derivatives
    like UTekV) are broken, sometimes giving false positives.  Undefine
    them here and let the code below set them to proper values.
@@ -1212,7 +1198,7 @@
 #endif
 
 /* In Tru64 use the 4.4BSD struct msghdr, not the 4.3 one.
- * This is important for using IPv6. 
+ * This is important for using IPv6.
  * For OSF/1 3.2, however, defining _SOCKADDR_LEN would be
  * a bad idea since it breaks send() and recv(). */
 #if defined(__osf__) && defined(__alpha) && !defined(_SOCKADDR_LEN) && !defined(DEC_OSF1_3_X)
@@ -1324,7 +1310,25 @@
 #   define SS_NORMAL  		0
 #endif
 
-#define ERRSV GvSV(PL_errgv)
+#define ERRSV GvSVn(PL_errgv)
+
+#define CLEAR_ERRSV() STMT_START {					\
+    if (!GvSV(PL_errgv)) {						\
+	sv_setpvs(GvSV(gv_add_by_type(PL_errgv, SVt_PV)), "");		\
+    } else if (SvREADONLY(GvSV(PL_errgv))) {				\
+	SvREFCNT_dec(GvSV(PL_errgv));					\
+	GvSV(PL_errgv) = newSVpvs("");					\
+    } else {								\
+	SV *const errsv = GvSV(PL_errgv);				\
+	sv_setpvs(errsv, "");						\
+	if (SvMAGICAL(errsv)) {						\
+	    mg_free(errsv);						\
+	}								\
+	SvPOK_only(errsv);						\
+    }									\
+    } STMT_END
+
+
 #ifdef PERL_CORE
 # define DEFSV (0 + GvSVn(PL_defgv))
 #else
@@ -2394,7 +2398,8 @@
 typedef struct av AV;
 typedef struct hv HV;
 typedef struct cv CV;
-typedef struct regexp REGEXP;
+typedef struct regexp ORANGE;	/* This is the body structure.  */
+typedef struct p5rx REGEXP;
 typedef struct gp GP;
 typedef struct gv GV;
 typedef struct io IO;
@@ -2523,7 +2528,7 @@
 #   endif
 #endif
 
-#if defined(OS2) || defined(MACOS_TRADITIONAL)
+#if defined(OS2)
 #  include "iperlsys.h"
 #endif
 
@@ -2585,13 +2590,6 @@
 #   define ISHISH "symbian"
 #endif
 
-#if defined(MACOS_TRADITIONAL)
-#   include "macos/macish.h"
-#   ifndef NO_ENVIRON_ARRAY
-#       define NO_ENVIRON_ARRAY
-#   endif
-#   define ISHISH "macos classic"
-#endif
 
 #if defined(__HAIKU__)
 #   include "haiku/haikuish.h"
@@ -2800,7 +2798,7 @@
 #    define HASATTRIBUTE_WARN_UNUSED_RESULT
 #  endif
 #endif
-#endif /* #ifndef PERL_MICRO */ 
+#endif /* #ifndef PERL_MICRO */
 
 /* USE_5005THREADS needs to be after unixish.h as <pthread.h> includes
  * <sys/signal.h> which defines NSIG - which will stop inclusion of <signal.h>
@@ -2891,7 +2889,7 @@
 /* This is complicated.  The child processes return a true native VMS
    status which must be saved.  But there is an assumption in Perl that
    the UNIX child status has some relationship to errno values, so
-   Perl tries to translate it to text in some of the tests.  
+   Perl tries to translate it to text in some of the tests.
    In order to get the string translation correct, for the error, errno
    must be EVMSERR, but that generates a different text message
    than what the test programs are expecting.  So an errno value must
@@ -3151,16 +3149,16 @@
 #  define PERL_SET_THX(t)		PERL_SET_CONTEXT(t)
 #endif
 
-/* 
+/*
     This replaces the previous %_ "hack" by the "%p" hacks.
     All that is required is that the perl source does not
-    use "%-p" or "%-<number>p" or "%<number>p" formats.  
-    These formats will still work in perl code.   
+    use "%-p" or "%-<number>p" or "%<number>p" formats.
+    These formats will still work in perl code.
     See comments in sv.c for futher details.
 
     Robin Barker 2005-07-14
 
-    No longer use %1p for VDf = %vd.  RMB 2007-10-19 
+    No longer use %1p for VDf = %vd.  RMB 2007-10-19
 */
 
 #ifndef SVf_
@@ -3182,7 +3180,7 @@
 #define SVfARG(p) ((void*)(p))
 
 #ifdef PERL_CORE
-/* not used; but needed for backward compatibilty with XS code? - RMB */ 
+/* not used; but needed for backward compatibilty with XS code? - RMB */
 #  undef VDf
 #else
 #  ifndef VDf
@@ -3191,7 +3189,7 @@
 #endif
 
 #ifdef PERL_CORE
-/* not used; but needed for backward compatibilty with XS code? - RMB */ 
+/* not used; but needed for backward compatibilty with XS code? - RMB */
 #  undef UVf
 #else
 #  ifndef UVf
@@ -3199,6 +3197,14 @@
 #  endif
 #endif
 
+#if !defined(PERL_CORE) && !defined(PERL_NO_SHORT_NAMES)
+#  if defined(PERL_IMPLICIT_CONTEXT)
+#    define pmflag(a,b)		Perl_pmflag(aTHX_ a,b)
+#  else
+#    define pmflag			Perl_pmflag
+#  endif
+#endif
+
 #ifdef HASATTRIBUTE_DEPRECATED
 #  define __attribute__deprecated__         __attribute__((deprecated))
 #endif
@@ -3263,7 +3269,7 @@
 #ifdef PRINTF_FORMAT_NULL_OK
 #  define __attribute__format__null_ok__(x,y,z)  __attribute__format__(x,y,z)
 #else
-#  define __attribute__format__null_ok__(x,y,z)  
+#  define __attribute__format__null_ok__(x,y,z)
 #endif
 
 #ifdef HAS_BUILTIN_EXPECT
@@ -3361,12 +3367,12 @@
 #endif /* threading */
 #endif /* AIX */
 
-#if !defined(OS2) && !defined(MACOS_TRADITIONAL)
+#if !defined(OS2)
 #  include "iperlsys.h"
 #endif
 
 #ifdef __LIBCATAMOUNT__
-#undef HAS_PASSWD  /* unixish.h but not unixish enough. */ 
+#undef HAS_PASSWD  /* unixish.h but not unixish enough. */
 #undef HAS_GROUP
 #define FAKE_BIT_BUCKET
 #endif
@@ -3409,8 +3415,8 @@
 #  define PERL_BITFIELD32 unsigned
 #endif
 
-#include "regexp.h"
 #include "sv.h"
+#include "regexp.h"
 #include "util.h"
 #include "form.h"
 #include "gv.h"
@@ -3426,6 +3432,10 @@
 #include "warnings.h"
 #include "utf8.h"
 
+/* defined in sv.c, but also used in [ach]v.c */
+#undef _XPV_HEAD
+#undef _XPVMG_HEAD
+#undef _XPVCV_COMMON
 
 typedef struct _sublex_info SUBLEXINFO;
 struct _sublex_info {
@@ -3626,7 +3636,7 @@
 #define DEBUG_H_FLAG		0x00002000 /*   8192 */
 #define DEBUG_X_FLAG		0x00004000 /*  16384 */
 #define DEBUG_D_FLAG		0x00008000 /*  32768 */
-#define DEBUG_S_FLAG		0x00010000 /*  65536 */
+/* 0x00010000 is unused, used to be S */
 #define DEBUG_T_FLAG		0x00020000 /* 131072 */
 #define DEBUG_R_FLAG		0x00040000 /* 262144 */
 #define DEBUG_J_FLAG		0x00080000 /* 524288 */
@@ -3634,7 +3644,9 @@
 #define DEBUG_C_FLAG		0x00200000 /*2097152 */
 #define DEBUG_A_FLAG		0x00400000 /*4194304 */
 #define DEBUG_q_FLAG		0x00800000 /*8388608 */
-#define DEBUG_MASK		0x00FFEFFF /* mask of all the standard flags */
+#define DEBUG_M_FLAG		0x01000000 /*16777216*/
+#define DEBUG_B_FLAG		0x02000000 /*33554432*/
+#define DEBUG_MASK		0x03FEEFFF /* mask of all the standard flags */
 
 #define DEBUG_DB_RECURSE_FLAG	0x40000000
 #define DEBUG_TOP_FLAG		0x80000000 /* XXX what's this for ??? Signal
@@ -3656,7 +3668,6 @@
 #  define DEBUG_H_TEST_ (PL_debug & DEBUG_H_FLAG)
 #  define DEBUG_X_TEST_ (PL_debug & DEBUG_X_FLAG)
 #  define DEBUG_D_TEST_ (PL_debug & DEBUG_D_FLAG)
-#  define DEBUG_S_TEST_ (PL_debug & DEBUG_S_FLAG)
 #  define DEBUG_T_TEST_ (PL_debug & DEBUG_T_FLAG)
 #  define DEBUG_R_TEST_ (PL_debug & DEBUG_R_FLAG)
 #  define DEBUG_J_TEST_ (PL_debug & DEBUG_J_FLAG)
@@ -3664,6 +3675,8 @@
 #  define DEBUG_C_TEST_ (PL_debug & DEBUG_C_FLAG)
 #  define DEBUG_A_TEST_ (PL_debug & DEBUG_A_FLAG)
 #  define DEBUG_q_TEST_ (PL_debug & DEBUG_q_FLAG)
+#  define DEBUG_M_TEST_ (PL_debug & DEBUG_M_FLAG)
+#  define DEBUG_B_TEST_ (PL_debug & DEBUG_B_FLAG)
 #  define DEBUG_Xv_TEST_ (DEBUG_X_TEST_ && DEBUG_v_TEST_)
 #  define DEBUG_Uv_TEST_ (DEBUG_U_TEST_ && DEBUG_v_TEST_)
 
@@ -3685,7 +3698,6 @@
 #  define DEBUG_H_TEST DEBUG_H_TEST_
 #  define DEBUG_X_TEST DEBUG_X_TEST_
 #  define DEBUG_D_TEST DEBUG_D_TEST_
-#  define DEBUG_S_TEST DEBUG_S_TEST_
 #  define DEBUG_T_TEST DEBUG_T_TEST_
 #  define DEBUG_R_TEST DEBUG_R_TEST_
 #  define DEBUG_J_TEST DEBUG_J_TEST_
@@ -3693,6 +3705,8 @@
 #  define DEBUG_C_TEST DEBUG_C_TEST_
 #  define DEBUG_A_TEST DEBUG_A_TEST_
 #  define DEBUG_q_TEST DEBUG_q_TEST_
+#  define DEBUG_M_TEST DEBUG_M_TEST_
+#  define DEBUG_B_TEST DEBUG_B_TEST_
 #  define DEBUG_Xv_TEST DEBUG_Xv_TEST_
 #  define DEBUG_Uv_TEST DEBUG_Uv_TEST_
 
@@ -3733,14 +3747,14 @@
 #  define DEBUG_Xv(a) DEBUG__(DEBUG_Xv_TEST, a)
 #  define DEBUG_Uv(a) DEBUG__(DEBUG_Uv_TEST, a)
 
-#  define DEBUG_S(a)
-
 #  define DEBUG_T(a) DEBUG__(DEBUG_T_TEST, a)
 #  define DEBUG_R(a) DEBUG__(DEBUG_R_TEST, a)
 #  define DEBUG_v(a) DEBUG__(DEBUG_v_TEST, a)
 #  define DEBUG_C(a) DEBUG__(DEBUG_C_TEST, a)
 #  define DEBUG_A(a) DEBUG__(DEBUG_A_TEST, a)
 #  define DEBUG_q(a) DEBUG__(DEBUG_q_TEST, a)
+#  define DEBUG_M(a) DEBUG__(DEBUG_M_TEST, a)
+#  define DEBUG_B(a) DEBUG__(DEBUG_B_TEST, a)
 
 #else /* DEBUGGING */
 
@@ -3760,7 +3774,6 @@
 #  define DEBUG_H_TEST (0)
 #  define DEBUG_X_TEST (0)
 #  define DEBUG_D_TEST (0)
-#  define DEBUG_S_TEST (0)
 #  define DEBUG_T_TEST (0)
 #  define DEBUG_R_TEST (0)
 #  define DEBUG_J_TEST (0)
@@ -3768,6 +3781,8 @@
 #  define DEBUG_C_TEST (0)
 #  define DEBUG_A_TEST (0)
 #  define DEBUG_q_TEST (0)
+#  define DEBUG_M_TEST (0)
+#  define DEBUG_B_TEST (0)
 #  define DEBUG_Xv_TEST (0)
 #  define DEBUG_Uv_TEST (0)
 
@@ -3789,13 +3804,14 @@
 #  define DEBUG_H(a)
 #  define DEBUG_X(a)
 #  define DEBUG_D(a)
-#  define DEBUG_S(a)
 #  define DEBUG_T(a)
 #  define DEBUG_R(a)
 #  define DEBUG_v(a)
 #  define DEBUG_C(a)
 #  define DEBUG_A(a)
 #  define DEBUG_q(a)
+#  define DEBUG_M(a)
+#  define DEBUG_B(a)
 #  define DEBUG_Xv(a)
 #  define DEBUG_Uv(a)
 #endif /* DEBUGGING */
@@ -3861,13 +3877,21 @@
 #define PERL_MAGIC_arylen_p	  '@' /* to move arylen out of XPVAV */
 #define PERL_MAGIC_ext		  '~' /* Available for use by extensions */
 
+#if defined(DEBUGGING) && defined(I_ASSERT)
+#  include <assert.h>
+#endif
+
+/* Keep the old croak based assert for those who want it, and as a fallback if
+   the platform is so heretically non-ANSI that it can't assert.  */
 
-#ifndef assert  /* <assert.h> might have been included somehow */
-#define assert(what)	PERL_DEB( 					\
+#define Perl_assert(what)	PERL_DEB( 				\
 	((what) ? ((void) 0) :						\
 	    (Perl_croak_nocontext("Assertion %s failed: file \"" __FILE__ \
 			"\", line %d", STRINGIFY(what), __LINE__),	\
 	    (void) 0)))
+
+#ifndef assert
+#  define assert(what)	Perl_assert(what)
 #endif
 
 struct ufuncs {
@@ -4212,9 +4236,11 @@
   INIT("Unsuccessful %s on filename containing newline");
 EXTCONST char PL_no_wrongref[]
   INIT("Can't use %s ref as %s ref");
-EXTCONST char PL_no_symref[]
+/* The core no longer needs these here. If you require the string constant,
+   please inline a copy into your own code.  */
+EXTCONST char PL_no_symref[] __attribute__deprecated__
   INIT("Can't use string (\"%.32s\") as %s ref while \"strict refs\" in use");
-EXTCONST char PL_no_symref_sv[]
+EXTCONST char PL_no_symref_sv[] __attribute__deprecated__
   INIT("Can't use string (\"%" SVf32 "\") as %s ref while \"strict refs\" in use");
 EXTCONST char PL_no_usym[]
   INIT("Can't use an undefined value as %s reference");
@@ -4254,10 +4280,14 @@
 EXTCONST char PL_uudmap[256] =
 #include "uudmap.h"
 ;
+EXTCONST char PL_bitcount[256] =
+#  include "bitcount.h"
+;
 EXTCONST char* const PL_sig_name[] = { SIG_NAME };
 EXTCONST int         PL_sig_num[]  = { SIG_NUM };
 #else
 EXTCONST char PL_uudmap[256];
+EXTCONST char PL_bitcount[256];
 EXTCONST char* const PL_sig_name[];
 EXTCONST int         PL_sig_num[];
 #endif
@@ -4335,9 +4365,85 @@
 	240,	241,	242,	243,	244,	245,	246,	247,
 	248,	249,	250,	251,	252,	253,	254,	255
 };
-#endif  /* !EBCDIC */
-#else
+#endif  /* !EBCDIC, but still in DOINIT */
+
+/* If these tables are accessed through ebcdic, the access will be converted to
+ * latin1 first */
+EXTCONST  unsigned char PL_latin1_lc[] = {  /* lowercasing */
+	0,	1,	2,	3,	4,	5,	6,	7,
+	8,	9,	10,	11,	12,	13,	14,	15,
+	16,	17,	18,	19,	20,	21,	22,	23,
+	24,	25,	26,	27,	28,	29,	30,	31,
+	32,	33,	34,	35,	36,	37,	38,	39,
+	40,	41,	42,	43,	44,	45,	46,	47,
+	48,	49,	50,	51,	52,	53,	54,	55,
+	56,	57,	58,	59,	60,	61,	62,	63,
+	64,	'a',	'b',	'c',	'd',	'e',	'f',	'g',
+	'h',	'i',	'j',	'k',	'l',	'm',	'n',	'o',
+	'p',	'q',	'r',	's',	't',	'u',	'v',	'w',
+	'x',	'y',	'z',	91,	92,	93,	94,	95,
+	96,	97,	98,	99,	100,	101,	102,	103,
+	104,	105,	106,	107,	108,	109,	110,	111,
+	112,	113,	114,	115,	116,	117,	118,	119,
+	120,	121,	122,	123,	124,	125,	126,	127,
+	128,	129,	130,	131,	132,	133,	134,	135,
+	136,	137,	138,	139,	140,	141,	142,	143,
+	144,	145,	146,	147,	148,	149,	150,	151,
+	152,	153,	154,	155,	156,	157,	158,	159,
+	160,	161,	162,	163,	164,	165,	166,	167,
+	168,	169,	170,	171,	172,	173,	174,	175,
+	176,	177,	178,	179,	180,	181,	182,	183,
+	184,	185,	186,	187,	188,	189,	190,	191,
+	192+32,	193+32,	194+32,	195+32,	196+32,	197+32,	198+32,	199+32,
+	200+32,	201+32,	202+32,	203+32,	204+32,	205+32,	206+32,	207+32,
+	208+32,	209+32,	210+32,	211+32,	212+32,	213+32,	214+32,	215,
+	216+32,	217+32,	218+32,	219+32,	220+32,	221+32,	222+32,	223,	
+	224,	225,	226,	227,	228,	229,	230,	231,
+	232,	233,	234,	235,	236,	237,	238,	239,
+	240,	241,	242,	243,	244,	245,	246,	247,
+	248,	249,	250,	251,	252,	253,	254,	255
+};
+
+/* upper and title case of latin1 characters, modified so that the three tricky
+ * ones are mapped to 255 (which is one of the three) */
+EXTCONST  unsigned char PL_mod_latin1_uc[] = {
+	0,	1,	2,	3,	4,	5,	6,	7,
+	8,	9,	10,	11,	12,	13,	14,	15,
+	16,	17,	18,	19,	20,	21,	22,	23,
+	24,	25,	26,	27,	28,	29,	30,	31,
+	32,	33,	34,	35,	36,	37,	38,	39,
+	40,	41,	42,	43,	44,	45,	46,	47,
+	48,	49,	50,	51,	52,	53,	54,	55,
+	56,	57,	58,	59,	60,	61,	62,	63,
+	64,	65,	66,	67,	68,	69,	70,	71,
+	72,	73,	74,	75,	76,	77,	78,	79,
+	80,	81,	82,	83,	84,	85,	86,	87,
+	88,	89,	90,	91,	92,	93,	94,	95,
+	96,	'A',	'B',	'C',	'D',	'E',	'F',	'G',
+	'H',	'I',	'J',	'K',	'L',	'M',	'N',	'O',
+	'P',	'Q',	'R',	'S',	'T',	'U',	'V',	'W',
+	'X',	'Y',	'Z',	123,	124,	125,	126,	127,
+	128,	129,	130,	131,	132,	133,	134,	135,
+	136,	137,	138,	139,	140,	141,	142,	143,
+	144,	145,	146,	147,	148,	149,	150,	151,
+	152,	153,	154,	155,	156,	157,	158,	159,
+	160,	161,	162,	163,	164,	165,	166,	167,
+	168,	169,	170,	171,	172,	173,	174,	175,
+	176,	177,	178,	179,	180,	255 /*micro*/,	182,	183,
+	184,	185,	186,	187,	188,	189,	190,	191,
+	192,	193,	194,	195,	196,	197,	198,	199,
+	200,	201,	202,	203,	204,	205,	206,	207,
+	208,	209,	210,	211,	212,	213,	214,	215,
+	216,	217,	218,	219,	220,	221,	222,	255 /*sharp s*/,	
+	224-32,	225-32,	226-32,	227-32,	228-32,	229-32,	230-32,	231-32,
+	232-32,	233-32,	234-32,	235-32,	236-32,	237-32,	238-32,	239-32,
+	240-32,	241-32,	242-32,	243-32,	244-32,	245-32,	246-32,	247,
+	248-32,	249-32,	250-32,	251-32,	252-32,	253-32,	254-32,	255
+};
+#else	/* ! DOINIT */
 EXTCONST unsigned char PL_fold[];
+EXTCONST unsigned char PL_mod_latin1_uc[];
+EXTCONST unsigned char PL_latin1_lc[];
 #endif
 
 #ifndef PERL_GLOBAL_STRUCT /* or perlvars.h */
@@ -4461,14 +4567,17 @@
 #ifdef DOINIT
 EXTCONST char* const PL_block_type[] = {
 	"NULL",
-	"SUB",
-	"EVAL",
-	"LOOP",
-	"SUBST",
+	"WHEN",
 	"BLOCK",
-	"FORMAT",
 	"GIVEN",
-	"WHEN"
+	"LOOP_FOR",
+	"LOOP_PLAIN",
+	"LOOP_LAZYSV",
+	"LOOP_LAZYIV",
+	"SUB",
+	"FORMAT",
+	"EVAL",
+	"SUBST"
 };
 #else
 EXTCONST char* PL_block_type[];
@@ -4645,7 +4754,8 @@
     want_vtbl_utf8,
     want_vtbl_symtab,
     want_vtbl_arylen_p,
-    want_vtbl_hintselem
+    want_vtbl_hintselem,
+    want_vtbl_hints
 };
 
 
@@ -4663,6 +4773,7 @@
 #define HINT_BLOCK_SCOPE	0x00000100
 #define HINT_STRICT_SUBS	0x00000200 /* strict pragma */
 #define HINT_STRICT_VARS	0x00000400 /* strict pragma */
+#define HINT_UNI_8_BIT		0x00000800 /* unicode_strings feature */
 
 /* The HINT_NEW_* constants are used by the overload pragma */
 #define HINT_NEW_INTEGER	0x00001000
@@ -4723,8 +4834,8 @@
 
 typedef void (*DESTRUCTORFUNC_NOCONTEXT_t) (void*);
 typedef void (*DESTRUCTORFUNC_t) (pTHX_ void*);
-typedef void (*SVFUNC_t) (pTHX_ SV*);
-typedef I32  (*SVCOMPARE_t) (pTHX_ SV*, SV*);
+typedef void (*SVFUNC_t) (pTHX_ SV* const);
+typedef I32  (*SVCOMPARE_t) (pTHX_ SV* const, SV* const);
 typedef void (*XSINIT_t) (pTHX);
 typedef void (*ATEXIT_t) (pTHX_ void*);
 typedef void (*XSUBADDR_t) (pTHX_ CV *);
@@ -4738,6 +4849,12 @@
 
 typedef OP* (CPERLscope(*Perl_ppaddr_t))(pTHX);
 typedef OP* (CPERLscope(*Perl_check_t)) (pTHX_ OP*);
+typedef void(CPERLscope(*Perl_ophook_t))(pTHX_ OP*);
+typedef int (CPERLscope(*Perl_keyword_plugin_t))(pTHX_ char*, STRLEN, OP**);
+
+#define KEYWORD_PLUGIN_DECLINE 0
+#define KEYWORD_PLUGIN_STMT    1
+#define KEYWORD_PLUGIN_EXPR    2
 
 /* Interpreter exitlist entry */
 typedef struct exitlistentry {
@@ -4860,6 +4977,11 @@
 END_EXTERN_C
 #endif
 
+#ifdef PERL_CORE
+/* All core uses now exterminated. Ensure no zombies can return:  */
+#  undef PL_na
+#endif
+
 #if defined(WIN32)
 /* Now all the config stuff is setup we can include embed.h */
 #  include "embed.h"
@@ -4944,7 +5066,6 @@
     0
 );
 
-/* For now, hints magic will also use vtbl_sig, because it is all 0  */
 MGVTBL_SET(
     PL_vtbl_sig,
     0,
@@ -5194,7 +5315,7 @@
     MEMBER_TO_FPTR(Perl_magic_setregexp),
     0,
     0,
-    MEMBER_TO_FPTR(Perl_magic_freeregexp),
+    0,
     0,
     0,
     0
@@ -5309,6 +5430,18 @@
     0
 );
 
+MGVTBL_SET(
+    PL_vtbl_hints,
+    0,
+    0,
+    0,
+    MEMBER_TO_FPTR(Perl_magic_clearhints),
+    0,
+    0,
+    0,
+    0
+);
+
 #include "overload.h"
 
 END_EXTERN_C
@@ -5379,7 +5512,7 @@
 				 PERLDBf_SUBLINE| PERLDBf_SINGLE|	\
 				 PERLDBf_NAMEEVAL| PERLDBf_NAMEANON |   \
 				 PERLDBf_SAVESRC)
-					/* No _NONAME, _GOTO, _ASSERTION */
+					/* No _NONAME, _GOTO */
 #define PERLDBf_SUB		0x01	/* Debug sub enter/exit */
 #define PERLDBf_LINE		0x02	/* Keep line # */
 #define PERLDBf_NOOPT		0x04	/* Switch off optimizations */
@@ -5393,9 +5526,7 @@
 #define PERLDBf_NAMEANON	0x200	/* Informative names for anon subs */
 #define PERLDBf_SAVESRC  	0x400	/* Save source lines into @{"_<$filename"} */
 #define PERLDBf_SAVESRC_NOSUBS	0x800	/* Including evals that generate no subrouties */
-#if 0 /* Not yet working. */
 #define PERLDBf_SAVESRC_INVALID	0x1000	/* Save source that did not compile */
-#endif
 
 #define PERLDB_SUB	(PL_perldb && (PL_perldb & PERLDBf_SUB))
 #define PERLDB_LINE	(PL_perldb && (PL_perldb & PERLDBf_LINE))
@@ -5407,12 +5538,9 @@
 #define PERLDB_GOTO	(PL_perldb && (PL_perldb & PERLDBf_GOTO))
 #define PERLDB_NAMEEVAL	(PL_perldb && (PL_perldb & PERLDBf_NAMEEVAL))
 #define PERLDB_NAMEANON	(PL_perldb && (PL_perldb & PERLDBf_NAMEANON))
-#define PERLDB_ASSERTION (PL_perldb && (PL_perldb & PERLDBf_ASSERTION))
 #define PERLDB_SAVESRC 	(PL_perldb && (PL_perldb & PERLDBf_SAVESRC))
 #define PERLDB_SAVESRC_NOSUBS	(PL_perldb && (PL_perldb & PERLDBf_SAVESRC_NOSUBS))
-#if 0 /* Not yet working. */
 #define PERLDB_SAVESRC_INVALID	(PL_perldb && (PL_perldb & PERLDBf_SAVESRC_INVALID))
-#endif
 
 #ifdef USE_LOCALE_NUMERIC
 
@@ -5773,64 +5901,6 @@
 #   endif
 #endif
 
-#ifdef IAMSUID
-
-#ifdef I_SYS_STATVFS
-#   if defined(PERL_SCO) && !defined(_SVID3)
-#       define _SVID3
-#   endif
-#   include <sys/statvfs.h>     /* for f?statvfs() */
-#endif
-#ifdef I_SYS_MOUNT
-#   include <sys/mount.h>       /* for *BSD f?statfs() */
-#endif
-#ifdef I_MNTENT
-#   include <mntent.h>          /* for getmntent() */
-#endif
-#ifdef I_SYS_STATFS
-#   include <sys/statfs.h>      /* for some statfs() */
-#endif
-#ifdef I_SYS_VFS
-#  ifdef __sgi
-#    define sv IRIX_sv		/* kludge: IRIX has an sv of its own */
-#  endif
-#    include <sys/vfs.h>	/* for some statfs() */
-#  ifdef __sgi
-#    undef IRIX_sv
-#  endif
-#endif
-#ifdef I_USTAT
-#   include <ustat.h>           /* for ustat() */
-#endif
-
-#if !defined(PERL_MOUNT_NOSUID) && defined(MOUNT_NOSUID)
-#    define PERL_MOUNT_NOSUID MOUNT_NOSUID
-#endif
-#if !defined(PERL_MOUNT_NOSUID) && defined(MNT_NOSUID)
-#    define PERL_MOUNT_NOSUID MNT_NOSUID
-#endif
-#if !defined(PERL_MOUNT_NOSUID) && defined(MS_NOSUID)
-#   define PERL_MOUNT_NOSUID MS_NOSUID
-#endif
-#if !defined(PERL_MOUNT_NOSUID) && defined(M_NOSUID)
-#   define PERL_MOUNT_NOSUID M_NOSUID
-#endif
-
-#if !defined(PERL_MOUNT_NOEXEC) && defined(MOUNT_NOEXEC)
-#    define PERL_MOUNT_NOEXEC MOUNT_NOEXEC
-#endif
-#if !defined(PERL_MOUNT_NOEXEC) && defined(MNT_NOEXEC)
-#    define PERL_MOUNT_NOEXEC MNT_NOEXEC
-#endif
-#if !defined(PERL_MOUNT_NOEXEC) && defined(MS_NOEXEC)
-#   define PERL_MOUNT_NOEXEC MS_NOEXEC
-#endif
-#if !defined(PERL_MOUNT_NOEXEC) && defined(M_NOEXEC)
-#   define PERL_MOUNT_NOEXEC M_NOEXEC
-#endif
-
-#endif /* IAMSUID */
-
 #ifdef I_LIBUTIL
 #   include <libutil.h>		/* setproctitle() in some FreeBSDs */
 #endif
@@ -5996,8 +6066,8 @@
 #define NO_ENV_ARRAY_IN_MAIN
 #endif
 
-/* These are used by Perl_pv_escape() and Perl_pv_pretty() 
- * are here so that they are available throughout the core 
+/* These are used by Perl_pv_escape() and Perl_pv_pretty()
+ * are here so that they are available throughout the core
  * NOTE that even though some are for _escape and some for _pretty
  * there must not be any clashes as the flags from _pretty are
  * passed straight through to _escape.
@@ -6011,7 +6081,7 @@
 
 #define PERL_PV_ESCAPE_FIRSTCHAR    0x0008
 
-#define PERL_PV_ESCAPE_UNI          0x0100     
+#define PERL_PV_ESCAPE_UNI          0x0100
 #define PERL_PV_ESCAPE_UNI_DETECT   0x0200
 
 #define PERL_PV_ESCAPE_ALL	    0x1000
@@ -6076,8 +6146,6 @@
 */
 
 #endif /* Include guard */
-
-#define CLEAR_ERRSV() STMT_START { sv_setpvn(ERRSV,"",0); if (SvMAGICAL(ERRSV)) { mg_free(ERRSV); } SvPOK_only(ERRSV); } STMT_END
 
 /*
  * Local variables:
Index: src/gnu/usr.bin/perl/perlio.c
diff -u src/gnu/usr.bin/perl/perlio.c:1.13 src/gnu/usr.bin/perl/perlio.c:1.14
--- perlio.c:1.13	Mon Oct 12 18:24:21 2009
+++ perlio.c	Fri Sep 24 15:06:41 2010
@@ -135,7 +135,7 @@
      * This used to be contents of do_binmode in doio.c
      */
 #ifdef DOSISH
-#  if defined(atarist) || defined(__MINT__)
+#  if defined(atarist)
     PERL_UNUSED_ARG(iotype);
     if (!fflush(fp)) {
         if (mode & O_BINARY)
@@ -614,10 +614,8 @@
 	if (--list->refcnt == 0) {
 	    if (list->array) {
 		IV i;
-		for (i = 0; i < list->cur; i++) {
-		    if (list->array[i].arg)
-			SvREFCNT_dec(list->array[i].arg);
-		}
+		for (i = 0; i < list->cur; i++)
+		    SvREFCNT_dec(list->array[i].arg);
 		Safefree(list->array);
 	    }
 	    Safefree(list);
@@ -761,6 +759,11 @@
 	PerlIOl *l = PerlIOBase(f);
 
 	while (l) {
+	    /* There is some collusion in the implementation of
+	       XS_PerlIO_get_layers - it knows that name and flags are
+	       generated as fresh SVs here, and takes advantage of that to
+	       "copy" them by taking a reference. If it changes here, it needs
+	       to change there too.  */
 	    SV * const name = l->tab && l->tab->name ?
 	    newSVpv(l->tab->name, 0) : &PL_sv_undef;
 	    SV * const arg = l->tab && l->tab->Getarg ?
@@ -802,7 +805,7 @@
 	} else {
 	    SV * const pkgsv = newSVpvs("PerlIO");
 	    SV * const layer = newSVpvn(name, len);
-	    CV * const cv    = Perl_get_cvn_flags(aTHX_ STR_WITH_LEN("PerlIO::Layer::NoWarnings"), 0);
+	    CV * const cv    = get_cvs("PerlIO::Layer::NoWarnings", 0);
 	    ENTER;
 	    SAVEINT(PL_in_load_module);
 	    if (cv) {
@@ -976,10 +979,9 @@
 		     * seen as an invalid separator character.
 		     */
 		    const char q = ((*s == '\'') ? '"' : '\'');
-		    if (ckWARN(WARN_LAYER))
-			Perl_warner(aTHX_ packWARN(WARN_LAYER),
-			      "Invalid separator character %c%c%c in PerlIO layer specification %s",
-			      q, *s, q, s);
+		    Perl_ck_warner(aTHX_ packWARN(WARN_LAYER),
+				   "Invalid separator character %c%c%c in PerlIO layer specification %s",
+				   q, *s, q, s);
 		    SETERRNO(EINVAL, LIB_INVARG);
 		    return -1;
 		}
@@ -1013,10 +1015,9 @@
 			     */
 			case '\0':
 			    e--;
-			    if (ckWARN(WARN_LAYER))
-				Perl_warner(aTHX_ packWARN(WARN_LAYER),
-				      "Argument list not closed for PerlIO layer \"%.*s\"",
-				      (int) (e - s), s);
+			    Perl_ck_warner(aTHX_ packWARN(WARN_LAYER),
+					   "Argument list not closed for PerlIO layer \"%.*s\"",
+					   (int) (e - s), s);
 			    return -1;
 			default:
 			    /*
@@ -1035,13 +1036,11 @@
 			    arg = newSVpvn(as, alen);
 			PerlIO_list_push(aTHX_ av, layer,
 					 (arg) ? arg : &PL_sv_undef);
-			if (arg)
-			    SvREFCNT_dec(arg);
+			SvREFCNT_dec(arg);
 		    }
 		    else {
-			if (ckWARN(WARN_LAYER))
-			    Perl_warner(aTHX_ packWARN(WARN_LAYER), "Unknown PerlIO layer \"%.*s\"",
-				  (int) llen, s);
+			Perl_ck_warner(aTHX_ packWARN(WARN_LAYER), "Unknown PerlIO layer \"%.*s\"",
+				       (int) llen, s);
 			return -1;
 		    }
 		}
@@ -1455,8 +1454,8 @@
 	PerlIO_funcs *f = PerlIO_find_layer(aTHX_ STR_WITH_LEN("scalar"), 1);
 	/* This isn't supposed to happen, since PerlIO::scalar is core,
 	 * but could happen anyway in smaller installs or with PAR */
-	if (!f && ckWARN(WARN_LAYER))
-	    Perl_warner(aTHX_ packWARN(WARN_LAYER), "Unknown PerlIO layer \"scalar\"");
+	if (!f)
+	    Perl_ck_warner(aTHX_ packWARN(WARN_LAYER), "Unknown PerlIO layer \"scalar\"");
 	return f;
     }
 
@@ -1561,8 +1560,7 @@
 		    arg = (*l->tab->Getarg) (aTHX_ &l, NULL, 0);
 		PerlIO_list_push(aTHX_ layera, l->tab,
 				 (arg) ? arg : &PL_sv_undef);
-		if (arg)
-		    SvREFCNT_dec(arg);
+		SvREFCNT_dec(arg);
 		l = *PerlIONext(&l);
 	    }
 	}
@@ -1768,10 +1766,7 @@
 
 	  if (tab)
 	       return (tab->Get_base != NULL);
-	  SETERRNO(EINVAL, LIB_INVARG);
      }
-     else
-	  SETERRNO(EBADF, SS_IVCHAN);
 
      return 0;
 }
@@ -1779,15 +1774,14 @@
 int
 PerlIO_fast_gets(PerlIO *f)
 {
-    if (PerlIOValid(f) && (PerlIOBase(f)->flags & PERLIO_F_FASTGETS)) {
-	 const PerlIO_funcs * const tab = PerlIOBase(f)->tab;
+    if (PerlIOValid(f)) {
+	 if (PerlIOBase(f)->flags & PERLIO_F_FASTGETS) {
+	     const PerlIO_funcs * const tab = PerlIOBase(f)->tab;
 
-	 if (tab)
-	      return (tab->Set_ptrcnt != NULL);
-	 SETERRNO(EINVAL, LIB_INVARG);
+	     if (tab)
+		  return (tab->Set_ptrcnt != NULL);
+	 }
     }
-    else
-	 SETERRNO(EBADF, SS_IVCHAN);
 
     return 0;
 }
@@ -1800,10 +1794,7 @@
 
 	if (tab)
 	     return (tab->Get_ptr != NULL && tab->Get_cnt != NULL);
-	  SETERRNO(EINVAL, LIB_INVARG);
     }
-    else
-	 SETERRNO(EBADF, SS_IVCHAN);
 
     return 0;
 }
@@ -1816,10 +1807,7 @@
 
 	  if (tab)
 	       return (tab->Set_ptrcnt != NULL);
-	  SETERRNO(EINVAL, LIB_INVARG);
     }
-    else
-	 SETERRNO(EBADF, SS_IVCHAN);
 
     return 0;
 }
@@ -2277,8 +2265,7 @@
 	f = PerlIO_push(aTHX_ f, self, PerlIO_modestr(o,buf), arg);
 	if (PerlIOBase(o)->flags & PERLIO_F_UTF8)
 	    PerlIOBase(f)->flags |= PERLIO_F_UTF8;
-	if (arg)
-	    SvREFCNT_dec(arg);
+	SvREFCNT_dec(arg);
     }
     return f;
 }
@@ -4123,7 +4110,7 @@
     if (!b->buf) {
 	if (!b->bufsiz)
 	    b->bufsiz = 4096;
-	b->buf = Newxz(b->buf,b->bufsiz, STDCHAR);
+	Newxz(b->buf,b->bufsiz, STDCHAR);
 	if (!b->buf) {
 	    b->buf = (STDCHAR *) & b->oneword;
 	    b->bufsiz = sizeof(b->oneword);
@@ -5167,16 +5154,29 @@
 	  f = PerlIO_fdopen(fd, "w+b");
 #else /* WIN32 */
 #    if defined(HAS_MKSTEMP) && ! defined(VMS) && ! defined(OS2)
-     SV * const sv = newSVpvs("/tmp/PerlIO_XXXXXX");
+     int fd = -1;
+     char tempname[] = "/tmp/PerlIO_XXXXXX";
+     const char * const tmpdir = PL_tainting ? NULL : PerlEnv_getenv("TMPDIR");
+     SV * sv;
      /*
       * I have no idea how portable mkstemp() is ... NI-S
       */
-     const int fd = mkstemp(SvPVX(sv));
+     if (tmpdir && *tmpdir) {
+	 /* if TMPDIR is set and not empty, we try that first */
+	 sv = newSVpv(tmpdir, 0);
+	 sv_catpv(sv, tempname + 4);
+	 fd = mkstemp(SvPVX(sv));
+     }
+     if (fd < 0) {
+	 sv = NULL;
+	 /* else we try /tmp */
+	 fd = mkstemp(tempname);
+     }
      if (fd >= 0) {
 	  f = PerlIO_fdopen(fd, "w+");
 	  if (f)
 	       PerlIOBase(f)->flags |= PERLIO_F_TEMP;
-	  PerlLIO_unlink(SvPVX_const(sv));
+	  PerlLIO_unlink(sv ? SvPVX_const(sv) : tempname);
      }
      SvREFCNT_dec(sv);
 #    else	/* !HAS_MKSTEMP, fallback to stdio tmpfile(). */
Index: src/gnu/usr.bin/perl/perly.c
diff -u src/gnu/usr.bin/perl/perly.c:1.11 src/gnu/usr.bin/perl/perly.c:1.12
--- perly.c:1.11	Mon Oct 12 18:24:21 2009
+++ perly.c	Fri Sep 24 15:06:41 2010
@@ -266,8 +266,10 @@
 
 
 #ifdef DISABLE_STACK_FREE
+    for (i=0; i< parser->yylen; i++) {
+	SvREFCNT_dec(ps[-i].compcv);
+    }
     ps -= parser->yylen;
-    PERL_UNUSED_VAR(i);
 #else
     /* clear any reducing ops (1st pass) */
 
@@ -278,8 +280,9 @@
 	    if ( ! (ps[-i].val.opval->op_attached
 		    && !ps[-i].val.opval->op_latefreed))
 	    {
-		if (ps[-i].comppad != PL_comppad) {
-		    PAD_RESTORE_LOCAL(ps[-i].comppad);
+		if (ps[-i].compcv != PL_compcv) {
+		    PL_compcv = ps[-i].compcv;
+		    PAD_SET_CUR_NOSAVE(CvPADLIST(PL_compcv), 1);
 		}
 		op_free(ps[-i].val.opval);
 	    }
@@ -294,8 +297,9 @@
 	if (yy_type_tab[yystos[ps->state]] == toketype_opval
 	    && ps->val.opval)
 	{
-	    if (ps->comppad != PL_comppad) {
-		PAD_RESTORE_LOCAL(ps->comppad);
+	    if (ps->compcv != PL_compcv) {
+		PL_compcv = ps->compcv;
+		PAD_SET_CUR_NOSAVE(CvPADLIST(PL_compcv), 1);
 	    }
 	    YYDPRINTF ((Perl_debug_log, "(freeing op)\n"));
 #ifndef DISABLE_STACK_FREE
@@ -304,6 +308,7 @@
 #endif
 		op_free(ps->val.opval);
 	}
+	SvREFCNT_dec(ps->compcv);
 	ps--;
     }
 }
@@ -451,7 +456,7 @@
     YYPUSHSTACK;
     ps->state   = yyn;
     ps->val     = parser->yylval;
-    ps->comppad = PL_comppad;
+    ps->compcv  = (CV*)SvREFCNT_inc(PL_compcv);
     ps->savestack_ix = PL_savestack_ix;
 #ifdef DEBUGGING
     ps->name    = (const char *)(yytname[yytoken]);
@@ -525,12 +530,12 @@
 
     }
 
-#ifndef DISABLE_STACK_FREE
     /* any just-reduced ops with the op_latefreed flag cleared need to be
      * freed; the rest need the flag resetting */
     {
 	int i;
 	for (i=0; i< parser->yylen; i++) {
+#ifndef DISABLE_STACK_FREE
 	    if (yy_type_tab[yystos[ps[-i].state]] == toketype_opval
 		&& ps[-i].val.opval)
 	    {
@@ -538,9 +543,10 @@
 		if (ps[-i].val.opval->op_latefreed)
 		    op_free(ps[-i].val.opval);
 	    }
+#endif
+	    SvREFCNT_dec(ps[-i].compcv);
 	}
     }
-#endif
 
     parser->ps = ps -= (parser->yylen-1);
 
@@ -549,7 +555,7 @@
 	  number reduced by.  */
 
     ps->val     = yyval;
-    ps->comppad = PL_comppad;
+    ps->compcv  = (CV*)SvREFCNT_inc(PL_compcv);
     ps->savestack_ix = PL_savestack_ix;
 #ifdef DEBUGGING
     ps->name    = (const char *)(yytname [yyr1[yyn]]);
@@ -584,6 +590,7 @@
 	/* Return failure if at end of input.  */
 	if (parser->yychar == YYEOF) {
 	    /* Pop the error token.  */
+	    SvREFCNT_dec(ps->compcv);
 	    YYPOPSTACK;
 	    /* Pop the rest of the stack.  */
 	    while (ps > parser->stack) {
@@ -593,18 +600,22 @@
 			&& ps->val.opval)
 		{
 		    YYDPRINTF ((Perl_debug_log, "(freeing op)\n"));
-		    if (ps->comppad != PL_comppad) {
-			PAD_RESTORE_LOCAL(ps->comppad);
+		    if (ps->compcv != PL_compcv) {
+			PL_compcv = ps->compcv;
+			PAD_SET_CUR_NOSAVE(CvPADLIST(PL_compcv), 1);
 		    }
 		    ps->val.opval->op_latefree  = 0;
 		    op_free(ps->val.opval);
 		}
+		SvREFCNT_dec(ps->compcv);
 		YYPOPSTACK;
 	    }
 	    YYABORT;
 	}
 
 	YYDSYMPRINTF ("Error: discarding", yytoken, &parser->yylval);
+	if (yy_type_tab[yytoken] == toketype_opval)
+	    op_free(parser->yylval.opval);
 	parser->yychar = YYEMPTY;
 
     }
@@ -639,12 +650,14 @@
 	LEAVE_SCOPE(ps->savestack_ix);
 	if (yy_type_tab[yystos[ps->state]] == toketype_opval && ps->val.opval) {
 	    YYDPRINTF ((Perl_debug_log, "(freeing op)\n"));
-	    if (ps->comppad != PL_comppad) {
-		PAD_RESTORE_LOCAL(ps->comppad);
+	    if (ps->compcv != PL_compcv) {
+		PL_compcv = ps->compcv;
+		PAD_SET_CUR_NOSAVE(CvPADLIST(PL_compcv), 1);
 	    }
 	    ps->val.opval->op_latefree  = 0;
 	    op_free(ps->val.opval);
 	}
+	SvREFCNT_dec(ps->compcv);
 	YYPOPSTACK;
 	yystate = ps->state;
 
@@ -659,7 +672,7 @@
     YYPUSHSTACK;
     ps->state   = yyn;
     ps->val     = parser->yylval;
-    ps->comppad = PL_comppad;
+    ps->compcv  = (CV*)SvREFCNT_inc(PL_compcv);
     ps->savestack_ix = PL_savestack_ix;
 #ifdef DEBUGGING
     ps->name    ="<err>";
@@ -673,6 +686,9 @@
   `-------------------------------------*/
   yyacceptlab:
     yyresult = 0;
+    for (ps=parser->ps; ps > parser->stack; ps--) {
+	SvREFCNT_dec(ps->compcv);
+    }
     parser->ps = parser->stack; /* disable cleanup */
     goto yyreturn;
 
Index: src/gnu/usr.bin/perl/perly.h
diff -u src/gnu/usr.bin/perl/perly.h:1.5 src/gnu/usr.bin/perl/perly.h:1.6
--- perly.h:1.5	Mon Sep 29 17:35:58 2008
+++ perly.h	Fri Sep 24 15:06:41 2010
@@ -1,25 +1,24 @@
 #ifdef PERL_CORE
-/* A Bison parser, made by GNU Bison 2.3.  */
 
-/* Skeleton interface for Bison's Yacc-like parsers in C
+/* A Bison parser, made by GNU Bison 2.4.1.  */
 
-   Copyright (C) 1984, 1989, 1990, 2000, 2001, 2002, 2003, 2004, 2005, 2006
+/* Skeleton interface for Bison's Yacc-like parsers in C
+   
+      Copyright (C) 1984, 1989, 1990, 2000, 2001, 2002, 2003, 2004, 2005, 2006
    Free Software Foundation, Inc.
-
-   This program is free software; you can redistribute it and/or modify
+   
+   This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
-   the Free Software Foundation; either version 2, or (at your option)
-   any later version.
-
+   the Free Software Foundation, either version 3 of the License, or
+   (at your option) any later version.
+   
    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.
-
+   
    You should have received a copy of the GNU General Public License
-   along with this program; if not, write to the Free Software
-   Foundation, Inc., 51 Franklin Street, Fifth Floor,
-   Boston, MA 02110-1301, USA.  */
+   along with this program.  If not, see <http://www.gnu.org/licenses/>.  */
 
 /* As a special exception, you may create a larger work that contains
    part or all of the Bison parser skeleton and distribute that work
@@ -30,10 +29,11 @@
    special exception, which will cause the skeleton and the resulting
    Bison output files to be licensed under the GNU General Public
    License without this special exception.
-
+   
    This special exception was added by the Free Software Foundation in
    version 2.2 of Bison.  */
 
+
 /* Tokens.  */
 #ifndef YYTOKENTYPE
 # define YYTOKENTYPE
@@ -49,67 +49,71 @@
      FUNC0SUB = 264,
      UNIOPSUB = 265,
      LSTOPSUB = 266,
-     LABEL = 267,
-     FORMAT = 268,
-     SUB = 269,
-     ANONSUB = 270,
-     PACKAGE = 271,
-     USE = 272,
-     WHILE = 273,
-     UNTIL = 274,
-     IF = 275,
-     UNLESS = 276,
-     ELSE = 277,
-     ELSIF = 278,
-     CONTINUE = 279,
-     FOR = 280,
-     GIVEN = 281,
-     WHEN = 282,
-     DEFAULT = 283,
-     LOOPEX = 284,
-     DOTDOT = 285,
-     FUNC0 = 286,
-     FUNC1 = 287,
-     FUNC = 288,
-     UNIOP = 289,
-     LSTOP = 290,
-     RELOP = 291,
-     EQOP = 292,
-     MULOP = 293,
-     ADDOP = 294,
-     DOLSHARP = 295,
-     DO = 296,
-     HASHBRACK = 297,
-     NOAMP = 298,
-     LOCAL = 299,
-     MY = 300,
-     MYSUB = 301,
-     REQUIRE = 302,
-     COLONATTR = 303,
-     PREC_LOW = 304,
-     DOROP = 305,
-     OROP = 306,
-     ANDOP = 307,
-     NOTOP = 308,
-     ASSIGNOP = 309,
-     DORDOR = 310,
-     OROR = 311,
-     ANDAND = 312,
-     BITOROP = 313,
-     BITANDOP = 314,
-     SHIFTOP = 315,
-     MATCHOP = 316,
-     REFGEN = 317,
-     UMINUS = 318,
-     POWOP = 319,
-     POSTDEC = 320,
-     POSTINC = 321,
-     PREDEC = 322,
-     PREINC = 323,
-     ARROW = 324,
-     PEG = 325
+     PLUGEXPR = 267,
+     PLUGSTMT = 268,
+     LABEL = 269,
+     FORMAT = 270,
+     SUB = 271,
+     ANONSUB = 272,
+     PACKAGE = 273,
+     USE = 274,
+     WHILE = 275,
+     UNTIL = 276,
+     IF = 277,
+     UNLESS = 278,
+     ELSE = 279,
+     ELSIF = 280,
+     CONTINUE = 281,
+     FOR = 282,
+     GIVEN = 283,
+     WHEN = 284,
+     DEFAULT = 285,
+     LOOPEX = 286,
+     DOTDOT = 287,
+     YADAYADA = 288,
+     FUNC0 = 289,
+     FUNC1 = 290,
+     FUNC = 291,
+     UNIOP = 292,
+     LSTOP = 293,
+     RELOP = 294,
+     EQOP = 295,
+     MULOP = 296,
+     ADDOP = 297,
+     DOLSHARP = 298,
+     DO = 299,
+     HASHBRACK = 300,
+     NOAMP = 301,
+     LOCAL = 302,
+     MY = 303,
+     MYSUB = 304,
+     REQUIRE = 305,
+     COLONATTR = 306,
+     PREC_LOW = 307,
+     DOROP = 308,
+     OROP = 309,
+     ANDOP = 310,
+     NOTOP = 311,
+     ASSIGNOP = 312,
+     DORDOR = 313,
+     OROR = 314,
+     ANDAND = 315,
+     BITOROP = 316,
+     BITANDOP = 317,
+     SHIFTOP = 318,
+     MATCHOP = 319,
+     REFGEN = 320,
+     UMINUS = 321,
+     POWOP = 322,
+     POSTDEC = 323,
+     POSTINC = 324,
+     PREDEC = 325,
+     PREINC = 326,
+     ARROW = 327,
+     PEG = 328
    };
 #endif
+
 /* Tokens.  */
 #define WORD 258
 #define METHOD 259
@@ -120,66 +124,68 @@
 #define FUNC0SUB 264
 #define UNIOPSUB 265
 #define LSTOPSUB 266
-#define LABEL 267
-#define FORMAT 268
-#define SUB 269
-#define ANONSUB 270
-#define PACKAGE 271
-#define USE 272
-#define WHILE 273
-#define UNTIL 274
-#define IF 275
-#define UNLESS 276
-#define ELSE 277
-#define ELSIF 278
-#define CONTINUE 279
-#define FOR 280
-#define GIVEN 281
-#define WHEN 282
-#define DEFAULT 283
-#define LOOPEX 284
-#define DOTDOT 285
-#define FUNC0 286
-#define FUNC1 287
-#define FUNC 288
-#define UNIOP 289
-#define LSTOP 290
-#define RELOP 291
-#define EQOP 292
-#define MULOP 293
-#define ADDOP 294
-#define DOLSHARP 295
-#define DO 296
-#define HASHBRACK 297
-#define NOAMP 298
-#define LOCAL 299
-#define MY 300
-#define MYSUB 301
-#define REQUIRE 302
-#define COLONATTR 303
-#define PREC_LOW 304
-#define DOROP 305
-#define OROP 306
-#define ANDOP 307
-#define NOTOP 308
-#define ASSIGNOP 309
-#define DORDOR 310
-#define OROR 311
-#define ANDAND 312
-#define BITOROP 313
-#define BITANDOP 314
-#define SHIFTOP 315
-#define MATCHOP 316
-#define REFGEN 317
-#define UMINUS 318
-#define POWOP 319
-#define POSTDEC 320
-#define POSTINC 321
-#define PREDEC 322
-#define PREINC 323
-#define ARROW 324
-#define PEG 325
-
+#define PLUGEXPR 267
+#define PLUGSTMT 268
+#define LABEL 269
+#define FORMAT 270
+#define SUB 271
+#define ANONSUB 272
+#define PACKAGE 273
+#define USE 274
+#define WHILE 275
+#define UNTIL 276
+#define IF 277
+#define UNLESS 278
+#define ELSE 279
+#define ELSIF 280
+#define CONTINUE 281
+#define FOR 282
+#define GIVEN 283
+#define WHEN 284
+#define DEFAULT 285
+#define LOOPEX 286
+#define DOTDOT 287
+#define YADAYADA 288
+#define FUNC0 289
+#define FUNC1 290
+#define FUNC 291
+#define UNIOP 292
+#define LSTOP 293
+#define RELOP 294
+#define EQOP 295
+#define MULOP 296
+#define ADDOP 297
+#define DOLSHARP 298
+#define DO 299
+#define HASHBRACK 300
+#define NOAMP 301
+#define LOCAL 302
+#define MY 303
+#define MYSUB 304
+#define REQUIRE 305
+#define COLONATTR 306
+#define PREC_LOW 307
+#define DOROP 308
+#define OROP 309
+#define ANDOP 310
+#define NOTOP 311
+#define ASSIGNOP 312
+#define DORDOR 313
+#define OROR 314
+#define ANDAND 315
+#define BITOROP 316
+#define BITANDOP 317
+#define SHIFTOP 318
+#define MATCHOP 319
+#define REFGEN 320
+#define UMINUS 321
+#define POWOP 322
+#define POSTDEC 323
+#define POSTINC 324
+#define PREDEC 325
+#define PREINC 326
+#define ARROW 327
+#define PEG 328
 
 
 
@@ -187,6 +193,9 @@
 #if ! defined YYSTYPE && ! defined YYSTYPE_IS_DECLARED
 typedef union YYSTYPE
 {
+
+/* Line 1676 of yacc.c  */
+
     I32	ival; /* __DEFAULT__ (marker for regen_perly.pl;
 				must always be 1st union member) */
     char *pval;
@@ -202,13 +211,16 @@
 #ifdef PERL_MAD
     TOKEN* tkval;
 #endif
-}
-/* Line 1489 of yacc.c.  */
-	YYSTYPE;
+
+
+
+/* Line 1676 of yacc.c  */
+} YYSTYPE;
+# define YYSTYPE_IS_TRIVIAL 1
 # define yystype YYSTYPE /* obsolescent; will be withdrawn */
 # define YYSTYPE_IS_DECLARED 1
-# define YYSTYPE_IS_TRIVIAL 1
 #endif
+
 
 
 
Index: src/gnu/usr.bin/perl/perly.y
diff -u src/gnu/usr.bin/perl/perly.y:1.12 src/gnu/usr.bin/perl/perly.y:1.13
--- perly.y:1.12	Mon Oct 12 18:24:21 2009
+++ perly.y	Fri Sep 24 15:06:41 2010
@@ -73,11 +73,12 @@
 
 %token <opval> WORD METHOD FUNCMETH THING PMFUNC PRIVATEREF
 %token <opval> FUNC0SUB UNIOPSUB LSTOPSUB
+%token <opval> PLUGEXPR PLUGSTMT
 %token <p_tkval> LABEL
 %token <i_tkval> FORMAT SUB ANONSUB PACKAGE USE
 %token <i_tkval> WHILE UNTIL IF UNLESS ELSE ELSIF CONTINUE FOR
 %token <i_tkval> GIVEN WHEN DEFAULT
-%token <i_tkval> LOOPEX DOTDOT
+%token <i_tkval> LOOPEX DOTDOT YADAYADA
 %token <i_tkval> FUNC0 FUNC1 FUNC UNIOP LSTOP
 %token <i_tkval> RELOP EQOP MULOP ADDOP
 %token <i_tkval> DOLSHARP DO HASHBRACK NOAMP
@@ -111,7 +112,7 @@
 %left <i_tkval> ','
 %right <i_tkval> ASSIGNOP
 %right <i_tkval> '?' ':'
-%nonassoc DOTDOT
+%nonassoc DOTDOT YADAYADA
 %left <i_tkval> OROR DORDOR
 %left <i_tkval> ANDAND
 %left <i_tkval> BITOROP
@@ -157,7 +158,7 @@
 	;
 
 mydefsv:	/* NULL */	/* lexicalize $_ */
-			{ $$ = (I32) allocmy("$_"); }
+			{ $$ = (I32) Perl_allocmy(aTHX_ STR_WITH_LEN("$_"), 0); }
 	;
 
 progstart:
@@ -241,6 +242,8 @@
 			      }
 			  })
 			}
+	|	label PLUGSTMT
+			{ $$ = newSTATEOP(0, PVAL($1), $2); }
 	;
 
 /* An expression which may have a side-effect */
@@ -269,6 +272,8 @@
 					(OP*)NULL, $3, $1, (OP*)NULL);
 			  TOKEN_GETMAD($2,((LISTOP*)$$)->op_first->op_sibling,'w');
 			}
+	|	expr WHEN expr
+			{ $$ = newWHENOP($3, scope($1)); }
 	;
 
 /* else and elsif blocks */
@@ -327,7 +332,7 @@
 /* Loops: while, until, for, and a bare block */
 loop	:	label WHILE '(' remember texpr ')' mintro mblock cont
 			{ OP *innerop;
-			  PL_parser->copline = (line_t)$2;
+			  PL_parser->copline = (line_t)IVAL($2);
 			    $$ = block_end($4,
 				   newSTATEOP(0, PVAL($1),
 				     innerop = newWHILEOP(0, 1, (LOOP*)(OP*)NULL,
@@ -340,7 +345,7 @@
 
 	|	label UNTIL '(' remember iexpr ')' mintro mblock cont
 			{ OP *innerop;
-			  PL_parser->copline = (line_t)$2;
+			  PL_parser->copline = (line_t)IVAL($2);
 			    $$ = block_end($4,
 				   newSTATEOP(0, PVAL($1),
 				     innerop = newWHILEOP(0, 1, (LOOP*)(OP*)NULL,
@@ -422,7 +427,7 @@
 
 /* Switch blocks */
 switch	:	label GIVEN '(' remember mydefsv mexpr ')' mblock
-			{ PL_parser->copline = (line_t) $2;
+			{ PL_parser->copline = (line_t) IVAL($2);
 			    $$ = block_end($4,
 				newSTATEOP(0, PVAL($1),
 				    newGIVENOP($6, scope($8),
@@ -506,7 +511,9 @@
 	;
 
 format	:	FORMAT startformsub formname block
-			{ SvREFCNT_inc_simple_void(PL_compcv);
+			{
+			  CV *fmtcv = PL_compcv;
+			  SvREFCNT_inc_simple_void(PL_compcv);
 #ifdef MAD
 			  $$ = newFORM($2, $3, $4);
 			  prepend_madprops($1->tk_mad, $$, 'F');
@@ -516,6 +523,10 @@
 			  newFORM($2, $3, $4);
 			  $$ = (OP*)NULL;
 #endif
+			  if (CvOUTSIDE(fmtcv) && !CvUNIQUE(CvOUTSIDE(fmtcv))) {
+			    SvREFCNT_inc_simple_void(fmtcv);
+			    pad_add_anon((SV*)fmtcv, OP_NULL);
+			  }
 			}
 	;
 
@@ -631,14 +642,18 @@
 			}
 	;
 
-package :	PACKAGE WORD ';'
+package :	PACKAGE WORD WORD ';'
 			{
 #ifdef MAD
-			  $$ = package($2);
+			  $$ = package($3);
 			  token_getmad($1,$$,'o');
-			  token_getmad($3,$$,';');
+			  if ($2)
+			      package_version($2);
+			  token_getmad($4,$$,';');
 #else
-			  package($2);
+			  package($3);
+			  if ($2)
+			      package_version($2);
 			  $$ = (OP*)NULL;
 #endif
 			}
@@ -654,7 +669,7 @@
 			  token_getmad($7,$$,';');
 			  if (PL_parser->rsfp_filters &&
 				      AvFILLp(PL_parser->rsfp_filters) >= 0)
-			      append_madprops(newMADPROP('!', MAD_PV, "", 0), $$, 0);
+			      append_madprops(newMADPROP('!', MAD_NULL, NULL, 0), $$, 0);
 #else
 			  utilize(IVAL($1), $2, $4, $5, $6);
 			  $$ = (OP*)NULL;
@@ -1232,6 +1247,13 @@
 			}
 	|	WORD
 	|	listop
+	|	YADAYADA
+			{
+			  $$ = newLISTOP(OP_DIE, 0, newOP(OP_PUSHMARK, 0),
+				newSVOP(OP_CONST, 0, newSVpvs("Unimplemented")));
+			  TOKEN_GETMAD($1,$$,'X');
+			}
+	|	PLUGEXPR
 	;
 
 /* "my" declarations, with optional attributes */
Index: src/gnu/usr.bin/perl/pp.c
diff -u src/gnu/usr.bin/perl/pp.c:1.13 src/gnu/usr.bin/perl/pp.c:1.14
--- pp.c:1.13	Mon Oct 12 18:24:21 2009
+++ pp.c	Fri Sep 24 15:06:41 2010
@@ -63,6 +63,7 @@
 {
     dVAR; dSP; dTARGET;
     I32 gimme;
+    assert(SvTYPE(TARG) == SVt_PVAV);
     if (PL_op->op_private & OPpLVAL_INTRO)
 	if (!(PL_op->op_private & OPpPAD_STATE))
 	    SAVECLEARSV(PAD_SVl(PL_op->op_targ));
@@ -106,6 +107,7 @@
     dVAR; dSP; dTARGET;
     I32 gimme;
 
+    assert(SvTYPE(TARG) == SVt_PVHV);
     XPUSHs(TARG);
     if (PL_op->op_private & OPpLVAL_INTRO)
 	if (!(PL_op->op_private & OPpPAD_STATE))
@@ -130,6 +132,9 @@
 
 /* Translations. */
 
+static const char S_no_symref_sv[] =
+    "Can't use string (\"%" SVf32 "\"%s) as %s ref while \"strict refs\" in use";
+
 PP(pp_rv2gv)
 {
     dVAR; dSP; dTOPss;
@@ -202,7 +207,7 @@
 	    }
 	    else {
 		if (PL_op->op_private & HINT_STRICT_REFS)
-		    DIE(aTHX_ PL_no_symref_sv, sv, "a symbol");
+		    DIE(aTHX_ S_no_symref_sv, sv, (SvPOK(sv) && SvCUR(sv)>32 ? "..." : ""), "a symbol");
 		if ((PL_op->op_private & (OPpLVAL_INTRO|OPpDONT_INIT_GV))
 		    == OPpDONT_INIT_GV) {
 		    /* We are the target of a coderef assignment.  Return
@@ -222,8 +227,8 @@
 
 /* Helper function for pp_rv2sv and pp_rv2av  */
 GV *
-Perl_softref2xv(pTHX_ SV *const sv, const char *const what, const U32 type,
-		SV ***spp)
+Perl_softref2xv(pTHX_ SV *const sv, const char *const what,
+		const svtype type, SV ***spp)
 {
     dVAR;
     GV *gv;
@@ -232,7 +237,7 @@
 
     if (PL_op->op_private & HINT_STRICT_REFS) {
 	if (SvOK(sv))
-	    Perl_die(aTHX_ PL_no_symref_sv, sv, what);
+	    Perl_die(aTHX_ S_no_symref_sv, sv, (SvPOK(sv) && SvCUR(sv)>32 ? "..." : ""), what);
 	else
 	    Perl_die(aTHX_ PL_no_usym, what);
     }
@@ -321,12 +326,19 @@
 {
     dVAR; dSP;
     AV * const av = MUTABLE_AV(TOPs);
-    SV ** const sv = Perl_av_arylen_p(aTHX_ MUTABLE_AV(av));
-    if (!*sv) {
-	*sv = newSV_type(SVt_PVMG);
-	sv_magic(*sv, MUTABLE_SV(av), PERL_MAGIC_arylen, NULL, 0);
+    const I32 lvalue = PL_op->op_flags & OPf_MOD || LVRET;
+    if (lvalue) {
+	SV ** const sv = Perl_av_arylen_p(aTHX_ MUTABLE_AV(av));
+	if (!*sv) {
+	    *sv = newSV_type(SVt_PVMG);
+	    sv_magic(*sv, MUTABLE_SV(av), PERL_MAGIC_arylen, NULL, 0);
+	}
+	SETs(*sv);
+    } else {
+	SETs(sv_2mortal(newSViv(
+	    AvFILL(MUTABLE_AV(av)) + CopARYBASE_get(PL_curcop)
+	)));
     }
-    SETs(*sv);
     RETURN;
 }
 
@@ -342,8 +354,7 @@
 
 	LvTYPE(TARG) = '.';
 	if (LvTARG(TARG) != sv) {
-	    if (LvTARG(TARG))
-		SvREFCNT_dec(LvTARG(TARG));
+	    SvREFCNT_dec(LvTARG(TARG));
 	    LvTARG(TARG) = SvREFCNT_inc_simple(sv);
 	}
 	PUSHs(TARG);	/* no SvSETMAGIC */
@@ -422,6 +433,10 @@
 		    ret = newSVpvs_flags("_;$", SVs_TEMP);
 		    goto set;
 		}
+		if (code == -KEY_keys || code == -KEY_values || code == -KEY_each) {
+		    ret = newSVpvs_flags("\\[@%]", SVs_TEMP);
+		    goto set;
+		}
 		if (code == -KEY_readpipe) {
 		    s = "CORE::backtick";
 		}
@@ -538,7 +553,7 @@
 	SvREFCNT_inc_void_NN(sv);
     }
     rv = sv_newmortal();
-    sv_upgrade(rv, SVt_RV);
+    sv_upgrade(rv, SVt_IV);
     SvRV_set(rv, sv);
     SvROK_on(rv);
     return rv;
@@ -576,9 +591,9 @@
 	if (ssv && !SvGMAGICAL(ssv) && !SvAMAGIC(ssv) && SvROK(ssv))
 	    Perl_croak(aTHX_ "Attempt to bless into a reference");
 	ptr = SvPV_const(ssv,len);
-	if (len == 0 && ckWARN(WARN_MISC))
-	    Perl_warner(aTHX_ packWARN(WARN_MISC),
-		   "Explicit blessing to '' (assuming package main)");
+	if (len == 0)
+	    Perl_ck_warner(aTHX_ packWARN(WARN_MISC),
+			   "Explicit blessing to '' (assuming package main)");
 	stash = gv_stashpvn(ptr, len, GV_ADD);
     }
 
@@ -813,10 +828,10 @@
 	hv_undef(MUTABLE_HV(sv));
 	break;
     case SVt_PVCV:
-	if (cv_const_sv((CV*)sv) && ckWARN(WARN_MISC))
-	    Perl_warner(aTHX_ packWARN(WARN_MISC), "Constant subroutine %s undefined",
-		 CvANON((const CV *)sv) ? "(anonymous)"
-			: GvENAME(CvGV((const CV *)sv)));
+	if (cv_const_sv((const CV *)sv))
+	    Perl_ck_warner(aTHX_ packWARN(WARN_MISC), "Constant subroutine %s undefined",
+			   CvANON((const CV *)sv) ? "(anonymous)"
+			   : GvENAME(CvGV((const CV *)sv)));
 	/* FALLTHROUGH */
     case SVt_PVFM:
 	{
@@ -3030,25 +3045,36 @@
     dVAR; dSP; dTARGET;
     SV * const sv = TOPs;
 
-    if (SvAMAGIC(sv)) {
-	/* For an overloaded scalar, we can't know in advance if it's going to
-	   be UTF-8 or not. Also, we can't call sv_len_utf8 as it likes to
-	   cache the length. Maybe that should be a documented feature of it.
+    if (SvGAMAGIC(sv)) {
+	/* For an overloaded or magic scalar, we can't know in advance if
+	   it's going to be UTF-8 or not. Also, we can't call sv_len_utf8 as
+	   it likes to cache the length. Maybe that should be a documented
+	   feature of it.
 	*/
 	STRLEN len;
-	const char *const p = SvPV_const(sv, len);
+	const char *const p
+	    = sv_2pv_flags(sv, &len,
+			   SV_UNDEF_RETURNS_NULL|SV_CONST_RETURN|SV_GMAGIC);
 
-	if (DO_UTF8(sv)) {
+	if (!p) {
+	    sv_setsv(TARG, &PL_sv_undef);
+	    SETTARG;
+	}
+	else if (DO_UTF8(sv)) {
 	    SETi(utf8_length((U8*)p, (U8*)p + len));
 	}
 	else
 	    SETi(len);
-
+    } else if (SvOK(sv)) {
+	/* Neither magic nor overloaded.  */
+	if (DO_UTF8(sv))
+	    SETi(sv_len_utf8(sv));
+	else
+	    SETi(sv_len(sv));
+    } else {
+	sv_setsv_nomg(TARG, &PL_sv_undef);
+	SETTARG;
     }
-    else if (DO_UTF8(sv))
-	SETi(sv_len_utf8(sv));
-    else
-	SETi(sv_len(sv));
     RETURN;
 }
 
@@ -3056,15 +3082,19 @@
 {
     dVAR; dSP; dTARGET;
     SV *sv;
-    I32 len = 0;
     STRLEN curlen;
     STRLEN utf8_curlen;
-    I32 pos;
-    I32 rem;
-    I32 fail;
+    SV *   pos_sv;
+    IV     pos1_iv;
+    int    pos1_is_uv;
+    IV     pos2_iv;
+    int    pos2_is_uv;
+    SV *   len_sv;
+    IV     len_iv = 0;
+    int    len_is_uv = 1;
     const I32 lvalue = PL_op->op_flags & OPf_MOD || LVRET;
     const char *tmps;
-    const I32 arybase = CopARYBASE_get(PL_curcop);
+    const IV arybase = CopARYBASE_get(PL_curcop);
     SV *repl_sv = NULL;
     const char *repl = NULL;
     STRLEN repl_len;
@@ -3080,9 +3110,13 @@
 	    repl = SvPV_const(repl_sv, repl_len);
 	    repl_is_utf8 = DO_UTF8(repl_sv) && SvCUR(repl_sv);
 	}
-	len = POPi;
-    }
-    pos = POPi;
+	len_sv    = POPs;
+	len_iv    = SvIV(len_sv);
+	len_is_uv = SvIOK_UV(len_sv);
+    }
+    pos_sv     = POPs;
+    pos1_iv    = SvIV(pos_sv);
+    pos1_is_uv = SvIOK_UV(pos_sv);
     sv = POPs;
     PUTBACK;
     if (repl_sv) {
@@ -3104,52 +3138,80 @@
     else
 	utf8_curlen = 0;
 
-    if (pos >= arybase) {
-	pos -= arybase;
-	rem = curlen-pos;
-	fail = rem;
-	if (num_args > 2) {
-	    if (len < 0) {
-		rem += len;
-		if (rem < 0)
-		    rem = 0;
-	    }
-	    else if (rem > len)
-		     rem = len;
+    if ( (pos1_is_uv && arybase < 0) || (pos1_iv >= arybase) ) { /* pos >= $[ */
+	UV pos1_uv = pos1_iv-arybase;
+	/* Overflow can occur when $[ < 0 */
+	if (arybase < 0 && pos1_uv < (UV)pos1_iv)
+	    goto bound_fail;
+	pos1_iv = pos1_uv;
+	pos1_is_uv = 1;
+    }
+    else if (pos1_is_uv ? (UV)pos1_iv > 0 : pos1_iv > 0) {
+	goto bound_fail;  /* $[=3; substr($_,2,...) */
+    }
+    else { /* pos < $[ */
+	if (pos1_iv == 0) { /* $[=1; substr($_,0,...) */
+	    pos1_iv = curlen;
+	    pos1_is_uv = 1;
+	} else {
+	    if (curlen) {
+		pos1_is_uv = curlen-1 > ~(UV)pos1_iv;
+		pos1_iv += curlen;
+	   }
 	}
     }
-    else {
-	pos += curlen;
-	if (num_args < 3)
-	    rem = curlen;
-	else if (len >= 0) {
-	    rem = pos+len;
-	    if (rem > (I32)curlen)
-		rem = curlen;
+    if (pos1_is_uv || pos1_iv > 0) {
+	if ((UV)pos1_iv > curlen)
+	    goto bound_fail;
+    }
+
+    if (num_args > 2) {
+	if (!len_is_uv && len_iv < 0) {
+	    pos2_iv = curlen + len_iv;
+	    if (curlen)
+		pos2_is_uv = curlen-1 > ~(UV)len_iv;
+	    else
+		pos2_is_uv = 0;
+	} else {  /* len_iv >= 0 */
+	    if (!pos1_is_uv && pos1_iv < 0) {
+		pos2_iv = pos1_iv + len_iv;
+		pos2_is_uv = (UV)len_iv > (UV)IV_MAX;
+	    } else {
+		if ((UV)len_iv > curlen-(UV)pos1_iv)
+		    pos2_iv = curlen;
+		else
+		    pos2_iv = pos1_iv+len_iv;
+		pos2_is_uv = 1;
+	    }
 	}
-	else {
-	    rem = curlen+len;
-	    if (rem < pos)
-		rem = pos;
-	}
-	if (pos < 0)
-	    pos = 0;
-	fail = rem;
-	rem -= pos;
-    }
-    if (fail < 0) {
-	if (lvalue || repl)
-	    Perl_croak(aTHX_ "substr outside of string");
-	if (ckWARN(WARN_SUBSTR))
-	    Perl_warner(aTHX_ packWARN(WARN_SUBSTR), "substr outside of string");
-	RETPUSHUNDEF;
     }
     else {
-	const I32 upos = pos;
-	const I32 urem = rem;
-	if (utf8_curlen)
-	    sv_pos_u2b(sv, &pos, &rem);
-	tmps += pos;
+	pos2_iv = curlen;
+	pos2_is_uv = 1;
+    }
+
+    if (!pos2_is_uv && pos2_iv < 0) {
+	if (!pos1_is_uv && pos1_iv < 0)
+	    goto bound_fail;
+	pos2_iv = 0;
+    }
+    else if (!pos1_is_uv && pos1_iv < 0)
+	pos1_iv = 0;
+
+    if ((UV)pos2_iv < (UV)pos1_iv)
+	pos2_iv = pos1_iv;
+    if ((UV)pos2_iv > curlen)
+	pos2_iv = curlen;
+
+    {
+	/* pos1_iv and pos2_iv both in 0..curlen, so the cast is safe */
+	const STRLEN pos = (STRLEN)( (UV)pos1_iv );
+	const STRLEN len = (STRLEN)( (UV)pos2_iv - (UV)pos1_iv );
+	STRLEN byte_len = len;
+	STRLEN byte_pos = utf8_curlen
+	    ? sv_pos_u2b_flags(sv, pos, &byte_len, SV_CONST_RETURN) : pos;
+
+	tmps += byte_pos;
 	/* we either return a PV or an LV. If the TARG hasn't been used
 	 * before, or is of that type, reuse it; otherwise use a mortal
 	 * instead. Note that LVs can have an extended lifetime, so also
@@ -3163,7 +3225,7 @@
 	    }
 	}
 
-	sv_setpvn(TARG, tmps, rem);
+	sv_setpvn(TARG, tmps, byte_len);
 #ifdef USE_LOCALE_COLLATE
 	sv_unmagic(TARG, PERL_MAGIC_collxfrm);
 #endif
@@ -3180,19 +3242,17 @@
 	    }
 	    if (!SvOK(sv))
 		sv_setpvs(sv, "");
-	    sv_insert_flags(sv, pos, rem, repl, repl_len, 0);
+	    sv_insert_flags(sv, byte_pos, byte_len, repl, repl_len, 0);
 	    if (repl_is_utf8)
 		SvUTF8_on(sv);
-	    if (repl_sv_copy)
-		SvREFCNT_dec(repl_sv_copy);
+	    SvREFCNT_dec(repl_sv_copy);
 	}
 	else if (lvalue) {		/* it's an lvalue! */
 	    if (!SvGMAGICAL(sv)) {
 		if (SvROK(sv)) {
 		    SvPV_force_nolen(sv);
-		    if (ckWARN(WARN_SUBSTR))
-			Perl_warner(aTHX_ packWARN(WARN_SUBSTR),
-				"Attempt to use reference as lvalue in substr");
+		    Perl_ck_warner(aTHX_ packWARN(WARN_SUBSTR),
+				   "Attempt to use reference as lvalue in substr");
 		}
 		if (isGV_with_GP(sv))
 		    SvPV_force_nolen(sv);
@@ -3209,17 +3269,22 @@
 
 	    LvTYPE(TARG) = 'x';
 	    if (LvTARG(TARG) != sv) {
-		if (LvTARG(TARG))
-		    SvREFCNT_dec(LvTARG(TARG));
+		SvREFCNT_dec(LvTARG(TARG));
 		LvTARG(TARG) = SvREFCNT_inc_simple(sv);
 	    }
-	    LvTARGOFF(TARG) = upos;
-	    LvTARGLEN(TARG) = urem;
+	    LvTARGOFF(TARG) = pos;
+	    LvTARGLEN(TARG) = len;
 	}
     }
     SPAGAIN;
     PUSHs(TARG);		/* avoid SvSETMAGIC here */
     RETURN;
+
+bound_fail:
+    if (lvalue || repl)
+	Perl_croak(aTHX_ "substr outside of string");
+    Perl_ck_warner(aTHX_ packWARN(WARN_SUBSTR), "substr outside of string");
+    RETPUSHUNDEF;
 }
 
 PP(pp_vec)
@@ -3240,8 +3305,7 @@
 	}
 	LvTYPE(TARG) = 'v';
 	if (LvTARG(TARG) != src) {
-	    if (LvTARG(TARG))
-		SvREFCNT_dec(LvTARG(TARG));
+	    SvREFCNT_dec(LvTARG(TARG));
 	    LvTARG(TARG) = SvREFCNT_inc_simple(src);
 	}
 	LvTARGOFF(TARG) = offset;
@@ -3367,8 +3431,7 @@
 	if (retval > 0 && big_utf8)
 	    sv_pos_b2u(big, &retval);
     }
-    if (temp)
-	SvREFCNT_dec(temp);
+    SvREFCNT_dec(temp);
  fail:
     PUSHi(retval + arybase);
     RETURN;
@@ -3510,53 +3573,293 @@
 #else
     DIE(aTHX_
       "The crypt() function is unimplemented due to excessive paranoia.");
+    return NORMAL;
 #endif
 }
 
+/* Generally UTF-8 and UTF-EBCDIC are indistinguishable at this level.  So 
+ * most comments below say UTF-8, when in fact they mean UTF-EBCDIC as well */
+
+/* Both the characters below can be stored in two UTF-8 bytes.  In UTF-8 the max
+ * character that 2 bytes can hold is U+07FF, and in UTF-EBCDIC it is U+03FF.
+ * See http://www.unicode.org/unicode/reports/tr16 */
+#define LATIN_CAPITAL_LETTER_Y_WITH_DIAERESIS 0x0178	/* Also is title case */
+#define GREEK_CAPITAL_LETTER_MU 0x039C	/* Upper and title case of MICRON */
+
+/* Below are several macros that generate code */
+/* Generates code to store a unicode codepoint c that is known to occupy
+ * exactly two UTF-8 and UTF-EBCDIC bytes; it is stored into p and p+1. */
+#define STORE_UNI_TO_UTF8_TWO_BYTE(p, c)				    \
+    STMT_START {							    \
+	*(p) = UTF8_TWO_BYTE_HI(c);					    \
+	*((p)+1) = UTF8_TWO_BYTE_LO(c);					    \
+    } STMT_END
+
+/* Like STORE_UNI_TO_UTF8_TWO_BYTE, but advances p to point to the next
+ * available byte after the two bytes */
+#define CAT_UNI_TO_UTF8_TWO_BYTE(p, c)					    \
+    STMT_START {							    \
+	*(p)++ = UTF8_TWO_BYTE_HI(c);					    \
+	*((p)++) = UTF8_TWO_BYTE_LO(c);					    \
+    } STMT_END
+
+/* Generates code to store the upper case of latin1 character l which is known
+ * to have its upper case be non-latin1 into the two bytes p and p+1.  There
+ * are only two characters that fit this description, and this macro knows
+ * about them, and that the upper case values fit into two UTF-8 or UTF-EBCDIC
+ * bytes */
+#define STORE_NON_LATIN1_UC(p, l)					    \
+STMT_START {								    \
+    if ((l) == LATIN_SMALL_LETTER_Y_WITH_DIAERESIS) {			    \
+	STORE_UNI_TO_UTF8_TWO_BYTE((p), LATIN_CAPITAL_LETTER_Y_WITH_DIAERESIS);  \
+    } else { /* Must be the following letter */								    \
+	STORE_UNI_TO_UTF8_TWO_BYTE((p), GREEK_CAPITAL_LETTER_MU);	    \
+    }									    \
+} STMT_END
+
+/* Like STORE_NON_LATIN1_UC, but advances p to point to the next available byte
+ * after the character stored */
+#define CAT_NON_LATIN1_UC(p, l)						    \
+STMT_START {								    \
+    if ((l) == LATIN_SMALL_LETTER_Y_WITH_DIAERESIS) {			    \
+	CAT_UNI_TO_UTF8_TWO_BYTE((p), LATIN_CAPITAL_LETTER_Y_WITH_DIAERESIS);    \
+    } else {								    \
+	CAT_UNI_TO_UTF8_TWO_BYTE((p), GREEK_CAPITAL_LETTER_MU);		    \
+    }									    \
+} STMT_END
+
+/* Generates code to add the two UTF-8 bytes (probably u) that are the upper
+ * case of l into p and p+1.  u must be the result of toUPPER_LATIN1_MOD(l),
+ * and must require two bytes to store it.  Advances p to point to the next
+ * available position */
+#define CAT_TWO_BYTE_UNI_UPPER_MOD(p, l, u)				    \
+STMT_START {								    \
+    if ((u) != LATIN_SMALL_LETTER_Y_WITH_DIAERESIS) {			    \
+	CAT_UNI_TO_UTF8_TWO_BYTE((p), (u)); /* not special, just save it */ \
+    } else if (l == LATIN_SMALL_LETTER_SHARP_S) {			    \
+	*(p)++ = 'S'; *(p)++ = 'S'; /* upper case is 'SS' */		    \
+    } else {/* else is one of the other two special cases */		    \
+	CAT_NON_LATIN1_UC((p), (l));					    \
+    }									    \
+} STMT_END
+
 PP(pp_ucfirst)
 {
+    /* Actually is both lcfirst() and ucfirst().  Only the first character
+     * changes.  This means that possibly we can change in-place, ie., just
+     * take the source and change that one character and store it back, but not
+     * if read-only etc, or if the length changes */
+
     dVAR;
     dSP;
     SV *source = TOPs;
-    STRLEN slen;
+    STRLEN slen; /* slen is the byte length of the whole SV. */
     STRLEN need;
     SV *dest;
-    bool inplace = TRUE;
-    bool doing_utf8;
+    bool inplace;   /* ? Convert first char only, in-place */
+    bool doing_utf8 = FALSE;		   /* ? using utf8 */
+    bool convert_source_to_utf8 = FALSE;   /* ? need to convert */
     const int op_type = PL_op->op_type;
     const U8 *s;
     U8 *d;
     U8 tmpbuf[UTF8_MAXBYTES_CASE+1];
-    STRLEN ulen;
-    STRLEN tculen;
+    STRLEN ulen;    /* ulen is the byte length of the original Unicode character
+		     * stored as UTF-8 at s. */
+    STRLEN tculen;  /* tculen is the byte length of the freshly titlecased (or
+		     * lowercased) character stored in tmpbuf.  May be either
+		     * UTF-8 or not, but in either case is the number of bytes */
 
     SvGETMAGIC(source);
     if (SvOK(source)) {
 	s = (const U8*)SvPV_nomg_const(source, slen);
     } else {
+	if (ckWARN(WARN_UNINITIALIZED))
+	    report_uninit(source);
 	s = (const U8*)"";
 	slen = 0;
     }
 
-    if (slen && DO_UTF8(source) && UTF8_IS_START(*s)) {
+    /* We may be able to get away with changing only the first character, in
+     * place, but not if read-only, etc.  Later we may discover more reasons to
+     * not convert in-place. */
+    inplace = SvPADTMP(source) && !SvREADONLY(source) && SvTEMP(source);
+
+    /* First calculate what the changed first character should be.  This affects
+     * whether we can just swap it out, leaving the rest of the string unchanged,
+     * or even if have to convert the dest to UTF-8 when the source isn't */
+
+    if (! slen) {   /* If empty */
+	need = 1; /* still need a trailing NUL */
+    }
+    else if (DO_UTF8(source)) {	/* Is the source utf8? */
 	doing_utf8 = TRUE;
-	utf8_to_uvchr(s, &ulen);
-	if (op_type == OP_UCFIRST) {
-	    toTITLE_utf8(s, tmpbuf, &tculen);
-	} else {
-	    toLOWER_utf8(s, tmpbuf, &tculen);
+
+/* TODO: This is #ifdefd out because it has hard-coded the standard mappings,
+ * and doesn't allow for the user to specify their own.  When code is added to
+ * detect if there is a user-defined mapping in force here, and if so to use
+ * that, then the code below can be compiled.  The detection would be a good
+ * thing anyway, as currently the user-defined mappings only work on utf8
+ * strings, and thus depend on the chosen internal storage method, which is a
+ * bad thing */
+#ifdef GO_AHEAD_AND_BREAK_USER_DEFINED_CASE_MAPPINGS
+	if (UTF8_IS_INVARIANT(*s)) {
+
+	    /* An invariant source character is either ASCII or, in EBCDIC, an
+	     * ASCII equivalent or a caseless C1 control.  In both these cases,
+	     * the lower and upper cases of any character are also invariants
+	     * (and title case is the same as upper case).  So it is safe to
+	     * use the simple case change macros which avoid the overhead of
+	     * the general functions.  Note that if perl were to be extended to
+	     * do locale handling in UTF-8 strings, this wouldn't be true in,
+	     * for example, Lithuanian or Turkic.  */
+	    *tmpbuf = (op_type == OP_LCFIRST) ? toLOWER(*s) : toUPPER(*s);
+	    tculen = ulen = 1;
+	    need = slen + 1;
+	}
+	else if (UTF8_IS_DOWNGRADEABLE_START(*s)) {
+	    U8 chr;
+
+	    /* Similarly, if the source character isn't invariant but is in the
+	     * latin1 range (or EBCDIC equivalent thereof), we have the case
+	     * changes compiled into perl, and can avoid the overhead of the
+	     * general functions.  In this range, the characters are stored as
+	     * two UTF-8 bytes, and it so happens that any changed-case version
+	     * is also two bytes (in both ASCIIish and EBCDIC machines). */
+	    tculen = ulen = 2;
+	    need = slen + 1;
+
+	    /* Convert the two source bytes to a single Unicode code point
+	     * value, change case and save for below */
+	    chr = UTF8_ACCUMULATE(*s, *(s+1));
+	    if (op_type == OP_LCFIRST) {    /* lower casing is easy */
+		U8 lower = toLOWER_LATIN1(chr);
+		STORE_UNI_TO_UTF8_TWO_BYTE(tmpbuf, lower);
+	    }
+	    else {	/* ucfirst */
+		U8 upper = toUPPER_LATIN1_MOD(chr);
+
+		/* Most of the latin1 range characters are well-behaved.  Their
+		 * title and upper cases are the same, and are also in the
+		 * latin1 range.  The macro above returns their upper (hence
+		 * title) case, and all that need be done is to save the result
+		 * for below.  However, several characters are problematic, and
+		 * have to be handled specially.  The MOD in the macro name
+		 * above means that these tricky characters all get mapped to
+		 * the single character LATIN_SMALL_LETTER_Y_WITH_DIAERESIS.
+		 * This mapping saves some tests for the majority of the
+		 * characters */
+
+		if (upper != LATIN_SMALL_LETTER_Y_WITH_DIAERESIS) {
+
+		    /* Not tricky.  Just save it. */
+		    STORE_UNI_TO_UTF8_TWO_BYTE(tmpbuf, upper);
+		}
+		else if (chr == LATIN_SMALL_LETTER_SHARP_S) {
+
+		    /* This one is tricky because it is two characters long,
+		     * though the UTF-8 is still two bytes, so the stored
+		     * length doesn't change */
+		    *tmpbuf = 'S';  /* The UTF-8 is 'Ss' */
+		    *(tmpbuf + 1) = 's';
+		}
+		else {
+
+		    /* The other two have their title and upper cases the same,
+		     * but are tricky because the changed-case characters
+		     * aren't in the latin1 range.  They, however, do fit into
+		     * two UTF-8 bytes */
+		    STORE_NON_LATIN1_UC(tmpbuf, chr);    
+		}
+	    }
 	}
-	/* If the two differ, we definately cannot do inplace.  */
-	inplace = (ulen == tculen);
-	need = slen + 1 - ulen + tculen;
-    } else {
-	doing_utf8 = FALSE;
-	need = slen + 1;
+	else {
+#endif	/* end of dont want to break user-defined casing */
+
+	    /* Here, can't short-cut the general case */
+
+	    utf8_to_uvchr(s, &ulen);
+	    if (op_type == OP_UCFIRST) toTITLE_utf8(s, tmpbuf, &tculen);
+	    else toLOWER_utf8(s, tmpbuf, &tculen);
+
+	    /* we can't do in-place if the length changes.  */
+	    if (ulen != tculen) inplace = FALSE;
+	    need = slen + 1 - ulen + tculen;
+#ifdef GO_AHEAD_AND_BREAK_USER_DEFINED_CASE_MAPPINGS
+	}
+#endif
     }
+    else { /* Non-zero length, non-UTF-8,  Need to consider locale and if
+	    * latin1 is treated as caseless.  Note that a locale takes
+	    * precedence */ 
+	tculen = 1;	/* Most characters will require one byte, but this will
+			 * need to be overridden for the tricky ones */
+	need = slen + 1;
 
-    if (SvPADTMP(source) && !SvREADONLY(source) && inplace && SvTEMP(source)) {
-	/* We can convert in place.  */
+	if (op_type == OP_LCFIRST) {
 
+	    /* lower case the first letter: no trickiness for any character */
+	    *tmpbuf = (IN_LOCALE_RUNTIME) ? toLOWER_LC(*s) :
+			((IN_UNI_8_BIT) ? toLOWER_LATIN1(*s) : toLOWER(*s));
+	}
+	/* is ucfirst() */
+	else if (IN_LOCALE_RUNTIME) {
+	    *tmpbuf = toUPPER_LC(*s);	/* This would be a bug if any locales
+					 * have upper and title case different
+					 */
+	}
+	else if (! IN_UNI_8_BIT) {
+	    *tmpbuf = toUPPER(*s);	/* Returns caseless for non-ascii, or
+					 * on EBCDIC machines whatever the
+					 * native function does */
+	}
+	else { /* is ucfirst non-UTF-8, not in locale, and cased latin1 */
+	    *tmpbuf = toUPPER_LATIN1_MOD(*s);
+
+	    /* tmpbuf now has the correct title case for all latin1 characters
+	     * except for the several ones that have tricky handling.  All
+	     * of these are mapped by the MOD to the letter below. */
+	    if (*tmpbuf == LATIN_SMALL_LETTER_Y_WITH_DIAERESIS) {
+
+		/* The length is going to change, with all three of these, so
+		 * can't replace just the first character */
+		inplace = FALSE;
+
+		/* We use the original to distinguish between these tricky
+		 * cases */
+		if (*s == LATIN_SMALL_LETTER_SHARP_S) {
+		    /* Two character title case 'Ss', but can remain non-UTF-8 */
+		    need = slen + 2;
+		    *tmpbuf = 'S';
+		    *(tmpbuf + 1) = 's';   /* Assert: length(tmpbuf) >= 2 */
+		    tculen = 2;
+		}
+		else {
+
+		    /* The other two tricky ones have their title case outside
+		     * latin1.  It is the same as their upper case. */
+		    doing_utf8 = TRUE;
+		    STORE_NON_LATIN1_UC(tmpbuf, *s);
+
+		    /* The UTF-8 and UTF-EBCDIC lengths of both these characters
+		     * and their upper cases is 2. */
+		    tculen = ulen = 2;
+
+		    /* The entire result will have to be in UTF-8.  Assume worst
+		     * case sizing in conversion. (all latin1 characters occupy
+		     * at most two bytes in utf8) */
+		    convert_source_to_utf8 = TRUE;
+		    need = slen * 2 + 1;
+		}
+	    } /* End of is one of the three special chars */
+	} /* End of use Unicode (Latin1) semantics */
+    } /* End of changing the case of the first character */
+
+    /* Here, have the first character's changed case stored in tmpbuf.  Ready to
+     * generate the result */
+    if (inplace) {
+
+	/* We can convert in place.  This means we change just the first
+	 * character without disturbing the rest; no need to grow */
 	dest = source;
 	s = d = (U8*)SvPV_force_nomg(source, slen);
     } else {
@@ -3564,53 +3867,83 @@
 
 	dest = TARG;
 
+	/* Here, we can't convert in place; we earlier calculated how much
+	 * space we will need, so grow to accommodate that */
 	SvUPGRADE(dest, SVt_PV);
 	d = (U8*)SvGROW(dest, need);
 	(void)SvPOK_only(dest);
 
 	SETs(dest);
-
-	inplace = FALSE;
     }
 
     if (doing_utf8) {
-	if(!inplace) {
-	    /* slen is the byte length of the whole SV.
-	     * ulen is the byte length of the original Unicode character
-	     * stored as UTF-8 at s.
-	     * tculen is the byte length of the freshly titlecased (or
-	     * lowercased) Unicode character stored as UTF-8 at tmpbuf.
-	     * We first set the result to be the titlecased (/lowercased)
-	     * character, and then append the rest of the SV data. */
-	    sv_setpvn(dest, (char*)tmpbuf, tculen);
-	    if (slen > ulen)
-	        sv_catpvn(dest, (char*)(s + ulen), slen - ulen);
+	if (! inplace) {
+	    if (! convert_source_to_utf8) {
+
+		/* Here  both source and dest are in UTF-8, but have to create
+		 * the entire output.  We initialize the result to be the
+		 * title/lower cased first character, and then append the rest
+		 * of the string. */
+		sv_setpvn(dest, (char*)tmpbuf, tculen);
+		if (slen > ulen) {
+		    sv_catpvn(dest, (char*)(s + ulen), slen - ulen);
+		}
+	    }
+	    else {
+		const U8 *const send = s + slen;
+
+		/* Here the dest needs to be in UTF-8, but the source isn't,
+		 * except we earlier UTF-8'd the first character of the source
+		 * into tmpbuf.  First put that into dest, and then append the
+		 * rest of the source, converting it to UTF-8 as we go. */
+
+		/* Assert tculen is 2 here because the only two characters that
+		 * get to this part of the code have 2-byte UTF-8 equivalents */
+		*d++ = *tmpbuf;
+		*d++ = *(tmpbuf + 1);
+		s++;	/* We have just processed the 1st char */
+
+		for (; s < send; s++) {
+		    d = uvchr_to_utf8(d, *s);
+		}
+		*d = '\0';
+		SvCUR_set(dest, d - (U8*)SvPVX_const(dest));
+	    }
 	    SvUTF8_on(dest);
 	}
-	else {
+	else {   /* in-place UTF-8.  Just overwrite the first character */
 	    Copy(tmpbuf, d, tculen, U8);
 	    SvCUR_set(dest, need - 1);
 	}
     }
-    else {
-	if (*s) {
+    else {  /* Neither source nor dest are in or need to be UTF-8 */
+	if (slen) {
 	    if (IN_LOCALE_RUNTIME) {
 		TAINT;
 		SvTAINTED_on(dest);
-		*d = (op_type == OP_UCFIRST)
-		    ? toUPPER_LC(*s) : toLOWER_LC(*s);
 	    }
-	    else
-		*d = (op_type == OP_UCFIRST) ? toUPPER(*s) : toLOWER(*s);
-	} else {
-	    /* See bug #39028  */
+	    if (inplace) {  /* in-place, only need to change the 1st char */
+		*d = *tmpbuf;
+	    }
+	    else {	/* Not in-place */
+
+		/* Copy the case-changed character(s) from tmpbuf */
+		Copy(tmpbuf, d, tculen, U8);
+		d += tculen - 1; /* Code below expects d to point to final
+				  * character stored */
+	    }
+	}
+	else {	/* empty source */
+	    /* See bug #39028: Don't taint if empty  */
 	    *d = *s;
 	}
 
+	/* In a "use bytes" we don't treat the source as UTF-8, but, still want
+	 * the destination to retain that flag */
 	if (SvUTF8(source))
 	    SvUTF8_on(dest);
 
-	if (!inplace) {
+	if (!inplace) {	/* Finish the rest of the string, unchanged */
 	    /* This will copy the trailing NUL  */
 	    Copy(s + 1, d + 1, slen, U8);
 	    SvCUR_set(dest, need - 1);
@@ -3622,7 +3955,7 @@
 
 /* There's so much setup/teardown code common between uc and lc, I wonder if
    it would be worth merging the two, and just having a switch outside each
-   of the three tight loops.  */
+   of the three tight loops.  There is less and less commonality though */
 PP(pp_uc)
 {
     dVAR;
@@ -3637,9 +3970,16 @@
     SvGETMAGIC(source);
 
     if (SvPADTMP(source) && !SvREADONLY(source) && !SvAMAGIC(source)
-	&& SvTEMP(source) && !DO_UTF8(source)) {
-	/* We can convert in place.  */
+	&& SvTEMP(source) && !DO_UTF8(source)
+	&& (IN_LOCALE_RUNTIME || ! IN_UNI_8_BIT)) {
 
+	/* We can convert in place.  The reason we can't if in UNI_8_BIT is to
+	 * make the loop tight, so we overwrite the source with the dest before
+	 * looking at it, and we need to look at the original source
+	 * afterwards.  There would also need to be code added to handle
+	 * switching to not in-place in midstream if we run into characters
+	 * that change the length.
+	 */
 	dest = source;
 	s = d = (U8*)SvPV_force_nomg(source, len);
 	min = len + 1;
@@ -3658,6 +3998,8 @@
 	if (SvOK(source)) {
 	    s = (const U8*)SvPV_nomg_const(source, len);
 	} else {
+	    if (ckWARN(WARN_UNINITIALIZED))
+		report_uninit(source);
 	    s = (const U8*)"";
 	    len = 0;
 	}
@@ -3677,48 +4019,209 @@
 	const U8 *const send = s + len;
 	U8 tmpbuf[UTF8_MAXBYTES+1];
 
+/* This is ifdefd out because it needs more work and thought.  It isn't clear
+ * that we should do it.  These are hard-coded rules from the Unicode standard,
+ * and may change.  5.2 gives new guidance on the iota subscript, for example,
+ * which has not been checked against this; and secondly it may be that we are
+ * passed a subset of the context, via a \U...\E, for example, and its not
+ * clear what the best approach is to that */
+#ifdef CONTEXT_DEPENDENT_CASING
+	bool in_iota_subscript = FALSE;
+#endif
+
 	while (s < send) {
-	    const STRLEN u = UTF8SKIP(s);
-	    STRLEN ulen;
+#ifdef CONTEXT_DEPENDENT_CASING
+	    if (in_iota_subscript && ! is_utf8_mark(s)) {
+		/* A non-mark.  Time to output the iota subscript */
+#define GREEK_CAPITAL_LETTER_IOTA 0x0399
+#define COMBINING_GREEK_YPOGEGRAMMENI 0x0345
+
+		CAT_UNI_TO_UTF8_TWO_BYTE(d, GREEK_CAPITAL_LETTER_IOTA);
+		in_iota_subscript = FALSE;
+	    }
+#endif
+
+
+/* See comments at the first instance in this file of this ifdef */
+#ifdef GO_AHEAD_AND_BREAK_USER_DEFINED_CASE_MAPPINGS
+
+	    /* If the UTF-8 character is invariant, then it is in the range
+	     * known by the standard macro; result is only one byte long */
+	    if (UTF8_IS_INVARIANT(*s)) {
+		*d++ = toUPPER(*s);
+		s++;
+	    }
+	    else if (UTF8_IS_DOWNGRADEABLE_START(*s)) {
+
+		/* Likewise, if it fits in a byte, its case change is in our
+		 * table */
+		U8 orig = UTF8_ACCUMULATE(*s, *(s+1));
+		U8 upper = toUPPER_LATIN1_MOD(orig);
+		CAT_TWO_BYTE_UNI_UPPER_MOD(d, orig, upper);
+		s += 2;
+	    }
+	    else {
+#else
+	    {
+#endif
+
+		/* Otherwise, need the general UTF-8 case.  Get the changed
+		 * case value and copy it to the output buffer */
+
+		const STRLEN u = UTF8SKIP(s);
+		STRLEN ulen;
 
-	    toUPPER_utf8(s, tmpbuf, &ulen);
-	    if (ulen > u && (SvLEN(dest) < (min += ulen - u))) {
-		/* If the eventually required minimum size outgrows
-		 * the available space, we need to grow. */
-		const UV o = d - (U8*)SvPVX_const(dest);
-
-		/* If someone uppercases one million U+03B0s we SvGROW() one
-		 * million times.  Or we could try guessing how much to
-		 allocate without allocating too much.  Such is life. */
-		SvGROW(dest, min);
-		d = (U8*)SvPVX(dest) + o;
-	    }
-	    Copy(tmpbuf, d, ulen, U8);
-	    d += ulen;
-	    s += u;
+#ifndef CONTEXT_DEPENDENT_CASING
+		toUPPER_utf8(s, tmpbuf, &ulen);
+#else
+		const UV uv = toUPPER_utf8(s, tmpbuf, &ulen);
+		if (uv == GREEK_CAPITAL_LETTER_IOTA && utf8_to_uvchr(s, 0) == COMBINING_GREEK_YPOGEGRAMMENI) {
+		    in_iota_subscript = TRUE;
+		}
+		else {
+#endif
+		    if (ulen > u && (SvLEN(dest) < (min += ulen - u))) {
+			/* If the eventually required minimum size outgrows
+			 * the available space, we need to grow. */
+			const UV o = d - (U8*)SvPVX_const(dest);
+
+			/* If someone uppercases one million U+03B0s we
+			 * SvGROW() one million times.  Or we could try
+			 * guessing how much to allocate without allocating too
+			 * much.  Such is life.  See corresponding comment in lc code
+			 * for another option */
+			SvGROW(dest, min);
+			d = (U8*)SvPVX(dest) + o;
+		    }
+		    Copy(tmpbuf, d, ulen, U8);
+		    d += ulen;
+#ifdef CONTEXT_DEPENDENT_CASING
+		}
+#endif
+		s += u;
+	    }
 	}
+#ifdef CONTEXT_DEPENDENT_CASING
+	if (in_iota_subscript) CAT_UNI_TO_UTF8_TWO_BYTE(d, GREEK_CAPITAL_LETTER_IOTA);
+#endif
 	SvUTF8_on(dest);
 	*d = '\0';
 	SvCUR_set(dest, d - (U8*)SvPVX_const(dest));
-    } else {
+    } else {	/* Not UTF-8 */
 	if (len) {
 	    const U8 *const send = s + len;
+
+	    /* Use locale casing if in locale; regular style if not treating
+	     * latin1 as having case; otherwise the latin1 casing.  Do the
+	     * whole thing in a tight loop, for speed, */
 	    if (IN_LOCALE_RUNTIME) {
 		TAINT;
 		SvTAINTED_on(dest);
 		for (; s < send; d++, s++)
 		    *d = toUPPER_LC(*s);
 	    }
-	    else {
-		for (; s < send; d++, s++)
+	    else if (! IN_UNI_8_BIT) {
+		for (; s < send; d++, s++) {
 		    *d = toUPPER(*s);
+		}
 	    }
-	}
+	    else {
+		for (; s < send; d++, s++) {
+		    *d = toUPPER_LATIN1_MOD(*s);
+		    if (*d != LATIN_SMALL_LETTER_Y_WITH_DIAERESIS) continue;
+
+		    /* The mainstream case is the tight loop above.  To avoid
+		     * extra tests in that, all three characters that require
+		     * special handling are mapped by the MOD to the one tested
+		     * just above.  
+		     * Use the source to distinguish between the three cases */
+
+		    if (*s == LATIN_SMALL_LETTER_SHARP_S) {
+
+			/* uc() of this requires 2 characters, but they are
+			 * ASCII.  If not enough room, grow the string */
+			if (SvLEN(dest) < ++min) {	
+			    const UV o = d - (U8*)SvPVX_const(dest);
+			    SvGROW(dest, min);
+			    d = (U8*)SvPVX(dest) + o;
+			}
+			*d++ = 'S'; *d = 'S'; /* upper case is 'SS' */
+			continue;   /* Back to the tight loop; still in ASCII */
+		    }
+
+		    /* The other two special handling characters have their
+		     * upper cases outside the latin1 range, hence need to be
+		     * in UTF-8, so the whole result needs to be in UTF-8.  So,
+		     * here we are somewhere in the middle of processing a
+		     * non-UTF-8 string, and realize that we will have to convert
+		     * the whole thing to UTF-8.  What to do?  There are
+		     * several possibilities.  The simplest to code is to
+		     * convert what we have so far, set a flag, and continue on
+		     * in the loop.  The flag would be tested each time through
+		     * the loop, and if set, the next character would be
+		     * converted to UTF-8 and stored.  But, I (khw) didn't want
+		     * to slow down the mainstream case at all for this fairly
+		     * rare case, so I didn't want to add a test that didn't
+		     * absolutely have to be there in the loop, besides the
+		     * possibility that it would get too complicated for
+		     * optimizers to deal with.  Another possibility is to just
+		     * give up, convert the source to UTF-8, and restart the
+		     * function that way.  Another possibility is to convert
+		     * both what has already been processed and what is yet to
+		     * come separately to UTF-8, then jump into the loop that
+		     * handles UTF-8.  But the most efficient time-wise of the
+		     * ones I could think of is what follows, and turned out to
+		     * not require much extra code.  */
+
+		    /* Convert what we have so far into UTF-8, telling the
+		     * function that we know it should be converted, and to
+		     * allow extra space for what we haven't processed yet.
+		     * Assume the worst case space requirements for converting
+		     * what we haven't processed so far: that it will require
+		     * two bytes for each remaining source character, plus the
+		     * NUL at the end.  This may cause the string pointer to
+		     * move, so re-find it. */
+
+		    len = d - (U8*)SvPVX_const(dest);
+		    SvCUR_set(dest, len);
+		    len = sv_utf8_upgrade_flags_grow(dest,
+						SV_GMAGIC|SV_FORCE_UTF8_UPGRADE,
+						(send -s) * 2 + 1);
+		    d = (U8*)SvPVX(dest) + len;
+
+		    /* And append the current character's upper case in UTF-8 */
+		    CAT_NON_LATIN1_UC(d, *s);
+
+		    /* Now process the remainder of the source, converting to
+		     * upper and UTF-8.  If a resulting byte is invariant in
+		     * UTF-8, output it as-is, otherwise convert to UTF-8 and
+		     * append it to the output. */
+
+		    s++;
+		    for (; s < send; s++) {
+			U8 upper = toUPPER_LATIN1_MOD(*s);
+			if UTF8_IS_INVARIANT(upper) {
+			    *d++ = upper;
+			}
+			else {
+			    CAT_TWO_BYTE_UNI_UPPER_MOD(d, *s, upper);
+			}
+		    }
+
+		    /* Here have processed the whole source; no need to continue
+		     * with the outer loop.  Each character has been converted
+		     * to upper case and converted to UTF-8 */
+
+		    break;
+		} /* End of processing all latin1-style chars */
+	    } /* End of processing all chars */
+	} /* End of source is not empty */
+
 	if (source != dest) {
-	    *d = '\0';
+	    *d = '\0';  /* Here d points to 1 after last char, add NUL */
 	    SvCUR_set(dest, d - (U8*)SvPVX_const(dest));
 	}
-    }
+    } /* End of isn't utf8 */
     SvSETMAGIC(dest);
     RETURN;
 }
@@ -3738,8 +4241,9 @@
 
     if (SvPADTMP(source) && !SvREADONLY(source) && !SvAMAGIC(source)
 	&& SvTEMP(source) && !DO_UTF8(source)) {
-	/* We can convert in place.  */
 
+	/* We can convert in place, as lowercasing anything in the latin1 range
+	 * (or else DO_UTF8 would have been on) doesn't lengthen it */
 	dest = source;
 	s = d = (U8*)SvPV_force_nomg(source, len);
 	min = len + 1;
@@ -3758,6 +4262,8 @@
 	if (SvOK(source)) {
 	    s = (const U8*)SvPV_nomg_const(source, len);
 	} else {
+	    if (ckWARN(WARN_UNINITIALIZED))
+		report_uninit(source);
 	    s = (const U8*)"";
 	    len = 0;
 	}
@@ -3778,56 +4284,148 @@
 	U8 tmpbuf[UTF8_MAXBYTES_CASE+1];
 
 	while (s < send) {
-	    const STRLEN u = UTF8SKIP(s);
-	    STRLEN ulen;
-	    const UV uv = toLOWER_utf8(s, tmpbuf, &ulen);
+/* See comments at the first instance in this file of this ifdef */
+#ifdef GO_AHEAD_AND_BREAK_USER_DEFINED_CASE_MAPPINGS
+	    if (UTF8_IS_INVARIANT(*s)) {
 
-#define GREEK_CAPITAL_LETTER_SIGMA 0x03A3 /* Unicode U+03A3 */
-	    if (uv == GREEK_CAPITAL_LETTER_SIGMA) {
-		NOOP;
-		/*
-		 * Now if the sigma is NOT followed by
-		 * /$ignorable_sequence$cased_letter/;
-		 * and it IS preceded by /$cased_letter$ignorable_sequence/;
-		 * where $ignorable_sequence is [\x{2010}\x{AD}\p{Mn}]*
-		 * and $cased_letter is [\p{Ll}\p{Lo}\p{Lt}]
-		 * then it should be mapped to 0x03C2,
-		 * (GREEK SMALL LETTER FINAL SIGMA),
-		 * instead of staying 0x03A3.
-		 * "should be": in other words, this is not implemented yet.
-		 * See lib/unicore/SpecialCasing.txt.
+		/* Invariant characters use the standard mappings compiled in.
 		 */
+		*d++ = toLOWER(*s);
+		s++;
 	    }
-	    if (ulen > u && (SvLEN(dest) < (min += ulen - u))) {
-		/* If the eventually required minimum size outgrows
-		 * the available space, we need to grow. */
-		const UV o = d - (U8*)SvPVX_const(dest);
-
-		/* If someone lowercases one million U+0130s we SvGROW() one
-		 * million times.  Or we could try guessing how much to
-		 allocate without allocating too much.  Such is life. */
-		SvGROW(dest, min);
-		d = (U8*)SvPVX(dest) + o;
-	    }
-	    Copy(tmpbuf, d, ulen, U8);
-	    d += ulen;
-	    s += u;
-	}
+	    else if (UTF8_IS_DOWNGRADEABLE_START(*s)) {
+
+		/* As do the ones in the Latin1 range */
+		U8 lower = toLOWER_LATIN1(UTF8_ACCUMULATE(*s, *(s+1)));
+		CAT_UNI_TO_UTF8_TWO_BYTE(d, lower);
+		s += 2;
+	    }
+	    else {
+#endif
+		/* Here, is utf8 not in Latin-1 range, have to go out and get
+		 * the mappings from the tables. */
+
+		const STRLEN u = UTF8SKIP(s);
+		STRLEN ulen;
+
+/* See comments at the first instance in this file of this ifdef */
+#ifndef CONTEXT_DEPENDENT_CASING
+		toLOWER_utf8(s, tmpbuf, &ulen);
+#else
+		/* Here is context dependent casing, not compiled in currently;
+		 * needs more thought and work */
+
+		const UV uv = toLOWER_utf8(s, tmpbuf, &ulen);
+
+		/* If the lower case is a small sigma, it may be that we need
+		 * to change it to a final sigma.  This happens at the end of 
+		 * a word that contains more than just this character, and only
+		 * when we started with a capital sigma. */
+		if (uv == UNICODE_GREEK_SMALL_LETTER_SIGMA &&
+		    s > send - len &&	/* Makes sure not the first letter */
+		    utf8_to_uvchr(s, 0) == UNICODE_GREEK_CAPITAL_LETTER_SIGMA
+		) {
+
+		    /* We use the algorithm in:
+		     * http://www.unicode.org/versions/Unicode5.0.0/ch03.pdf (C
+		     * is a CAPITAL SIGMA): If C is preceded by a sequence
+		     * consisting of a cased letter and a case-ignorable
+		     * sequence, and C is not followed by a sequence consisting
+		     * of a case ignorable sequence and then a cased letter,
+		     * then when lowercasing C, C becomes a final sigma */
+
+		    /* To determine if this is the end of a word, need to peek
+		     * ahead.  Look at the next character */
+		    const U8 *peek = s + u;
+
+		    /* Skip any case ignorable characters */
+		    while (peek < send && is_utf8_case_ignorable(peek)) {
+			peek += UTF8SKIP(peek);
+		    }
+
+		    /* If we reached the end of the string without finding any
+		     * non-case ignorable characters, or if the next such one
+		     * is not-cased, then we have met the conditions for it
+		     * being a final sigma with regards to peek ahead, and so
+		     * must do peek behind for the remaining conditions. (We
+		     * know there is stuff behind to look at since we tested
+		     * above that this isn't the first letter) */
+		    if (peek >= send || ! is_utf8_cased(peek)) {
+			peek = utf8_hop(s, -1);
+
+			/* Here are at the beginning of the first character
+			 * before the original upper case sigma.  Keep backing
+			 * up, skipping any case ignorable characters */
+			while (is_utf8_case_ignorable(peek)) {
+			    peek = utf8_hop(peek, -1);
+			}
+
+			/* Here peek points to the first byte of the closest
+			 * non-case-ignorable character before the capital
+			 * sigma.  If it is cased, then by the Unicode
+			 * algorithm, we should use a small final sigma instead
+			 * of what we have */
+			if (is_utf8_cased(peek)) {
+			    STORE_UNI_TO_UTF8_TWO_BYTE(tmpbuf,
+					UNICODE_GREEK_SMALL_LETTER_FINAL_SIGMA);
+			}
+		    }
+		}
+		else {	/* Not a context sensitive mapping */
+#endif	/* End of commented out context sensitive */
+		    if (ulen > u && (SvLEN(dest) < (min += ulen - u))) {
+
+			/* If the eventually required minimum size outgrows
+			 * the available space, we need to grow. */
+			const UV o = d - (U8*)SvPVX_const(dest);
+
+			/* If someone lowercases one million U+0130s we
+			 * SvGROW() one million times.  Or we could try
+			 * guessing how much to allocate without allocating too
+			 * much.  Such is life.  Another option would be to
+			 * grow an extra byte or two more each time we need to
+			 * grow, which would cut down the million to 500K, with
+			 * little waste */
+			SvGROW(dest, min);
+			d = (U8*)SvPVX(dest) + o;
+		    }
+#ifdef CONTEXT_DEPENDENT_CASING
+		}
+#endif
+		/* Copy the newly lowercased letter to the output buffer we're
+		 * building */
+		Copy(tmpbuf, d, ulen, U8);
+		d += ulen;
+		s += u;
+#ifdef GO_AHEAD_AND_BREAK_USER_DEFINED_CASE_MAPPINGS
+	    }
+#endif
+	}   /* End of looping through the source string */
 	SvUTF8_on(dest);
 	*d = '\0';
 	SvCUR_set(dest, d - (U8*)SvPVX_const(dest));
-    } else {
+    } else {	/* Not utf8 */
 	if (len) {
 	    const U8 *const send = s + len;
+
+	    /* Use locale casing if in locale; regular style if not treating
+	     * latin1 as having case; otherwise the latin1 casing.  Do the
+	     * whole thing in a tight loop, for speed, */
 	    if (IN_LOCALE_RUNTIME) {
 		TAINT;
 		SvTAINTED_on(dest);
 		for (; s < send; d++, s++)
 		    *d = toLOWER_LC(*s);
 	    }
-	    else {
-		for (; s < send; d++, s++)
+	    else if (! IN_UNI_8_BIT) {
+		for (; s < send; d++, s++) {
 		    *d = toLOWER(*s);
+		}
+	    }
+	    else {
+		for (; s < send; d++, s++) {
+		    *d = toLOWER_LATIN1(*s);
+		}
 	    }
 	}
 	if (source != dest) {
@@ -3898,7 +4496,17 @@
 
     if (SvTYPE(av) == SVt_PVAV) {
 	const I32 arybase = CopARYBASE_get(PL_curcop);
-	if (lval && PL_op->op_private & OPpLVAL_INTRO) {
+	const bool localizing = PL_op->op_private & OPpLVAL_INTRO;
+	bool can_preserve = FALSE;
+
+	if (localizing) {
+	    MAGIC *mg;
+	    HV *stash;
+
+	    can_preserve = SvCANEXISTDELETE(av);
+	}
+
+	if (lval && localizing) {
 	    register SV **svp;
 	    I32 max = -1;
 	    for (svp = MARK + 1; svp <= SP; svp++) {
@@ -3909,18 +4517,32 @@
 	    if (max > AvMAX(av))
 		av_extend(av, max);
 	}
+
 	while (++MARK <= SP) {
 	    register SV **svp;
 	    I32 elem = SvIV(*MARK);
+	    bool preeminent = TRUE;
 
 	    if (elem > 0)
 		elem -= arybase;
+	    if (localizing && can_preserve) {
+		/* If we can determine whether the element exist,
+		 * Try to preserve the existenceness of a tied array
+		 * element by using EXISTS and DELETE if possible.
+		 * Fallback to FETCH and STORE otherwise. */
+		preeminent = av_exists(av, elem);
+	    }
+
 	    svp = av_fetch(av, elem, lval);
 	    if (lval) {
 		if (!svp || *svp == &PL_sv_undef)
 		    DIE(aTHX_ PL_no_aelem, elem);
-		if (PL_op->op_private & OPpLVAL_INTRO)
-		    save_aelem(av, elem, svp);
+		if (localizing) {
+		    if (preeminent)
+			save_aelem(av, elem, svp);
+		    else
+			SAVEADELETE(av, elem);
+		}
 	    }
 	    *MARK = svp ? *svp : &PL_sv_undef;
 	}
@@ -3933,6 +4555,67 @@
     RETURN;
 }
 
+PP(pp_aeach)
+{
+    dVAR;
+    dSP;
+    AV *array = MUTABLE_AV(POPs);
+    const I32 gimme = GIMME_V;
+    IV *iterp = Perl_av_iter_p(aTHX_ array);
+    const IV current = (*iterp)++;
+
+    if (current > av_len(array)) {
+	*iterp = 0;
+	if (gimme == G_SCALAR)
+	    RETPUSHUNDEF;
+	else
+	    RETURN;
+    }
+
+    EXTEND(SP, 2);
+    mPUSHi(CopARYBASE_get(PL_curcop) + current);
+    if (gimme == G_ARRAY) {
+	SV **const element = av_fetch(array, current, 0);
+        PUSHs(element ? *element : &PL_sv_undef);
+    }
+    RETURN;
+}
+
+PP(pp_akeys)
+{
+    dVAR;
+    dSP;
+    AV *array = MUTABLE_AV(POPs);
+    const I32 gimme = GIMME_V;
+
+    *Perl_av_iter_p(aTHX_ array) = 0;
+
+    if (gimme == G_SCALAR) {
+	dTARGET;
+	PUSHi(av_len(array) + 1);
+    }
+    else if (gimme == G_ARRAY) {
+        IV n = Perl_av_len(aTHX_ array);
+        IV i = CopARYBASE_get(PL_curcop);
+
+        EXTEND(SP, n + 1);
+
+	if (PL_op->op_type == OP_AKEYS) {
+	    n += i;
+	    for (;  i <= n;  i++) {
+		mPUSHi(i);
+	    }
+	}
+	else {
+	    for (i = 0;  i <= n;  i++) {
+		SV *const *const elem = Perl_av_fetch(aTHX_ array, i, 0);
+		PUSHs(elem ? *elem : &PL_sv_undef);
+	    }
+	}
+    }
+    RETURN;
+}
+
 /* Associative arrays. */
 
 PP(pp_each)
@@ -3967,12 +4650,195 @@
     RETURN;
 }
 
-PP(pp_delete)
+STATIC OP *
+S_do_delete_local(pTHX)
 {
     dVAR;
     dSP;
     const I32 gimme = GIMME_V;
-    const I32 discard = (gimme == G_VOID) ? G_DISCARD : 0;
+    const MAGIC *mg;
+    HV *stash;
+
+    if (PL_op->op_private & OPpSLICE) {
+	dMARK; dORIGMARK;
+	SV * const osv = POPs;
+	const bool tied = SvRMAGICAL(osv)
+			    && mg_find((const SV *)osv, PERL_MAGIC_tied);
+	const bool can_preserve = SvCANEXISTDELETE(osv)
+				    || mg_find((const SV *)osv, PERL_MAGIC_env);
+	const U32 type = SvTYPE(osv);
+	if (type == SVt_PVHV) {			/* hash element */
+	    HV * const hv = MUTABLE_HV(osv);
+	    while (++MARK <= SP) {
+		SV * const keysv = *MARK;
+		SV *sv = NULL;
+		bool preeminent = TRUE;
+		if (can_preserve)
+		    preeminent = hv_exists_ent(hv, keysv, 0);
+		if (tied) {
+		    HE *he = hv_fetch_ent(hv, keysv, 1, 0);
+		    if (he)
+			sv = HeVAL(he);
+		    else
+			preeminent = FALSE;
+		}
+		else {
+		    sv = hv_delete_ent(hv, keysv, 0, 0);
+		    SvREFCNT_inc_simple_void(sv); /* De-mortalize */
+		}
+		if (preeminent) {
+		    save_helem_flags(hv, keysv, &sv, SAVEf_KEEPOLDELEM);
+		    if (tied) {
+			*MARK = sv_mortalcopy(sv);
+			mg_clear(sv);
+		    } else
+			*MARK = sv;
+		}
+		else {
+		    SAVEHDELETE(hv, keysv);
+		    *MARK = &PL_sv_undef;
+		}
+	    }
+	}
+	else if (type == SVt_PVAV) {                  /* array element */
+	    if (PL_op->op_flags & OPf_SPECIAL) {
+		AV * const av = MUTABLE_AV(osv);
+		while (++MARK <= SP) {
+		    I32 idx = SvIV(*MARK);
+		    SV *sv = NULL;
+		    bool preeminent = TRUE;
+		    if (can_preserve)
+			preeminent = av_exists(av, idx);
+		    if (tied) {
+			SV **svp = av_fetch(av, idx, 1);
+			if (svp)
+			    sv = *svp;
+			else
+			    preeminent = FALSE;
+		    }
+		    else {
+			sv = av_delete(av, idx, 0);
+		        SvREFCNT_inc_simple_void(sv); /* De-mortalize */
+		    }
+		    if (preeminent) {
+		        save_aelem_flags(av, idx, &sv, SAVEf_KEEPOLDELEM);
+			if (tied) {
+			    *MARK = sv_mortalcopy(sv);
+			    mg_clear(sv);
+			} else
+			    *MARK = sv;
+		    }
+		    else {
+		        SAVEADELETE(av, idx);
+		        *MARK = &PL_sv_undef;
+		    }
+		}
+	    }
+	}
+	else
+	    DIE(aTHX_ "Not a HASH reference");
+	if (gimme == G_VOID)
+	    SP = ORIGMARK;
+	else if (gimme == G_SCALAR) {
+	    MARK = ORIGMARK;
+	    if (SP > MARK)
+		*++MARK = *SP;
+	    else
+		*++MARK = &PL_sv_undef;
+	    SP = MARK;
+	}
+    }
+    else {
+	SV * const keysv = POPs;
+	SV * const osv   = POPs;
+	const bool tied = SvRMAGICAL(osv)
+			    && mg_find((const SV *)osv, PERL_MAGIC_tied);
+	const bool can_preserve = SvCANEXISTDELETE(osv)
+				    || mg_find((const SV *)osv, PERL_MAGIC_env);
+	const U32 type = SvTYPE(osv);
+	SV *sv = NULL;
+	if (type == SVt_PVHV) {
+	    HV * const hv = MUTABLE_HV(osv);
+	    bool preeminent = TRUE;
+	    if (can_preserve)
+		preeminent = hv_exists_ent(hv, keysv, 0);
+	    if (tied) {
+		HE *he = hv_fetch_ent(hv, keysv, 1, 0);
+		if (he)
+		    sv = HeVAL(he);
+		else
+		    preeminent = FALSE;
+	    }
+	    else {
+		sv = hv_delete_ent(hv, keysv, 0, 0);
+		SvREFCNT_inc_simple_void(sv); /* De-mortalize */
+	    }
+	    if (preeminent) {
+		save_helem_flags(hv, keysv, &sv, SAVEf_KEEPOLDELEM);
+		if (tied) {
+		    SV *nsv = sv_mortalcopy(sv);
+		    mg_clear(sv);
+		    sv = nsv;
+		}
+	    }
+	    else
+		SAVEHDELETE(hv, keysv);
+	}
+	else if (type == SVt_PVAV) {
+	    if (PL_op->op_flags & OPf_SPECIAL) {
+		AV * const av = MUTABLE_AV(osv);
+		I32 idx = SvIV(keysv);
+		bool preeminent = TRUE;
+		if (can_preserve)
+		    preeminent = av_exists(av, idx);
+		if (tied) {
+		    SV **svp = av_fetch(av, idx, 1);
+		    if (svp)
+			sv = *svp;
+		    else
+			preeminent = FALSE;
+		}
+		else {
+		    sv = av_delete(av, idx, 0);
+		    SvREFCNT_inc_simple_void(sv); /* De-mortalize */
+		}
+		if (preeminent) {
+		    save_aelem_flags(av, idx, &sv, SAVEf_KEEPOLDELEM);
+		    if (tied) {
+			SV *nsv = sv_mortalcopy(sv);
+			mg_clear(sv);
+			sv = nsv;
+		    }
+		}
+		else
+		    SAVEADELETE(av, idx);
+	    }
+	    else
+		DIE(aTHX_ "panic: avhv_delete no longer supported");
+	}
+	else
+	    DIE(aTHX_ "Not a HASH reference");
+	if (!sv)
+	    sv = &PL_sv_undef;
+	if (gimme != G_VOID)
+	    PUSHs(sv);
+    }
+
+    RETURN;
+}
+
+PP(pp_delete)
+{
+    dVAR;
+    dSP;
+    I32 gimme;
+    I32 discard;
+
+    if (PL_op->op_private & OPpLVAL_INTRO)
+	return do_delete_local();
+
+    gimme = GIMME_V;
+    discard = (gimme == G_VOID) ? G_DISCARD : 0;
 
     if (PL_op->op_private & OPpSLICE) {
 	dMARK; dORIGMARK;
@@ -4008,7 +4874,7 @@
     else {
 	SV *keysv = POPs;
 	HV * const hv = MUTABLE_HV(POPs);
-	SV *sv;
+	SV *sv = NULL;
 	if (SvTYPE(hv) == SVt_PVHV)
 	    sv = hv_delete_ent(hv, keysv, discard, 0);
 	else if (SvTYPE(hv) == SVt_PVAV) {
@@ -4068,31 +4934,28 @@
     register HV * const hv = MUTABLE_HV(POPs);
     register const I32 lval = (PL_op->op_flags & OPf_MOD || LVRET);
     const bool localizing = PL_op->op_private & OPpLVAL_INTRO;
-    bool other_magic = FALSE;
+    bool can_preserve = FALSE;
 
     if (localizing) {
         MAGIC *mg;
         HV *stash;
 
-        other_magic = mg_find((const SV *)hv, PERL_MAGIC_env) ||
-            ((mg = mg_find((const SV *)hv, PERL_MAGIC_tied))
-             /* Try to preserve the existenceness of a tied hash
-              * element by using EXISTS and DELETE if possible.
-              * Fallback to FETCH and STORE otherwise */
-             && (stash = SvSTASH(SvRV(SvTIED_obj(MUTABLE_SV(hv), mg))))
-             && gv_fetchmethod_autoload(stash, "EXISTS", TRUE)
-             && gv_fetchmethod_autoload(stash, "DELETE", TRUE));
+	if (SvCANEXISTDELETE(hv) || mg_find((const SV *)hv, PERL_MAGIC_env))
+	    can_preserve = TRUE;
     }
 
     while (++MARK <= SP) {
         SV * const keysv = *MARK;
         SV **svp;
         HE *he;
-        bool preeminent = FALSE;
+        bool preeminent = TRUE;
 
-        if (localizing) {
-            preeminent = SvRMAGICAL(hv) && !other_magic ? 1 :
-                hv_exists_ent(hv, keysv, 0);
+        if (localizing && can_preserve) {
+	    /* If we can determine whether the element exist,
+             * try to preserve the existenceness of a tied hash
+             * element by using EXISTS and DELETE if possible.
+             * Fallback to FETCH and STORE otherwise. */
+            preeminent = hv_exists_ent(hv, keysv, 0);
         }
 
         he = hv_fetch_ent(hv, keysv, lval, 0);
@@ -4105,16 +4968,11 @@
             if (localizing) {
 		if (HvNAME_get(hv) && isGV(*svp))
 		    save_gp(MUTABLE_GV(*svp), !(PL_op->op_flags & OPf_SPECIAL));
-		else {
-		    if (preeminent)
-			save_helem(hv, keysv, svp);
-		    else {
-			STRLEN keylen;
-			const char * const key = SvPV_const(keysv, keylen);
-			SAVEDELETE(hv, savepvn(key,keylen),
-				   SvUTF8(keysv) ? -(I32)keylen : (I32)keylen);
-		    }
-		}
+		else if (preeminent)
+		    save_helem_flags(hv, keysv, svp,
+			 (PL_op->op_flags & OPf_SPECIAL) ? 0 : SAVEf_SETMAGIC);
+		else
+		    SAVEHDELETE(hv, keysv);
             }
         }
         *MARK = svp ? *svp : &PL_sv_undef;
@@ -4217,8 +5075,8 @@
 	SV * const val = newSV(0);
 	if (MARK < SP)
 	    sv_setsv(val, *++MARK);
-	else if (ckWARN(WARN_MISC))
-	    Perl_warner(aTHX_ packWARN(WARN_MISC), "Odd number of elements in anonymous hash");
+	else
+	    Perl_ck_warner(aTHX_ packWARN(WARN_MISC), "Odd number of elements in anonymous hash");
 	(void)hv_store_ent(hv,key,val,0);
     }
     SP = ORIGMARK;
@@ -4245,9 +5103,9 @@
 	*MARK-- = SvTIED_obj(MUTABLE_SV(ary), mg);
 	PUSHMARK(MARK);
 	PUTBACK;
-	ENTER;
+	ENTER_with_name("call_SPLICE");
 	call_method("SPLICE",GIMME_V);
-	LEAVE;
+	LEAVE_with_name("call_SPLICE");
 	SPAGAIN;
 	RETURN;
     }
@@ -4278,8 +5136,7 @@
 	length = AvMAX(ary) + 1;
     }
     if (offset > AvFILLp(ary) + 1) {
-	if (ckWARN(WARN_MISC))
-	    Perl_warner(aTHX_ packWARN(WARN_MISC), "splice() offset past end of array" );
+	Perl_ck_warner(aTHX_ packWARN(WARN_MISC), "splice() offset past end of array" );
 	offset = AvFILLp(ary) + 1;
     }
     after = AvFILLp(ary) + 1 - (offset + length);
@@ -4442,12 +5299,10 @@
 	*MARK-- = SvTIED_obj(MUTABLE_SV(ary), mg);
 	PUSHMARK(MARK);
 	PUTBACK;
-	ENTER;
+	ENTER_with_name("call_PUSH");
 	call_method("PUSH",G_SCALAR|G_DISCARD);
-	LEAVE;
+	LEAVE_with_name("call_PUSH");
 	SPAGAIN;
-	SP = ORIGMARK;
-	PUSHi( AvFILL(ary) + 1 );
     }
     else {
 	PL_delaymagic = DM_DELAY;
@@ -4461,8 +5316,10 @@
 	    mg_set(MUTABLE_SV(ary));
 
 	PL_delaymagic = 0;
-	SP = ORIGMARK;
-	PUSHi( AvFILLp(ary) + 1 );
+    }
+    SP = ORIGMARK;
+    if (OP_GIMME(PL_op, 0) != G_VOID) {
+	PUSHi( AvFILL(ary) + 1 );
     }
     RETURN;
 }
@@ -4491,9 +5348,9 @@
 	*MARK-- = SvTIED_obj(MUTABLE_SV(ary), mg);
 	PUSHMARK(MARK);
 	PUTBACK;
-	ENTER;
+	ENTER_with_name("call_UNSHIFT");
 	call_method("UNSHIFT",G_SCALAR|G_DISCARD);
-	LEAVE;
+	LEAVE_with_name("call_UNSHIFT");
 	SPAGAIN;
     }
     else {
@@ -4505,24 +5362,88 @@
 	}
     }
     SP = ORIGMARK;
-    PUSHi( AvFILL(ary) + 1 );
+    if (OP_GIMME(PL_op, 0) != G_VOID) {
+	PUSHi( AvFILL(ary) + 1 );
+    }
     RETURN;
 }
 
 PP(pp_reverse)
 {
     dVAR; dSP; dMARK;
-    SV ** const oldsp = SP;
 
     if (GIMME == G_ARRAY) {
-	MARK++;
-	while (MARK < SP) {
-	    register SV * const tmp = *MARK;
-	    *MARK++ = *SP;
-	    *SP-- = tmp;
+	if (PL_op->op_private & OPpREVERSE_INPLACE) {
+	    AV *av;
+
+	    /* See pp_sort() */
+	    assert( MARK+1 == SP && *SP && SvTYPE(*SP) == SVt_PVAV);
+	    (void)POPMARK; /* remove mark associated with ex-OP_AASSIGN */
+	    av = MUTABLE_AV((*SP));
+	    /* In-place reversing only happens in void context for the array
+	     * assignment. We don't need to push anything on the stack. */
+	    SP = MARK;
+
+	    if (SvMAGICAL(av)) {
+		I32 i, j;
+		register SV *tmp = sv_newmortal();
+		/* For SvCANEXISTDELETE */
+		HV *stash;
+		const MAGIC *mg;
+		bool can_preserve = SvCANEXISTDELETE(av);
+
+		for (i = 0, j = av_len(av); i < j; ++i, --j) {
+		    register SV *begin, *end;
+
+		    if (can_preserve) {
+			if (!av_exists(av, i)) {
+			    if (av_exists(av, j)) {
+				register SV *sv = av_delete(av, j, 0);
+				begin = *av_fetch(av, i, TRUE);
+				sv_setsv_mg(begin, sv);
+			    }
+			    continue;
+			}
+			else if (!av_exists(av, j)) {
+			    register SV *sv = av_delete(av, i, 0);
+			    end = *av_fetch(av, j, TRUE);
+			    sv_setsv_mg(end, sv);
+			    continue;
+			}
+		    }
+
+		    begin = *av_fetch(av, i, TRUE);
+		    end   = *av_fetch(av, j, TRUE);
+		    sv_setsv(tmp,      begin);
+		    sv_setsv_mg(begin, end);
+		    sv_setsv_mg(end,   tmp);
+		}
+	    }
+	    else {
+		SV **begin = AvARRAY(av);
+
+		if (begin) {
+		    SV **end   = begin + AvFILLp(av);
+
+		    while (begin < end) {
+			register SV * const tmp = *begin;
+			*begin++ = *end;
+			*end--   = tmp;
+		    }
+		}
+	    }
+	}
+	else {
+	    SV **oldsp = SP;
+	    MARK++;
+	    while (MARK < SP) {
+		register SV * const tmp = *MARK;
+		*MARK++ = *SP;
+		*SP--   = tmp;
+	    }
+	    /* safe as long as stack cannot get extended in the above */
+	    SP = oldsp;
 	}
-	/* safe as long as stack cannot get extended in the above */
-	SP = oldsp;
     }
     else {
 	register char *up;
@@ -4535,13 +5456,18 @@
 	SvUTF8_off(TARG);				/* decontaminate */
 	if (SP - MARK > 1)
 	    do_join(TARG, &PL_sv_no, MARK, SP);
-	else
+	else {
 	    sv_setsv(TARG, (SP > MARK)
 		    ? *SP
 		    : (padoff_du = find_rundefsvoffset(),
 			(padoff_du == NOT_IN_PAD
 			 || PAD_COMPNAME_FLAGS_isOUR(padoff_du))
 			? DEFSV : PAD_SVl(padoff_du)));
+
+	    if (! SvOK(TARG) && ckWARN(WARN_UNINITIALIZED))
+		report_uninit(TARG);
+	}
+
 	up = SvPV_force(TARG, len);
 	if (len > 1) {
 	    if (DO_UTF8(TARG)) {	/* first reverse each character */
@@ -4599,11 +5525,13 @@
     I32 iters = 0;
     const STRLEN slen = do_utf8 ? utf8_length((U8*)s, (U8*)strend) : (STRLEN)(strend - s);
     I32 maxiters = slen + 10;
+    I32 trailing_empty = 0;
     const char *orig;
     const I32 origlimit = limit;
     I32 realarray = 0;
     I32 base;
     const I32 gimme = GIMME_V;
+    bool gimme_scalar;
     const I32 oldsave = PL_savestack_ix;
     U32 make_mortal = SVs_TEMP;
     bool multiline = 0;
@@ -4632,8 +5560,6 @@
 	ary = GvAVn(pm->op_pmreplrootu.op_pmtargetgv);
     }
 #endif
-    else if (gimme != G_ARRAY)
-	ary = GvAVn(PL_defgv);
     else
 	ary = NULL;
     if (ary && (gimme != G_ARRAY || (pm->op_pmflags & PMf_ONCE))) {
@@ -4679,6 +5605,8 @@
 	multiline = 1;
     }
 
+    gimme_scalar = gimme == G_SCALAR && !ary;
+
     if (!limit)
 	limit = maxiters + 2;
     if (RX_EXTFLAGS(rx) & RXf_WHITE) {
@@ -4704,9 +5632,17 @@
 	    if (m >= strend)
 		break;
 
-	    dstr = newSVpvn_flags(s, m-s,
-				  (do_utf8 ? SVf_UTF8 : 0) | make_mortal);
-	    XPUSHs(dstr);
+	    if (gimme_scalar) {
+		iters++;
+		if (m-s == 0)
+		    trailing_empty++;
+		else
+		    trailing_empty = 0;
+	    } else {
+		dstr = newSVpvn_flags(s, m-s,
+				      (do_utf8 ? SVf_UTF8 : 0) | make_mortal);
+		XPUSHs(dstr);
+	    }
 
 	    /* skip the whitespace found last */
 	    if (do_utf8)
@@ -4734,9 +5670,18 @@
 	    m++;
 	    if (m >= strend)
 		break;
-	    dstr = newSVpvn_flags(s, m-s,
-				  (do_utf8 ? SVf_UTF8 : 0) | make_mortal);
-	    XPUSHs(dstr);
+
+	    if (gimme_scalar) {
+		iters++;
+		if (m-s == 0)
+		    trailing_empty++;
+		else
+		    trailing_empty = 0;
+	    } else {
+		dstr = newSVpvn_flags(s, m-s,
+				      (do_utf8 ? SVf_UTF8 : 0) | make_mortal);
+		XPUSHs(dstr);
+	    }
 	    s = m;
 	}
     }
@@ -4749,34 +5694,49 @@
             or
           split //, $str, $i;
         */
-        const U32 items = limit - 1; 
-        if (items < slen)
-            EXTEND(SP, items);
-        else
-            EXTEND(SP, slen);
+	if (!gimme_scalar) {
+	    const U32 items = limit - 1;
+	    if (items < slen)
+		EXTEND(SP, items);
+	    else
+		EXTEND(SP, slen);
+	}
 
         if (do_utf8) {
             while (--limit) {
                 /* keep track of how many bytes we skip over */
                 m = s;
                 s += UTF8SKIP(s);
-                dstr = newSVpvn_flags(m, s-m, SVf_UTF8 | make_mortal);
+		if (gimme_scalar) {
+		    iters++;
+		    if (s-m == 0)
+			trailing_empty++;
+		    else
+			trailing_empty = 0;
+		} else {
+		    dstr = newSVpvn_flags(m, s-m, SVf_UTF8 | make_mortal);
 
-                PUSHs(dstr);
+		    PUSHs(dstr);
+		}
 
                 if (s >= strend)
                     break;
             }
         } else {
             while (--limit) {
-                dstr = newSVpvn(s, 1);
+	        if (gimme_scalar) {
+		    iters++;
+		} else {
+		    dstr = newSVpvn(s, 1);
 
-                s++;
 
-                if (make_mortal)
-                    sv_2mortal(dstr);
+		    if (make_mortal)
+			sv_2mortal(dstr);
+
+		    PUSHs(dstr);
+		}
 
-                PUSHs(dstr);
+                s++;
 
                 if (s >= strend)
                     break;
@@ -4798,9 +5758,17 @@
 		    ;
 		if (m >= strend)
 		    break;
-		dstr = newSVpvn_flags(s, m-s,
-				      (do_utf8 ? SVf_UTF8 : 0) | make_mortal);
-		XPUSHs(dstr);
+		if (gimme_scalar) {
+		    iters++;
+		    if (m-s == 0)
+			trailing_empty++;
+		    else
+			trailing_empty = 0;
+		} else {
+		    dstr = newSVpvn_flags(s, m-s,
+					  (do_utf8 ? SVf_UTF8 : 0) | make_mortal);
+		    XPUSHs(dstr);
+		}
 		/* The rx->minlen is in characters but we want to step
 		 * s ahead by bytes. */
  		if (do_utf8)
@@ -4814,9 +5782,17 @@
 	      (m = fbm_instr((unsigned char*)s, (unsigned char*)strend,
 			     csv, multiline ? FBMrf_MULTILINE : 0)) )
 	    {
-		dstr = newSVpvn_flags(s, m-s,
-				      (do_utf8 ? SVf_UTF8 : 0) | make_mortal);
-		XPUSHs(dstr);
+		if (gimme_scalar) {
+		    iters++;
+		    if (m-s == 0)
+			trailing_empty++;
+		    else
+			trailing_empty = 0;
+		} else {
+		    dstr = newSVpvn_flags(s, m-s,
+					  (do_utf8 ? SVf_UTF8 : 0) | make_mortal);
+		    XPUSHs(dstr);
+		}
 		/* The rx->minlen is in characters but we want to step
 		 * s ahead by bytes. */
  		if (do_utf8)
@@ -4846,9 +5822,18 @@
 		strend = s + (strend - m);
 	    }
 	    m = RX_OFFS(rx)[0].start + orig;
-	    dstr = newSVpvn_flags(s, m-s,
-				  (do_utf8 ? SVf_UTF8 : 0) | make_mortal);
-	    XPUSHs(dstr);
+
+	    if (gimme_scalar) {
+		iters++;
+		if (m-s == 0)
+		    trailing_empty++;
+		else
+		    trailing_empty = 0;
+	    } else {
+		dstr = newSVpvn_flags(s, m-s,
+				      (do_utf8 ? SVf_UTF8 : 0) | make_mortal);
+		XPUSHs(dstr);
+	    }
 	    if (RX_NPARENS(rx)) {
 		I32 i;
 		for (i = 1; i <= (I32)RX_NPARENS(rx); i++) {
@@ -4858,37 +5843,54 @@
 		    /* japhy (07/27/01) -- the (m && s) test doesn't catch
 		       parens that didn't match -- they should be set to
 		       undef, not the empty string */
-		    if (m >= orig && s >= orig) {
-			dstr = newSVpvn_flags(s, m-s,
-					     (do_utf8 ? SVf_UTF8 : 0)
-					      | make_mortal);
+		    if (gimme_scalar) {
+			iters++;
+			if (m-s == 0)
+			    trailing_empty++;
+			else
+			    trailing_empty = 0;
+		    } else {
+			if (m >= orig && s >= orig) {
+			    dstr = newSVpvn_flags(s, m-s,
+						 (do_utf8 ? SVf_UTF8 : 0)
+						  | make_mortal);
+			}
+			else
+			    dstr = &PL_sv_undef;  /* undef, not "" */
+			XPUSHs(dstr);
 		    }
-		    else
-			dstr = &PL_sv_undef;  /* undef, not "" */
-		    XPUSHs(dstr);
+
 		}
 	    }
 	    s = RX_OFFS(rx)[0].end + orig;
 	}
     }
 
-    iters = (SP - PL_stack_base) - base;
+    if (!gimme_scalar) {
+	iters = (SP - PL_stack_base) - base;
+    }
     if (iters > maxiters)
 	DIE(aTHX_ "Split loop");
 
     /* keep field after final delim? */
     if (s < strend || (iters && origlimit)) {
-        const STRLEN l = strend - s;
-	dstr = newSVpvn_flags(s, l, (do_utf8 ? SVf_UTF8 : 0) | make_mortal);
-	XPUSHs(dstr);
+	if (!gimme_scalar) {
+	    const STRLEN l = strend - s;
+	    dstr = newSVpvn_flags(s, l, (do_utf8 ? SVf_UTF8 : 0) | make_mortal);
+	    XPUSHs(dstr);
+	}
 	iters++;
     }
     else if (!origlimit) {
-	while (iters > 0 && (!TOPs || !SvANY(TOPs) || SvCUR(TOPs) == 0)) {
-	    if (TOPs && !make_mortal)
-		sv_2mortal(TOPs);
-	    iters--;
-	    *SP-- = &PL_sv_undef;
+	if (gimme_scalar) {
+	    iters -= trailing_empty;
+	} else {
+	    while (iters > 0 && (!TOPs || !SvANY(TOPs) || SvCUR(TOPs) == 0)) {
+		if (TOPs && !make_mortal)
+		    sv_2mortal(TOPs);
+		*SP-- = &PL_sv_undef;
+		iters--;
+	    }
 	}
     }
 
@@ -4911,9 +5913,9 @@
 	}
 	else {
 	    PUTBACK;
-	    ENTER;
+	    ENTER_with_name("call_PUSH");
 	    call_method("PUSH",G_SCALAR|G_DISCARD);
-	    LEAVE;
+	    LEAVE_with_name("call_PUSH");
 	    SPAGAIN;
 	    if (gimme == G_ARRAY) {
 		I32 i;
@@ -4956,9 +5958,9 @@
     dSP;
     dTOPss;
     SV *retsv = sv;
+    assert(SvTYPE(retsv) != SVt_PVCV);
     SvLOCK(sv);
-    if (SvTYPE(retsv) == SVt_PVAV || SvTYPE(retsv) == SVt_PVHV
-	|| SvTYPE(retsv) == SVt_PVCV) {
+    if (SvTYPE(retsv) == SVt_PVAV || SvTYPE(retsv) == SVt_PVHV) {
 	retsv = refto(retsv);
     }
     SETs(retsv);
@@ -4971,6 +5973,25 @@
     dVAR;
     DIE(aTHX_ "panic: unimplemented op %s (#%d) called", OP_NAME(PL_op),
 	PL_op->op_type);
+    return NORMAL;
+}
+
+PP(pp_boolkeys)
+{
+    dVAR;
+    dSP;
+    HV * const hv = (HV*)POPs;
+    
+    if (SvRMAGICAL(hv)) {
+	MAGIC * const mg = mg_find((SV*)hv, PERL_MAGIC_tied);
+	if (mg) {
+            XPUSHs(magic_scalarpack(hv, mg));
+	    RETURN;
+        }	    
+    }
+
+    XPUSHs(boolSV(HvKEYS(hv) != 0));
+    RETURN;
 }
 
 /*
Index: src/gnu/usr.bin/perl/pp.h
diff -u src/gnu/usr.bin/perl/pp.h:1.11 src/gnu/usr.bin/perl/pp.h:1.12
--- pp.h:1.11	Mon Oct 12 18:24:21 2009
+++ pp.h	Fri Sep 24 15:06:42 2010
@@ -86,7 +86,7 @@
 #define dTARG SV *targ
 
 #define NORMAL PL_op->op_next
-#define DIE return Perl_die
+#define DIE Perl_die
 
 /*
 =for apidoc Ams||PUTBACK
@@ -471,6 +471,37 @@
 #define tryAMAGICunDEREF_var(meth_enum) \
 	tryAMAGICunW_var(meth_enum,setAGAIN,0,(void)0)
 
+#define tryAMAGICftest(chr)				\
+    STMT_START {					\
+	assert(chr != '?');				\
+	if ((PL_op->op_flags & OPf_KIDS)		\
+		&& SvAMAGIC(TOPs)) {			\
+	    const char tmpchr = (chr);			\
+	    SV * const tmpsv = amagic_call(TOPs,	\
+		newSVpvn_flags(&tmpchr, 1, SVs_TEMP),	\
+		ftest_amg, AMGf_unary);			\
+							\
+	    if (tmpsv) {				\
+		const OP *next = PL_op->op_next;	\
+							\
+		SPAGAIN;				\
+							\
+		if (next->op_type >= OP_FTRREAD &&	\
+		    next->op_type <= OP_FTBINARY &&	\
+		    next->op_private & OPpFT_STACKED	\
+		) {					\
+		    if (SvTRUE(tmpsv))			\
+			/* leave the object alone */	\
+			RETURN;				\
+		}					\
+							\
+		SETs(tmpsv);				\
+		RETURN;					\
+	    }						\
+	}						\
+    } STMT_END
+
+
 #define opASSIGN (PL_op->op_flags & OPf_STACKED)
 #define SETsv(sv)	STMT_START {					\
 		if (opASSIGN || (SvFLAGS(TARG) & SVs_PADMY))		\
@@ -499,6 +530,15 @@
 
 =cut */
 #define LVRET ((PL_op->op_private & OPpMAYBE_LVSUB) && is_lvalue_sub())
+
+#define SvCANEXISTDELETE(sv) \
+ (!SvRMAGICAL(sv)            \
+  || ((mg = mg_find((const SV *) sv, PERL_MAGIC_tied))           \
+      && (stash = SvSTASH(SvRV(SvTIED_obj(MUTABLE_SV(sv), mg)))) \
+      && gv_fetchmethod_autoload(stash, "EXISTS", TRUE)          \
+      && gv_fetchmethod_autoload(stash, "DELETE", TRUE)          \
+     )                       \
+  )
 
 /*
  * Local variables:
Index: src/gnu/usr.bin/perl/pp_ctl.c
diff -u src/gnu/usr.bin/perl/pp_ctl.c:1.13 src/gnu/usr.bin/perl/pp_ctl.c:1.14
--- pp_ctl.c:1.13	Mon Oct 12 18:24:21 2009
+++ pp_ctl.c	Fri Sep 24 15:06:42 2010
@@ -79,8 +79,7 @@
     dSP;
     register PMOP *pm = (PMOP*)cLOGOP->op_other;
     SV *tmpstr;
-    MAGIC *mg = NULL;
-    REGEXP * re;
+    REGEXP *re = NULL;
 
     /* prevent recompiling under /o and ithreads. */
 #if defined(USE_ITHREADS)
@@ -94,36 +93,84 @@
 	RETURN;
     }
 #endif
+
+#define tryAMAGICregexp(rx)			\
+    STMT_START {				\
+	if (SvROK(rx) && SvAMAGIC(rx)) {	\
+	    SV *sv = AMG_CALLun(rx, regexp);	\
+	    if (sv) {				\
+		if (SvROK(sv))			\
+		    sv = SvRV(sv);		\
+		if (SvTYPE(sv) != SVt_REGEXP)	\
+		    Perl_croak(aTHX_ "Overloaded qr did not return a REGEXP"); \
+		rx = sv;			\
+	    }					\
+	}					\
+    } STMT_END
+	    
+
     if (PL_op->op_flags & OPf_STACKED) {
 	/* multiple args; concatentate them */
 	dMARK; dORIGMARK;
 	tmpstr = PAD_SV(ARGTARG);
 	sv_setpvs(tmpstr, "");
 	while (++MARK <= SP) {
+	    SV *msv = *MARK;
 	    if (PL_amagic_generation) {
 		SV *sv;
-		if ((SvAMAGIC(tmpstr) || SvAMAGIC(*MARK)) &&
-		    (sv = amagic_call(tmpstr, *MARK, concat_amg, AMGf_assign)))
+
+		tryAMAGICregexp(msv);
+
+		if ((SvAMAGIC(tmpstr) || SvAMAGIC(msv)) &&
+		    (sv = amagic_call(tmpstr, msv, concat_amg, AMGf_assign)))
 		{
 		   sv_setsv(tmpstr, sv);
 		   continue;
 		}
 	    }
-	    sv_catsv(tmpstr, *MARK);
+	    sv_catsv(tmpstr, msv);
 	}
     	SvSETMAGIC(tmpstr);
 	SP = ORIGMARK;
     }
-    else
+    else {
 	tmpstr = POPs;
+	tryAMAGICregexp(tmpstr);
+    }
+
+#undef tryAMAGICregexp
 
     if (SvROK(tmpstr)) {
 	SV * const sv = SvRV(tmpstr);
-	if(SvMAGICAL(sv))
-	    mg = mg_find(sv, PERL_MAGIC_qr);
+	if (SvTYPE(sv) == SVt_REGEXP)
+	    re = (REGEXP*) sv;
     }
-    if (mg) {
-	regexp * const re = reg_temp_copy((regexp *)mg->mg_obj);
+    else if (SvTYPE(tmpstr) == SVt_REGEXP)
+	re = (REGEXP*) tmpstr;
+
+    if (re) {
+	/* The match's LHS's get-magic might need to access this op's reg-
+	   exp (as is sometimes the case with $';  see bug 70764).  So we
+	   must call get-magic now before we replace the regexp. Hopeful-
+	   ly this hack can be replaced with the approach described at
+	   http://www.nntp.perl.org/group/perl.perl5.porters/2007/03
+	   /msg122415.html some day. */
+	if(pm->op_type == OP_MATCH) {
+	 SV *lhs;
+	 const bool was_tainted = PL_tainted;
+	 if (pm->op_flags & OPf_STACKED)
+	    lhs = TOPs;
+	 else if (pm->op_private & OPpTARGET_MY)
+	    lhs = PAD_SV(pm->op_targ);
+	 else lhs = DEFSV;
+	 SvGETMAGIC(lhs);
+	 /* Restore the previous value of PL_tainted (which may have been
+	    modified by get-magic), to avoid incorrectly setting the
+	    RXf_TAINTED flag further down. */
+	 PL_tainted = was_tainted;
+	}
+
+	re = reg_temp_copy(NULL, re);
 	ReREFCNT_dec(PM_GETRE(pm));
 	PM_SETRE(pm, re);
     }
@@ -131,16 +178,21 @@
 	STRLEN len;
 	const char *t = SvOK(tmpstr) ? SvPV_const(tmpstr, len) : "";
 	re = PM_GETRE(pm);
+	assert (re != (REGEXP*) &PL_sv_undef);
 
 	/* Check against the last compiled regexp. */
-	if (!re || !RX_PRECOMP(re) || RX_PRELEN(re) != (I32)len ||
+	if (!re || !RX_PRECOMP(re) || RX_PRELEN(re) != len ||
 	    memNE(RX_PRECOMP(re), t, len))
 	{
 	    const regexp_engine *eng = re ? RX_ENGINE(re) : NULL;
             U32 pm_flags = pm->op_pmflags & PMf_COMPILETIME;
 	    if (re) {
 	        ReREFCNT_dec(re);
+#ifdef USE_ITHREADS
+		PM_SETRE(pm, (REGEXP*) &PL_sv_undef);
+#else
 		PM_SETRE(pm, NULL);	/* crucial if regcomp aborts */
+#endif
 	    } else if (PL_curcop->cop_hints_hash) {
 	        SV *ptr = Perl_refcounted_he_fetch(aTHX_ PL_curcop->cop_hints_hash, 0,
 				       "regcomp", 7, 0, 0);
@@ -151,8 +203,17 @@
 	    if (PL_op->op_flags & OPf_SPECIAL)
 		PL_reginterp_cnt = I32_MAX; /* Mark as safe.  */
 
-	    if (DO_UTF8(tmpstr))
-		pm_flags |= RXf_UTF8;
+	    if (DO_UTF8(tmpstr)) {
+		assert (SvUTF8(tmpstr));
+	    } else if (SvUTF8(tmpstr)) {
+		/* Not doing UTF-8, despite what the SV says. Is this only if
+		   we're trapped in use 'bytes'?  */
+		/* Make a copy of the octet sequence, but without the flag on,
+		   as the compiler now honours the SvUTF8 flag on tmpstr.  */
+		STRLEN len;
+		const char *const p = SvPV(tmpstr, len);
+		tmpstr = newSVpvn_flags(p, len, SVs_TEMP);
+	    }
 
  		if (eng) 
 	        PM_SETRE(pm, CALLREGCOMP_ENG(eng, tmpstr, pm_flags));
@@ -220,13 +281,16 @@
 	if (!(cx->sb_rxtainted & 2) && SvTAINTED(TOPs))
 	    cx->sb_rxtainted |= 2;
 	sv_catsv(dstr, POPs);
+	/* XXX: adjust for positive offsets of \G for instance s/(.)\G//g with positive pos() */
+	s -= RX_GOFS(rx);
 
 	/* Are we done */
-	if (CxONCE(cx) || !CALLREGEXEC(rx, s, cx->sb_strend, orig,
-				     s == m, cx->sb_targ, NULL,
-				     ((cx->sb_rflags & REXEC_COPY_STR)
-				      ? (REXEC_IGNOREPOS|REXEC_NOT_FIRST)
-				      : (REXEC_COPY_STR|REXEC_IGNOREPOS|REXEC_NOT_FIRST))))
+	if (CxONCE(cx) || s < orig ||
+		!CALLREGEXEC(rx, s, cx->sb_strend, orig,
+			     (s == m) + RX_GOFS(rx), cx->sb_targ, NULL,
+			     ((cx->sb_rflags & REXEC_COPY_STR)
+			      ? (REXEC_IGNOREPOS|REXEC_NOT_FIRST)
+			      : (REXEC_COPY_STR|REXEC_IGNOREPOS|REXEC_NOT_FIRST))))
 	{
 	    SV * const targ = cx->sb_targ;
 
@@ -330,8 +394,8 @@
     RX_MATCH_COPIED_off(rx);
 
 #ifdef PERL_OLD_COPY_ON_WRITE
-    *p++ = PTR2UV(rx->saved_copy);
-    rx->saved_copy = NULL;
+    *p++ = PTR2UV(RX_SAVED_COPY(rx));
+    RX_SAVED_COPY(rx) = NULL;
 #endif
 
     *p++ = RX_NPARENS(rx);
@@ -344,8 +408,8 @@
     }
 }
 
-void
-Perl_rxres_restore(pTHX_ void **rsp, REGEXP *rx)
+static void
+S_rxres_restore(pTHX_ void **rsp, REGEXP *rx)
 {
     UV *p = (UV*)*rsp;
     U32 i;
@@ -358,9 +422,9 @@
     *p++ = 0;
 
 #ifdef PERL_OLD_COPY_ON_WRITE
-    if (rx->saved_copy)
-	SvREFCNT_dec (rx->saved_copy);
-    rx->saved_copy = INT2PTR(SV*,*p);
+    if (RX_SAVED_COPY(rx))
+	SvREFCNT_dec (RX_SAVED_COPY(rx));
+    RX_SAVED_COPY(rx) = INT2PTR(SV*,*p);
     *p++ = 0;
 #endif
 
@@ -374,8 +438,8 @@
     }
 }
 
-void
-Perl_rxres_free(pTHX_ void **rsp)
+static void
+S_rxres_free(pTHX_ void **rsp)
 {
     UV * const p = (UV*)*rsp;
 
@@ -498,8 +562,7 @@
 	    if (!targ_is_utf8 && DO_UTF8(tmpForm)) {
 		SvCUR_set(PL_formtarget, t - SvPVX_const(PL_formtarget));
 		*t = '\0';
-		sv_utf8_upgrade(PL_formtarget);
-		SvGROW(PL_formtarget, SvCUR(PL_formtarget) + fudge + 1);
+		sv_utf8_upgrade_flags_grow(PL_formtarget, SV_GMAGIC, fudge + 1);
 		t = SvEND(PL_formtarget);
 		targ_is_utf8 = TRUE;
 	    }
@@ -520,8 +583,7 @@
 		sv = *++MARK;
 	    else {
 		sv = &PL_sv_no;
-		if (ckWARN(WARN_SYNTAX))
-		    Perl_warner(aTHX_ packWARN(WARN_SYNTAX), "Not enough format arguments");
+		Perl_ck_warner(aTHX_ packWARN(WARN_SYNTAX), "Not enough format arguments");
 	    }
 	    break;
 
@@ -682,8 +744,8 @@
 		    if (!targ_is_utf8) {
 			SvCUR_set(PL_formtarget, t - SvPVX_const(PL_formtarget));
 			*t = '\0';
-			sv_utf8_upgrade(PL_formtarget);
-			SvGROW(PL_formtarget, SvCUR(PL_formtarget) + fudge + 1);
+			sv_utf8_upgrade_flags_grow(PL_formtarget, SV_GMAGIC,
+								    fudge + 1);
 			t = SvEND(PL_formtarget);
 			targ_is_utf8 = TRUE;
 		    }
@@ -794,7 +856,7 @@
 				      t - SvPVX_const(PL_formtarget));
 			    targ_is_utf8 = TRUE;
 			    /* Don't need get magic.  */
-			    sv_utf8_upgrade_flags(PL_formtarget, 0);
+			    sv_utf8_upgrade_nomg(PL_formtarget);
 			} else {
 			    SvCUR_set(PL_formtarget,
 				      t - SvPVX_const(PL_formtarget));
@@ -889,11 +951,6 @@
 		    *t = '\0';
 		    SvCUR_set(PL_formtarget, t - SvPVX_const(PL_formtarget));
 		    lines += FmLINES(PL_formtarget);
-		    if (lines == 200) {
-			arg = t - linemark;
-			if (strnEQ(linemark, linemark - arg, arg))
-			    DIE(aTHX_ "Runaway format");
-		    }
 		    if (targ_is_utf8)
 			SvUTF8_on(PL_formtarget);
 		    FmLINES(PL_formtarget) = lines;
@@ -960,14 +1017,14 @@
     PL_stack_sp = PL_stack_base + *PL_markstack_ptr + 1;
     pp_pushmark();				/* push dst */
     pp_pushmark();				/* push src */
-    ENTER;					/* enter outer scope */
+    ENTER_with_name("grep");					/* enter outer scope */
 
     SAVETMPS;
     if (PL_op->op_private & OPpGREP_LEX)
 	SAVESPTR(PAD_SVl(PL_op->op_targ));
     else
 	SAVE_DEFSV;
-    ENTER;					/* enter inner scope */
+    ENTER_with_name("grep_item");					/* enter inner scope */
     SAVEVPTR(PL_curpm);
 
     src = PL_stack_base[*PL_markstack_ptr];
@@ -1048,13 +1105,13 @@
 	    }
 	}
     }
-    LEAVE;					/* exit inner scope */
+    LEAVE_with_name("grep_item");					/* exit inner scope */
 
     /* All done yet? */
     if (PL_markstack_ptr[-1] > *PL_markstack_ptr) {
 
 	(void)POPMARK;				/* pop top */
-	LEAVE;					/* exit outer scope */
+	LEAVE_with_name("grep");					/* exit outer scope */
 	(void)POPMARK;				/* pop src */
 	items = --*PL_markstack_ptr - PL_markstack_ptr[-1];
 	(void)POPMARK;				/* pop dst */
@@ -1077,7 +1134,7 @@
     else {
 	SV *src;
 
-	ENTER;					/* enter inner scope */
+	ENTER_with_name("grep_item");					/* enter inner scope */
 	SAVEVPTR(PL_curpm);
 
 	/* set $_ to the new source item */
@@ -1239,14 +1296,17 @@
 
 static const char * const context_name[] = {
     "pseudo-block",
+    NULL, /* CXt_WHEN never actually needs "block" */
+    NULL, /* CXt_BLOCK never actually needs "block" */
+    NULL, /* CXt_GIVEN never actually needs "block" */
+    NULL, /* CXt_LOOP_FOR never actually needs "loop" */
+    NULL, /* CXt_LOOP_PLAIN never actually needs "loop" */
+    NULL, /* CXt_LOOP_LAZYSV never actually needs "loop" */
+    NULL, /* CXt_LOOP_LAZYIV never actually needs "loop" */
     "subroutine",
+    "format",
     "eval",
-    "loop",
     "substitution",
-    "block",
-    "format",
-    "given",
-    "when"
 };
 
 STATIC I32
@@ -1265,20 +1325,25 @@
 	case CXt_FORMAT:
 	case CXt_EVAL:
 	case CXt_NULL:
-	    if (ckWARN(WARN_EXITING))
-		Perl_warner(aTHX_ packWARN(WARN_EXITING), "Exiting %s via %s",
-			context_name[CxTYPE(cx)], OP_NAME(PL_op));
+	    Perl_ck_warner(aTHX_ packWARN(WARN_EXITING), "Exiting %s via %s",
+			   context_name[CxTYPE(cx)], OP_NAME(PL_op));
 	    if (CxTYPE(cx) == CXt_NULL)
 		return -1;
 	    break;
-	case CXt_LOOP:
-	    if ( !cx->blk_loop.label || strNE(label, cx->blk_loop.label) ) {
+	case CXt_LOOP_LAZYIV:
+	case CXt_LOOP_LAZYSV:
+	case CXt_LOOP_FOR:
+	case CXt_LOOP_PLAIN:
+	  {
+	    const char *cx_label = CxLABEL(cx);
+	    if (!cx_label || strNE(label, cx_label) ) {
 		DEBUG_l(Perl_deb(aTHX_ "(Skipping label #%ld %s)\n",
-			(long)i, cx->blk_loop.label));
+			(long)i, cx_label));
 		continue;
 	    }
 	    DEBUG_l( Perl_deb(aTHX_ "(Found label #%ld %s)\n", (long)i, label));
 	    return i;
+	  }
 	}
     }
     return i;
@@ -1383,13 +1448,15 @@
 	case CXt_FORMAT:
 	case CXt_EVAL:
 	case CXt_NULL:
-	    if (ckWARN(WARN_EXITING))
-		Perl_warner(aTHX_ packWARN(WARN_EXITING), "Exiting %s via %s",
-			context_name[CxTYPE(cx)], OP_NAME(PL_op));
+	    Perl_ck_warner(aTHX_ packWARN(WARN_EXITING), "Exiting %s via %s",
+			   context_name[CxTYPE(cx)], OP_NAME(PL_op));
 	    if ((CxTYPE(cx)) == CXt_NULL)
 		return -1;
 	    break;
-	case CXt_LOOP:
+	case CXt_LOOP_LAZYIV:
+	case CXt_LOOP_LAZYSV:
+	case CXt_LOOP_FOR:
+	case CXt_LOOP_PLAIN:
 	    DEBUG_l( Perl_deb(aTHX_ "(Found loop #%ld)\n", (long)i));
 	    return i;
 	}
@@ -1410,7 +1477,12 @@
 	case CXt_GIVEN:
 	    DEBUG_l( Perl_deb(aTHX_ "(Found given #%ld)\n", (long)i));
 	    return i;
-	case CXt_LOOP:
+	case CXt_LOOP_PLAIN:
+	    assert(!CxFOREACHDEF(cx));
+	    break;
+	case CXt_LOOP_LAZYIV:
+	case CXt_LOOP_LAZYSV:
+	case CXt_LOOP_FOR:
 	    if (CxFOREACHDEF(cx)) {
 		DEBUG_l( Perl_deb(aTHX_ "(Found foreach #%ld)\n", (long)i));
 		return i;
@@ -1461,7 +1533,10 @@
 	case CXt_EVAL:
 	    POPEVAL(cx);
 	    break;
-	case CXt_LOOP:
+	case CXt_LOOP_LAZYIV:
+	case CXt_LOOP_LAZYSV:
+	case CXt_LOOP_FOR:
+	case CXt_LOOP_PLAIN:
 	    POPLOOP(cx);
 	    break;
 	case CXt_NULL:
@@ -1492,8 +1567,8 @@
 	++PL_parser->error_count;
 }
 
-OP *
-Perl_die_where(pTHX_ const char *message, STRLEN msglen)
+void
+Perl_die_where(pTHX_ SV *msv)
 {
     dVAR;
 
@@ -1501,33 +1576,37 @@
 	I32 cxix;
 	I32 gimme;
 
-	if (message) {
+	if (msv) {
 	    if (PL_in_eval & EVAL_KEEPERR) {
                 static const char prefix[] = "\t(in cleanup) ";
 		SV * const err = ERRSV;
 		const char *e = NULL;
 		if (!SvPOK(err))
 		    sv_setpvs(err,"");
-		else if (SvCUR(err) >= sizeof(prefix)+msglen-1) {
+		else if (SvCUR(err) >= sizeof(prefix)+SvCUR(msv)-1) {
 		    STRLEN len;
+		    STRLEN msglen;
+		    const char* message = SvPV_const(msv, msglen);
 		    e = SvPV_const(err, len);
 		    e += len - msglen;
 		    if (*e != *message || strNE(e,message))
 			e = NULL;
 		}
 		if (!e) {
-		    SvGROW(err, SvCUR(err)+sizeof(prefix)+msglen);
+		    STRLEN start;
+		    SvGROW(err, SvCUR(err)+sizeof(prefix)+SvCUR(msv));
 		    sv_catpvn(err, prefix, sizeof(prefix)-1);
-		    sv_catpvn(err, message, msglen);
-		    if (ckWARN(WARN_MISC)) {
-			const STRLEN start = SvCUR(err)-msglen-sizeof(prefix)+1;
-			Perl_warner(aTHX_ packWARN(WARN_MISC), "%s",
-				SvPVX_const(err)+start);
-		    }
+		    sv_catsv(err, msv);
+		    start = SvCUR(err)-SvCUR(msv)-sizeof(prefix)+1;
+		    Perl_ck_warner(aTHX_ packWARN(WARN_MISC), "%s",
+				   SvPVX_const(err)+start);
 		}
 	    }
 	    else {
+		STRLEN msglen;
+		const char* message = SvPV_const(msv, msglen);
 		sv_setpvn(ERRSV, message, msglen);
+		SvFLAGS(ERRSV) |= SvFLAGS(msv) & SVf_UTF8;
 	    }
 	}
 
@@ -1540,6 +1619,7 @@
 
 	if (cxix >= 0) {
 	    I32 optype;
+	    SV *namesv;
 	    register PERL_CONTEXT *cx;
 	    SV **newsp;
 
@@ -1548,13 +1628,14 @@
 
 	    POPBLOCK(cx,PL_curpm);
 	    if (CxTYPE(cx) != CXt_EVAL) {
-		if (!message)
-		    message = SvPVx_const(ERRSV, msglen);
+		STRLEN msglen;
+		const char* message = SvPVx_const( msv ? msv : ERRSV, msglen);
 		PerlIO_write(Perl_error_log, (const char *)"panic: die ", 11);
 		PerlIO_write(Perl_error_log, message, msglen);
 		my_exit(1);
 	    }
 	    POPEVAL(cx);
+	    namesv = cx->blk_eval.old_namesv;
 
 	    if (gimme == G_SCALAR)
 		*++newsp = &PL_sv_undef;
@@ -1570,23 +1651,22 @@
 
 	    if (optype == OP_REQUIRE) {
                 const char* const msg = SvPVx_nolen_const(ERRSV);
-		SV * const nsv = cx->blk_eval.old_namesv;
-                (void)hv_store(GvHVn(PL_incgv), SvPVX_const(nsv), SvCUR(nsv),
+                (void)hv_store(GvHVn(PL_incgv),
+                               SvPVX_const(namesv), SvCUR(namesv),
                                &PL_sv_undef, 0);
 		DIE(aTHX_ "%sCompilation failed in require",
 		    *msg ? msg : "Unknown error\n");
 	    }
 	    assert(CxTYPE(cx) == CXt_EVAL);
-	    return cx->blk_eval.retop;
+	    PL_restartop = cx->blk_eval.retop;
+	    JMPENV_JUMP(3);
+	    /* NOTREACHED */
 	}
     }
-    if (!message)
-	message = SvPVx_const(ERRSV, msglen);
 
-    write_to_stderr(message, msglen);
+    write_to_stderr( msv ? msv : ERRSV );
     my_failure_exit();
     /* NOTREACHED */
-    return 0;
 }
 
 PP(pp_xor)
@@ -1676,11 +1756,11 @@
 	    SV * const sv = newSV(0);
 	    gv_efullname3(sv, cvgv, NULL);
 	    mPUSHs(sv);
-	    mPUSHi((I32)CxHASARGS(cx));
+	    PUSHs(boolSV(CxHASARGS(cx)));
 	}
 	else {
 	    PUSHs(newSVpvs_flags("(unknown)", SVs_TEMP));
-	    mPUSHi((I32)CxHASARGS(cx));
+	    PUSHs(boolSV(CxHASARGS(cx)));
 	}
     }
     else {
@@ -1691,7 +1771,7 @@
     if (gimme == G_VOID)
 	PUSHs(&PL_sv_undef);
     else
-	mPUSHi(gimme & G_ARRAY);
+	PUSHs(boolSV((gimme & G_WANT) == G_ARRAY));
     if (CxTYPE(cx) == CXt_EVAL) {
 	/* eval STRING */
 	if (CxOLD_OP_TYPE(cx) == OP_ENTEREVAL) {
@@ -1719,12 +1799,8 @@
 	AV * const ary = cx->blk_sub.argarray;
 	const int off = AvARRAY(ary) - AvALLOC(ary);
 
-	if (!PL_dbargs) {
-	    GV* const tmpgv = gv_fetchpvs("DB::args", GV_ADD, SVt_PVAV);
-	    PL_dbargs = GvAV(gv_AVadd(tmpgv));
-	    GvMULTI_on(tmpgv);
-	    AvREAL_off(PL_dbargs);	/* XXX should be REIFY (see av.h) */
-	}
+	if (!PL_dbargs)
+	    Perl_init_dbargs(aTHX);
 
 	if (AvMAX(PL_dbargs) < AvFILLp(ary) + off)
 	    av_extend(PL_dbargs, AvFILLp(ary) + off);
@@ -1843,12 +1919,12 @@
     register PERL_CONTEXT *cx;
     const I32 gimme = GIMME_V;
     SV **svp;
-    U16 cxtype = CXt_LOOP | CXp_FOREACH;
+    U8 cxtype = CXt_LOOP_FOR;
 #ifdef USE_ITHREADS
-    void *iterdata;
+    PAD *iterdata;
 #endif
 
-    ENTER;
+    ENTER_with_name("loop1");
     SAVETMPS;
 
     if (PL_op->op_targ) {
@@ -1861,8 +1937,7 @@
 #ifndef USE_ITHREADS
 	svp = &PAD_SVl(PL_op->op_targ);		/* "my" variable */
 #else
-	iterdata = INT2PTR(void*, PL_op->op_targ);
-	cxtype |= CXp_PADVAR;
+	iterdata = NULL;
 #endif
     }
     else {
@@ -1871,29 +1946,34 @@
 	SAVEGENERICSV(*svp);
 	*svp = newSV(0);
 #ifdef USE_ITHREADS
-	iterdata = (void*)gv;
+	iterdata = (PAD*)gv;
 #endif
     }
 
     if (PL_op->op_private & OPpITER_DEF)
 	cxtype |= CXp_FOR_DEF;
 
-    ENTER;
+    ENTER_with_name("loop2");
 
     PUSHBLOCK(cx, cxtype, SP);
 #ifdef USE_ITHREADS
-    PUSHLOOP(cx, iterdata, MARK);
+    PUSHLOOP_FOR(cx, iterdata, MARK, PL_op->op_targ);
 #else
-    PUSHLOOP(cx, svp, MARK);
+    PUSHLOOP_FOR(cx, svp, MARK, 0);
 #endif
     if (PL_op->op_flags & OPf_STACKED) {
-	cx->blk_loop.iterary = (AV*)SvREFCNT_inc(POPs);
-	if (SvTYPE(cx->blk_loop.iterary) != SVt_PVAV) {
+	SV *maybe_ary = POPs;
+	if (SvTYPE(maybe_ary) != SVt_PVAV) {
 	    dPOPss;
-	    SV * const right = (SV*)cx->blk_loop.iterary;
+	    SV * const right = maybe_ary;
 	    SvGETMAGIC(sv);
 	    SvGETMAGIC(right);
 	    if (RANGE_IS_NUMERIC(sv,right)) {
+		cx->cx_type &= ~CXTYPEMASK;
+		cx->cx_type |= CXt_LOOP_LAZYIV;
+		/* Make sure that no-one re-orders cop.h and breaks our
+		   assumptions */
+		assert(CxTYPE(cx) == CXt_LOOP_LAZYIV);
 #ifdef NV_PRESERVES_UV
 		if ((SvOK(sv) && ((SvNV(sv) < (NV)IV_MIN) ||
 				  (SvNV(sv) > (NV)IV_MAX)))
@@ -1914,16 +1994,23 @@
 					 (SvNV(right) > (NV)UV_MAX))))))
 #endif
 		    DIE(aTHX_ "Range iterator outside integer range");
-		cx->blk_loop.iterix = SvIV(sv);
-		cx->blk_loop.itermax = SvIV(right);
+		cx->blk_loop.state_u.lazyiv.cur = SvIV(sv);
+		cx->blk_loop.state_u.lazyiv.end = SvIV(right);
 #ifdef DEBUGGING
 		/* for correct -Dstv display */
 		cx->blk_oldsp = sp - PL_stack_base;
 #endif
 	    }
 	    else {
-		cx->blk_loop.iterlval = newSVsv(sv);
-		(void) SvPV_force_nolen(cx->blk_loop.iterlval);
+		cx->cx_type &= ~CXTYPEMASK;
+		cx->cx_type |= CXt_LOOP_LAZYSV;
+		/* Make sure that no-one re-orders cop.h and breaks our
+		   assumptions */
+		assert(CxTYPE(cx) == CXt_LOOP_LAZYSV);
+		cx->blk_loop.state_u.lazysv.cur = newSVsv(sv);
+		cx->blk_loop.state_u.lazysv.end = right;
+		SvREFCNT_inc(right);
+		(void) SvPV_force_nolen(cx->blk_loop.state_u.lazysv.cur);
 		/* This will do the upgrade to SVt_PV, and warn if the value
 		   is uninitialised.  */
 		(void) SvPV_nolen_const(right);
@@ -1931,24 +2018,26 @@
 		   to replace !SvOK() with a pointer to "".  */
 		if (!SvOK(right)) {
 		    SvREFCNT_dec(right);
-		    cx->blk_loop.iterary = (AV*) &PL_sv_no;
+		    cx->blk_loop.state_u.lazysv.end = &PL_sv_no;
 		}
 	    }
 	}
-	else if (PL_op->op_private & OPpITER_REVERSED) {
-	    cx->blk_loop.itermax = 0;
-	    cx->blk_loop.iterix = AvFILL(cx->blk_loop.iterary) + 1;
-
+	else /* SvTYPE(maybe_ary) == SVt_PVAV */ {
+	    cx->blk_loop.state_u.ary.ary = MUTABLE_AV(maybe_ary);
+	    SvREFCNT_inc(maybe_ary);
+	    cx->blk_loop.state_u.ary.ix =
+		(PL_op->op_private & OPpITER_REVERSED) ?
+		AvFILL(cx->blk_loop.state_u.ary.ary) + 1 :
+		-1;
 	}
     }
-    else {
-	cx->blk_loop.iterary = PL_curstack;
+    else { /* iterating over items on the stack */
+	cx->blk_loop.state_u.ary.ary = NULL; /* means to use the stack */
 	if (PL_op->op_private & OPpITER_REVERSED) {
-	    cx->blk_loop.itermax = MARK - PL_stack_base + 1;
-	    cx->blk_loop.iterix = cx->blk_oldsp + 1;
+	    cx->blk_loop.state_u.ary.ix = cx->blk_oldsp + 1;
 	}
 	else {
-	    cx->blk_loop.iterix = MARK - PL_stack_base;
+	    cx->blk_loop.state_u.ary.ix = MARK - PL_stack_base;
 	}
     }
 
@@ -1961,12 +2050,12 @@
     register PERL_CONTEXT *cx;
     const I32 gimme = GIMME_V;
 
-    ENTER;
+    ENTER_with_name("loop1");
     SAVETMPS;
-    ENTER;
+    ENTER_with_name("loop2");
 
-    PUSHBLOCK(cx, CXt_LOOP, SP);
-    PUSHLOOP(cx, 0, SP);
+    PUSHBLOCK(cx, CXt_LOOP_PLAIN, SP);
+    PUSHLOOP_PLAIN(cx, SP);
 
     RETURN;
 }
@@ -1981,7 +2070,7 @@
     SV **mark;
 
     POPBLOCK(cx,newpm);
-    assert(CxTYPE(cx) == CXt_LOOP);
+    assert(CxTYPE_is_LOOP(cx));
     mark = newsp;
     newsp = PL_stack_base + cx->blk_loop.resetsp;
 
@@ -2006,8 +2095,8 @@
     POPLOOP(cx);	/* Stack values are safe: release loop vars ... */
     PL_curpm = newpm;	/* ... and pop $1 et al */
 
-    LEAVE;
-    LEAVE;
+    LEAVE_with_name("loop2");
+    LEAVE_with_name("loop1");
 
     return NORMAL;
 }
@@ -2022,8 +2111,9 @@
     SV **newsp;
     PMOP *newpm;
     I32 optype = 0;
+    SV *namesv;
     SV *sv;
-    OP *retop;
+    OP *retop = NULL;
 
     const I32 cxix = dopoptosub(cxstack_ix);
 
@@ -2064,6 +2154,7 @@
 	if (!(PL_in_eval & EVAL_KEEPERR))
 	    clear_errsv = TRUE;
 	POPEVAL(cx);
+	namesv = cx->blk_eval.old_namesv;
 	retop = cx->blk_eval.retop;
 	if (CxTRYBLOCK(cx))
 	    break;
@@ -2072,9 +2163,10 @@
 	    (MARK == SP || (gimme == G_SCALAR && !SvTRUE(*SP))) )
 	{
 	    /* Unassume the success we assumed earlier. */
-	    SV * const nsv = cx->blk_eval.old_namesv;
-	    (void)hv_delete(GvHVn(PL_incgv), SvPVX_const(nsv), SvCUR(nsv), G_DISCARD);
-	    DIE(aTHX_ "%"SVf" did not return a true value", SVfARG(nsv));
+	    (void)hv_delete(GvHVn(PL_incgv),
+			    SvPVX_const(namesv), SvCUR(namesv),
+			    G_DISCARD);
+	    DIE(aTHX_ "%"SVf" did not return a true value", SVfARG(namesv));
 	}
 	break;
     case CXt_FORMAT:
@@ -2145,7 +2237,7 @@
     I32 pop2 = 0;
     I32 gimme;
     I32 optype;
-    OP *nextop;
+    OP *nextop = NULL;
     SV **newsp;
     PMOP *newpm;
     SV **mark;
@@ -2169,8 +2261,11 @@
     cxstack_ix++; /* temporarily protect top context */
     mark = newsp;
     switch (CxTYPE(cx)) {
-    case CXt_LOOP:
-	pop2 = CXt_LOOP;
+    case CXt_LOOP_LAZYIV:
+    case CXt_LOOP_LAZYSV:
+    case CXt_LOOP_FOR:
+    case CXt_LOOP_PLAIN:
+	pop2 = CxTYPE(cx);
 	newsp = PL_stack_base + cx->blk_loop.resetsp;
 	nextop = cx->blk_loop.my_op->op_lastop->op_next;
 	break;
@@ -2212,7 +2307,10 @@
     cxstack_ix--;
     /* Stack values are safe: */
     switch (pop2) {
-    case CXt_LOOP:
+    case CXt_LOOP_LAZYIV:
+    case CXt_LOOP_PLAIN:
+    case CXt_LOOP_LAZYSV:
+    case CXt_LOOP_FOR:
 	POPLOOP(cx);	/* release loop vars ... */
 	LEAVE;
 	break;
@@ -2321,9 +2419,11 @@
 	OP *kid;
 	/* First try all the kids at this level, since that's likeliest. */
 	for (kid = cUNOPo->op_first; kid; kid = kid->op_sibling) {
-	    if ((kid->op_type == OP_NEXTSTATE || kid->op_type == OP_DBSTATE) &&
-		    CopLABEL(kCOP) && strEQ(CopLABEL(kCOP), label))
-		return kid;
+	    if (kid->op_type == OP_NEXTSTATE || kid->op_type == OP_DBSTATE) {
+		const char *kid_label = CopLABEL(kCOP);
+		if (kid_label && strEQ(kid_label, label))
+		    return kid;
+	    }
 	}
 	for (kid = cUNOPo->op_first; kid; kid = kid->op_sibling) {
 	    if (kid == PL_lastgotoprobe)
@@ -2471,7 +2571,6 @@
 		    PL_in_eval = CxOLD_IN_EVAL(cx);
 		    PL_eval_root = cx->blk_eval.old_eval_root;
 		    cx->cx_type = CXt_SUB;
-		    cx->blk_sub.hasargs = 0;
 		}
 		cx->blk_sub.cv = cv;
 		cx->blk_sub.olddepth = CvDEPTH(cv);
@@ -2526,7 +2625,7 @@
 		if (PERLDB_SUB) {	/* Checking curstash breaks DProf. */
 		    Perl_get_db_sub(aTHX_ NULL, cv);
 		    if (PERLDB_GOTO) {
-			CV * const gotocv = get_cv("DB::goto", 0);
+			CV * const gotocv = get_cvs("DB::goto", 0);
 			if (gotocv) {
 			    PUSHMARK( PL_stack_sp );
 			    call_sv(MUTABLE_SV(gotocv), G_SCALAR | G_NODEBUG);
@@ -2573,7 +2672,12 @@
 		    break;
                 }
                 /* else fall through */
-	    case CXt_LOOP:
+	    case CXt_LOOP_LAZYIV:
+	    case CXt_LOOP_LAZYSV:
+	    case CXt_LOOP_FOR:
+	    case CXt_LOOP_PLAIN:
+	    case CXt_GIVEN:
+	    case CXt_WHEN:
 		gotoprobe = cx->blk_oldcop->op_sibling;
 		break;
 	    case CXt_SUBST:
@@ -2622,6 +2726,12 @@
                     DIE(aTHX_ "Can't \"goto\" into the middle of a foreach loop");
 	}
 
+	if (*enterops && enterops[1]) {
+	    I32 i = enterops[1]->op_type == OP_ENTER && in_block ? 2 : 1;
+	    if (enterops[i])
+		deprecate("\"goto\" to jump into a construct");
+	}
+
 	/* pop unwanted frames */
 
 	if (ix < cxstack_ix) {
@@ -2723,6 +2833,20 @@
     }
 }
 
+/*
+=for apidoc docatch
+
+Check for the cases 0 or 3 of cur_env.je_ret, only used inside an eval context.
+
+0 is used as continue inside eval,
+
+3 is used for a die caught by an inner eval - continue inner loop
+
+See cop.h: je_mustcatch, when set at any runlevel to TRUE, means eval ops must
+establish a local jmpenv to handle exception traps.
+
+=cut
+*/
 STATIC OP *
 S_docatch(pTHX_ OP *o)
 {
@@ -2774,13 +2898,20 @@
     return NULL;
 }
 
+/* James Bond: Do you expect me to talk?
+   Auric Goldfinger: No, Mr. Bond. I expect you to die.
+
+   This code is an ugly hack, doesn't work with lexicals in subroutines that are
+   called more than once, and is only used by regcomp.c, for (?{}) blocks.
+
+   Currently it is not used outside the core code. Best if it stays that way.
+*/
 OP *
 Perl_sv_compile_2op(pTHX_ SV *sv, OP** startop, const char *code, PAD** padp)
 /* sv Text to convert to OP tree. */
 /* startop op_free() this to undo. */
 /* code Short string id of the caller. */
 {
-    /* FIXME - how much of this code is common with pp_entereval?  */
     dVAR; dSP;				/* Make POPBLOCK work. */
     PERL_CONTEXT *cx;
     SV **newsp;
@@ -2796,7 +2927,7 @@
 
     PERL_ARGS_ASSERT_SV_COMPILE_2OP;
 
-    ENTER;
+    ENTER_with_name("eval");
     lex_start(sv, NULL, FALSE);
     SAVETMPS;
     /* switch to eval mode */
@@ -2843,7 +2974,7 @@
     PL_op->op_type = OP_ENTEREVAL;
     PL_op->op_flags = 0;			/* Avoid uninit warning. */
     PUSHBLOCK(cx, CXt_EVAL|(IN_PERL_COMPILETIME ? 0 : CXp_REAL), SP);
-    PUSHEVAL(cx, 0, NULL);
+    PUSHEVAL(cx, 0);
 
     if (runtime)
 	(void) doeval(G_SCALAR, startop, runcv, PL_curcop->cop_seq);
@@ -2857,7 +2988,7 @@
     lex_end();
     /* XXX DAPM do this properly one year */
     *padp = MUTABLE_AV(SvREFCNT_inc_simple(PL_comppad));
-    LEAVE;
+    LEAVE_with_name("eval");
     if (IN_PERL_COMPILETIME)
 	CopHINTS_set(&PL_compiling, PL_hints);
 #ifdef OP_IN_REGISTER
@@ -2980,8 +3111,9 @@
 	CLEAR_ERRSV();
     if (yyparse() || PL_parser->error_count || !PL_eval_root) {
 	SV **newsp;			/* Used by POPBLOCK. */
-	PERL_CONTEXT *cx = &cxstack[cxstack_ix];
+	PERL_CONTEXT *cx = NULL;
 	I32 optype = 0;			/* Might be reset by POPEVAL. */
+	SV *namesv = NULL;
 	const char *msg;
 
 	PL_op = saveop;
@@ -2993,15 +3125,23 @@
 	if (!startop) {
 	    POPBLOCK(cx,PL_curpm);
 	    POPEVAL(cx);
+	    namesv = cx->blk_eval.old_namesv;
 	}
 	lex_end();
-	LEAVE;
+	LEAVE_with_name("eval"); /* pp_entereval knows about this LEAVE.  */
 
 	msg = SvPVx_nolen_const(ERRSV);
 	if (optype == OP_REQUIRE) {
-	    const SV * const nsv = cx->blk_eval.old_namesv;
-	    (void)hv_store(GvHVn(PL_incgv), SvPVX_const(nsv), SvCUR(nsv),
-                          &PL_sv_undef, 0);
+	    if (!cx) {
+		/* If cx is still NULL, it means that we didn't go in the
+		 * POPEVAL branch. */
+		cx = &cxstack[cxstack_ix];
+		assert(CxTYPE(cx) == CXt_EVAL);
+		namesv = cx->blk_eval.old_namesv;
+	    }
+	    (void)hv_store(GvHVn(PL_incgv),
+			   SvPVX_const(namesv), SvCUR(namesv),
+			   &PL_sv_undef, 0);
 	    Perl_croak(aTHX_ "%sCompilation failed in require",
 		       *msg ? msg : "Unknown error\n");
 	}
@@ -3028,14 +3168,8 @@
 	SAVEFREEOP(PL_eval_root);
 
     /* Set the context for this new optree.
-     * If the last op is an OP_REQUIRE, force scalar context.
-     * Otherwise, propagate the context from the eval(). */
-    if (PL_eval_root->op_type == OP_LEAVEEVAL
-	    && cUNOPx(PL_eval_root)->op_first->op_type == OP_LINESEQ
-	    && cLISTOPx(cUNOPx(PL_eval_root)->op_first)->op_last->op_type
-	    == OP_REQUIRE)
-	scalar(PL_eval_root);
-    else if ((gimme & G_WANT) == G_VOID)
+     * Propagate the context from the eval(). */
+    if ((gimme & G_WANT) == G_VOID)
 	scalarvoid(PL_eval_root);
     else if ((gimme & G_WANT) == G_ARRAY)
 	list(PL_eval_root);
@@ -3046,7 +3180,7 @@
 
     /* Register with debugger: */
     if (PERLDB_INTER && saveop && saveop->op_type == OP_REQUIRE) {
-	CV * const cv = get_cv("DB::postponed", 0);
+	CV * const cv = get_cvs("DB::postponed", 0);
 	if (cv) {
 	    dSP;
 	    PUSHMARK(SP);
@@ -3174,36 +3308,41 @@
 			SVfARG(vnormal(PL_patchlevel)));
 		}
 		else { /* probably 'use 5.10' or 'use 5.8' */
-		    SV * hintsv = newSV(0);
+		    SV *hintsv;
 		    I32 second = 0;
 
 		    if (av_len(lav)>=1) 
 			second = SvIV(*av_fetch(lav,1,0));
 
 		    second /= second >= 600  ? 100 : 10;
-		    hintsv = Perl_newSVpvf(aTHX_ "v%d.%d.%d",
-		    	(int)first, (int)second,0);
+		    hintsv = Perl_newSVpvf(aTHX_ "v%d.%d.0",
+					   (int)first, (int)second);
 		    upg_version(hintsv, TRUE);
 
 		    DIE(aTHX_ "Perl %"SVf" required (did you mean %"SVf"?)"
 		    	"--this is only %"SVf", stopped",
 			SVfARG(vnormal(req)),
-			SVfARG(vnormal(hintsv)),
+			SVfARG(vnormal(sv_2mortal(hintsv))),
 			SVfARG(vnormal(PL_patchlevel)));
 		}
 	    }
 	}
 
-        /* We do this only with use, not require. */
-	if (PL_compcv &&
-	  /* If we request a version >= 5.9.5, load feature.pm with the
-	   * feature bundle that corresponds to the required version. */
-		vcmp(sv, sv_2mortal(upg_version(newSVnv(5.009005), FALSE))) >= 0) {
-	    SV *const importsv = vnormal(sv);
-	    *SvPVX_mutable(importsv) = ':';
-	    ENTER;
-	    Perl_load_module(aTHX_ 0, newSVpvs("feature"), NULL, importsv, NULL);
-	    LEAVE;
+	/* We do this only with "use", not "require" or "no". */
+	if (PL_compcv && !(cUNOP->op_first->op_private & OPpCONST_NOVER)) {
+	    /* If we request a version >= 5.9.5, load feature.pm with the
+	     * feature bundle that corresponds to the required version. */
+	    if (vcmp(sv, sv_2mortal(upg_version(newSVnv(5.009005), FALSE))) >= 0) {
+		SV *const importsv = vnormal(sv);
+		*SvPVX_mutable(importsv) = ':';
+		ENTER_with_name("load_feature");
+		Perl_load_module(aTHX_ 0, newSVpvs("feature"), NULL, importsv, NULL);
+		LEAVE_with_name("load_feature");
+	    }
+	    /* If a version >= 5.11.0 is requested, strictures are on by default! */
+	    if (vcmp(sv, sv_2mortal(upg_version(newSVnv(5.011000), FALSE))) >= 0) {
+		PL_hints |= (HINT_STRICT_REFS | HINT_STRICT_SUBS | HINT_STRICT_VARS);
+	    }
 	}
 
 	RETPUSHYES;
@@ -3252,17 +3391,6 @@
 	tryname = name;
 	tryrsfp = doopen_pm(name, len);
     }
-#ifdef MACOS_TRADITIONAL
-    if (!tryrsfp) {
-	char newname[256];
-
-	MacPerl_CanonDir(name, newname, 1);
-	if (path_is_absolute(newname)) {
-	    tryname = newname;
-	    tryrsfp = doopen_pm(newname, strlen(newname));
-	}
-    }
-#endif
     if (!tryrsfp) {
 	AV * const ar = GvAVn(PL_incgv);
 	I32 i;
@@ -3292,7 +3420,7 @@
 		    tryname = SvPVX_const(namesv);
 		    tryrsfp = NULL;
 
-		    ENTER;
+		    ENTER_with_name("call_INC");
 		    SAVETMPS;
 		    EXTEND(SP, 2);
 
@@ -3306,11 +3434,6 @@
 			count = call_sv(loader, G_ARRAY);
 		    SPAGAIN;
 
-		    /* Adjust file name if the hook has set an %INC entry */
-		    svp = hv_fetch(GvHVn(PL_incgv), name, len, 0);
-		    if (svp)
-			tryname = SvPVX_const(*svp);
-
 		    if (count > 0) {
 			int i = 0;
 			SV *arg;
@@ -3370,7 +3493,13 @@
 
 		    PUTBACK;
 		    FREETMPS;
-		    LEAVE;
+		    LEAVE_with_name("call_INC");
+
+		    /* Adjust file name if the hook has set an %INC entry.
+		       This needs to happen after the FREETMPS above.  */
+		    svp = hv_fetch(GvHVn(PL_incgv), name, len, 0);
+		    if (svp)
+			tryname = SvPV_nolen_const(*svp);
 
 		    if (tryrsfp) {
 			hook_sv = dirsv;
@@ -3393,12 +3522,6 @@
 		}
 		else {
 		  if (!path_is_absolute(name)
-#ifdef MACOS_TRADITIONAL
-			/* We consider paths of the form :a:b ambiguous and interpret them first
-			   as global then as local
-			*/
-			|| (*name == ':' && name[1] != ':' && strchr(name+2, ':'))
-#endif
 		  ) {
 		    const char *dir;
 		    STRLEN dirlen;
@@ -3410,21 +3533,14 @@
 			dirlen = 0;
 		    }
 
-#ifdef MACOS_TRADITIONAL
-		    char buf1[256];
-		    char buf2[256];
-
-		    MacPerl_CanonDir(name, buf2, 1);
-		    Perl_sv_setpvf(aTHX_ namesv, "%s%s", MacPerl_CanonDir(dir, buf1, 0), buf2+(buf2[0] == ':'));
-#else
-#  ifdef VMS
+#ifdef VMS
 		    char *unixdir;
 		    if ((unixdir = tounixpath(dir, NULL)) == NULL)
 			continue;
 		    sv_setpv(namesv, unixdir);
 		    sv_catpv(namesv, unixname);
-#  else
-#    ifdef __SYMBIAN32__
+#else
+#  ifdef __SYMBIAN32__
 		    if (PL_origfilename[0] &&
 			PL_origfilename[1] == ':' &&
 			!(dir[0] && dir[1] == ':'))
@@ -3436,7 +3552,7 @@
 		        Perl_sv_setpvf(aTHX_ namesv,
 				       "%s\\%s",
 				       dir, name);
-#    else
+#  else
 		    /* The equivalent of		    
 		       Perl_sv_setpvf(aTHX_ namesv, "%s/%s", dir, name);
 		       but without the need to parse the format string, or
@@ -3457,15 +3573,16 @@
 			/* Don't even actually have to turn SvPOK_on() as we
 			   access it directly with SvPVX() below.  */
 		    }
-#    endif
 #  endif
 #endif
 		    TAINT_PROPER("require");
 		    tryname = SvPVX_const(namesv);
 		    tryrsfp = doopen_pm(tryname, SvCUR(namesv));
 		    if (tryrsfp) {
-			if (tryname[0] == '.' && tryname[1] == '/')
-			    tryname += 2;
+			if (tryname[0] == '.' && tryname[1] == '/') {
+			    ++tryname;
+			    while (*++tryname == '/');
+			}
 			break;
 		    }
 		    else if (errno == EMFILE)
@@ -3529,16 +3646,13 @@
 			   unixname, unixlen, SvREFCNT_inc_simple(hook_sv), 0 );
     }
 
-    ENTER;
+    ENTER_with_name("eval");
     SAVETMPS;
     lex_start(NULL, tryrsfp, TRUE);
 
     SAVEHINTS();
     PL_hints = 0;
-    if (PL_compiling.cop_hints_hash) {
-	Perl_refcounted_he_free(aTHX_ PL_compiling.cop_hints_hash);
-	PL_compiling.cop_hints_hash = NULL;
-    }
+    hv_clear(GvHV(PL_hintgv));
 
     SAVECOMPILEWARNINGS();
     if (PL_dowarn & G_WARN_ALL_ON)
@@ -3549,16 +3663,19 @@
         PL_compiling.cop_warnings = pWARN_STD ;
 
     if (filter_sub || filter_cache) {
-	SV * const datasv = filter_add(S_run_user_filter, NULL);
+	/* We can use the SvPV of the filter PVIO itself as our cache, rather
+	   than hanging another SV from it. In turn, filter_add() optionally
+	   takes the SV to use as the filter (or creates a new SV if passed
+	   NULL), so simply pass in whatever value filter_cache has.  */
+	SV * const datasv = filter_add(S_run_user_filter, filter_cache);
 	IoLINES(datasv) = filter_has_file;
 	IoTOP_GV(datasv) = MUTABLE_GV(filter_state);
 	IoBOTTOM_GV(datasv) = MUTABLE_GV(filter_sub);
-	IoFMT_GV(datasv) = MUTABLE_GV(filter_cache);
     }
 
     /* switch to eval mode */
     PUSHBLOCK(cx, CXt_EVAL, SP);
-    PUSHEVAL(cx, name, NULL);
+    PUSHEVAL(cx, name);
     cx->blk_eval.retop = PL_op->op_next;
 
     SAVECOPLINE(&PL_compiling);
@@ -3581,6 +3698,19 @@
     return op;
 }
 
+/* This is a op added to hold the hints hash for
+   pp_entereval. The hash can be modified by the code
+   being eval'ed, so we return a copy instead. */
+
+PP(pp_hintseval)
+{
+    dVAR;
+    dSP;
+    mXPUSHs(MUTABLE_SV(Perl_hv_copy_hints_hv(aTHX_ MUTABLE_HV(cSVOP_sv))));
+    RETURN;
+}
+
+
 PP(pp_entereval)
 {
     dVAR; dSP;
@@ -3590,15 +3720,11 @@
     const U32 was = PL_breakable_sub_gen;
     char tbuf[TYPE_DIGITS(long) + 12];
     char *tmpbuf = tbuf;
-    char *safestr;
     STRLEN len;
-    bool ok;
     CV* runcv;
     U32 seq;
     HV *saved_hh = NULL;
-    const char * const fakestr = "_<(eval )";
-    const int fakelen = 9 + 1;
-    
+
     if (PL_op->op_private & OPpEVAL_HAS_HH) {
 	saved_hh = MUTABLE_HV(SvREFCNT_inc(POPs));
     }
@@ -3607,7 +3733,7 @@
     TAINT_IF(SvTAINTED(sv));
     TAINT_PROPER("eval");
 
-    ENTER;
+    ENTER_with_name("eval");
     lex_start(sv, NULL, FALSE);
     SAVETMPS;
 
@@ -3632,8 +3758,6 @@
        (i.e. before run-time proper). To work around the coredump that
        ensues, we always turn GvMULTI_on for any globals that were
        introduced within evals. See force_ident(). GSAR 96-10-12 */
-    safestr = savepvn(tmpbuf, len);
-    SAVEDELETE(PL_defstash, safestr, len);
     SAVEHINTS();
     PL_hints = PL_op->op_targ;
     if (saved_hh) {
@@ -3646,7 +3770,18 @@
     if (PL_compiling.cop_hints_hash) {
 	Perl_refcounted_he_free(aTHX_ PL_compiling.cop_hints_hash);
     }
-    PL_compiling.cop_hints_hash = PL_curcop->cop_hints_hash;
+    if (Perl_fetch_cop_label(aTHX_ PL_curcop->cop_hints_hash, NULL, NULL)) {
+	/* The label, if present, is the first entry on the chain. So rather
+	   than writing a blank label in front of it (which involves an
+	   allocation), just use the next entry in the chain.  */
+	PL_compiling.cop_hints_hash
+	    = PL_curcop->cop_hints_hash->refcounted_he_next;
+	/* Check the assumption that this removed the label.  */
+	assert(Perl_fetch_cop_label(aTHX_ PL_compiling.cop_hints_hash, NULL,
+				    NULL) == NULL);
+    }
+    else
+	PL_compiling.cop_hints_hash = PL_curcop->cop_hints_hash;
     if (PL_compiling.cop_hints_hash) {
 	HINTS_REFCNT_LOCK;
 	PL_compiling.cop_hints_hash->refcounted_he_refcnt++;
@@ -3660,7 +3795,7 @@
     runcv = find_runcv(&seq);
 
     PUSHBLOCK(cx, (CXt_EVAL|CXp_REAL), SP);
-    PUSHEVAL(cx, 0, NULL);
+    PUSHEVAL(cx, 0);
     cx->blk_eval.retop = PL_op->op_next;
 
     /* prepare to compile string */
@@ -3668,24 +3803,29 @@
     if ((PERLDB_LINE || PERLDB_SAVESRC) && PL_curstash != PL_debstash)
 	save_lines(CopFILEAV(&PL_compiling), PL_parser->linestr);
     PUTBACK;
-    ok = doeval(gimme, NULL, runcv, seq);
-    if (ok ? (was != PL_breakable_sub_gen /* Some subs defined here. */
-	      ? (PERLDB_LINE || PERLDB_SAVESRC)
-	      :  PERLDB_SAVESRC_NOSUBS)
-	: 0 /* PERLDB_SAVESRC_INVALID */
-	/* Much that I'd like to think that it was this trivial to add this
-	   feature, it's not, due to
-	       lex_end();
-	       LEAVE;
-	   in S_doeval() for the failure case. So really we want a more
-	   sophisticated way of (optionally) clearing the source code.
-	   Particularly as the current way is buggy, as a syntactically
-	   invalid eval string can still define a subroutine that is retained,
-	   and the user may wish to breakpoint. */) {
-	/* Copy in anything fake and short. */
-	my_strlcpy(safestr, fakestr, fakelen);
+
+    if (doeval(gimme, NULL, runcv, seq)) {
+	if (was != PL_breakable_sub_gen /* Some subs defined here. */
+	    ? (PERLDB_LINE || PERLDB_SAVESRC)
+	    :  PERLDB_SAVESRC_NOSUBS) {
+	    /* Retain the filegv we created.  */
+	} else {
+	    char *const safestr = savepvn(tmpbuf, len);
+	    SAVEDELETE(PL_defstash, safestr, len);
+	}
+	return DOCATCH(PL_eval_start);
+    } else {
+	/* We have already left the scope set up earler thanks to the LEAVE
+	   in doeval().  */
+	if (was != PL_breakable_sub_gen /* Some subs defined here. */
+	    ? (PERLDB_LINE || PERLDB_SAVESRC)
+	    :  PERLDB_SAVESRC_INVALID) {
+	    /* Retain the filegv we created.  */
+	} else {
+	    (void)hv_delete(PL_defstash, tmpbuf, len, G_DISCARD);
+	}
+	return PL_op->op_next;
     }
-    return ok ? DOCATCH(PL_eval_start) : PL_op->op_next;
 }
 
 PP(pp_leaveeval)
@@ -3699,9 +3839,11 @@
     OP *retop;
     const U8 save_flags = PL_op -> op_flags;
     I32 optype;
+    SV *namesv;
 
     POPBLOCK(cx,newpm);
     POPEVAL(cx);
+    namesv = cx->blk_eval.old_namesv;
     retop = cx->blk_eval.retop;
 
     TAINT_NOT;
@@ -3742,13 +3884,15 @@
 	!(gimme == G_SCALAR ? SvTRUE(*SP) : SP > newsp))
     {
 	/* Unassume the success we assumed earlier. */
-	SV * const nsv = cx->blk_eval.old_namesv;
-	(void)hv_delete(GvHVn(PL_incgv), SvPVX_const(nsv), SvCUR(nsv), G_DISCARD);
-	retop = Perl_die(aTHX_ "%"SVf" did not return a true value", SVfARG(nsv));
+	(void)hv_delete(GvHVn(PL_incgv),
+			SvPVX_const(namesv), SvCUR(namesv),
+			G_DISCARD);
+	retop = Perl_die(aTHX_ "%"SVf" did not return a true value",
+			 SVfARG(namesv));
 	/* die_where() did LEAVE, or we won't be here */
     }
     else {
-	LEAVE;
+	LEAVE_with_name("eval");
 	if (!(save_flags & OPf_SPECIAL)) {
 	    CLEAR_ERRSV();
 	}
@@ -3771,7 +3915,7 @@
     POPBLOCK(cx,newpm);
     POPEVAL(cx);
     PL_curpm = newpm;
-    LEAVE;
+    LEAVE_with_name("eval_scope");
     PERL_UNUSED_VAR(newsp);
     PERL_UNUSED_VAR(gimme);
     PERL_UNUSED_VAR(optype);
@@ -3785,11 +3929,11 @@
     PERL_CONTEXT *cx;
     const I32 gimme = GIMME_V;
 	
-    ENTER;
+    ENTER_with_name("eval_scope");
     SAVETMPS;
 
     PUSHBLOCK(cx, (CXt_EVAL|CXp_TRYBLOCK), PL_stack_sp);
-    PUSHEVAL(cx, 0, 0);
+    PUSHEVAL(cx, 0);
 
     PL_in_eval = EVAL_INEVAL;
     if (flags & G_KEEPERR)
@@ -3853,7 +3997,7 @@
     }
     PL_curpm = newpm;	/* Don't pop $1 et al till now */
 
-    LEAVE;
+    LEAVE_with_name("eval_scope");
     CLEAR_ERRSV();
     RETURN;
 }
@@ -3864,16 +4008,10 @@
     register PERL_CONTEXT *cx;
     const I32 gimme = GIMME_V;
     
-    ENTER;
+    ENTER_with_name("given");
     SAVETMPS;
 
-    if (PL_op->op_targ == 0) {
-	SV ** const defsv_p = &GvSV(PL_defgv);
-	*defsv_p = newSVsv(POPs);
-	SAVECLEARSV(*defsv_p);
-    }
-    else
-    	sv_setsv(PAD_SV(PL_op->op_targ), POPs);
+    sv_setsv(PAD_SV(PL_op->op_targ), POPs);
 
     PUSHBLOCK(cx, CXt_GIVEN, SP);
     PUSHGIVEN(cx);
@@ -3898,7 +4036,7 @@
 
     PL_curpm = newpm;   /* pop $1 et al */
 
-    LEAVE;
+    LEAVE_with_name("given");
 
     return NORMAL;
 }
@@ -3915,7 +4053,7 @@
     PM_SETRE(matcher, ReREFCNT_inc(re));
 
     SAVEFREEOP((OP *) matcher);
-    ENTER; SAVETMPS;
+    ENTER_with_name("matcher"); SAVETMPS;
     SAVEOP();
     return matcher;
 }
@@ -3945,12 +4083,13 @@
     PERL_UNUSED_ARG(matcher);
 
     FREETMPS;
-    LEAVE;
+    LEAVE_with_name("matcher");
 }
 
 /* Do a smart match */
 PP(pp_smartmatch)
 {
+    DEBUG_M(Perl_deb(aTHX_ "Starting smart match resolution\n"));
     return do_smartmatch(NULL, NULL);
 }
 
@@ -3966,21 +4105,21 @@
     bool object_on_left = FALSE;
     SV *e = TOPs;	/* e is for 'expression' */
     SV *d = TOPm1s;	/* d is for 'default', as in PL_defgv */
-    MAGIC *mg;
-
-#   define SM_ISREGEX(x) \
-	(SvROK(x) && SvMAGICAL(SvRV(x)) \
-	&& (mg = mg_find(SvRV(x), PERL_MAGIC_qr)))
 
     /* First of all, handle overload magic of the rightmost argument */
     if (SvAMAGIC(e)) {
-	SV * const tmpsv = amagic_call(d, e, smart_amg, 0);
+	SV * tmpsv;
+	DEBUG_M(Perl_deb(aTHX_ "    applying rule Any-Object\n"));
+	DEBUG_M(Perl_deb(aTHX_ "        attempting overload\n"));
+
+	tmpsv = amagic_call(d, e, smart_amg, 0);
 	if (tmpsv) {
 	    SPAGAIN;
 	    (void)POPs;
 	    SETs(tmpsv);
 	    RETURN;
 	}
+	DEBUG_M(Perl_deb(aTHX_ "        failed to run overload method; continuing...\n"));
     }
 
     SP -= 2;	/* Pop the values */
@@ -4000,15 +4139,18 @@
 
     /* ~~ undef */
     if (!SvOK(e)) {
+	DEBUG_M(Perl_deb(aTHX_ "    applying rule Any-undef\n"));
 	if (SvOK(d))
 	    RETPUSHNO;
 	else
 	    RETPUSHYES;
     }
 
-    if (sv_isobject(e) && !SM_ISREGEX(e))
+    if (sv_isobject(e) && (SvTYPE(SvRV(e)) != SVt_REGEXP)) {
+	DEBUG_M(Perl_deb(aTHX_ "    applying rule Any-Object\n"));
 	Perl_croak(aTHX_ "Smart matching a non-overloaded object breaks encapsulation");
-    if (sv_isobject(d) && !SM_ISREGEX(d))
+    }
+    if (sv_isobject(d) && (SvTYPE(SvRV(d)) != SVt_REGEXP))
 	object_on_left = TRUE;
 
     /* ~~ sub */
@@ -4023,10 +4165,12 @@
 	    bool andedresults = TRUE;
 	    HV *hv = (HV*) SvRV(d);
 	    I32 numkeys = hv_iterinit(hv);
+	    DEBUG_M(Perl_deb(aTHX_ "    applying rule Hash-CodeRef\n"));
 	    if (numkeys == 0)
 		RETPUSHYES;
 	    while ( (he = hv_iternext(hv)) ) {
-		ENTER;
+		DEBUG_M(Perl_deb(aTHX_ "        testing hash key...\n"));
+		ENTER_with_name("smartmatch_hash_key_test");
 		SAVETMPS;
 		PUSHMARK(SP);
 		PUSHs(hv_iterkeysv(he));
@@ -4038,7 +4182,7 @@
 		else
 		    andedresults = SvTRUEx(POPs) && andedresults;
 		FREETMPS;
-		LEAVE;
+		LEAVE_with_name("smartmatch_hash_key_test");
 	    }
 	    if (andedresults)
 		RETPUSHYES;
@@ -4051,11 +4195,13 @@
 	    bool andedresults = TRUE;
 	    AV *av = (AV*) SvRV(d);
 	    const I32 len = av_len(av);
+	    DEBUG_M(Perl_deb(aTHX_ "    applying rule Array-CodeRef\n"));
 	    if (len == -1)
 		RETPUSHYES;
 	    for (i = 0; i <= len; ++i) {
 		SV * const * const svp = av_fetch(av, i, FALSE);
-		ENTER;
+		DEBUG_M(Perl_deb(aTHX_ "        testing array element...\n"));
+		ENTER_with_name("smartmatch_array_elem_test");
 		SAVETMPS;
 		PUSHMARK(SP);
 		if (svp)
@@ -4068,7 +4214,7 @@
 		else
 		    andedresults = SvTRUEx(POPs) && andedresults;
 		FREETMPS;
-		LEAVE;
+		LEAVE_with_name("smartmatch_array_elem_test");
 	    }
 	    if (andedresults)
 		RETPUSHYES;
@@ -4077,7 +4223,8 @@
 	}
 	else {
 	  sm_any_sub:
-	    ENTER;
+	    DEBUG_M(Perl_deb(aTHX_ "    applying rule Any-CodeRef\n"));
+	    ENTER_with_name("smartmatch_coderef");
 	    SAVETMPS;
 	    PUSHMARK(SP);
 	    PUSHs(d);
@@ -4089,7 +4236,7 @@
 	    else if (SvTEMP(TOPs))
 		SvREFCNT_inc_void(TOPs);
 	    FREETMPS;
-	    LEAVE;
+	    LEAVE_with_name("smartmatch_coderef");
 	    RETURN;
 	}
     }
@@ -4099,6 +4246,7 @@
 	    goto sm_any_hash; /* Treat objects like scalars */
 	}
 	else if (!SvOK(d)) {
+	    DEBUG_M(Perl_deb(aTHX_ "    applying rule Any-Hash ($a undef)\n"));
 	    RETPUSHNO;
 	}
 	else if (SvROK(d) && SvTYPE(SvRV(d)) == SVt_PVHV) {
@@ -4110,7 +4258,8 @@
 	    U32 this_key_count  = 0,
 	        other_key_count = 0;
 	    HV *hv = MUTABLE_HV(SvRV(e));
-	    
+
+	    DEBUG_M(Perl_deb(aTHX_ "    applying rule Hash-Hash\n"));
 	    /* Tied hashes don't know how many keys they have. */
 	    if (SvTIED_mg((SV*)hv, PERL_MAGIC_tied)) {
 		tied = TRUE;
@@ -4132,7 +4281,8 @@
 	    (void) hv_iterinit(hv);
 	    while ( (he = hv_iternext(hv)) ) {
 		SV *key = hv_iterkeysv(he);
-	    	
+
+		DEBUG_M(Perl_deb(aTHX_ "        comparing hash key...\n"));
 	    	++ this_key_count;
 	    	
 	    	if(!hv_exists_ent(other_hv, key, 0)) {
@@ -4160,8 +4310,10 @@
 	    I32 i;
 	    HV *hv = MUTABLE_HV(SvRV(e));
 
+	    DEBUG_M(Perl_deb(aTHX_ "    applying rule Array-Hash\n"));
 	    for (i = 0; i < other_len; ++i) {
 		SV ** const svp = av_fetch(other_av, i, FALSE);
+		DEBUG_M(Perl_deb(aTHX_ "        checking for key existence...\n"));
 		if (svp) {	/* ??? When can this not happen? */
 		    if (hv_exists_ent(hv, *svp, 0))
 		        RETPUSHYES;
@@ -4169,22 +4321,17 @@
 	    }
 	    RETPUSHNO;
 	}
-	else if (SM_ISREGEX(d)) {
+	else if (SvROK(d) && SvTYPE(SvRV(d)) == SVt_REGEXP) {
+	    DEBUG_M(Perl_deb(aTHX_ "    applying rule Regex-Hash\n"));
 	  sm_regex_hash:
 	    {
-#ifdef DEBUGGING
-		/* if arrive via goto, no guarantee mg is from d */
-		MAGIC* old_mg = mg;
-		assert(SM_ISREGEX(d) && old_mg == mg);
-		{
-#endif
-		PMOP * const matcher = make_matcher((REGEXP*) mg->mg_obj);
-
+		PMOP * const matcher = make_matcher((REGEXP*) SvRV(d));
 		HE *he;
 		HV *hv = MUTABLE_HV(SvRV(e));
 
 		(void) hv_iterinit(hv);
 		while ( (he = hv_iternext(hv)) ) {
+		    DEBUG_M(Perl_deb(aTHX_ "        testing key against pattern...\n"));
 		    if (matcher_matches_sv(matcher, hv_iterkeysv(he))) {
 			(void) hv_iterinit(hv);
 			destroy_matcher(matcher);
@@ -4193,13 +4340,11 @@
 		}
 		destroy_matcher(matcher);
 		RETPUSHNO;
-#ifdef DEBUGGING
-		}
-#endif
 	    }
 	}
 	else {
 	  sm_any_hash:
+	    DEBUG_M(Perl_deb(aTHX_ "    applying rule Any-Hash\n"));
 	    if (hv_exists_ent(MUTABLE_HV(SvRV(e)), d, 0))
 		RETPUSHYES;
 	    else
@@ -4216,8 +4361,11 @@
 	    const I32 other_len = av_len(other_av) + 1;
 	    I32 i;
 
+	    DEBUG_M(Perl_deb(aTHX_ "    applying rule Hash-Array\n"));
 	    for (i = 0; i < other_len; ++i) {
 		SV ** const svp = av_fetch(other_av, i, FALSE);
+
+		DEBUG_M(Perl_deb(aTHX_ "        testing for key existence...\n"));
 		if (svp) {	/* ??? When can this not happen? */
 		    if (hv_exists_ent(MUTABLE_HV(SvRV(d)), *svp, 0))
 		        RETPUSHYES;
@@ -4227,6 +4375,7 @@
 	}
 	if (SvROK(d) && SvTYPE(SvRV(d)) == SVt_PVAV) {
 	    AV *other_av = MUTABLE_AV(SvRV(d));
+	    DEBUG_M(Perl_deb(aTHX_ "    applying rule Array-Array\n"));
 	    if (av_len(MUTABLE_AV(SvRV(e))) != av_len(other_av))
 		RETPUSHNO;
 	    else {
@@ -4238,7 +4387,7 @@
 		    (void) sv_2mortal(MUTABLE_SV(seen_this));
 		}
 		if (NULL == seen_other) {
-		    seen_this = newHV();
+		    seen_other = newHV();
 		    (void) sv_2mortal(MUTABLE_SV(seen_other));
 		}
 		for(i = 0; i <= other_len; ++i) {
@@ -4246,7 +4395,8 @@
 		    SV * const * const other_elem = av_fetch(other_av, i, FALSE);
 
 		    if (!this_elem || !other_elem) {
-			if (this_elem || other_elem)
+			if ((this_elem && SvOK(*this_elem))
+				|| (other_elem && SvOK(*other_elem)))
 			    RETPUSHNO;
 		    }
 		    else if (hv_exists_ent(seen_this,
@@ -4268,8 +4418,10 @@
 			PUSHs(*this_elem);
 			
 			PUTBACK;
+			DEBUG_M(Perl_deb(aTHX_ "        recursively comparing array element...\n"));
 			(void) do_smartmatch(seen_this, seen_other);
 			SPAGAIN;
+			DEBUG_M(Perl_deb(aTHX_ "        recursion finished\n"));
 			
 			if (!SvTRUEx(POPs))
 			    RETPUSHNO;
@@ -4278,21 +4430,17 @@
 		RETPUSHYES;
 	    }
 	}
-	else if (SM_ISREGEX(d)) {
+	else if (SvROK(d) && SvTYPE(SvRV(d)) == SVt_REGEXP) {
+	    DEBUG_M(Perl_deb(aTHX_ "    applying rule Regex-Array\n"));
 	  sm_regex_array:
 	    {
-#ifdef DEBUGGING
-		/* if arrive via goto, no guarantee mg is from d */
-		MAGIC* old_mg = mg;
-		assert(SM_ISREGEX(d) && old_mg == mg);
-		{
-#endif
-		PMOP * const matcher = make_matcher((REGEXP*) mg->mg_obj);
+		PMOP * const matcher = make_matcher((REGEXP*) SvRV(d));
 		const I32 this_len = av_len(MUTABLE_AV(SvRV(e)));
 		I32 i;
 
 		for(i = 0; i <= this_len; ++i) {
 		    SV * const * const svp = av_fetch(MUTABLE_AV(SvRV(e)), i, FALSE);
+		    DEBUG_M(Perl_deb(aTHX_ "        testing element against pattern...\n"));
 		    if (svp && matcher_matches_sv(matcher, *svp)) {
 			destroy_matcher(matcher);
 			RETPUSHYES;
@@ -4300,9 +4448,6 @@
 		}
 		destroy_matcher(matcher);
 		RETPUSHNO;
-#ifdef DEBUGGING
-		}
-#endif
 	    }
 	}
 	else if (!SvOK(d)) {
@@ -4310,8 +4455,10 @@
 	    const I32 this_len = av_len(MUTABLE_AV(SvRV(e)));
 	    I32 i;
 
+	    DEBUG_M(Perl_deb(aTHX_ "    applying rule Undef-Array\n"));
 	    for (i = 0; i <= this_len; ++i) {
 		SV * const * const svp = av_fetch(MUTABLE_AV(SvRV(e)), i, FALSE);
+		DEBUG_M(Perl_deb(aTHX_ "        testing for undef element...\n"));
 		if (!svp || !SvOK(*svp))
 		    RETPUSHYES;
 	    }
@@ -4323,6 +4470,7 @@
 		I32 i;
 		const I32 this_len = av_len(MUTABLE_AV(SvRV(e)));
 
+		DEBUG_M(Perl_deb(aTHX_ "    applying rule Any-Array\n"));
 		for (i = 0; i <= this_len; ++i) {
 		    SV * const * const svp = av_fetch(MUTABLE_AV(SvRV(e)), i, FALSE);
 		    if (!svp)
@@ -4332,8 +4480,10 @@
 		    PUSHs(*svp);
 		    PUTBACK;
 		    /* infinite recursion isn't supposed to happen here */
+		    DEBUG_M(Perl_deb(aTHX_ "        recursively testing array element...\n"));
 		    (void) do_smartmatch(NULL, NULL);
 		    SPAGAIN;
+		    DEBUG_M(Perl_deb(aTHX_ "        recursion finished\n"));
 		    if (SvTRUEx(POPs))
 			RETPUSHYES;
 		}
@@ -4342,18 +4492,21 @@
 	}
     }
     /* ~~ qr// */
-    else if (SM_ISREGEX(e)) {
+    else if (SvROK(e) && SvTYPE(SvRV(e)) == SVt_REGEXP) {
 	if (!object_on_left && SvROK(d) && SvTYPE(SvRV(d)) == SVt_PVHV) {
 	    SV *t = d; d = e; e = t;
+	    DEBUG_M(Perl_deb(aTHX_ "    applying rule Hash-Regex\n"));
 	    goto sm_regex_hash;
 	}
 	else if (!object_on_left && SvROK(d) && SvTYPE(SvRV(d)) == SVt_PVAV) {
 	    SV *t = d; d = e; e = t;
+	    DEBUG_M(Perl_deb(aTHX_ "    applying rule Array-Regex\n"));
 	    goto sm_regex_array;
 	}
 	else {
-	    PMOP * const matcher = make_matcher((REGEXP*) mg->mg_obj);
+	    PMOP * const matcher = make_matcher((REGEXP*) SvRV(e));
 
+	    DEBUG_M(Perl_deb(aTHX_ "    applying rule Any-Regex\n"));
 	    PUTBACK;
 	    PUSHs(matcher_matches_sv(matcher, d)
 		    ? &PL_sv_yes
@@ -4366,6 +4519,8 @@
     /* See if there is overload magic on left */
     else if (object_on_left && SvAMAGIC(d)) {
 	SV *tmpsv;
+	DEBUG_M(Perl_deb(aTHX_ "    applying rule Object-Any\n"));
+	DEBUG_M(Perl_deb(aTHX_ "        attempting overload\n"));
 	PUSHs(d); PUSHs(e);
 	PUTBACK;
 	tmpsv = amagic_call(d, e, smart_amg, AMGf_noright);
@@ -4376,15 +4531,22 @@
 	    RETURN;
 	}
 	SP -= 2;
+	DEBUG_M(Perl_deb(aTHX_ "        failed to run overload method; falling back...\n"));
 	goto sm_any_scalar;
     }
     else if (!SvOK(d)) {
 	/* undef ~~ scalar ; we already know that the scalar is SvOK */
+	DEBUG_M(Perl_deb(aTHX_ "    applying rule undef-Any\n"));
 	RETPUSHNO;
     }
     else
   sm_any_scalar:
     if (SvNIOK(e) || (SvPOK(e) && looks_like_number(e) && SvNIOK(d))) {
+	DEBUG_M(if (SvNIOK(e))
+		    Perl_deb(aTHX_ "    applying rule Any-Num\n");
+		else
+		    Perl_deb(aTHX_ "    applying rule Num-numish\n");
+	);
 	/* numeric comparison */
 	PUSHs(d); PUSHs(e);
 	PUTBACK;
@@ -4400,11 +4562,11 @@
     }
     
     /* As a last resort, use string comparison */
+    DEBUG_M(Perl_deb(aTHX_ "    applying rule Any-Any\n"));
     PUSHs(d); PUSHs(e);
     PUTBACK;
     return pp_seq();
 }
-#undef SM_ISREGEX
 
 PP(pp_enterwhen)
 {
@@ -4420,7 +4582,7 @@
     if ((0 == (PL_op->op_flags & OPf_SPECIAL)) && !SvTRUEx(POPs))
 	return cLOGOP->op_other->op_next;
 
-    ENTER;
+    ENTER_with_name("eval");
     SAVETMPS;
 
     PUSHBLOCK(cx, CXt_WHEN, SP);
@@ -4445,7 +4607,7 @@
 
     PL_curpm = newpm;   /* pop $1 et al */
 
-    LEAVE;
+    LEAVE_with_name("eval");
     return NORMAL;
 }
 
@@ -4762,8 +4924,8 @@
     int status = 0;
     SV *upstream;
     STRLEN got_len;
-    const char *got_p = NULL;
-    const char *prune_from = NULL;
+    char *got_p = NULL;
+    char *prune_from = NULL;
     bool read_from_cache = FALSE;
     STRLEN umaxlen;
 
@@ -4777,8 +4939,8 @@
        for PL_parser->error_count == 0.)  Solaris doesn't segfault --
        not sure where the trouble is yet.  XXX */
 
-    if (IoFMT_GV(datasv)) {
-	SV *const cache = MUTABLE_SV(IoFMT_GV(datasv));
+    {
+	SV *const cache = datasv;
 	if (SvOK(cache)) {
 	    STRLEN cache_len;
 	    const char *cache_p = SvPV(cache, cache_len);
@@ -4832,7 +4994,7 @@
 	dSP;
 	int count;
 
-	ENTER;
+	ENTER_with_name("call_filter_sub");
 	SAVE_DEFSV;
 	SAVETMPS;
 	EXTEND(SP, 2);
@@ -4856,7 +5018,7 @@
 
 	PUTBACK;
 	FREETMPS;
-	LEAVE;
+	LEAVE_with_name("call_filter_sub");
     }
 
     if(SvOK(upstream)) {
@@ -4866,8 +5028,7 @@
 		prune_from = got_p + umaxlen;
 	    }
 	} else {
-	    const char *const first_nl =
-		(const char *)memchr(got_p, '\n', got_len);
+	    char *const first_nl = (char *)memchr(got_p, '\n', got_len);
 	    if (first_nl && first_nl + 1 < got_p + got_len) {
 		/* There's a second line here... */
 		prune_from = first_nl + 1;
@@ -4877,11 +5038,9 @@
     if (prune_from) {
 	/* Oh. Too long. Stuff some in our cache.  */
 	STRLEN cached_len = got_p + got_len - prune_from;
-	SV *cache = MUTABLE_SV(IoFMT_GV(datasv));
+	SV *const cache = datasv;
 
-	if (!cache) {
-	    IoFMT_GV(datasv) = MUTABLE_GV((cache = newSV(got_len - umaxlen)));
-	} else if (SvOK(cache)) {
+	if (SvOK(cache)) {
 	    /* Cache should be empty.  */
 	    assert(!SvCUR(cache));
 	}
@@ -4895,6 +5054,7 @@
 	    SvUTF8_on(cache);
 	}
 	SvCUR_set(upstream, got_len - cached_len);
+	*prune_from = 0;
 	/* Can't yet be EOF  */
 	if (status == 0)
 	    status = 1;
@@ -4910,7 +5070,6 @@
 
     if (status <= 0) {
 	IoLINES(datasv) = 0;
-	SvREFCNT_dec(IoFMT_GV(datasv));
 	if (filter_state) {
 	    SvREFCNT_dec(filter_state);
 	    IoTOP_GV(datasv) = NULL;
@@ -4938,15 +5097,12 @@
     PERL_ARGS_ASSERT_PATH_IS_ABSOLUTE;
 
     if (PERL_FILE_IS_ABSOLUTE(name)
-#ifdef MACOS_TRADITIONAL
-	|| (*name == ':')
-#endif
 #ifdef WIN32
- || (*name == '.' && ((name[1] == '/' ||
- (name[1] == '.' && name[2] == '/'))
- || (name[1] == '\\' ||
- ( name[1] == '.' && name[2] == '\\')))
- )
+	|| (*name == '.' && ((name[1] == '/' ||
+			     (name[1] == '.' && name[2] == '/'))
+			 || (name[1] == '\\' ||
+			     ( name[1] == '.' && name[2] == '\\')))
+	    )
 #else
 	|| (*name == '.' && (name[1] == '/' ||
 			     (name[1] == '.' && name[2] == '/')))
Index: src/gnu/usr.bin/perl/pp_hot.c
diff -u src/gnu/usr.bin/perl/pp_hot.c:1.13 src/gnu/usr.bin/perl/pp_hot.c:1.14
--- pp_hot.c:1.13	Mon Oct 12 18:24:21 2009
+++ pp_hot.c	Fri Sep 24 15:06:42 2010
@@ -41,14 +41,7 @@
 {
     dVAR;
     dSP;
-    if ( PL_op->op_flags & OPf_SPECIAL )
-        /* This is a const op added to hold the hints hash for
-           pp_entereval. The hash can be modified by the code
-           being eval'ed, so we return a copy instead. */
-        mXPUSHs((SV*)Perl_hv_copy_hints_hv(aTHX_ (HV*)cSVOP_sv));
-    else
-        /* Normal const. */
-        XPUSHs(cSVOP_sv);
+    XPUSHs(cSVOP_sv);
     RETURN;
 }
 
@@ -80,13 +73,6 @@
     return NORMAL;
 }
 
-PP(pp_setstate)
-{
-    dVAR;
-    PL_curcop = (COP*)PL_op;
-    return NORMAL;
-}
-
 PP(pp_pushmark)
 {
     dVAR;
@@ -152,7 +138,7 @@
 		   The gv becomes a(nother) reference to the constant.  */
 		SV *const value = SvRV(cv);
 
-		SvUPGRADE(MUTABLE_SV(gv), SVt_RV);
+		SvUPGRADE(MUTABLE_SV(gv), SVt_IV);
 		SvPCS_IMPORTED_on(gv);
 		SvRV_set(gv, value);
 		SvREFCNT_inc_simple_void(value);
@@ -171,7 +157,7 @@
 	    /* We've been returned a constant rather than a full subroutine,
 	       but they expect a subroutine reference to apply.  */
 	    if (SvROK(cv)) {
-		ENTER;
+		ENTER_with_name("sassign_coderef");
 		SvREFCNT_inc_void(SvRV(cv));
 		/* newCONSTSUB takes a reference count on the passed in SV
 		   from us.  We set the name to NULL, otherwise we get into
@@ -181,7 +167,7 @@
 		SvRV_set(left, MUTABLE_SV(newCONSTSUB(GvSTASH(right), NULL,
 						      SvRV(cv))));
 		SvREFCNT_dec(cv);
-		LEAVE;
+		LEAVE_with_name("sassign_coderef");
 	    } else {
 		/* What can happen for the corner case *{"BONK"} = \&{"BONK"};
 		   is that
@@ -733,14 +719,14 @@
 	PUSHMARK(MARK - 1);
 	*MARK = SvTIED_obj(MUTABLE_SV(io), mg);
 	PUTBACK;
-	ENTER;
+	ENTER_with_name("call_PRINT");
 	if( PL_op->op_type == OP_SAY ) {
 		/* local $\ = "\n" */
 		SAVEGENERICSV(PL_ors_sv);
 		PL_ors_sv = newSVpvs("\n");
 	}
 	call_method("PRINT", G_SCALAR);
-	LEAVE;
+	LEAVE_with_name("call_PRINT");
 	SPAGAIN;
 	MARK = ORIGMARK + 1;
 	*MARK = *SP;
@@ -767,14 +753,16 @@
 	goto just_say_no;
     }
     else {
+	SV * const ofs = GvSV(PL_ofsgv); /* $, */
 	MARK++;
-	if (PL_ofs_sv && SvOK(PL_ofs_sv)) {
+	if (ofs && (SvGMAGICAL(ofs) || SvOK(ofs))) {
 	    while (MARK <= SP) {
 		if (!do_print(*MARK, fp))
 		    break;
 		MARK++;
 		if (MARK <= SP) {
-		    if (!do_print(PL_ofs_sv, fp)) { /* $, */
+		    /* don't use 'ofs' here - it may be invalidated by magic callbacks */
+		    if (!do_print(GvSV(PL_ofsgv), fp)) {
 			MARK--;
 			break;
 		    }
@@ -1217,13 +1205,27 @@
     dVAR; dSP;
     register PMOP * const pm = cPMOP;
     REGEXP * rx = PM_GETRE(pm);
-    SV * const pkg = CALLREG_PACKAGE(rx);
+    SV * const pkg = rx ? CALLREG_PACKAGE(rx) : NULL;
     SV * const rv = sv_newmortal();
-    SV * const sv = newSVrv(rv, SvPV_nolen(pkg));
-    SvREFCNT_dec(pkg);
+
+    SvUPGRADE(rv, SVt_IV);
+    /* For a subroutine describing itself as "This is a hacky workaround" I'm
+       loathe to use it here, but it seems to be the right fix. Or close.
+       The key part appears to be that it's essential for pp_qr to return a new
+       object (SV), which implies that there needs to be an effective way to
+       generate a new SV from the existing SV that is pre-compiled in the
+       optree.  */
+    SvRV_set(rv, MUTABLE_SV(reg_temp_copy(NULL, rx)));
+    SvROK_on(rv);
+
+    if (pkg) {
+	HV* const stash = gv_stashpv(SvPV_nolen(pkg), GV_ADD);
+	SvREFCNT_dec(pkg);
+	(void)sv_bless(rv, stash);
+    }
+
     if (RX_EXTFLAGS(rx) & RXf_TAINTED)
         SvTAINTED_on(rv);
-    sv_magic(sv,(SV*)ReREFCNT_inc(rx), PERL_MAGIC_qr,0,0);
     XPUSHs(rv);
     RETURN;
 }
@@ -1237,7 +1239,7 @@
     register const char *s;
     const char *strend;
     I32 global;
-    I32 r_flags = REXEC_CHECKED;
+    U8 r_flags = REXEC_CHECKED;
     const char *truebase;			/* Start of string  */
     register REGEXP *rx = PM_GETRE(pm);
     bool rxtainted;
@@ -1259,7 +1261,11 @@
     }
 
     PUTBACK;				/* EVAL blocks need stack_sp. */
-    s = SvPV_const(TARG, len);
+    /* Skip get-magic if this is a qr// clone, because regcomp has
+       already done it. */
+    s = ((struct regexp *)SvANY(rx))->mother_re
+	 ? SvPV_nomg_const(TARG, len)
+	 : SvPV_const(TARG, len);
     if (!s)
 	DIE(aTHX_ "panic: pp_match");
     strend = s + len;
@@ -1494,16 +1500,17 @@
 			      (int) SvTYPE(TARG), (void*)truebase, (void*)t,
 			      (int)(t-truebase));
 	    }
-	    rx->saved_copy = sv_setsv_cow(rx->saved_copy, TARG);
-	    RX_SUBBEG(rx) = (char *) SvPVX_const(rx->saved_copy) + (t - truebase);
-	    assert (SvPOKp(rx->saved_copy));
+	    RX_SAVED_COPY(rx) = sv_setsv_cow(RX_SAVED_COPY(rx), TARG);
+	    RX_SUBBEG(rx)
+		= (char *) SvPVX_const(RX_SAVED_COPY(rx)) + (t - truebase);
+	    assert (SvPOKp(RX_SAVED_COPY(rx)));
 	} else
 #endif
 	{
 
 	    RX_SUBBEG(rx) = savepvn(t, strend - t);
 #ifdef PERL_OLD_COPY_ON_WRITE
-	    rx->saved_copy = NULL;
+	    RX_SAVED_COPY(rx) = NULL;
 #endif
 	}
 	RX_SUBLEN(rx) = strend - t;
@@ -1554,9 +1561,9 @@
 	    PUSHMARK(SP);
 	    XPUSHs(SvTIED_obj(MUTABLE_SV(io), mg));
 	    PUTBACK;
-	    ENTER;
+	    ENTER_with_name("call_READLINE");
 	    call_method("READLINE", gimme);
-	    LEAVE;
+	    LEAVE_with_name("call_READLINE");
 	    SPAGAIN;
 	    if (gimme == G_SCALAR) {
 		SV* const result = POPs;
@@ -1675,11 +1682,11 @@
 		(void)do_close(PL_last_in_gv, FALSE);
 	    }
 	    else if (type == OP_GLOB) {
-		if (!do_close(PL_last_in_gv, FALSE) && ckWARN(WARN_GLOB)) {
-		    Perl_warner(aTHX_ packWARN(WARN_GLOB),
-			   "glob failed (child exited with status %d%s)",
-			   (int)(STATUS_CURRENT >> 8),
-			   (STATUS_CURRENT & 0x80) ? ", core dumped" : "");
+		if (!do_close(PL_last_in_gv, FALSE)) {
+		    Perl_ck_warner(aTHX_ packWARN(WARN_GLOB),
+				   "glob failed (child exited with status %d%s)",
+				   (int)(STATUS_CURRENT >> 8),
+				   (STATUS_CURRENT & 0x80) ? ", core dumped" : "");
 		}
 	    }
 	    if (gimme == G_SCALAR) {
@@ -1754,13 +1761,17 @@
     I32 gimme = OP_GIMME(PL_op, -1);
 
     if (gimme == -1) {
-	if (cxstack_ix >= 0)
-	    gimme = cxstack[cxstack_ix].blk_gimme;
-	else
+	if (cxstack_ix >= 0) {
+	    /* If this flag is set, we're just inside a return, so we should
+	     * store the caller's context */
+	    gimme = (PL_op->op_flags & OPf_SPECIAL)
+		? block_gimme()
+		: cxstack[cxstack_ix].blk_gimme;
+	} else
 	    gimme = G_SCALAR;
     }
 
-    ENTER;
+    ENTER_with_name("block");
 
     SAVETMPS;
     PUSHBLOCK(cx, CXt_BLOCK, SP);
@@ -1779,28 +1790,24 @@
     const U32 defer = PL_op->op_private & OPpLVAL_DEFER;
     SV *sv;
     const U32 hash = (SvIsCOW_shared_hash(keysv)) ? SvSHARED_HASH(keysv) : 0;
-    I32 preeminent = 0;
+    const bool localizing = PL_op->op_private & OPpLVAL_INTRO;
+    bool preeminent = TRUE;
 
     if (SvTYPE(hv) != SVt_PVHV)
 	RETPUSHUNDEF;
 
-    if (PL_op->op_private & OPpLVAL_INTRO) {
+    if (localizing) {
 	MAGIC *mg;
 	HV *stash;
-	/* does the element we're localizing already exist? */
-	preeminent = /* can we determine whether it exists? */
-	    (    !SvRMAGICAL(hv)
-		|| mg_find((const SV *)hv, PERL_MAGIC_env)
-		|| (     (mg = mg_find((const SV *)hv, PERL_MAGIC_tied))
-			/* Try to preserve the existenceness of a tied hash
-			* element by using EXISTS and DELETE if possible.
-			* Fallback to FETCH and STORE otherwise */
-		    && (stash = SvSTASH(SvRV(SvTIED_obj(MUTABLE_SV(hv), mg))))
-		    && gv_fetchmethod_autoload(stash, "EXISTS", TRUE)
-		    && gv_fetchmethod_autoload(stash, "DELETE", TRUE)
-		)
-	    ) ? hv_exists_ent(hv, keysv, 0) : 1;
+
+	/* If we can determine whether the element exist,
+	 * Try to preserve the existenceness of a tied hash
+	 * element by using EXISTS and DELETE if possible.
+	 * Fallback to FETCH and STORE otherwise. */
+	if (SvCANEXISTDELETE(hv) || mg_find((const SV *)hv, PERL_MAGIC_env))
+	    preeminent = hv_exists_ent(hv, keysv, 0);
     }
+
     he = hv_fetch_ent(hv, keysv, lval && !defer, hash);
     svp = he ? &HeVAL(he) : NULL;
     if (lval) {
@@ -1820,18 +1827,14 @@
 	    PUSHs(lv);
 	    RETURN;
 	}
-	if (PL_op->op_private & OPpLVAL_INTRO) {
+	if (localizing) {
 	    if (HvNAME_get(hv) && isGV(*svp))
 		save_gp(MUTABLE_GV(*svp), !(PL_op->op_flags & OPf_SPECIAL));
-	    else {
-		if (!preeminent) {
-		    STRLEN keylen;
-		    const char * const key = SvPV_const(keysv, keylen);
-		    SAVEDELETE(hv, savepvn(key,keylen),
-			       SvUTF8(keysv) ? -(I32)keylen : (I32)keylen);
-		} else
-		    save_helem(hv, keysv, svp);
-            }
+	    else if (preeminent)
+		save_helem_flags(hv, keysv, svp,
+		     (PL_op->op_flags & OPf_SPECIAL) ? 0 : SAVEf_SETMAGIC);
+	    else
+		SAVEHDELETE(hv, keysv);
 	}
 	else if (PL_op->op_private & OPpDEREF)
 	    vivify_ref(*svp, PL_op->op_private & OPpDEREF);
@@ -1864,13 +1867,7 @@
 
     POPBLOCK(cx,newpm);
 
-    gimme = OP_GIMME(PL_op, -1);
-    if (gimme == -1) {
-	if (cxstack_ix >= 0)
-	    gimme = cxstack[cxstack_ix].blk_gimme;
-	else
-	    gimme = G_SCALAR;
-    }
+    gimme = OP_GIMME(PL_op, (cxstack_ix >= 0) ? gimme : G_SCALAR);
 
     TAINT_NOT;
     if (gimme == G_VOID)
@@ -1901,7 +1898,7 @@
     }
     PL_curpm = newpm;	/* Don't pop $1 et al till now */
 
-    LEAVE;
+    LEAVE_with_name("block");
 
     RETURN;
 }
@@ -1911,25 +1908,24 @@
     dVAR; dSP;
     register PERL_CONTEXT *cx;
     SV *sv, *oldsv;
-    AV* av;
     SV **itersvp;
+    AV *av = NULL; /* used for LOOP_FOR on arrays and the stack */
+    bool av_is_stack = FALSE;
 
     EXTEND(SP, 1);
     cx = &cxstack[cxstack_ix];
-    if (CxTYPE(cx) != CXt_LOOP)
+    if (!CxTYPE_is_LOOP(cx))
 	DIE(aTHX_ "panic: pp_iter");
 
     itersvp = CxITERVAR(cx);
-    av = cx->blk_loop.iterary;
-    if (SvTYPE(av) != SVt_PVAV) {
-	/* iterate ($min .. $max) */
-	if (cx->blk_loop.iterlval) {
+    if (CxTYPE(cx) == CXt_LOOP_LAZYSV) {
 	    /* string increment */
-	    register SV* cur = cx->blk_loop.iterlval;
+	    SV* cur = cx->blk_loop.state_u.lazysv.cur;
+	    SV *end = cx->blk_loop.state_u.lazysv.end;
 	    /* If the maximum is !SvOK(), pp_enteriter substitutes PL_sv_no.
 	       It has SvPVX of "" and SvCUR of 0, which is what we want.  */
 	    STRLEN maxlen = 0;
-	    const char *max = SvPV_const((SV*)av, maxlen);
+	    const char *max = SvPV_const(end, maxlen);
 	    if (!SvNIOK(cur) && SvCUR(cur) <= maxlen) {
 		if (SvREFCNT(*itersvp) == 1 && !SvMAGICAL(*itersvp)) {
 		    /* safe to reuse old SV */
@@ -1951,15 +1947,16 @@
 		RETPUSHYES;
 	    }
 	    RETPUSHNO;
-	}
+    }
+    else if (CxTYPE(cx) == CXt_LOOP_LAZYIV) {
 	/* integer increment */
-	if (cx->blk_loop.iterix > cx->blk_loop.itermax)
+	if (cx->blk_loop.state_u.lazyiv.cur > cx->blk_loop.state_u.lazyiv.end)
 	    RETPUSHNO;
 
 	/* don't risk potential race */
 	if (SvREFCNT(*itersvp) == 1 && !SvMAGICAL(*itersvp)) {
 	    /* safe to reuse old SV */
-	    sv_setiv(*itersvp, cx->blk_loop.iterix++);
+	    sv_setiv(*itersvp, cx->blk_loop.state_u.lazyiv.cur++);
 	}
 	else
 	{
@@ -1967,46 +1964,52 @@
 	     * completely new SV for closures/references to work as they
 	     * used to */
 	    oldsv = *itersvp;
-	    *itersvp = newSViv(cx->blk_loop.iterix++);
+	    *itersvp = newSViv(cx->blk_loop.state_u.lazyiv.cur++);
 	    SvREFCNT_dec(oldsv);
 	}
 
 	/* Handle end of range at IV_MAX */
-	if ((cx->blk_loop.iterix == IV_MIN) &&
-	    (cx->blk_loop.itermax == IV_MAX))
+	if ((cx->blk_loop.state_u.lazyiv.cur == IV_MIN) &&
+	    (cx->blk_loop.state_u.lazyiv.end == IV_MAX))
 	{
-	    cx->blk_loop.iterix++;
-	    cx->blk_loop.itermax++;
+	    cx->blk_loop.state_u.lazyiv.cur++;
+	    cx->blk_loop.state_u.lazyiv.end++;
 	}
 
 	RETPUSHYES;
     }
 
     /* iterate array */
+    assert(CxTYPE(cx) == CXt_LOOP_FOR);
+    av = cx->blk_loop.state_u.ary.ary;
+    if (!av) {
+	av_is_stack = TRUE;
+	av = PL_curstack;
+    }
     if (PL_op->op_private & OPpITER_REVERSED) {
-	/* In reverse, use itermax as the min :-)  */
-	if (cx->blk_loop.iterix <= cx->blk_loop.itermax)
+	if (cx->blk_loop.state_u.ary.ix <= (av_is_stack
+				    ? cx->blk_loop.resetsp + 1 : 0))
 	    RETPUSHNO;
 
 	if (SvMAGICAL(av) || AvREIFY(av)) {
-	    SV * const * const svp = av_fetch(av, --cx->blk_loop.iterix, FALSE);
+	    SV * const * const svp = av_fetch(av, --cx->blk_loop.state_u.ary.ix, FALSE);
 	    sv = svp ? *svp : NULL;
 	}
 	else {
-	    sv = AvARRAY(av)[--cx->blk_loop.iterix];
+	    sv = AvARRAY(av)[--cx->blk_loop.state_u.ary.ix];
 	}
     }
     else {
-	if (cx->blk_loop.iterix >= (av == PL_curstack ? cx->blk_oldsp :
+	if (cx->blk_loop.state_u.ary.ix >= (av_is_stack ? cx->blk_oldsp :
 				    AvFILL(av)))
 	    RETPUSHNO;
 
 	if (SvMAGICAL(av) || AvREIFY(av)) {
-	    SV * const * const svp = av_fetch(av, ++cx->blk_loop.iterix, FALSE);
+	    SV * const * const svp = av_fetch(av, ++cx->blk_loop.state_u.ary.ix, FALSE);
 	    sv = svp ? *svp : NULL;
 	}
 	else {
-	    sv = AvARRAY(av)[++cx->blk_loop.iterix];
+	    sv = AvARRAY(av)[++cx->blk_loop.state_u.ary.ix];
 	}
     }
 
@@ -2015,31 +2018,24 @@
 	Perl_croak(aTHX_ "Use of freed value in iteration");
     }
 
-    if (sv)
+    if (sv) {
 	SvTEMP_off(sv);
+	SvREFCNT_inc_simple_void_NN(sv);
+    }
     else
 	sv = &PL_sv_undef;
-    if (av != PL_curstack && sv == &PL_sv_undef) {
-	SV *lv = cx->blk_loop.iterlval;
-	if (lv && SvREFCNT(lv) > 1) {
-	    SvREFCNT_dec(lv);
-	    lv = NULL;
-	}
-	if (lv)
-	    SvREFCNT_dec(LvTARG(lv));
-	else {
-	    lv = cx->blk_loop.iterlval = newSV_type(SVt_PVLV);
-	    LvTYPE(lv) = 'y';
-	    sv_magic(lv, NULL, PERL_MAGIC_defelem, NULL, 0);
-	}
+    if (!av_is_stack && sv == &PL_sv_undef) {
+	SV *lv = newSV_type(SVt_PVLV);
+	LvTYPE(lv) = 'y';
+	sv_magic(lv, NULL, PERL_MAGIC_defelem, NULL, 0);
 	LvTARG(lv) = SvREFCNT_inc_simple(av);
-	LvTARGOFF(lv) = cx->blk_loop.iterix;
+	LvTARGOFF(lv) = cx->blk_loop.state_u.ary.ix;
 	LvTARGLEN(lv) = (STRLEN)UV_MAX;
-	sv = (SV*)lv;
+	sv = lv;
     }
 
     oldsv = *itersvp;
-    *itersvp = SvREFCNT_inc_simple_NN(sv);
+    *itersvp = sv;
     SvREFCNT_dec(oldsv);
 
     RETPUSHYES;
@@ -2062,7 +2058,7 @@
     bool once;
     U8 rxtainted;
     char *orig;
-    I32 r_flags;
+    U8 r_flags;
     register REGEXP *rx = PM_GETRE(pm);
     STRLEN len;
     int force_on_match = 0;
@@ -2389,14 +2385,14 @@
     if (SvTRUEx(POPs))
 	PL_stack_base[PL_markstack_ptr[-1]++] = PL_stack_base[*PL_markstack_ptr];
     ++*PL_markstack_ptr;
-    LEAVE;					/* exit inner scope */
+    LEAVE_with_name("grep_item");					/* exit inner scope */
 
     /* All done yet? */
     if (PL_stack_base + *PL_markstack_ptr > SP) {
 	I32 items;
 	const I32 gimme = GIMME_V;
 
-	LEAVE;					/* exit outer scope */
+	LEAVE_with_name("grep");					/* exit outer scope */
 	(void)POPMARK;				/* pop src */
 	items = --*PL_markstack_ptr - PL_markstack_ptr[-1];
 	(void)POPMARK;				/* pop dst */
@@ -2419,7 +2415,7 @@
     else {
 	SV *src;
 
-	ENTER;					/* enter inner scope */
+	ENTER_with_name("grep_item");					/* enter inner scope */
 	SAVEVPTR(PL_curpm);
 
 	src = PL_stack_base[*PL_markstack_ptr];
@@ -2711,7 +2707,7 @@
 	    if (!sym)
 		DIE(aTHX_ PL_no_usym, "a subroutine");
 	    if (PL_op->op_private & HINT_STRICT_REFS)
-		DIE(aTHX_ PL_no_symref, sym, "a subroutine");
+		DIE(aTHX_ "Can't use string (\"%.32s\"%s) as a subroutine ref while \"strict refs\" in use", sym, len>32 ? "..." : "");
 	    cv = get_cvn_flags(sym, len, GV_ADD|SvUTF8(sv));
 	    break;
 	}
@@ -2776,7 +2772,7 @@
 	     PL_curcopdb = PL_curcop;
          if (CvLVALUE(cv)) {
              /* check for lsub that handles lvalue subroutines */
-	     cv = GvCV(gv_HVadd(gv_fetchpv("DB::lsub", GV_ADDMULTI, SVt_PVHV)));
+	     cv = GvCV(gv_HVadd(gv_fetchpvs("DB::lsub", GV_ADDMULTI, SVt_PVHV)));
              /* if lsub not found then fall back to DB::sub */
 	     if (!cv) cv = GvCV(PL_DBsub);
          } else {
@@ -2851,10 +2847,6 @@
 	if (CvDEPTH(cv) == PERL_SUB_DEPTH_WARN && ckWARN(WARN_RECURSION)
 	    && !(PERLDB_SUB && cv == GvCV(PL_DBsub)))
 	    sub_crush_depth(cv);
-#if 0
-	DEBUG_S(PerlIO_printf(Perl_debug_log,
-			      "%p entersub returning %p\n", (void*)thr, (void*)CvSTART(cv)));
-#endif
 	RETURNOP(CvSTART(cv));
     }
     else {
@@ -2884,8 +2876,10 @@
 	    PL_curcopdb = NULL;
 	}
 	/* Do we need to open block here? XXXX */
-	if (CvXSUB(cv)) /* XXX this is supposed to be true */
-	    (void)(*CvXSUB(cv))(aTHX_ cv);
+
+	/* CvXSUB(cv) must not be NULL because newXS() refuses NULL xsub address */
+	assert(CvXSUB(cv));
+	CALL_FPTR(CvXSUB(cv))(aTHX_ cv);
 
 	/* Enforce some sanity in scalar context. */
 	if (gimme == G_SCALAR && ++markix != PL_stack_sp - PL_stack_base ) {
@@ -2924,6 +2918,8 @@
     AV *const av = MUTABLE_AV(POPs);
     const U32 lval = PL_op->op_flags & OPf_MOD || LVRET;
     const U32 defer = (PL_op->op_private & OPpLVAL_DEFER) && (elem > av_len(av));
+    const bool localizing = PL_op->op_private & OPpLVAL_INTRO;
+    bool preeminent = TRUE;
     SV *sv;
 
     if (SvROK(elemsv) && !SvGAMAGIC(elemsv) && ckWARN(WARN_MISC))
@@ -2934,6 +2930,19 @@
 	elem -= CopARYBASE_get(PL_curcop);
     if (SvTYPE(av) != SVt_PVAV)
 	RETPUSHUNDEF;
+
+    if (localizing) {
+	MAGIC *mg;
+	HV *stash;
+
+	/* If we can determine whether the element exist,
+	 * Try to preserve the existenceness of a tied array
+	 * element by using EXISTS and DELETE if possible.
+	 * Fallback to FETCH and STORE otherwise. */
+	if (SvCANEXISTDELETE(av))
+	    preeminent = av_exists(av, elem);
+    }
+
     svp = av_fetch(av, elem, lval && !defer);
     if (lval) {
 #ifdef PERL_MALLOC_WRAP
@@ -2963,8 +2972,12 @@
 	    PUSHs(lv);
 	    RETURN;
 	}
-	if (PL_op->op_private & OPpLVAL_INTRO)
-	    save_aelem(av, elem, svp);
+	if (localizing) {
+	    if (preeminent)
+		save_aelem(av, elem, svp);
+	    else
+		SAVEADELETE(av, elem);
+	}
 	else if (PL_op->op_private & OPpDEREF)
 	    vivify_ref(*svp, PL_op->op_private & OPpDEREF);
     }
@@ -3035,17 +3048,16 @@
     SV* ob;
     GV* gv;
     HV* stash;
-    STRLEN namelen;
     const char* packname = NULL;
     SV *packsv = NULL;
     STRLEN packlen;
-    const char * const name = SvPV_const(meth, namelen);
     SV * const sv = *(PL_stack_base + TOPMARK + 1);
 
     PERL_ARGS_ASSERT_METHOD_COMMON;
 
     if (!sv)
-	Perl_croak(aTHX_ "Can't call method \"%s\" on an undefined value", name);
+	Perl_croak(aTHX_ "Can't call method \"%"SVf"\" on an undefined value",
+		   SVfARG(meth));
 
     SvGETMAGIC(sv);
     if (SvROK(sv))
@@ -3074,7 +3086,8 @@
 		    : !isIDFIRST(*packname)
 		))
 	    {
-		Perl_croak(aTHX_ "Can't call method \"%s\" %s", name,
+		Perl_croak(aTHX_ "Can't call method \"%"SVf"\" %s",
+			   SVfARG(meth),
 			   SvOK(sv) ? "without a package or object reference"
 				    : "on an undefined value");
 	    }
@@ -3099,6 +3112,7 @@
 		     && (ob = MUTABLE_SV(GvIO((const GV *)ob)))
 		     && SvOBJECT(ob))))
     {
+	const char * const name = SvPV_nolen_const(meth);
 	Perl_croak(aTHX_ "Can't call method \"%s\" on unblessed reference",
 		   (SvSCREAM(meth) && strEQ(name,"isa")) ? "DOES" :
 		   name);
@@ -3122,81 +3136,12 @@
 	}
     }
 
-    gv = gv_fetchmethod(stash ? stash : MUTABLE_HV(packsv), name);
-
-    if (!gv) {
-	/* This code tries to figure out just what went wrong with
-	   gv_fetchmethod.  It therefore needs to duplicate a lot of
-	   the internals of that function.  We can't move it inside
-	   Perl_gv_fetchmethod_autoload(), however, since that would
-	   cause UNIVERSAL->can("NoSuchPackage::foo") to croak, and we
-	   don't want that.
-	*/
-	const char* leaf = name;
-	const char* sep = NULL;
-	const char* p;
-
-	for (p = name; *p; p++) {
-	    if (*p == '\'')
-		sep = p, leaf = p + 1;
-	    else if (*p == ':' && *(p + 1) == ':')
-		sep = p, leaf = p + 2;
-	}
-	if (!sep || ((sep - name) == 5 && strnEQ(name, "SUPER", 5))) {
-	    /* the method name is unqualified or starts with SUPER:: */
-#ifndef USE_ITHREADS
-	    if (sep)
-		stash = CopSTASH(PL_curcop);
-#else
-	    bool need_strlen = 1;
-	    if (sep) {
-		packname = CopSTASHPV(PL_curcop);
-	    }
-	    else
-#endif
-	    if (stash) {
-		HEK * const packhek = HvNAME_HEK(stash);
-		if (packhek) {
-		    packname = HEK_KEY(packhek);
-		    packlen = HEK_LEN(packhek);
-#ifdef USE_ITHREADS
-		    need_strlen = 0;
-#endif
-		} else {
-		    goto croak;
-		}
-	    }
+    gv = gv_fetchmethod_flags(stash ? stash : MUTABLE_HV(packsv),
+			      SvPV_nolen_const(meth),
+			      GV_AUTOLOAD | GV_CROAK);
 
-	    if (!packname) {
-	    croak:
-		Perl_croak(aTHX_
-			   "Can't use anonymous symbol table for method lookup");
-	    }
-#ifdef USE_ITHREADS
-	    if (need_strlen)
-		packlen = strlen(packname);
-#endif
+    assert(gv);
 
-	}
-	else {
-	    /* the method name is qualified */
-	    packname = name;
-	    packlen = sep - name;
-	}
-	
-	/* we're relying on gv_fetchmethod not autovivifying the stash */
-	if (gv_stashpvn(packname, packlen, 0)) {
-	    Perl_croak(aTHX_
-		       "Can't locate object method \"%s\" via package \"%.*s\"",
-		       leaf, (int)packlen, packname);
-	}
-	else {
-	    Perl_croak(aTHX_
-		       "Can't locate object method \"%s\" via package \"%.*s\""
-		       " (perhaps you forgot to load \"%.*s\"?)",
-		       leaf, (int)packlen, packname, (int)packlen, packname);
-	}
-    }
     return isGV(gv) ? MUTABLE_SV(GvCV(gv)) : MUTABLE_SV(gv);
 }
 
Index: src/gnu/usr.bin/perl/pp_sys.c
diff -u src/gnu/usr.bin/perl/pp_sys.c:1.12 src/gnu/usr.bin/perl/pp_sys.c:1.13
--- pp_sys.c:1.12	Mon Oct 12 18:24:21 2009
+++ pp_sys.c	Fri Sep 24 15:06:42 2010
@@ -29,6 +29,8 @@
 #include "EXTERN.h"
 #define PERL_IN_PP_SYS_C
 #include "perl.h"
+#include "time64.h"
+#include "time64.c"
 
 #ifdef I_SHADOW
 /* Shadow password support for solaris - pdo@cs.umd.edu
@@ -201,15 +203,6 @@
 
 #undef PERL_EFF_ACCESS	/* EFFective uid/gid ACCESS */
 
-/* AIX 5.2 and below use mktime for localtime, and defines the edge case
- * for time 0x7fffffff to be valid only in UTC. AIX 5.3 provides localtime64
- * available in the 32bit environment, which could warrant Configure
- * checks in the future.
- */
-#ifdef  _AIX
-#define LOCALTIME_EDGECASE_BROKEN
-#endif
-
 /* F_OK unused: if stat() cannot find it... */
 
 #if !defined(PERL_EFF_ACCESS) && defined(HAS_ACCESS) && defined(EFF_ONLY_OK) && !defined(NO_EFF_ONLY_OK)
@@ -249,7 +242,6 @@
     const Gid_t egid = getegid();
     int res;
 
-    LOCK_CRED_MUTEX;
 #if !defined(HAS_SETREUID) && !defined(HAS_SETRESUID)
     Perl_croak(aTHX_ "switching effective uid is not implemented");
 #else
@@ -295,7 +287,6 @@
 #endif
 #endif
 	Perl_croak(aTHX_ "leaving effective gid failed");
-    UNLOCK_CRED_MUTEX;
 
     return res;
 }
@@ -327,13 +318,13 @@
 		NOOP;
 	}
 	else if (gimme == G_SCALAR) {
-	    ENTER;
+	    ENTER_with_name("backtick");
 	    SAVESPTR(PL_rs);
 	    PL_rs = &PL_sv_undef;
 	    sv_setpvs(TARG, "");	/* note that this preserves previous buffer */
 	    while (sv_gets(TARG, fp, SvCUR(TARG)) != NULL)
 		NOOP;
-	    LEAVE;
+	    LEAVE_with_name("backtick");
 	    XPUSHs(TARG);
 	    SvTAINTED_on(TARG);
 	}
@@ -373,7 +364,7 @@
      * without at the same time croaking, for some reason, or if
      * perl was built with PERL_EXTERNAL_GLOB */
 
-    ENTER;
+    ENTER_with_name("glob");
 
 #ifndef VMS
     if (PL_tainting) {
@@ -398,7 +389,7 @@
 #endif	/* !DOSISH */
 
     result = do_readline();
-    LEAVE;
+    LEAVE_with_name("glob");
     return result;
 }
 
@@ -506,6 +497,7 @@
 	tmpsv = newSVpvs_flags("Died", SVs_TEMP);
 
     DIE(aTHX_ "%"SVf, SVfARG(tmpsv));
+    RETURN;
 }
 
 /* I/O. */
@@ -530,9 +522,10 @@
 	MAGIC *mg;
 	IoFLAGS(GvIOp(gv)) &= ~IOf_UNTAINT;
 
-	if (IoDIRP(io) && ckWARN2(WARN_IO, WARN_DEPRECATED))
-	    Perl_warner(aTHX_ packWARN2(WARN_IO, WARN_DEPRECATED),
-		    "Opening dirhandle %s also as a file", GvENAME(gv));
+	if (IoDIRP(io))
+	    Perl_ck_warner_d(aTHX_ packWARN2(WARN_IO, WARN_DEPRECATED),
+			     "Opening dirhandle %s also as a file",
+			     GvENAME(gv));
 
 	mg = SvTIED_mg((const SV *)io, PERL_MAGIC_tiedscalar);
 	if (mg) {
@@ -541,9 +534,9 @@
 	    *MARK-- = SvTIED_obj(MUTABLE_SV(io), mg);
 	    PUSHMARK(MARK);
 	    PUTBACK;
-	    ENTER;
+	    ENTER_with_name("call_OPEN");
 	    call_method("OPEN", G_SCALAR);
-	    LEAVE;
+	    LEAVE_with_name("call_OPEN");
 	    SPAGAIN;
 	    RETURN;
 	}
@@ -581,9 +574,9 @@
 		PUSHMARK(SP);
 		XPUSHs(SvTIED_obj(MUTABLE_SV(io), mg));
 		PUTBACK;
-		ENTER;
+		ENTER_with_name("call_CLOSE");
 		call_method("CLOSE", G_SCALAR);
-		LEAVE;
+		LEAVE_with_name("call_CLOSE");
 		SPAGAIN;
 		RETURN;
 	    }
@@ -650,6 +643,7 @@
     RETPUSHUNDEF;
 #else
     DIE(aTHX_ PL_no_func, "pipe");
+    return NORMAL;
 #endif
 }
 
@@ -671,9 +665,9 @@
 	PUSHMARK(SP);
 	XPUSHs(SvTIED_obj(MUTABLE_SV(io), mg));
 	PUTBACK;
-	ENTER;
+	ENTER_with_name("call_FILENO");
 	call_method("FILENO", G_SCALAR);
-	LEAVE;
+	LEAVE_with_name("call_FILENO");
 	SPAGAIN;
 	RETURN;
     }
@@ -746,9 +740,9 @@
 	    if (discp)
 		XPUSHs(discp);
 	    PUTBACK;
-	    ENTER;
+	    ENTER_with_name("call_BINMODE");
 	    call_method("BINMODE", G_SCALAR);
-	    LEAVE;
+	    LEAVE_with_name("call_BINMODE");
 	    SPAGAIN;
 	    RETURN;
 	}
@@ -764,8 +758,12 @@
 
     PUTBACK;
     {
-	const int mode = mode_from_discipline(discp);
-	const char *const d = (discp ? SvPV_nolen_const(discp) : NULL);
+	STRLEN len = 0;
+	const char *d = NULL;
+	int mode;
+	if (discp)
+	    d = SvPV_const(discp, len);
+	mode = mode_from_discipline(d, len);
 	if (PerlIO_binmode(aTHX_ fp, IoTYPE(io), mode, d)) {
 	    if (IoOFP(io) && IoOFP(io) != IoIFP(io)) {
 		if (!PerlIO_binmode(aTHX_ IoOFP(io), IoTYPE(io), mode, d)) {
@@ -787,7 +785,7 @@
 {
     dVAR; dSP; dMARK;
     HV* stash;
-    GV *gv;
+    GV *gv = NULL;
     SV *sv;
     const I32 markoff = MARK - PL_stack_base;
     const char *methname;
@@ -805,11 +803,6 @@
 	    break;
 	case SVt_PVGV:
 	    if (isGV_with_GP(varsv)) {
-#ifdef GV_UNIQUE_CHECK
-		if (GvUNIQUE((const GV *)varsv)) {
-		    Perl_croak(aTHX_ "Attempt to tie unique GV");
-		}
-#endif
 		methname = "TIEHANDLE";
 		how = PERL_MAGIC_tiedscalar;
 		/* For tied filehandles, we apply tiedscalar magic to the IO
@@ -827,7 +820,7 @@
     }
     items = SP - MARK++;
     if (sv_isobject(*MARK)) { /* Calls GET magic. */
-	ENTER;
+	ENTER_with_name("call_TIE");
 	PUSHSTACKi(PERLSI_MAGIC);
 	PUSHMARK(SP);
 	EXTEND(SP,(I32)items);
@@ -847,7 +840,7 @@
 	    DIE(aTHX_ "Can't locate object method \"%s\" via package \"%"SVf"\"",
 		 methname, SVfARG(SvOK(*MARK) ? *MARK : &PL_sv_no));
 	}
-	ENTER;
+	ENTER_with_name("call_TIE");
 	PUSHSTACKi(PERLSI_MAGIC);
 	PUSHMARK(SP);
 	EXTEND(SP,(I32)items);
@@ -870,7 +863,7 @@
 		       "Self-ties of arrays and hashes are not supported");
 	sv_magic(varsv, (SvRV(sv) == varsv ? NULL : sv), how, NULL, 0);
     }
-    LEAVE;
+    LEAVE_with_name("call_TIE");
     SP = PL_stack_base + markoff;
     PUSHs(sv);
     RETURN;
@@ -897,15 +890,15 @@
 	       XPUSHs(SvTIED_obj(MUTABLE_SV(gv), mg));
 	       mXPUSHi(SvREFCNT(obj) - 1);
 	       PUTBACK;
-	       ENTER;
+	       ENTER_with_name("call_UNTIE");
 	       call_sv(MUTABLE_SV(cv), G_VOID);
-	       LEAVE;
+	       LEAVE_with_name("call_UNTIE");
 	       SPAGAIN;
             }
-	    else if (mg && SvREFCNT(obj) > 1 && ckWARN(WARN_UNTIE)) {
-		  Perl_warner(aTHX_ packWARN(WARN_UNTIE),
-		      "untie attempted while %"UVuf" inner references still exist",
-		       (UV)SvREFCNT(obj) - 1 ) ;
+	    else if (mg && SvREFCNT(obj) > 1) {
+		Perl_ck_warner(aTHX_ packWARN(WARN_UNTIE),
+			       "untie attempted while %"UVuf" inner references still exist",
+			       (UV)SvREFCNT(obj) - 1 ) ;
 	    }
         }
     }
@@ -940,7 +933,7 @@
     dVAR; dSP;
     dPOPPOPssrl;
     HV* stash;
-    GV *gv;
+    GV *gv = NULL;
 
     HV * const hv = MUTABLE_HV(POPs);
     SV * const sv = newSVpvs_flags("AnyDBM_File", SVs_TEMP);
@@ -949,7 +942,7 @@
 	PUTBACK;
 	require_pv("AnyDBM_File.pm");
 	SPAGAIN;
-	if (!(gv = gv_fetchmethod(stash, "TIEHASH")))
+	if (!stash || !(gv = gv_fetchmethod(stash, "TIEHASH")))
 	    DIE(aTHX_ "No dbm on this machine");
     }
 
@@ -1028,8 +1021,7 @@
 		DIE(aTHX_ "%s", PL_no_modify);
 	}
 	if (!SvPOK(sv)) {
-	    if (ckWARN(WARN_MISC))
-                Perl_warner(aTHX_ packWARN(WARN_MISC), "Non-string passed as bitmask");
+	    Perl_ck_warner(aTHX_ packWARN(WARN_MISC), "Non-string passed as bitmask");
 	    SvPV_force_nolen(sv);	/* force string conversion */
 	}
 	j = SvCUR(sv);
@@ -1149,16 +1141,27 @@
     RETURN;
 #else
     DIE(aTHX_ "select not implemented");
+    return NORMAL;
 #endif
 }
 
+/*
+=for apidoc setdefout
+
+Sets PL_defoutgv, the default file handle for output, to the passed in
+typeglob. As PL_defoutgv "owns" a reference on its typeglob, the reference
+count of the passed in typeglob is increased by one, and the reference count
+of the typeglob that PL_defoutgv points to is decreased by one.
+
+=cut
+*/
+
 void
 Perl_setdefout(pTHX_ GV *gv)
 {
     dVAR;
     SvREFCNT_inc_simple_void(gv);
-    if (PL_defoutgv)
-	SvREFCNT_dec(PL_defoutgv);
+    SvREFCNT_dec(PL_defoutgv);
     PL_defoutgv = gv;
 }
 
@@ -1200,6 +1203,9 @@
     IO *io = NULL;
     GV * const gv = (MAXARG==0) ? PL_stdingv : MUTABLE_GV(POPs);
 
+    if (MAXARG == 0)
+	EXTEND(SP, 1);
+
     if (gv && (io = GvIO(gv))) {
 	MAGIC * const mg = SvTIED_mg((const SV *)io, PERL_MAGIC_tiedscalar);
 	if (mg) {
@@ -1253,8 +1259,7 @@
     SAVETMPS;
 
     PUSHBLOCK(cx, CXt_FORMAT, PL_stack_sp);
-    PUSHFORMAT(cx);
-    cx->blk_sub.retop = retop;
+    PUSHFORMAT(cx, retop);
     SAVECOMPPAD();
     PAD_SET_CUR_NOSAVE(CvPADLIST(cv), 1);
 
@@ -1269,8 +1274,8 @@
     register GV *gv;
     register IO *io;
     GV *fgv;
-    CV *cv;
-    SV * tmpsv = NULL;
+    CV *cv = NULL;
+    SV *tmpsv = NULL;
 
     if (MAXARG == 0)
 	gv = PL_defoutgv;
@@ -1314,7 +1319,7 @@
 PP(pp_leavewrite)
 {
     dVAR; dSP;
-    GV * const gv = cxstack[cxstack_ix].blk_sub.gv;
+    GV * const gv = cxstack[cxstack_ix].blk_format.gv;
     register IO * const io = GvIOp(gv);
     PerlIO *ofp;
     PerlIO *fp;
@@ -1417,8 +1422,7 @@
     }
     else {
 	if ((IoLINES_LEFT(io) -= FmLINES(PL_formtarget)) < 0) {
-	    if (ckWARN(WARN_IO))
-		Perl_warner(aTHX_ packWARN(WARN_IO), "page overflow");
+	    Perl_ck_warner(aTHX_ packWARN(WARN_IO), "page overflow");
 	}
 	if (!do_print(PL_formtarget, fp))
 	    PUSHs(&PL_sv_no);
@@ -1919,7 +1923,7 @@
 		    DIE(aTHX_ "Offset outside string");
 		}
 		offset += blen_chars;
-	    } else if (offset >= (IV)blen_chars && blen_chars > 0) {
+	    } else if (offset > (IV)blen_chars) {
 		Safefree(tmpbuf);
 		DIE(aTHX_ "Offset outside string");
 	    }
@@ -2010,51 +2014,65 @@
 {
     dVAR; dSP;
     GV *gv;
+    IO *io;
+    MAGIC *mg;
 
-    if (MAXARG == 0) {
-	if (PL_op->op_flags & OPf_SPECIAL) {	/* eof() */
-	    IO *io;
-	    gv = PL_last_in_gv = GvEGV(PL_argvgv);
-	    io = GvIO(gv);
-	    if (io && !IoIFP(io)) {
-		if ((IoFLAGS(io) & IOf_START) && av_len(GvAVn(gv)) < 0) {
-		    IoLINES(io) = 0;
-		    IoFLAGS(io) &= ~IOf_START;
-		    do_open(gv, "-", 1, FALSE, O_RDONLY, 0, NULL);
-		    if ( GvSV(gv) ) {
-			sv_setpvs(GvSV(gv), "-");
-		    }
-		    else {
-			GvSV(gv) = newSVpvs("-");
-		    }
-		    SvSETMAGIC(GvSV(gv));
-		}
-		else if (!nextargv(gv))
-		    RETPUSHYES;
-	    }
-	}
+    if (MAXARG)
+	gv = PL_last_in_gv = MUTABLE_GV(POPs);	/* eof(FH) */
+    else {
+	EXTEND(SP, 1);
+
+	if (PL_op->op_flags & OPf_SPECIAL)
+	    gv = PL_last_in_gv = GvEGV(PL_argvgv);	/* eof() - ARGV magic */
 	else
 	    gv = PL_last_in_gv;			/* eof */
     }
-    else
-	gv = PL_last_in_gv = MUTABLE_GV(POPs);	/* eof(FH) */
 
-    if (gv) {
-	IO * const io = GvIO(gv);
-	MAGIC * mg;
-	if (io && (mg = SvTIED_mg((const SV *)io, PERL_MAGIC_tiedscalar))) {
-	    PUSHMARK(SP);
-	    XPUSHs(SvTIED_obj(MUTABLE_SV(io), mg));
-	    PUTBACK;
-	    ENTER;
-	    call_method("EOF", G_SCALAR);
-	    LEAVE;
-	    SPAGAIN;
-	    RETURN;
+    if (!gv)
+	RETPUSHNO;
+
+    if ((io = GvIO(gv)) && (mg = SvTIED_mg((const SV *)io, PERL_MAGIC_tiedscalar))) {
+	PUSHMARK(SP);
+	XPUSHs(SvTIED_obj(MUTABLE_SV(io), mg));
+	/*
+	 * in Perl 5.12 and later, the additional paramter is a bitmask:
+	 * 0 = eof
+	 * 1 = eof(FH)
+	 * 2 = eof()  <- ARGV magic
+	 */
+	EXTEND(SP, 1);
+	if (MAXARG)
+	    mPUSHi(1);		/* 1 = eof(FH) - simple, explicit FH */
+	else if (PL_op->op_flags & OPf_SPECIAL)
+	    mPUSHi(2);		/* 2 = eof()   - ARGV magic */
+	else
+	    mPUSHi(0);		/* 0 = eof     - simple, implicit FH */
+	PUTBACK;
+	ENTER;
+	call_method("EOF", G_SCALAR);
+	LEAVE;
+	SPAGAIN;
+	RETURN;
+    }
+
+    if (!MAXARG && (PL_op->op_flags & OPf_SPECIAL)) {	/* eof() */
+	if (io && !IoIFP(io)) {
+	    if ((IoFLAGS(io) & IOf_START) && av_len(GvAVn(gv)) < 0) {
+		IoLINES(io) = 0;
+		IoFLAGS(io) &= ~IOf_START;
+		do_open(gv, "-", 1, FALSE, O_RDONLY, 0, NULL);
+		if (GvSV(gv))
+		    sv_setpvs(GvSV(gv), "-");
+		else
+		    GvSV(gv) = newSVpvs("-");
+		SvSETMAGIC(GvSV(gv));
+	    }
+	    else if (!nextargv(gv))
+		RETPUSHYES;
 	}
     }
 
-    PUSHs(boolSV(!gv || do_eof(gv)));
+    PUSHs(boolSV(do_eof(gv)));
     RETURN;
 }
 
@@ -2066,6 +2084,8 @@
 
     if (MAXARG != 0)
 	PL_last_in_gv = MUTABLE_GV(POPs);
+    else
+	EXTEND(SP, 1);
     gv = PL_last_in_gv;
 
     if (gv && (io = GvIO(gv))) {
@@ -2081,6 +2101,12 @@
 	    RETURN;
 	}
     }
+    else if (!gv) {
+	if (!errno)
+	    SETERRNO(EBADF,RMS_IFI);
+	PUSHi(-1);
+	RETURN;
+    }
 
 #if LSEEKSIZE > IVSIZE
     PUSHn( do_tell(gv) );
@@ -2344,6 +2370,7 @@
     RETURN;
 #else
     DIE(aTHX_ PL_no_func, "flock()");
+    return NORMAL;
 #endif
 }
 
@@ -2396,6 +2423,7 @@
     RETPUSHYES;
 #else
     DIE(aTHX_ PL_no_sock_func, "socket");
+    return NORMAL;
 #endif
 }
 
@@ -2457,6 +2485,7 @@
     RETPUSHYES;
 #else
     DIE(aTHX_ PL_no_sock_func, "socketpair");
+    return NORMAL;
 #endif
 }
 
@@ -2488,6 +2517,7 @@
     RETPUSHUNDEF;
 #else
     DIE(aTHX_ PL_no_sock_func, "bind");
+    return NORMAL;
 #endif
 }
 
@@ -2518,6 +2548,7 @@
     RETPUSHUNDEF;
 #else
     DIE(aTHX_ PL_no_sock_func, "connect");
+    return NORMAL;
 #endif
 }
 
@@ -2544,6 +2575,7 @@
     RETPUSHUNDEF;
 #else
     DIE(aTHX_ PL_no_sock_func, "listen");
+    return NORMAL;
 #endif
 }
 
@@ -2623,6 +2655,7 @@
 
 #else
     DIE(aTHX_ PL_no_sock_func, "accept");
+    return NORMAL;
 #endif
 }
 
@@ -2647,6 +2680,7 @@
     RETPUSHUNDEF;
 #else
     DIE(aTHX_ PL_no_sock_func, "shutdown");
+    return NORMAL;
 #endif
 }
 
@@ -2724,6 +2758,7 @@
 
 #else
     DIE(aTHX_ PL_no_sock_func, PL_op_desc[PL_op->op_type]);
+    return NORMAL;
 #endif
 }
 
@@ -2788,6 +2823,7 @@
 
 #else
     DIE(aTHX_ PL_no_sock_func, PL_op_desc[PL_op->op_type]);
+    return NORMAL;
 #endif
 }
 
@@ -2807,9 +2843,8 @@
 	if (PL_op->op_type == OP_LSTAT) {
 	    if (gv != PL_defgv) {
 	    do_fstat_warning_check:
-		if (ckWARN(WARN_IO))
-		    Perl_warner(aTHX_ packWARN(WARN_IO),
-			"lstat() on filehandle %s", gv ? GvENAME(gv) : "");
+		Perl_ck_warner(aTHX_ packWARN(WARN_IO),
+			       "lstat() on filehandle %s", gv ? GvENAME(gv) : "");
 	    } else if (PL_laststype != OP_LSTAT)
 		Perl_croak(aTHX_ "The stat preceding lstat() wasn't an lstat");
 	}
@@ -2965,8 +3000,19 @@
     int stat_mode = S_IRUSR;
 
     bool effective = FALSE;
+    char opchar = '?';
     dSP;
 
+    switch (PL_op->op_type) {
+    case OP_FTRREAD:	opchar = 'R'; break;
+    case OP_FTRWRITE:	opchar = 'W'; break;
+    case OP_FTREXEC:	opchar = 'X'; break;
+    case OP_FTEREAD:	opchar = 'r'; break;
+    case OP_FTEWRITE:	opchar = 'w'; break;
+    case OP_FTEEXEC:	opchar = 'x'; break;
+    }
+    tryAMAGICftest(opchar);
+
     STACKED_FTEST_CHECK;
 
     switch (PL_op->op_type) {
@@ -2999,7 +3045,7 @@
 	access_mode = W_OK;
 #endif
 	stat_mode = S_IWUSR;
-	/* Fall through  */
+	/* fall through */
 
     case OP_FTEREAD:
 #ifndef PERL_EFF_ACCESS
@@ -3059,8 +3105,20 @@
     dVAR;
     I32 result;
     const int op_type = PL_op->op_type;
+    char opchar = '?';
     dSP;
+
+    switch (op_type) {
+    case OP_FTIS:	opchar = 'e'; break;
+    case OP_FTSIZE:	opchar = 's'; break;
+    case OP_FTMTIME:	opchar = 'M'; break;
+    case OP_FTCTIME:	opchar = 'C'; break;
+    case OP_FTATIME:	opchar = 'A'; break;
+    }
+    tryAMAGICftest(opchar);
+
     STACKED_FTEST_CHECK;
+
     result = my_stat();
     SPAGAIN;
     if (result < 0)
@@ -3097,8 +3155,25 @@
 {
     dVAR;
     I32 result;
+    char opchar = '?';
     dSP;
 
+    switch (PL_op->op_type) {
+    case OP_FTROWNED:	opchar = 'O'; break;
+    case OP_FTEOWNED:	opchar = 'o'; break;
+    case OP_FTZERO:	opchar = 'z'; break;
+    case OP_FTSOCK:	opchar = 'S'; break;
+    case OP_FTCHR:	opchar = 'c'; break;
+    case OP_FTBLK:	opchar = 'b'; break;
+    case OP_FTFILE:	opchar = 'f'; break;
+    case OP_FTDIR:	opchar = 'd'; break;
+    case OP_FTPIPE:	opchar = 'p'; break;
+    case OP_FTSUID:	opchar = 'u'; break;
+    case OP_FTSGID:	opchar = 'g'; break;
+    case OP_FTSVTX:	opchar = 'k'; break;
+    }
+    tryAMAGICftest(opchar);
+
     /* I believe that all these three are likely to be defined on most every
        system these days.  */
 #ifndef S_ISUID
@@ -3115,6 +3190,7 @@
 #endif
 
     STACKED_FTEST_CHECK;
+
     result = my_stat();
     SPAGAIN;
     if (result < 0)
@@ -3181,8 +3257,13 @@
 PP(pp_ftlink)
 {
     dVAR;
-    I32 result = my_lstat();
     dSP;
+    I32 result;
+
+    tryAMAGICftest('l');
+    result = my_lstat();
+    SPAGAIN;
+
     if (result < 0)
 	RETPUSHUNDEF;
     if (S_ISLNK(PL_statcache.st_mode))
@@ -3198,6 +3279,8 @@
     GV *gv;
     SV *tmpsv = NULL;
 
+    tryAMAGICftest('t');
+
     STACKED_FTEST_CHECK;
 
     if (PL_op->op_flags & OPf_REF)
@@ -3247,6 +3330,8 @@
     GV *gv;
     PerlIO *fp;
 
+    tryAMAGICftest(PL_op->op_type == OP_FTTEXT ? 'T' : 'B');
+
     STACKED_FTEST_CHECK;
 
     if (PL_op->op_flags & OPf_REF)
@@ -3493,6 +3578,7 @@
     RETURN;
 #else
     DIE(aTHX_ PL_no_func, "chroot");
+    return NORMAL;
 #endif
 }
 
@@ -3567,6 +3653,7 @@
 {
     /* Have neither.  */
     DIE(aTHX_ PL_no_func, PL_op_desc[PL_op->op_type]);
+    return NORMAL;
 }
 #endif
 
@@ -3766,9 +3853,10 @@
     if (!io)
 	goto nope;
 
-    if ((IoIFP(io) || IoOFP(io)) && ckWARN2(WARN_IO, WARN_DEPRECATED))
-	Perl_warner(aTHX_ packWARN2(WARN_IO, WARN_DEPRECATED),
-		"Opening filehandle %s also as a directory", GvENAME(gv));
+    if ((IoIFP(io) || IoOFP(io)))
+	Perl_ck_warner_d(aTHX_ packWARN2(WARN_IO, WARN_DEPRECATED),
+			 "Opening filehandle %s also as a directory",
+			 GvENAME(gv));
     if (IoDIRP(io))
 	PerlDir_close(IoDIRP(io));
     if (!(IoDIRP(io) = PerlDir_open(dirname)))
@@ -3781,6 +3869,7 @@
     RETPUSHUNDEF;
 #else
     DIE(aTHX_ PL_no_dir_func, "opendir");
+    return NORMAL;
 #endif
 }
 
@@ -3788,6 +3877,7 @@
 {
 #if !defined(Direntry_t) || !defined(HAS_READDIR)
     DIE(aTHX_ PL_no_dir_func, "readdir");
+    return NORMAL;
 #else
 #if !defined(I_DIRENT) && !defined(VMS)
     Direntry_t *readdir (DIR *);
@@ -3802,10 +3892,8 @@
     register IO * const io = GvIOn(gv);
 
     if (!io || !IoDIRP(io)) {
-        if(ckWARN(WARN_IO)) {
-            Perl_warner(aTHX_ packWARN(WARN_IO),
-                "readdir() attempted on invalid dirhandle %s", GvENAME(gv));
-        }
+	Perl_ck_warner(aTHX_ packWARN(WARN_IO),
+		       "readdir() attempted on invalid dirhandle %s", GvENAME(gv));
         goto nope;
     }
 
@@ -3855,10 +3943,8 @@
     register IO * const io = GvIOn(gv);
 
     if (!io || !IoDIRP(io)) {
-        if(ckWARN(WARN_IO)) {
-            Perl_warner(aTHX_ packWARN(WARN_IO),
-	        "telldir() attempted on invalid dirhandle %s", GvENAME(gv));
-        }
+	Perl_ck_warner(aTHX_ packWARN(WARN_IO),
+		       "telldir() attempted on invalid dirhandle %s", GvENAME(gv));
         goto nope;
     }
 
@@ -3870,6 +3956,7 @@
     RETPUSHUNDEF;
 #else
     DIE(aTHX_ PL_no_dir_func, "telldir");
+    return NORMAL;
 #endif
 }
 
@@ -3882,10 +3969,8 @@
     register IO * const io = GvIOn(gv);
 
     if (!io || !IoDIRP(io)) {
-	if(ckWARN(WARN_IO)) {
-	    Perl_warner(aTHX_ packWARN(WARN_IO),
-                "seekdir() attempted on invalid dirhandle %s", GvENAME(gv));
-        }
+	Perl_ck_warner(aTHX_ packWARN(WARN_IO),
+		       "seekdir() attempted on invalid dirhandle %s", GvENAME(gv));
         goto nope;
     }
     (void)PerlDir_seek(IoDIRP(io), along);
@@ -3897,6 +3982,7 @@
     RETPUSHUNDEF;
 #else
     DIE(aTHX_ PL_no_dir_func, "seekdir");
+    return NORMAL;
 #endif
 }
 
@@ -3908,10 +3994,8 @@
     register IO * const io = GvIOn(gv);
 
     if (!io || !IoDIRP(io)) {
-	if(ckWARN(WARN_IO)) {
-	    Perl_warner(aTHX_ packWARN(WARN_IO),
-	        "rewinddir() attempted on invalid dirhandle %s", GvENAME(gv));
-	}
+	Perl_ck_warner(aTHX_ packWARN(WARN_IO),
+		       "rewinddir() attempted on invalid dirhandle %s", GvENAME(gv));
 	goto nope;
     }
     (void)PerlDir_rewind(IoDIRP(io));
@@ -3922,6 +4006,7 @@
     RETPUSHUNDEF;
 #else
     DIE(aTHX_ PL_no_dir_func, "rewinddir");
+    return NORMAL;
 #endif
 }
 
@@ -3933,10 +4018,8 @@
     register IO * const io = GvIOn(gv);
 
     if (!io || !IoDIRP(io)) {
-	if(ckWARN(WARN_IO)) {
-	    Perl_warner(aTHX_ packWARN(WARN_IO),
-                "closedir() attempted on invalid dirhandle %s", GvENAME(gv));
-        }
+	Perl_ck_warner(aTHX_ packWARN(WARN_IO),
+		       "closedir() attempted on invalid dirhandle %s", GvENAME(gv));
         goto nope;
     }
 #ifdef VOID_CLOSEDIR
@@ -3956,6 +4039,7 @@
     RETPUSHUNDEF;
 #else
     DIE(aTHX_ PL_no_dir_func, "closedir");
+    return NORMAL;
 #endif
 }
 
@@ -4002,13 +4086,14 @@
     RETURN;
 #  else
     DIE(aTHX_ PL_no_func, "fork");
+    return NORMAL;
 #  endif
 #endif
 }
 
 PP(pp_wait)
 {
-#if (!defined(DOSISH) || defined(OS2) || defined(WIN32)) && !defined(MACOS_TRADITIONAL) && !defined(__LIBCATAMOUNT__)
+#if (!defined(DOSISH) || defined(OS2) || defined(WIN32)) && !defined(__LIBCATAMOUNT__)
     dVAR; dSP; dTARGET;
     Pid_t childpid;
     int argflags;
@@ -4031,12 +4116,13 @@
     RETURN;
 #else
     DIE(aTHX_ PL_no_func, "wait");
+    return NORMAL;
 #endif
 }
 
 PP(pp_waitpid)
 {
-#if (!defined(DOSISH) || defined(OS2) || defined(WIN32)) && !defined(MACOS_TRADITIONAL) && !defined(__LIBCATAMOUNT__)
+#if (!defined(DOSISH) || defined(OS2) || defined(WIN32)) && !defined(__LIBCATAMOUNT__)
     dVAR; dSP; dTARGET;
     const int optype = POPi;
     const Pid_t pid = TOPi;
@@ -4061,6 +4147,7 @@
     RETURN;
 #else
     DIE(aTHX_ PL_no_func, "waitpid");
+    return NORMAL;
 #endif
 }
 
@@ -4266,6 +4353,7 @@
     RETURN;
 #else
     DIE(aTHX_ PL_no_func, "getppid");
+    return NORMAL;
 #endif
 }
 
@@ -4287,6 +4375,7 @@
     RETURN;
 #else
     DIE(aTHX_ PL_no_func, "getpgrp()");
+    return NORMAL;
 #endif
 }
 
@@ -4320,6 +4409,7 @@
     RETURN;
 #else
     DIE(aTHX_ PL_no_func, "setpgrp()");
+    return NORMAL;
 #endif
 }
 
@@ -4333,6 +4423,7 @@
     RETURN;
 #else
     DIE(aTHX_ PL_no_func, "getpriority()");
+    return NORMAL;
 #endif
 }
 
@@ -4348,6 +4439,7 @@
     RETURN;
 #else
     DIE(aTHX_ PL_no_func, "setpriority()");
+    return NORMAL;
 #endif
 }
 
@@ -4398,108 +4490,106 @@
     RETURN;
 #   else
     DIE(aTHX_ "times not implemented");
+    return NORMAL;
 #   endif
 #endif /* HAS_TIMES */
 }
 
-#ifdef LOCALTIME_EDGECASE_BROKEN
-static struct tm *S_my_localtime (pTHX_ Time_t *tp)
-{
-    auto time_t     T;
-    auto struct tm *P;
-
-    /* No workarounds in the valid range */
-    if (!tp || *tp < 0x7fff573f || *tp >= 0x80000000)
-	return (localtime (tp));
-
-    /* This edge case is to workaround the undefined behaviour, where the
-     * TIMEZONE makes the time go beyond the defined range.
-     * gmtime (0x7fffffff) => 2038-01-19 03:14:07
-     * If there is a negative offset in TZ, like MET-1METDST, some broken
-     * implementations of localtime () (like AIX 5.2) barf with bogus
-     * return values:
-     * 0x7fffffff gmtime               2038-01-19 03:14:07
-     * 0x7fffffff localtime            1901-12-13 21:45:51
-     * 0x7fffffff mylocaltime          2038-01-19 04:14:07
-     * 0x3c19137f gmtime               2001-12-13 20:45:51
-     * 0x3c19137f localtime            2001-12-13 21:45:51
-     * 0x3c19137f mylocaltime          2001-12-13 21:45:51
-     * Given that legal timezones are typically between GMT-12 and GMT+12
-     * we turn back the clock 23 hours before calling the localtime
-     * function, and add those to the return value. This will never cause
-     * day wrapping problems, since the edge case is Tue Jan *19*
-     */
-    T = *tp - 82800; /* 23 hour. allows up to GMT-23 */
-    P = localtime (&T);
-    P->tm_hour += 23;
-    if (P->tm_hour >= 24) {
-	P->tm_hour -= 24;
-	P->tm_mday++;	/* 18  -> 19  */
-	P->tm_wday++;	/* Mon -> Tue */
-	P->tm_yday++;	/* 18  -> 19  */
-    }
-    return (P);
-} /* S_my_localtime */
-#endif
+/* The 32 bit int year limits the times we can represent to these
+   boundaries with a few days wiggle room to account for time zone
+   offsets
+*/
+/* Sat Jan  3 00:00:00 -2147481748 */
+#define TIME_LOWER_BOUND -67768100567755200.0
+/* Sun Dec 29 12:00:00  2147483647 */
+#define TIME_UPPER_BOUND  67767976233316800.0
 
 PP(pp_gmtime)
 {
     dVAR;
     dSP;
-    Time_t when;
-    const struct tm *tmbuf;
+    Time64_T when;
+    struct TM tmbuf;
+    struct TM *err;
+    const char *opname = PL_op->op_type == OP_LOCALTIME ? "localtime" : "gmtime";
     static const char * const dayname[] =
 	{"Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"};
     static const char * const monname[] =
 	{"Jan", "Feb", "Mar", "Apr", "May", "Jun",
 	 "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"};
 
-    if (MAXARG < 1)
-	(void)time(&when);
-    else
-#ifdef BIG_TIME
-	when = (Time_t)SvNVx(POPs);
-#else
-	when = (Time_t)SvIVx(POPs);
-#endif
+    if (MAXARG < 1) {
+	time_t now;
+	(void)time(&now);
+	when = (Time64_T)now;
+    }
+    else {
+	double input = Perl_floor(POPn);
+	when = (Time64_T)input;
+	if (when != input) {
+	    Perl_ck_warner(aTHX_ packWARN(WARN_OVERFLOW),
+			   "%s(%.0f) too large", opname, input);
+	}
+    }
 
-    if (PL_op->op_type == OP_LOCALTIME)
-#ifdef LOCALTIME_EDGECASE_BROKEN
-	tmbuf = S_my_localtime(aTHX_ &when);
-#else
-	tmbuf = localtime(&when);
-#endif
-    else
-	tmbuf = gmtime(&when);
+    if ( TIME_LOWER_BOUND > when ) {
+	Perl_ck_warner(aTHX_ packWARN(WARN_OVERFLOW),
+		       "%s(%.0f) too small", opname, when);
+	err = NULL;
+    }
+    else if( when > TIME_UPPER_BOUND ) {
+	Perl_ck_warner(aTHX_ packWARN(WARN_OVERFLOW),
+		       "%s(%.0f) too large", opname, when);
+	err = NULL;
+    }
+    else {
+	if (PL_op->op_type == OP_LOCALTIME)
+	    err = S_localtime64_r(&when, &tmbuf);
+	else
+	    err = S_gmtime64_r(&when, &tmbuf);
+    }
 
-    if (GIMME != G_ARRAY) {
+    if (err == NULL) {
+	/* XXX %lld broken for quads */
+	Perl_ck_warner(aTHX_ packWARN(WARN_OVERFLOW),
+		       "%s(%.0f) failed", opname, (double)when);
+    }
+
+    if (GIMME != G_ARRAY) {	/* scalar context */
 	SV *tsv;
+	/* XXX newSVpvf()'s %lld type is broken, so cheat with a double */
+	double year = (double)tmbuf.tm_year + 1900;
+
         EXTEND(SP, 1);
         EXTEND_MORTAL(1);
-	if (!tmbuf)
+	if (err == NULL)
 	    RETPUSHUNDEF;
-	tsv = Perl_newSVpvf(aTHX_ "%s %s %2d %02d:%02d:%02d %d",
-			    dayname[tmbuf->tm_wday],
-			    monname[tmbuf->tm_mon],
-			    tmbuf->tm_mday,
-			    tmbuf->tm_hour,
-			    tmbuf->tm_min,
-			    tmbuf->tm_sec,
-			    tmbuf->tm_year + 1900);
+
+	tsv = Perl_newSVpvf(aTHX_ "%s %s %2d %02d:%02d:%02d %.0f",
+			    dayname[tmbuf.tm_wday],
+			    monname[tmbuf.tm_mon],
+			    tmbuf.tm_mday,
+			    tmbuf.tm_hour,
+			    tmbuf.tm_min,
+			    tmbuf.tm_sec,
+			    year);
 	mPUSHs(tsv);
     }
-    else if (tmbuf) {
+    else {			/* list context */
+	if ( err == NULL )
+	    RETURN;
+
         EXTEND(SP, 9);
         EXTEND_MORTAL(9);
-        mPUSHi(tmbuf->tm_sec);
-	mPUSHi(tmbuf->tm_min);
-	mPUSHi(tmbuf->tm_hour);
-	mPUSHi(tmbuf->tm_mday);
-	mPUSHi(tmbuf->tm_mon);
-	mPUSHi(tmbuf->tm_year);
-	mPUSHi(tmbuf->tm_wday);
-	mPUSHi(tmbuf->tm_yday);
-	mPUSHi(tmbuf->tm_isdst);
+        mPUSHi(tmbuf.tm_sec);
+	mPUSHi(tmbuf.tm_min);
+	mPUSHi(tmbuf.tm_hour);
+	mPUSHi(tmbuf.tm_mday);
+	mPUSHi(tmbuf.tm_mon);
+	mPUSHn(tmbuf.tm_year);
+	mPUSHi(tmbuf.tm_wday);
+	mPUSHi(tmbuf.tm_yday);
+	mPUSHi(tmbuf.tm_isdst);
     }
     RETURN;
 }
@@ -4518,6 +4608,7 @@
     RETURN;
 #else
     DIE(aTHX_ PL_no_func, "alarm");
+    return NORMAL;
 #endif
 }
 
@@ -4587,6 +4678,7 @@
     RETURN;
 #else
     DIE(aTHX_ "System V IPC is not implemented on this machine");
+    return NORMAL;
 #endif
 }
 
@@ -4647,7 +4739,7 @@
     struct hostent *gethostbyname(Netdb_name_t);
     struct hostent *gethostent(void);
 #endif
-    struct hostent *hent;
+    struct hostent *hent = NULL;
     unsigned long len;
 
     EXTEND(SP, 10);
@@ -4722,6 +4814,7 @@
     RETURN;
 #else
     DIE(aTHX_ PL_no_sock_func, "gethostent");
+    return NORMAL;
 #endif
 }
 
@@ -4795,6 +4888,7 @@
     RETURN;
 #else
     DIE(aTHX_ PL_no_sock_func, "getnetent");
+    return NORMAL;
 #endif
 }
 
@@ -4855,6 +4949,7 @@
     RETURN;
 #else
     DIE(aTHX_ PL_no_sock_func, "getprotoent");
+    return NORMAL;
 #endif
 }
 
@@ -4930,6 +5025,7 @@
     RETURN;
 #else
     DIE(aTHX_ PL_no_sock_func, "getservent");
+    return NORMAL;
 #endif
 }
 
@@ -4941,6 +5037,7 @@
     RETSETYES;
 #else
     DIE(aTHX_ PL_no_sock_func, "sethostent");
+    return NORMAL;
 #endif
 }
 
@@ -4952,6 +5049,7 @@
     RETSETYES;
 #else
     DIE(aTHX_ PL_no_sock_func, "setnetent");
+    return NORMAL;
 #endif
 }
 
@@ -4963,6 +5061,7 @@
     RETSETYES;
 #else
     DIE(aTHX_ PL_no_sock_func, "setprotoent");
+    return NORMAL;
 #endif
 }
 
@@ -4974,6 +5073,7 @@
     RETSETYES;
 #else
     DIE(aTHX_ PL_no_sock_func, "setservent");
+    return NORMAL;
 #endif
 }
 
@@ -4986,6 +5086,7 @@
     RETPUSHYES;
 #else
     DIE(aTHX_ PL_no_sock_func, "endhostent");
+    return NORMAL;
 #endif
 }
 
@@ -4998,6 +5099,7 @@
     RETPUSHYES;
 #else
     DIE(aTHX_ PL_no_sock_func, "endnetent");
+    return NORMAL;
 #endif
 }
 
@@ -5010,6 +5112,7 @@
     RETPUSHYES;
 #else
     DIE(aTHX_ PL_no_sock_func, "endprotoent");
+    return NORMAL;
 #endif
 }
 
@@ -5022,6 +5125,7 @@
     RETPUSHYES;
 #else
     DIE(aTHX_ PL_no_sock_func, "endservent");
+    return NORMAL;
 #endif
 }
 
@@ -5255,6 +5359,7 @@
     RETURN;
 #else
     DIE(aTHX_ PL_no_func, PL_op_desc[PL_op->op_type]);
+    return NORMAL;
 #endif
 }
 
@@ -5266,6 +5371,7 @@
     RETPUSHYES;
 #else
     DIE(aTHX_ PL_no_func, "setpwent");
+    return NORMAL;
 #endif
 }
 
@@ -5277,6 +5383,7 @@
     RETPUSHYES;
 #else
     DIE(aTHX_ PL_no_func, "endpwent");
+    return NORMAL;
 #endif
 }
 
@@ -5351,6 +5458,7 @@
     RETURN;
 #else
     DIE(aTHX_ PL_no_func, PL_op_desc[PL_op->op_type]);
+    return NORMAL;
 #endif
 }
 
@@ -5362,6 +5470,7 @@
     RETPUSHYES;
 #else
     DIE(aTHX_ PL_no_func, "setgrent");
+    return NORMAL;
 #endif
 }
 
@@ -5373,6 +5482,7 @@
     RETPUSHYES;
 #else
     DIE(aTHX_ PL_no_func, "endgrent");
+    return NORMAL;
 #endif
 }
 
@@ -5388,6 +5498,7 @@
     RETURN;
 #else
     DIE(aTHX_ PL_no_func, "getlogin");
+    return NORMAL;
 #endif
 }
 
@@ -5486,6 +5597,7 @@
     RETURN;
 #else
     DIE(aTHX_ PL_no_func, "syscall");
+    return NORMAL;
 #endif
 }
 
@@ -5498,6 +5610,7 @@
 static int
 fcntl_emulate_flock(int fd, int operation)
 {
+    int res;
     struct flock flock;
 
     switch (operation & ~LOCK_NB) {
@@ -5517,7 +5630,10 @@
     flock.l_whence = SEEK_SET;
     flock.l_start = flock.l_len = (Off_t)0;
 
-    return fcntl(fd, (operation & LOCK_NB) ? F_SETLK : F_SETLKW, &flock);
+    res = fcntl(fd, (operation & LOCK_NB) ? F_SETLK : F_SETLKW, &flock);
+    if (res == -1 && ((errno == EAGAIN) || (errno == EACCES)))
+	errno = EWOULDBLOCK;
+    return res;
 }
 
 #endif /* FCNTL_EMULATE_FLOCK */
Index: src/gnu/usr.bin/perl/proto.h
diff -u src/gnu/usr.bin/perl/proto.h:1.13 src/gnu/usr.bin/perl/proto.h:1.14
--- proto.h:1.13	Mon Oct 12 18:24:21 2009
+++ proto.h	Fri Sep 24 15:06:42 2010
@@ -119,6 +119,13 @@
 #define PERL_ARGS_ASSERT_SET_CONTEXT	\
 	assert(t)
 
+PERL_CALLCONV I32	Perl_regcurly(const char *s)
+			__attribute__warn_unused_result__
+			__attribute__pure__
+			__attribute__nonnull__(1);
+#define PERL_ARGS_ASSERT_REGCURLY	\
+	assert(s)
+
 
 END_EXTERN_C
 
@@ -131,7 +138,7 @@
 #define PERL_ARGS_ASSERT_AMAGIC_CALL	\
 	assert(left); assert(right)
 
-PERL_CALLCONV bool	Perl_Gv_AMupdate(pTHX_ HV* stash)
+PERL_CALLCONV int	Perl_Gv_AMupdate(pTHX_ HV* stash, bool destructing)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_GV_AMUPDATE	\
 	assert(stash)
@@ -175,12 +182,6 @@
 #define PERL_ARGS_ASSERT_AV_EXTEND	\
 	assert(av)
 
-PERL_CALLCONV AV*	Perl_av_fake(pTHX_ I32 size, SV **strp)
-			__attribute__warn_unused_result__
-			__attribute__nonnull__(pTHX_2);
-#define PERL_ARGS_ASSERT_AV_FAKE	\
-	assert(strp)
-
 PERL_CALLCONV SV**	Perl_av_fetch(pTHX_ AV *av, I32 key, I32 lval)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1);
@@ -192,7 +193,7 @@
 #define PERL_ARGS_ASSERT_AV_FILL	\
 	assert(av)
 
-PERL_CALLCONV I32	Perl_av_len(pTHX_ const AV *av)
+PERL_CALLCONV I32	Perl_av_len(pTHX_ AV *av)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_AV_LEN	\
@@ -258,6 +259,18 @@
 #define PERL_ARGS_ASSERT_AV_ARYLEN_P	\
 	assert(av)
 
+PERL_CALLCONV IV*	Perl_av_iter_p(pTHX_ AV *av)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_AV_ITER_P	\
+	assert(av)
+
+#if defined(PERL_IN_AV_C) || defined(PERL_DECL_PROT)
+STATIC MAGIC*	S_get_aux_mg(pTHX_ AV *av)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_GET_AUX_MG	\
+	assert(av)
+
+#endif
 PERL_CALLCONV OP*	Perl_bind_match(pTHX_ I32 type, OP *left, OP *right)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_2)
@@ -366,34 +379,34 @@
 #define PERL_ARGS_ASSERT_WARNER_NOCONTEXT	\
 	assert(pat)
 
-PERL_CALLCONV SV*	Perl_newSVpvf_nocontext(const char* pat, ...)
+PERL_CALLCONV SV*	Perl_newSVpvf_nocontext(const char *const pat, ...)
 			__attribute__format__(__printf__,1,2)
 			__attribute__nonnull__(1);
 #define PERL_ARGS_ASSERT_NEWSVPVF_NOCONTEXT	\
 	assert(pat)
 
-PERL_CALLCONV void	Perl_sv_catpvf_nocontext(SV* sv, const char* pat, ...)
+PERL_CALLCONV void	Perl_sv_catpvf_nocontext(SV *const sv, const char *const pat, ...)
 			__attribute__format__(__printf__,2,3)
 			__attribute__nonnull__(1)
 			__attribute__nonnull__(2);
 #define PERL_ARGS_ASSERT_SV_CATPVF_NOCONTEXT	\
 	assert(sv); assert(pat)
 
-PERL_CALLCONV void	Perl_sv_setpvf_nocontext(SV* sv, const char* pat, ...)
+PERL_CALLCONV void	Perl_sv_setpvf_nocontext(SV *const sv, const char *const pat, ...)
 			__attribute__format__(__printf__,2,3)
 			__attribute__nonnull__(1)
 			__attribute__nonnull__(2);
 #define PERL_ARGS_ASSERT_SV_SETPVF_NOCONTEXT	\
 	assert(sv); assert(pat)
 
-PERL_CALLCONV void	Perl_sv_catpvf_mg_nocontext(SV* sv, const char* pat, ...)
+PERL_CALLCONV void	Perl_sv_catpvf_mg_nocontext(SV *const sv, const char *const pat, ...)
 			__attribute__format__(__printf__,2,3)
 			__attribute__nonnull__(1)
 			__attribute__nonnull__(2);
 #define PERL_ARGS_ASSERT_SV_CATPVF_MG_NOCONTEXT	\
 	assert(sv); assert(pat)
 
-PERL_CALLCONV void	Perl_sv_setpvf_mg_nocontext(SV* sv, const char* pat, ...)
+PERL_CALLCONV void	Perl_sv_setpvf_mg_nocontext(SV *const sv, const char *const pat, ...)
 			__attribute__format__(__printf__,2,3)
 			__attribute__nonnull__(1)
 			__attribute__nonnull__(2);
@@ -414,11 +427,6 @@
 	assert(format)
 
 #endif
-PERL_CALLCONV void	Perl_cv_ckproto(pTHX_ const CV* cv, const GV* gv, const char* p)
-			__attribute__nonnull__(pTHX_1);
-#define PERL_ARGS_ASSERT_CV_CKPROTO	\
-	assert(cv)
-
 PERL_CALLCONV void	Perl_cv_ckproto_len(pTHX_ const CV* cv, const GV* gv, const char* p, const STRLEN len)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_CV_CKPROTO_LEN	\
@@ -435,7 +443,7 @@
 #define PERL_ARGS_ASSERT_GV_CONST_SV	\
 	assert(gv)
 
-PERL_CALLCONV SV*	Perl_cv_const_sv(pTHX_ CV* cv)
+PERL_CALLCONV SV*	Perl_cv_const_sv(pTHX_ const CV *const cv)
 			__attribute__warn_unused_result__;
 
 PERL_CALLCONV SV*	Perl_op_const_sv(pTHX_ const OP* o, CV* cv)
@@ -505,31 +513,25 @@
 
 PERL_CALLCONV I32	Perl_debstack(pTHX);
 PERL_CALLCONV I32	Perl_debstackptrs(pTHX);
-PERL_CALLCONV char*	Perl_delimcpy(pTHX_ char* to, const char* toend, const char* from, const char* fromend, int delim, I32* retlen)
-			__attribute__nonnull__(pTHX_1)
-			__attribute__nonnull__(pTHX_2)
-			__attribute__nonnull__(pTHX_3)
-			__attribute__nonnull__(pTHX_4)
-			__attribute__nonnull__(pTHX_6);
+PERL_CALLCONV char*	Perl_delimcpy(char* to, const char* toend, const char* from, const char* fromend, int delim, I32* retlen)
+			__attribute__nonnull__(1)
+			__attribute__nonnull__(2)
+			__attribute__nonnull__(3)
+			__attribute__nonnull__(4)
+			__attribute__nonnull__(6);
 #define PERL_ARGS_ASSERT_DELIMCPY	\
 	assert(to); assert(toend); assert(from); assert(fromend); assert(retlen)
 
 PERL_CALLCONV void	Perl_delete_eval_scope(pTHX);
-PERL_CALLCONV void	Perl_deprecate(pTHX_ const char* s)
-			__attribute__nonnull__(pTHX_1);
-#define PERL_ARGS_ASSERT_DEPRECATE	\
-	assert(s)
-
-PERL_CALLCONV void	Perl_deprecate_old(pTHX_ const char* s)
-			__attribute__nonnull__(pTHX_1);
-#define PERL_ARGS_ASSERT_DEPRECATE_OLD	\
-	assert(s)
-
 PERL_CALLCONV OP*	Perl_die(pTHX_ const char* pat, ...)
 			__attribute__format__null_ok__(__printf__,pTHX_1,pTHX_2);
 
-PERL_CALLCONV OP*	Perl_vdie(pTHX_ const char* pat, va_list* args);
-PERL_CALLCONV OP*	Perl_die_where(pTHX_ const char* message, STRLEN msglen);
+#if defined(PERL_IN_UTIL_C) || defined(PERL_DECL_PROT)
+STATIC OP*	S_vdie(pTHX_ const char* pat, va_list* args);
+#endif
+PERL_CALLCONV void	Perl_die_where(pTHX_ SV* msv)
+			__attribute__noreturn__;
+
 PERL_CALLCONV void	Perl_dounwind(pTHX_ I32 cxix);
 /* PERL_CALLCONV bool	Perl_do_aexec(pTHX_ SV* really, SV** mark, SV** sp)
 			__attribute__nonnull__(pTHX_2)
@@ -736,6 +738,7 @@
 			__attribute__warn_unused_result__;
 
 PERL_CALLCONV void	Perl_dump_all(pTHX);
+PERL_CALLCONV void	Perl_dump_all_perl(pTHX_ bool justperl);
 PERL_CALLCONV void	Perl_dump_eval(pTHX);
 #if defined(DUMP_FDS)
 PERL_CALLCONV void	Perl_dump_fds(pTHX_ char* s)
@@ -765,11 +768,21 @@
 #define PERL_ARGS_ASSERT_DUMP_PACKSUBS	\
 	assert(stash)
 
+PERL_CALLCONV void	Perl_dump_packsubs_perl(pTHX_ const HV* stash, bool justperl)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_DUMP_PACKSUBS_PERL	\
+	assert(stash)
+
 PERL_CALLCONV void	Perl_dump_sub(pTHX_ const GV* gv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_DUMP_SUB	\
 	assert(gv)
 
+PERL_CALLCONV void	Perl_dump_sub_perl(pTHX_ const GV* gv, bool justperl)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_DUMP_SUB_PERL	\
+	assert(gv)
+
 PERL_CALLCONV void	Perl_fbm_compile(pTHX_ SV* sv, U32 flags)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_FBM_COMPILE	\
@@ -788,12 +801,14 @@
 #define PERL_ARGS_ASSERT_FIND_SCRIPT	\
 	assert(scriptname)
 
-PERL_CALLCONV OP*	Perl_force_list(pTHX_ OP* arg);
-PERL_CALLCONV OP*	Perl_fold_constants(pTHX_ OP *o)
+#if defined(PERL_IN_OP_C) || defined(PERL_DECL_PROT)
+STATIC OP*	S_force_list(pTHX_ OP* arg);
+STATIC OP*	S_fold_constants(pTHX_ OP *o)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_FOLD_CONSTANTS	\
 	assert(o)
 
+#endif
 PERL_CALLCONV char*	Perl_form(pTHX_ const char* pat, ...)
 			__attribute__format__(__printf__,pTHX_1,pTHX_2)
 			__attribute__nonnull__(pTHX_1);
@@ -806,7 +821,9 @@
 	assert(pat)
 
 PERL_CALLCONV void	Perl_free_tmps(pTHX);
-PERL_CALLCONV OP*	Perl_gen_constant_list(pTHX_ OP* o);
+#if defined(PERL_IN_OP_C) || defined(PERL_DECL_PROT)
+STATIC OP*	S_gen_constant_list(pTHX_ OP* o);
+#endif
 #if !defined(HAS_GETENV_LEN)
 PERL_CALLCONV char*	Perl_getenv_len(pTHX_ const char *env_elem, unsigned long *len)
 			__attribute__nonnull__(pTHX_1)
@@ -822,21 +839,10 @@
 
 PERL_CALLCONV void	Perl_gp_free(pTHX_ GV* gv);
 PERL_CALLCONV GP*	Perl_gp_ref(pTHX_ GP* gp);
-PERL_CALLCONV GV*	Perl_gv_AVadd(pTHX_ GV* gv)
-			__attribute__nonnull__(pTHX_1);
-#define PERL_ARGS_ASSERT_GV_AVADD	\
-	assert(gv)
-
-PERL_CALLCONV GV*	Perl_gv_HVadd(pTHX_ GV* gv)
-			__attribute__nonnull__(pTHX_1);
-#define PERL_ARGS_ASSERT_GV_HVADD	\
-	assert(gv)
-
-PERL_CALLCONV GV*	Perl_gv_IOadd(pTHX_ GV* gv)
-			__attribute__nonnull__(pTHX_1);
-#define PERL_ARGS_ASSERT_GV_IOADD	\
-	assert(gv)
-
+PERL_CALLCONV GV*	Perl_gv_add_by_type(pTHX_ GV *gv, svtype type);
+/* PERL_CALLCONV GV*	Perl_gv_AVadd(pTHX_ GV *gv); */
+/* PERL_CALLCONV GV*	Perl_gv_HVadd(pTHX_ GV *gv); */
+/* PERL_CALLCONV GV*	Perl_gv_IOadd(pTHX_ GV* gv); */
 PERL_CALLCONV GV*	Perl_gv_autoload4(pTHX_ HV* stash, const char* name, STRLEN len, I32 method)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_2);
@@ -887,16 +893,24 @@
 	assert(name)
 
 /* PERL_CALLCONV GV*	Perl_gv_fetchmethod(pTHX_ HV* stash, const char* name)
+			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2); */
 #define PERL_ARGS_ASSERT_GV_FETCHMETHOD	\
-	assert(name)
+	assert(stash); assert(name)
 
 PERL_CALLCONV GV*	Perl_gv_fetchmethod_autoload(pTHX_ HV* stash, const char* name, I32 autoload)
+			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_GV_FETCHMETHOD_AUTOLOAD	\
-	assert(name)
+	assert(stash); assert(name)
+
+PERL_CALLCONV GV*	Perl_gv_fetchmethod_flags(pTHX_ HV* stash, const char* name, U32 flags)
+			__attribute__nonnull__(pTHX_1)
+			__attribute__nonnull__(pTHX_2);
+#define PERL_ARGS_ASSERT_GV_FETCHMETHOD_FLAGS	\
+	assert(stash); assert(name)
 
-PERL_CALLCONV GV*	Perl_gv_fetchpv(pTHX_ const char *nambeg, I32 add, I32 sv_type)
+PERL_CALLCONV GV*	Perl_gv_fetchpv(pTHX_ const char *nambeg, I32 add, const svtype sv_type)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_GV_FETCHPV	\
 	assert(nambeg)
@@ -936,6 +950,11 @@
 #define PERL_ARGS_ASSERT_GV_NAME_SET	\
 	assert(gv); assert(name)
 
+PERL_CALLCONV void	Perl_gv_try_downgrade(pTHX_ GV* gv)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_GV_TRY_DOWNGRADE	\
+	assert(gv)
+
 PERL_CALLCONV HV*	Perl_gv_stashpv(pTHX_ const char* name, I32 flags)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_GV_STASHPV	\
@@ -951,7 +970,7 @@
 #define PERL_ARGS_ASSERT_GV_STASHSV	\
 	assert(sv)
 
-PERL_CALLCONV void	Perl_hv_clear(pTHX_ HV* hv);
+PERL_CALLCONV void	Perl_hv_clear(pTHX_ HV *hv);
 PERL_CALLCONV HV *	Perl_hv_copy_hints_hv(pTHX_ HV *const ohv);
 PERL_CALLCONV void	Perl_hv_delayfree_ent(pTHX_ HV *hv, HE *entry)
 			__attribute__nonnull__(pTHX_1);
@@ -1060,21 +1079,29 @@
 PERL_CALLCONV SV *	Perl_refcounted_he_fetch(pTHX_ const struct refcounted_he *chain, SV *keysv, const char *key, STRLEN klen, int flags, U32 hash);
 PERL_CALLCONV void	Perl_refcounted_he_free(pTHX_ struct refcounted_he *he);
 PERL_CALLCONV struct refcounted_he *	Perl_refcounted_he_new(pTHX_ struct refcounted_he *const parent, SV *const key, SV *const value);
+#if defined(PERL_IN_HV_C) || defined(PERL_DECL_PROT)
+STATIC struct refcounted_he *	S_refcounted_he_new_common(pTHX_ struct refcounted_he *const parent, const char *const key_p, const STRLEN key_len, const char flags, char value_type, const void *value, const STRLEN value_len)
+			__attribute__nonnull__(pTHX_2)
+			__attribute__nonnull__(pTHX_6);
+#define PERL_ARGS_ASSERT_REFCOUNTED_HE_NEW_COMMON	\
+	assert(key_p); assert(value)
+
+#endif
 /* PERL_CALLCONV SV**	Perl_hv_store(pTHX_ HV *hv, const char *key, I32 klen, SV *val, U32 hash); */
 /* PERL_CALLCONV HE*	Perl_hv_store_ent(pTHX_ HV *hv, SV *key, SV *val, U32 hash); */
 /* PERL_CALLCONV SV**	Perl_hv_store_flags(pTHX_ HV *hv, const char *key, I32 klen, SV *val, U32 hash, int flags); */
 PERL_CALLCONV void	Perl_hv_undef(pTHX_ HV *hv);
-PERL_CALLCONV I32	Perl_ibcmp(pTHX_ const char* a, const char* b, I32 len)
+PERL_CALLCONV I32	Perl_ibcmp(const char* a, const char* b, I32 len)
 			__attribute__pure__
-			__attribute__nonnull__(pTHX_1)
-			__attribute__nonnull__(pTHX_2);
+			__attribute__nonnull__(1)
+			__attribute__nonnull__(2);
 #define PERL_ARGS_ASSERT_IBCMP	\
 	assert(a); assert(b)
 
-PERL_CALLCONV I32	Perl_ibcmp_locale(pTHX_ const char* a, const char* b, I32 len)
+PERL_CALLCONV I32	Perl_ibcmp_locale(const char* a, const char* b, I32 len)
 			__attribute__pure__
-			__attribute__nonnull__(pTHX_1)
-			__attribute__nonnull__(pTHX_2);
+			__attribute__nonnull__(1)
+			__attribute__nonnull__(2);
 #define PERL_ARGS_ASSERT_IBCMP_LOCALE	\
 	assert(a); assert(b)
 
@@ -1084,14 +1111,17 @@
 #define PERL_ARGS_ASSERT_IBCMP_UTF8	\
 	assert(s1); assert(s2)
 
-PERL_CALLCONV bool	Perl_ingroup(pTHX_ Gid_t testgid, bool effective)
+#if defined(PERL_IN_DOIO_C) || defined(PERL_DECL_PROT)
+STATIC bool	S_ingroup(pTHX_ Gid_t testgid, bool effective)
 			__attribute__warn_unused_result__;
 
+#endif
 PERL_CALLCONV void	Perl_init_argv_symbols(pTHX_ int argc, char **argv)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_INIT_ARGV_SYMBOLS	\
 	assert(argv)
 
+PERL_CALLCONV void	Perl_init_dbargs(pTHX);
 PERL_CALLCONV void	Perl_init_debugger(pTHX);
 PERL_CALLCONV void	Perl_init_stacks(pTHX);
 PERL_CALLCONV void	Perl_init_tm(pTHX_ struct tm *ptm)
@@ -1100,11 +1130,11 @@
 	assert(ptm)
 
 PERL_CALLCONV U32	Perl_intro_my(pTHX);
-PERL_CALLCONV char*	Perl_instr(pTHX_ const char* big, const char* little)
+PERL_CALLCONV char*	Perl_instr(const char* big, const char* little)
 			__attribute__warn_unused_result__
 			__attribute__pure__
-			__attribute__nonnull__(pTHX_1)
-			__attribute__nonnull__(pTHX_2);
+			__attribute__nonnull__(1)
+			__attribute__nonnull__(2);
 #define PERL_ARGS_ASSERT_INSTR	\
 	assert(big); assert(little)
 
@@ -1116,12 +1146,6 @@
 PERL_CALLCONV OP*	Perl_invert(pTHX_ OP* cmd)
 			__attribute__warn_unused_result__;
 
-PERL_CALLCONV bool	Perl_is_gv_magical(pTHX_ const char *name, STRLEN len, U32 flags)
-			__attribute__warn_unused_result__
-			__attribute__nonnull__(pTHX_1);
-#define PERL_ARGS_ASSERT_IS_GV_MAGICAL	\
-	assert(name)
-
 PERL_CALLCONV I32	Perl_is_lvalue_sub(pTHX)
 			__attribute__warn_unused_result__;
 
@@ -1141,10 +1165,6 @@
 			__attribute__warn_unused_result__
 			__attribute__pure__;
 
-PERL_CALLCONV bool	Perl_is_uni_alnumc(pTHX_ UV c)
-			__attribute__warn_unused_result__
-			__attribute__pure__;
-
 PERL_CALLCONV bool	Perl_is_uni_idfirst(pTHX_ UV c)
 			__attribute__warn_unused_result__
 			__attribute__pure__;
@@ -1221,10 +1241,6 @@
 			__attribute__warn_unused_result__
 			__attribute__pure__;
 
-PERL_CALLCONV bool	Perl_is_uni_alnumc_lc(pTHX_ UV c)
-			__attribute__warn_unused_result__
-			__attribute__pure__;
-
 PERL_CALLCONV bool	Perl_is_uni_idfirst_lc(pTHX_ UV c)
 			__attribute__warn_unused_result__
 			__attribute__pure__;
@@ -1273,23 +1289,28 @@
 			__attribute__warn_unused_result__
 			__attribute__pure__;
 
-PERL_CALLCONV STRLEN	Perl_is_utf8_char(pTHX_ const U8 *s)
-			__attribute__nonnull__(pTHX_1);
+PERL_CALLCONV bool	Perl_is_ascii_string(const U8 *s, STRLEN len)
+			__attribute__nonnull__(1);
+#define PERL_ARGS_ASSERT_IS_ASCII_STRING	\
+	assert(s)
+
+PERL_CALLCONV STRLEN	Perl_is_utf8_char(const U8 *s)
+			__attribute__nonnull__(1);
 #define PERL_ARGS_ASSERT_IS_UTF8_CHAR	\
 	assert(s)
 
-PERL_CALLCONV bool	Perl_is_utf8_string(pTHX_ const U8 *s, STRLEN len)
-			__attribute__nonnull__(pTHX_1);
+PERL_CALLCONV bool	Perl_is_utf8_string(const U8 *s, STRLEN len)
+			__attribute__nonnull__(1);
 #define PERL_ARGS_ASSERT_IS_UTF8_STRING	\
 	assert(s)
 
-/* PERL_CALLCONV bool	Perl_is_utf8_string_loc(pTHX_ const U8 *s, STRLEN len, const U8 **p)
-			__attribute__nonnull__(pTHX_1); */
+/* PERL_CALLCONV bool	Perl_is_utf8_string_loc(const U8 *s, STRLEN len, const U8 **p)
+			__attribute__nonnull__(1); */
 #define PERL_ARGS_ASSERT_IS_UTF8_STRING_LOC	\
 	assert(s)
 
-PERL_CALLCONV bool	Perl_is_utf8_string_loclen(pTHX_ const U8 *s, STRLEN len, const U8 **ep, STRLEN *el)
-			__attribute__nonnull__(pTHX_1);
+PERL_CALLCONV bool	Perl_is_utf8_string_loclen(const U8 *s, STRLEN len, const U8 **ep, STRLEN *el)
+			__attribute__nonnull__(1);
 #define PERL_ARGS_ASSERT_IS_UTF8_STRING_LOCLEN	\
 	assert(s)
 
@@ -1299,12 +1320,6 @@
 #define PERL_ARGS_ASSERT_IS_UTF8_ALNUM	\
 	assert(p)
 
-PERL_CALLCONV bool	Perl_is_utf8_alnumc(pTHX_ const U8 *p)
-			__attribute__warn_unused_result__
-			__attribute__nonnull__(pTHX_1);
-#define PERL_ARGS_ASSERT_IS_UTF8_ALNUMC	\
-	assert(p)
-
 PERL_CALLCONV bool	Perl_is_utf8_idfirst(pTHX_ const U8 *p)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1);
@@ -1335,6 +1350,18 @@
 #define PERL_ARGS_ASSERT_IS_UTF8_SPACE	\
 	assert(p)
 
+PERL_CALLCONV bool	Perl_is_utf8_perl_space(pTHX_ const U8 *p)
+			__attribute__warn_unused_result__
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_IS_UTF8_PERL_SPACE	\
+	assert(p)
+
+PERL_CALLCONV bool	Perl_is_utf8_perl_word(pTHX_ const U8 *p)
+			__attribute__warn_unused_result__
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_IS_UTF8_PERL_WORD	\
+	assert(p)
+
 PERL_CALLCONV bool	Perl_is_utf8_cntrl(pTHX_ const U8 *p)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1);
@@ -1347,6 +1374,12 @@
 #define PERL_ARGS_ASSERT_IS_UTF8_DIGIT	\
 	assert(p)
 
+PERL_CALLCONV bool	Perl_is_utf8_posix_digit(pTHX_ const U8 *p)
+			__attribute__warn_unused_result__
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_IS_UTF8_POSIX_DIGIT	\
+	assert(p)
+
 PERL_CALLCONV bool	Perl_is_utf8_graph(pTHX_ const U8 *p)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1);
@@ -1389,6 +1422,66 @@
 #define PERL_ARGS_ASSERT_IS_UTF8_MARK	\
 	assert(p)
 
+PERL_CALLCONV bool	Perl_is_utf8_X_begin(pTHX_ const U8 *p)
+			__attribute__warn_unused_result__
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_IS_UTF8_X_BEGIN	\
+	assert(p)
+
+PERL_CALLCONV bool	Perl_is_utf8_X_extend(pTHX_ const U8 *p)
+			__attribute__warn_unused_result__
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_IS_UTF8_X_EXTEND	\
+	assert(p)
+
+PERL_CALLCONV bool	Perl_is_utf8_X_prepend(pTHX_ const U8 *p)
+			__attribute__warn_unused_result__
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_IS_UTF8_X_PREPEND	\
+	assert(p)
+
+PERL_CALLCONV bool	Perl_is_utf8_X_non_hangul(pTHX_ const U8 *p)
+			__attribute__warn_unused_result__
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_IS_UTF8_X_NON_HANGUL	\
+	assert(p)
+
+PERL_CALLCONV bool	Perl_is_utf8_X_L(pTHX_ const U8 *p)
+			__attribute__warn_unused_result__
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_IS_UTF8_X_L	\
+	assert(p)
+
+PERL_CALLCONV bool	Perl_is_utf8_X_LV(pTHX_ const U8 *p)
+			__attribute__warn_unused_result__
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_IS_UTF8_X_LV	\
+	assert(p)
+
+PERL_CALLCONV bool	Perl_is_utf8_X_LVT(pTHX_ const U8 *p)
+			__attribute__warn_unused_result__
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_IS_UTF8_X_LVT	\
+	assert(p)
+
+PERL_CALLCONV bool	Perl_is_utf8_X_LV_LVT_V(pTHX_ const U8 *p)
+			__attribute__warn_unused_result__
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_IS_UTF8_X_LV_LVT_V	\
+	assert(p)
+
+PERL_CALLCONV bool	Perl_is_utf8_X_T(pTHX_ const U8 *p)
+			__attribute__warn_unused_result__
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_IS_UTF8_X_T	\
+	assert(p)
+
+PERL_CALLCONV bool	Perl_is_utf8_X_V(pTHX_ const U8 *p)
+			__attribute__warn_unused_result__
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_IS_UTF8_X_V	\
+	assert(p)
+
 PERL_CALLCONV OP*	Perl_jmaybe(pTHX_ OP *o)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_JMAYBE	\
@@ -1400,9 +1493,52 @@
 #define PERL_ARGS_ASSERT_KEYWORD	\
 	assert(name)
 
+#if defined(PERL_IN_OP_C) || defined(PERL_DECL_PROT)
+STATIC OP*	S_opt_scalarhv(pTHX_ OP* rep_op)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_OPT_SCALARHV	\
+	assert(rep_op)
+
+STATIC OP*	S_is_inplace_av(pTHX_ OP* o, OP* oright)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_IS_INPLACE_AV	\
+	assert(o)
+
+#endif
 PERL_CALLCONV void	Perl_leave_scope(pTHX_ I32 base);
 PERL_CALLCONV void	Perl_lex_end(pTHX);
 PERL_CALLCONV void	Perl_lex_start(pTHX_ SV* line, PerlIO *rsfp, bool new_filter);
+PERL_CALLCONV bool	Perl_lex_bufutf8(pTHX);
+PERL_CALLCONV char*	Perl_lex_grow_linestr(pTHX_ STRLEN len);
+PERL_CALLCONV void	Perl_lex_stuff_pvn(pTHX_ char* pv, STRLEN len, U32 flags)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_LEX_STUFF_PVN	\
+	assert(pv)
+
+PERL_CALLCONV void	Perl_lex_stuff_sv(pTHX_ SV* sv, U32 flags)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_LEX_STUFF_SV	\
+	assert(sv)
+
+PERL_CALLCONV void	Perl_lex_unstuff(pTHX_ char* ptr)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_LEX_UNSTUFF	\
+	assert(ptr)
+
+PERL_CALLCONV void	Perl_lex_read_to(pTHX_ char* ptr)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_LEX_READ_TO	\
+	assert(ptr)
+
+PERL_CALLCONV void	Perl_lex_discard_to(pTHX_ char* ptr)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_LEX_DISCARD_TO	\
+	assert(ptr)
+
+PERL_CALLCONV bool	Perl_lex_next_chunk(pTHX_ U32 flags);
+PERL_CALLCONV I32	Perl_lex_peek_unichar(pTHX_ U32 flags);
+PERL_CALLCONV I32	Perl_lex_read_unichar(pTHX_ U32 flags);
+PERL_CALLCONV void	Perl_lex_read_space(pTHX_ U32 flags);
 PERL_CALLCONV void	Perl_op_null(pTHX_ OP* o)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_OP_NULL	\
@@ -1415,13 +1551,15 @@
 
 PERL_CALLCONV void	Perl_op_refcnt_lock(pTHX);
 PERL_CALLCONV void	Perl_op_refcnt_unlock(pTHX);
-PERL_CALLCONV OP*	Perl_linklist(pTHX_ OP* o)
+#if defined(PERL_IN_OP_C) || defined(PERL_DECL_PROT)
+STATIC OP*	S_linklist(pTHX_ OP *o)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_LINKLIST	\
 	assert(o)
 
+STATIC OP*	S_listkids(pTHX_ OP* o);
+#endif
 PERL_CALLCONV OP*	Perl_list(pTHX_ OP* o);
-PERL_CALLCONV OP*	Perl_listkids(pTHX_ OP* o);
 PERL_CALLCONV void	Perl_load_module(pTHX_ U32 flags, SV* name, SV* ver, ...)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_LOAD_MODULE	\
@@ -1432,12 +1570,12 @@
 #define PERL_ARGS_ASSERT_VLOAD_MODULE	\
 	assert(name)
 
-PERL_CALLCONV OP*	Perl_localize(pTHX_ OP* o, I32 lex)
+PERL_CALLCONV OP*	Perl_localize(pTHX_ OP *o, I32 lex)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_LOCALIZE	\
 	assert(o)
 
-PERL_CALLCONV I32	Perl_looks_like_number(pTHX_ SV* sv)
+PERL_CALLCONV I32	Perl_looks_like_number(pTHX_ SV *const sv)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_LOOKS_LIKE_NUMBER	\
@@ -1494,12 +1632,17 @@
 #define PERL_ARGS_ASSERT_MAGIC_CLEARHINT	\
 	assert(sv); assert(mg)
 
-PERL_CALLCONV int	Perl_magic_clearisa(pTHX_ SV* sv, MAGIC* mg)
+PERL_CALLCONV int	Perl_magic_clearhints(pTHX_ SV* sv, MAGIC* mg)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
-#define PERL_ARGS_ASSERT_MAGIC_CLEARISA	\
+#define PERL_ARGS_ASSERT_MAGIC_CLEARHINTS	\
 	assert(sv); assert(mg)
 
+PERL_CALLCONV int	Perl_magic_clearisa(pTHX_ SV* sv, MAGIC* mg)
+			__attribute__nonnull__(pTHX_2);
+#define PERL_ARGS_ASSERT_MAGIC_CLEARISA	\
+	assert(mg)
+
 PERL_CALLCONV int	Perl_magic_clearpack(pTHX_ SV* sv, MAGIC* mg)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
@@ -1518,12 +1661,6 @@
 #define PERL_ARGS_ASSERT_MAGIC_EXISTSPACK	\
 	assert(sv); assert(mg)
 
-PERL_CALLCONV int	Perl_magic_freeregexp(pTHX_ SV* sv, MAGIC* mg)
-			__attribute__nonnull__(pTHX_1)
-			__attribute__nonnull__(pTHX_2);
-#define PERL_ARGS_ASSERT_MAGIC_FREEREGEXP	\
-	assert(sv); assert(mg)
-
 PERL_CALLCONV int	Perl_magic_freeovrld(pTHX_ SV* sv, MAGIC* mg)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
@@ -1652,20 +1789,6 @@
 #define PERL_ARGS_ASSERT_MAGIC_FREEARYLEN_P	\
 	assert(sv); assert(mg)
 
-#ifndef NO_MATHOMS
-PERL_CALLCONV int	Perl_magic_setbm(pTHX_ SV* sv, MAGIC* mg)
-			__attribute__nonnull__(pTHX_1)
-			__attribute__nonnull__(pTHX_2);
-#define PERL_ARGS_ASSERT_MAGIC_SETBM	\
-	assert(sv); assert(mg)
-
-PERL_CALLCONV int	Perl_magic_setfm(pTHX_ SV* sv, MAGIC* mg)
-			__attribute__nonnull__(pTHX_1)
-			__attribute__nonnull__(pTHX_2);
-#define PERL_ARGS_ASSERT_MAGIC_SETFM	\
-	assert(sv); assert(mg)
-
-#endif
 PERL_CALLCONV int	Perl_magic_setdbline(pTHX_ SV* sv, MAGIC* mg)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
@@ -1696,14 +1819,6 @@
 #define PERL_ARGS_ASSERT_MAGIC_SETISA	\
 	assert(sv); assert(mg)
 
-#ifndef NO_MATHOMS
-PERL_CALLCONV int	Perl_magic_setglob(pTHX_ SV* sv, MAGIC* mg)
-			__attribute__nonnull__(pTHX_1)
-			__attribute__nonnull__(pTHX_2);
-#define PERL_ARGS_ASSERT_MAGIC_SETGLOB	\
-	assert(sv); assert(mg)
-
-#endif
 PERL_CALLCONV int	Perl_magic_setmglob(pTHX_ SV* sv, MAGIC* mg)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
@@ -1735,10 +1850,9 @@
 	assert(sv); assert(mg)
 
 PERL_CALLCONV int	Perl_magic_setsig(pTHX_ SV* sv, MAGIC* mg)
-			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_MAGIC_SETSIG	\
-	assert(sv); assert(mg)
+	assert(mg)
 
 PERL_CALLCONV int	Perl_magic_setsubstr(pTHX_ SV* sv, MAGIC* mg)
 			__attribute__nonnull__(pTHX_1)
@@ -1788,11 +1902,6 @@
 #define PERL_ARGS_ASSERT_MAGIC_WIPEPACK	\
 	assert(sv); assert(mg)
 
-PERL_CALLCONV void	Perl_magicname(pTHX_ const char* sym, const char* name, I32 namlen)
-			__attribute__nonnull__(pTHX_1);
-#define PERL_ARGS_ASSERT_MAGICNAME	\
-	assert(sym)
-
 PERL_CALLCONV void	Perl_markstack_grow(pTHX);
 #if defined(USE_LOCALE_COLLATE)
 PERL_CALLCONV int	Perl_magic_setcollxfrm(pTHX_ SV* sv, MAGIC* mg)
@@ -1845,7 +1954,7 @@
 #define PERL_ARGS_ASSERT_MG_COPY	\
 	assert(sv); assert(nsv)
 
-PERL_CALLCONV void	Perl_mg_localize(pTHX_ SV* sv, SV* nsv)
+PERL_CALLCONV void	Perl_mg_localize(pTHX_ SV* sv, SV* nsv, bool setmagic)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_MG_LOCALIZE	\
@@ -1890,17 +1999,12 @@
 	assert(ptm)
 
 PERL_CALLCONV OP*	Perl_mod(pTHX_ OP* o, I32 type);
-PERL_CALLCONV int	Perl_mode_from_discipline(pTHX_ SV* discp);
+PERL_CALLCONV int	Perl_mode_from_discipline(pTHX_ const char* s, STRLEN len);
 PERL_CALLCONV const char*	Perl_moreswitches(pTHX_ const char* s)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_MORESWITCHES	\
 	assert(s)
 
-PERL_CALLCONV OP*	Perl_my(pTHX_ OP* o)
-			__attribute__nonnull__(pTHX_1);
-#define PERL_ARGS_ASSERT_MY	\
-	assert(o)
-
 PERL_CALLCONV NV	Perl_my_atof(pTHX_ const char *s)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_MY_ATOF	\
@@ -1955,7 +2059,7 @@
 #define PERL_ARGS_ASSERT_MY_POPEN	\
 	assert(cmd); assert(mode)
 
-PERL_CALLCONV PerlIO*	Perl_my_popen_list(pTHX_ char* mode, int n, SV ** args)
+PERL_CALLCONV PerlIO*	Perl_my_popen_list(pTHX_ const char* mode, int n, SV ** args)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_3);
 #define PERL_ARGS_ASSERT_MY_POPEN_LIST	\
@@ -2138,9 +2242,9 @@
 			__attribute__malloc__
 			__attribute__warn_unused_result__;
 
-PERL_CALLCONV IO*	Perl_newIO(pTHX)
+/* PERL_CALLCONV IO*	Perl_newIO(pTHX)
 			__attribute__malloc__
-			__attribute__warn_unused_result__;
+			__attribute__warn_unused_result__; */
 
 PERL_CALLCONV OP*	Perl_newLISTOP(pTHX_ I32 type, I32 flags, OP* first, OP* last)
 			__attribute__malloc__
@@ -2163,21 +2267,21 @@
 			__attribute__malloc__
 			__attribute__warn_unused_result__;
 
-PERL_CALLCONV SV*	Perl_newRV(pTHX_ SV* sv)
+PERL_CALLCONV SV*	Perl_newRV(pTHX_ SV *const sv)
 			__attribute__malloc__
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_NEWRV	\
 	assert(sv)
 
-PERL_CALLCONV SV*	Perl_newRV_noinc(pTHX_ SV* sv)
+PERL_CALLCONV SV*	Perl_newRV_noinc(pTHX_ SV *const sv)
 			__attribute__malloc__
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_NEWRV_NOINC	\
 	assert(sv)
 
-PERL_CALLCONV SV*	Perl_newSV(pTHX_ STRLEN len)
+PERL_CALLCONV SV*	Perl_newSV(pTHX_ const STRLEN len)
 			__attribute__malloc__
 			__attribute__warn_unused_result__;
 
@@ -2195,31 +2299,31 @@
 #define PERL_ARGS_ASSERT_NEWSVOP	\
 	assert(sv)
 
-PERL_CALLCONV SV*	Perl_newSViv(pTHX_ IV i)
+PERL_CALLCONV SV*	Perl_newSViv(pTHX_ const IV i)
 			__attribute__malloc__
 			__attribute__warn_unused_result__;
 
-PERL_CALLCONV SV*	Perl_newSVuv(pTHX_ UV u)
+PERL_CALLCONV SV*	Perl_newSVuv(pTHX_ const UV u)
 			__attribute__malloc__
 			__attribute__warn_unused_result__;
 
-PERL_CALLCONV SV*	Perl_newSVnv(pTHX_ NV n)
+PERL_CALLCONV SV*	Perl_newSVnv(pTHX_ const NV n)
 			__attribute__malloc__
 			__attribute__warn_unused_result__;
 
-PERL_CALLCONV SV*	Perl_newSVpv(pTHX_ const char* s, STRLEN len)
+PERL_CALLCONV SV*	Perl_newSVpv(pTHX_ const char *const s, const STRLEN len)
 			__attribute__malloc__
 			__attribute__warn_unused_result__;
 
-PERL_CALLCONV SV*	Perl_newSVpvn(pTHX_ const char* s, STRLEN len)
+PERL_CALLCONV SV*	Perl_newSVpvn(pTHX_ const char *const s, const STRLEN len)
 			__attribute__malloc__
 			__attribute__warn_unused_result__;
 
-PERL_CALLCONV SV*	Perl_newSVpvn_flags(pTHX_ const char* s, STRLEN len, U32 flags)
+PERL_CALLCONV SV*	Perl_newSVpvn_flags(pTHX_ const char *const s, const STRLEN len, const U32 flags)
 			__attribute__malloc__
 			__attribute__warn_unused_result__;
 
-PERL_CALLCONV SV*	Perl_newSVhek(pTHX_ const HEK *hek)
+PERL_CALLCONV SV*	Perl_newSVhek(pTHX_ const HEK *const hek)
 			__attribute__malloc__
 			__attribute__warn_unused_result__;
 
@@ -2227,7 +2331,7 @@
 			__attribute__malloc__
 			__attribute__warn_unused_result__;
 
-PERL_CALLCONV SV*	Perl_newSVpvf(pTHX_ const char* pat, ...)
+PERL_CALLCONV SV*	Perl_newSVpvf(pTHX_ const char *const pat, ...)
 			__attribute__malloc__
 			__attribute__warn_unused_result__
 			__attribute__format__(__printf__,pTHX_1,pTHX_2)
@@ -2235,23 +2339,23 @@
 #define PERL_ARGS_ASSERT_NEWSVPVF	\
 	assert(pat)
 
-PERL_CALLCONV SV*	Perl_vnewSVpvf(pTHX_ const char* pat, va_list* args)
+PERL_CALLCONV SV*	Perl_vnewSVpvf(pTHX_ const char *const pat, va_list *const args)
 			__attribute__malloc__
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_VNEWSVPVF	\
 	assert(pat)
 
-PERL_CALLCONV SV*	Perl_newSVrv(pTHX_ SV* rv, const char* classname)
+PERL_CALLCONV SV*	Perl_newSVrv(pTHX_ SV *const rv, const char *const classname)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_NEWSVRV	\
 	assert(rv)
 
-PERL_CALLCONV SV*	Perl_newSVsv(pTHX_ SV* old)
+PERL_CALLCONV SV*	Perl_newSVsv(pTHX_ SV *const old)
 			__attribute__malloc__
 			__attribute__warn_unused_result__;
 
-PERL_CALLCONV SV*	Perl_newSV_type(pTHX_ svtype type)
+PERL_CALLCONV SV*	Perl_newSV_type(pTHX_ const svtype type)
 			__attribute__malloc__
 			__attribute__warn_unused_result__;
 
@@ -2274,7 +2378,7 @@
 			__attribute__malloc__
 			__attribute__warn_unused_result__;
 
-PERL_CALLCONV char*	Perl_scan_vstring(pTHX_ const char *s, const char *e, SV *sv)
+PERL_CALLCONV char*	Perl_scan_vstring(pTHX_ const char *s, const char *const e, SV *sv)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2)
 			__attribute__nonnull__(pTHX_3);
@@ -2287,6 +2391,11 @@
 #define PERL_ARGS_ASSERT_SCAN_VERSION	\
 	assert(s); assert(rv)
 
+PERL_CALLCONV const char*	Perl_prescan_version(pTHX_ const char *s, bool strict, const char** errstr, bool *sqv, int *ssaw_decimal, int *swidth, bool *salpha)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_PRESCAN_VERSION	\
+	assert(s)
+
 PERL_CALLCONV SV*	Perl_new_version(pTHX_ SV *ver)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_NEW_VERSION	\
@@ -2328,21 +2437,15 @@
 #define PERL_ARGS_ASSERT_NEXTARGV	\
 	assert(gv)
 
-PERL_CALLCONV char*	Perl_ninstr(pTHX_ const char* big, const char* bigend, const char* little, const char* lend)
+PERL_CALLCONV char*	Perl_ninstr(const char* big, const char* bigend, const char* little, const char* lend)
 			__attribute__pure__
-			__attribute__nonnull__(pTHX_1)
-			__attribute__nonnull__(pTHX_2)
-			__attribute__nonnull__(pTHX_3)
-			__attribute__nonnull__(pTHX_4);
+			__attribute__nonnull__(1)
+			__attribute__nonnull__(2)
+			__attribute__nonnull__(3)
+			__attribute__nonnull__(4);
 #define PERL_ARGS_ASSERT_NINSTR	\
 	assert(big); assert(bigend); assert(little); assert(lend)
 
-PERL_CALLCONV OP*	Perl_oopsCV(pTHX_ OP* o)
-			__attribute__noreturn__
-			__attribute__nonnull__(pTHX_1);
-#define PERL_ARGS_ASSERT_OOPSCV	\
-	assert(o)
-
 PERL_CALLCONV void	Perl_op_free(pTHX_ OP* arg);
 #ifdef PERL_MAD
 PERL_CALLCONV OP*	Perl_package(pTHX_ OP* o)
@@ -2357,13 +2460,18 @@
 	assert(o)
 
 #endif
+PERL_CALLCONV void	Perl_package_version(pTHX_ OP* v)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_PACKAGE_VERSION	\
+	assert(v)
+
 PERL_CALLCONV PADOFFSET	Perl_pad_alloc(pTHX_ I32 optype, U32 tmptype);
-PERL_CALLCONV PADOFFSET	Perl_allocmy(pTHX_ const char *const name)
+PERL_CALLCONV PADOFFSET	Perl_allocmy(pTHX_ const char *const name, const STRLEN len, const U32 flags)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_ALLOCMY	\
 	assert(name)
 
-PERL_CALLCONV PADOFFSET	Perl_pad_findmy(pTHX_ const char* name)
+PERL_CALLCONV PADOFFSET	Perl_pad_findmy(pTHX_ const char* name, STRLEN len, U32 flags)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_PAD_FINDMY	\
@@ -2383,9 +2491,13 @@
 	assert(o)
 
 PERL_CALLCONV void	Perl_pad_leavemy(pTHX);
+#ifdef DEBUGGING
 PERL_CALLCONV SV*	Perl_pad_sv(pTHX_ PADOFFSET po);
+#endif
 PERL_CALLCONV void	Perl_pad_free(pTHX_ PADOFFSET po);
-PERL_CALLCONV void	Perl_pad_reset(pTHX);
+#if defined(PERL_IN_PAD_C) || defined(PERL_DECL_PROT)
+STATIC void	S_pad_reset(pTHX);
+#endif
 PERL_CALLCONV void	Perl_pad_swipe(pTHX_ PADOFFSET po, bool refadjust);
 PERL_CALLCONV void	Perl_peep(pTHX_ OP* o);
 PERL_CALLCONV PerlIO*	Perl_start_glob(pTHX_ SV *tmpglob, IO *io)
@@ -2503,10 +2615,11 @@
 #define PERL_ARGS_ASSERT_PACKLIST	\
 	assert(cat); assert(pat); assert(patend); assert(beglist); assert(endlist)
 
-#ifdef PERL_USES_PL_PIDSTATUS
-PERL_CALLCONV void	Perl_pidgone(pTHX_ Pid_t pid, int status);
+#if defined(PERL_USES_PL_PIDSTATUS) && defined(PERL_IN_UTIL_C)
+STATIC void	S_pidgone(pTHX_ Pid_t pid, int status);
 #endif
-PERL_CALLCONV void	Perl_pmflag(pTHX_ U32* pmfl, int ch)
+PERL_CALLCONV void	Perl_pmflag(pTHX_ U32 *pmfl, int ch)
+			__attribute__deprecated__
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_PMFLAG	\
 	assert(pmfl)
@@ -2517,18 +2630,22 @@
 #define PERL_ARGS_ASSERT_PMRUNTIME	\
 	assert(o); assert(expr)
 
-PERL_CALLCONV OP*	Perl_pmtrans(pTHX_ OP* o, OP* expr, OP* repl)
+#if defined(PERL_IN_OP_C) || defined(PERL_DECL_PROT)
+STATIC OP*	S_pmtrans(pTHX_ OP* o, OP* expr, OP* repl)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2)
 			__attribute__nonnull__(pTHX_3);
 #define PERL_ARGS_ASSERT_PMTRANS	\
 	assert(o); assert(expr); assert(repl)
 
+#endif
 PERL_CALLCONV void	Perl_pop_scope(pTHX);
 PERL_CALLCONV OP*	Perl_prepend_elem(pTHX_ I32 optype, OP* head, OP* tail);
 PERL_CALLCONV void	Perl_push_scope(pTHX);
 /* PERL_CALLCONV OP*	Perl_ref(pTHX_ OP* o, I32 type); */
-PERL_CALLCONV OP*	Perl_refkids(pTHX_ OP* o, I32 type);
+#if defined(PERL_IN_OP_C) || defined(PERL_DECL_PROT)
+STATIC OP*	S_refkids(pTHX_ OP* o, I32 type);
+#endif
 PERL_CALLCONV void	Perl_regdump(pTHX_ const regexp* r)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_REGDUMP	\
@@ -2554,20 +2671,20 @@
 	assert(prog); assert(stringarg); assert(strend); assert(strbeg); assert(screamer)
 
 PERL_CALLCONV void	Perl_pregfree(pTHX_ REGEXP* r);
-PERL_CALLCONV REGEXP*	Perl_reg_temp_copy(pTHX_ REGEXP* r)
+PERL_CALLCONV void	Perl_pregfree2(pTHX_ REGEXP *rx)
 			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_PREGFREE2	\
+	assert(rx)
+
+PERL_CALLCONV REGEXP*	Perl_reg_temp_copy(pTHX_ REGEXP* ret_x, REGEXP* rx)
+			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_REG_TEMP_COPY	\
-	assert(r)
+	assert(rx)
 
-PERL_CALLCONV void	Perl_regfree_internal(pTHX_ REGEXP *const r)
+PERL_CALLCONV void	Perl_regfree_internal(pTHX_ REGEXP *const rx)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_REGFREE_INTERNAL	\
-	assert(r)
-
-PERL_CALLCONV char *	Perl_reg_stringify(pTHX_ MAGIC *mg, STRLEN *lp, U32 *flags, I32 *haseval)
-			__attribute__nonnull__(pTHX_1);
-#define PERL_ARGS_ASSERT_REG_STRINGIFY	\
-	assert(mg)
+	assert(rx)
 
 #if defined(USE_ITHREADS)
 PERL_CALLCONV void*	Perl_regdupe_internal(pTHX_ REGEXP * const r, CLONE_PARAMS* param)
@@ -2577,36 +2694,36 @@
 	assert(r); assert(param)
 
 #endif
-PERL_CALLCONV REGEXP*	Perl_pregcomp(pTHX_ const SV * const pattern, const U32 flags)
+PERL_CALLCONV REGEXP*	Perl_pregcomp(pTHX_ SV * const pattern, const U32 flags)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_PREGCOMP	\
 	assert(pattern)
 
-PERL_CALLCONV REGEXP*	Perl_re_compile(pTHX_ const SV * const pattern, const U32 flags)
+PERL_CALLCONV REGEXP*	Perl_re_compile(pTHX_ SV * const pattern, U32 flags)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_RE_COMPILE	\
 	assert(pattern)
 
-PERL_CALLCONV char*	Perl_re_intuit_start(pTHX_ REGEXP * const prog, SV* sv, char* strpos, char* strend, const U32 flags, re_scream_pos_data *data)
+PERL_CALLCONV char*	Perl_re_intuit_start(pTHX_ REGEXP * const rx, SV* sv, char* strpos, char* strend, const U32 flags, re_scream_pos_data *data)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_3)
 			__attribute__nonnull__(pTHX_4);
 #define PERL_ARGS_ASSERT_RE_INTUIT_START	\
-	assert(prog); assert(strpos); assert(strend)
+	assert(rx); assert(strpos); assert(strend)
 
-PERL_CALLCONV SV*	Perl_re_intuit_string(pTHX_ REGEXP  *const prog)
+PERL_CALLCONV SV*	Perl_re_intuit_string(pTHX_ REGEXP  *const r)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_RE_INTUIT_STRING	\
-	assert(prog)
+	assert(r)
 
-PERL_CALLCONV I32	Perl_regexec_flags(pTHX_ REGEXP *const prog, char *stringarg, char *strend, char *strbeg, I32 minend, SV *sv, void *data, U32 flags)
+PERL_CALLCONV I32	Perl_regexec_flags(pTHX_ REGEXP *const rx, char *stringarg, char *strend, char *strbeg, I32 minend, SV *sv, void *data, U32 flags)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2)
 			__attribute__nonnull__(pTHX_3)
 			__attribute__nonnull__(pTHX_4)
 			__attribute__nonnull__(pTHX_6);
 #define PERL_ARGS_ASSERT_REGEXEC_FLAGS	\
-	assert(prog); assert(stringarg); assert(strend); assert(strbeg); assert(sv)
+	assert(rx); assert(stringarg); assert(strend); assert(strbeg); assert(sv)
 
 PERL_CALLCONV regnode*	Perl_regnext(pTHX_ regnode* p)
 			__attribute__warn_unused_result__;
@@ -2684,18 +2801,18 @@
 #define PERL_ARGS_ASSERT_REGPROP	\
 	assert(sv); assert(o)
 
-PERL_CALLCONV void	Perl_repeatcpy(pTHX_ char* to, const char* from, I32 len, I32 count)
-			__attribute__nonnull__(pTHX_1)
-			__attribute__nonnull__(pTHX_2);
+PERL_CALLCONV void	Perl_repeatcpy(char* to, const char* from, I32 len, I32 count)
+			__attribute__nonnull__(1)
+			__attribute__nonnull__(2);
 #define PERL_ARGS_ASSERT_REPEATCPY	\
 	assert(to); assert(from)
 
-PERL_CALLCONV char*	Perl_rninstr(pTHX_ const char* big, const char* bigend, const char* little, const char* lend)
+PERL_CALLCONV char*	Perl_rninstr(const char* big, const char* bigend, const char* little, const char* lend)
 			__attribute__pure__
-			__attribute__nonnull__(pTHX_1)
-			__attribute__nonnull__(pTHX_2)
-			__attribute__nonnull__(pTHX_3)
-			__attribute__nonnull__(pTHX_4);
+			__attribute__nonnull__(1)
+			__attribute__nonnull__(2)
+			__attribute__nonnull__(3)
+			__attribute__nonnull__(4);
 #define PERL_ARGS_ASSERT_RNINSTR	\
 	assert(big); assert(bigend); assert(little); assert(lend)
 
@@ -2707,17 +2824,19 @@
 	assert(save)
 
 PERL_CALLCONV Sighandler_t	Perl_rsignal_state(pTHX_ int i);
-PERL_CALLCONV void	Perl_rxres_free(pTHX_ void** rsp)
+#if defined(PERL_IN_PP_CTL_C) || defined(PERL_DECL_PROT)
+STATIC void	S_rxres_free(pTHX_ void** rsp)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_RXRES_FREE	\
 	assert(rsp)
 
-PERL_CALLCONV void	Perl_rxres_restore(pTHX_ void **rsp, REGEXP *rx)
+STATIC void	S_rxres_restore(pTHX_ void **rsp, REGEXP *rx)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_RXRES_RESTORE	\
 	assert(rsp); assert(rx)
 
+#endif
 PERL_CALLCONV void	Perl_rxres_save(pTHX_ void **rsp, REGEXP *rx)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
@@ -2760,10 +2879,14 @@
 
 PERL_CALLCONV void	Perl_savestack_grow(pTHX);
 PERL_CALLCONV void	Perl_savestack_grow_cnt(pTHX_ I32 need);
-PERL_CALLCONV void	Perl_save_aelem(pTHX_ AV* av, I32 idx, SV **sptr)
+/* PERL_CALLCONV void	Perl_save_aelem(pTHX_ AV* av, I32 idx, SV **sptr)
+			__attribute__nonnull__(pTHX_1)
+			__attribute__nonnull__(pTHX_3); */
+
+PERL_CALLCONV void	Perl_save_aelem_flags(pTHX_ AV* av, I32 idx, SV **sptr, const U32 flags)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_3);
-#define PERL_ARGS_ASSERT_SAVE_AELEM	\
+#define PERL_ARGS_ASSERT_SAVE_AELEM_FLAGS	\
 	assert(av); assert(sptr)
 
 PERL_CALLCONV I32	Perl_save_alloc(pTHX_ I32 size, I32 pad);
@@ -2793,6 +2916,17 @@
 #define PERL_ARGS_ASSERT_SAVE_DELETE	\
 	assert(hv); assert(key)
 
+PERL_CALLCONV void	Perl_save_hdelete(pTHX_ HV *hv, SV *keysv)
+			__attribute__nonnull__(pTHX_1)
+			__attribute__nonnull__(pTHX_2);
+#define PERL_ARGS_ASSERT_SAVE_HDELETE	\
+	assert(hv); assert(keysv)
+
+PERL_CALLCONV void	Perl_save_adelete(pTHX_ AV *av, I32 key)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_SAVE_ADELETE	\
+	assert(av)
+
 PERL_CALLCONV void	Perl_save_destructor(pTHX_ DESTRUCTORFUNC_NOCONTEXT_t f, void* p)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SAVE_DESTRUCTOR	\
@@ -2828,11 +2962,16 @@
 	assert(gv)
 
 PERL_CALLCONV void	Perl_save_hints(pTHX);
-PERL_CALLCONV void	Perl_save_helem(pTHX_ HV *hv, SV *key, SV **sptr)
+/* PERL_CALLCONV void	Perl_save_helem(pTHX_ HV *hv, SV *key, SV **sptr)
+			__attribute__nonnull__(pTHX_1)
+			__attribute__nonnull__(pTHX_2)
+			__attribute__nonnull__(pTHX_3); */
+
+PERL_CALLCONV void	Perl_save_helem_flags(pTHX_ HV *hv, SV *key, SV **sptr, const U32 flags)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2)
 			__attribute__nonnull__(pTHX_3);
-#define PERL_ARGS_ASSERT_SAVE_HELEM	\
+#define PERL_ARGS_ASSERT_SAVE_HELEM_FLAGS	\
 	assert(hv); assert(key); assert(sptr)
 
 PERL_CALLCONV void	Perl_save_hptr(pTHX_ HV** hptr)
@@ -2907,7 +3046,6 @@
 	assert(ptr)
 
 PERL_CALLCONV void	Perl_save_re_context(pTHX);
-PERL_CALLCONV void	Perl_save_padsv(pTHX_ PADOFFSET off);
 PERL_CALLCONV void	Perl_save_padsv_and_mortalize(pTHX_ PADOFFSET off);
 PERL_CALLCONV void	Perl_save_sptr(pTHX_ SV** sptr)
 			__attribute__nonnull__(pTHX_1);
@@ -2927,8 +3065,10 @@
 #endif
 PERL_CALLCONV OP*	Perl_sawparens(pTHX_ OP* o);
 PERL_CALLCONV OP*	Perl_scalar(pTHX_ OP* o);
-PERL_CALLCONV OP*	Perl_scalarkids(pTHX_ OP* o);
-PERL_CALLCONV OP*	Perl_scalarseq(pTHX_ OP* o);
+#if defined(PERL_IN_OP_C) || defined(PERL_DECL_PROT)
+STATIC OP*	S_scalarkids(pTHX_ OP* o);
+STATIC OP*	S_scalarseq(pTHX_ OP* o);
+#endif
 PERL_CALLCONV OP*	Perl_scalarvoid(pTHX_ OP* o)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SCALARVOID	\
@@ -2966,13 +3106,6 @@
 #define PERL_ARGS_ASSERT_SCREAMINSTR	\
 	assert(bigstr); assert(littlestr); assert(old_posp)
 
-#if !defined(VMS)
-PERL_CALLCONV I32	Perl_setenv_getix(pTHX_ const char* nam)
-			__attribute__nonnull__(pTHX_1);
-#define PERL_ARGS_ASSERT_SETENV_GETIX	\
-	assert(nam)
-
-#endif
 PERL_CALLCONV void	Perl_setdefout(pTHX_ GV* gv);
 PERL_CALLCONV HEK*	Perl_share_hek(pTHX_ const char* str, I32 len, U32 hash)
 			__attribute__nonnull__(pTHX_1);
@@ -2998,18 +3131,18 @@
 #define PERL_ARGS_ASSERT_SUB_CRUSH_DEPTH	\
 	assert(cv)
 
-PERL_CALLCONV bool	Perl_sv_2bool(pTHX_ SV* sv)
+PERL_CALLCONV bool	Perl_sv_2bool(pTHX_ SV *const sv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_2BOOL	\
 	assert(sv)
 
-PERL_CALLCONV CV*	Perl_sv_2cv(pTHX_ SV* sv, HV** st, GV** gvp, I32 lref)
+PERL_CALLCONV CV*	Perl_sv_2cv(pTHX_ SV* sv, HV **const st, GV **const gvp, const I32 lref)
 			__attribute__nonnull__(pTHX_2)
 			__attribute__nonnull__(pTHX_3);
 #define PERL_ARGS_ASSERT_SV_2CV	\
 	assert(st); assert(gvp)
 
-PERL_CALLCONV IO*	Perl_sv_2io(pTHX_ SV* sv)
+PERL_CALLCONV IO*	Perl_sv_2io(pTHX_ SV *const sv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_2IO	\
 	assert(sv)
@@ -3020,29 +3153,24 @@
 #define PERL_ARGS_ASSERT_GLOB_2NUMBER	\
 	assert(gv)
 
-STATIC char*	S_glob_2pv(pTHX_ GV* const gv, STRLEN * const len)
-			__attribute__nonnull__(pTHX_1);
-#define PERL_ARGS_ASSERT_GLOB_2PV	\
-	assert(gv)
-
 #endif
-/* PERL_CALLCONV IV	Perl_sv_2iv(pTHX_ SV* sv); */
-PERL_CALLCONV IV	Perl_sv_2iv_flags(pTHX_ SV* sv, I32 flags);
-PERL_CALLCONV SV*	Perl_sv_2mortal(pTHX_ SV* sv);
-PERL_CALLCONV NV	Perl_sv_2nv(pTHX_ SV* sv);
-PERL_CALLCONV SV*	Perl_sv_2num(pTHX_ SV* sv)
+/* PERL_CALLCONV IV	Perl_sv_2iv(pTHX_ SV *sv); */
+PERL_CALLCONV IV	Perl_sv_2iv_flags(pTHX_ SV *const sv, const I32 flags);
+PERL_CALLCONV SV*	Perl_sv_2mortal(pTHX_ SV *const sv);
+PERL_CALLCONV NV	Perl_sv_2nv(pTHX_ SV *const sv);
+PERL_CALLCONV SV*	Perl_sv_2num(pTHX_ SV *const sv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_2NUM	\
 	assert(sv)
 
-/* PERL_CALLCONV char*	Perl_sv_2pv(pTHX_ SV* sv, STRLEN* lp); */
-PERL_CALLCONV char*	Perl_sv_2pv_flags(pTHX_ SV* sv, STRLEN* lp, I32 flags);
-PERL_CALLCONV char*	Perl_sv_2pvutf8(pTHX_ SV* sv, STRLEN* lp)
+/* PERL_CALLCONV char*	Perl_sv_2pv(pTHX_ SV *sv, STRLEN *lp); */
+PERL_CALLCONV char*	Perl_sv_2pv_flags(pTHX_ SV *const sv, STRLEN *const lp, const I32 flags);
+PERL_CALLCONV char*	Perl_sv_2pvutf8(pTHX_ SV *const sv, STRLEN *const lp)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_2PVUTF8	\
 	assert(sv)
 
-PERL_CALLCONV char*	Perl_sv_2pvbyte(pTHX_ SV* sv, STRLEN* lp)
+PERL_CALLCONV char*	Perl_sv_2pvbyte(pTHX_ SV *const sv, STRLEN *const lp)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_2PVBYTE	\
 	assert(sv)
@@ -3052,8 +3180,8 @@
 #define PERL_ARGS_ASSERT_SV_PVN_NOMG	\
 	assert(sv)
 
-/* PERL_CALLCONV UV	Perl_sv_2uv(pTHX_ SV* sv); */
-PERL_CALLCONV UV	Perl_sv_2uv_flags(pTHX_ SV* sv, I32 flags);
+/* PERL_CALLCONV UV	Perl_sv_2uv(pTHX_ SV *sv); */
+PERL_CALLCONV UV	Perl_sv_2uv_flags(pTHX_ SV *const sv, const I32 flags);
 PERL_CALLCONV IV	Perl_sv_iv(pTHX_ SV* sv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_IV	\
@@ -3087,37 +3215,39 @@
 #define PERL_ARGS_ASSERT_SV_PVBYTEN	\
 	assert(sv); assert(lp)
 
-PERL_CALLCONV I32	Perl_sv_true(pTHX_ SV *sv);
-PERL_CALLCONV void	Perl_sv_add_arena(pTHX_ char* ptr, U32 size, U32 flags)
+PERL_CALLCONV I32	Perl_sv_true(pTHX_ SV *const sv);
+#if defined(PERL_IN_SV_C) || defined(PERL_DECL_PROT)
+STATIC void	S_sv_add_arena(pTHX_ char *const ptr, const U32 size, const U32 flags)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_ADD_ARENA	\
 	assert(ptr)
 
-PERL_CALLCONV int	Perl_sv_backoff(pTHX_ SV* sv)
+#endif
+PERL_CALLCONV int	Perl_sv_backoff(pTHX_ SV *const sv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_BACKOFF	\
 	assert(sv)
 
-PERL_CALLCONV SV*	Perl_sv_bless(pTHX_ SV* sv, HV* stash)
+PERL_CALLCONV SV*	Perl_sv_bless(pTHX_ SV *const sv, HV *const stash)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_BLESS	\
 	assert(sv); assert(stash)
 
-PERL_CALLCONV void	Perl_sv_catpvf(pTHX_ SV* sv, const char* pat, ...)
+PERL_CALLCONV void	Perl_sv_catpvf(pTHX_ SV *const sv, const char *const pat, ...)
 			__attribute__format__(__printf__,pTHX_2,pTHX_3)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_CATPVF	\
 	assert(sv); assert(pat)
 
-PERL_CALLCONV void	Perl_sv_vcatpvf(pTHX_ SV* sv, const char* pat, va_list* args)
+PERL_CALLCONV void	Perl_sv_vcatpvf(pTHX_ SV *const sv, const char *const pat, va_list *const args)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_VCATPVF	\
 	assert(sv); assert(pat)
 
-PERL_CALLCONV void	Perl_sv_catpv(pTHX_ SV* sv, const char* ptr)
+PERL_CALLCONV void	Perl_sv_catpv(pTHX_ SV *const sv, const char* ptr)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_CATPV	\
 	assert(sv)
@@ -3133,22 +3263,22 @@
 #define PERL_ARGS_ASSERT_SV_CATSV	\
 	assert(dstr)
 
-PERL_CALLCONV void	Perl_sv_chop(pTHX_ SV* sv, const char* ptr)
+PERL_CALLCONV void	Perl_sv_chop(pTHX_ SV *const sv, const char *const ptr)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_CHOP	\
 	assert(sv)
 
 PERL_CALLCONV I32	Perl_sv_clean_all(pTHX);
 PERL_CALLCONV void	Perl_sv_clean_objs(pTHX);
-PERL_CALLCONV void	Perl_sv_clear(pTHX_ SV* sv)
+PERL_CALLCONV void	Perl_sv_clear(pTHX_ SV *const sv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_CLEAR	\
 	assert(sv)
 
-PERL_CALLCONV I32	Perl_sv_cmp(pTHX_ SV* sv1, SV* sv2);
-PERL_CALLCONV I32	Perl_sv_cmp_locale(pTHX_ SV* sv1, SV* sv2);
+PERL_CALLCONV I32	Perl_sv_cmp(pTHX_ SV *const sv1, SV *const sv2);
+PERL_CALLCONV I32	Perl_sv_cmp_locale(pTHX_ SV *const sv1, SV *const sv2);
 #if defined(USE_LOCALE_COLLATE)
-PERL_CALLCONV char*	Perl_sv_collxfrm(pTHX_ SV* sv, STRLEN* nxp)
+PERL_CALLCONV char*	Perl_sv_collxfrm(pTHX_ SV *const sv, STRLEN *const nxp)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_COLLXFRM	\
@@ -3168,20 +3298,20 @@
 #define PERL_ARGS_ASSERT_GETCWD_SV	\
 	assert(sv)
 
-PERL_CALLCONV void	Perl_sv_dec(pTHX_ SV* sv);
+PERL_CALLCONV void	Perl_sv_dec(pTHX_ SV *const sv);
 PERL_CALLCONV void	Perl_sv_dump(pTHX_ SV* sv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_DUMP	\
 	assert(sv)
 
-PERL_CALLCONV bool	Perl_sv_derived_from(pTHX_ SV* sv, const char* name)
+PERL_CALLCONV bool	Perl_sv_derived_from(pTHX_ SV* sv, const char *const name)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_DERIVED_FROM	\
 	assert(sv); assert(name)
 
-PERL_CALLCONV bool	Perl_sv_does(pTHX_ SV* sv, const char* name)
+PERL_CALLCONV bool	Perl_sv_does(pTHX_ SV* sv, const char *const name)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
@@ -3189,26 +3319,26 @@
 	assert(sv); assert(name)
 
 PERL_CALLCONV I32	Perl_sv_eq(pTHX_ SV* sv1, SV* sv2);
-PERL_CALLCONV void	Perl_sv_free(pTHX_ SV* sv);
-PERL_CALLCONV void	Perl_sv_free2(pTHX_ SV* sv)
+PERL_CALLCONV void	Perl_sv_free(pTHX_ SV *const sv);
+PERL_CALLCONV void	Perl_sv_free2(pTHX_ SV *const sv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_FREE2	\
 	assert(sv)
 
 PERL_CALLCONV void	Perl_sv_free_arenas(pTHX);
-PERL_CALLCONV char*	Perl_sv_gets(pTHX_ SV* sv, PerlIO* fp, I32 append)
+PERL_CALLCONV char*	Perl_sv_gets(pTHX_ SV *const sv, PerlIO *const fp, I32 append)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_GETS	\
 	assert(sv); assert(fp)
 
-PERL_CALLCONV char*	Perl_sv_grow(pTHX_ SV* sv, STRLEN newlen)
+PERL_CALLCONV char*	Perl_sv_grow(pTHX_ SV *const sv, STRLEN newlen)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_GROW	\
 	assert(sv)
 
-PERL_CALLCONV void	Perl_sv_inc(pTHX_ SV* sv);
-/* PERL_CALLCONV void	Perl_sv_insert(pTHX_ SV *bigstr, STRLEN offset, STRLEN len, const char *little, STRLEN littlelen)
+PERL_CALLCONV void	Perl_sv_inc(pTHX_ SV *const sv);
+/* PERL_CALLCONV void	Perl_sv_insert(pTHX_ SV *const bigstr, const STRLEN offset, const STRLEN len, const char *const little, const STRLEN littlelen)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_4); */
 #define PERL_ARGS_ASSERT_SV_INSERT	\
@@ -3220,39 +3350,44 @@
 #define PERL_ARGS_ASSERT_SV_INSERT_FLAGS	\
 	assert(bigstr); assert(little)
 
-PERL_CALLCONV int	Perl_sv_isa(pTHX_ SV* sv, const char* name)
+PERL_CALLCONV int	Perl_sv_isa(pTHX_ SV* sv, const char *const name)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_ISA	\
 	assert(name)
 
 PERL_CALLCONV int	Perl_sv_isobject(pTHX_ SV* sv);
-PERL_CALLCONV STRLEN	Perl_sv_len(pTHX_ SV* sv);
-PERL_CALLCONV STRLEN	Perl_sv_len_utf8(pTHX_ SV* sv);
-PERL_CALLCONV void	Perl_sv_magic(pTHX_ SV* sv, SV* obj, int how, const char* name, I32 namlen)
+PERL_CALLCONV STRLEN	Perl_sv_len(pTHX_ SV *const sv);
+PERL_CALLCONV STRLEN	Perl_sv_len_utf8(pTHX_ SV *const sv);
+PERL_CALLCONV void	Perl_sv_magic(pTHX_ SV *const sv, SV *const obj, const int how, const char *const name, const I32 namlen)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_MAGIC	\
 	assert(sv)
 
-PERL_CALLCONV MAGIC *	Perl_sv_magicext(pTHX_ SV* sv, SV* obj, int how, const MGVTBL *vtbl, const char* name, I32 namlen)
+PERL_CALLCONV MAGIC *	Perl_sv_magicext(pTHX_ SV *const sv, SV *const obj, const int how, const MGVTBL *const vtbl, const char *const name, const I32 namlen)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_MAGICEXT	\
 	assert(sv)
 
-PERL_CALLCONV SV*	Perl_sv_mortalcopy(pTHX_ SV* oldsv)
+PERL_CALLCONV SV*	Perl_sv_mortalcopy(pTHX_ SV *const oldsv)
 			__attribute__malloc__
 			__attribute__warn_unused_result__;
 
 PERL_CALLCONV SV*	Perl_sv_newmortal(pTHX)
 			__attribute__warn_unused_result__;
 
-PERL_CALLCONV SV*	Perl_sv_newref(pTHX_ SV* sv);
+PERL_CALLCONV SV*	Perl_sv_newref(pTHX_ SV *const sv);
 PERL_CALLCONV char*	Perl_sv_peek(pTHX_ SV* sv);
-PERL_CALLCONV void	Perl_sv_pos_u2b(pTHX_ SV* sv, I32* offsetp, I32* lenp)
+PERL_CALLCONV void	Perl_sv_pos_u2b(pTHX_ SV *const sv, I32 *const offsetp, I32 *const lenp)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_POS_U2B	\
 	assert(offsetp)
 
-PERL_CALLCONV void	Perl_sv_pos_b2u(pTHX_ SV* sv, I32* offsetp)
+PERL_CALLCONV STRLEN	Perl_sv_pos_u2b_flags(pTHX_ SV *const sv, STRLEN uoffset, STRLEN *const lenp, U32 flags)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_SV_POS_U2B_FLAGS	\
+	assert(sv)
+
+PERL_CALLCONV void	Perl_sv_pos_b2u(pTHX_ SV *const sv, I32 *const offsetp)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_POS_B2U	\
 	assert(offsetp)
@@ -3262,12 +3397,12 @@
 #define PERL_ARGS_ASSERT_SV_PVN_FORCE	\
 	assert(sv)
 
-PERL_CALLCONV char*	Perl_sv_pvutf8n_force(pTHX_ SV* sv, STRLEN* lp)
+PERL_CALLCONV char*	Perl_sv_pvutf8n_force(pTHX_ SV *const sv, STRLEN *const lp)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_PVUTF8N_FORCE	\
 	assert(sv)
 
-PERL_CALLCONV char*	Perl_sv_pvbyten_force(pTHX_ SV* sv, STRLEN* lp)
+PERL_CALLCONV char*	Perl_sv_pvbyten_force(pTHX_ SV *const sv, STRLEN *const lp)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_PVBYTEN_FORCE	\
 	assert(sv)
@@ -3287,89 +3422,89 @@
 #define PERL_ARGS_ASSERT_SV_CAT_DECODE	\
 	assert(dsv); assert(encoding); assert(ssv); assert(offset); assert(tstr)
 
-PERL_CALLCONV const char*	Perl_sv_reftype(pTHX_ const SV* sv, int ob)
+PERL_CALLCONV const char*	Perl_sv_reftype(pTHX_ const SV *const sv, const int ob)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_REFTYPE	\
 	assert(sv)
 
-PERL_CALLCONV void	Perl_sv_replace(pTHX_ SV* sv, SV* nsv)
+PERL_CALLCONV void	Perl_sv_replace(pTHX_ SV *const sv, SV *const nsv)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_REPLACE	\
 	assert(sv); assert(nsv)
 
 PERL_CALLCONV void	Perl_sv_report_used(pTHX);
-PERL_CALLCONV void	Perl_sv_reset(pTHX_ const char* s, HV* stash)
+PERL_CALLCONV void	Perl_sv_reset(pTHX_ const char* s, HV *const stash)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_RESET	\
 	assert(s)
 
-PERL_CALLCONV void	Perl_sv_setpvf(pTHX_ SV* sv, const char* pat, ...)
+PERL_CALLCONV void	Perl_sv_setpvf(pTHX_ SV *const sv, const char *const pat, ...)
 			__attribute__format__(__printf__,pTHX_2,pTHX_3)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_SETPVF	\
 	assert(sv); assert(pat)
 
-PERL_CALLCONV void	Perl_sv_vsetpvf(pTHX_ SV* sv, const char* pat, va_list* args)
+PERL_CALLCONV void	Perl_sv_vsetpvf(pTHX_ SV *const sv, const char *const pat, va_list *const args)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_VSETPVF	\
 	assert(sv); assert(pat)
 
-PERL_CALLCONV void	Perl_sv_setiv(pTHX_ SV* sv, IV num)
+PERL_CALLCONV void	Perl_sv_setiv(pTHX_ SV *const sv, const IV num)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_SETIV	\
 	assert(sv)
 
-PERL_CALLCONV void	Perl_sv_setpviv(pTHX_ SV* sv, IV num)
+PERL_CALLCONV void	Perl_sv_setpviv(pTHX_ SV *const sv, const IV num)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_SETPVIV	\
 	assert(sv)
 
-PERL_CALLCONV void	Perl_sv_setuv(pTHX_ SV* sv, UV num)
+PERL_CALLCONV void	Perl_sv_setuv(pTHX_ SV *const sv, const UV num)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_SETUV	\
 	assert(sv)
 
-PERL_CALLCONV void	Perl_sv_setnv(pTHX_ SV* sv, NV num)
+PERL_CALLCONV void	Perl_sv_setnv(pTHX_ SV *const sv, const NV num)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_SETNV	\
 	assert(sv)
 
-PERL_CALLCONV SV*	Perl_sv_setref_iv(pTHX_ SV* rv, const char* classname, IV iv)
+PERL_CALLCONV SV*	Perl_sv_setref_iv(pTHX_ SV *const rv, const char *const classname, const IV iv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_SETREF_IV	\
 	assert(rv)
 
-PERL_CALLCONV SV*	Perl_sv_setref_uv(pTHX_ SV* rv, const char* classname, UV uv)
+PERL_CALLCONV SV*	Perl_sv_setref_uv(pTHX_ SV *const rv, const char *const classname, const UV uv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_SETREF_UV	\
 	assert(rv)
 
-PERL_CALLCONV SV*	Perl_sv_setref_nv(pTHX_ SV* rv, const char* classname, NV nv)
+PERL_CALLCONV SV*	Perl_sv_setref_nv(pTHX_ SV *const rv, const char *const classname, const NV nv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_SETREF_NV	\
 	assert(rv)
 
-PERL_CALLCONV SV*	Perl_sv_setref_pv(pTHX_ SV* rv, const char* classname, void* pv)
+PERL_CALLCONV SV*	Perl_sv_setref_pv(pTHX_ SV *const rv, const char *const classname, void *const pv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_SETREF_PV	\
 	assert(rv)
 
-PERL_CALLCONV SV*	Perl_sv_setref_pvn(pTHX_ SV* rv, const char* classname, const char* pv, STRLEN n)
+PERL_CALLCONV SV*	Perl_sv_setref_pvn(pTHX_ SV *const rv, const char *const classname, const char *const pv, const STRLEN n)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_3);
 #define PERL_ARGS_ASSERT_SV_SETREF_PVN	\
 	assert(rv); assert(pv)
 
-PERL_CALLCONV void	Perl_sv_setpv(pTHX_ SV* sv, const char* ptr)
+PERL_CALLCONV void	Perl_sv_setpv(pTHX_ SV *const sv, const char *const ptr)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_SETPV	\
 	assert(sv)
 
-PERL_CALLCONV void	Perl_sv_setpvn(pTHX_ SV* sv, const char* ptr, STRLEN len)
+PERL_CALLCONV void	Perl_sv_setpvn(pTHX_ SV *const sv, const char *const ptr, const STRLEN len)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_SETPVN	\
 	assert(sv)
@@ -3384,13 +3519,13 @@
 #define PERL_ARGS_ASSERT_SV_TAINT	\
 	assert(sv)
 
-PERL_CALLCONV bool	Perl_sv_tainted(pTHX_ SV* sv)
+PERL_CALLCONV bool	Perl_sv_tainted(pTHX_ SV *const sv)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_TAINTED	\
 	assert(sv)
 
-PERL_CALLCONV int	Perl_sv_unmagic(pTHX_ SV* sv, int type)
+PERL_CALLCONV int	Perl_sv_unmagic(pTHX_ SV *const sv, const int type)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_UNMAGIC	\
 	assert(sv)
@@ -3400,17 +3535,17 @@
 #define PERL_ARGS_ASSERT_SV_UNREF	\
 	assert(sv)
 
-PERL_CALLCONV void	Perl_sv_unref_flags(pTHX_ SV *ref, U32 flags)
+PERL_CALLCONV void	Perl_sv_unref_flags(pTHX_ SV *const ref, const U32 flags)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_UNREF_FLAGS	\
 	assert(ref)
 
-PERL_CALLCONV void	Perl_sv_untaint(pTHX_ SV* sv)
+PERL_CALLCONV void	Perl_sv_untaint(pTHX_ SV *const sv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_UNTAINT	\
 	assert(sv)
 
-PERL_CALLCONV void	Perl_sv_upgrade(pTHX_ SV* sv, svtype new_type)
+PERL_CALLCONV void	Perl_sv_upgrade(pTHX_ SV *const sv, svtype new_type)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_UPGRADE	\
 	assert(sv)
@@ -3420,18 +3555,18 @@
 #define PERL_ARGS_ASSERT_SV_USEPVN	\
 	assert(sv)
 
-PERL_CALLCONV void	Perl_sv_usepvn_flags(pTHX_ SV* sv, char* ptr, STRLEN len, U32 flags)
+PERL_CALLCONV void	Perl_sv_usepvn_flags(pTHX_ SV *const sv, char* ptr, const STRLEN len, const U32 flags)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_USEPVN_FLAGS	\
 	assert(sv)
 
-PERL_CALLCONV void	Perl_sv_vcatpvfn(pTHX_ SV* sv, const char* pat, STRLEN patlen, va_list* args, SV** svargs, I32 svmax, bool *maybe_tainted)
+PERL_CALLCONV void	Perl_sv_vcatpvfn(pTHX_ SV *const sv, const char *const pat, const STRLEN patlen, va_list *const args, SV **const svargs, const I32 svmax, bool *const maybe_tainted)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_VCATPVFN	\
 	assert(sv); assert(pat)
 
-PERL_CALLCONV void	Perl_sv_vsetpvfn(pTHX_ SV* sv, const char* pat, STRLEN patlen, va_list* args, SV** svargs, I32 svmax, bool *maybe_tainted)
+PERL_CALLCONV void	Perl_sv_vsetpvfn(pTHX_ SV *const sv, const char *const pat, const STRLEN patlen, va_list *const args, SV **const svargs, const I32 svmax, bool *const maybe_tainted)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_VSETPVFN	\
@@ -3457,7 +3592,7 @@
 	assert(swash); assert(ptr)
 
 PERL_CALLCONV void	Perl_taint_env(pTHX);
-PERL_CALLCONV void	Perl_taint_proper(pTHX_ const char* f, const char* s)
+PERL_CALLCONV void	Perl_taint_proper(pTHX_ const char* f, const char *const s)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_TAINT_PROPER	\
 	assert(s)
@@ -3686,7 +3821,7 @@
 			__attribute__warn_unused_result__;
 
 PERL_CALLCONV void	Perl_report_evil_fh(pTHX_ const GV *gv, const IO *io, I32 op);
-PERL_CALLCONV void	Perl_report_uninit(pTHX_ SV* uninit_sv);
+PERL_CALLCONV void	Perl_report_uninit(pTHX_ const SV *uninit_sv);
 PERL_CALLCONV void	Perl_warn(pTHX_ const char* pat, ...)
 			__attribute__format__(__printf__,pTHX_1,pTHX_2)
 			__attribute__nonnull__(pTHX_1);
@@ -3704,6 +3839,18 @@
 #define PERL_ARGS_ASSERT_WARNER	\
 	assert(pat)
 
+PERL_CALLCONV void	Perl_ck_warner(pTHX_ U32 err, const char* pat, ...)
+			__attribute__format__(__printf__,pTHX_2,pTHX_3)
+			__attribute__nonnull__(pTHX_2);
+#define PERL_ARGS_ASSERT_CK_WARNER	\
+	assert(pat)
+
+PERL_CALLCONV void	Perl_ck_warner_d(pTHX_ U32 err, const char* pat, ...)
+			__attribute__format__(__printf__,pTHX_2,pTHX_3)
+			__attribute__nonnull__(pTHX_2);
+#define PERL_ARGS_ASSERT_CK_WARNER_D	\
+	assert(pat)
+
 PERL_CALLCONV void	Perl_vwarner(pTHX_ U32 err, const char* pat, va_list* args)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_VWARNER	\
@@ -3719,12 +3866,12 @@
 #define PERL_ARGS_ASSERT_WHICHSIG	\
 	assert(sig)
 
-PERL_CALLCONV void	Perl_write_to_stderr(pTHX_ const char* message, int msglen)
+PERL_CALLCONV void	Perl_write_to_stderr(pTHX_ SV* msv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_WRITE_TO_STDERR	\
-	assert(message)
+	assert(msv)
 
-PERL_CALLCONV int	Perl_yyerror(pTHX_ const char* s)
+PERL_CALLCONV int	Perl_yyerror(pTHX_ const char *const s)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_YYERROR	\
 	assert(s)
@@ -3736,13 +3883,15 @@
 #define PERL_ARGS_ASSERT_PARSER_FREE	\
 	assert(parser)
 
-PERL_CALLCONV int	Perl_yywarn(pTHX_ const char* s)
+#if defined(PERL_IN_TOKE_C) || defined(PERL_DECL_PROT)
+STATIC int	S_yywarn(pTHX_ const char *const s)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_YYWARN	\
 	assert(s)
 
+#endif
 #if defined(MYMALLOC)
-PERL_CALLCONV void	Perl_dump_mstats(pTHX_ char* s)
+PERL_CALLCONV void	Perl_dump_mstats(pTHX_ const char* s)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_DUMP_MSTATS	\
 	assert(s)
@@ -3777,20 +3926,20 @@
 #endif
 PERL_CALLCONV int	Perl_runops_standard(pTHX);
 PERL_CALLCONV int	Perl_runops_debug(pTHX);
-PERL_CALLCONV void	Perl_sv_catpvf_mg(pTHX_ SV *sv, const char* pat, ...)
+PERL_CALLCONV void	Perl_sv_catpvf_mg(pTHX_ SV *const sv, const char *const pat, ...)
 			__attribute__format__(__printf__,pTHX_2,pTHX_3)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_CATPVF_MG	\
 	assert(sv); assert(pat)
 
-PERL_CALLCONV void	Perl_sv_vcatpvf_mg(pTHX_ SV* sv, const char* pat, va_list* args)
+PERL_CALLCONV void	Perl_sv_vcatpvf_mg(pTHX_ SV *const sv, const char *const pat, va_list *const args)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_VCATPVF_MG	\
 	assert(sv); assert(pat)
 
-PERL_CALLCONV void	Perl_sv_catpv_mg(pTHX_ SV *sv, const char *ptr)
+PERL_CALLCONV void	Perl_sv_catpv_mg(pTHX_ SV *const sv, const char *const ptr)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_CATPV_MG	\
 	assert(sv)
@@ -3806,51 +3955,51 @@
 #define PERL_ARGS_ASSERT_SV_CATSV_MG	\
 	assert(dsv)
 
-PERL_CALLCONV void	Perl_sv_setpvf_mg(pTHX_ SV *sv, const char* pat, ...)
+PERL_CALLCONV void	Perl_sv_setpvf_mg(pTHX_ SV *const sv, const char *const pat, ...)
 			__attribute__format__(__printf__,pTHX_2,pTHX_3)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_SETPVF_MG	\
 	assert(sv); assert(pat)
 
-PERL_CALLCONV void	Perl_sv_vsetpvf_mg(pTHX_ SV* sv, const char* pat, va_list* args)
+PERL_CALLCONV void	Perl_sv_vsetpvf_mg(pTHX_ SV *const sv, const char *const pat, va_list *const args)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_VSETPVF_MG	\
 	assert(sv); assert(pat)
 
-PERL_CALLCONV void	Perl_sv_setiv_mg(pTHX_ SV *sv, IV i)
+PERL_CALLCONV void	Perl_sv_setiv_mg(pTHX_ SV *const sv, const IV i)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_SETIV_MG	\
 	assert(sv)
 
-PERL_CALLCONV void	Perl_sv_setpviv_mg(pTHX_ SV *sv, IV iv)
+PERL_CALLCONV void	Perl_sv_setpviv_mg(pTHX_ SV *const sv, const IV iv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_SETPVIV_MG	\
 	assert(sv)
 
-PERL_CALLCONV void	Perl_sv_setuv_mg(pTHX_ SV *sv, UV u)
+PERL_CALLCONV void	Perl_sv_setuv_mg(pTHX_ SV *const sv, const UV u)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_SETUV_MG	\
 	assert(sv)
 
-PERL_CALLCONV void	Perl_sv_setnv_mg(pTHX_ SV *sv, NV num)
+PERL_CALLCONV void	Perl_sv_setnv_mg(pTHX_ SV *const sv, const NV num)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_SETNV_MG	\
 	assert(sv)
 
-PERL_CALLCONV void	Perl_sv_setpv_mg(pTHX_ SV *sv, const char *ptr)
+PERL_CALLCONV void	Perl_sv_setpv_mg(pTHX_ SV *const sv, const char *const ptr)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_SETPV_MG	\
 	assert(sv)
 
-PERL_CALLCONV void	Perl_sv_setpvn_mg(pTHX_ SV *sv, const char *ptr, STRLEN len)
+PERL_CALLCONV void	Perl_sv_setpvn_mg(pTHX_ SV *const sv, const char *const ptr, const STRLEN len)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_SETPVN_MG	\
 	assert(sv); assert(ptr)
 
-PERL_CALLCONV void	Perl_sv_setsv_mg(pTHX_ SV *dstr, SV *sstr)
+PERL_CALLCONV void	Perl_sv_setsv_mg(pTHX_ SV *const dstr, SV *const sstr)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_SETSV_MG	\
 	assert(dstr)
@@ -3976,20 +4125,20 @@
 #define PERL_ARGS_ASSERT_SV_UTF8_UPGRADE	\
 	assert(sv)
 
-PERL_CALLCONV bool	Perl_sv_utf8_downgrade(pTHX_ SV *sv, bool fail_ok)
+/* PERL_CALLCONV STRLEN	sv_utf8_upgrade_nomg(pTHX_ SV *sv)
+			__attribute__nonnull__(pTHX_1); */
+
+PERL_CALLCONV bool	Perl_sv_utf8_downgrade(pTHX_ SV *const sv, const bool fail_ok)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_UTF8_DOWNGRADE	\
 	assert(sv)
 
-/* PERL_CALLCONV STRLEN	sv_utf8_upgrade_nomg(pTHX_ SV *sv)
-			__attribute__nonnull__(pTHX_1); */
-
-PERL_CALLCONV void	Perl_sv_utf8_encode(pTHX_ SV *sv)
+PERL_CALLCONV void	Perl_sv_utf8_encode(pTHX_ SV *const sv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_UTF8_ENCODE	\
 	assert(sv)
 
-PERL_CALLCONV bool	Perl_sv_utf8_decode(pTHX_ SV *sv)
+PERL_CALLCONV bool	Perl_sv_utf8_decode(pTHX_ SV *const sv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_UTF8_DECODE	\
 	assert(sv)
@@ -3999,13 +4148,13 @@
 #define PERL_ARGS_ASSERT_SV_FORCE_NORMAL	\
 	assert(sv)
 
-PERL_CALLCONV void	Perl_sv_force_normal_flags(pTHX_ SV *sv, U32 flags)
+PERL_CALLCONV void	Perl_sv_force_normal_flags(pTHX_ SV *const sv, const U32 flags)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_FORCE_NORMAL_FLAGS	\
 	assert(sv)
 
 PERL_CALLCONV void	Perl_tmps_grow(pTHX_ I32 n);
-PERL_CALLCONV SV*	Perl_sv_rvweaken(pTHX_ SV *sv)
+PERL_CALLCONV SV*	Perl_sv_rvweaken(pTHX_ SV *const sv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_RVWEAKEN	\
 	assert(sv)
@@ -4032,7 +4181,6 @@
 #define PERL_ARGS_ASSERT_MY_ATTRS	\
 	assert(o)
 
-PERL_CALLCONV void	Perl_boot_core_xsutils(pTHX);
 #if defined(USE_ITHREADS)
 PERL_CALLCONV PERL_CONTEXT*	Perl_cx_dup(pTHX_ PERL_CONTEXT* cx, I32 ix, I32 max, CLONE_PARAMS* param)
 			__attribute__warn_unused_result__
@@ -4072,46 +4220,56 @@
 #define PERL_ARGS_ASSERT_HEK_DUP	\
 	assert(param)
 
-PERL_CALLCONV REGEXP*	Perl_re_dup(pTHX_ const REGEXP* r, CLONE_PARAMS* param)
-			__attribute__warn_unused_result__
-			__attribute__nonnull__(pTHX_2);
-#define PERL_ARGS_ASSERT_RE_DUP	\
-	assert(param)
+PERL_CALLCONV void	Perl_re_dup_guts(pTHX_ const REGEXP *sstr, REGEXP *dstr, CLONE_PARAMS* param)
+			__attribute__nonnull__(pTHX_1)
+			__attribute__nonnull__(pTHX_2)
+			__attribute__nonnull__(pTHX_3);
+#define PERL_ARGS_ASSERT_RE_DUP_GUTS	\
+	assert(sstr); assert(dstr); assert(param)
 
-PERL_CALLCONV PerlIO*	Perl_fp_dup(pTHX_ PerlIO* fp, char type, CLONE_PARAMS* param)
+PERL_CALLCONV PerlIO*	Perl_fp_dup(pTHX_ PerlIO *const fp, const char type, CLONE_PARAMS *const param)
 			__attribute__nonnull__(pTHX_3);
 #define PERL_ARGS_ASSERT_FP_DUP	\
 	assert(param)
 
-PERL_CALLCONV DIR*	Perl_dirp_dup(pTHX_ DIR* dp)
+PERL_CALLCONV DIR*	Perl_dirp_dup(pTHX_ DIR *const dp)
 			__attribute__warn_unused_result__;
 
-PERL_CALLCONV GP*	Perl_gp_dup(pTHX_ GP* gp, CLONE_PARAMS* param)
+PERL_CALLCONV GP*	Perl_gp_dup(pTHX_ GP *const gp, CLONE_PARAMS *const param)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_GP_DUP	\
 	assert(param)
 
-PERL_CALLCONV MAGIC*	Perl_mg_dup(pTHX_ MAGIC* mg, CLONE_PARAMS* param)
+PERL_CALLCONV MAGIC*	Perl_mg_dup(pTHX_ MAGIC *mg, CLONE_PARAMS *const param)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_MG_DUP	\
 	assert(param)
 
-PERL_CALLCONV SV*	Perl_sv_dup(pTHX_ const SV* sstr, CLONE_PARAMS* param)
+#if defined(PERL_IN_SV_C) || defined(PERL_DECL_PROT)
+STATIC SV **	S_sv_dup_inc_multiple(pTHX_ SV *const *source, SV **dest, SSize_t items, CLONE_PARAMS *const param)
+			__attribute__nonnull__(pTHX_1)
+			__attribute__nonnull__(pTHX_2)
+			__attribute__nonnull__(pTHX_4);
+#define PERL_ARGS_ASSERT_SV_DUP_INC_MULTIPLE	\
+	assert(source); assert(dest); assert(param)
+
+#endif
+PERL_CALLCONV SV*	Perl_sv_dup(pTHX_ const SV *const sstr, CLONE_PARAMS *const param)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_DUP	\
 	assert(param)
 
-PERL_CALLCONV void	Perl_rvpv_dup(pTHX_ SV* dstr, const SV *sstr, CLONE_PARAMS* param)
+PERL_CALLCONV void	Perl_rvpv_dup(pTHX_ SV *const dstr, const SV *const sstr, CLONE_PARAMS *const param)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2)
 			__attribute__nonnull__(pTHX_3);
 #define PERL_ARGS_ASSERT_RVPV_DUP	\
 	assert(dstr); assert(sstr); assert(param)
 
-PERL_CALLCONV yy_parser*	Perl_parser_dup(pTHX_ const yy_parser *proto, CLONE_PARAMS* param)
+PERL_CALLCONV yy_parser*	Perl_parser_dup(pTHX_ const yy_parser *const proto, CLONE_PARAMS *const param)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_PARSER_DUP	\
 	assert(param)
@@ -4121,25 +4279,25 @@
 			__attribute__malloc__
 			__attribute__warn_unused_result__;
 
-PERL_CALLCONV void*	Perl_ptr_table_fetch(pTHX_ PTR_TBL_t *tbl, const void *sv)
+PERL_CALLCONV void*	Perl_ptr_table_fetch(pTHX_ PTR_TBL_t *const tbl, const void *const sv)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_PTR_TABLE_FETCH	\
 	assert(tbl)
 
-PERL_CALLCONV void	Perl_ptr_table_store(pTHX_ PTR_TBL_t *tbl, const void *oldsv, void *newsv)
+PERL_CALLCONV void	Perl_ptr_table_store(pTHX_ PTR_TBL_t *const tbl, const void *const oldsv, void *const newsv)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_3);
 #define PERL_ARGS_ASSERT_PTR_TABLE_STORE	\
 	assert(tbl); assert(newsv)
 
-PERL_CALLCONV void	Perl_ptr_table_split(pTHX_ PTR_TBL_t *tbl)
+PERL_CALLCONV void	Perl_ptr_table_split(pTHX_ PTR_TBL_t *const tbl)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_PTR_TABLE_SPLIT	\
 	assert(tbl)
 
-PERL_CALLCONV void	Perl_ptr_table_clear(pTHX_ PTR_TBL_t *tbl);
-PERL_CALLCONV void	Perl_ptr_table_free(pTHX_ PTR_TBL_t *tbl);
+PERL_CALLCONV void	Perl_ptr_table_clear(pTHX_ PTR_TBL_t *const tbl);
+PERL_CALLCONV void	Perl_ptr_table_free(pTHX_ PTR_TBL_t *const tbl);
 #if defined(USE_ITHREADS)
 #  if defined(HAVE_INTERP_INTERN)
 PERL_CALLCONV void	Perl_sys_intern_dup(pTHX_ struct interp_intern* src, struct interp_intern* dst)
@@ -4220,7 +4378,7 @@
 #endif
 
 #if defined(PERL_IN_GV_C) || defined(PERL_DECL_PROT)
-STATIC void	S_gv_init_sv(pTHX_ GV *gv, I32 sv_type)
+STATIC void	S_gv_init_sv(pTHX_ GV *gv, const svtype sv_type)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_GV_INIT_SV	\
 	assert(gv)
@@ -4240,7 +4398,7 @@
 
 #endif
 
-PERL_CALLCONV void*	Perl_get_arena(pTHX_ size_t svtype, U32 misc)
+PERL_CALLCONV void*	Perl_get_arena(pTHX_ const size_t arenasize, const svtype bodytype)
 			__attribute__malloc__
 			__attribute__warn_unused_result__;
 
@@ -4256,6 +4414,11 @@
 #define PERL_ARGS_ASSERT_HFREEENTRIES	\
 	assert(hv)
 
+STATIC I32	S_anonymise_cv(pTHX_ HEK *stash, SV *val)
+			__attribute__nonnull__(pTHX_2);
+#define PERL_ARGS_ASSERT_ANONYMISE_CV	\
+	assert(val)
+
 STATIC HE*	S_new_he(pTHX)
 			__attribute__malloc__
 			__attribute__warn_unused_result__;
@@ -4438,12 +4601,6 @@
 #define PERL_ARGS_ASSERT_CK_JOIN	\
 	assert(o)
 
-PERL_CALLCONV OP*	Perl_ck_lengthconst(pTHX_ OP *o)
-			__attribute__warn_unused_result__
-			__attribute__nonnull__(pTHX_1);
-#define PERL_ARGS_ASSERT_CK_LENGTHCONST	\
-	assert(o)
-
 PERL_CALLCONV OP*	Perl_ck_lfun(pTHX_ OP *o)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1);
@@ -4582,6 +4739,12 @@
 #define PERL_ARGS_ASSERT_CK_UNPACK	\
 	assert(o)
 
+PERL_CALLCONV OP*	Perl_ck_each(pTHX_ OP *o)
+			__attribute__warn_unused_result__
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_CK_EACH	\
+	assert(o)
+
 STATIC bool	S_is_handle_constructor(const OP *o, I32 numargs)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(1);
@@ -4762,7 +4925,16 @@
 	assert(linestr_sv); assert(rsfp)
 
 STATIC void	S_forbid_setid(pTHX_ const char flag, const bool suidscript);
-STATIC void	S_incpush(pTHX_ const char *dir, bool addsubdirs, bool addoldvers, bool usesep, bool canrelocate);
+STATIC void	S_incpush(pTHX_ const char *const dir, STRLEN len, U32 flags)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_INCPUSH	\
+	assert(dir)
+
+STATIC void	S_incpush_use_sep(pTHX_ const char *p, STRLEN len, U32 flags)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_INCPUSH_USE_SEP	\
+	assert(p)
+
 STATIC void	S_init_interp(pTHX);
 STATIC void	S_init_ids(pTHX);
 STATIC void	S_init_main_stash(pTHX);
@@ -4777,63 +4949,41 @@
 			__attribute__noreturn__;
 
 STATIC void	S_nuke_stacks(pTHX);
-STATIC int	S_open_script(pTHX_ const char *scriptname, bool dosearch, SV *sv, bool *suidscript, PerlIO **rsfpp)
+STATIC int	S_open_script(pTHX_ const char *scriptname, bool dosearch, bool *suidscript, PerlIO **rsfpp)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_3)
-			__attribute__nonnull__(pTHX_4)
-			__attribute__nonnull__(pTHX_5);
+			__attribute__nonnull__(pTHX_4);
 #define PERL_ARGS_ASSERT_OPEN_SCRIPT	\
-	assert(scriptname); assert(sv); assert(suidscript); assert(rsfpp)
+	assert(scriptname); assert(suidscript); assert(rsfpp)
 
 STATIC void	S_usage(pTHX_ const char *name)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_USAGE	\
 	assert(name)
 
-#ifdef DOSUID
-#  ifdef IAMSUID
-STATIC void	S_validate_suid(pTHX_ const char *validarg, int fdscript, bool suidscript, SV* linestr_sv, PerlIO *rsfp)
-			__attribute__nonnull__(pTHX_1)
-			__attribute__nonnull__(pTHX_4)
-			__attribute__nonnull__(pTHX_5);
-#define PERL_ARGS_ASSERT_VALIDATE_SUID	\
-	assert(validarg); assert(linestr_sv); assert(rsfp)
-
-#  else
-STATIC void	S_validate_suid(pTHX_ const char *validarg, const char *scriptname, int fdscript, SV* linestr_sv, PerlIO *rsfp)
-			__attribute__nonnull__(pTHX_1)
-			__attribute__nonnull__(pTHX_2)
-			__attribute__nonnull__(pTHX_4)
-			__attribute__nonnull__(pTHX_5);
-#define PERL_ARGS_ASSERT_VALIDATE_SUID	\
-	assert(validarg); assert(scriptname); assert(linestr_sv); assert(rsfp)
-
-#  endif
-#else
-#  ifndef SETUID_SCRIPTS_ARE_SECURE_NOW
+#ifndef SETUID_SCRIPTS_ARE_SECURE_NOW
 STATIC void	S_validate_suid(pTHX_ PerlIO *rsfp)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_VALIDATE_SUID	\
 	assert(rsfp)
 
-#  endif
 #endif
 
-#  if defined(IAMSUID)
-STATIC int	S_fd_on_nosuid_fs(pTHX_ int fd);
-#  endif
 STATIC void*	S_parse_body(pTHX_ char **env, XSINIT_t xsinit);
 STATIC void	S_run_body(pTHX_ I32 oldscope)
 			__attribute__noreturn__;
 
-STATIC SV *	S_incpush_if_exists(pTHX_ SV *dir)
-			__attribute__nonnull__(pTHX_1);
+STATIC SV *	S_incpush_if_exists(pTHX_ AV *const av, SV *dir, SV *const stem)
+			__attribute__nonnull__(pTHX_1)
+			__attribute__nonnull__(pTHX_2)
+			__attribute__nonnull__(pTHX_3);
 #define PERL_ARGS_ASSERT_INCPUSH_IF_EXISTS	\
-	assert(dir)
+	assert(av); assert(dir); assert(stem)
 
 #endif
 
 #if defined(PERL_IN_PP_C) || defined(PERL_DECL_PROT)
+STATIC OP*	S_do_delete_local(pTHX);
 STATIC SV*	S_refto(pTHX_ SV* sv)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1);
@@ -4842,7 +4992,7 @@
 
 #endif
 #if defined(PERL_IN_PP_C) || defined(PERL_IN_PP_HOT_C) || defined(PERL_DECL_PROT)
-PERL_CALLCONV GV*	Perl_softref2xv(pTHX_ SV *const sv, const char *const what, const U32 type, SV ***spp)
+PERL_CALLCONV GV*	Perl_softref2xv(pTHX_ SV *const sv, const char *const what, const svtype type, SV ***spp)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2)
@@ -5052,55 +5202,55 @@
 #endif
 
 #if defined(PERL_IN_PP_SORT_C) || defined(PERL_DECL_PROT)
-STATIC I32	S_sv_ncmp(pTHX_ SV *a, SV *b)
+STATIC I32	S_sv_ncmp(pTHX_ SV *const a, SV *const b)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_NCMP	\
 	assert(a); assert(b)
 
-STATIC I32	S_sv_i_ncmp(pTHX_ SV *a, SV *b)
+STATIC I32	S_sv_i_ncmp(pTHX_ SV *const a, SV *const b)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_I_NCMP	\
 	assert(a); assert(b)
 
-STATIC I32	S_amagic_ncmp(pTHX_ SV *a, SV *b)
+STATIC I32	S_amagic_ncmp(pTHX_ SV *const a, SV *const b)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_AMAGIC_NCMP	\
 	assert(a); assert(b)
 
-STATIC I32	S_amagic_i_ncmp(pTHX_ SV *a, SV *b)
+STATIC I32	S_amagic_i_ncmp(pTHX_ SV *const a, SV *const b)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_AMAGIC_I_NCMP	\
 	assert(a); assert(b)
 
-STATIC I32	S_amagic_cmp(pTHX_ SV *str1, SV *str2)
+STATIC I32	S_amagic_cmp(pTHX_ SV *const str1, SV *const str2)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_AMAGIC_CMP	\
 	assert(str1); assert(str2)
 
-STATIC I32	S_amagic_cmp_locale(pTHX_ SV *str1, SV *str2)
+STATIC I32	S_amagic_cmp_locale(pTHX_ SV *const str1, SV *const str2)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_AMAGIC_CMP_LOCALE	\
 	assert(str1); assert(str2)
 
-STATIC I32	S_sortcv(pTHX_ SV *a, SV *b)
+STATIC I32	S_sortcv(pTHX_ SV *const a, SV *const b)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SORTCV	\
 	assert(a); assert(b)
 
-STATIC I32	S_sortcv_xsub(pTHX_ SV *a, SV *b)
+STATIC I32	S_sortcv_xsub(pTHX_ SV *const a, SV *const b)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SORTCV_XSUB	\
 	assert(a); assert(b)
 
-STATIC I32	S_sortcv_stacked(pTHX_ SV *a, SV *b)
+STATIC I32	S_sortcv_stacked(pTHX_ SV *const a, SV *const b)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SORTCV_STACKED	\
@@ -5172,12 +5322,6 @@
 #define PERL_ARGS_ASSERT_REGCLASS	\
 	assert(pRExC_state)
 
-STATIC I32	S_regcurly(const char *s)
-			__attribute__warn_unused_result__
-			__attribute__nonnull__(1);
-#define PERL_ARGS_ASSERT_REGCURLY	\
-	assert(s)
-
 STATIC regnode*	S_reg_node(pTHX_ struct RExC_state_t *pRExC_state, U8 op)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_REG_NODE	\
@@ -5194,7 +5338,7 @@
 #define PERL_ARGS_ASSERT_REGPIECE	\
 	assert(pRExC_state); assert(flagp)
 
-STATIC regnode*	S_reg_namedseq(pTHX_ struct RExC_state_t *pRExC_state, UV *valuep)
+STATIC regnode*	S_reg_namedseq(pTHX_ struct RExC_state_t *pRExC_state, UV *valuep, I32 *flagp)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_REG_NAMEDSEQ	\
 	assert(pRExC_state)
@@ -5445,11 +5589,6 @@
 #define PERL_ARGS_ASSERT_FIND_BYCLASS	\
 	assert(prog); assert(c); assert(s); assert(strend)
 
-STATIC void	S_swap_match_buff(pTHX_ regexp * prog)
-			__attribute__nonnull__(pTHX_1);
-#define PERL_ARGS_ASSERT_SWAP_MATCH_BUFF	\
-	assert(prog)
-
 STATIC void	S_to_utf8_substr(pTHX_ regexp * prog)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_TO_UTF8_SUBSTR	\
@@ -5506,7 +5645,7 @@
 #endif
 
 #if defined(PERL_IN_SCOPE_C) || defined(PERL_DECL_PROT)
-STATIC SV*	S_save_scalar_at(pTHX_ SV **sptr)
+STATIC SV*	S_save_scalar_at(pTHX_ SV **sptr, const U32 flags)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SAVE_SCALAR_AT	\
 	assert(sptr)
@@ -5514,7 +5653,7 @@
 #endif
 
 #if defined(PERL_IN_GV_C) || defined(PERL_IN_SV_C) || defined(PERL_IN_PAD_C) || defined(PERL_DECL_PROT)
-PERL_CALLCONV void	Perl_sv_add_backref(pTHX_ SV *tsv, SV *sv)
+PERL_CALLCONV void	Perl_sv_add_backref(pTHX_ SV *const tsv, SV *const sv)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_ADD_BACKREF	\
@@ -5523,7 +5662,7 @@
 #endif
 
 #if defined(PERL_IN_HV_C) || defined(PERL_IN_MG_C) || defined(PERL_IN_SV_C) || defined(PERL_DECL_PROT)
-PERL_CALLCONV int	Perl_sv_kill_backrefs(pTHX_ SV *sv, AV *av)
+PERL_CALLCONV int	Perl_sv_kill_backrefs(pTHX_ SV *const sv, AV *const av)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_KILL_BACKREFS	\
@@ -5532,35 +5671,35 @@
 #endif
 
 #if defined(PERL_IN_SV_C) || defined(PERL_DECL_PROT)
-STATIC char *	S_uiv_2buf(char *buf, IV iv, UV uv, int is_uv, char **peob)
+STATIC char *	S_uiv_2buf(char *const buf, const IV iv, UV uv, const int is_uv, char **const peob)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(1)
 			__attribute__nonnull__(5);
 #define PERL_ARGS_ASSERT_UIV_2BUF	\
 	assert(buf); assert(peob)
 
-STATIC void	S_sv_unglob(pTHX_ SV* sv)
+STATIC void	S_sv_unglob(pTHX_ SV *const sv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_UNGLOB	\
 	assert(sv)
 
-STATIC void	S_not_a_number(pTHX_ SV *sv)
+STATIC void	S_not_a_number(pTHX_ SV *const sv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_NOT_A_NUMBER	\
 	assert(sv)
 
-STATIC I32	S_visit(pTHX_ SVFUNC_t f, U32 flags, U32 mask)
+STATIC I32	S_visit(pTHX_ SVFUNC_t f, const U32 flags, const U32 mask)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_VISIT	\
 	assert(f)
 
-STATIC void	S_sv_del_backref(pTHX_ SV *tsv, SV *sv)
+STATIC void	S_sv_del_backref(pTHX_ SV *const tsv, SV *const sv)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_DEL_BACKREF	\
 	assert(tsv); assert(sv)
 
-STATIC SV *	S_varname(pTHX_ GV *gv, const char gvtype, PADOFFSET targ, SV *keyname, I32 aindex, int subscript_type)
+STATIC SV *	S_varname(pTHX_ const GV *const gv, const char gvtype, PADOFFSET targ, const SV *const keyname, I32 aindex, int subscript_type)
 			__attribute__warn_unused_result__;
 
 #  ifdef DEBUGGING
@@ -5572,20 +5711,20 @@
 #  endif
 #  if !defined(NV_PRESERVES_UV)
 #    ifdef DEBUGGING
-STATIC int	S_sv_2iuv_non_preserve(pTHX_ SV *sv, I32 numtype)
+STATIC int	S_sv_2iuv_non_preserve(pTHX_ SV *const sv, I32 numtype)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_2IUV_NON_PRESERVE	\
 	assert(sv)
 
 #    else
-STATIC int	S_sv_2iuv_non_preserve(pTHX_ SV *sv)
+STATIC int	S_sv_2iuv_non_preserve(pTHX_ SV *const sv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_2IUV_NON_PRESERVE	\
 	assert(sv)
 
 #    endif
 #  endif
-STATIC I32	S_expect_number(pTHX_ char** pattern)
+STATIC I32	S_expect_number(pTHX_ char **const pattern)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_EXPECT_NUMBER	\
@@ -5598,13 +5737,13 @@
 #define PERL_ARGS_ASSERT_SV_POS_U2B_FORWARDS	\
 	assert(start); assert(send)
 
-STATIC STRLEN	S_sv_pos_u2b_midway(const U8 *const start, const U8 *send, STRLEN uoffset, STRLEN uend)
+STATIC STRLEN	S_sv_pos_u2b_midway(const U8 *const start, const U8 *send, const STRLEN uoffset, const STRLEN uend)
 			__attribute__nonnull__(1)
 			__attribute__nonnull__(2);
 #define PERL_ARGS_ASSERT_SV_POS_U2B_MIDWAY	\
 	assert(start); assert(send)
 
-STATIC STRLEN	S_sv_pos_u2b_cached(pTHX_ SV *sv, MAGIC **mgp, const U8 *const start, const U8 *const send, STRLEN uoffset, STRLEN uoffset0, STRLEN boffset0)
+STATIC STRLEN	S_sv_pos_u2b_cached(pTHX_ SV *const sv, MAGIC **const mgp, const U8 *const start, const U8 *const send, const STRLEN uoffset, STRLEN uoffset0, STRLEN boffset0)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2)
 			__attribute__nonnull__(pTHX_3)
@@ -5612,20 +5751,20 @@
 #define PERL_ARGS_ASSERT_SV_POS_U2B_CACHED	\
 	assert(sv); assert(mgp); assert(start); assert(send)
 
-STATIC void	S_utf8_mg_pos_cache_update(pTHX_ SV *sv, MAGIC **mgp, STRLEN byte, STRLEN utf8, STRLEN blen)
+STATIC void	S_utf8_mg_pos_cache_update(pTHX_ SV *const sv, MAGIC **const mgp, const STRLEN byte, const STRLEN utf8, const STRLEN blen)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_UTF8_MG_POS_CACHE_UPDATE	\
 	assert(sv); assert(mgp)
 
-STATIC STRLEN	S_sv_pos_b2u_midway(pTHX_ const U8 *s, const U8 *const target, const U8 *end, STRLEN endu)
+STATIC STRLEN	S_sv_pos_b2u_midway(pTHX_ const U8 *const s, const U8 *const target, const U8 *end, STRLEN endu)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2)
 			__attribute__nonnull__(pTHX_3);
 #define PERL_ARGS_ASSERT_SV_POS_B2U_MIDWAY	\
 	assert(s); assert(target); assert(end)
 
-STATIC char *	S_F0convert(NV nv, char *endbuf, STRLEN *len)
+STATIC char *	S_F0convert(NV nv, char *const endbuf, STRLEN *const len)
 			__attribute__nonnull__(2)
 			__attribute__nonnull__(3);
 #define PERL_ARGS_ASSERT_F0CONVERT	\
@@ -5641,25 +5780,25 @@
 
 #  endif
 STATIC SV *	S_more_sv(pTHX);
-STATIC void *	S_more_bodies(pTHX_ svtype sv_type);
-STATIC bool	S_sv_2iuv_common(pTHX_ SV *sv)
+STATIC void *	S_more_bodies(pTHX_ const svtype sv_type);
+STATIC bool	S_sv_2iuv_common(pTHX_ SV *const sv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_2IUV_COMMON	\
 	assert(sv)
 
-STATIC void	S_glob_assign_glob(pTHX_ SV *dstr, SV *sstr, const int dtype)
+STATIC void	S_glob_assign_glob(pTHX_ SV *const dstr, SV *const sstr, const int dtype)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_GLOB_ASSIGN_GLOB	\
 	assert(dstr); assert(sstr)
 
-STATIC void	S_glob_assign_ref(pTHX_ SV *dstr, SV *sstr)
+STATIC void	S_glob_assign_ref(pTHX_ SV *const dstr, SV *const sstr)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_GLOB_ASSIGN_REF	\
 	assert(dstr); assert(sstr)
 
-STATIC PTR_TBL_ENT_t *	S_ptr_table_find(PTR_TBL_t *tbl, const void *sv)
+STATIC PTR_TBL_ENT_t *	S_ptr_table_find(PTR_TBL_t *const tbl, const void *const sv)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(1);
 #define PERL_ARGS_ASSERT_PTR_TABLE_FIND	\
@@ -5675,6 +5814,11 @@
 #define PERL_ARGS_ASSERT_FORCE_VERSION	\
 	assert(s)
 
+STATIC char*	S_force_strict_version(pTHX_ char *s)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_FORCE_STRICT_VERSION	\
+	assert(s)
+
 STATIC char*	S_force_word(pTHX_ char *start, int token, int check_keyword, int allow_pack, int allow_tick)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_FORCE_WORD	\
@@ -5748,7 +5892,7 @@
 #define PERL_ARGS_ASSERT_SCAN_WORD	\
 	assert(s); assert(dest); assert(slp)
 
-STATIC void	S_update_debugger_info(pTHX_ SV *orig_sv, const char *buf, STRLEN len);
+STATIC void	S_update_debugger_info(pTHX_ SV *orig_sv, const char *const buf, STRLEN len);
 STATIC char*	S_skipspace(pTHX_ char *s)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1);
@@ -5761,6 +5905,18 @@
 #define PERL_ARGS_ASSERT_SWALLOW_BOM	\
 	assert(s)
 
+#ifndef PERL_NO_UTF16_FILTER
+STATIC I32	S_utf16_textfilter(pTHX_ int idx, SV *sv, int maxlen)
+			__attribute__nonnull__(pTHX_2);
+#define PERL_ARGS_ASSERT_UTF16_TEXTFILTER	\
+	assert(sv)
+
+STATIC U8*	S_add_utf16_textfilter(pTHX_ U8 *const s, bool reversed)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_ADD_UTF16_TEXTFILTER	\
+	assert(s)
+
+#endif
 STATIC void	S_checkcomma(pTHX_ const char *s, const char *name, const char *what)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2)
@@ -5768,7 +5924,7 @@
 #define PERL_ARGS_ASSERT_CHECKCOMMA	\
 	assert(s); assert(name); assert(what)
 
-STATIC bool	S_feature_is_enabled(pTHX_ const char* name, STRLEN namelen)
+STATIC bool	S_feature_is_enabled(pTHX_ const char *const name, STRLEN namelen)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_FEATURE_IS_ENABLED	\
 	assert(name)
@@ -5801,7 +5957,7 @@
 STATIC void	S_missingterm(pTHX_ char *s)
 			__attribute__noreturn__;
 
-STATIC void	S_no_op(pTHX_ const char *what, char *s)
+STATIC void	S_no_op(pTHX_ const char *const what, char *s)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_NO_OP	\
 	assert(what)
@@ -5815,12 +5971,11 @@
 STATIC I32	S_sublex_start(pTHX)
 			__attribute__warn_unused_result__;
 
-STATIC char *	S_filter_gets(pTHX_ SV *sv, PerlIO *fp, STRLEN append)
+STATIC char *	S_filter_gets(pTHX_ SV *sv, STRLEN append)
 			__attribute__warn_unused_result__
-			__attribute__nonnull__(pTHX_1)
-			__attribute__nonnull__(pTHX_2);
+			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_FILTER_GETS	\
-	assert(sv); assert(fp)
+	assert(sv)
 
 STATIC HV *	S_find_in_my_stash(pTHX_ const char *pkgname, STRLEN len)
 			__attribute__warn_unused_result__
@@ -5840,6 +5995,7 @@
 #define PERL_ARGS_ASSERT_NEW_CONSTANT	\
 	assert(key); assert(sv)
 
+STATIC int	S_deprecate_commaless_var_list(pTHX);
 STATIC int	S_ao(pTHX_ int toketype);
 #  if defined(PERL_CR_FILTER)
 STATIC I32	S_cr_textfilter(pTHX_ int idx, SV *sv, int maxlen);
@@ -5855,7 +6011,7 @@
 #define PERL_ARGS_ASSERT_TOKEREPORT	\
 	assert(lvalp)
 
-STATIC void	S_printbuf(pTHX_ const char* fmt, const char* s)
+STATIC void	S_printbuf(pTHX_ const char *const fmt, const char *const s)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_PRINTBUF	\
@@ -5895,12 +6051,12 @@
 	assert(cop)
 
 STATIC SV*	S_mess_alloc(pTHX);
-STATIC const char *	S_vdie_croak_common(pTHX_ const char *pat, va_list *args, STRLEN *msglen, I32* utf8);
-STATIC bool	S_vdie_common(pTHX_ const char *message, STRLEN msglen, I32 utf8, bool warn);
+STATIC SV *	S_vdie_croak_common(pTHX_ const char *pat, va_list *args);
+STATIC bool	S_vdie_common(pTHX_ SV *message, bool warn);
 STATIC char *	S_write_no_mem(pTHX)
 			__attribute__noreturn__;
 
-#if defined(PERL_MEM_LOG) && defined(PERL_MEM_LOG_STDERR)
+#if defined(PERL_MEM_LOG) && !defined(PERL_MEM_LOG_NOIMPL)
 STATIC void	S_mem_log_common(enum mem_log_type mlt, const UV n, const UV typesize, const char *type_name, const SV *sv, Malloc_t oldalloc, Malloc_t newalloc, const char *filename, const int linenumber, const char *funcname)
 			__attribute__nonnull__(4)
 			__attribute__nonnull__(8)
@@ -5940,33 +6096,36 @@
 
 START_EXTERN_C
 
-PERL_CALLCONV void	Perl_sv_setsv_flags(pTHX_ SV *dstr, SV *sstr, I32 flags)
+PERL_CALLCONV void	Perl_sv_setsv_flags(pTHX_ SV *dstr, SV *sstr, const I32 flags)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_SETSV_FLAGS	\
 	assert(dstr)
 
-PERL_CALLCONV void	Perl_sv_catpvn_flags(pTHX_ SV *dstr, const char *sstr, STRLEN len, I32 flags)
+PERL_CALLCONV void	Perl_sv_catpvn_flags(pTHX_ SV *const dstr, const char *sstr, const STRLEN len, const I32 flags)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_CATPVN_FLAGS	\
 	assert(dstr); assert(sstr)
 
-PERL_CALLCONV void	Perl_sv_catsv_flags(pTHX_ SV* dsv, SV* ssv, I32 flags)
+PERL_CALLCONV void	Perl_sv_catsv_flags(pTHX_ SV *const dsv, SV *const ssv, const I32 flags)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_CATSV_FLAGS	\
 	assert(dsv)
 
-PERL_CALLCONV STRLEN	Perl_sv_utf8_upgrade_flags(pTHX_ SV *sv, I32 flags)
+/* PERL_CALLCONV STRLEN	Perl_sv_utf8_upgrade_flags(pTHX_ SV *const sv, const I32 flags)
+			__attribute__nonnull__(pTHX_1); */
+
+PERL_CALLCONV STRLEN	Perl_sv_utf8_upgrade_flags_grow(pTHX_ SV *const sv, const I32 flags, STRLEN extra)
 			__attribute__nonnull__(pTHX_1);
-#define PERL_ARGS_ASSERT_SV_UTF8_UPGRADE_FLAGS	\
+#define PERL_ARGS_ASSERT_SV_UTF8_UPGRADE_FLAGS_GROW	\
 	assert(sv)
 
-PERL_CALLCONV char*	Perl_sv_pvn_force_flags(pTHX_ SV* sv, STRLEN* lp, I32 flags)
+PERL_CALLCONV char*	Perl_sv_pvn_force_flags(pTHX_ SV *const sv, STRLEN *const lp, const I32 flags)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_SV_PVN_FORCE_FLAGS	\
 	assert(sv)
 
-PERL_CALLCONV void	Perl_sv_copypv(pTHX_ SV* dsv, SV* ssv)
+PERL_CALLCONV void	Perl_sv_copypv(pTHX_ SV *const dsv, SV *const ssv)
 			__attribute__nonnull__(pTHX_1)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_SV_COPYPV	\
@@ -6057,7 +6216,7 @@
 #define PERL_ARGS_ASSERT_PAD_UNDEF	\
 	assert(cv)
 
-PERL_CALLCONV PADOFFSET	Perl_pad_add_name(pTHX_ const char *name, HV* typestash, HV* ourstash, bool clone, bool state)
+PERL_CALLCONV PADOFFSET	Perl_pad_add_name(pTHX_ const char *name, const STRLEN len, const U32 flags, HV *typestash, HV *ourstash)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_PAD_ADD_NAME	\
 	assert(name)
@@ -6067,12 +6226,13 @@
 #define PERL_ARGS_ASSERT_PAD_ADD_ANON	\
 	assert(sv)
 
-PERL_CALLCONV void	Perl_pad_check_dup(pTHX_ const char* name, bool is_our, const HV* ourstash)
-			__attribute__nonnull__(pTHX_1)
-			__attribute__nonnull__(pTHX_3);
+#if defined(PERL_IN_PAD_C) || defined(PERL_DECL_PROT)
+STATIC void	S_pad_check_dup(pTHX_ SV *name, const U32 flags, const HV *ourstash)
+			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_PAD_CHECK_DUP	\
-	assert(name); assert(ourstash)
+	assert(name)
 
+#endif
 #ifdef DEBUGGING
 PERL_CALLCONV void	Perl_pad_setsv(pTHX_ PADOFFSET po, SV* sv)
 			__attribute__nonnull__(pTHX_2);
@@ -6113,6 +6273,11 @@
 #define PERL_ARGS_ASSERT_PAD_FINDLEX	\
 	assert(name); assert(cv); assert(out_name_sv); assert(out_flags)
 
+STATIC PADOFFSET	S_pad_add_name_sv(pTHX_ SV *namesv, const U32 flags, HV *typestash, HV *ourstash)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_PAD_ADD_NAME_SV	\
+	assert(namesv)
+
 #  if defined(DEBUGGING)
 STATIC void	S_cv_dump(pTHX_ const CV *cv, const char *title)
 			__attribute__nonnull__(pTHX_1)
@@ -6139,11 +6304,13 @@
 #define PERL_ARGS_ASSERT_SAVE_SET_SVFLAGS	\
 	assert(sv)
 
+#ifdef DEBUGGING
 PERL_CALLCONV void	Perl_hv_assert(pTHX_ HV *hv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_HV_ASSERT	\
 	assert(hv)
 
+#endif
 
 PERL_CALLCONV SV*	Perl_hv_scalar(pTHX_ HV *hv)
 			__attribute__warn_unused_result__
@@ -6201,7 +6368,7 @@
 #define PERL_ARGS_ASSERT_HV_PLACEHOLDERS_P	\
 	assert(hv)
 
-PERL_CALLCONV I32	Perl_hv_placeholders_get(pTHX_ HV *hv)
+PERL_CALLCONV I32	Perl_hv_placeholders_get(pTHX_ const HV *hv)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_HV_PLACEHOLDERS_GET	\
@@ -6221,17 +6388,17 @@
 
 
 #if defined(PERL_IN_SV_C) || defined(PERL_DECL_PROT)
-STATIC SV *	S_find_hash_subscript(pTHX_ HV *hv, SV *val)
+STATIC SV *	S_find_hash_subscript(pTHX_ const HV *const hv, const SV *const val)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_FIND_HASH_SUBSCRIPT	\
 	assert(val)
 
-STATIC I32	S_find_array_subscript(pTHX_ AV *av, SV *val)
+STATIC I32	S_find_array_subscript(pTHX_ const AV *const av, const SV *const val)
 			__attribute__nonnull__(pTHX_2);
 #define PERL_ARGS_ASSERT_FIND_ARRAY_SUBSCRIPT	\
 	assert(val)
 
-STATIC SV*	S_find_uninit_var(pTHX_ OP* obase, SV* uninit_sv, bool top);
+STATIC SV*	S_find_uninit_var(pTHX_ const OP *const obase, const SV *const uninit_sv, bool top);
 #endif
 
 #ifdef PERL_NEED_MY_HTOLE16
@@ -6314,21 +6481,21 @@
 	assert(ptr)
 
 
-PERL_CALLCONV GV*	Perl_gv_fetchpvn_flags(pTHX_ const char* name, STRLEN len, I32 flags, I32 sv_type)
+PERL_CALLCONV GV*	Perl_gv_fetchpvn_flags(pTHX_ const char* name, STRLEN len, I32 flags, const svtype sv_type)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_GV_FETCHPVN_FLAGS	\
 	assert(name)
 
-PERL_CALLCONV GV*	Perl_gv_fetchsv(pTHX_ SV *name, I32 flags, I32 sv_type)
+PERL_CALLCONV GV*	Perl_gv_fetchsv(pTHX_ SV *name, I32 flags, const svtype sv_type)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_GV_FETCHSV	\
 	assert(name)
 
-PERL_CALLCONV bool	Perl_is_gv_magical_sv(pTHX_ SV *name, U32 flags)
+PERL_CALLCONV bool	Perl_is_gv_magical_sv(pTHX_ SV *const name_sv, U32 flags)
 			__attribute__warn_unused_result__
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_IS_GV_MAGICAL_SV	\
-	assert(name)
+	assert(name_sv)
 
 
 PERL_CALLCONV bool	Perl_stashpv_hvname_match(pTHX_ const COP *c, const HV *hv)
@@ -6348,11 +6515,10 @@
 #endif
 
 #ifdef PERL_DONT_CREATE_GVSV
-PERL_CALLCONV GV*	Perl_gv_SVadd(pTHX_ GV* gv)
-			__attribute__nonnull__(pTHX_1);
-#define PERL_ARGS_ASSERT_GV_SVADD	\
-	assert(gv)
-
+/* PERL_CALLCONV GV*	Perl_gv_SVadd(pTHX_ GV *gv); */
+#endif
+#if defined(PERL_IN_UTIL_C) || defined(PERL_DECL_PROT)
+STATIC bool	S_ckwarn_common(pTHX_ U32 w);
 #endif
 PERL_CALLCONV bool	Perl_ckwarn(pTHX_ U32 w);
 PERL_CALLCONV bool	Perl_ckwarn_d(pTHX_ U32 w);
@@ -6364,7 +6530,7 @@
 	assert(bits)
 
 
-PERL_CALLCONV void	Perl_offer_nice_chunk(pTHX_ void *chunk, U32 chunk_size)
+PERL_CALLCONV void	Perl_offer_nice_chunk(pTHX_ void *const chunk, const U32 chunk_size)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_OFFER_NICE_CHUNK	\
 	assert(chunk)
@@ -6453,16 +6619,27 @@
 	assert(file); assert(pat)
 
 PERL_CALLCONV void	Perl_xmldump_all(pTHX);
+PERL_CALLCONV void	Perl_xmldump_all_perl(pTHX_ bool justperl);
 PERL_CALLCONV void	Perl_xmldump_packsubs(pTHX_ const HV* stash)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_XMLDUMP_PACKSUBS	\
 	assert(stash)
 
+PERL_CALLCONV void	Perl_xmldump_packsubs_perl(pTHX_ const HV* stash, bool justperl)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_XMLDUMP_PACKSUBS_PERL	\
+	assert(stash)
+
 PERL_CALLCONV void	Perl_xmldump_sub(pTHX_ const GV* gv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_XMLDUMP_SUB	\
 	assert(gv)
 
+PERL_CALLCONV void	Perl_xmldump_sub_perl(pTHX_ const GV* gv, bool justperl)
+			__attribute__nonnull__(pTHX_1);
+#define PERL_ARGS_ASSERT_XMLDUMP_SUB_PERL	\
+	assert(gv)
+
 PERL_CALLCONV void	Perl_xmldump_form(pTHX_ const GV* gv)
 			__attribute__nonnull__(pTHX_1);
 #define PERL_ARGS_ASSERT_XMLDUMP_FORM	\
@@ -6524,7 +6701,7 @@
 #define PERL_ARGS_ASSERT_NEWMADSV	\
 	assert(sv)
 
-PERL_CALLCONV MADPROP*	Perl_newMADPROP(pTHX_ char key, char type, const void* val, I32 vlen);
+PERL_CALLCONV MADPROP*	Perl_newMADPROP(pTHX_ char key, char type, void* val, I32 vlen);
 PERL_CALLCONV void	Perl_mad_free(pTHX_ MADPROP* mp);
 
 #  if defined(PERL_IN_TOKE_C) || defined(PERL_DECL_PROT)
@@ -6642,6 +6819,19 @@
 	assert(argc); assert(argv); assert(env)
 
 PERL_CALLCONV void	Perl_sys_term(void);
+PERL_CALLCONV const char *	Perl_fetch_cop_label(pTHX_ struct refcounted_he *const chain, STRLEN *len, U32 *flags);
+PERL_CALLCONV struct refcounted_he *	Perl_store_cop_label(pTHX_ struct refcounted_he *const chain, const char *label)
+			__attribute__nonnull__(pTHX_2);
+#define PERL_ARGS_ASSERT_STORE_COP_LABEL	\
+	assert(label)
+
+
+PERL_CALLCONV int	Perl_keyword_plugin_standard(pTHX_ char* keyword_ptr, STRLEN keyword_len, OP** op_ptr)
+			__attribute__nonnull__(pTHX_1)
+			__attribute__nonnull__(pTHX_3);
+#define PERL_ARGS_ASSERT_KEYWORD_PLUGIN_STANDARD	\
+	assert(keyword_ptr); assert(op_ptr)
+
 
 END_EXTERN_C
 /*
Index: src/gnu/usr.bin/perl/regcomp.c
diff -u src/gnu/usr.bin/perl/regcomp.c:1.15 src/gnu/usr.bin/perl/regcomp.c:1.16
--- regcomp.c:1.15	Tue Nov  3 14:24:09 2009
+++ regcomp.c	Fri Sep 24 15:06:43 2010
@@ -105,6 +105,7 @@
 typedef struct RExC_state_t {
     U32		flags;			/* are we folding, multilining? */
     char	*precomp;		/* uncompiled string. */
+    REGEXP	*rx_sv;			/* The SV that is the regexp. */
     regexp	*rx;                    /* perl core regexp structure */
     regexp_internal	*rxi;           /* internal data for regexp object pprivate field */        
     char	*start;			/* Start of input for compile */
@@ -131,7 +132,6 @@
     I32		orig_utf8;	/* whether the pattern was originally in utf8 */
 				/* XXX use this for future optimisation of case
 				 * where pattern must be upgraded to utf8. */
-    HV		*charnames;		/* cache of named sequences */
     HV		*paren_names;		/* Paren names */
     
     regnode	**recurse;		/* Recurse regops */
@@ -152,6 +152,7 @@
 
 #define RExC_flags	(pRExC_state->flags)
 #define RExC_precomp	(pRExC_state->precomp)
+#define RExC_rx_sv	(pRExC_state->rx_sv)
 #define RExC_rx		(pRExC_state->rx)
 #define RExC_rxi	(pRExC_state->rxi)
 #define RExC_start	(pRExC_state->start)
@@ -175,7 +176,6 @@
 #define RExC_seen_evals	(pRExC_state->seen_evals)
 #define RExC_utf8	(pRExC_state->utf8)
 #define RExC_orig_utf8	(pRExC_state->orig_utf8)
-#define RExC_charnames  (pRExC_state->charnames)
 #define RExC_open_parens	(pRExC_state->open_parens)
 #define RExC_close_parens	(pRExC_state->close_parens)
 #define RExC_opend	(pRExC_state->opend)
@@ -392,7 +392,7 @@
     IV len = RExC_end - RExC_precomp;					\
 									\
     if (!SIZE_ONLY)							\
-	SAVEDESTRUCTOR_X(clear_re,(void*)RExC_rx);			\
+	SAVEDESTRUCTOR_X(clear_re,(void*)RExC_rx_sv);			\
     if (len > RegexLengthToShowInErrorMessages) {			\
 	/* chop 10 shorter than the max, to ensure meaning of "..." */	\
 	len = RegexLengthToShowInErrorMessages - 10;			\
@@ -423,7 +423,7 @@
  */
 #define	vFAIL(m) STMT_START {				\
     if (!SIZE_ONLY)					\
-	SAVEDESTRUCTOR_X(clear_re,(void*)RExC_rx);	\
+	SAVEDESTRUCTOR_X(clear_re,(void*)RExC_rx_sv);	\
     Simple_vFAIL(m);					\
 } STMT_END
 
@@ -441,7 +441,7 @@
  */
 #define	vFAIL2(m,a1) STMT_START {			\
     if (!SIZE_ONLY)					\
-	SAVEDESTRUCTOR_X(clear_re,(void*)RExC_rx);	\
+	SAVEDESTRUCTOR_X(clear_re,(void*)RExC_rx_sv);	\
     Simple_vFAIL2(m, a1);				\
 } STMT_END
 
@@ -460,7 +460,7 @@
  */
 #define	vFAIL3(m,a1,a2) STMT_START {			\
     if (!SIZE_ONLY)					\
-	SAVEDESTRUCTOR_X(clear_re,(void*)RExC_rx);	\
+	SAVEDESTRUCTOR_X(clear_re,(void*)RExC_rx_sv);	\
     Simple_vFAIL3(m, a1, a2);				\
 } STMT_END
 
@@ -473,23 +473,22 @@
 	    (int)offset, RExC_precomp, RExC_precomp + offset);	\
 } STMT_END
 
-#define	vWARN(loc,m) STMT_START {					\
+#define	ckWARNreg(loc,m) STMT_START {					\
     const IV offset = loc - RExC_precomp;				\
-    Perl_warner(aTHX_ packWARN(WARN_REGEXP), "%s" REPORT_LOCATION,	\
-	    m, (int)offset, RExC_precomp, RExC_precomp + offset);	\
+    Perl_ck_warner(aTHX_ packWARN(WARN_REGEXP), m REPORT_LOCATION,	\
+	    (int)offset, RExC_precomp, RExC_precomp + offset);		\
 } STMT_END
 
-#define	vWARNdep(loc,m) STMT_START {					\
+#define	ckWARNregdep(loc,m) STMT_START {				\
     const IV offset = loc - RExC_precomp;				\
-    Perl_warner(aTHX_ packWARN2(WARN_DEPRECATED, WARN_REGEXP),		\
-	    "%s" REPORT_LOCATION,					\
-	    m, (int)offset, RExC_precomp, RExC_precomp + offset);	\
+    Perl_ck_warner_d(aTHX_ packWARN2(WARN_DEPRECATED, WARN_REGEXP),	\
+	    m REPORT_LOCATION,						\
+	    (int)offset, RExC_precomp, RExC_precomp + offset);		\
 } STMT_END
 
-
-#define	vWARN2(loc, m, a1) STMT_START {					\
+#define	ckWARN2reg(loc, m, a1) STMT_START {				\
     const IV offset = loc - RExC_precomp;				\
-    Perl_warner(aTHX_ packWARN(WARN_REGEXP), m REPORT_LOCATION,		\
+    Perl_ck_warner(aTHX_ packWARN(WARN_REGEXP), m REPORT_LOCATION,	\
 	    a1, (int)offset, RExC_precomp, RExC_precomp + offset);	\
 } STMT_END
 
@@ -499,12 +498,24 @@
 	    a1, a2, (int)offset, RExC_precomp, RExC_precomp + offset);	\
 } STMT_END
 
+#define	ckWARN3reg(loc, m, a1, a2) STMT_START {				\
+    const IV offset = loc - RExC_precomp;				\
+    Perl_ck_warner(aTHX_ packWARN(WARN_REGEXP), m REPORT_LOCATION,	\
+	    a1, a2, (int)offset, RExC_precomp, RExC_precomp + offset);	\
+} STMT_END
+
 #define	vWARN4(loc, m, a1, a2, a3) STMT_START {				\
     const IV offset = loc - RExC_precomp;				\
     Perl_warner(aTHX_ packWARN(WARN_REGEXP), m REPORT_LOCATION,		\
 	    a1, a2, a3, (int)offset, RExC_precomp, RExC_precomp + offset); \
 } STMT_END
 
+#define	ckWARN4reg(loc, m, a1, a2, a3) STMT_START {			\
+    const IV offset = loc - RExC_precomp;				\
+    Perl_ck_warner(aTHX_ packWARN(WARN_REGEXP), m REPORT_LOCATION,	\
+	    a1, a2, a3, (int)offset, RExC_precomp, RExC_precomp + offset); \
+} STMT_END
+
 #define	vWARN5(loc, m, a1, a2, a3, a4) STMT_START {			\
     const IV offset = loc - RExC_precomp;				\
     Perl_warner(aTHX_ packWARN(WARN_REGEXP), m REPORT_LOCATION,		\
@@ -3182,11 +3193,10 @@
 		    (next_is_eval || !(mincount == 0 && maxcount == 1))
 		    && (minnext == 0) && (deltanext == 0)
 		    && data && !(data->flags & (SF_HAS_PAR|SF_IN_PAR))
-		    && maxcount <= REG_INFTY/3 /* Complement check for big count */
-		    && ckWARN(WARN_REGEXP))
+		    && maxcount <= REG_INFTY/3) /* Complement check for big count */
 		{
-		    vWARN(RExC_parse,
-			  "Quantifier unexpected on zero-length expression");
+		    ckWARNreg(RExC_parse,
+			      "Quantifier unexpected on zero-length expression");
 		}
 
 		min += minnext * mincount;
@@ -4173,7 +4183,7 @@
 
 #ifndef PERL_IN_XSUB_RE 
 REGEXP *
-Perl_pregcomp(pTHX_ const SV * const pattern, const U32 flags)
+Perl_pregcomp(pTHX_ SV * const pattern, const U32 flags)
 {
     dVAR;
     HV * const table = GvHV(PL_hintgv);
@@ -4199,13 +4209,14 @@
 #endif
 
 REGEXP *
-Perl_re_compile(pTHX_ const SV * const pattern, const U32 pm_flags)
+Perl_re_compile(pTHX_ SV * const pattern, U32 pm_flags)
 {
     dVAR;
-    register REGEXP *r;
+    REGEXP *rx;
+    struct regexp *r;
     register regexp_internal *ri;
     STRLEN plen;
-    char*  exp = SvPV((SV*)pattern, plen);
+    char  *exp = SvPV(pattern, plen);
     char* xend = exp + plen;
     regnode *scan;
     I32 flags;
@@ -4225,7 +4236,7 @@
 
     DEBUG_r(if (!PL_colorset) reginitcolors());
 
-    RExC_utf8 = RExC_orig_utf8 = pm_flags & RXf_UTF8;
+    RExC_utf8 = RExC_orig_utf8 = SvUTF8(pattern);
 
     DEBUG_COMPILE_r({
         SV *dsv= sv_newmortal();
@@ -4255,7 +4266,6 @@
     RExC_size = 0L;
     RExC_emit = &PL_regdummy;
     RExC_whilem_seen = 0;
-    RExC_charnames = NULL;
     RExC_open_parens = NULL;
     RExC_close_parens = NULL;
     RExC_opend = NULL;
@@ -4314,7 +4324,8 @@
     /* Allocate space and zero-initialize. Note, the two step process 
        of zeroing when in debug mode, thus anything assigned has to 
        happen after that */
-    Newxz(r, 1, regexp);
+    rx = (REGEXP*) newSV_type(SVt_REGEXP);
+    r = (struct regexp*)SvANY(rx);
     Newxc(ri, sizeof(regexp_internal) + (unsigned)RExC_size * sizeof(regnode),
 	 char, regexp_internal);
     if ( r == NULL || ri == NULL )
@@ -4330,8 +4341,6 @@
     /* non-zero initialization begins here */
     RXi_SET( r, ri );
     r->engine= RE_ENGINE_PTR;
-    r->refcnt = 1;
-    RX_PRELEN(r) = plen;
     r->extflags = pm_flags;
     {
         bool has_p     = ((r->extflags & RXf_PMf_KEEPCOPY) == RXf_PMf_KEEPCOPY);
@@ -4341,12 +4350,14 @@
 			    >> RXf_PMf_STD_PMMOD_SHIFT);
 	const char *fptr = STD_PAT_MODS;        /*"msix"*/
 	char *p;
-        RX_WRAPLEN(r) = plen + has_minus + has_p + has_runon
+	const STRLEN wraplen = plen + has_minus + has_p + has_runon
             + (sizeof(STD_PAT_MODS) - 1)
             + (sizeof("(?:)") - 1);
 
-        Newx(RX_WRAPPED(r), RX_WRAPLEN(r) + 1, char );
-        p = RX_WRAPPED(r);
+	p = sv_grow(MUTABLE_SV(rx), wraplen + 1);
+	SvCUR_set(rx, wraplen);
+	SvPOK_on(rx);
+	SvFLAGS(rx) |= SvUTF8(pattern);
         *p++='('; *p++='?';
         if (has_p)
             *p++ = KEEPCOPY_PAT_MOD; /*'p'*/
@@ -4370,7 +4381,8 @@
 
         *p++ = ':';
         Copy(RExC_precomp, p, plen, char);
-        RX_PRECOMP(r) = p;
+	assert ((RX_WRAPPED(rx) - p) < 16);
+	r->pre_prefix = p - RX_WRAPPED(rx);
         p += plen;
         if (has_runon)
             *p++ = '\n';
@@ -4397,6 +4409,7 @@
                           (UV)((2*RExC_size+1) * sizeof(U32))));
 #endif
     SetProgLen(ri,RExC_size);
+    RExC_rx_sv = rx;
     RExC_rx = r;
     RExC_rxi = ri;
 
@@ -4414,7 +4427,7 @@
     RExC_rx->seen_evals = RExC_seen_evals;
     REGC((U8)REG_MAGIC, (char*) RExC_emit++);
     if (reg(pRExC_state, 0, &flags,1) == NULL) {
-	ReREFCNT_dec(r);   
+	ReREFCNT_dec(rx);   
 	return(NULL);
     }
     /* XXXX To minimize changes to RE engine we always allocate
@@ -4458,7 +4471,7 @@
     /*dmq: removed as part of de-PMOP: pm->op_pmflags = RExC_flags; */
  
     if (UTF)
-        r->extflags |= RXf_UTF8;	/* Unicode in it? */
+	SvUTF8_on(rx);	/* Unicode in it? */
     ri->regstclass = NULL;
     if (RExC_naughty >= 10)	/* Probably an expensive pattern. */
 	r->intflags |= PREGf_NAUGHTY;
@@ -4856,17 +4869,17 @@
         RXp_PAREN_NAMES(r) = NULL;
 
 #ifdef STUPID_PATTERN_CHECKS            
-    if (RX_PRELEN(r) == 0)
+    if (RX_PRELEN(rx) == 0)
         r->extflags |= RXf_NULL;
-    if (r->extflags & RXf_SPLIT && RX_PRELEN(r) == 1 && RX_PRECOMP(r)[0] == ' ')
+    if (r->extflags & RXf_SPLIT && RX_PRELEN(rx) == 1 && RX_PRECOMP(rx)[0] == ' ')
         /* XXX: this should happen BEFORE we compile */
         r->extflags |= (RXf_SKIPWHITE|RXf_WHITE); 
-    else if (RX_PRELEN(r) == 3 && memEQ("\\s+", RX_PRECOMP(r), 3))
+    else if (RX_PRELEN(rx) == 3 && memEQ("\\s+", RX_PRECOMP(rx), 3))
         r->extflags |= RXf_WHITE;
-    else if (RX_PRELEN(r) == 1 && RXp_PRECOMP(r)[0] == '^')
+    else if (RX_PRELEN(rx) == 1 && RXp_PRECOMP(rx)[0] == '^')
         r->extflags |= RXf_START_ONLY;
 #else
-    if (r->extflags & RXf_SPLIT && RX_PRELEN(r) == 1 && RX_PRECOMP(r)[0] == ' ')
+    if (r->extflags & RXf_SPLIT && RX_PRELEN(rx) == 1 && RX_PRECOMP(rx)[0] == ' ')
             /* XXX: this should happen BEFORE we compile */
             r->extflags |= (RXf_SKIPWHITE|RXf_WHITE); 
     else {
@@ -4917,7 +4930,7 @@
         PerlIO_printf(Perl_debug_log, "\n");
     });
 #endif
-    return(r);
+    return rx;
 }
 
 #undef RE_ENGINE_PTR
@@ -4968,10 +4981,12 @@
 }
 
 SV*
-Perl_reg_named_buff_fetch(pTHX_ REGEXP * const rx, SV * const namesv, const U32 flags)
+Perl_reg_named_buff_fetch(pTHX_ REGEXP * const r, SV * const namesv,
+			  const U32 flags)
 {
     AV *retarray = NULL;
     SV *ret;
+    struct regexp *const rx = (struct regexp *)SvANY(r);
 
     PERL_ARGS_ASSERT_REG_NAMED_BUFF_FETCH;
 
@@ -4990,7 +5005,7 @@
                     && rx->offs[nums[i]].end != -1)
                 {
                     ret = newSVpvs("");
-                    CALLREG_NUMBUF_FETCH(rx,nums[i],ret);
+                    CALLREG_NUMBUF_FETCH(r,nums[i],ret);
                     if (!retarray)
                         return ret;
                 } else {
@@ -5007,9 +5022,10 @@
 }
 
 bool
-Perl_reg_named_buff_exists(pTHX_ REGEXP * const rx, SV * const key,
+Perl_reg_named_buff_exists(pTHX_ REGEXP * const r, SV * const key,
                            const U32 flags)
 {
+    struct regexp *const rx = (struct regexp *)SvANY(r);
 
     PERL_ARGS_ASSERT_REG_NAMED_BUFF_EXISTS;
 
@@ -5017,7 +5033,7 @@
         if (flags & RXapif_ALL) {
             return hv_exists_ent(RXp_PAREN_NAMES(rx), key, 0);
         } else {
-	    SV *sv = CALLREG_NAMED_BUFF_FETCH(rx, key, flags);
+	    SV *sv = CALLREG_NAMED_BUFF_FETCH(r, key, flags);
             if (sv) {
 		SvREFCNT_dec(sv);
                 return TRUE;
@@ -5031,23 +5047,25 @@
 }
 
 SV*
-Perl_reg_named_buff_firstkey(pTHX_ REGEXP * const rx, const U32 flags)
+Perl_reg_named_buff_firstkey(pTHX_ REGEXP * const r, const U32 flags)
 {
+    struct regexp *const rx = (struct regexp *)SvANY(r);
 
     PERL_ARGS_ASSERT_REG_NAMED_BUFF_FIRSTKEY;
 
     if ( rx && RXp_PAREN_NAMES(rx) ) {
 	(void)hv_iterinit(RXp_PAREN_NAMES(rx));
 
-	return CALLREG_NAMED_BUFF_NEXTKEY(rx, NULL, flags & ~RXapif_FIRSTKEY);
+	return CALLREG_NAMED_BUFF_NEXTKEY(r, NULL, flags & ~RXapif_FIRSTKEY);
     } else {
 	return FALSE;
     }
 }
 
 SV*
-Perl_reg_named_buff_nextkey(pTHX_ REGEXP * const rx, const U32 flags)
+Perl_reg_named_buff_nextkey(pTHX_ REGEXP * const r, const U32 flags)
 {
+    struct regexp *const rx = (struct regexp *)SvANY(r);
     GET_RE_DEBUG_FLAGS_DECL;
 
     PERL_ARGS_ASSERT_REG_NAMED_BUFF_NEXTKEY;
@@ -5078,11 +5096,12 @@
 }
 
 SV*
-Perl_reg_named_buff_scalar(pTHX_ REGEXP * const rx, const U32 flags)
+Perl_reg_named_buff_scalar(pTHX_ REGEXP * const r, const U32 flags)
 {
     SV *ret;
     AV *av;
     I32 length;
+    struct regexp *const rx = (struct regexp *)SvANY(r);
 
     PERL_ARGS_ASSERT_REG_NAMED_BUFF_SCALAR;
 
@@ -5090,7 +5109,7 @@
         if (flags & (RXapif_ALL | RXapif_REGNAMES_COUNT)) {
             return newSViv(HvTOTALKEYS(RXp_PAREN_NAMES(rx)));
         } else if (flags & RXapif_ONE) {
-            ret = CALLREG_NAMED_BUFF_ALL(rx, (flags | RXapif_REGNAMES));
+            ret = CALLREG_NAMED_BUFF_ALL(r, (flags | RXapif_REGNAMES));
             av = MUTABLE_AV(SvRV(ret));
             length = av_len(av);
 	    SvREFCNT_dec(ret);
@@ -5104,8 +5123,9 @@
 }
 
 SV*
-Perl_reg_named_buff_all(pTHX_ REGEXP * const rx, const U32 flags)
+Perl_reg_named_buff_all(pTHX_ REGEXP * const r, const U32 flags)
 {
+    struct regexp *const rx = (struct regexp *)SvANY(r);
     AV *av = newAV();
 
     PERL_ARGS_ASSERT_REG_NAMED_BUFF_ALL;
@@ -5138,8 +5158,10 @@
 }
 
 void
-Perl_reg_numbered_buff_fetch(pTHX_ REGEXP * const rx, const I32 paren, SV * const sv)
+Perl_reg_numbered_buff_fetch(pTHX_ REGEXP * const r, const I32 paren,
+			     SV * const sv)
 {
+    struct regexp *const rx = (struct regexp *)SvANY(r);
     char *s = NULL;
     I32 i = 0;
     I32 s1, t1;
@@ -5229,9 +5251,10 @@
 }
 
 I32
-Perl_reg_numbered_buff_length(pTHX_ REGEXP * const rx, const SV * const sv,
+Perl_reg_numbered_buff_length(pTHX_ REGEXP * const r, const SV * const sv,
                               const I32 paren)
 {
+    struct regexp *const rx = (struct regexp *)SvANY(r);
     I32 i;
     I32 s1, t1;
 
@@ -5271,7 +5294,7 @@
             goto getlen;
         } else {
             if (ckWARN(WARN_UNINITIALIZED))
-                report_uninit((SV *)sv);
+                report_uninit((const SV *)sv);
             return 0;
         }
     }
@@ -5293,7 +5316,10 @@
 {
     PERL_ARGS_ASSERT_REG_QR_PACKAGE;
 	PERL_UNUSED_ARG(rx);
-	return newSVpvs("Regexp");
+	if (0)
+	    return NULL;
+	else
+	    return newSVpvs("Regexp");
 }
 
 /* Scans the name of a named buffer from the pattern.
@@ -6062,8 +6088,8 @@
 			break;
 	            case KEEPCOPY_PAT_MOD: /* 'p' */
                         if (flagsp == &negflags) {
-                            if (SIZE_ONLY && ckWARN(WARN_REGEXP))
-                                vWARN(RExC_parse + 1,"Useless use of (?-p)");
+                            if (SIZE_ONLY)
+                                ckWARNreg(RExC_parse + 1,"Useless use of (?-p)");
                         } else {
                             *flagsp |= RXf_PMf_KEEPCOPY;
                         }
@@ -6518,11 +6544,11 @@
 	goto do_curly;
     }
   nest_check:
-    if (!SIZE_ONLY && !(flags&(HASWIDTH|POSTPONED)) && max > REG_INFTY/3 && ckWARN(WARN_REGEXP)) {
-	vWARN3(RExC_parse,
-	       "%.*s matches null string many times",
-	       (int)(RExC_parse >= origparse ? RExC_parse - origparse : 0),
-	       origparse);
+    if (!SIZE_ONLY && !(flags&(HASWIDTH|POSTPONED)) && max > REG_INFTY/3) {
+	ckWARN3reg(RExC_parse,
+		   "%.*s matches null string many times",
+		   (int)(RExC_parse >= origparse ? RExC_parse - origparse : 0),
+		   origparse);
     }
 
     if (RExC_parse < RExC_end && *RExC_parse == '?') {
@@ -6557,283 +6583,276 @@
 /* reg_namedseq(pRExC_state,UVp)
    
    This is expected to be called by a parser routine that has 
-   recognized'\N' and needs to handle the rest. RExC_parse is 
+   recognized '\N' and needs to handle the rest. RExC_parse is
    expected to point at the first char following the N at the time
    of the call.
+
+   The \N may be inside (indicated by valuep not being NULL) or outside a
+   character class.
+
+   \N may begin either a named sequence, or if outside a character class, mean
+   to match a non-newline.  For non single-quoted regexes, the tokenizer has
+   attempted to decide which, and in the case of a named sequence converted it
+   into one of the forms: \N{} (if the sequence is null), or \N{U+c1.c2...},
+   where c1... are the characters in the sequence.  For single-quoted regexes,
+   the tokenizer passes the \N sequence through unchanged; this code will not
+   attempt to determine this nor expand those.  The net effect is that if the
+   beginning of the passed-in pattern isn't '{U+' or there is no '}', it
+   signals that this \N occurrence means to match a non-newline.
+   
+   Only the \N{U+...} form should occur in a character class, for the same
+   reason that '.' inside a character class means to just match a period: it
+   just doesn't make sense.
    
    If valuep is non-null then it is assumed that we are parsing inside 
    of a charclass definition and the first codepoint in the resolved
    string is returned via *valuep and the routine will return NULL. 
    In this mode if a multichar string is returned from the charnames 
-   handler a warning will be issued, and only the first char in the 
+   handler, a warning will be issued, and only the first char in the 
    sequence will be examined. If the string returned is zero length
    then the value of *valuep is undefined and NON-NULL will 
    be returned to indicate failure. (This will NOT be a valid pointer 
    to a regnode.)
    
-   If value is null then it is assumed that we are parsing normal text
-   and inserts a new EXACT node into the program containing the resolved
-   string and returns a pointer to the new node. If the string is 
-   zerolength a NOTHING node is emitted.
-   
+   If valuep is null then it is assumed that we are parsing normal text and a
+   new EXACT node is inserted into the program containing the resolved string,
+   and a pointer to the new node is returned.  But if the string is zero length
+   a NOTHING node is emitted instead.
+
    On success RExC_parse is set to the char following the endbrace.
-   Parsing failures will generate a fatal errorvia vFAIL(...)
-   
-   NOTE: We cache all results from the charnames handler locally in 
-   the RExC_charnames hash (created on first use) to prevent a charnames 
-   handler from playing silly-buggers and returning a short string and 
-   then a long string for a given pattern. Since the regexp program 
-   size is calculated during an initial parse this would result
-   in a buffer overrun so we cache to prevent the charname result from
-   changing during the course of the parse.
-   
+   Parsing failures will generate a fatal error via vFAIL(...)
  */
 STATIC regnode *
-S_reg_namedseq(pTHX_ RExC_state_t *pRExC_state, UV *valuep) 
+S_reg_namedseq(pTHX_ RExC_state_t *pRExC_state, UV *valuep, I32 *flagp)
 {
-    char * name;        /* start of the content of the name */
-    char * endbrace;    /* endbrace following the name */
-    SV *sv_str = NULL;  
-    SV *sv_name = NULL;
-    STRLEN len; /* this has various purposes throughout the code */
-    bool cached = 0; /* if this is true then we shouldn't refcount dev sv_str */
+    char * endbrace;    /* '}' following the name */
     regnode *ret = NULL;
+#ifdef DEBUGGING
+    char* parse_start = RExC_parse - 2;	    /* points to the '\N' */
+#endif
+    char* p;
+
+    GET_RE_DEBUG_FLAGS_DECL;
  
     PERL_ARGS_ASSERT_REG_NAMEDSEQ;
+
+    GET_RE_DEBUG_FLAGS;
+
+    /* The [^\n] meaning of \N ignores spaces and comments under the /x
+     * modifier.  The other meaning does not */
+    p = (RExC_flags & RXf_PMf_EXTENDED)
+	? regwhite( pRExC_state, RExC_parse )
+	: RExC_parse;
    
-    if (*RExC_parse != '{') {
-        vFAIL("Missing braces on \\N{}");
+    /* Disambiguate between \N meaning a named character versus \N meaning
+     * [^\n].  The former is assumed when it can't be the latter. */
+    if (*p != '{' || regcurly(p)) {
+	RExC_parse = p;
+	if (valuep) {
+	    /* no bare \N in a charclass */
+	    vFAIL("\\N in a character class must be a named character: \\N{...}");
+	}
+	nextchar(pRExC_state);
+	ret = reg_node(pRExC_state, REG_ANY);
+	*flagp |= HASWIDTH|SIMPLE;
+	RExC_naughty++;
+	RExC_parse--;
+        Set_Node_Length(ret, 1); /* MJD */
+	return ret;
     }
-    name = RExC_parse+1;
-    endbrace = strchr(RExC_parse, '}');
-    if ( ! endbrace ) {
-        RExC_parse++;
-        vFAIL("Missing right brace on \\N{}");
-    } 
-    RExC_parse = endbrace + 1;  
-    
-    
-    /* RExC_parse points at the beginning brace, 
-       endbrace points at the last */
-    if ( name[0]=='U' && name[1]=='+' ) {
-        /* its a "Unicode hex" notation {U+89AB} */
-        I32 fl = PERL_SCAN_ALLOW_UNDERSCORES
-            | PERL_SCAN_DISALLOW_PREFIX
-            | (SIZE_ONLY ? PERL_SCAN_SILENT_ILLDIGIT : 0);
-        UV cp;
-        len = (STRLEN)(endbrace - name - 2);
-        cp = grok_hex(name + 2, &len, &fl, NULL);
-        if ( len != (STRLEN)(endbrace - name - 2) ) {
-            cp = 0xFFFD;
-        }    
-        if ( valuep ) {
-	    if (cp > 0xff) RExC_utf8 = 1;
-            *valuep = cp;
-            return NULL;
-        }
 
-	/* Need to convert to utf8 if either: won't fit into a byte, or the re
-	 * is going to be in utf8 and the representation changes under utf8. */
-	if (cp > 0xff || (RExC_utf8 && ! UNI_IS_INVARIANT(cp))) {
-	    U8 string[UTF8_MAXBYTES+1];
-	    U8 *tmps;
-	    RExC_utf8 = 1;
-	    tmps = uvuni_to_utf8(string, cp);
-	    sv_str = newSVpvn_utf8((char*)string, tmps - string, TRUE);
-	} else {    /* Otherwise, no need for utf8, can skip that step */
-	    char string;
-	    string = (char)cp;
-	    sv_str= newSVpvn(&string, 1);
-	}
-    } else {
-        /* fetch the charnames handler for this scope */
-        HV * const table = GvHV(PL_hintgv);
-        SV **cvp= table ? 
-            hv_fetchs(table, "charnames", FALSE) :
-            NULL;
-        SV *cv= cvp ? *cvp : NULL;
-        HE *he_str;
-        int count;
-        /* create an SV with the name as argument */
-        sv_name = newSVpvn(name, endbrace - name);
-        
-        if (!table || !(PL_hints & HINT_LOCALIZE_HH)) {
-            vFAIL2("Constant(\\N{%s}) unknown: "
-                  "(possibly a missing \"use charnames ...\")",
-                  SvPVX(sv_name));
-        }
-        if (!cvp || !SvOK(*cvp)) { /* when $^H{charnames} = undef; */
-            vFAIL2("Constant(\\N{%s}): "
-                  "$^H{charnames} is not defined",SvPVX(sv_name));
-        }
-        
-        
-        
-        if (!RExC_charnames) {
-            /* make sure our cache is allocated */
-            RExC_charnames = newHV();
-            sv_2mortal(MUTABLE_SV(RExC_charnames));
-        } 
-            /* see if we have looked this one up before */
-        he_str = hv_fetch_ent( RExC_charnames, sv_name, 0, 0 );
-        if ( he_str ) {
-            sv_str = HeVAL(he_str);
-            cached = 1;
-        } else {
-            dSP ;
+    /* Here, we have decided it should be a named sequence */
 
-            ENTER ;
-            SAVETMPS ;
-            PUSHMARK(SP) ;
-            
-            XPUSHs(sv_name);
-            
-            PUTBACK ;
-            
-            count= call_sv(cv, G_SCALAR);
-            
-            if (count == 1) { /* XXXX is this right? dmq */
-                sv_str = POPs;
-                SvREFCNT_inc_simple_void(sv_str);
-            } 
-            
-            SPAGAIN ;
-            PUTBACK ;
-            FREETMPS ;
-            LEAVE ;
-            
-            if ( !sv_str || !SvOK(sv_str) ) {
-                vFAIL2("Constant(\\N{%s}): Call to &{$^H{charnames}} "
-                      "did not return a defined value",SvPVX(sv_name));
-            }
-            if (hv_store_ent( RExC_charnames, sv_name, sv_str, 0))
-                cached = 1;
-        }
+    /* The test above made sure that the next real character is a '{', but
+     * under the /x modifier, it could be separated by space (or a comment and
+     * \n) and this is not allowed (for consistency with \x{...} and the
+     * tokenizer handling of \N{NAME}). */
+    if (*RExC_parse != '{') {
+	vFAIL("Missing braces on \\N{}");
     }
-    if (valuep) {
-        char *p = SvPV(sv_str, len);
-        if (len) {
-            STRLEN numlen = 1;
-            if ( SvUTF8(sv_str) ) {
-                *valuep = utf8_to_uvchr((U8*)p, &numlen);
-                if (*valuep > 0x7F)
-                    RExC_utf8 = 1; 
-                /* XXXX
-                  We have to turn on utf8 for high bit chars otherwise
-                  we get failures with
-                  
-                   "ss" =~ /[\N{LATIN SMALL LETTER SHARP S}]/i
-                   "SS" =~ /[\N{LATIN SMALL LETTER SHARP S}]/i
-                
-                  This is different from what \x{} would do with the same
-                  codepoint, where the condition is > 0xFF.
-                  - dmq
-                */
-                
-                
-            } else {
-                *valuep = (UV)*p;
-                /* warn if we havent used the whole string? */
-            }
-            if (numlen<len && SIZE_ONLY && ckWARN(WARN_REGEXP)) {
-                vWARN2(RExC_parse,
-                    "Ignoring excess chars from \\N{%s} in character class",
-                    SvPVX(sv_name)
-                );
-            }        
-        } else if (SIZE_ONLY && ckWARN(WARN_REGEXP)) {
-            vWARN2(RExC_parse,
-                    "Ignoring zero length \\N{%s} in character class",
-                    SvPVX(sv_name)
-                );
-        }
-        if (sv_name)    
-            SvREFCNT_dec(sv_name);    
-        if (!cached)
-            SvREFCNT_dec(sv_str);    
-        return len ? NULL : (regnode *)&len;
-    } else if(SvCUR(sv_str)) {     
-        
-        char *s; 
-        char *p, *pend;        
-        STRLEN charlen = 1;
-#ifdef DEBUGGING
-        char * parse_start = name-3; /* needed for the offsets */
-#endif
-        GET_RE_DEBUG_FLAGS_DECL;     /* needed for the offsets */
-        
-        ret = reg_node(pRExC_state,
-            (U8)(FOLD ? (LOC ? EXACTFL : EXACTF) : EXACT));
-        s= STRING(ret);
-        
-        if ( RExC_utf8 && !SvUTF8(sv_str) ) {
-            sv_utf8_upgrade(sv_str);
-        } else if ( !RExC_utf8 && SvUTF8(sv_str) ) {
-            RExC_utf8= 1;
-        }
-        
-        p = SvPV(sv_str, len);
-        pend = p + len;
-        /* len is the length written, charlen is the size the char read */
-        for ( len = 0; p < pend; p += charlen ) {
-            if (UTF) {
-                UV uvc = utf8_to_uvchr((U8*)p, &charlen);
-                if (FOLD) {
-                    STRLEN foldlen,numlen;
-                    U8 tmpbuf[UTF8_MAXBYTES_CASE+1], *foldbuf;
-                    uvc = toFOLD_uni(uvc, tmpbuf, &foldlen);
-                    /* Emit all the Unicode characters. */
-                    
-                    for (foldbuf = tmpbuf;
-                        foldlen;
-                        foldlen -= numlen) 
-                    {
-                        uvc = utf8_to_uvchr(foldbuf, &numlen);
-                        if (numlen > 0) {
-                            const STRLEN unilen = reguni(pRExC_state, uvc, s);
-                            s       += unilen;
-                            len     += unilen;
-                            /* In EBCDIC the numlen
-                            * and unilen can differ. */
-                            foldbuf += numlen;
-                            if (numlen >= foldlen)
-                                break;
-                        }
-                        else
-                            break; /* "Can't happen." */
-                    }                          
-                } else {
-                    const STRLEN unilen = reguni(pRExC_state, uvc, s);
-        	    if (unilen > 0) {
-        	       s   += unilen;
-        	       len += unilen;
-        	    }
-        	}
-	    } else {
-                len++;
-                REGC(*p, s++);
-            }
-        }
-        if (SIZE_ONLY) {
-            RExC_size += STR_SZ(len);
-        } else {
-            STR_LEN(ret) = len;
-            RExC_emit += STR_SZ(len);
-        }
-        Set_Node_Cur_Length(ret); /* MJD */
-        RExC_parse--; 
-        nextchar(pRExC_state);
-    } else {	/* zero length */
-        ret = reg_node(pRExC_state,NOTHING);
+
+    RExC_parse++;	/* Skip past the '{' */
+
+    if (! (endbrace = strchr(RExC_parse, '}')) /* no trailing brace */
+	|| ! (endbrace == RExC_parse		/* nothing between the {} */
+	      || (endbrace - RExC_parse >= 2	/* U+ (bad hex is checked below */
+		  && strnEQ(RExC_parse, "U+", 2)))) /* for a better error msg) */
+    {
+	if (endbrace) RExC_parse = endbrace;	/* position msg's '<--HERE' */
+	vFAIL("\\N{NAME} must be resolved by the lexer");
     }
-    if (!cached) {
-        SvREFCNT_dec(sv_str);
+
+    if (endbrace == RExC_parse) {   /* empty: \N{} */
+	if (! valuep) {
+	    RExC_parse = endbrace + 1;  
+	    return reg_node(pRExC_state,NOTHING);
+	}
+
+	if (SIZE_ONLY) {
+	    ckWARNreg(RExC_parse,
+		    "Ignoring zero length \\N{} in character class"
+	    );
+	    RExC_parse = endbrace + 1;  
+	}
+	*valuep = 0;
+	return (regnode *) &RExC_parse; /* Invalid regnode pointer */
     }
-    if (sv_name) {
-        SvREFCNT_dec(sv_name); 
+
+    RExC_utf8 = 1;	/* named sequences imply Unicode semantics */
+    RExC_parse += 2;	/* Skip past the 'U+' */
+
+    if (valuep) {   /* In a bracketed char class */
+	/* We only pay attention to the first char of 
+	multichar strings being returned. I kinda wonder
+	if this makes sense as it does change the behaviour
+	from earlier versions, OTOH that behaviour was broken
+	as well. XXX Solution is to recharacterize as
+	[rest-of-class]|multi1|multi2... */
+
+	STRLEN length_of_hex;
+	I32 flags = PERL_SCAN_ALLOW_UNDERSCORES
+	    | PERL_SCAN_DISALLOW_PREFIX
+	    | (SIZE_ONLY ? PERL_SCAN_SILENT_ILLDIGIT : 0);
+    
+	char * endchar = RExC_parse + strcspn(RExC_parse, ".}");
+	if (endchar < endbrace) {
+	    ckWARNreg(endchar, "Using just the first character returned by \\N{} in character class");
+	}
+
+	length_of_hex = (STRLEN)(endchar - RExC_parse);
+	*valuep = grok_hex(RExC_parse, &length_of_hex, &flags, NULL);
+
+	/* The tokenizer should have guaranteed validity, but it's possible to
+	 * bypass it by using single quoting, so check */
+	if (length_of_hex == 0
+	    || length_of_hex != (STRLEN)(endchar - RExC_parse) )
+	{
+	    RExC_parse += length_of_hex;	/* Includes all the valid */
+	    RExC_parse += (RExC_orig_utf8)	/* point to after 1st invalid */
+			    ? UTF8SKIP(RExC_parse)
+			    : 1;
+	    /* Guard against malformed utf8 */
+	    if (RExC_parse >= endchar) RExC_parse = endchar;
+	    vFAIL("Invalid hexadecimal number in \\N{U+...}");
+	}    
+
+	RExC_parse = endbrace + 1;
+	if (endchar == endbrace) return NULL;
+
+        ret = (regnode *) &RExC_parse;	/* Invalid regnode pointer */
+    }
+    else {	/* Not a char class */
+	char *s;	    /* String to put in generated EXACT node */
+	STRLEN len = 0;	    /* Its current length */
+	char *endchar;	    /* Points to '.' or '}' ending cur char in the input
+			       stream */
+
+	ret = reg_node(pRExC_state,
+			(U8)(FOLD ? (LOC ? EXACTFL : EXACTF) : EXACT));
+	s= STRING(ret);
+
+	/* Exact nodes can hold only a U8 length's of text = 255.  Loop through
+	 * the input which is of the form now 'c1.c2.c3...}' until find the
+	 * ending brace or exeed length 255.  The characters that exceed this
+	 * limit are dropped.  The limit could be relaxed should it become
+	 * desirable by reparsing this as (?:\N{NAME}), so could generate
+	 * multiple EXACT nodes, as is done for just regular input.  But this
+	 * is primarily a named character, and not intended to be a huge long
+	 * string, so 255 bytes should be good enough */
+	while (1) {
+	    STRLEN length_of_hex;
+	    I32 grok_flags = PERL_SCAN_ALLOW_UNDERSCORES
+			    | PERL_SCAN_DISALLOW_PREFIX
+			    | (SIZE_ONLY ? PERL_SCAN_SILENT_ILLDIGIT : 0);
+	    UV cp;  /* Ord of current character */
+
+	    /* Code points are separated by dots.  If none, there is only one
+	     * code point, and is terminated by the brace */
+	    endchar = RExC_parse + strcspn(RExC_parse, ".}");
+
+	    /* The values are Unicode even on EBCDIC machines */
+	    length_of_hex = (STRLEN)(endchar - RExC_parse);
+	    cp = grok_hex(RExC_parse, &length_of_hex, &grok_flags, NULL);
+	    if ( length_of_hex == 0 
+		|| length_of_hex != (STRLEN)(endchar - RExC_parse) )
+	    {
+		RExC_parse += length_of_hex;	    /* Includes all the valid */
+		RExC_parse += (RExC_orig_utf8)	/* point to after 1st invalid */
+				? UTF8SKIP(RExC_parse)
+				: 1;
+		/* Guard against malformed utf8 */
+		if (RExC_parse >= endchar) RExC_parse = endchar;
+		vFAIL("Invalid hexadecimal number in \\N{U+...}");
+	    }    
+
+	    if (! FOLD) {	/* Not folding, just append to the string */
+		STRLEN unilen;
+
+		/* Quit before adding this character if would exceed limit */
+		if (len + UNISKIP(cp) > U8_MAX) break;
+
+		unilen = reguni(pRExC_state, cp, s);
+		if (unilen > 0) {
+		    s   += unilen;
+		    len += unilen;
+		}
+	    } else {	/* Folding, output the folded equivalent */
+		STRLEN foldlen,numlen;
+		U8 tmpbuf[UTF8_MAXBYTES_CASE+1], *foldbuf;
+		cp = toFOLD_uni(cp, tmpbuf, &foldlen);
+
+		/* Quit before exceeding size limit */
+		if (len + foldlen > U8_MAX) break;
+		
+		for (foldbuf = tmpbuf;
+		    foldlen;
+		    foldlen -= numlen) 
+		{
+		    cp = utf8_to_uvchr(foldbuf, &numlen);
+		    if (numlen > 0) {
+			const STRLEN unilen = reguni(pRExC_state, cp, s);
+			s       += unilen;
+			len     += unilen;
+			/* In EBCDIC the numlen and unilen can differ. */
+			foldbuf += numlen;
+			if (numlen >= foldlen)
+			    break;
+		    }
+		    else
+			break; /* "Can't happen." */
+		}                          
+	    }
+
+	    /* Point to the beginning of the next character in the sequence. */
+	    RExC_parse = endchar + 1;
+
+	    /* Quit if no more characters */
+	    if (RExC_parse >= endbrace) break;
+	}
+
+
+	if (SIZE_ONLY) {
+	    if (RExC_parse < endbrace) {
+		ckWARNreg(RExC_parse - 1,
+			  "Using just the first characters returned by \\N{}");
+	    }
+
+	    RExC_size += STR_SZ(len);
+	} else {
+	    STR_LEN(ret) = len;
+	    RExC_emit += STR_SZ(len);
+	}
+
+	RExC_parse = endbrace + 1;
+
+	*flagp |= HASWIDTH; /* Not SIMPLE, as that causes the engine to fail
+			       with malformed in t/re/pat_advanced.t */
+	RExC_parse --;
+	Set_Node_Cur_Length(ret); /* MJD */
+	nextchar(pRExC_state);
     }
-    return ret;
 
+    return ret;
 }
 
 
@@ -7163,12 +7182,12 @@
 	    }
 	    break;
         case 'N': 
-            /* Handle \N{NAME} here and not below because it can be 
+            /* Handle \N and \N{NAME} here and not below because it can be
             multicharacter. join_exact() will join them up later on. 
             Also this makes sure that things like /\N{BLAH}+/ and 
             \N{BLAH} being multi char Just Happen. dmq*/
             ++RExC_parse;
-            ret= reg_namedseq(pRExC_state, NULL); 
+            ret= reg_namedseq(pRExC_state, NULL, flagp); 
             break;
 	case 'k':    /* Handle \k<NAME> and \k'NAME' */
 	parse_named_seq:
@@ -7434,6 +7453,18 @@
                             I32 flags = 0;
 			    STRLEN numlen = 3;
 			    ender = grok_oct(p, &numlen, &flags, NULL);
+
+			    /* An octal above 0xff is interpreted differently
+			     * depending on if the re is in utf8 or not.  If it
+			     * is in utf8, the value will be itself, otherwise
+			     * it is interpreted as modulo 0x100.  It has been
+			     * decided to discourage the use of octal above the
+			     * single-byte range.  For now, warn only when
+			     * it ends up modulo */
+			    if (SIZE_ONLY && ender >= 0x100
+				    && ! UTF && ! PL_encoding) {
+				ckWARNregdep(p, "Use of octal value above 377 is deprecated");
+			    }
 			    p += numlen;
 			}
 			else {
@@ -7447,8 +7478,8 @@
 			{
 			    SV* enc = PL_encoding;
 			    ender = reg_recode((const char)(U8)ender, &enc);
-			    if (!enc && SIZE_ONLY && ckWARN(WARN_REGEXP))
-				vWARN(p, "Invalid escape in the specified encoding");
+			    if (!enc && SIZE_ONLY)
+				ckWARNreg(p, "Invalid escape in the specified encoding");
 			    RExC_utf8 = 1;
 			}
 			break;
@@ -7457,8 +7488,8 @@
 			    FAIL("Trailing \\");
 			/* FALL THROUGH */
 		    default:
-			if (!SIZE_ONLY&& isALPHA(*p) && ckWARN(WARN_REGEXP))
-			    vWARN2(p + 1, "Unrecognized escape \\%c passed through", UCHARAT(p));
+			if (!SIZE_ONLY&& isALPHA(*p))
+			    ckWARN2reg(p + 1, "Unrecognized escape \\%c passed through", UCHARAT(p));
 			goto normal_default;
 		    }
 		    break;
@@ -7750,10 +7781,9 @@
 	while (isALNUM(*s))
 	    s++;
 	if (*s && c == *s && s[1] == ']') {
-	    if (ckWARN(WARN_REGEXP))
-		vWARN3(s+2,
-			"POSIX syntax [%c %c] belongs inside character classes",
-			c, c);
+	    ckWARN3reg(s+2,
+		       "POSIX syntax [%c %c] belongs inside character classes",
+		       c, c);
 
 	    /* [[=foo=]] and [[.foo.]] are still future. */
 	    if (POSIXCC_NOTYET(c)) {
@@ -7955,7 +7985,7 @@
                     from earlier versions, OTOH that behaviour was broken
                     as well. */
                     UV v; /* value is register so we cant & it /grrr */
-                    if (reg_namedseq(pRExC_state, &v)) {
+                    if (reg_namedseq(pRExC_state, &v, NULL)) {
                         goto parseit;
                     }
                     value= v; 
@@ -8049,16 +8079,16 @@
 		{
 		    SV* enc = PL_encoding;
 		    value = reg_recode((const char)(U8)value, &enc);
-		    if (!enc && SIZE_ONLY && ckWARN(WARN_REGEXP))
-			vWARN(RExC_parse,
-			      "Invalid escape in the specified encoding");
+		    if (!enc && SIZE_ONLY)
+			ckWARNreg(RExC_parse,
+				  "Invalid escape in the specified encoding");
 		    break;
 		}
 	    default:
-		if (!SIZE_ONLY && isALPHA(value) && ckWARN(WARN_REGEXP))
-		    vWARN2(RExC_parse,
-			   "Unrecognized escape \\%c in character class passed through",
-			   (int)value);
+		if (!SIZE_ONLY && isALPHA(value))
+		    ckWARN2reg(RExC_parse,
+			       "Unrecognized escape \\%c in character class passed through",
+			       (int)value);
 		break;
 	    }
 	} /* end of \blah */
@@ -8077,14 +8107,13 @@
 	    /* a bad range like a-\d, a-[:digit:] ? */
 	    if (range) {
 		if (!SIZE_ONLY) {
-		    if (ckWARN(WARN_REGEXP)) {
-			const int w =
-			    RExC_parse >= rangebegin ?
-			    RExC_parse - rangebegin : 0;
-			vWARN4(RExC_parse,
+		    const int w =
+			RExC_parse >= rangebegin ?
+			RExC_parse - rangebegin : 0;
+		    ckWARN4reg(RExC_parse,
 			       "False [] range \"%*.*s\"",
 			       w, w, rangebegin);
-		    }
+
 		    if (prevvalue < 256) {
 			ANYOF_BITMAP_SET(ret, prevvalue);
 			ANYOF_BITMAP_SET(ret, '-');
@@ -8389,9 +8418,7 @@
         *STRING(ret)= (char)value;
         STR_LEN(ret)= 1;
         RExC_emit += STR_SZ(1);
-	if (listsv) {
-	    SvREFCNT_dec(listsv);
-	}
+	SvREFCNT_dec(listsv);
         return ret;
     }
     /* optimize case-insensitive simple patterns (e.g. /[a-z]/i) */
@@ -8858,8 +8885,9 @@
 /*
  - regcurly - a little FSA that accepts {\d+,?\d*}
  */
-STATIC I32
-S_regcurly(register const char *s)
+#ifndef PERL_IN_XSUB_RE
+I32
+Perl_regcurly(register const char *s)
 {
     PERL_ARGS_ASSERT_REGCURLY;
 
@@ -8877,13 +8905,13 @@
 	return FALSE;
     return TRUE;
 }
-
+#endif
 
 /*
  - regdump - dump a regexp onto Perl_debug_log in vaguely comprehensible form
  */
 #ifdef DEBUGGING
-void 
+static void 
 S_regdump_extflags(pTHX_ const char *lead, const U32 flags)
 {
     int bit;
@@ -9294,9 +9322,10 @@
 }
 
 SV *
-Perl_re_intuit_string(pTHX_ REGEXP * const prog)
+Perl_re_intuit_string(pTHX_ REGEXP * const r)
 {				/* Assume that RE_INTUIT is set */
     dVAR;
+    struct regexp *const prog = (struct regexp *)SvANY(r);
     GET_RE_DEBUG_FLAGS_DECL;
 
     PERL_ARGS_ASSERT_RE_INTUIT_STRING;
@@ -9337,38 +9366,36 @@
 void
 Perl_pregfree(pTHX_ REGEXP *r)
 {
+    SvREFCNT_dec(r);
+}
+
+void
+Perl_pregfree2(pTHX_ REGEXP *rx)
+{
     dVAR;
+    struct regexp *const r = (struct regexp *)SvANY(rx);
     GET_RE_DEBUG_FLAGS_DECL;
 
-    if (!r || (--r->refcnt > 0))
-	return;
+    PERL_ARGS_ASSERT_PREGFREE2;
+
     if (r->mother_re) {
         ReREFCNT_dec(r->mother_re);
     } else {
-        CALLREGFREE_PVT(r); /* free the private data */
-        if (RXp_PAREN_NAMES(r))
-            SvREFCNT_dec(RXp_PAREN_NAMES(r));
-        Safefree(RX_WRAPPED(r));
+        CALLREGFREE_PVT(rx); /* free the private data */
+        SvREFCNT_dec(RXp_PAREN_NAMES(r));
     }        
     if (r->substrs) {
-        if (r->anchored_substr)
-            SvREFCNT_dec(r->anchored_substr);
-        if (r->anchored_utf8)
-            SvREFCNT_dec(r->anchored_utf8);
-        if (r->float_substr)
-            SvREFCNT_dec(r->float_substr);
-        if (r->float_utf8)
-            SvREFCNT_dec(r->float_utf8);
+        SvREFCNT_dec(r->anchored_substr);
+        SvREFCNT_dec(r->anchored_utf8);
+        SvREFCNT_dec(r->float_substr);
+        SvREFCNT_dec(r->float_utf8);
 	Safefree(r->substrs);
     }
-    RX_MATCH_COPY_FREE(r);
+    RX_MATCH_COPY_FREE(rx);
 #ifdef PERL_OLD_COPY_ON_WRITE
-    if (r->saved_copy)
-        SvREFCNT_dec(r->saved_copy);
+    SvREFCNT_dec(r->saved_copy);
 #endif
-    Safefree(r->swap);
     Safefree(r->offs);
-    Safefree(r);
 }
 
 /*  reg_temp_copy()
@@ -9389,18 +9416,32 @@
     
     
 REGEXP *
-Perl_reg_temp_copy (pTHX_ REGEXP *r) {
-    regexp *ret;
+Perl_reg_temp_copy (pTHX_ REGEXP *ret_x, REGEXP *rx)
+{
+    struct regexp *ret;
+    struct regexp *const r = (struct regexp *)SvANY(rx);
     register const I32 npar = r->nparens+1;
 
     PERL_ARGS_ASSERT_REG_TEMP_COPY;
 
-    (void)ReREFCNT_inc(r);
-    Newx(ret, 1, regexp);
-    StructCopy(r, ret, regexp);
+    if (!ret_x)
+	ret_x = (REGEXP*) newSV_type(SVt_REGEXP);
+    ret = (struct regexp *)SvANY(ret_x);
+    
+    (void)ReREFCNT_inc(rx);
+    /* We can take advantage of the existing "copied buffer" mechanism in SVs
+       by pointing directly at the buffer, but flagging that the allocated
+       space in the copy is zero. As we've just done a struct copy, it's now
+       a case of zero-ing that, rather than copying the current length.  */
+    SvPV_set(ret_x, RX_WRAPPED(rx));
+    SvFLAGS(ret_x) |= SvFLAGS(rx) & (SVf_POK|SVp_POK|SVf_UTF8);
+    memcpy(&(ret->xpv_cur), &(r->xpv_cur),
+	   sizeof(regexp) - STRUCT_OFFSET(regexp, xpv_cur));
+    SvLEN_set(ret_x, 0);
+    SvSTASH_set(ret_x, NULL);
+    SvMAGIC_set(ret_x, NULL);
     Newx(ret->offs, npar, regexp_paren_pair);
     Copy(r->offs, ret->offs, npar, regexp_paren_pair);
-    ret->refcnt = 1;
     if (r->substrs) {
         Newx(ret->substrs, 1, struct reg_substr_data);
 	StructCopy(r->substrs, ret->substrs, struct reg_substr_data);
@@ -9413,14 +9454,13 @@
 	/* check_substr and check_utf8, if non-NULL, point to either their
 	   anchored or float namesakes, and don't hold a second reference.  */
     }
-    RX_MATCH_COPIED_off(ret);
+    RX_MATCH_COPIED_off(ret_x);
 #ifdef PERL_OLD_COPY_ON_WRITE
     ret->saved_copy = NULL;
 #endif
-    ret->mother_re = r; 
-    ret->swap = NULL;
+    ret->mother_re = rx;
     
-    return ret;
+    return ret_x;
 }
 #endif
 
@@ -9437,9 +9477,10 @@
  */
  
 void
-Perl_regfree_internal(pTHX_ REGEXP * const r)
+Perl_regfree_internal(pTHX_ REGEXP * const rx)
 {
     dVAR;
+    struct regexp *const r = (struct regexp *)SvANY(rx);
     RXi_GET_DECL(r,ri);
     GET_RE_DEBUG_FLAGS_DECL;
 
@@ -9450,8 +9491,8 @@
 	    reginitcolors();
 	{
 	    SV *dsv= sv_newmortal();
-            RE_PV_QUOTED_DECL(s, RX_UTF8(r),
-                dsv, RX_PRECOMP(r), RX_PRELEN(r), 60);
+            RE_PV_QUOTED_DECL(s, RX_UTF8(rx),
+                dsv, RX_PRECOMP(rx), RX_PRELEN(rx), 60);
             PerlIO_printf(Perl_debug_log,"%sFreeing REx:%s %s\n", 
                 PL_colors[4],PL_colors[5],s);
         }
@@ -9572,25 +9613,17 @@
 */
 #if defined(USE_ITHREADS)
 #ifndef PERL_IN_XSUB_RE
-regexp *
-Perl_re_dup(pTHX_ const regexp *r, CLONE_PARAMS *param)
+void
+Perl_re_dup_guts(pTHX_ const REGEXP *sstr, REGEXP *dstr, CLONE_PARAMS *param)
 {
     dVAR;
-    regexp *ret;
     I32 npar;
-    U32 precomp_offset;
+    const struct regexp *r = (const struct regexp *)SvANY(sstr);
+    struct regexp *ret = (struct regexp *)SvANY(dstr);
     
-    PERL_ARGS_ASSERT_RE_DUP;
-
-    if (!r)
-	return (REGEXP *)NULL;
-
-    if ((ret = (REGEXP *)ptr_table_fetch(PL_ptr_table, r)))
-	return ret;
+    PERL_ARGS_ASSERT_RE_DUP_GUTS;
 
     npar = r->nparens+1;
-    Newx(ret, 1, regexp);
-    StructCopy(r, ret, regexp);
     Newx(ret->offs, npar, regexp_paren_pair);
     Copy(r->offs, ret->offs, npar, regexp_paren_pair);
     if(ret->swap) {
@@ -9636,16 +9669,12 @@
 	}
     }
 
-    precomp_offset = RX_PRECOMP(ret) - ret->wrapped;
-
-    RX_WRAPPED(ret)     = SAVEPVN(RX_WRAPPED(ret), RX_WRAPLEN(ret)+1);
-    RX_PRECOMP(ret)     = ret->wrapped + precomp_offset;
     RXp_PAREN_NAMES(ret) = hv_dup_inc(RXp_PAREN_NAMES(ret), param);
 
     if (ret->pprivate)
-	RXi_SET(ret,CALLREGDUPE_PVT(ret,param));
+	RXi_SET(ret,CALLREGDUPE_PVT(dstr,param));
 
-    if (RX_MATCH_COPIED(ret))
+    if (RX_MATCH_COPIED(dstr))
 	ret->subbeg  = SAVEPVN(ret->subbeg, ret->sublen);
     else
 	ret->subbeg = NULL;
@@ -9653,11 +9682,21 @@
     ret->saved_copy = NULL;
 #endif
 
-    ret->mother_re      = NULL;
+    if (ret->mother_re) {
+	if (SvPVX_const(dstr) == SvPVX_const(ret->mother_re)) {
+	    /* Our storage points directly to our mother regexp, but that's
+	       1: a buffer in a different thread
+	       2: something we no longer hold a reference on
+	       so we need to copy it locally.  */
+	    /* Note we need to sue SvCUR() on our mother_re, because it, in
+	       turn, may well be pointing to its own mother_re.  */
+	    SvPV_set(dstr, SAVEPVN(SvPVX_const(ret->mother_re),
+				   SvCUR(ret->mother_re)+1));
+	    SvLEN_set(dstr, SvCUR(ret->mother_re)+1);
+	}
+	ret->mother_re      = NULL;
+    }
     ret->gofs = 0;
-    
-    ptr_table_store(PL_ptr_table, r, ret);
-    return ret;
 }
 #endif /* PERL_IN_XSUB_RE */
 
@@ -9676,9 +9715,10 @@
 */
 
 void *
-Perl_regdupe_internal(pTHX_ REGEXP * const r, CLONE_PARAMS *param)
+Perl_regdupe_internal(pTHX_ REGEXP * const rx, CLONE_PARAMS *param)
 {
     dVAR;
+    struct regexp *const r = (struct regexp *)SvANY(rx);
     regexp_internal *reti;
     int len, npar;
     RXi_GET_DECL(r,ri);
@@ -9770,47 +9810,7 @@
 
 #endif    /* USE_ITHREADS */
 
-/* 
-   reg_stringify() 
-   
-   converts a regexp embedded in a MAGIC struct to its stringified form, 
-   caching the converted form in the struct and returns the cached 
-   string. 
-
-   If lp is nonnull then it is used to return the length of the 
-   resulting string
-   
-   If flags is nonnull and the returned string contains UTF8 then 
-   (*flags & 1) will be true.
-   
-   If haseval is nonnull then it is used to return whether the pattern 
-   contains evals.
-   
-   Normally called via macro: 
-   
-        CALLREG_STRINGIFY(mg,&len,&utf8);
-        
-   And internally with
-   
-        CALLREG_AS_STR(mg,&lp,&flags,&haseval)        
-    
-   See sv_2pv_flags() in sv.c for an example of internal usage.
-    
- */
 #ifndef PERL_IN_XSUB_RE
-
-char *
-Perl_reg_stringify(pTHX_ MAGIC *mg, STRLEN *lp, U32 *flags, I32 *haseval ) {
-    dVAR;
-    const REGEXP * const re = (REGEXP *)mg->mg_obj;
-    if (haseval) 
-        *haseval = RX_SEEN_EVALS(re);
-    if (flags)    
-	*flags = RX_UTF8(re) ? 1 : 0;
-    if (lp)
-	*lp = RX_WRAPLEN(re);
-    return RX_WRAPPED(re);
-}
 
 /*
  - regnext - dig the "next" pointer out of a node
Index: src/gnu/usr.bin/perl/regcomp.h
diff -u src/gnu/usr.bin/perl/regcomp.h:1.10 src/gnu/usr.bin/perl/regcomp.h:1.11
--- regcomp.h:1.10	Mon Oct 12 18:24:21 2009
+++ regcomp.h	Fri Sep 24 15:06:43 2010
@@ -31,6 +31,7 @@
  *
  * Personally I think 5.12 should disable this for sure. Its a bit more debatable for
  * 5.10, so for now im leaving it enabled.
+ * XXX: It is now enabled for 5.11/5.12
  *
  * -demerphq
  */
@@ -196,7 +197,7 @@
 
 
 #define ANYOF_BITMAP_SIZE	32	/* 256 b/(8 b/B) */
-#define ANYOF_CLASSBITMAP_SIZE	 4	/* up to 40 (8*5) named classes */
+#define ANYOF_CLASSBITMAP_SIZE	 4	/* up to 32 (8*4) named classes */
 
 /* also used by trie */
 struct regnode_charclass {
@@ -546,10 +547,10 @@
 #define check_offset_max substrs->data[2].max_offset
 #define check_end_shift substrs->data[2].end_shift
 
-#define RX_ANCHORED_SUBSTR(rx)	((rx)->anchored_substr)
-#define RX_ANCHORED_UTF8(rx)	((rx)->anchored_utf8)
-#define RX_FLOAT_SUBSTR(rx)	((rx)->float_substr)
-#define RX_FLOAT_UTF8(rx)	((rx)->float_utf8)
+#define RX_ANCHORED_SUBSTR(rx)	(((struct regexp *)SvANY(rx))->anchored_substr)
+#define RX_ANCHORED_UTF8(rx)	(((struct regexp *)SvANY(rx))->anchored_utf8)
+#define RX_FLOAT_SUBSTR(rx)	(((struct regexp *)SvANY(rx))->float_substr)
+#define RX_FLOAT_UTF8(rx)	(((struct regexp *)SvANY(rx))->float_utf8)
 
 /* trie related stuff */
 
@@ -728,6 +729,7 @@
 #define RE_DEBUG_EXTRA_STATE       0x080000
 #define RE_DEBUG_EXTRA_OPTIMISE    0x100000
 #define RE_DEBUG_EXTRA_BUFFERS     0x400000
+#define RE_DEBUG_EXTRA_GPOS        0x800000
 /* combined */
 #define RE_DEBUG_EXTRA_STACK       0x280000
 
@@ -783,6 +785,8 @@
 #define DEBUG_TRIE_r(x) DEBUG_r( \
     if (re_debug_flags & (RE_DEBUG_COMPILE_TRIE \
         | RE_DEBUG_EXECUTE_TRIE )) x )
+#define DEBUG_GPOS_r(x) DEBUG_r( \
+    if (re_debug_flags & RE_DEBUG_EXTRA_GPOS) x )
 
 /* initialization */
 /* get_sv() can return NULL during global destruction. */
Index: src/gnu/usr.bin/perl/regexec.c
diff -u src/gnu/usr.bin/perl/regexec.c:1.13 src/gnu/usr.bin/perl/regexec.c:1.14
--- regexec.c:1.13	Tue Nov  3 14:24:09 2009
+++ regexec.c	Fri Sep 24 15:06:43 2010
@@ -117,12 +117,130 @@
 #define HOP3(pos,off,lim) (PL_reg_match_utf8 ? reghop3((U8*)(pos), off, (U8*)(lim)) : (U8*)(pos + off))
 #define HOP3c(pos,off,lim) ((char*)HOP3(pos,off,lim))
 
+/* these are unrolled below in the CCC_TRY_XXX defined */
 #define LOAD_UTF8_CHARCLASS(class,str) STMT_START { \
     if (!CAT2(PL_utf8_,class)) { bool ok; ENTER; save_re_context(); ok=CAT2(is_utf8_,class)((const U8*)str); assert(ok); LEAVE; } } STMT_END
+
+/* Doesn't do an assert to verify that is correct */
+#define LOAD_UTF8_CHARCLASS_NO_CHECK(class) STMT_START { \
+    if (!CAT2(PL_utf8_,class)) { bool ok; ENTER; save_re_context(); ok=CAT2(is_utf8_,class)((const U8*)" "); LEAVE; } } STMT_END
+
 #define LOAD_UTF8_CHARCLASS_ALNUM() LOAD_UTF8_CHARCLASS(alnum,"a")
 #define LOAD_UTF8_CHARCLASS_DIGIT() LOAD_UTF8_CHARCLASS(digit,"0")
 #define LOAD_UTF8_CHARCLASS_SPACE() LOAD_UTF8_CHARCLASS(space," ")
-#define LOAD_UTF8_CHARCLASS_MARK()  LOAD_UTF8_CHARCLASS(mark, "\xcd\x86")
+
+#define LOAD_UTF8_CHARCLASS_GCB()  /* Grapheme cluster boundaries */        \
+	LOAD_UTF8_CHARCLASS(X_begin, " ");                                  \
+	LOAD_UTF8_CHARCLASS(X_non_hangul, "A");                             \
+	/* These are utf8 constants, and not utf-ebcdic constants, so the   \
+	    * assert should likely and hopefully fail on an EBCDIC machine */ \
+	LOAD_UTF8_CHARCLASS(X_extend, "\xcc\x80"); /* U+0300 */             \
+									    \
+	/* No asserts are done for these, in case called on an early        \
+	    * Unicode version in which they map to nothing */               \
+	LOAD_UTF8_CHARCLASS_NO_CHECK(X_prepend);/* U+0E40 "\xe0\xb9\x80" */ \
+	LOAD_UTF8_CHARCLASS_NO_CHECK(X_L);	    /* U+1100 "\xe1\x84\x80" */ \
+	LOAD_UTF8_CHARCLASS_NO_CHECK(X_LV);     /* U+AC00 "\xea\xb0\x80" */ \
+	LOAD_UTF8_CHARCLASS_NO_CHECK(X_LVT);    /* U+AC01 "\xea\xb0\x81" */ \
+	LOAD_UTF8_CHARCLASS_NO_CHECK(X_LV_LVT_V);/* U+AC01 "\xea\xb0\x81" */\
+	LOAD_UTF8_CHARCLASS_NO_CHECK(X_T);      /* U+11A8 "\xe1\x86\xa8" */ \
+	LOAD_UTF8_CHARCLASS_NO_CHECK(X_V)       /* U+1160 "\xe1\x85\xa0" */  
+
+/* 
+   We dont use PERL_LEGACY_UNICODE_CHARCLASS_MAPPINGS as the direct test
+   so that it is possible to override the option here without having to 
+   rebuild the entire core. as we are required to do if we change regcomp.h
+   which is where PERL_LEGACY_UNICODE_CHARCLASS_MAPPINGS is defined.
+*/
+#if PERL_LEGACY_UNICODE_CHARCLASS_MAPPINGS
+#define BROKEN_UNICODE_CHARCLASS_MAPPINGS
+#endif
+
+#ifdef BROKEN_UNICODE_CHARCLASS_MAPPINGS
+#define LOAD_UTF8_CHARCLASS_PERL_WORD()   LOAD_UTF8_CHARCLASS_ALNUM()
+#define LOAD_UTF8_CHARCLASS_PERL_SPACE()  LOAD_UTF8_CHARCLASS_SPACE()
+#define LOAD_UTF8_CHARCLASS_POSIX_DIGIT() LOAD_UTF8_CHARCLASS_DIGIT()
+#define RE_utf8_perl_word   PL_utf8_alnum
+#define RE_utf8_perl_space  PL_utf8_space
+#define RE_utf8_posix_digit PL_utf8_digit
+#define perl_word  alnum
+#define perl_space space
+#define posix_digit digit
+#else
+#define LOAD_UTF8_CHARCLASS_PERL_WORD()   LOAD_UTF8_CHARCLASS(perl_word,"a")
+#define LOAD_UTF8_CHARCLASS_PERL_SPACE()  LOAD_UTF8_CHARCLASS(perl_space," ")
+#define LOAD_UTF8_CHARCLASS_POSIX_DIGIT() LOAD_UTF8_CHARCLASS(posix_digit,"0")
+#define RE_utf8_perl_word   PL_utf8_perl_word
+#define RE_utf8_perl_space  PL_utf8_perl_space
+#define RE_utf8_posix_digit PL_utf8_posix_digit
+#endif
+
+
+#define CCC_TRY_AFF(NAME,NAMEL,CLASS,STR,LCFUNC_utf8,FUNC,LCFUNC)                          \
+        case NAMEL:                                                              \
+            PL_reg_flags |= RF_tainted;                                                 \
+            /* FALL THROUGH */                                                          \
+        case NAME:                                                                     \
+            if (!nextchr)                                                               \
+                sayNO;                                                                  \
+            if (do_utf8 && UTF8_IS_CONTINUED(nextchr)) {                                \
+                if (!CAT2(PL_utf8_,CLASS)) {                                            \
+                    bool ok;                                                            \
+                    ENTER;                                                              \
+                    save_re_context();                                                  \
+                    ok=CAT2(is_utf8_,CLASS)((const U8*)STR);                            \
+                    assert(ok);                                                         \
+                    LEAVE;                                                              \
+                }                                                                       \
+                if (!(OP(scan) == NAME                                                  \
+                    ? (bool)swash_fetch(CAT2(PL_utf8_,CLASS), (U8*)locinput, do_utf8)   \
+                    : LCFUNC_utf8((U8*)locinput)))                                      \
+                {                                                                       \
+                    sayNO;                                                              \
+                }                                                                       \
+                locinput += PL_utf8skip[nextchr];                                       \
+                nextchr = UCHARAT(locinput);                                            \
+                break;                                                                  \
+            }                                                                           \
+            if (!(OP(scan) == NAME ? FUNC(nextchr) : LCFUNC(nextchr)))                  \
+                sayNO;                                                                  \
+            nextchr = UCHARAT(++locinput);                                              \
+            break
+
+#define CCC_TRY_NEG(NAME,NAMEL,CLASS,STR,LCFUNC_utf8,FUNC,LCFUNC)                        \
+        case NAMEL:                                                              \
+            PL_reg_flags |= RF_tainted;                                                 \
+            /* FALL THROUGH */                                                          \
+        case NAME :                                                                     \
+            if (!nextchr && locinput >= PL_regeol)                                      \
+                sayNO;                                                                  \
+            if (do_utf8 && UTF8_IS_CONTINUED(nextchr)) {                                \
+                if (!CAT2(PL_utf8_,CLASS)) {                                            \
+                    bool ok;                                                            \
+                    ENTER;                                                              \
+                    save_re_context();                                                  \
+                    ok=CAT2(is_utf8_,CLASS)((const U8*)STR);                            \
+                    assert(ok);                                                         \
+                    LEAVE;                                                              \
+                }                                                                       \
+                if ((OP(scan) == NAME                                                  \
+                    ? (bool)swash_fetch(CAT2(PL_utf8_,CLASS), (U8*)locinput, do_utf8)    \
+                    : LCFUNC_utf8((U8*)locinput)))                                      \
+                {                                                                       \
+                    sayNO;                                                              \
+                }                                                                       \
+                locinput += PL_utf8skip[nextchr];                                       \
+                nextchr = UCHARAT(locinput);                                            \
+                break;                                                                  \
+            }                                                                           \
+            if ((OP(scan) == NAME ? FUNC(nextchr) : LCFUNC(nextchr)))                   \
+                sayNO;                                                                  \
+            nextchr = UCHARAT(++locinput);                                              \
+            break
+
+
+
+
 
 /* TODO: Combine JUMPABLE and HAS_TEXT to cache OP(rn) */
 
@@ -379,10 +497,11 @@
    deleted from the finite automaton. */
 
 char *
-Perl_re_intuit_start(pTHX_ REGEXP * const prog, SV *sv, char *strpos,
+Perl_re_intuit_start(pTHX_ REGEXP * const rx, SV *sv, char *strpos,
 		     char *strend, const U32 flags, re_scream_pos_data *data)
 {
     dVAR;
+    struct regexp *const prog = (struct regexp *)SvANY(rx);
     register I32 start_shift = 0;
     /* Should be nonnegative! */
     register I32 end_shift   = 0;
@@ -403,13 +522,13 @@
 
     PERL_ARGS_ASSERT_RE_INTUIT_START;
 
-    RX_MATCH_UTF8_set(prog,do_utf8);
+    RX_MATCH_UTF8_set(rx,do_utf8);
 
-    if (RX_UTF8(prog)) {
+    if (RX_UTF8(rx)) {
 	PL_reg_flags |= RF_utf8;
     }
     DEBUG_EXECUTE_r( 
-        debug_start_match(prog, do_utf8, strpos, strend, 
+        debug_start_match(rx, do_utf8, strpos, strend, 
             sv ? "Guessing start of match in sv for"
                : "Guessing start of match in string for");
 	      );
@@ -862,9 +981,9 @@
 	{
 	    /* If flags & SOMETHING - do not do it many times on the same match */
 	    DEBUG_EXECUTE_r(PerlIO_printf(Perl_debug_log, "... Disabling check substring...\n"));
+	    /* XXX Does the destruction order has to change with do_utf8? */
 	    SvREFCNT_dec(do_utf8 ? prog->check_utf8 : prog->check_substr);
-	    if (do_utf8 ? prog->check_substr : prog->check_utf8)
-		SvREFCNT_dec(do_utf8 ? prog->check_substr : prog->check_utf8);
+	    SvREFCNT_dec(do_utf8 ? prog->check_substr : prog->check_utf8);
 	    prog->check_substr = prog->check_utf8 = NULL;	/* disable */
 	    prog->float_substr = prog->float_utf8 = NULL;	/* clear */
 	    check = NULL;			/* abort */
@@ -1420,8 +1539,8 @@
 	    break;
 	case ALNUM:
 	    REXEC_FBC_CSCAN_PRELOAD(
-		LOAD_UTF8_CHARCLASS_ALNUM(),
-		swash_fetch(PL_utf8_alnum, (U8*)s, do_utf8),
+		LOAD_UTF8_CHARCLASS_PERL_WORD(),
+		swash_fetch(RE_utf8_perl_word, (U8*)s, do_utf8),
 		isALNUM(*s)
 	    );
 	case ALNUML:
@@ -1431,8 +1550,8 @@
 	    );
 	case NALNUM:
 	    REXEC_FBC_CSCAN_PRELOAD(
-		LOAD_UTF8_CHARCLASS_ALNUM(),
-		!swash_fetch(PL_utf8_alnum, (U8*)s, do_utf8),
+		LOAD_UTF8_CHARCLASS_PERL_WORD(),
+		!swash_fetch(RE_utf8_perl_word, (U8*)s, do_utf8),
 		!isALNUM(*s)
 	    );
 	case NALNUML:
@@ -1442,8 +1561,8 @@
 	    );
 	case SPACE:
 	    REXEC_FBC_CSCAN_PRELOAD(
-		LOAD_UTF8_CHARCLASS_SPACE(),
-		*s == ' ' || swash_fetch(PL_utf8_space,(U8*)s, do_utf8),
+		LOAD_UTF8_CHARCLASS_PERL_SPACE(),
+		*s == ' ' || swash_fetch(RE_utf8_perl_space,(U8*)s, do_utf8),
 		isSPACE(*s)
 	    );
 	case SPACEL:
@@ -1453,8 +1572,8 @@
 	    );
 	case NSPACE:
 	    REXEC_FBC_CSCAN_PRELOAD(
-		LOAD_UTF8_CHARCLASS_SPACE(),
-		!(*s == ' ' || swash_fetch(PL_utf8_space,(U8*)s, do_utf8)),
+		LOAD_UTF8_CHARCLASS_PERL_SPACE(),
+		!(*s == ' ' || swash_fetch(RE_utf8_perl_space,(U8*)s, do_utf8)),
 		!isSPACE(*s)
 	    );
 	case NSPACEL:
@@ -1464,8 +1583,8 @@
 	    );
 	case DIGIT:
 	    REXEC_FBC_CSCAN_PRELOAD(
-		LOAD_UTF8_CHARCLASS_DIGIT(),
-		swash_fetch(PL_utf8_digit,(U8*)s, do_utf8),
+		LOAD_UTF8_CHARCLASS_POSIX_DIGIT(),
+		swash_fetch(RE_utf8_posix_digit,(U8*)s, do_utf8),
 		isDIGIT(*s)
 	    );
 	case DIGITL:
@@ -1475,8 +1594,8 @@
 	    );
 	case NDIGIT:
 	    REXEC_FBC_CSCAN_PRELOAD(
-		LOAD_UTF8_CHARCLASS_DIGIT(),
-		!swash_fetch(PL_utf8_digit,(U8*)s, do_utf8),
+		LOAD_UTF8_CHARCLASS_POSIX_DIGIT(),
+		!swash_fetch(RE_utf8_posix_digit,(U8*)s, do_utf8),
 		!isDIGIT(*s)
 	    );
 	case NDIGITL:
@@ -1728,34 +1847,12 @@
 	return s;
 }
 
-static void 
-S_swap_match_buff (pTHX_ regexp *prog)
-{
-    regexp_paren_pair *t;
-
-    PERL_ARGS_ASSERT_SWAP_MATCH_BUFF;
-
-    if (!prog->swap) {
-    /* We have to be careful. If the previous successful match
-       was from this regex we don't want a subsequent paritally
-       successful match to clobber the old results. 
-       So when we detect this possibility we add a swap buffer
-       to the re, and switch the buffer each match. If we fail
-       we switch it back, otherwise we leave it swapped.
-    */
-        Newxz(prog->swap, (prog->nparens + 1), regexp_paren_pair);
-    }
-    t = prog->swap;
-    prog->swap = prog->offs;
-    prog->offs = t;
-}    
-
 
 /*
  - regexec_flags - match a regexp against a string
  */
 I32
-Perl_regexec_flags(pTHX_ REGEXP * const prog, char *stringarg, register char *strend,
+Perl_regexec_flags(pTHX_ REGEXP * const rx, char *stringarg, register char *strend,
 	      char *strbeg, I32 minend, SV *sv, void *data, U32 flags)
 /* strend: pointer to null at end of string */
 /* strbeg: real beginning of string */
@@ -1766,6 +1863,7 @@
 /* nosave: For optimizations. */
 {
     dVAR;
+    struct regexp *const prog = (struct regexp *)SvANY(rx);
     /*register*/ char *s;
     register regnode *c;
     /*register*/ char *startpos = stringarg;
@@ -1778,7 +1876,7 @@
     I32 multiline;
     RXi_GET_DECL(prog,progi);
     regmatch_info reginfo;  /* create some info to pass to regtry etc */
-    bool swap_on_fail = 0;
+    regexp_paren_pair *swap = NULL;
     GET_RE_DEBUG_FLAGS_DECL;
 
     PERL_ARGS_ASSERT_REGEXEC_FLAGS;
@@ -1791,11 +1889,11 @@
     }
 
     multiline = prog->extflags & RXf_PMf_MULTILINE;
-    reginfo.prog = prog;
+    reginfo.prog = rx;	 /* Yes, sorry that this is confusing.  */
 
-    RX_MATCH_UTF8_set(prog, do_utf8);
+    RX_MATCH_UTF8_set(rx, do_utf8);
     DEBUG_EXECUTE_r( 
-        debug_start_match(prog, do_utf8, startpos, strend, 
+        debug_start_match(rx, do_utf8, startpos, strend, 
         "Matching");
     );
 
@@ -1817,7 +1915,7 @@
     PL_reg_eval_set = 0;
     PL_reg_maxiter = 0;
 
-    if (RX_UTF8(prog))
+    if (RX_UTF8(rx))
 	PL_reg_flags |= RF_utf8;
 
     /* Mark beginning of line for ^ and lookbehind. */
@@ -1836,36 +1934,57 @@
 
     if (prog->extflags & RXf_GPOS_SEEN) { /* Need to set reginfo->ganch */
 	MAGIC *mg;
-
-	if (flags & REXEC_IGNOREPOS)	/* Means: check only at start */
+	if (flags & REXEC_IGNOREPOS){	/* Means: check only at start */
 	    reginfo.ganch = startpos + prog->gofs;
-	else if (sv && SvTYPE(sv) >= SVt_PVMG
+	    DEBUG_GPOS_r(PerlIO_printf(Perl_debug_log,
+	      "GPOS IGNOREPOS: reginfo.ganch = startpos + %"UVxf"\n",(UV)prog->gofs));
+	} else if (sv && SvTYPE(sv) >= SVt_PVMG
 		  && SvMAGIC(sv)
 		  && (mg = mg_find(sv, PERL_MAGIC_regex_global))
 		  && mg->mg_len >= 0) {
 	    reginfo.ganch = strbeg + mg->mg_len;	/* Defined pos() */
+	    DEBUG_GPOS_r(PerlIO_printf(Perl_debug_log,
+		"GPOS MAGIC: reginfo.ganch = strbeg + %"IVdf"\n",(IV)mg->mg_len));
+
 	    if (prog->extflags & RXf_ANCH_GPOS) {
 	        if (s > reginfo.ganch)
 		    goto phooey;
 		s = reginfo.ganch - prog->gofs;
+	        DEBUG_GPOS_r(PerlIO_printf(Perl_debug_log,
+		     "GPOS ANCH_GPOS: s = ganch - %"UVxf"\n",(UV)prog->gofs));
+		if (s < strbeg)
+		    goto phooey;
 	    }
 	}
 	else if (data) {
 	    reginfo.ganch = strbeg + PTR2UV(data);
-	} else				/* pos() not defined */
+            DEBUG_GPOS_r(PerlIO_printf(Perl_debug_log,
+		 "GPOS DATA: reginfo.ganch= strbeg + %"UVxf"\n",PTR2UV(data)));
+
+	} else {				/* pos() not defined */
 	    reginfo.ganch = strbeg;
+            DEBUG_GPOS_r(PerlIO_printf(Perl_debug_log,
+		 "GPOS: reginfo.ganch = strbeg\n"));
+	}
     }
-    if (PL_curpm && (PM_GETRE(PL_curpm) == prog)) {
-        swap_on_fail = 1;
-        swap_match_buff(prog); /* do we need a save destructor here for
-                                  eval dies? */
+    if (PL_curpm && (PM_GETRE(PL_curpm) == rx)) {
+        /* We have to be careful. If the previous successful match
+           was from this regex we don't want a subsequent partially
+           successful match to clobber the old results.
+           So when we detect this possibility we add a swap buffer
+           to the re, and switch the buffer each match. If we fail
+           we switch it back, otherwise we leave it swapped.
+        */
+        swap = prog->offs;
+        /* do we need a save destructor here for eval dies? */
+        Newxz(prog->offs, (prog->nparens + 1), regexp_paren_pair);
     }
     if (!(flags & REXEC_CHECKED) && (prog->check_substr != NULL || prog->check_utf8 != NULL)) {
 	re_scream_pos_data d;
 
 	d.scream_olds = &scream_olds;
 	d.scream_pos = &scream_pos;
-	s = re_intuit_start(prog, sv, s, strend, flags, &d);
+	s = re_intuit_start(rx, sv, s, strend, flags, &d);
 	if (!s) {
 	    DEBUG_EXECUTE_r(PerlIO_printf(Perl_debug_log, "Not present...\n"));
 	    goto phooey;	/* not present */
@@ -1889,33 +2008,68 @@
 	    end = HOP3c(strend, -dontbother, strbeg) - 1;
 	    /* for multiline we only have to try after newlines */
 	    if (prog->check_substr || prog->check_utf8) {
-		if (s == startpos)
-		    goto after_try;
-		while (1) {
-		    if (regtry(&reginfo, &s))
-			goto got_it;
-		  after_try:
-		    if (s > end)
-			goto phooey;
-		    if (prog->extflags & RXf_USE_INTUIT) {
-			s = re_intuit_start(prog, sv, s + 1, strend, flags, NULL);
-			if (!s)
-			    goto phooey;
-		    }
-		    else
-			s++;
-		}		
-	    } else {
-		if (s > startpos)
+                /* because of the goto we can not easily reuse the macros for bifurcating the
+                   unicode/non-unicode match modes here like we do elsewhere - demerphq */
+                if (do_utf8) {
+                    if (s == startpos)
+                        goto after_try_utf8;
+                    while (1) {
+                        if (regtry(&reginfo, &s)) {
+                            goto got_it;
+                        }
+                      after_try_utf8:
+                        if (s > end) {
+                            goto phooey;
+                        }
+                        if (prog->extflags & RXf_USE_INTUIT) {
+                            s = re_intuit_start(rx, sv, s + UTF8SKIP(s), strend, flags, NULL);
+                            if (!s) {
+                                goto phooey;
+                            }
+                        }
+                        else {
+                            s += UTF8SKIP(s);
+                        }
+                    }
+                } /* end search for check string in unicode */
+                else {
+                    if (s == startpos) {
+                        goto after_try_latin;
+                    }
+                    while (1) {
+                        if (regtry(&reginfo, &s)) {
+                            goto got_it;
+                        }
+                      after_try_latin:
+                        if (s > end) {
+                            goto phooey;
+                        }
+                        if (prog->extflags & RXf_USE_INTUIT) {
+                            s = re_intuit_start(rx, sv, s + 1, strend, flags, NULL);
+                            if (!s) {
+                                goto phooey;
+                            }
+                        }
+                        else {
+                            s++;
+                        }
+                    }
+                } /* end search for check string in latin*/
+	    } /* end search for check string */
+	    else { /* search for newline */
+		if (s > startpos) {
+                    /*XXX: The s-- is almost definitely wrong here under unicode - demeprhq*/
 		    s--;
+		}
+                /* We can use a more efficient search as newlines are the same in unicode as they are in latin */
 		while (s < end) {
 		    if (*s++ == '\n') {	/* don't need PL_utf8skip here */
 			if (regtry(&reginfo, &s))
 			    goto got_it;
 		    }
-		}		
-	    }
-	}
+		}
+	    } /* end search for newline */
+	} /* end anchored/multiline check string search */
 	goto phooey;
     } else if (RXf_GPOS_CHECK == (prog->extflags & RXf_GPOS_CHECK)) 
     {
@@ -1923,7 +2077,8 @@
            is bogus -- we set it above, when prog->extflags & RXf_GPOS_SEEN 
            and we only enter this block when the same bit is set. */
         char *tmp_s = reginfo.ganch - prog->gofs;
-	if (regtry(&reginfo, &tmp_s))
+
+	if (tmp_s >= strbeg && regtry(&reginfo, &tmp_s))
 	    goto got_it;
 	goto phooey;
     }
@@ -2157,7 +2312,8 @@
     goto phooey;
 
 got_it:
-    RX_MATCH_TAINTED_set(prog, PL_reg_flags & RF_tainted);
+    Safefree(swap);
+    RX_MATCH_TAINTED_set(rx, PL_reg_flags & RF_tainted);
 
     if (PL_reg_eval_set)
 	restore_pos(aTHX_ prog);
@@ -2166,7 +2322,7 @@
 
     /* make sure $`, $&, $', and $digit will work later */
     if ( !(flags & REXEC_NOT_FIRST) ) {
-	RX_MATCH_COPY_FREE(prog);
+	RX_MATCH_COPY_FREE(rx);
 	if (flags & REXEC_COPY_STR) {
 	    const I32 i = PL_regeol - startpos + (stringarg - strbeg);
 #ifdef PERL_OLD_COPY_ON_WRITE
@@ -2183,7 +2339,7 @@
 	    } else
 #endif
 	    {
-		RX_MATCH_COPIED_on(prog);
+		RX_MATCH_COPIED_on(rx);
 		s = savepvn(strbeg, i);
 		prog->subbeg = s;
 	    }
@@ -2202,10 +2358,12 @@
 			  PL_colors[4], PL_colors[5]));
     if (PL_reg_eval_set)
 	restore_pos(aTHX_ prog);
-    if (swap_on_fail) 
+    if (swap) {
         /* we failed :-( roll it back */
-        swap_match_buff(prog);
-    
+        Safefree(prog->offs);
+        prog->offs = swap;
+    }
+
     return 0;
 }
 
@@ -2218,7 +2376,8 @@
 {
     dVAR;
     CHECKPOINT lastcp;
-    regexp *prog = reginfo->prog;
+    REGEXP *const rx = reginfo->prog;
+    regexp *const prog = (struct regexp *)SvANY(rx);
     RXi_GET_DECL(prog,progi);
     GET_RE_DEBUG_FLAGS_DECL;
 
@@ -2268,10 +2427,10 @@
 	    Newxz(PL_reg_curpm, 1, PMOP);
 #ifdef USE_ITHREADS
             {
-		SV* const repointer = newSViv(0);
+		SV* const repointer = &PL_sv_undef;
                 /* this regexp is also owned by the new PL_reg_curpm, which
 		   will try to free it.  */
-                av_push(PL_regex_padav,repointer);
+                av_push(PL_regex_padav, repointer);
                 PL_reg_curpm->op_pmoffset = av_len(PL_regex_padav);
                 PL_regex_pad = AvARRAY(PL_regex_padav);
             }
@@ -2284,9 +2443,9 @@
 	/* This is safe against NULLs: */
 	ReREFCNT_dec(PM_GETRE(PL_reg_curpm));
 	/* PM_reg_curpm owns a reference to this regexp.  */
-	ReREFCNT_inc(prog);
+	ReREFCNT_inc(rx);
 #endif
-	PM_SETRE(PL_reg_curpm, prog);
+	PM_SETRE(PL_reg_curpm, rx);
 	PL_reg_oldcurpm = PL_curpm;
 	PL_curpm = PL_reg_curpm;
 	if (RXp_MATCH_COPIED(prog)) {
@@ -2729,7 +2888,8 @@
     dVAR;
     register const bool do_utf8 = PL_reg_match_utf8;
     const U32 uniflags = UTF8_ALLOW_DEFAULT;
-    regexp *rex = reginfo->prog;
+    REGEXP *rex_sv = reginfo->prog;
+    regexp *rex = (struct regexp *)SvANY(rex_sv);
     RXi_GET_DECL(rex,rexi);
     I32	oldsave;
     /* the current state. This is a cached copy of PL_regmatch_state */
@@ -3332,85 +3492,6 @@
 	    nextchr = UCHARAT(locinput);
 	    break;
 	    }
-	case ANYOF:
-	    if (do_utf8) {
-	        STRLEN inclasslen = PL_regeol - locinput;
-
-	        if (!reginclass(rex, scan, (U8*)locinput, &inclasslen, do_utf8))
-		    goto anyof_fail;
-		if (locinput >= PL_regeol)
-		    sayNO;
-		locinput += inclasslen ? inclasslen : UTF8SKIP(locinput);
-		nextchr = UCHARAT(locinput);
-		break;
-	    }
-	    else {
-		if (nextchr < 0)
-		    nextchr = UCHARAT(locinput);
-		if (!REGINCLASS(rex, scan, (U8*)locinput))
-		    goto anyof_fail;
-		if (!nextchr && locinput >= PL_regeol)
-		    sayNO;
-		nextchr = UCHARAT(++locinput);
-		break;
-	    }
-	anyof_fail:
-	    /* If we might have the case of the German sharp s
-	     * in a casefolding Unicode character class. */
-
-	    if (ANYOF_FOLD_SHARP_S(scan, locinput, PL_regeol)) {
-		 locinput += SHARP_S_SKIP;
-		 nextchr = UCHARAT(locinput);
-	    }
-	    else
-		 sayNO;
-	    break;
-	case ALNUML:
-	    PL_reg_flags |= RF_tainted;
-	    /* FALL THROUGH */
-	case ALNUM:
-	    if (!nextchr)
-		sayNO;
-	    if (do_utf8) {
-		LOAD_UTF8_CHARCLASS_ALNUM();
-		if (!(OP(scan) == ALNUM
-		      ? (bool)swash_fetch(PL_utf8_alnum, (U8*)locinput, do_utf8)
-		      : isALNUM_LC_utf8((U8*)locinput)))
-		{
-		    sayNO;
-		}
-		locinput += PL_utf8skip[nextchr];
-		nextchr = UCHARAT(locinput);
-		break;
-	    }
-	    if (!(OP(scan) == ALNUM
-		  ? isALNUM(nextchr) : isALNUM_LC(nextchr)))
-		sayNO;
-	    nextchr = UCHARAT(++locinput);
-	    break;
-	case NALNUML:
-	    PL_reg_flags |= RF_tainted;
-	    /* FALL THROUGH */
-	case NALNUM:
-	    if (!nextchr && locinput >= PL_regeol)
-		sayNO;
-	    if (do_utf8) {
-		LOAD_UTF8_CHARCLASS_ALNUM();
-		if (OP(scan) == NALNUM
-		    ? (bool)swash_fetch(PL_utf8_alnum, (U8*)locinput, do_utf8)
-		    : isALNUM_LC_utf8((U8*)locinput))
-		{
-		    sayNO;
-		}
-		locinput += PL_utf8skip[nextchr];
-		nextchr = UCHARAT(locinput);
-		break;
-	    }
-	    if (OP(scan) == NALNUM
-		? isALNUM(nextchr) : isALNUM_LC(nextchr))
-		sayNO;
-	    nextchr = UCHARAT(++locinput);
-	    break;
 	case BOUNDL:
 	case NBOUNDL:
 	    PL_reg_flags |= RF_tainted;
@@ -3423,7 +3504,7 @@
 		    ln = '\n';
 		else {
 		    const U8 * const r = reghop3((U8*)locinput, -1, (U8*)PL_bostr);
-		
+
 		    ln = utf8n_to_uvchr(r, UTF8SKIP(r), 0, uniflags);
 		}
 		if (OP(scan) == BOUND || OP(scan) == NBOUND) {
@@ -3452,122 +3533,259 @@
 				    OP(scan) == BOUNDL))
 		    sayNO;
 	    break;
-	case SPACEL:
-	    PL_reg_flags |= RF_tainted;
-	    /* FALL THROUGH */
-	case SPACE:
-	    if (!nextchr)
-		sayNO;
+	case ANYOF:
 	    if (do_utf8) {
-		if (UTF8_IS_CONTINUED(nextchr)) {
-		    LOAD_UTF8_CHARCLASS_SPACE();
-		    if (!(OP(scan) == SPACE
-			  ? (bool)swash_fetch(PL_utf8_space, (U8*)locinput, do_utf8)
-			  : isSPACE_LC_utf8((U8*)locinput)))
-		    {
-			sayNO;
-		    }
-		    locinput += PL_utf8skip[nextchr];
-		    nextchr = UCHARAT(locinput);
-		    break;
-		}
-		if (!(OP(scan) == SPACE
-		      ? isSPACE(nextchr) : isSPACE_LC(nextchr)))
+	        STRLEN inclasslen = PL_regeol - locinput;
+
+	        if (!reginclass(rex, scan, (U8*)locinput, &inclasslen, do_utf8))
+		    goto anyof_fail;
+		if (locinput >= PL_regeol)
 		    sayNO;
-		nextchr = UCHARAT(++locinput);
+		locinput += inclasslen ? inclasslen : UTF8SKIP(locinput);
+		nextchr = UCHARAT(locinput);
+		break;
 	    }
 	    else {
-		if (!(OP(scan) == SPACE
-		      ? isSPACE(nextchr) : isSPACE_LC(nextchr)))
+		if (nextchr < 0)
+		    nextchr = UCHARAT(locinput);
+		if (!REGINCLASS(rex, scan, (U8*)locinput))
+		    goto anyof_fail;
+		if (!nextchr && locinput >= PL_regeol)
 		    sayNO;
 		nextchr = UCHARAT(++locinput);
-	    }
-	    break;
-	case NSPACEL:
-	    PL_reg_flags |= RF_tainted;
-	    /* FALL THROUGH */
-	case NSPACE:
-	    if (!nextchr && locinput >= PL_regeol)
-		sayNO;
-	    if (do_utf8) {
-		LOAD_UTF8_CHARCLASS_SPACE();
-		if (OP(scan) == NSPACE
-		    ? (bool)swash_fetch(PL_utf8_space, (U8*)locinput, do_utf8)
-		    : isSPACE_LC_utf8((U8*)locinput))
-		{
-		    sayNO;
-		}
-		locinput += PL_utf8skip[nextchr];
-		nextchr = UCHARAT(locinput);
 		break;
 	    }
-	    if (OP(scan) == NSPACE
-		? isSPACE(nextchr) : isSPACE_LC(nextchr))
-		sayNO;
-	    nextchr = UCHARAT(++locinput);
-	    break;
-	case DIGITL:
-	    PL_reg_flags |= RF_tainted;
-	    /* FALL THROUGH */
-	case DIGIT:
-	    if (!nextchr)
-		sayNO;
-	    if (do_utf8) {
-		LOAD_UTF8_CHARCLASS_DIGIT();
-		if (!(OP(scan) == DIGIT
-		      ? (bool)swash_fetch(PL_utf8_digit, (U8*)locinput, do_utf8)
-		      : isDIGIT_LC_utf8((U8*)locinput)))
-		{
-		    sayNO;
-		}
-		locinput += PL_utf8skip[nextchr];
-		nextchr = UCHARAT(locinput);
-		break;
+	anyof_fail:
+	    /* If we might have the case of the German sharp s
+	     * in a casefolding Unicode character class. */
+
+	    if (ANYOF_FOLD_SHARP_S(scan, locinput, PL_regeol)) {
+		 locinput += SHARP_S_SKIP;
+		 nextchr = UCHARAT(locinput);
 	    }
-	    if (!(OP(scan) == DIGIT
-		  ? isDIGIT(nextchr) : isDIGIT_LC(nextchr)))
-		sayNO;
-	    nextchr = UCHARAT(++locinput);
+	    else
+		 sayNO;
 	    break;
-	case NDIGITL:
-	    PL_reg_flags |= RF_tainted;
-	    /* FALL THROUGH */
-	case NDIGIT:
-	    if (!nextchr && locinput >= PL_regeol)
+	/* Special char classes - The defines start on line 129 or so */
+	CCC_TRY_AFF( ALNUM,  ALNUML, perl_word,   "a", isALNUM_LC_utf8, isALNUM, isALNUM_LC);
+	CCC_TRY_NEG(NALNUM, NALNUML, perl_word,   "a", isALNUM_LC_utf8, isALNUM, isALNUM_LC);
+
+	CCC_TRY_AFF( SPACE,  SPACEL, perl_space,  " ", isSPACE_LC_utf8, isSPACE, isSPACE_LC);
+	CCC_TRY_NEG(NSPACE, NSPACEL, perl_space,  " ", isSPACE_LC_utf8, isSPACE, isSPACE_LC);
+
+	CCC_TRY_AFF( DIGIT,  DIGITL, posix_digit, "0", isDIGIT_LC_utf8, isDIGIT, isDIGIT_LC);
+	CCC_TRY_NEG(NDIGIT, NDIGITL, posix_digit, "0", isDIGIT_LC_utf8, isDIGIT, isDIGIT_LC);
+
+	case CLUMP: /* Match \X: logical Unicode character.  This is defined as
+		       a Unicode extended Grapheme Cluster */
+	    /* From http://www.unicode.org/reports/tr29 (5.2 version).  An
+	      extended Grapheme Cluster is:
+
+	       CR LF
+	       | Prepend* Begin Extend*
+	       | .
+
+	       Begin is (Hangul-syllable | ! Control)
+	       Extend is (Grapheme_Extend | Spacing_Mark)
+	       Control is [ GCB_Control CR LF ]
+
+	       The discussion below shows how the code for CLUMP is derived
+	       from this regex.  Note that most of these concepts are from
+	       property values of the Grapheme Cluster Boundary (GCB) property.
+	       No code point can have multiple property values for a given
+	       property.  Thus a code point in Prepend can't be in Control, but
+	       it must be in !Control.  This is why Control above includes
+	       GCB_Control plus CR plus LF.  The latter two are used in the GCB
+	       property separately, and so can't be in GCB_Control, even though
+	       they logically are controls.  Control is not the same as gc=cc,
+	       but includes format and other characters as well.
+
+	       The Unicode definition of Hangul-syllable is:
+		   L+
+		   | (L* ( ( V | LV ) V* | LVT ) T*)
+		   | T+ 
+		  )
+	       Each of these is a value for the GCB property, and hence must be
+	       disjoint, so the order they are tested is immaterial, so the
+	       above can safely be changed to
+		   T+
+		   | L+
+		   | (L* ( LVT | ( V | LV ) V*) T*)
+
+	       The last two terms can be combined like this:
+		   L* ( L
+		        | (( LVT | ( V | LV ) V*) T*))
+
+	       And refactored into this:
+		   L* (L | LVT T* | V  V* T* | LV  V* T*)
+
+	       That means that if we have seen any L's at all we can quit
+	       there, but if the next character is a LVT, a V or and LV we
+	       should keep going.
+
+	       There is a subtlety with Prepend* which showed up in testing.
+	       Note that the Begin, and only the Begin is required in:
+	        | Prepend* Begin Extend*
+	       Also, Begin contains '! Control'.  A Prepend must be a '!
+	       Control', which means it must be a Begin.  What it comes down to
+	       is that if we match Prepend* and then find no suitable Begin
+	       afterwards, that if we backtrack the last Prepend, that one will
+	       be a suitable Begin.
+	    */
+
+	    if (locinput >= PL_regeol)
 		sayNO;
-	    if (do_utf8) {
-		LOAD_UTF8_CHARCLASS_DIGIT();
-		if (OP(scan) == NDIGIT
-		    ? (bool)swash_fetch(PL_utf8_digit, (U8*)locinput, do_utf8)
-		    : isDIGIT_LC_utf8((U8*)locinput))
-		{
-		    sayNO;
+	    if  (! do_utf8) {
+
+		/* Match either CR LF  or '.', as all the other possibilities
+		 * require utf8 */
+		locinput++;	    /* Match the . or CR */
+		if (nextchr == '\r'
+		    && locinput < PL_regeol
+		    && UCHARAT(locinput) == '\n') locinput++;
+	    }
+	    else {
+
+		/* Utf8: See if is ( CR LF ); already know that locinput <
+		 * PL_regeol, so locinput+1 is in bounds */
+		if (nextchr == '\r' && UCHARAT(locinput + 1) == '\n') {
+		    locinput += 2;
 		}
-		locinput += PL_utf8skip[nextchr];
-		nextchr = UCHARAT(locinput);
-		break;
+		else {
+		    /* In case have to backtrack to beginning, then match '.' */
+		    char *starting = locinput;
+
+		    /* In case have to backtrack the last prepend */
+		    char *previous_prepend = 0;
+
+		    LOAD_UTF8_CHARCLASS_GCB();
+
+		    /* Match (prepend)* */
+		    while (locinput < PL_regeol
+			   && swash_fetch(PL_utf8_X_prepend,
+					  (U8*)locinput, do_utf8))
+		    {
+			previous_prepend = locinput;
+			locinput += UTF8SKIP(locinput);
+		    }
+
+		    /* As noted above, if we matched a prepend character, but
+		     * the next thing won't match, back off the last prepend we
+		     * matched, as it is guaranteed to match the begin */
+		    if (previous_prepend
+			&& (locinput >=  PL_regeol
+			    || ! swash_fetch(PL_utf8_X_begin,
+					     (U8*)locinput, do_utf8)))
+		    {
+			locinput = previous_prepend;
+		    }
+
+		    /* Note that here we know PL_regeol > locinput, as we
+		     * tested that upon input to this switch case, and if we
+		     * moved locinput forward, we tested the result just above
+		     * and it either passed, or we backed off so that it will
+		     * now pass */
+		    if (! swash_fetch(PL_utf8_X_begin, (U8*)locinput, do_utf8)) {
+
+			/* Here did not match the required 'Begin' in the
+			 * second term.  So just match the very first
+			 * character, the '.' of the final term of the regex */
+			locinput = starting + UTF8SKIP(starting);
+		    } else {
+
+			/* Here is the beginning of a character that can have
+			 * an extender.  It is either a hangul syllable, or a
+			 * non-control */
+			if (swash_fetch(PL_utf8_X_non_hangul,
+					(U8*)locinput, do_utf8))
+			{
+
+			    /* Here not a Hangul syllable, must be a
+			     * ('!  * Control') */
+			    locinput += UTF8SKIP(locinput);
+			} else {
+
+			    /* Here is a Hangul syllable.  It can be composed
+			     * of several individual characters.  One
+			     * possibility is T+ */
+			    if (swash_fetch(PL_utf8_X_T,
+					    (U8*)locinput, do_utf8))
+			    {
+				while (locinput < PL_regeol
+					&& swash_fetch(PL_utf8_X_T,
+							(U8*)locinput, do_utf8))
+				{
+				    locinput += UTF8SKIP(locinput);
+				}
+			    } else {
+
+				/* Here, not T+, but is a Hangul.  That means
+				 * it is one of the others: L, LV, LVT or V,
+				 * and matches:
+				 * L* (L | LVT T* | V  V* T* | LV  V* T*) */
+
+				/* Match L*           */
+				while (locinput < PL_regeol
+					&& swash_fetch(PL_utf8_X_L,
+							(U8*)locinput, do_utf8))
+				{
+				    locinput += UTF8SKIP(locinput);
+				}
+
+				/* Here, have exhausted L*.  If the next
+				 * character is not an LV, LVT nor V, it means
+				 * we had to have at least one L, so matches L+
+				 * in the original equation, we have a complete
+				 * hangul syllable.  Are done. */
+
+				if (locinput < PL_regeol
+				    && swash_fetch(PL_utf8_X_LV_LVT_V,
+						    (U8*)locinput, do_utf8))
+				{
+
+				    /* Otherwise keep going.  Must be LV, LVT
+				     * or V.  See if LVT */
+				    if (swash_fetch(PL_utf8_X_LVT,
+						    (U8*)locinput, do_utf8))
+				    {
+					locinput += UTF8SKIP(locinput);
+				    } else {
+
+					/* Must be  V or LV.  Take it, then
+					 * match V*     */
+					locinput += UTF8SKIP(locinput);
+					while (locinput < PL_regeol
+						&& swash_fetch(PL_utf8_X_V,
+							 (U8*)locinput, do_utf8))
+					{
+					    locinput += UTF8SKIP(locinput);
+					}
+				    }
+
+				    /* And any of LV, LVT, or V can be followed
+				     * by T*            */
+				    while (locinput < PL_regeol
+					   && swash_fetch(PL_utf8_X_T,
+							   (U8*)locinput,
+							   do_utf8))
+				    {
+					locinput += UTF8SKIP(locinput);
+				    }
+				}
+			    }
+			}
+
+			/* Match any extender */
+			while (locinput < PL_regeol
+				&& swash_fetch(PL_utf8_X_extend,
+						(U8*)locinput, do_utf8))
+			{
+			    locinput += UTF8SKIP(locinput);
+			}
+		    }
+		}
+		if (locinput > PL_regeol) sayNO;
 	    }
-	    if (OP(scan) == NDIGIT
-		? isDIGIT(nextchr) : isDIGIT_LC(nextchr))
-		sayNO;
-	    nextchr = UCHARAT(++locinput);
-	    break;
-	case CLUMP:
-	    if (locinput >= PL_regeol)
-		sayNO;
-	    if  (do_utf8) {
-		LOAD_UTF8_CHARCLASS_MARK();
-		if (swash_fetch(PL_utf8_mark,(U8*)locinput, do_utf8))
-		    sayNO;
-		locinput += PL_utf8skip[nextchr];
-		while (locinput < PL_regeol &&
-		       swash_fetch(PL_utf8_mark,(U8*)locinput, do_utf8))
-		    locinput += UTF8SKIP(locinput);
-		if (locinput > PL_regeol)
-		    sayNO;
-	    } 
-	    else
-	       locinput++;
 	    nextchr = UCHARAT(locinput);
 	    break;
             
@@ -3663,6 +3881,7 @@
 #define ST st->u.eval
 	{
 	    SV *ret;
+	    REGEXP *re_sv;
             regexp *re;
             regexp_internal *rei;
             regnode *startpoint;
@@ -3679,9 +3898,10 @@
             } else {
                 nochange_depth = 0;
             }
+	    re_sv = rex_sv;
             re = rex;
             rei = rexi;
-            (void)ReREFCNT_inc(rex);
+            (void)ReREFCNT_inc(rex_sv);
             if (OP(scan)==GOSUB) {
                 startpoint = scan + ARG2L(scan);
                 ST.close_paren = ARG(scan);
@@ -3705,6 +3925,7 @@
 		OP_4tree * const oop = PL_op;
 		COP * const ocurcop = PL_curcop;
 		PAD *old_comppad;
+		char *saved_regeol = PL_regeol;
 	    
 		n = ARG(scan);
 		PL_op = (OP_4tree*)rexi->data->data[n];
@@ -3730,6 +3951,7 @@
 		PL_op = oop;
 		PAD_RESTORE_LOCAL(old_comppad);
 		PL_curcop = ocurcop;
+		PL_regeol = saved_regeol;
 		if (!logical) {
 		    /* /(?{...})/ */
 		    sv_setsv(save_scalar(PL_replgv), ret);
@@ -3741,41 +3963,80 @@
 		{
 		    /* extract RE object from returned value; compiling if
 		     * necessary */
-
 		    MAGIC *mg = NULL;
-		    const SV *sv;
-		    if(SvROK(ret) && SvSMAGICAL(sv = SvRV(ret)))
-			mg = mg_find(sv, PERL_MAGIC_qr);
-		    else if (SvSMAGICAL(ret)) {
-			if (SvGMAGICAL(ret))
+		    REGEXP *rx = NULL;
+
+		    if (SvROK(ret)) {
+			SV *const sv = SvRV(ret);
+
+			if (SvTYPE(sv) == SVt_REGEXP) {
+			    rx = (REGEXP*) sv;
+			} else if (SvSMAGICAL(sv)) {
+			    mg = mg_find(sv, PERL_MAGIC_qr);
+			    assert(mg);
+			}
+		    } else if (SvTYPE(ret) == SVt_REGEXP) {
+			rx = (REGEXP*) ret;
+		    } else if (SvSMAGICAL(ret)) {
+			if (SvGMAGICAL(ret)) {
+			    /* I don't believe that there is ever qr magic
+			       here.  */
+			    assert(!mg_find(ret, PERL_MAGIC_qr));
 			    sv_unmagic(ret, PERL_MAGIC_qr);
-			else
+			}
+			else {
 			    mg = mg_find(ret, PERL_MAGIC_qr);
+			    /* testing suggests mg only ends up non-NULL for
+			       scalars who were upgraded and compiled in the
+			       else block below. In turn, this is only
+			       triggered in the "postponed utf8 string" tests
+			       in t/op/pat.t  */
+			}
 		    }
 
 		    if (mg) {
-			re = reg_temp_copy((regexp *)mg->mg_obj); /*XXX:dmq*/
+			rx = (REGEXP *) mg->mg_obj; /*XXX:dmq*/
+			assert(rx);
+		    }
+		    if (rx) {
+			rx = reg_temp_copy(NULL, rx);
 		    }
 		    else {
 			U32 pm_flags = 0;
 			const I32 osize = PL_regsize;
 
-			if (DO_UTF8(ret)) pm_flags |= RXf_UTF8;
-			re = CALLREGCOMP(ret, pm_flags);
+			if (DO_UTF8(ret)) {
+			    assert (SvUTF8(ret));
+			} else if (SvUTF8(ret)) {
+			    /* Not doing UTF-8, despite what the SV says. Is
+			       this only if we're trapped in use 'bytes'?  */
+			    /* Make a copy of the octet sequence, but without
+			       the flag on, as the compiler now honours the
+			       SvUTF8 flag on ret.  */
+			    STRLEN len;
+			    const char *const p = SvPV(ret, len);
+			    ret = newSVpvn_flags(p, len, SVs_TEMP);
+			}
+			rx = CALLREGCOMP(ret, pm_flags);
 			if (!(SvFLAGS(ret)
 			      & (SVs_TEMP | SVs_PADTMP | SVf_READONLY
-				| SVs_GMG)))
-			    sv_magic(ret,MUTABLE_SV(ReREFCNT_inc(re)),
-					PERL_MAGIC_qr,0,0);
+				 | SVs_GMG))) {
+			    /* This isn't a first class regexp. Instead, it's
+			       caching a regexp onto an existing, Perl visible
+			       scalar.  */
+			    sv_magic(ret, MUTABLE_SV(rx), PERL_MAGIC_qr, 0, 0);
+			}
 			PL_regsize = osize;
 		    }
+		    re_sv = rx;
+		    re = (struct regexp *)SvANY(rx);
 		}
                 RXp_MATCH_COPIED_off(re);
                 re->subbeg = rex->subbeg;
                 re->sublen = rex->sublen;
 		rei = RXi_GET(re);
                 DEBUG_EXECUTE_r(
-                    debug_start_match(re, do_utf8, locinput, PL_regeol, 
+                    debug_start_match(re_sv, do_utf8, locinput, PL_regeol, 
                         "Matching embedded");
 		);		
 		startpoint = rei->program + 1;
@@ -3809,15 +4070,16 @@
 		PL_reg_maxiter = 0;
 
 		ST.toggle_reg_flags = PL_reg_flags;
-		if (RX_UTF8(re))
+		if (RX_UTF8(re_sv))
 		    PL_reg_flags |= RF_utf8;
 		else
 		    PL_reg_flags &= ~RF_utf8;
 		ST.toggle_reg_flags ^= PL_reg_flags; /* diff of old and new */
 
-		ST.prev_rex = rex;
+		ST.prev_rex = rex_sv;
 		ST.prev_curlyx = cur_curlyx;
-		SETREX(rex,re);
+		SETREX(rex_sv,re_sv);
+		rex = re;
 		rexi = rei;
 		cur_curlyx = NULL;
 		ST.B = next;
@@ -3836,8 +4098,9 @@
 	case EVAL_AB: /* cleanup after a successful (??{A})B */
 	    /* note: this is called twice; first after popping B, then A */
 	    PL_reg_flags ^= ST.toggle_reg_flags; 
-	    ReREFCNT_dec(rex);
-	    SETREX(rex,ST.prev_rex);
+	    ReREFCNT_dec(rex_sv);
+	    SETREX(rex_sv,ST.prev_rex);
+	    rex = (struct regexp *)SvANY(rex_sv);
 	    rexi = RXi_GET(rex);
 	    regcpblow(ST.cp);
 	    cur_eval = ST.prev_eval;
@@ -3859,8 +4122,9 @@
 	case EVAL_AB_fail: /* unsuccessfully ran A or B in (??{A})B */
 	    /* note: this is called twice; first after popping B, then A */
 	    PL_reg_flags ^= ST.toggle_reg_flags; 
-	    ReREFCNT_dec(rex);
-	    SETREX(rex,ST.prev_rex);
+	    ReREFCNT_dec(rex_sv);
+	    SETREX(rex_sv,ST.prev_rex);
+	    rex = (struct regexp *)SvANY(rex_sv);
 	    rexi = RXi_GET(rex); 
 	    /* rex was changed so update the pointer in PL_reglastparen and PL_reglastcloseparen */
 	    PL_reglastparen = &rex->lastparen;
@@ -4862,11 +5126,12 @@
 			    = cur_eval->u.eval.toggle_reg_flags;
 		PL_reg_flags ^= st->u.eval.toggle_reg_flags; 
 
-		st->u.eval.prev_rex = rex;		/* inner */
-		SETREX(rex,cur_eval->u.eval.prev_rex);
+		st->u.eval.prev_rex = rex_sv;		/* inner */
+		SETREX(rex_sv,cur_eval->u.eval.prev_rex);
+		rex = (struct regexp *)SvANY(rex_sv);
 		rexi = RXi_GET(rex);
 		cur_curlyx = cur_eval->u.eval.prev_curlyx;
-		ReREFCNT_inc(rex);
+		ReREFCNT_inc(rex_sv);
 		st->u.eval.cp = regcppush(0);	/* Save *all* the positions. */
 
 		/* rex was changed so update the pointer in PL_reglastparen and PL_reglastcloseparen */
@@ -5718,8 +5983,10 @@
 
     if (do_utf8 && !UTF8_IS_INVARIANT(c)) {
 	c = utf8n_to_uvchr(p, UTF8_MAXBYTES, &len,
-		(UTF8_ALLOW_DEFAULT & UTF8_ALLOW_ANYUV) | UTF8_CHECK_ONLY);
-		/* see [perl #37836] for UTF8_ALLOW_ANYUV */
+		(UTF8_ALLOW_DEFAULT & UTF8_ALLOW_ANYUV)
+		| UTF8_ALLOW_FFFF | UTF8_CHECK_ONLY);
+		/* see [perl #37836] for UTF8_ALLOW_ANYUV; [perl #38293] for
+		 * UTF8_ALLOW_FFFF */
 	if (len == (STRLEN)-1) 
 	    Perl_croak(aTHX_ "Malformed UTF-8 character (fatal)");
     }
Index: src/gnu/usr.bin/perl/regexp.h
diff -u src/gnu/usr.bin/perl/regexp.h:1.9 src/gnu/usr.bin/perl/regexp.h:1.10
--- regexp.h:1.9	Mon Oct 12 18:24:21 2009
+++ regexp.h	Fri Sep 24 15:06:43 2010
@@ -66,51 +66,51 @@
   regexp's data array based on the data item's type.
 */
 
+#define _REGEXP_COMMON							\
+        /* what engine created this regexp? */				\
+	const struct regexp_engine* engine; 				\
+	REGEXP *mother_re; /* what re is this a lightweight copy of? */	\
+	/* Information about the match that the perl core uses to */	\
+	/* manage things */						\
+	U32 extflags;	/* Flags used both externally and internally */	\
+	I32 minlen;	/* mininum possible length of string to match */\
+	I32 minlenret;	/* mininum possible length of $& */		\
+	U32 gofs;	/* chars left of pos that we search from */	\
+	/* substring data about strings that must appear in the */	\
+	/* final match, used for optimisations */			\
+	struct reg_substr_data *substrs;				\
+	U32 nparens;	/* number of capture buffers */			\
+	/* private engine specific data */				\
+	U32 intflags;	/* Engine Specific Internal flags */		\
+	void *pprivate;	/* Data private to the regex engine which */	\
+			/* created this object. */			\
+	/* Data about the last/current match. These are modified */	\
+	/* during matching */						\
+	U32 lastparen;			/* last open paren matched */	\
+	U32 lastcloseparen;		/* last close paren matched */	\
+	regexp_paren_pair *swap;	/* Unused: 5.10.1 and later */	\
+	/* Array of offsets for (@-) and (@+) */			\
+	regexp_paren_pair *offs;					\
+	/* saved or original string so \digit works forever. */		\
+	char *subbeg;							\
+	SV_SAVED_COPY	/* If non-NULL, SV which is COW from original */\
+	I32 sublen;	/* Length of string pointed by subbeg */	\
+	/* Information about the match that isn't often used */		\
+	/* offset from wrapped to the start of precomp */		\
+	PERL_BITFIELD32 pre_prefix:4;					\
+	/* number of eval groups in the pattern - for security checks */\
+	PERL_BITFIELD32 seen_evals:28
+
 typedef struct regexp {
-        /* what engine created this regexp? */
-	const struct regexp_engine* engine; 
-	struct regexp* mother_re; /* what re is this a lightweight copy of? */
-	
-	/* Information about the match that the perl core uses to manage things */
-	U32 extflags;           /* Flags used both externally and internally */
-	I32 minlen;		/* mininum possible length of string to match */
-	I32 minlenret;		/* mininum possible length of $& */
-	U32 gofs;               /* chars left of pos that we search from */
-	struct reg_substr_data *substrs; /* substring data about strings that must appear
-                                   in the final match, used for optimisations */
-	U32 nparens;		/* number of capture buffers */
-
-        /* private engine specific data */
-	U32 intflags;		/* Engine Specific Internal flags */
-	void *pprivate;         /* Data private to the regex engine which 
-                                   created this object. */
-        
-        /* Data about the last/current match. These are modified during matching*/
-        U32 lastparen;		/* last open paren matched */
-	U32 lastcloseparen;	/* last close paren matched */
-        regexp_paren_pair *swap;  /* Swap copy of *offs */ 
-        regexp_paren_pair *offs;  /* Array of offsets for (@-) and (@+) */
-
-	char *subbeg;		/* saved or original string 
-				   so \digit works forever. */
-	SV_SAVED_COPY           /* If non-NULL, SV which is COW from original */
-	I32 sublen;		/* Length of string pointed by subbeg */
-        
-        
-        /* Information about the match that isn't often used */
-	I32 prelen;		/* length of precomp */
-	const char *precomp;	/* pre-compilation regular expression */
-	/* wrapped can't be const char*, as it is returned by sv_2pv_flags */
-	char *wrapped;          /* wrapped version of the pattern */
-	I32 wraplen;		/* length of wrapped */
-	I32 seen_evals;         /* number of eval groups in the pattern - for security checks */ 
-        HV *paren_names;	/* Optional hash of paren names */
-        
-        /* Refcount of this regexp */
-	I32 refcnt;             /* Refcount of this regexp */
+	_XPV_HEAD;
+	_XPVMG_HEAD;
+	_REGEXP_COMMON;
 } regexp;
 
-#define RXp_PAREN_NAMES(rx)	((rx)->paren_names)
+/*        HV *paren_names;	 Optional hash of paren names
+	  now stored in the IV union */
+
+#define RXp_PAREN_NAMES(rx)	((rx)->xiv_u.xivu_hv)
 
 /* used for high speed searches */
 typedef struct re_scream_pos_data_s
@@ -123,7 +123,7 @@
  * Any regex engine implementation must be able to build one of these.
  */
 typedef struct regexp_engine {
-    REGEXP* (*comp) (pTHX_ const SV * const pattern, const U32 flags);
+    REGEXP* (*comp) (pTHX_ SV * const pattern, U32 flags);
     I32     (*exec) (pTHX_ REGEXP * const rx, char* stringarg, char* strend,
                      char* strbeg, I32 minend, SV* screamer,
                      void* data, U32 flags);
@@ -230,35 +230,17 @@
  *
  */
 
-/* Anchor and GPOS related stuff */
-#define RXf_ANCH_BOL    	0x00000001
-#define RXf_ANCH_MBOL   	0x00000002
-#define RXf_ANCH_SBOL   	0x00000004
-#define RXf_ANCH_GPOS   	0x00000008
-#define RXf_GPOS_SEEN   	0x00000010
-#define RXf_GPOS_FLOAT  	0x00000020
-/* two bits here */
-#define RXf_ANCH        	(RXf_ANCH_BOL|RXf_ANCH_MBOL|RXf_ANCH_GPOS|RXf_ANCH_SBOL)
-#define RXf_GPOS_CHECK          (RXf_GPOS_SEEN|RXf_ANCH_GPOS)
-#define RXf_ANCH_SINGLE         (RXf_ANCH_SBOL|RXf_ANCH_GPOS)
-
-/* Flags indicating special patterns */
-#define RXf_SKIPWHITE		0x00000100 /* Pattern is for a split / / */
-#define RXf_START_ONLY		0x00000200 /* Pattern is /^/ */
-#define RXf_WHITE		0x00000400 /* Pattern is /\s+/ */
-#define RXf_NULL		0x40000000 /* Pattern is // */
-
-/* 0x1F800 of extflags is used by (RXf_)PMf_COMPILETIME
+/* 0x3F of extflags is used by (RXf_)PMf_COMPILETIME
  * If you change these you need to change the equivalent flags in op.h, and
  * vice versa.  */
-#define RXf_PMf_LOCALE  	0x00000800 /* use locale */
-#define RXf_PMf_MULTILINE	0x00001000 /* /m         */
-#define RXf_PMf_SINGLELINE	0x00002000 /* /s         */
-#define RXf_PMf_FOLD    	0x00004000 /* /i         */
-#define RXf_PMf_EXTENDED	0x00008000 /* /x         */
-#define RXf_PMf_KEEPCOPY	0x00010000 /* /p         */
+#define RXf_PMf_MULTILINE	0x00000001 /* /m         */
+#define RXf_PMf_SINGLELINE	0x00000002 /* /s         */
+#define RXf_PMf_FOLD    	0x00000004 /* /i         */
+#define RXf_PMf_EXTENDED	0x00000008 /* /x         */
+#define RXf_PMf_KEEPCOPY	0x00000010 /* /p         */
+#define RXf_PMf_LOCALE  	0x00000020 /* use locale */
 /* these flags are transfered from the PMOP->op_pmflags member during compilation */
-#define RXf_PMf_STD_PMMOD_SHIFT	12
+#define RXf_PMf_STD_PMMOD_SHIFT	0
 #define RXf_PMf_STD_PMMOD	(RXf_PMf_MULTILINE|RXf_PMf_SINGLELINE|RXf_PMf_FOLD|RXf_PMf_EXTENDED)
 #define RXf_PMf_COMPILETIME	(RXf_PMf_MULTILINE|RXf_PMf_SINGLELINE|RXf_PMf_LOCALE|RXf_PMf_FOLD|RXf_PMf_EXTENDED|RXf_PMf_KEEPCOPY)
 
@@ -305,37 +287,54 @@
  *
  */
 
+/* Anchor and GPOS related stuff */
+#define RXf_ANCH_BOL    	0x00000100
+#define RXf_ANCH_MBOL   	0x00000200
+#define RXf_ANCH_SBOL   	0x00000400
+#define RXf_ANCH_GPOS   	0x00000800
+#define RXf_GPOS_SEEN   	0x00001000
+#define RXf_GPOS_FLOAT  	0x00002000
+/* two bits here */
+#define RXf_ANCH        	(RXf_ANCH_BOL|RXf_ANCH_MBOL|RXf_ANCH_GPOS|RXf_ANCH_SBOL)
+#define RXf_GPOS_CHECK          (RXf_GPOS_SEEN|RXf_ANCH_GPOS)
+#define RXf_ANCH_SINGLE         (RXf_ANCH_SBOL|RXf_ANCH_GPOS)
+
 /* What we have seen */
-#define RXf_LOOKBEHIND_SEEN	0x00020000
-#define RXf_EVAL_SEEN   	0x00040000
-#define RXf_CANY_SEEN   	0x00080000
+#define RXf_LOOKBEHIND_SEEN	0x00004000
+#define RXf_EVAL_SEEN   	0x00008000
+#define RXf_CANY_SEEN   	0x00010000
 
 /* Special */
-#define RXf_NOSCAN      	0x00100000
-#define RXf_CHECK_ALL   	0x00200000
+#define RXf_NOSCAN      	0x00020000
+#define RXf_CHECK_ALL   	0x00040000
 
 /* UTF8 related */
-#define RXf_UTF8        	0x00400000
-#define RXf_MATCH_UTF8  	0x00800000
+#define RXf_MATCH_UTF8  	0x00100000
 
 /* Intuit related */
-#define RXf_USE_INTUIT_NOML	0x01000000
-#define RXf_USE_INTUIT_ML	0x02000000
-#define RXf_INTUIT_TAIL 	0x04000000
+#define RXf_USE_INTUIT_NOML	0x00200000
+#define RXf_USE_INTUIT_ML	0x00400000
+#define RXf_INTUIT_TAIL 	0x00800000
 
 /*
   Set in Perl_pmruntime if op_flags & OPf_SPECIAL, i.e. split. Will
   be used by regex engines to check whether they should set
   RXf_SKIPWHITE
 */
-#define RXf_SPLIT           0x08000000
+#define RXf_SPLIT		0x01000000
 
 #define RXf_USE_INTUIT		(RXf_USE_INTUIT_NOML|RXf_USE_INTUIT_ML)
 
 /* Copy and tainted info */
-#define RXf_COPY_DONE   	0x10000000
-#define RXf_TAINTED_SEEN	0x20000000
-#define RXf_TAINTED             0x80000000 /* this pattern is tainted */
+#define RXf_COPY_DONE   	0x02000000
+#define RXf_TAINTED_SEEN	0x04000000
+#define RXf_TAINTED		0x08000000 /* this pattern is tainted */
+
+/* Flags indicating special patterns */
+#define RXf_START_ONLY		0x10000000 /* Pattern is /^/ */
+#define RXf_SKIPWHITE		0x20000000 /* Pattern is for a split / / */
+#define RXf_WHITE		0x40000000 /* Pattern is /\s+/ */
+#define RXf_NULL		0x80000000 /* Pattern is // */
 
 /*
  * NOTE: if you modify any RXf flags you should run regen.pl or regcomp.pl
@@ -364,27 +363,64 @@
 
 #define RXp_EXTFLAGS(rx)	((rx)->extflags)
 
-#define RX_PRECOMP(prog)	((prog)->precomp)
-/* *** 5.10.x-specific definition of RX_PRECOMP_const */
-#define RX_PRECOMP_const(prog)	((prog)->precomp)
-#define RX_PRELEN(prog)		((prog)->prelen)
-#define RX_WRAPPED(prog)	((prog)->wrapped)
-#define RX_WRAPLEN(prog)	((prog)->wraplen)
-#define RX_CHECK_SUBSTR(prog)	((prog)->check_substr)
-#define RX_EXTFLAGS(prog)	((prog)->extflags)
-#define RX_REFCNT(prog)		((prog)->refcnt)
-#define RX_ENGINE(prog)		((prog)->engine)
-#define RX_SUBBEG(prog)		((prog)->subbeg)
-#define RX_OFFS(prog)		((prog)->offs)
-#define RX_NPARENS(prog)	((prog)->nparens)
-#define RX_SUBLEN(prog)		((prog)->sublen)
-#define RX_SUBBEG(prog)		((prog)->subbeg)
-#define RX_MINLEN(prog)		((prog)->minlen)
-#define RX_MINLENRET(prog)	((prog)->minlenret)
-#define RX_GOFS(prog)		((prog)->gofs)
-#define RX_LASTPAREN(prog)	((prog)->lastparen)
-#define RX_LASTCLOSEPAREN(prog)	((prog)->lastcloseparen)
-#define RX_SEEN_EVALS(prog)	((prog)->seen_evals)
+/* For source compatibility. We used to store these explicitly.  */
+#define RX_PRECOMP(prog)	(RX_WRAPPED(prog) + ((struct regexp *)SvANY(prog))->pre_prefix)
+#define RX_PRECOMP_const(prog)	(RX_WRAPPED_const(prog) + ((struct regexp *)SvANY(prog))->pre_prefix)
+/* FIXME? Are we hardcoding too much here and constraining plugin extension
+   writers? Specifically, the value 1 assumes that the wrapped version always
+   has exactly one character at the end, a ')'. Will that always be true?  */
+#define RX_PRELEN(prog)		(RX_WRAPLEN(prog) - ((struct regexp *)SvANY(prog))->pre_prefix - 1)
+#define RX_WRAPPED(prog)	SvPVX(prog)
+#define RX_WRAPPED_const(prog)	SvPVX_const(prog)
+#define RX_WRAPLEN(prog)	SvCUR(prog)
+#define RX_CHECK_SUBSTR(prog)	(((struct regexp *)SvANY(prog))->check_substr)
+#define RX_REFCNT(prog)		SvREFCNT(prog)
+#if defined(__GNUC__) && !defined(PERL_GCC_BRACE_GROUPS_FORBIDDEN)
+#  define RX_EXTFLAGS(prog)						\
+    (*({								\
+	const REGEXP *const _rx_extflags = (prog);			\
+	assert(SvTYPE(_rx_extflags) == SVt_REGEXP);			\
+	&RXp_EXTFLAGS(SvANY(_rx_extflags));				\
+    }))
+#  define RX_ENGINE(prog)						\
+    (*({								\
+	const REGEXP *const _rx_engine = (prog);			\
+	assert(SvTYPE(_rx_engine) == SVt_REGEXP);			\
+	&SvANY(_rx_engine)->engine;					\
+    }))
+#  define RX_SUBBEG(prog)						\
+    (*({								\
+	const REGEXP *const _rx_subbeg = (prog);			\
+	assert(SvTYPE(_rx_subbeg) == SVt_REGEXP);			\
+	&SvANY(_rx_subbeg)->subbeg;					\
+    }))
+#  define RX_OFFS(prog)							\
+    (*({								\
+	const REGEXP *const _rx_offs = (prog);				\
+	assert(SvTYPE(_rx_offs) == SVt_REGEXP);				\
+	&SvANY(_rx_offs)->offs;						\
+    }))
+#  define RX_NPARENS(prog)						\
+    (*({								\
+	const REGEXP *const _rx_nparens = (prog);			\
+	assert(SvTYPE(_rx_nparens) == SVt_REGEXP);			\
+	&SvANY(_rx_nparens)->nparens;					\
+    }))
+#else
+#  define RX_EXTFLAGS(prog)	RXp_EXTFLAGS((struct regexp *)SvANY(prog))
+#  define RX_ENGINE(prog)	(((struct regexp *)SvANY(prog))->engine)
+#  define RX_SUBBEG(prog)	(((struct regexp *)SvANY(prog))->subbeg)
+#  define RX_OFFS(prog)		(((struct regexp *)SvANY(prog))->offs)
+#  define RX_NPARENS(prog)	(((struct regexp *)SvANY(prog))->nparens)
+#endif
+#define RX_SUBLEN(prog)		(((struct regexp *)SvANY(prog))->sublen)
+#define RX_MINLEN(prog)		(((struct regexp *)SvANY(prog))->minlen)
+#define RX_MINLENRET(prog)	(((struct regexp *)SvANY(prog))->minlenret)
+#define RX_GOFS(prog)		(((struct regexp *)SvANY(prog))->gofs)
+#define RX_LASTPAREN(prog)	(((struct regexp *)SvANY(prog))->lastparen)
+#define RX_LASTCLOSEPAREN(prog)	(((struct regexp *)SvANY(prog))->lastcloseparen)
+#define RX_SEEN_EVALS(prog)	(((struct regexp *)SvANY(prog))->seen_evals)
+#define RX_SAVED_COPY(prog)	(((struct regexp *)SvANY(prog))->saved_copy)
 
 #endif /* PLUGGABLE_RE_EXTENSION */
 
@@ -392,8 +428,8 @@
 
 #ifdef PERL_OLD_COPY_ON_WRITE
 #define RX_MATCH_COPY_FREE(rx) \
-	STMT_START {if (rx->saved_copy) { \
-	    SV_CHECK_THINKFIRST_COW_DROP(rx->saved_copy); \
+	STMT_START {if (RX_SAVED_COPY(rx)) { \
+	    SV_CHECK_THINKFIRST_COW_DROP(RX_SAVED_COPY(rx)); \
 	} \
 	if (RX_MATCH_COPIED(rx)) { \
 	    Safefree(RX_SUBBEG(rx)); \
@@ -416,7 +452,7 @@
 			: (RX_MATCH_UTF8_off(prog), (PL_reg_match_utf8 = 0)))
 
 /* Whether the pattern stored at RX_WRAPPED is in UTF-8  */
-#define RX_UTF8(prog)			(RX_EXTFLAGS(prog) & RXf_UTF8)
+#define RX_UTF8(prog)			SvUTF8(prog)
 
 #define REXEC_COPY_STR	0x01		/* Need to copy the string. */
 #define REXEC_CHECKED	0x02		/* check_substr already checked. */
@@ -424,8 +460,27 @@
 #define REXEC_IGNOREPOS	0x08		/* \G matches at start. */
 #define REXEC_NOT_FIRST	0x10		/* This is another iteration of //g. */
 
-#define ReREFCNT_inc(re) ((void)(re && re->refcnt++), re)
-#define ReREFCNT_dec(re) CALLREGFREE(re)
+#if defined(__GNUC__) && !defined(PERL_GCC_BRACE_GROUPS_FORBIDDEN)
+#  define ReREFCNT_inc(re)						\
+    ({									\
+	/* This is here to generate a casting warning if incorrect.  */	\
+	REGEXP *const _rerefcnt_inc = (re);				\
+	assert(SvTYPE(_rerefcnt_inc) == SVt_REGEXP);			\
+	SvREFCNT_inc(_rerefcnt_inc);					\
+	_rerefcnt_inc;							\
+    })
+#  define ReREFCNT_dec(re)						\
+    ({									\
+	/* This is here to generate a casting warning if incorrect.  */	\
+	REGEXP *const _rerefcnt_dec = (re);				\
+	SvREFCNT_dec(_rerefcnt_dec);					\
+    })
+#else
+#  define ReREFCNT_dec(re)	SvREFCNT_dec(re)
+#  define ReREFCNT_inc(re)	((REGEXP *) SvREFCNT_inc(re))
+#endif
+
+/* FIXME for plugins. */
 
 #define FBMcf_TAIL_DOLLAR	1
 #define FBMcf_TAIL_DOLLARM	2
@@ -446,7 +501,7 @@
  * Perl_regexec_flags and then passed to regtry(), regmatch() etc */
 
 typedef struct {
-    regexp *prog;
+    REGEXP *prog;
     char *bol;
     char *till;
     SV *sv;
@@ -516,7 +571,7 @@
 	    struct regmatch_state *prev_yes_state;
 	    struct regmatch_state *prev_eval;
 	    struct regmatch_state *prev_curlyx;
-	    regexp	*prev_rex;
+	    REGEXP	*prev_rex;
 	    U32		toggle_reg_flags; /* what bits in PL_reg_flags to
 					    flip when transitioning between
 					    inner and outer rexen */
Index: src/gnu/usr.bin/perl/scope.c
diff -u src/gnu/usr.bin/perl/scope.c:1.12 src/gnu/usr.bin/perl/scope.c:1.13
--- scope.c:1.12	Mon Oct 12 18:24:22 2009
+++ scope.c	Fri Sep 24 15:06:43 2010
@@ -91,7 +91,13 @@
     if (PL_scopestack_ix == PL_scopestack_max) {
 	PL_scopestack_max = GROW(PL_scopestack_max);
 	Renew(PL_scopestack, PL_scopestack_max, I32);
+#ifdef DEBUGGING
+	Renew(PL_scopestack_name, PL_scopestack_max, const char*);
+#endif
     }
+#ifdef DEBUGGING
+    PL_scopestack_name[PL_scopestack_ix] = "unknown";
+#endif
     PL_scopestack[PL_scopestack_ix++] = PL_savestack_ix;
 
 }
@@ -164,14 +170,17 @@
 }
 
 STATIC SV *
-S_save_scalar_at(pTHX_ SV **sptr)
+S_save_scalar_at(pTHX_ SV **sptr, const U32 flags)
 {
     dVAR;
-    SV * const osv = *sptr;
-    register SV * const sv = *sptr = newSV(0);
+    SV * osv;
+    register SV *sv;
 
     PERL_ARGS_ASSERT_SAVE_SCALAR_AT;
 
+    osv = *sptr;
+    sv  = (flags & SAVEf_KEEPOLDELEM) ? osv : (*sptr = newSV(0));
+
     if (SvTYPE(osv) >= SVt_PVMG && SvMAGIC(osv) && SvTYPE(osv) != SVt_PVGV) {
 	if (SvGMAGICAL(osv)) {
 	    const bool oldtainted = PL_tainted;
@@ -179,8 +188,10 @@
 	       (SVp_IOK|SVp_NOK|SVp_POK)) >> PRIVSHIFT;
 	    PL_tainted = oldtainted;
 	}
-	mg_localize(osv, sv);
+	if (!(flags & SAVEf_KEEPOLDELEM))
+	    mg_localize(osv, sv, (flags & SAVEf_SETMAGIC) != 0);
     }
+
     return sv;
 }
 
@@ -206,7 +217,7 @@
     SvGETMAGIC(*sptr);
     PL_localizing = 0;
     save_pushptrptr(SvREFCNT_inc_simple(gv), SvREFCNT_inc(*sptr), SAVEt_SV);
-    return save_scalar_at(sptr);
+    return save_scalar_at(sptr, SAVEf_SETMAGIC); /* XXX - FIXME - see #60360 */
 }
 
 /* Like save_sptr(), but also SvREFCNT_dec()s the new value.  Can be used to
@@ -313,7 +324,7 @@
     GvAV(gv) = NULL;
     av = GvAVn(gv);
     if (SvMAGIC(oav))
-	mg_localize(MUTABLE_SV(oav), MUTABLE_SV(av));
+	mg_localize(MUTABLE_SV(oav), MUTABLE_SV(av), TRUE);
     return av;
 }
 
@@ -330,7 +341,7 @@
     GvHV(gv) = NULL;
     hv = GvHVn(gv);
     if (SvMAGIC(ohv))
-	mg_localize(MUTABLE_SV(ohv), MUTABLE_SV(hv));
+	mg_localize(MUTABLE_SV(ohv), MUTABLE_SV(hv), TRUE);
     return hv;
 }
 
@@ -509,6 +520,32 @@
 }
 
 void
+Perl_save_hdelete(pTHX_ HV *hv, SV *keysv)
+{
+    STRLEN len;
+    I32 klen;
+    const char *key;
+
+    PERL_ARGS_ASSERT_SAVE_HDELETE;
+
+    key  = SvPV_const(keysv, len);
+    klen = SvUTF8(keysv) ? -(I32)len : (I32)len;
+    SvREFCNT_inc_simple_void_NN(hv);
+    save_pushptri32ptr(savepvn(key, len), klen, hv, SAVEt_DELETE);
+}
+
+void
+Perl_save_adelete(pTHX_ AV *av, I32 key)
+{
+    dVAR;
+
+    PERL_ARGS_ASSERT_SAVE_ADELETE;
+
+    SvREFCNT_inc_void(av);
+    save_pushi32ptr(key, av, SAVEt_ADELETE);
+}
+
+void
 Perl_save_destructor(pTHX_ DESTRUCTORFUNC_NOCONTEXT_t f, void* p)
 {
     dVAR;
@@ -535,19 +572,18 @@
 Perl_save_hints(pTHX)
 {
     dVAR;
-    SSCHECK(4);
-    if (PL_hints & HINT_LOCALIZE_HH) {
-	SSPUSHPTR(GvHV(PL_hintgv));
-	GvHV(PL_hintgv) = Perl_hv_copy_hints_hv(aTHX_ GvHV(PL_hintgv));
-    }
     if (PL_compiling.cop_hints_hash) {
 	HINTS_REFCNT_LOCK;
-	PL_compiling.cop_hints_hash->refcounted_he_refcnt++;
-	HINTS_REFCNT_UNLOCK;
+	    PL_compiling.cop_hints_hash->refcounted_he_refcnt++;
+	    HINTS_REFCNT_UNLOCK;
+    }
+    if (PL_hints & HINT_LOCALIZE_HH) {
+	save_pushptri32ptr(GvHV(PL_hintgv), PL_hints,
+			   PL_compiling.cop_hints_hash, SAVEt_HINTS);
+	GvHV(PL_hintgv) = Perl_hv_copy_hints_hv(aTHX_ GvHV(PL_hintgv));
+    } else {
+	save_pushi32ptr(PL_hints, PL_compiling.cop_hints_hash, SAVEt_HINTS);
     }
-    SSPUSHPTR(PL_compiling.cop_hints_hash);
-    SSPUSHINT(PL_hints);
-    SSPUSHINT(SAVEt_HINTS);
 }
 
 static void
@@ -562,12 +598,12 @@
 }
 
 void
-Perl_save_aelem(pTHX_ AV *av, I32 idx, SV **sptr)
+Perl_save_aelem_flags(pTHX_ AV *av, I32 idx, SV **sptr, const U32 flags)
 {
     dVAR;
     SV *sv;
 
-    PERL_ARGS_ASSERT_SAVE_AELEM;
+    PERL_ARGS_ASSERT_SAVE_AELEM_FLAGS;
 
     SvGETMAGIC(*sptr);
     save_pushptri32ptr(SvREFCNT_inc_simple(av), idx, SvREFCNT_inc(*sptr),
@@ -575,7 +611,9 @@
     /* if it gets reified later, the restore will have the wrong refcnt */
     if (!AvREAL(av) && AvREIFY(av))
 	SvREFCNT_inc_void(*sptr);
-    save_scalar_at(sptr);
+    save_scalar_at(sptr, flags); /* XXX - FIXME - see #60360 */
+    if (flags & SAVEf_KEEPOLDELEM)
+	return;
     sv = *sptr;
     /* If we're localizing a tied array element, this new sv
      * won't actually be stored in the array - so it won't get
@@ -586,12 +624,12 @@
 }
 
 void
-Perl_save_helem(pTHX_ HV *hv, SV *key, SV **sptr)
+Perl_save_helem_flags(pTHX_ HV *hv, SV *key, SV **sptr, const U32 flags)
 {
     dVAR;
     SV *sv;
 
-    PERL_ARGS_ASSERT_SAVE_HELEM;
+    PERL_ARGS_ASSERT_SAVE_HELEM_FLAGS;
 
     SvGETMAGIC(*sptr);
     SSCHECK(4);
@@ -599,7 +637,9 @@
     SSPUSHPTR(newSVsv(key));
     SSPUSHPTR(SvREFCNT_inc(*sptr));
     SSPUSHINT(SAVEt_HELEM);
-    save_scalar_at(sptr);
+    save_scalar_at(sptr, flags);
+    if (flags & SAVEf_KEEPOLDELEM)
+	return;
     sv = *sptr;
     /* If we're localizing a tied hash element, this new sv
      * won't actually be stored in the hash - so it won't get
@@ -618,7 +658,7 @@
 
     SvGETMAGIC(*sptr);
     save_pushptrptr(sptr, SvREFCNT_inc(*sptr), SAVEt_SVREF);
-    return save_scalar_at(sptr);
+    return save_scalar_at(sptr, SAVEf_SETMAGIC); /* XXX - FIXME - see #60360 */
 }
 
 I32
@@ -673,10 +713,6 @@
 	    av = MUTABLE_AV(gv); /* what to refcnt_dec */
 	restore_sv:
 	    sv = *(SV**)ptr;
-	    DEBUG_S(PerlIO_printf(Perl_debug_log,
-				  "restore svref: %p %p:%s -> %p:%s\n",
-				  (void*)ptr, (void*)sv, SvPEEK(sv),
-				  (void*)value, SvPEEK(value)));
 	    *(SV**)ptr = value;
 	    SvREFCNT_dec(sv);
 	    PL_localizing = 2;
@@ -717,9 +753,7 @@
 	case SAVEt_AV:				/* array reference */
 	    av = MUTABLE_AV(SSPOPPTR);
 	    gv = MUTABLE_GV(SSPOPPTR);
-	    if (GvAV(gv)) {
-		SvREFCNT_dec(GvAV(gv));
-	    }
+	    SvREFCNT_dec(GvAV(gv));
 	    GvAV(gv) = av;
 	    if (SvMAGICAL(av)) {
 		PL_localizing = 2;
@@ -730,9 +764,7 @@
 	case SAVEt_HV:				/* hash reference */
 	    hv = MUTABLE_HV(SSPOPPTR);
 	    gv = MUTABLE_GV(SSPOPPTR);
-	    if (GvHV(gv)) {
-		SvREFCNT_dec(GvHV(gv));
-	    }
+	    SvREFCNT_dec(GvHV(gv));
 	    GvHV(gv) = hv;
 	    if (SvMAGICAL(hv)) {
 		PL_localizing = 2;
@@ -869,6 +901,13 @@
 	    SvREFCNT_dec(hv);
 	    Safefree(ptr);
 	    break;
+	case SAVEt_ADELETE:
+	    ptr = SSPOPPTR;
+	    av = MUTABLE_AV(ptr);
+	    i = SSPOPINT;
+	    (void)av_delete(av, i, G_DISCARD);
+	    SvREFCNT_dec(av);
+	    break;
 	case SAVEt_DESTRUCTOR_X:
 	    ptr = SSPOPPTR;
 	    (*SSPOPDXPTR)(aTHX_ ptr);
@@ -931,9 +970,9 @@
 		SvREFCNT_dec(MUTABLE_SV(GvHV(PL_hintgv)));
 		GvHV(PL_hintgv) = NULL;
 	    }
-	    *(I32*)&PL_hints = (I32)SSPOPINT;
 	    Perl_refcounted_he_free(aTHX_ PL_compiling.cop_hints_hash);
 	    PL_compiling.cop_hints_hash = (struct refcounted_he *) SSPOPPTR;
+	    *(I32*)&PL_hints = (I32)SSPOPINT;
 	    if (PL_hints & HINT_LOCALIZE_HH) {
 		SvREFCNT_dec(MUTABLE_SV(GvHV(PL_hintgv)));
 		GvHV(PL_hintgv) = MUTABLE_HV(SSPOPPTR);
@@ -1022,21 +1061,6 @@
 	    *(IV*)ptr = (IV)SSPOPIV;
 	    break;
 
-	    /* This case is rendered redundant by the integration of change
-	       33078. See the comment near Perl_save_padsv().  */
-	case SAVEt_PADSV:
-	    {
-		const PADOFFSET off = (PADOFFSET)SSPOPLONG;
-		ptr = SSPOPPTR;
-		if (ptr)
-		    AvARRAY((PAD*)ptr)[off] = (SV*)SSPOPPTR;
-		else {
-		  /* Can we ever get here?
-		     POPs must balance PUSHes.  */
-		    (void) SSPOPPTR;
-		}
-	    }
-	    break;
 	case SAVEt_I16:				/* I16 reference */
 	    ptr = SSPOPPTR;
 	    *(I16*)ptr = (I16)SSPOPINT;
@@ -1115,16 +1139,16 @@
     case CXt_BLOCK:
 	break;
     case CXt_FORMAT:
-	PerlIO_printf(Perl_debug_log, "BLK_SUB.CV = 0x%"UVxf"\n",
-		PTR2UV(cx->blk_sub.cv));
-	PerlIO_printf(Perl_debug_log, "BLK_SUB.GV = 0x%"UVxf"\n",
-		PTR2UV(cx->blk_sub.gv));
-	PerlIO_printf(Perl_debug_log, "BLK_SUB.DFOUTGV = 0x%"UVxf"\n",
-		PTR2UV(cx->blk_sub.dfoutgv));
-	PerlIO_printf(Perl_debug_log, "BLK_SUB.HASARGS = %d\n",
+	PerlIO_printf(Perl_debug_log, "BLK_FORMAT.CV = 0x%"UVxf"\n",
+		PTR2UV(cx->blk_format.cv));
+	PerlIO_printf(Perl_debug_log, "BLK_FORMAT.GV = 0x%"UVxf"\n",
+		PTR2UV(cx->blk_format.gv));
+	PerlIO_printf(Perl_debug_log, "BLK_FORMAT.DFOUTGV = 0x%"UVxf"\n",
+		PTR2UV(cx->blk_format.dfoutgv));
+	PerlIO_printf(Perl_debug_log, "BLK_FORMAT.HASARGS = %d\n",
 		      (int)CxHASARGS(cx));
-	PerlIO_printf(Perl_debug_log, "BLK_SUB.RETOP = 0x%"UVxf"\n",
-		PTR2UV(cx->blk_sub.retop));
+	PerlIO_printf(Perl_debug_log, "BLK_FORMAT.RETOP = 0x%"UVxf"\n",
+		PTR2UV(cx->blk_format.retop));
 	break;
     case CXt_SUB:
 	PerlIO_printf(Perl_debug_log, "BLK_SUB.CV = 0x%"UVxf"\n",
@@ -1152,7 +1176,10 @@
 		PTR2UV(cx->blk_eval.retop));
 	break;
 
-    case CXt_LOOP:
+    case CXt_LOOP_LAZYIV:
+    case CXt_LOOP_LAZYSV:
+    case CXt_LOOP_FOR:
+    case CXt_LOOP_PLAIN:
 	PerlIO_printf(Perl_debug_log, "BLK_LOOP.LABEL = %s\n", CxLABEL(cx));
 	PerlIO_printf(Perl_debug_log, "BLK_LOOP.RESETSP = %ld\n",
 		(long)cx->blk_loop.resetsp);
@@ -1160,14 +1187,13 @@
 		PTR2UV(cx->blk_loop.my_op));
 	PerlIO_printf(Perl_debug_log, "BLK_LOOP.NEXT_OP = 0x%"UVxf"\n",
 		PTR2UV(CX_LOOP_NEXTOP_GET(cx)));
-	PerlIO_printf(Perl_debug_log, "BLK_LOOP.ITERIX = %ld\n",
-		(long)cx->blk_loop.iterix);
+	/* XXX: not accurate for LAZYSV/IV */
 	PerlIO_printf(Perl_debug_log, "BLK_LOOP.ITERARY = 0x%"UVxf"\n",
-		PTR2UV(cx->blk_loop.iterary));
+		PTR2UV(cx->blk_loop.state_u.ary.ary));
+	PerlIO_printf(Perl_debug_log, "BLK_LOOP.ITERIX = %ld\n",
+		(long)cx->blk_loop.state_u.ary.ix);
 	PerlIO_printf(Perl_debug_log, "BLK_LOOP.ITERVAR = 0x%"UVxf"\n",
 		PTR2UV(CxITERVAR(cx)));
-	PerlIO_printf(Perl_debug_log, "BLK_LOOP.ITERLVAL = 0x%"UVxf"\n",
-		PTR2UV(cx->blk_loop.iterlval));
 	break;
 
     case CXt_SUBST:
@@ -1199,22 +1225,6 @@
     PERL_UNUSED_CONTEXT;
     PERL_UNUSED_ARG(cx);
 #endif	/* DEBUGGING */
-}
-
-/* This is rendered a mathom by the integration of change 33078. However, until
-   we have versioned mathom logic in mathoms.c, we can't move it there for
-   5.10.1, as other code in production may have linked to it.  */
-
-void
-Perl_save_padsv(pTHX_ PADOFFSET off)
-{
-    dVAR;
-    SSCHECK(4);
-    ASSERT_CURPAD_ACTIVE("save_padsv");
-    SSPUSHPTR(PL_curpad[off]);
-    SSPUSHPTR(PL_comppad);
-    SSPUSHLONG((long)off);
-    SSPUSHINT(SAVEt_PADSV);
 }
 
 /*
Index: src/gnu/usr.bin/perl/scope.h
diff -u src/gnu/usr.bin/perl/scope.h:1.12 src/gnu/usr.bin/perl/scope.h:1.13
--- scope.h:1.12	Mon Oct 12 18:24:22 2009
+++ scope.h	Fri Sep 24 15:06:43 2010
@@ -43,7 +43,7 @@
 #define SAVEt_I8		32
 #define SAVEt_COMPPAD		33
 #define SAVEt_GENERIC_PVREF	34
-#define SAVEt_PADSV		35
+#define SAVEt_PADSV_AND_MORTALIZE	35
 #define SAVEt_MORTALIZESV	36
 #define SAVEt_SHARED_PVREF	37
 #define SAVEt_BOOL		38
@@ -54,7 +54,13 @@
 #define SAVEt_COMPILE_WARNINGS	43
 #define SAVEt_STACK_CXPOS	44
 #define SAVEt_PARSER		45
-#define SAVEt_PADSV_AND_MORTALIZE	46
+#define SAVEt_ADELETE		46
+
+#define SAVEf_SETMAGIC		1
+#define SAVEf_KEEPOLDELEM	2
+
+#define save_aelem(av,idx,sptr)	save_aelem_flags(av,idx,sptr,SAVEf_SETMAGIC)
+#define save_helem(hv,key,sptr)	save_helem_flags(hv,key,sptr,SAVEf_SETMAGIC)
 
 #ifndef SCOPE_SAVES_SIGNAL_MASK
 #define SCOPE_SAVES_SIGNAL_MASK 0
@@ -94,6 +100,20 @@
 =for apidoc Ams||LEAVE
 Closing bracket on a callback.  See C<ENTER> and L<perlcall>.
 
+=over
+
+=item ENTER_with_name(name)
+
+Same as C<ENTER>, but when debugging is enabled it also associates the
+given literal string with the new scope.
+
+=item LEAVE_with_name(name)
+
+Same as C<LEAVE>, but when debugging is enabled it first checks that the
+scope has the given name. Name must be a literal string.
+
+=back
+
 =cut
 */
 
@@ -111,9 +131,28 @@
 	DEBUG_SCOPE("LEAVE")					\
 	pop_scope();						\
     } STMT_END
+#define ENTER_with_name(name)						\
+    STMT_START {							\
+	push_scope();							\
+	if (PL_scopestack_name)						\
+	    PL_scopestack_name[PL_scopestack_ix-1] = name;		\
+	DEBUG_SCOPE("ENTER \"" name "\"")				\
+    } STMT_END
+#define LEAVE_with_name(name)						\
+    STMT_START {							\
+	DEBUG_SCOPE("LEAVE \"" name "\"")				\
+	if (PL_scopestack_name)	{					\
+	    assert(((char*)PL_scopestack_name[PL_scopestack_ix-1]	\
+			== (char*)name)					\
+		    || strEQ(PL_scopestack_name[PL_scopestack_ix-1], name));        \
+	}								\
+	pop_scope();							\
+    } STMT_END
 #else
 #define ENTER push_scope()
 #define LEAVE pop_scope()
+#define ENTER_with_name(name) ENTER
+#define LEAVE_with_name(name) LEAVE
 #endif
 #define LEAVE_SCOPE(old) if (PL_savestack_ix > old) leave_scope(old)
 
@@ -127,7 +166,6 @@
 #define SAVESPTR(s)	save_sptr((SV**)&(s))
 #define SAVEPPTR(s)	save_pptr((char**)&(s))
 #define SAVEVPTR(s)	save_vptr((void*)&(s))
-#define SAVEPADSV(s)	save_padsv(s)
 #define SAVEPADSVANDMORTALIZE(s)	save_padsv_and_mortalize(s)
 #define SAVEFREESV(s)	save_freesv(MUTABLE_SV(s))
 #define SAVEMORTALIZESV(s)	save_mortalizesv(MUTABLE_SV(s))
@@ -140,6 +178,10 @@
 #define SAVESETSVFLAGS(sv,mask,val)	save_set_svflags(sv,mask,val)
 #define SAVEDELETE(h,k,l) \
 	  save_delete(MUTABLE_HV(h), (char*)(k), (I32)(l))
+#define SAVEHDELETE(h,s) \
+	  save_hdelete(MUTABLE_HV(h), (s))
+#define SAVEADELETE(a,k) \
+	  save_adelete(MUTABLE_AV(a), (I32)(k))
 #define SAVEDESTRUCTOR(f,p) \
 	  save_destructor((DESTRUCTORFUNC_NOCONTEXT_t)(f), (void*)(p))
 
@@ -190,15 +232,11 @@
 #  define SAVECOPSTASH_FREE(c)	SAVESHAREDPV(CopSTASHPV(c))
 #  define SAVECOPFILE(c)	SAVEPPTR(CopFILE(c))
 #  define SAVECOPFILE_FREE(c)	SAVESHAREDPV(CopFILE(c))
-#  define SAVECOPLABEL(c)	SAVEPPTR(CopLABEL(c))
-#  define SAVECOPLABEL_FREE(c)	SAVESHAREDPV(CopLABEL(c))
 #else
 #  define SAVECOPSTASH(c)	SAVESPTR(CopSTASH(c))
 #  define SAVECOPSTASH_FREE(c)	SAVECOPSTASH(c)	/* XXX not refcounted */
 #  define SAVECOPFILE(c)	SAVESPTR(CopFILEGV(c))
 #  define SAVECOPFILE_FREE(c)	SAVEGENERICSV(CopFILEGV(c))
-#  define SAVECOPLABEL(c)	SAVEPPTR(CopLABEL(c))
-#  define SAVECOPLABEL_FREE(c)	SAVEPPTR(CopLABEL(c))
 #endif
 
 #define SAVECOPLINE(c)		SAVEI32(CopLINE(c))
Index: src/gnu/usr.bin/perl/shlib_version
diff -u src/gnu/usr.bin/perl/shlib_version:1.12 src/gnu/usr.bin/perl/shlib_version:1.13
--- shlib_version:1.12	Mon Oct 12 18:24:22 2009
+++ shlib_version	Fri Sep 24 15:06:43 2010
@@ -1,2 +1,2 @@
-major=11
-minor=1
+major=12
+minor=0
Index: src/gnu/usr.bin/perl/sv.c
diff -u src/gnu/usr.bin/perl/sv.c:1.16 src/gnu/usr.bin/perl/sv.c:1.17
--- sv.c:1.16	Mon Oct 12 18:24:22 2009
+++ sv.c	Fri Sep 24 15:06:43 2010
@@ -164,7 +164,7 @@
  */
 
 void
-Perl_offer_nice_chunk(pTHX_ void *chunk, U32 chunk_size)
+Perl_offer_nice_chunk(pTHX_ void *const chunk, const U32 chunk_size)
 {
     dVAR;
     void *new_chunk;
@@ -353,10 +353,9 @@
 	    }
 	}
 	if (!ok) {
-	    if (ckWARN_d(WARN_INTERNAL))	
-	        Perl_warner(aTHX_ packWARN(WARN_INTERNAL),
-			    "Attempt to free non-arena SV: 0x%"UVxf
-                            pTHX__FORMAT, PTR2UV(p) pTHX__VALUE);
+	    Perl_ck_warner_d(aTHX_ packWARN(WARN_INTERNAL),
+			     "Attempt to free non-arena SV: 0x%"UVxf
+			     pTHX__FORMAT, PTR2UV(p) pTHX__VALUE);
 	    return;
 	}
     }
@@ -381,8 +380,8 @@
 =cut
 */
 
-void
-Perl_sv_add_arena(pTHX_ char *ptr, U32 size, U32 flags)
+static void
+S_sv_add_arena(pTHX_ char *const ptr, const U32 size, const U32 flags)
 {
     dVAR;
     SV *const sva = MUTABLE_SV(ptr);
@@ -422,7 +421,7 @@
  * whose flags field matches the flags/mask args. */
 
 STATIC I32
-S_visit(pTHX_ SVFUNC_t f, U32 flags, U32 mask)
+S_visit(pTHX_ SVFUNC_t f, const U32 flags, const U32 mask)
 {
     dVAR;
     SV* sva;
@@ -451,7 +450,7 @@
 /* called by sv_report_used() for each live SV */
 
 static void
-do_report_used(pTHX_ SV *sv)
+do_report_used(pTHX_ SV *const sv)
 {
     if (SvTYPE(sv) != SVTYPEMASK) {
 	PerlIO_printf(Perl_debug_log, "****\n");
@@ -481,7 +480,7 @@
 /* called by sv_clean_objs() for each live SV */
 
 static void
-do_clean_objs(pTHX_ SV *ref)
+do_clean_objs(pTHX_ SV *const ref)
 {
     dVAR;
     assert (SvROK(ref));
@@ -508,7 +507,7 @@
 
 #ifndef DISABLE_DESTRUCTOR_KLUDGE
 static void
-do_clean_named_objs(pTHX_ SV *sv)
+do_clean_named_objs(pTHX_ SV *const sv)
 {
     dVAR;
     assert(SvTYPE(sv) == SVt_PVGV);
@@ -557,7 +556,7 @@
 /* called by sv_clean_all() for each live SV */
 
 static void
-do_clean_all(pTHX_ SV *sv)
+do_clean_all(pTHX_ SV *const sv)
 {
     dVAR;
     if (sv == (const SV *) PL_fdpid || sv == (const SV *)PL_strtab) {
@@ -608,7 +607,7 @@
 struct arena_desc {
     char       *arena;		/* the raw storage, allocated aligned */
     size_t      size;		/* its size ~4k typ */
-    U32		misc;		/* type, and in future other things. */
+    svtype	utype;		/* bodytype stored in arena */
 };
 
 struct arena_set;
@@ -721,7 +720,7 @@
    TBD: export properly for hv.c: S_more_he().
 */
 void*
-Perl_get_arena(pTHX_ size_t arena_size, U32 misc)
+Perl_get_arena(pTHX_ const size_t arena_size, const svtype bodytype)
 {
     dVAR;
     struct arena_desc* adesc;
@@ -750,7 +749,7 @@
     
     Newx(adesc->arena, arena_size, char);
     adesc->size = arena_size;
-    adesc->misc = misc;
+    adesc->utype = bodytype;
     DEBUG_m(PerlIO_printf(Perl_debug_log, "arena %d added: %p size %"UVuf"\n", 
 			  curr, (void*)adesc->arena, (UV)arena_size));
 
@@ -936,9 +935,6 @@
     { sizeof(NV), sizeof(NV), 0, SVt_NV, FALSE, HADNV, HASARENA,
       FIT_ARENA(0, sizeof(NV)) },
 
-    /* RVs are in the head now.  */
-    { 0, 0, 0, SVt_RV, FALSE, NONV, NOARENA, 0 },
-
     /* 8 bytes on most ILP32 with IEEE doubles */
     { sizeof(XPV) - STRUCT_OFFSET(XPV, xpv_cur),
       copy_length(XPV, xpv_len) - STRUCT_OFFSET(XPV, xpv_cur),
@@ -960,7 +956,15 @@
     /* 28 */
     { sizeof(XPVMG), copy_length(XPVMG, xmg_stash), 0, SVt_PVMG, FALSE, HADNV,
       HASARENA, FIT_ARENA(0, sizeof(XPVMG)) },
-    
+
+    /* something big */
+    { sizeof(regexp) - STRUCT_OFFSET(regexp, xpv_cur),
+      sizeof(regexp) - STRUCT_OFFSET(regexp, xpv_cur),
+      + STRUCT_OFFSET(regexp, xpv_cur),
+      SVt_REGEXP, FALSE, NONV, HASARENA,
+      FIT_ARENA(0, sizeof(regexp) - STRUCT_OFFSET(regexp, xpv_cur))
+    },
+
     /* 48 */
     { sizeof(XPVGV), sizeof(XPVGV), 0, SVt_PVGV, TRUE, HADNV,
       HASARENA, FIT_ARENA(0, sizeof(XPVGV)) },
@@ -995,8 +999,11 @@
       FIT_ARENA(20, sizeof(XPVFM) - STRUCT_OFFSET(XPVFM, xpv_cur)) },
 
     /* XPVIO is 84 bytes, fits 48x */
-    { sizeof(XPVIO), sizeof(XPVIO), 0, SVt_PVIO, TRUE, HADNV,
-      HASARENA, FIT_ARENA(24, sizeof(XPVIO)) },
+    { sizeof(XPVIO) - STRUCT_OFFSET(XPVIO, xpv_cur),
+      sizeof(XPVIO) - STRUCT_OFFSET(XPVIO, xpv_cur),
+      + STRUCT_OFFSET(XPVIO, xpv_cur),
+      SVt_PVIO, TRUE, NONV, HASARENA,
+      FIT_ARENA(24, sizeof(XPVIO) - STRUCT_OFFSET(XPVIO, xpv_cur)) },
 };
 
 #define new_body_type(sv_type)		\
@@ -1068,7 +1075,7 @@
 	my_safecalloc((details)->body_size + (details)->offset)
 
 STATIC void *
-S_more_bodies (pTHX_ svtype sv_type)
+S_more_bodies (pTHX_ const svtype sv_type)
 {
     dVAR;
     void ** const root = &PL_body_roots[sv_type];
@@ -1140,7 +1147,7 @@
 #ifndef PURIFY
 
 STATIC void *
-S_new_body(pTHX_ svtype sv_type)
+S_new_body(pTHX_ const svtype sv_type)
 {
     dVAR;
     void *xpv;
@@ -1150,6 +1157,9 @@
 
 #endif
 
+static const struct body_details fake_rv =
+    { 0, 0, 0, SVt_IV, FALSE, NONV, NOARENA, 0 };
+
 /*
 =for apidoc sv_upgrade
 
@@ -1161,25 +1171,35 @@
 */
 
 void
-Perl_sv_upgrade(pTHX_ register SV *sv, svtype new_type)
+Perl_sv_upgrade(pTHX_ register SV *const sv, svtype new_type)
 {
     dVAR;
     void*	old_body;
     void*	new_body;
     const svtype old_type = SvTYPE(sv);
     const struct body_details *new_type_details;
-    const struct body_details *const old_type_details
+    const struct body_details *old_type_details
 	= bodies_by_type + old_type;
+    SV *referant = NULL;
 
     PERL_ARGS_ASSERT_SV_UPGRADE;
 
+    if (old_type == new_type)
+	return;
+
+    /* This clause was purposefully added ahead of the early return above to
+       the shared string hackery for (sort {$a <=> $b} keys %hash), with the
+       inference by Nick I-S that it would fix other troublesome cases. See
+       changes 7162, 7163 (f130fd4589cf5fbb24149cd4db4137c8326f49c1 and parent)
+
+       Given that shared hash key scalars are no longer PVIV, but PV, there is
+       no longer need to unshare so as to free up the IVX slot for its proper
+       purpose. So it's safe to move the early return earlier.  */
+
     if (new_type != SVt_PV && SvIsCOW(sv)) {
 	sv_force_normal_flags(sv, 0);
     }
 
-    if (old_type == new_type)
-	return;
-
     old_body = SvANY(sv);
 
     /* Copying structures onto other structures that have been neatly zeroed
@@ -1224,9 +1244,16 @@
     case SVt_NULL:
 	break;
     case SVt_IV:
-	if (new_type < SVt_PVIV) {
-	    new_type = (new_type == SVt_NV)
-		? SVt_PVNV : SVt_PVIV;
+	if (SvROK(sv)) {
+	    referant = SvRV(sv);
+	    old_type_details = &fake_rv;
+	    if (new_type == SVt_NV)
+		new_type = SVt_PVNV;
+	} else {
+	    if (new_type < SVt_PVIV) {
+		new_type = (new_type == SVt_NV)
+		    ? SVt_PVNV : SVt_PVIV;
+	    }
 	}
 	break;
     case SVt_NV:
@@ -1234,8 +1261,6 @@
 	    new_type = SVt_PVNV;
 	}
 	break;
-    case SVt_RV:
-	break;
     case SVt_PV:
 	assert(new_type > SVt_PV);
 	assert(SVt_IV < SVt_PV);
@@ -1284,11 +1309,6 @@
 	SvANY(sv) = new_XNV();
 	SvNV_set(sv, 0);
 	return;
-    case SVt_RV:
-	assert(old_type == SVt_NULL);
-	SvANY(sv) = &sv->sv_u.svu_rv;
-	SvRV_set(sv, 0);
-	return;
     case SVt_PVHV:
     case SVt_PVAV:
 	assert(new_type_details->body_size);
@@ -1337,7 +1357,9 @@
 	   The target created by newSVrv also is, and it can have magic.
 	   However, it never has SvPVX set.
 	*/
-	if (old_type >= SVt_RV) {
+	if (old_type == SVt_IV) {
+	    assert(!SvROK(sv));
+	} else if (old_type >= SVt_PV) {
 	    assert(SvPVX_const(sv) == 0);
 	}
 
@@ -1350,6 +1372,10 @@
 	break;
 
 
+    case SVt_REGEXP:
+	/* This ensures that SvTHINKFIRST(sv) is true, and hence that
+	   sv_force_normal_flags(sv) is called.  */
+	SvFAKE_on(sv);
     case SVt_PVIV:
 	/* XXX Is this still needed?  Was it ever needed?   Surely as there is
 	   no route from NV to PVIV, NOK can never be true  */
@@ -1406,24 +1432,37 @@
 	    SvNV_set(sv, 0);
 #endif
 
-	if (new_type == SVt_PVIO)
+	if (new_type == SVt_PVIO) {
+	    IO * const io = MUTABLE_IO(sv);
+	    GV *iogv = gv_fetchpvs("IO::File::", GV_ADD, SVt_PVHV);
+
+	    SvOBJECT_on(io);
+	    /* Clear the stashcache because a new IO could overrule a package
+	       name */
+	    hv_clear(PL_stashcache);
+
+	    SvSTASH_set(io, MUTABLE_HV(SvREFCNT_inc(GvHV(iogv))));
 	    IoPAGE_LEN(sv) = 60;
-	if (old_type < SVt_RV)
-	    SvPV_set(sv, NULL);
+	}
+	if (old_type < SVt_PV) {
+	    /* referant will be NULL unless the old type was SVt_IV emulating
+	       SVt_RV */
+	    sv->sv_u.svu_rv = referant;
+	}
 	break;
     default:
 	Perl_croak(aTHX_ "panic: sv_upgrade to unknown type %lu",
 		   (unsigned long)new_type);
     }
 
-    if (old_type_details->arena) {
-	/* If there was an old body, then we need to free it.
-	   Note that there is an assumption that all bodies of types that
-	   can be upgraded came from arenas. Only the more complex non-
-	   upgradable types are allowed to be directly malloc()ed.  */
+    if (old_type > SVt_IV) { /* SVt_IVs are overloaded for PTEs */
 #ifdef PURIFY
 	my_safefree(old_body);
 #else
+	/* Note that there is an assumption that all bodies of types that
+	   can be upgraded came from arenas. Only the more complex non-
+	   upgradable types are allowed to be directly malloc()ed.  */
+	assert(old_type_details->arena);
 	del_body((void*)((char*)old_body + old_type_details->offset),
 		 &PL_body_roots[old_type]);
 #endif
@@ -1440,31 +1479,23 @@
 */
 
 int
-Perl_sv_backoff(pTHX_ register SV *sv)
+Perl_sv_backoff(pTHX_ register SV *const sv)
 {
+    STRLEN delta;
+    const char * const s = SvPVX_const(sv);
+
     PERL_ARGS_ASSERT_SV_BACKOFF;
     PERL_UNUSED_CONTEXT;
 
     assert(SvOOK(sv));
     assert(SvTYPE(sv) != SVt_PVHV);
     assert(SvTYPE(sv) != SVt_PVAV);
-    if (SvIVX(sv)) {
-	const char * const s = SvPVX_const(sv);
-#ifdef DEBUGGING
-	/* Validate the preceding buffer's sentinels to verify that no-one is
-	   using it.  */
-	const U8 *p = (const U8*) s;
-	const U8 *const real_start = p - SvIVX(sv);
-	while (p > real_start) {
-	    --p;
-	    assert (*p == (U8)PTR2UV(p));
-	}
-#endif
-	SvLEN_set(sv, SvLEN(sv) + SvIVX(sv));
-	SvPV_set(sv, SvPVX(sv) - SvIVX(sv));
-	SvIV_set(sv, 0);
-	Move(s, SvPVX(sv), SvCUR(sv)+1, char);
-    }
+
+    SvOOK_offset(sv, delta);
+    
+    SvLEN_set(sv, SvLEN(sv) + delta);
+    SvPV_set(sv, SvPVX(sv) - delta);
+    Move(s, SvPVX(sv), SvCUR(sv)+1, char);
     SvFLAGS(sv) &= ~SVf_OOK;
     return 0;
 }
@@ -1480,7 +1511,7 @@
 */
 
 char *
-Perl_sv_grow(pTHX_ register SV *sv, register STRLEN newlen)
+Perl_sv_grow(pTHX_ register SV *const sv, register STRLEN newlen)
 {
     register char *s;
 
@@ -1552,7 +1583,7 @@
 */
 
 void
-Perl_sv_setiv(pTHX_ register SV *sv, IV i)
+Perl_sv_setiv(pTHX_ register SV *const sv, const IV i)
 {
     dVAR;
 
@@ -1564,7 +1595,6 @@
     case SVt_NV:
 	sv_upgrade(sv, SVt_IV);
 	break;
-    case SVt_RV:
     case SVt_PV:
 	sv_upgrade(sv, SVt_PVIV);
 	break;
@@ -1595,7 +1625,7 @@
 */
 
 void
-Perl_sv_setiv_mg(pTHX_ register SV *sv, IV i)
+Perl_sv_setiv_mg(pTHX_ register SV *const sv, const IV i)
 {
     PERL_ARGS_ASSERT_SV_SETIV_MG;
 
@@ -1613,7 +1643,7 @@
 */
 
 void
-Perl_sv_setuv(pTHX_ register SV *sv, UV u)
+Perl_sv_setuv(pTHX_ register SV *const sv, const UV u)
 {
     PERL_ARGS_ASSERT_SV_SETUV;
 
@@ -1643,7 +1673,7 @@
 */
 
 void
-Perl_sv_setuv_mg(pTHX_ register SV *sv, UV u)
+Perl_sv_setuv_mg(pTHX_ register SV *const sv, const UV u)
 {
     PERL_ARGS_ASSERT_SV_SETUV_MG;
 
@@ -1661,7 +1691,7 @@
 */
 
 void
-Perl_sv_setnv(pTHX_ register SV *sv, NV num)
+Perl_sv_setnv(pTHX_ register SV *const sv, const NV num)
 {
     dVAR;
 
@@ -1673,7 +1703,6 @@
     case SVt_IV:
 	sv_upgrade(sv, SVt_NV);
 	break;
-    case SVt_RV:
     case SVt_PV:
     case SVt_PVIV:
 	sv_upgrade(sv, SVt_PVNV);
@@ -1705,7 +1734,7 @@
 */
 
 void
-Perl_sv_setnv_mg(pTHX_ register SV *sv, NV num)
+Perl_sv_setnv_mg(pTHX_ register SV *const sv, const NV num)
 {
     PERL_ARGS_ASSERT_SV_SETNV_MG;
 
@@ -1718,7 +1747,7 @@
  */
 
 STATIC void
-S_not_a_number(pTHX_ SV *sv)
+S_not_a_number(pTHX_ SV *const sv)
 {
      dVAR;
      SV *dsv;
@@ -1801,7 +1830,7 @@
 */
 
 I32
-Perl_looks_like_number(pTHX_ SV *sv)
+Perl_looks_like_number(pTHX_ SV *const sv)
 {
     register const char *sbegin;
     STRLEN len;
@@ -1842,27 +1871,6 @@
     return TRUE;
 }
 
-STATIC char *
-S_glob_2pv(pTHX_ GV * const gv, STRLEN * const len)
-{
-    const U32 wasfake = SvFLAGS(gv) & SVf_FAKE;
-    SV *const buffer = sv_newmortal();
-
-    PERL_ARGS_ASSERT_GLOB_2PV;
-
-    /* FAKE globs can get coerced, so need to turn this off temporarily if it
-       is on.  */
-    SvFAKE_off(gv);
-    gv_efullname3(buffer, gv, "*");
-    SvFLAGS(gv) |= wasfake;
-
-    assert(SvPOK(buffer));
-    if (len) {
-	*len = SvCUR(buffer);
-    }
-    return SvPVX(buffer);
-}
-
 /* Actually, ISO C leaves conversion of UV to IV undefined, but
    until proven guilty, assume that things are not that bad... */
 
@@ -1948,7 +1956,7 @@
 
 /* For sv_2nv these three cases are "SvNOK and don't bother casting"  */
 STATIC int
-S_sv_2iuv_non_preserve(pTHX_ register SV *sv
+S_sv_2iuv_non_preserve(pTHX_ register SV *const sv
 #  ifdef DEBUGGING
 		       , I32 numtype
 #  endif
@@ -2003,7 +2011,7 @@
 #endif /* !NV_PRESERVES_UV*/
 
 STATIC bool
-S_sv_2iuv_common(pTHX_ SV *sv)
+S_sv_2iuv_common(pTHX_ SV *const sv)
 {
     dVAR;
 
@@ -2283,7 +2291,7 @@
 */
 
 IV
-Perl_sv_2iv_flags(pTHX_ register SV *sv, I32 flags)
+Perl_sv_2iv_flags(pTHX_ register SV *const sv, const I32 flags)
 {
     dVAR;
     if (!sv)
@@ -2367,7 +2375,7 @@
 */
 
 UV
-Perl_sv_2uv_flags(pTHX_ register SV *sv, I32 flags)
+Perl_sv_2uv_flags(pTHX_ register SV *const sv, const I32 flags)
 {
     dVAR;
     if (!sv)
@@ -2444,7 +2452,7 @@
 */
 
 NV
-Perl_sv_2nv(pTHX_ register SV *sv)
+Perl_sv_2nv(pTHX_ register SV *const sv)
 {
     dVAR;
     if (!sv)
@@ -2669,7 +2677,7 @@
 */
 
 SV *
-Perl_sv_2num(pTHX_ register SV *sv)
+Perl_sv_2num(pTHX_ register SV *const sv)
 {
     PERL_ARGS_ASSERT_SV_2NUM;
 
@@ -2691,7 +2699,7 @@
  */
 
 static char *
-S_uiv_2buf(char *buf, IV iv, UV uv, int is_uv, char **peob)
+S_uiv_2buf(char *const buf, const IV iv, UV uv, const int is_uv, char **const peob)
 {
     char *ptr = buf + TYPE_CHARS(UV);
     char * const ebuf = ptr;
@@ -2730,7 +2738,7 @@
 */
 
 char *
-Perl_sv_2pv_flags(pTHX_ register SV *sv, STRLEN *lp, I32 flags)
+Perl_sv_2pv_flags(pTHX_ register SV *const sv, STRLEN *const lp, const I32 flags)
 {
     dVAR;
     register char *s;
@@ -2824,28 +2832,31 @@
 		STRLEN len;
 		char *retval;
 		char *buffer;
-		MAGIC *mg;
 		SV *const referent = SvRV(sv);
 
 		if (!referent) {
 		    len = 7;
 		    retval = buffer = savepvn("NULLREF", len);
-		} else if (SvTYPE(referent) == SVt_PVMG
-			   && ((SvFLAGS(referent) &
-				(SVs_OBJECT|SVf_OK|SVs_GMG|SVs_SMG|SVs_RMG))
-			       == (SVs_OBJECT|SVs_SMG))
-			   && (mg = mg_find(referent, PERL_MAGIC_qr)))
-                {
-                    char *str = NULL;
-                    I32 haseval = 0;
-                    U32 flags = 0;
-                    (str) = CALLREG_AS_STR(mg,lp,&flags,&haseval);
-                    if (flags & 1)
-	                SvUTF8_on(sv);
-                    else
-	                SvUTF8_off(sv);
-                    PL_reginterp_cnt += haseval;
-		    return str;
+		} else if (SvTYPE(referent) == SVt_REGEXP) {
+		    REGEXP * const re = (REGEXP *)MUTABLE_PTR(referent);
+		    I32 seen_evals = 0;
+
+		    assert(re);
+			
+		    /* If the regex is UTF-8 we want the containing scalar to
+		       have an UTF-8 flag too */
+		    if (RX_UTF8(re))
+			SvUTF8_on(sv);
+		    else
+			SvUTF8_off(sv);	
+
+		    if ((seen_evals = RX_SEEN_EVALS(re)))
+			PL_reginterp_cnt += seen_evals;
+
+		    if (lp)
+			*lp = RX_WRAPLEN(re);
+ 
+		    return RX_WRAPPED(re);
 		} else {
 		    const char *const typestr = sv_reftype(referent, 0);
 		    const STRLEN typelen = strlen(typestr);
@@ -2911,10 +2922,12 @@
 	    }
 	}
 	if (SvREADONLY(sv) && !SvOK(sv)) {
-	    if (ckWARN(WARN_UNINITIALIZED))
-		report_uninit(sv);
 	    if (lp)
 		*lp = 0;
+	    if (flags & SV_UNDEF_RETURNS_NULL)
+		return NULL;
+	    if (ckWARN(WARN_UNINITIALIZED))
+		report_uninit(sv);
 	    return (char *)"";
 	}
     }
@@ -2965,13 +2978,36 @@
 #endif
     }
     else {
-	if (isGV_with_GP(sv))
-	    return glob_2pv(MUTABLE_GV(sv), lp);
+	if (isGV_with_GP(sv)) {
+	    GV *const gv = MUTABLE_GV(sv);
+	    const U32 wasfake = SvFLAGS(gv) & SVf_FAKE;
+	    SV *const buffer = sv_newmortal();
+
+	    /* FAKE globs can get coerced, so need to turn this off temporarily
+	       if it is on.  */
+	    SvFAKE_off(gv);
+	    gv_efullname3(buffer, gv, "*");
+	    SvFLAGS(gv) |= wasfake;
+
+	    if (SvPOK(buffer)) {
+		if (lp) {
+		    *lp = SvCUR(buffer);
+		}
+		return SvPVX(buffer);
+	    }
+	    else {
+		if (lp)
+		    *lp = 0;
+		return (char *)"";
+	    }
+	}
 
-	if (!PL_localizing && !(SvFLAGS(sv) & SVs_PADTMP) && ckWARN(WARN_UNINITIALIZED))
-	    report_uninit(sv);
 	if (lp)
 	    *lp = 0;
+	if (flags & SV_UNDEF_RETURNS_NULL)
+	    return NULL;
+	if (!PL_localizing && !(SvFLAGS(sv) & SVs_PADTMP) && ckWARN(WARN_UNINITIALIZED))
+	    report_uninit(sv);
 	if (SvTYPE(sv) < SVt_PV)
 	    /* Typically the caller expects that sv_any is not NULL now.  */
 	    sv_upgrade(sv, SVt_PV);
@@ -3008,7 +3044,7 @@
 */
 
 void
-Perl_sv_copypv(pTHX_ SV *dsv, register SV *ssv)
+Perl_sv_copypv(pTHX_ SV *const dsv, register SV *const ssv)
 {
     STRLEN len;
     const char * const s = SvPV_const(ssv,len);
@@ -3035,7 +3071,7 @@
 */
 
 char *
-Perl_sv_2pvbyte(pTHX_ register SV *sv, STRLEN *lp)
+Perl_sv_2pvbyte(pTHX_ register SV *const sv, STRLEN *const lp)
 {
     PERL_ARGS_ASSERT_SV_2PVBYTE;
 
@@ -3055,7 +3091,7 @@
 */
 
 char *
-Perl_sv_2pvutf8(pTHX_ register SV *sv, STRLEN *lp)
+Perl_sv_2pvutf8(pTHX_ register SV *const sv, STRLEN *const lp)
 {
     PERL_ARGS_ASSERT_SV_2PVUTF8;
 
@@ -3074,7 +3110,7 @@
 */
 
 bool
-Perl_sv_2bool(pTHX_ register SV *sv)
+Perl_sv_2bool(pTHX_ register SV *const sv)
 {
     dVAR;
 
@@ -3150,14 +3186,44 @@
 use the Encode extension for that.
 
 =cut
+
+The grow version is currently not externally documented.  It adds a parameter,
+extra, which is the number of unused bytes the string of 'sv' is guaranteed to
+have free after it upon return.  This allows the caller to reserve extra space
+that it intends to fill, to avoid extra grows.
+
+Also externally undocumented for the moment is the flag SV_FORCE_UTF8_UPGRADE,
+which can be used to tell this function to not first check to see if there are
+any characters that are different in UTF-8 (variant characters) which would
+force it to allocate a new string to sv, but to assume there are.  Typically
+this flag is used by a routine that has already parsed the string to find that
+there are such characters, and passes this information on so that the work
+doesn't have to be repeated.
+
+(One might think that the calling routine could pass in the position of the
+first such variant, so it wouldn't have to be found again.  But that is not the
+case, because typically when the caller is likely to use this flag, it won't be
+calling this routine unless it finds something that won't fit into a byte.
+Otherwise it tries to not upgrade and just use bytes.  But some things that
+do fit into a byte are variants in utf8, and the caller may not have been
+keeping track of these.)
+
+If the routine itself changes the string, it adds a trailing NUL.  Such a NUL
+isn't guaranteed due to having other routines do the work in some input cases,
+or if the input is already flagged as being in utf8.
+
+The speed of this could perhaps be improved for many cases if someone wanted to
+write a fast function that counts the number of variant characters in a string,
+especially if it could return the position of the first one.
+
 */
 
 STRLEN
-Perl_sv_utf8_upgrade_flags(pTHX_ register SV *sv, I32 flags)
+Perl_sv_utf8_upgrade_flags_grow(pTHX_ register SV *const sv, const I32 flags, STRLEN extra)
 {
     dVAR;
 
-    PERL_ARGS_ASSERT_SV_UTF8_UPGRADE_FLAGS;
+    PERL_ARGS_ASSERT_SV_UTF8_UPGRADE_FLAGS_GROW;
 
     if (sv == &PL_sv_undef)
 	return 0;
@@ -3165,14 +3231,17 @@
 	STRLEN len = 0;
 	if (SvREADONLY(sv) && (SvPOKp(sv) || SvIOKp(sv) || SvNOKp(sv))) {
 	    (void) sv_2pv_flags(sv,&len, flags);
-	    if (SvUTF8(sv))
+	    if (SvUTF8(sv)) {
+		if (extra) SvGROW(sv, SvCUR(sv) + extra);
 		return len;
+	    }
 	} else {
 	    (void) SvPV_force(sv,len);
 	}
     }
 
     if (SvUTF8(sv)) {
+	if (extra) SvGROW(sv, SvCUR(sv) + extra);
 	return SvCUR(sv);
     }
 
@@ -3180,42 +3249,206 @@
         sv_force_normal_flags(sv, 0);
     }
 
-    if (PL_encoding && !(flags & SV_UTF8_NO_ENCODING))
+    if (PL_encoding && !(flags & SV_UTF8_NO_ENCODING)) {
         sv_recode_to_utf8(sv, PL_encoding);
-    else { /* Assume Latin-1/EBCDIC */
+	if (extra) SvGROW(sv, SvCUR(sv) + extra);
+	return SvCUR(sv);
+    }
+
+    if (SvCUR(sv) == 0) {
+	if (extra) SvGROW(sv, extra);
+    } else { /* Assume Latin-1/EBCDIC */
 	/* This function could be much more efficient if we
 	 * had a FLAG in SVs to signal if there are any variant
 	 * chars in the PV.  Given that there isn't such a flag
-	 * make the loop as fast as possible. */
-	const U8 * const s = (U8 *) SvPVX_const(sv);
-	const U8 * const e = (U8 *) SvEND(sv);
-	const U8 *t = s;
+	 * make the loop as fast as possible (although there are certainly ways
+	 * to speed this up, eg. through vectorization) */
+	U8 * s = (U8 *) SvPVX_const(sv);
+	U8 * e = (U8 *) SvEND(sv);
+	U8 *t = s;
+	STRLEN two_byte_count = 0;
 	
+	if (flags & SV_FORCE_UTF8_UPGRADE) goto must_be_utf8;
+
+	/* See if really will need to convert to utf8.  We mustn't rely on our
+	 * incoming SV being well formed and having a trailing '\0', as certain
+	 * code in pp_formline can send us partially built SVs. */
+
 	while (t < e) {
 	    const U8 ch = *t++;
-	    /* Check for variant */
-	    if (!NATIVE_IS_INVARIANT(ch)) {
-		STRLEN len = SvCUR(sv);
-		/* *Currently* bytes_to_utf8() adds a '\0' after every string
-		   it converts. This isn't documented. It's not clear if it's
-		   a bad thing to be doing, and should be changed to do exactly
-		   what the documentation says. If so, this code will have to
-		   be changed.
-		   As is, we mustn't rely on our incoming SV being well formed
-		   and having a trailing '\0', as certain code in pp_formline
-		   can send us partially built SVs. */
-		U8 * const recoded = bytes_to_utf8((U8*)s, &len);
+	    if (NATIVE_IS_INVARIANT(ch)) continue;
 
-		SvPV_free(sv); /* No longer using what was there before. */
-		SvPV_set(sv, (char*)recoded);
-		SvCUR_set(sv, len);
-		SvLEN_set(sv, len + 1); /* No longer know the real size. */
-		break;
-	    }
+	    t--;    /* t already incremented; re-point to first variant */
+	    two_byte_count = 1;
+	    goto must_be_utf8;
 	}
-	/* Mark as UTF-8 even if no variant - saves scanning loop */
+
+	/* utf8 conversion not needed because all are invariants.  Mark as
+	 * UTF-8 even if no variant - saves scanning loop */
 	SvUTF8_on(sv);
+	return SvCUR(sv);
+
+must_be_utf8:
+
+	/* Here, the string should be converted to utf8, either because of an
+	 * input flag (two_byte_count = 0), or because a character that
+	 * requires 2 bytes was found (two_byte_count = 1).  t points either to
+	 * the beginning of the string (if we didn't examine anything), or to
+	 * the first variant.  In either case, everything from s to t - 1 will
+	 * occupy only 1 byte each on output.
+	 *
+	 * There are two main ways to convert.  One is to create a new string
+	 * and go through the input starting from the beginning, appending each
+	 * converted value onto the new string as we go along.  It's probably
+	 * best to allocate enough space in the string for the worst possible
+	 * case rather than possibly running out of space and having to
+	 * reallocate and then copy what we've done so far.  Since everything
+	 * from s to t - 1 is invariant, the destination can be initialized
+	 * with these using a fast memory copy
+	 *
+	 * The other way is to figure out exactly how big the string should be
+	 * by parsing the entire input.  Then you don't have to make it big
+	 * enough to handle the worst possible case, and more importantly, if
+	 * the string you already have is large enough, you don't have to
+	 * allocate a new string, you can copy the last character in the input
+	 * string to the final position(s) that will be occupied by the
+	 * converted string and go backwards, stopping at t, since everything
+	 * before that is invariant.
+	 *
+	 * There are advantages and disadvantages to each method.
+	 *
+	 * In the first method, we can allocate a new string, do the memory
+	 * copy from the s to t - 1, and then proceed through the rest of the
+	 * string byte-by-byte.
+	 *
+	 * In the second method, we proceed through the rest of the input
+	 * string just calculating how big the converted string will be.  Then
+	 * there are two cases:
+	 *  1)	if the string has enough extra space to handle the converted
+	 *	value.  We go backwards through the string, converting until we
+	 *	get to the position we are at now, and then stop.  If this
+	 *	position is far enough along in the string, this method is
+	 *	faster than the other method.  If the memory copy were the same
+	 *	speed as the byte-by-byte loop, that position would be about
+	 *	half-way, as at the half-way mark, parsing to the end and back
+	 *	is one complete string's parse, the same amount as starting
+	 *	over and going all the way through.  Actually, it would be
+	 *	somewhat less than half-way, as it's faster to just count bytes
+	 *	than to also copy, and we don't have the overhead of allocating
+	 *	a new string, changing the scalar to use it, and freeing the
+	 *	existing one.  But if the memory copy is fast, the break-even
+	 *	point is somewhere after half way.  The counting loop could be
+	 *	sped up by vectorization, etc, to move the break-even point
+	 *	further towards the beginning.
+	 *  2)	if the string doesn't have enough space to handle the converted
+	 *	value.  A new string will have to be allocated, and one might
+	 *	as well, given that, start from the beginning doing the first
+	 *	method.  We've spent extra time parsing the string and in
+	 *	exchange all we've gotten is that we know precisely how big to
+	 *	make the new one.  Perl is more optimized for time than space,
+	 *	so this case is a loser.
+	 * So what I've decided to do is not use the 2nd method unless it is
+	 * guaranteed that a new string won't have to be allocated, assuming
+	 * the worst case.  I also decided not to put any more conditions on it
+	 * than this, for now.  It seems likely that, since the worst case is
+	 * twice as big as the unknown portion of the string (plus 1), we won't
+	 * be guaranteed enough space, causing us to go to the first method,
+	 * unless the string is short, or the first variant character is near
+	 * the end of it.  In either of these cases, it seems best to use the
+	 * 2nd method.  The only circumstance I can think of where this would
+	 * be really slower is if the string had once had much more data in it
+	 * than it does now, but there is still a substantial amount in it  */
+
+	{
+	    STRLEN invariant_head = t - s;
+	    STRLEN size = invariant_head + (e - t) * 2 + 1 + extra;
+	    if (SvLEN(sv) < size) {
+
+		/* Here, have decided to allocate a new string */
+
+		U8 *dst;
+		U8 *d;
+
+		Newx(dst, size, U8);
+
+		/* If no known invariants at the beginning of the input string,
+		 * set so starts from there.  Otherwise, can use memory copy to
+		 * get up to where we are now, and then start from here */
+
+		if (invariant_head <= 0) {
+		    d = dst;
+		} else {
+		    Copy(s, dst, invariant_head, char);
+		    d = dst + invariant_head;
+		}
+
+		while (t < e) {
+		    const UV uv = NATIVE8_TO_UNI(*t++);
+		    if (UNI_IS_INVARIANT(uv))
+			*d++ = (U8)UNI_TO_NATIVE(uv);
+		    else {
+			*d++ = (U8)UTF8_EIGHT_BIT_HI(uv);
+			*d++ = (U8)UTF8_EIGHT_BIT_LO(uv);
+		    }
+		}
+		*d = '\0';
+		SvPV_free(sv); /* No longer using pre-existing string */
+		SvPV_set(sv, (char*)dst);
+		SvCUR_set(sv, d - dst);
+		SvLEN_set(sv, size);
+	    } else {
+
+		/* Here, have decided to get the exact size of the string.
+		 * Currently this happens only when we know that there is
+		 * guaranteed enough space to fit the converted string, so
+		 * don't have to worry about growing.  If two_byte_count is 0,
+		 * then t points to the first byte of the string which hasn't
+		 * been examined yet.  Otherwise two_byte_count is 1, and t
+		 * points to the first byte in the string that will expand to
+		 * two.  Depending on this, start examining at t or 1 after t.
+		 * */
+
+		U8 *d = t + two_byte_count;
+
+
+		/* Count up the remaining bytes that expand to two */
+
+		while (d < e) {
+		    const U8 chr = *d++;
+		    if (! NATIVE_IS_INVARIANT(chr)) two_byte_count++;
+		}
+
+		/* The string will expand by just the number of bytes that
+		 * occupy two positions.  But we are one afterwards because of
+		 * the increment just above.  This is the place to put the
+		 * trailing NUL, and to set the length before we decrement */
+
+		d += two_byte_count;
+		SvCUR_set(sv, d - s);
+		*d-- = '\0';
+
+
+		/* Having decremented d, it points to the position to put the
+		 * very last byte of the expanded string.  Go backwards through
+		 * the string, copying and expanding as we go, stopping when we
+		 * get to the part that is invariant the rest of the way down */
+
+		e--;
+		while (e >= t) {
+		    const U8 ch = NATIVE8_TO_UNI(*e--);
+		    if (UNI_IS_INVARIANT(ch)) {
+			*d-- = UNI_TO_NATIVE(ch);
+		    } else {
+			*d-- = (U8)UTF8_EIGHT_BIT_LO(ch);
+			*d-- = (U8)UTF8_EIGHT_BIT_HI(ch);
+		    }
+		}
+	    }
+	}
     }
+
+    /* Mark as UTF-8 even if no variant - saves scanning loop */
+    SvUTF8_on(sv);
     return SvCUR(sv);
 }
 
@@ -3235,7 +3468,7 @@
 */
 
 bool
-Perl_sv_utf8_downgrade(pTHX_ register SV* sv, bool fail_ok)
+Perl_sv_utf8_downgrade(pTHX_ register SV *const sv, const bool fail_ok)
 {
     dVAR;
 
@@ -3278,7 +3511,7 @@
 */
 
 void
-Perl_sv_utf8_encode(pTHX_ register SV *sv)
+Perl_sv_utf8_encode(pTHX_ register SV *const sv)
 {
     PERL_ARGS_ASSERT_SV_UTF8_ENCODE;
 
@@ -3305,7 +3538,7 @@
 */
 
 bool
-Perl_sv_utf8_decode(pTHX_ register SV *sv)
+Perl_sv_utf8_decode(pTHX_ register SV *const sv)
 {
     PERL_ARGS_ASSERT_SV_UTF8_DECODE;
 
@@ -3373,7 +3606,7 @@
 */
 
 static void
-S_glob_assign_glob(pTHX_ SV *dstr, SV *sstr, const int dtype)
+S_glob_assign_glob(pTHX_ SV *const dstr, SV *const sstr, const int dtype)
 {
     I32 mro_changes = 0; /* 1 = method, 2 = isa */
 
@@ -3402,12 +3635,6 @@
 	SvFAKE_on(dstr);	/* can coerce to non-glob */
     }
 
-#ifdef GV_UNIQUE_CHECK
-    if (GvUNIQUE((const GV *)dstr)) {
-	Perl_croak(aTHX_ "%s", PL_no_modify);
-    }
-#endif
-
     if(GvGP(MUTABLE_GV(sstr))) {
         /* If source has method cache entry, clear it */
         if(GvCVGEN(sstr)) {
@@ -3450,7 +3677,7 @@
 }
 
 static void
-S_glob_assign_ref(pTHX_ SV *dstr, SV *sstr)
+S_glob_assign_ref(pTHX_ SV *const dstr, SV *const sstr)
 {
     SV * const sref = SvREFCNT_inc(SvRV(sstr));
     SV *dref = NULL;
@@ -3458,16 +3685,9 @@
     SV **location;
     U8 import_flag = 0;
     const U32 stype = SvTYPE(sref);
-    bool mro_changes = FALSE;
 
     PERL_ARGS_ASSERT_GLOB_ASSIGN_REF;
 
-#ifdef GV_UNIQUE_CHECK
-    if (GvUNIQUE((const GV *)dstr)) {
-	Perl_croak(aTHX_ "%s", PL_no_modify);
-    }
-#endif
-
     if (intro) {
 	GvINTRO_off(dstr);	/* one-shot flag */
 	GvLINE(dstr) = CopLINE(PL_curcop);
@@ -3485,8 +3705,6 @@
 	goto common;
     case SVt_PVAV:
 	location = (SV **) &GvAV(dstr);
-        if (strEQ(GvNAME((GV*)dstr), "ISA"))
-	    mro_changes = TRUE;
 	import_flag = GVf_IMPORTED_AV;
 	goto common;
     case SVt_PVIO:
@@ -3521,7 +3739,8 @@
 			/* Redefining a sub - warning is mandatory if
 			   it was a const and its value changed. */
 			if (CvCONST(cv)	&& CvCONST((const CV *)sref)
-			    && cv_const_sv(cv) == cv_const_sv((CV*)sref)) {
+			    && cv_const_sv(cv)
+			    == cv_const_sv((const CV *)sref)) {
 			    NOOP;
 			    /* They are 2 constant subroutines generated from
 			       the same constant. This probably means that
@@ -3534,7 +3753,8 @@
 				 || (CvCONST(cv)
 				     && (!CvCONST((const CV *)sref)
 					 || sv_cmp(cv_const_sv(cv),
-						   cv_const_sv((CV*)sref))))) {
+						   cv_const_sv((const CV *)
+							       sref))))) {
 			    Perl_warner(aTHX_ packWARN(WARN_REDEFINE),
 					(const char *)
 					(CvCONST(cv)
@@ -3558,17 +3778,20 @@
 	    && CopSTASH_ne(PL_curcop, GvSTASH(dstr))) {
 	    GvFLAGS(dstr) |= import_flag;
 	}
+	if (stype == SVt_PVAV && strEQ(GvNAME((GV*)dstr), "ISA")) {
+	    sv_magic(sref, dstr, PERL_MAGIC_isa, NULL, 0);
+	    mro_isa_changed_in(GvSTASH(dstr));
+	}
 	break;
     }
     SvREFCNT_dec(dref);
     if (SvTAINTED(sstr))
 	SvTAINT(dstr);
-    if (mro_changes) mro_isa_changed_in(GvSTASH(dstr));
     return;
 }
 
 void
-Perl_sv_setsv_flags(pTHX_ SV *dstr, register SV *sstr, I32 flags)
+Perl_sv_setsv_flags(pTHX_ SV *dstr, register SV* sstr, const I32 flags)
 {
     dVAR;
     register U32 sflags;
@@ -3618,7 +3841,6 @@
 		sv_upgrade(dstr, SVt_IV);
 		break;
 	    case SVt_NV:
-	    case SVt_RV:
 	    case SVt_PV:
 		sv_upgrade(dstr, SVt_PVIV);
 		break;
@@ -3636,7 +3858,11 @@
 	    assert(!SvTAINTED(sstr));
 	    return;
 	}
-	goto undef_sstr;
+	if (!SvROK(sstr))
+	    goto undef_sstr;
+	if (dtype < SVt_PV && dtype != SVt_IV)
+	    sv_upgrade(dstr, SVt_IV);
+	break;
 
     case SVt_NV:
 	if (SvNOK(sstr)) {
@@ -3645,7 +3871,6 @@
 	    case SVt_IV:
 		sv_upgrade(dstr, SVt_NV);
 		break;
-	    case SVt_RV:
 	    case SVt_PV:
 	    case SVt_PVIV:
 		sv_upgrade(dstr, SVt_PVNV);
@@ -3664,10 +3889,6 @@
 	}
 	goto undef_sstr;
 
-    case SVt_RV:
-	if (dtype < SVt_RV)
-	    sv_upgrade(dstr, SVt_RV);
-	break;
     case SVt_PVFM:
 #ifdef PERL_OLD_COPY_ON_WRITE
 	if ((SvFLAGS(sstr) & CAN_COW_MASK) == CAN_COW_FLAGS) {
@@ -3699,6 +3920,11 @@
 	}
 	break;
 
+    case SVt_REGEXP:
+	if (dtype < SVt_REGEXP)
+	    sv_upgrade(dstr, SVt_REGEXP);
+	break;
+
 	/* case SVt_BIND: */
     case SVt_PVLV:
     case SVt_PVGV:
@@ -3789,9 +4015,8 @@
     }
     else if (dtype == SVt_PVGV && isGV_with_GP(dstr)) {
 	if (!(sflags & SVf_OK)) {
-	    if (ckWARN(WARN_MISC))
-		Perl_warner(aTHX_ packWARN(WARN_MISC),
-			    "Undefined value assigned to typeglob");
+	    Perl_ck_warner(aTHX_ packWARN(WARN_MISC),
+			   "Undefined value assigned to typeglob");
 	}
 	else {
 	    GV *gv = gv_fetchsv(sstr, GV_ADD, SVt_PVGV);
@@ -3802,6 +4027,9 @@
 	    }
 	}
     }
+    else if (dtype == SVt_REGEXP && stype == SVt_REGEXP) {
+	reg_temp_copy((REGEXP*)dstr, (REGEXP*)sstr);
+    }
     else if (sflags & SVp_POK) {
         bool isSwipe = 0;
 
@@ -3859,7 +4087,7 @@
             && ((flags & SV_COW_SHARED_HASH_KEYS)
 		? (!((sflags & CAN_COW_MASK) == CAN_COW_FLAGS
 		     && (SvFLAGS(dstr) & CAN_COW_MASK) == CAN_COW_FLAGS
-		     && SvTYPE(sstr) >= SVt_PVIV))
+		     && SvTYPE(sstr) >= SVt_PVIV && SvTYPE(sstr) != SVt_PVFM))
 		: 1)
 #endif
             ) {
@@ -3943,7 +4171,6 @@
 	    SvNV_set(dstr, SvNVX(sstr));
 	}
 	if (sflags & SVp_IOK) {
-	    SvOOK_off(dstr);
 	    SvIV_set(dstr, SvIVX(sstr));
 	    /* Must do this otherwise some other overloaded use of 0x80000000
 	       gets confused. I guess SVpbm_VALID */
@@ -3999,7 +4226,7 @@
 */
 
 void
-Perl_sv_setsv_mg(pTHX_ SV *dstr, register SV *sstr)
+Perl_sv_setsv_mg(pTHX_ SV *const dstr, register SV *const sstr)
 {
     PERL_ARGS_ASSERT_SV_SETSV_MG;
 
@@ -4089,7 +4316,7 @@
 */
 
 void
-Perl_sv_setpvn(pTHX_ register SV *sv, register const char *ptr, register STRLEN len)
+Perl_sv_setpvn(pTHX_ register SV *const sv, register const char *const ptr, register const STRLEN len)
 {
     dVAR;
     register char *dptr;
@@ -4126,7 +4353,7 @@
 */
 
 void
-Perl_sv_setpvn_mg(pTHX_ register SV *sv, register const char *ptr, register STRLEN len)
+Perl_sv_setpvn_mg(pTHX_ register SV *const sv, register const char *const ptr, register const STRLEN len)
 {
     PERL_ARGS_ASSERT_SV_SETPVN_MG;
 
@@ -4144,7 +4371,7 @@
 */
 
 void
-Perl_sv_setpv(pTHX_ register SV *sv, register const char *ptr)
+Perl_sv_setpv(pTHX_ register SV *const sv, register const char *const ptr)
 {
     dVAR;
     register STRLEN len;
@@ -4175,7 +4402,7 @@
 */
 
 void
-Perl_sv_setpv_mg(pTHX_ register SV *sv, register const char *ptr)
+Perl_sv_setpv_mg(pTHX_ register SV *const sv, register const char *const ptr)
 {
     PERL_ARGS_ASSERT_SV_SETPV_MG;
 
@@ -4204,7 +4431,7 @@
 */
 
 void
-Perl_sv_usepvn_flags(pTHX_ SV *sv, char *ptr, STRLEN len, U32 flags)
+Perl_sv_usepvn_flags(pTHX_ SV *const sv, char *ptr, const STRLEN len, const U32 flags)
 {
     dVAR;
     STRLEN allocate;
@@ -4320,7 +4547,7 @@
 */
 
 void
-Perl_sv_force_normal_flags(pTHX_ register SV *sv, U32 flags)
+Perl_sv_force_normal_flags(pTHX_ register SV *const sv, const U32 flags)
 {
     dVAR;
 
@@ -4391,6 +4618,45 @@
 	sv_unref_flags(sv, flags);
     else if (SvFAKE(sv) && SvTYPE(sv) == SVt_PVGV)
 	sv_unglob(sv);
+    else if (SvFAKE(sv) && SvTYPE(sv) == SVt_REGEXP) {
+	/* Need to downgrade the REGEXP to a simple(r) scalar. This is analagous
+	   to sv_unglob. We only need it here, so inline it.  */
+	const svtype new_type = SvMAGIC(sv) || SvSTASH(sv) ? SVt_PVMG : SVt_PV;
+	SV *const temp = newSV_type(new_type);
+	void *const temp_p = SvANY(sv);
+
+	if (new_type == SVt_PVMG) {
+	    SvMAGIC_set(temp, SvMAGIC(sv));
+	    SvMAGIC_set(sv, NULL);
+	    SvSTASH_set(temp, SvSTASH(sv));
+	    SvSTASH_set(sv, NULL);
+	}
+	SvCUR_set(temp, SvCUR(sv));
+	/* Remember that SvPVX is in the head, not the body. */
+	if (SvLEN(temp)) {
+	    SvLEN_set(temp, SvLEN(sv));
+	    /* This signals "buffer is owned by someone else" in sv_clear,
+	       which is the least effort way to stop it freeing the buffer.
+	    */
+	    SvLEN_set(sv, SvLEN(sv)+1);
+	} else {
+	    /* Their buffer is already owned by someone else. */
+	    SvPVX(sv) = savepvn(SvPVX(sv), SvCUR(sv));
+	    SvLEN_set(temp, SvCUR(sv)+1);
+	}
+
+	/* Now swap the rest of the bodies. */
+
+	SvFLAGS(sv) &= ~(SVf_FAKE|SVTYPEMASK);
+	SvFLAGS(sv) |= new_type;
+	SvANY(sv) = SvANY(temp);
+
+	SvFLAGS(temp) &= ~(SVTYPEMASK);
+	SvFLAGS(temp) |= SVt_REGEXP|SVf_FAKE;
+	SvANY(temp) = temp_p;
+
+	SvREFCNT_dec(temp);
+    }
 }
 
 /*
@@ -4407,9 +4673,14 @@
 */
 
 void
-Perl_sv_chop(pTHX_ register SV *sv, register const char *ptr)
+Perl_sv_chop(pTHX_ register SV *const sv, register const char *const ptr)
 {
-    register STRLEN delta;
+    STRLEN delta;
+    STRLEN old_delta;
+    U8 *p;
+#ifdef DEBUGGING
+    const U8 *real_start;
+#endif
     STRLEN max_delta;
 
     PERL_ARGS_ASSERT_SV_CHOP;
@@ -4427,18 +4698,12 @@
     if (ptr <= SvPVX_const(sv))
 	Perl_croak(aTHX_ "panic: sv_chop ptr=%p, start=%p, end=%p",
 		   ptr, SvPVX_const(sv), SvPVX_const(sv) + max_delta);
-    assert(ptr > SvPVX_const(sv));
     SV_CHECK_THINKFIRST(sv);
-
-    if (SvTYPE(sv) < SVt_PVIV)
-	sv_upgrade(sv,SVt_PVIV);
-
     if (delta > max_delta)
 	Perl_croak(aTHX_ "panic: sv_chop ptr=%p (was %p), start=%p, end=%p",
 		   SvPVX_const(sv) + delta, ptr, SvPVX_const(sv),
 		   SvPVX_const(sv) + max_delta);
 
-
     if (!SvOOK(sv)) {
 	if (!SvLEN(sv)) { /* make copy of shared string */
 	    const char *pvx = SvPVX_const(sv);
@@ -4447,27 +4712,38 @@
 	    Move(pvx,SvPVX(sv),len,char);
 	    *SvEND(sv) = '\0';
 	}
-	SvIV_set(sv, 0);
-	/* Same SvOOK_on but SvOOK_on does a SvIOK_off
-	   and we do that anyway inside the SvNIOK_off
-	*/
 	SvFLAGS(sv) |= SVf_OOK;
+	old_delta = 0;
+    } else {
+	SvOOK_offset(sv, old_delta);
     }
-    SvNIOK_off(sv);
     SvLEN_set(sv, SvLEN(sv) - delta);
     SvCUR_set(sv, SvCUR(sv) - delta);
     SvPV_set(sv, SvPVX(sv) + delta);
-    SvIV_set(sv, SvIVX(sv) + delta);
+
+    p = (U8 *)SvPVX_const(sv);
+
+    delta += old_delta;
+
 #ifdef DEBUGGING
-    {
-	/* Fill the preceding buffer with sentinals to verify that no-one is
-	   using it.  */
-	U8 *p = (U8*) SvPVX(sv);
-	const U8 *const real_start = p - SvIVX(sv);
-	while (p > real_start) {
-	    --p;
-	    *p = (U8)PTR2UV(p);
-	}
+    real_start = p - delta;
+#endif
+
+    assert(delta);
+    if (delta < 0x100) {
+	*--p = (U8) delta;
+    } else {
+	*--p = 0;
+	p -= sizeof(STRLEN);
+	Copy((U8*)&delta, p, sizeof(STRLEN), U8);
+    }
+
+#ifdef DEBUGGING
+    /* Fill the preceding buffer with sentinals to verify that no-one is
+       using it.  */
+    while (p > real_start) {
+	--p;
+	*p = (U8)PTR2UV(p);
     }
 #endif
 }
@@ -4493,7 +4769,7 @@
 */
 
 void
-Perl_sv_catpvn_flags(pTHX_ register SV *dsv, register const char *sstr, register STRLEN slen, I32 flags)
+Perl_sv_catpvn_flags(pTHX_ register SV *const dsv, register const char *sstr, register const STRLEN slen, const I32 flags)
 {
     dVAR;
     STRLEN dlen;
@@ -4530,7 +4806,7 @@
 =cut */
 
 void
-Perl_sv_catsv_flags(pTHX_ SV *dsv, register SV *ssv, I32 flags)
+Perl_sv_catsv_flags(pTHX_ SV *const dsv, register SV *const ssv, const I32 flags)
 {
     dVAR;
  
@@ -4563,7 +4839,8 @@
 		    spv = SvPV_const(csv, slen);
 		}
 		else
-		    sv_utf8_upgrade_nomg(dsv);
+		    /* Leave enough space for the cat that's about to happen */
+		    sv_utf8_upgrade_flags_grow(dsv, 0, slen);
 	    }
 	    sv_catpvn_nomg(dsv, spv, slen);
 	}
@@ -4582,7 +4859,7 @@
 =cut */
 
 void
-Perl_sv_catpv(pTHX_ register SV *sv, register const char *ptr)
+Perl_sv_catpv(pTHX_ register SV *const sv, register const char *ptr)
 {
     dVAR;
     register STRLEN len;
@@ -4613,7 +4890,7 @@
 */
 
 void
-Perl_sv_catpv_mg(pTHX_ register SV *sv, register const char *ptr)
+Perl_sv_catpv_mg(pTHX_ register SV *const sv, register const char *const ptr)
 {
     PERL_ARGS_ASSERT_SV_CATPV_MG;
 
@@ -4639,7 +4916,7 @@
 */
 
 SV *
-Perl_newSV(pTHX_ STRLEN len)
+Perl_newSV(pTHX_ const STRLEN len)
 {
     dVAR;
     register SV *sv;
@@ -4671,8 +4948,8 @@
 =cut
 */
 MAGIC *	
-Perl_sv_magicext(pTHX_ SV* sv, SV* obj, int how, const MGVTBL *vtable,
-		 const char* name, I32 namlen)
+Perl_sv_magicext(pTHX_ SV *const sv, SV *const obj, const int how, 
+                const MGVTBL *const vtable, const char *const name, const I32 namlen)
 {
     dVAR;
     MAGIC* mg;
@@ -4695,7 +4972,6 @@
     */
     if (!obj || obj == sv ||
 	how == PERL_MAGIC_arylen ||
-	how == PERL_MAGIC_qr ||
 	how == PERL_MAGIC_symtab ||
 	(SvTYPE(obj) == SVt_PVGV &&
 	    (GvSV(obj) == sv || GvHV(obj) == (const HV *)sv
@@ -4761,7 +5037,8 @@
 */
 
 void
-Perl_sv_magic(pTHX_ register SV *sv, SV *obj, int how, const char *name, I32 namlen)
+Perl_sv_magic(pTHX_ register SV *const sv, SV *const obj, const int how, 
+             const char *const name, const I32 namlen)
 {
     dVAR;
     const MGVTBL *vtable;
@@ -4870,8 +5147,6 @@
     case PERL_MAGIC_qr:
 	vtable = &PL_vtbl_regexp;
 	break;
-    case PERL_MAGIC_hints:
-	/* As this vtable is all NULL, we can reuse it.  */
     case PERL_MAGIC_sig:
 	vtable = &PL_vtbl_sig;
 	break;
@@ -4914,6 +5189,9 @@
     case PERL_MAGIC_hintselem:
 	vtable = &PL_vtbl_hintselem;
 	break;
+    case PERL_MAGIC_hints:
+	vtable = &PL_vtbl_hints;
+	break;
     case PERL_MAGIC_ext:
 	/* Reserved for use by extensions not perl internals.	        */
 	/* Useful for attaching extension internal data to perl vars.	*/
@@ -4948,7 +5226,7 @@
 */
 
 int
-Perl_sv_unmagic(pTHX_ SV *sv, int type)
+Perl_sv_unmagic(pTHX_ SV *const sv, const int type)
 {
     MAGIC* mg;
     MAGIC** mgp;
@@ -4979,12 +5257,14 @@
 	else
 	    mgp = &mg->mg_moremagic;
     }
-    if (!SvMAGIC(sv)) {
+    if (SvMAGIC(sv)) {
+	if (SvMAGICAL(sv))	/* if we're under save_magic, wait for restore_magic; */
+	    mg_magical(sv);	/*    else fix the flags now */
+    }
+    else {
 	SvMAGICAL_off(sv);
 	SvFLAGS(sv) |= (SvFLAGS(sv) & (SVp_IOK|SVp_NOK|SVp_POK)) >> PRIVSHIFT;
-	SvMAGIC_set(sv, NULL);
     }
-
     return 0;
 }
 
@@ -5001,7 +5281,7 @@
 */
 
 SV *
-Perl_sv_rvweaken(pTHX_ SV *sv)
+Perl_sv_rvweaken(pTHX_ SV *const sv)
 {
     SV *tsv;
 
@@ -5012,8 +5292,7 @@
     if (!SvROK(sv))
 	Perl_croak(aTHX_ "Can't weaken a nonreference");
     else if (SvWEAKREF(sv)) {
-	if (ckWARN(WARN_MISC))
-	    Perl_warner(aTHX_ packWARN(WARN_MISC), "Reference is already weak");
+	Perl_ck_warner(aTHX_ packWARN(WARN_MISC), "Reference is already weak");
 	return sv;
     }
     tsv = SvRV(sv);
@@ -5046,7 +5325,7 @@
  */
 
 void
-Perl_sv_add_backref(pTHX_ SV *tsv, SV *sv)
+Perl_sv_add_backref(pTHX_ SV *const tsv, SV *const sv)
 {
     dVAR;
     AV *av;
@@ -5100,7 +5379,7 @@
  */
 
 STATIC void
-S_sv_del_backref(pTHX_ SV *tsv, SV *sv)
+S_sv_del_backref(pTHX_ SV *const tsv, SV *const sv)
 {
     dVAR;
     AV *av = NULL;
@@ -5149,7 +5428,7 @@
 }
 
 int
-Perl_sv_kill_backrefs(pTHX_ SV *sv, AV *av)
+Perl_sv_kill_backrefs(pTHX_ SV *const sv, AV *const av)
 {
     SV **svp = AvARRAY(av);
 
@@ -5301,7 +5580,7 @@
 */
 
 void
-Perl_sv_replace(pTHX_ register SV *sv, register SV *nsv)
+Perl_sv_replace(pTHX_ register SV *const sv, register SV *const nsv)
 {
     dVAR;
     const U32 refcnt = SvREFCNT(sv);
@@ -5310,8 +5589,8 @@
 
     SV_CHECK_THINKFIRST_COW_DROP(sv);
     if (SvREFCNT(nsv) != 1) {
-	Perl_croak(aTHX_ "panic: reference miscount on nsv in sv_replace() (%"
-		   UVuf " != 1)", (UV) SvREFCNT(nsv));
+	Perl_croak(aTHX_ "panic: reference miscount on nsv in sv_replace()"
+		   " (%" UVuf " != 1)", (UV) SvREFCNT(nsv));
     }
     if (SvMAGICAL(sv)) {
 	if (SvMAGICAL(nsv))
@@ -5334,13 +5613,9 @@
 #else
     StructCopy(nsv,sv,SV);
 #endif
-    /* Currently could join these into one piece of pointer arithmetic, but
-       it would be unclear.  */
-    if(SvTYPE(sv) == SVt_IV)
+    if(SvTYPE(sv) == SVt_IV) {
 	SvANY(sv)
 	    = (XPVIV*)((char*)&(sv->sv_u.svu_iv) - STRUCT_OFFSET(XPVIV, xiv_iv));
-    else if (SvTYPE(sv) == SVt_RV) {
-	SvANY(sv) = &sv->sv_u.svu_rv;
     }
 	
 
@@ -5387,7 +5662,7 @@
 */
 
 void
-Perl_sv_clear(pTHX_ register SV *sv)
+Perl_sv_clear(pTHX_ register SV *const sv)
 {
     dVAR;
     const U32 type = SvTYPE(sv);
@@ -5403,6 +5678,15 @@
 	/* See the comment in sv.h about the collusion between this early
 	   return and the overloading of the NULL and IV slots in the size
 	   table.  */
+	if (SvROK(sv)) {
+	    SV * const target = SvRV(sv);
+	    if (SvWEAKREF(sv))
+	        sv_del_backref(target, sv);
+	    else
+	        SvREFCNT_dec(target);
+	}
+	SvFLAGS(sv) &= SVf_BREAK;
+	SvFLAGS(sv) |= SVTYPEMASK;
 	return;
     }
 
@@ -5417,9 +5701,13 @@
 		stash = SvSTASH(sv);
 		destructor = StashHANDLER(stash,DESTROY);
 		if (destructor
+			/* A constant subroutine can have no side effects, so
+			   don't bother calling it.  */
+			&& !CvCONST(destructor)
 			/* Don't bother calling an empty destructor */
 			&& (CvISXSUB(destructor)
-			|| CvSTART(destructor)->op_next->op_type != OP_LEAVESUB))
+			|| (CvSTART(destructor)
+			    && (CvSTART(destructor)->op_next->op_type != OP_LEAVESUB))))
 		{
 		    SV* const tmpref = newRV(sv);
 	            SvREADONLY_on(tmpref);   /* DESTROY() could be naughty */
@@ -5487,6 +5775,10 @@
 	Safefree(IoFMT_NAME(sv));
 	Safefree(IoBOTTOM_NAME(sv));
 	goto freescalar;
+    case SVt_REGEXP:
+	/* FIXME for plugins */
+	pregfree2((REGEXP*) sv);
+	goto freescalar;
     case SVt_PVCV:
     case SVt_PVFM:
 	cv_undef(MUTABLE_CV(sv));
@@ -5534,14 +5826,15 @@
     case SVt_PVMG:
     case SVt_PVNV:
     case SVt_PVIV:
+    case SVt_PV:
       freescalar:
 	/* Don't bother with SvOOK_off(sv); as we're only going to free it.  */
 	if (SvOOK(sv)) {
-	    SvPV_set(sv, SvPVX_mutable(sv) - SvIVX(sv));
+	    STRLEN offset;
+	    SvOOK_offset(sv, offset);
+	    SvPV_set(sv, SvPVX_mutable(sv) - offset);
 	    /* Don't even bother with turning off the OOK flag.  */
 	}
-    case SVt_PV:
-    case SVt_RV:
 	if (SvROK(sv)) {
 	    SV * const target = SvRV(sv);
 	    if (SvWEAKREF(sv))
@@ -5602,7 +5895,7 @@
 */
 
 SV *
-Perl_sv_newref(pTHX_ SV *sv)
+Perl_sv_newref(pTHX_ SV *const sv)
 {
     PERL_UNUSED_CONTEXT;
     if (sv)
@@ -5622,7 +5915,7 @@
 */
 
 void
-Perl_sv_free(pTHX_ SV *sv)
+Perl_sv_free(pTHX_ SV *const sv)
 {
     dVAR;
     if (!sv)
@@ -5670,7 +5963,7 @@
 }
 
 void
-Perl_sv_free2(pTHX_ SV *sv)
+Perl_sv_free2(pTHX_ SV *const sv)
 {
     dVAR;
 
@@ -5678,10 +5971,9 @@
 
 #ifdef DEBUGGING
     if (SvTEMP(sv)) {
-	if (ckWARN_d(WARN_DEBUGGING))
-	    Perl_warner(aTHX_ packWARN(WARN_DEBUGGING),
-			"Attempt to free temp prematurely: SV 0x%"UVxf
-                        pTHX__FORMAT, PTR2UV(sv) pTHX__VALUE);
+	Perl_ck_warner_d(aTHX_ packWARN(WARN_DEBUGGING),
+			 "Attempt to free temp prematurely: SV 0x%"UVxf
+			 pTHX__FORMAT, PTR2UV(sv) pTHX__VALUE);
 	return;
     }
 #endif
@@ -5705,7 +5997,7 @@
 */
 
 STRLEN
-Perl_sv_len(pTHX_ register SV *sv)
+Perl_sv_len(pTHX_ register SV *const sv)
 {
     STRLEN len;
 
@@ -5738,7 +6030,7 @@
  */
 
 STRLEN
-Perl_sv_len_utf8(pTHX_ register SV *sv)
+Perl_sv_len_utf8(pTHX_ register SV *const sv)
 {
     if (!sv)
 	return 0;
@@ -5773,12 +6065,17 @@
 	    else {
 		ulen = Perl_utf8_length(aTHX_ s, s + len);
 		if (!SvREADONLY(sv)) {
-		    if (!mg) {
+		    if (!mg && (SvTYPE(sv) < SVt_PVMG ||
+				!(mg = mg_find(sv, PERL_MAGIC_utf8)))) {
 			mg = sv_magicext(sv, 0, PERL_MAGIC_utf8,
 					 &PL_vtbl_utf8, 0, 0);
 		    }
 		    assert(mg);
 		    mg->mg_len = ulen;
+		    /* For now, treat "overflowed" as "still unknown".
+		       See RT #72924.  */
+		    if (ulen != (STRLEN) mg->mg_len)
+			mg->mg_len = -1;
 		}
 	    }
 	    return ulen;
@@ -5812,7 +6109,7 @@
    the passed in UTF-8 offset.  */
 static STRLEN
 S_sv_pos_u2b_midway(const U8 *const start, const U8 *send,
-		      STRLEN uoffset, STRLEN uend)
+		      const STRLEN uoffset, const STRLEN uend)
 {
     STRLEN backw = uend - uoffset;
 
@@ -5842,8 +6139,8 @@
    will be used to reduce the amount of linear searching. The cache will be
    created if necessary, and the found value offered to it for update.  */
 static STRLEN
-S_sv_pos_u2b_cached(pTHX_ SV *sv, MAGIC **mgp, const U8 *const start,
-		    const U8 *const send, STRLEN uoffset,
+S_sv_pos_u2b_cached(pTHX_ SV *const sv, MAGIC **const mgp, const U8 *const start,
+		    const U8 *const send, const STRLEN uoffset,
 		    STRLEN uoffset0, STRLEN boffset0)
 {
     STRLEN boffset = 0; /* Actually always set, but let's keep gcc happy.  */
@@ -5853,8 +6150,10 @@
 
     assert (uoffset >= uoffset0);
 
-    if (SvMAGICAL(sv) && !SvREADONLY(sv) && PL_utf8cache
-	&& (*mgp || (*mgp = mg_find(sv, PERL_MAGIC_utf8)))) {
+    if (!SvREADONLY(sv)
+	&& PL_utf8cache
+	&& (*mgp || (SvTYPE(sv) >= SVt_PVMG &&
+		     (*mgp = mg_find(sv, PERL_MAGIC_utf8))))) {
 	if ((*mgp)->mg_ptr) {
 	    STRLEN *cache = (STRLEN *) (*mgp)->mg_ptr;
 	    if (cache[0] == uoffset) {
@@ -5945,62 +6244,97 @@
 
 
 /*
-=for apidoc sv_pos_u2b
+=for apidoc sv_pos_u2b_flags
 
 Converts the value pointed to by offsetp from a count of UTF-8 chars from
 the start of the string, to a count of the equivalent number of bytes; if
 lenp is non-zero, it does the same to lenp, but this time starting from
-the offset, rather than from the start of the string. Handles magic and
-type coercion.
+the offset, rather than from the start of the string. Handles type coercion.
+I<flags> is passed to C<SvPV_flags>, and usually should be
+C<SV_GMAGIC|SV_CONST_RETURN> to handle magic.
 
 =cut
 */
 
 /*
- * sv_pos_u2b() uses, like sv_pos_b2u(), the mg_ptr of the potential
+ * sv_pos_u2b_flags() uses, like sv_pos_b2u(), the mg_ptr of the potential
  * PERL_MAGIC_utf8 of the sv to store the mapping between UTF-8 and
  * byte offsets.  See also the comments of S_utf8_mg_pos_cache_update().
  *
  */
 
-void
-Perl_sv_pos_u2b(pTHX_ register SV *sv, I32* offsetp, I32* lenp)
+STRLEN
+Perl_sv_pos_u2b_flags(pTHX_ SV *const sv, STRLEN uoffset, STRLEN *const lenp,
+		      U32 flags)
 {
     const U8 *start;
     STRLEN len;
+    STRLEN boffset;
 
-    PERL_ARGS_ASSERT_SV_POS_U2B;
+    PERL_ARGS_ASSERT_SV_POS_U2B_FLAGS;
 
-    if (!sv)
-	return;
-
-    start = (U8*)SvPV_const(sv, len);
+    start = (U8*)SvPV_flags(sv, len, flags);
     if (len) {
-	STRLEN uoffset = (STRLEN) *offsetp;
 	const U8 * const send = start + len;
 	MAGIC *mg = NULL;
-	const STRLEN boffset = sv_pos_u2b_cached(sv, &mg, start, send,
-					     uoffset, 0, 0);
-
-	*offsetp = (I32) boffset;
+	boffset = sv_pos_u2b_cached(sv, &mg, start, send, uoffset, 0, 0);
 
 	if (lenp) {
 	    /* Convert the relative offset to absolute.  */
-	    const STRLEN uoffset2 = uoffset + (STRLEN) *lenp;
+	    const STRLEN uoffset2 = uoffset + *lenp;
 	    const STRLEN boffset2
 		= sv_pos_u2b_cached(sv, &mg, start, send, uoffset2,
 				      uoffset, boffset) - boffset;
 
 	    *lenp = boffset2;
 	}
-    }
-    else {
-	 *offsetp = 0;
-	 if (lenp)
-	      *lenp = 0;
+    } else {
+	if (lenp)
+	    *lenp = 0;
+	boffset = 0;
     }
 
-    return;
+    return boffset;
+}
+
+/*
+=for apidoc sv_pos_u2b
+
+Converts the value pointed to by offsetp from a count of UTF-8 chars from
+the start of the string, to a count of the equivalent number of bytes; if
+lenp is non-zero, it does the same to lenp, but this time starting from
+the offset, rather than from the start of the string. Handles magic and
+type coercion.
+
+Use C<sv_pos_u2b_flags> in preference, which correctly handles strings longer
+than 2Gb.
+
+=cut
+*/
+
+/*
+ * sv_pos_u2b() uses, like sv_pos_b2u(), the mg_ptr of the potential
+ * PERL_MAGIC_utf8 of the sv to store the mapping between UTF-8 and
+ * byte offsets.  See also the comments of S_utf8_mg_pos_cache_update().
+ *
+ */
+
+/* This function is subject to size and sign problems */
+
+void
+Perl_sv_pos_u2b(pTHX_ register SV *const sv, I32 *const offsetp, I32 *const lenp)
+{
+    PERL_ARGS_ASSERT_SV_POS_U2B;
+
+    if (lenp) {
+	STRLEN ulen = (STRLEN)*lenp;
+	*offsetp = (I32)sv_pos_u2b_flags(sv, (STRLEN)*offsetp, &ulen,
+					 SV_GMAGIC|SV_CONST_RETURN);
+	*lenp = (I32)ulen;
+    } else {
+	*offsetp = (I32)sv_pos_u2b_flags(sv, (STRLEN)*offsetp, NULL,
+					 SV_GMAGIC|SV_CONST_RETURN);
+    }
 }
 
 /* Create and update the UTF8 magic offset cache, with the proffered utf8/
@@ -6027,8 +6361,8 @@
    from.   
 */
 static void
-S_utf8_mg_pos_cache_update(pTHX_ SV *sv, MAGIC **mgp, STRLEN byte, STRLEN utf8,
-			   STRLEN blen)
+S_utf8_mg_pos_cache_update(pTHX_ SV *const sv, MAGIC **const mgp, const STRLEN byte,
+                           const STRLEN utf8, const STRLEN blen)
 {
     STRLEN *cache;
 
@@ -6037,7 +6371,8 @@
     if (SvREADONLY(sv))
 	return;
 
-    if (!*mgp) {
+    if (!*mgp && (SvTYPE(sv) < SVt_PVMG ||
+		  !(*mgp = mg_find(sv, PERL_MAGIC_utf8)))) {
 	*mgp = sv_magicext(sv, 0, PERL_MAGIC_utf8, (MGVTBL*)&PL_vtbl_utf8, 0,
 			   0);
 	(*mgp)->mg_len = -1;
@@ -6050,7 +6385,13 @@
     }
     assert(cache);
 
-    if (PL_utf8cache < 0) {
+    if (PL_utf8cache < 0 && SvPOKp(sv)) {
+	/* SvPOKp() because it's possible that sv has string overloading, and
+	   therefore is a reference, hence SvPVX() is actually a pointer.
+	   This cures the (very real) symptoms of RT 69422, but I'm not actually
+	   sure whether we should even be caching the results of UTF-8
+	   operations on overloading, given that nothing stops overloading
+	   returning a different value every time it's called.  */
 	const U8 *start = (const U8 *) SvPVX_const(sv);
 	const STRLEN realutf8 = utf8_length(start, start + byte);
 
@@ -6167,8 +6508,8 @@
    assumption is made as in S_sv_pos_u2b_midway(), namely that walking
    backward is half the speed of walking forward. */
 static STRLEN
-S_sv_pos_b2u_midway(pTHX_ const U8 *s, const U8 *const target, const U8 *end,
-		    STRLEN endu)
+S_sv_pos_b2u_midway(pTHX_ const U8 *const s, const U8 *const target,
+                    const U8 *end, STRLEN endu)
 {
     const STRLEN forw = target - s;
     STRLEN backw = end - target;
@@ -6206,7 +6547,7 @@
  *
  */
 void
-Perl_sv_pos_b2u(pTHX_ register SV* sv, I32* offsetp)
+Perl_sv_pos_b2u(pTHX_ register SV *const sv, I32 *const offsetp)
 {
     const U8* s;
     const STRLEN byte = *offsetp;
@@ -6228,8 +6569,11 @@
 
     send = s + byte;
 
-    if (SvMAGICAL(sv) && !SvREADONLY(sv) && PL_utf8cache
-	&& (mg = mg_find(sv, PERL_MAGIC_utf8))) {
+    if (!SvREADONLY(sv)
+	&& PL_utf8cache
+	&& SvTYPE(sv) >= SVt_PVMG
+	&& (mg = mg_find(sv, PERL_MAGIC_utf8)))
+    {
 	if (mg->mg_ptr) {
 	    STRLEN * const cache = (STRLEN *) mg->mg_ptr;
 	    if (cache[1] == byte) {
@@ -6410,7 +6754,7 @@
 */
 
 I32
-Perl_sv_cmp(pTHX_ register SV *sv1, register SV *sv2)
+Perl_sv_cmp(pTHX_ register SV *const sv1, register SV *const sv2)
 {
     dVAR;
     STRLEN cur1, cur2;
@@ -6492,7 +6836,7 @@
 */
 
 I32
-Perl_sv_cmp_locale(pTHX_ register SV *sv1, register SV *sv2)
+Perl_sv_cmp_locale(pTHX_ register SV *const sv1, register SV *const sv2)
 {
     dVAR;
 #ifdef USE_LOCALE_COLLATE
@@ -6557,7 +6901,7 @@
 */
 
 char *
-Perl_sv_collxfrm(pTHX_ SV *sv, STRLEN *nxp)
+Perl_sv_collxfrm(pTHX_ SV *const sv, STRLEN *const nxp)
 {
     dVAR;
     MAGIC *mg;
@@ -6615,7 +6959,7 @@
 */
 
 char *
-Perl_sv_gets(pTHX_ register SV *sv, register PerlIO *fp, I32 append)
+Perl_sv_gets(pTHX_ register SV *const sv, register PerlIO *const fp, I32 append)
 {
     dVAR;
     const char *rsptr;
@@ -6982,7 +7326,7 @@
 */
 
 void
-Perl_sv_inc(pTHX_ register SV *sv)
+Perl_sv_inc(pTHX_ register SV *const sv)
 {
     dVAR;
     register char *d;
@@ -7036,8 +7380,15 @@
 	return;
     }
     if (flags & SVp_NOK) {
+	const NV was = SvNVX(sv);
+	if (NV_OVERFLOWS_INTEGERS_AT &&
+	    was >= NV_OVERFLOWS_INTEGERS_AT) {
+	    Perl_ck_warner(aTHX_ packWARN(WARN_IMPRECISION),
+			   "Lost precision when incrementing %" NVff " by 1",
+			   was);
+	}
 	(void)SvNOK_only(sv);
-        SvNV_set(sv, SvNVX(sv) + 1.0);
+        SvNV_set(sv, was + 1.0);
 	return;
     }
 
@@ -7051,7 +7402,7 @@
     d = SvPVX(sv);
     while (isALPHA(*d)) d++;
     while (isDIGIT(*d)) d++;
-    if (*d) {
+    if (d < SvEND(sv)) {
 #ifdef PERL_PRESERVE_IVUV
 	/* Got to punt this as an integer if needs be, but we don't issue
 	   warnings. Probably ought to make the sv_iv_please() that does
@@ -7139,7 +7490,7 @@
 */
 
 void
-Perl_sv_dec(pTHX_ register SV *sv)
+Perl_sv_dec(pTHX_ register SV *const sv)
 {
     dVAR;
     int flags;
@@ -7181,8 +7532,10 @@
 		SvUV_set(sv, SvUVX(sv) - 1);
 	    }	
 	} else {
-	    if (SvIVX(sv) == IV_MIN)
-		sv_setnv(sv, (NV)IV_MIN - 1.0);
+	    if (SvIVX(sv) == IV_MIN) {
+		sv_setnv(sv, (NV)IV_MIN);
+		goto oops_its_num;
+	    }
 	    else {
 		(void)SvIOK_only(sv);
 		SvIV_set(sv, SvIVX(sv) - 1);
@@ -7191,9 +7544,19 @@
 	return;
     }
     if (flags & SVp_NOK) {
-        SvNV_set(sv, SvNVX(sv) - 1.0);
-	(void)SvNOK_only(sv);
-	return;
+    oops_its_num:
+	{
+	    const NV was = SvNVX(sv);
+	    if (NV_OVERFLOWS_INTEGERS_AT &&
+		was <= -NV_OVERFLOWS_INTEGERS_AT) {
+		Perl_ck_warner(aTHX_ packWARN(WARN_IMPRECISION),
+			       "Lost precision when decrementing %" NVff " by 1",
+			       was);
+	    }
+	    (void)SvNOK_only(sv);
+	    SvNV_set(sv, was - 1.0);
+	    return;
+	}
     }
     if (!(flags & SVp_POK)) {
 	if ((flags & SVTYPEMASK) < SVt_PVIV)
@@ -7239,6 +7602,16 @@
     sv_setnv(sv,Atof(SvPVX_const(sv)) - 1.0);	/* punt */
 }
 
+/* this define is used to eliminate a chunk of duplicated but shared logic
+ * it has the suffix __SV_C to signal that it isnt API, and isnt meant to be
+ * used anywhere but here - yves
+ */
+#define PUSH_EXTEND_MORTAL__SV_C(AnSv) \
+    STMT_START {      \
+	EXTEND_MORTAL(1); \
+	PL_tmps_stack[++PL_tmps_ix] = (AnSv); \
+    } STMT_END
+
 /*
 =for apidoc sv_mortalcopy
 
@@ -7256,15 +7629,14 @@
  * permanent location. */
 
 SV *
-Perl_sv_mortalcopy(pTHX_ SV *oldstr)
+Perl_sv_mortalcopy(pTHX_ SV *const oldstr)
 {
     dVAR;
     register SV *sv;
 
     new_SV(sv);
     sv_setsv(sv,oldstr);
-    EXTEND_MORTAL(1);
-    PL_tmps_stack[++PL_tmps_ix] = sv;
+    PUSH_EXTEND_MORTAL__SV_C(sv);
     SvTEMP_on(sv);
     return sv;
 }
@@ -7288,8 +7660,7 @@
 
     new_SV(sv);
     SvFLAGS(sv) = SVs_TEMP;
-    EXTEND_MORTAL(1);
-    PL_tmps_stack[++PL_tmps_ix] = sv;
+    PUSH_EXTEND_MORTAL__SV_C(sv);
     return sv;
 }
 
@@ -7303,7 +7674,8 @@
 C<len> bytes long.  If the C<s> argument is NULL the new SV will be undefined.
 Currently the only flag bits accepted are C<SVf_UTF8> and C<SVs_TEMP>.
 If C<SVs_TEMP> is set, then C<sv2mortal()> is called on the result before
-returning. If C<SVf_UTF8> is set, then it will be set on the new SV.
+returning. If C<SVf_UTF8> is set, C<s> is considered to be in UTF-8 and the
+C<SVf_UTF8> flag will be set on the new SV.
 C<newSVpvn_utf8()> is a convenience wrapper for this function, defined as
 
     #define newSVpvn_utf8(s, len, u)			\
@@ -7313,7 +7685,7 @@
 */
 
 SV *
-Perl_newSVpvn_flags(pTHX_ const char *s, STRLEN len, U32 flags)
+Perl_newSVpvn_flags(pTHX_ const char *const s, const STRLEN len, const U32 flags)
 {
     dVAR;
     register SV *sv;
@@ -7323,8 +7695,22 @@
     assert(!(flags & ~(SVf_UTF8|SVs_TEMP)));
     new_SV(sv);
     sv_setpvn(sv,s,len);
-    SvFLAGS(sv) |= (flags & SVf_UTF8);
-    return (flags & SVs_TEMP) ? sv_2mortal(sv) : sv;
+
+    /* This code used to a sv_2mortal(), however we now unroll the call to sv_2mortal()
+     * and do what it does outselves here.
+     * Since we have asserted that flags can only have the SVf_UTF8 and/or SVs_TEMP flags
+     * set above we can use it to enable the sv flags directly (bypassing SvTEMP_on), which
+     * in turn means we dont need to mask out the SVf_UTF8 flag below, which means that we
+     * eleminate quite a few steps than it looks - Yves (explaining patch by gfx)
+     */
+
+    SvFLAGS(sv) |= flags;
+
+    if(flags & SVs_TEMP){
+	PUSH_EXTEND_MORTAL__SV_C(sv);
+    }
+
+    return sv;
 }
 
 /*
@@ -7340,15 +7726,14 @@
 */
 
 SV *
-Perl_sv_2mortal(pTHX_ register SV *sv)
+Perl_sv_2mortal(pTHX_ register SV *const sv)
 {
     dVAR;
     if (!sv)
 	return NULL;
     if (SvREADONLY(sv) && SvIMMORTAL(sv))
 	return sv;
-    EXTEND_MORTAL(1);
-    PL_tmps_stack[++PL_tmps_ix] = sv;
+    PUSH_EXTEND_MORTAL__SV_C(sv);
     SvTEMP_on(sv);
     return sv;
 }
@@ -7364,7 +7749,7 @@
 */
 
 SV *
-Perl_newSVpv(pTHX_ const char *s, STRLEN len)
+Perl_newSVpv(pTHX_ const char *const s, const STRLEN len)
 {
     dVAR;
     register SV *sv;
@@ -7386,7 +7771,7 @@
 */
 
 SV *
-Perl_newSVpvn(pTHX_ const char *s, STRLEN len)
+Perl_newSVpvn(pTHX_ const char *const s, const STRLEN len)
 {
     dVAR;
     register SV *sv;
@@ -7407,7 +7792,7 @@
 */
 
 SV *
-Perl_newSVhek(pTHX_ const HEK *hek)
+Perl_newSVhek(pTHX_ const HEK *const hek)
 {
     dVAR;
     if (!hek) {
@@ -7525,7 +7910,7 @@
  */
 
 SV *
-Perl_newSVpvf_nocontext(const char* pat, ...)
+Perl_newSVpvf_nocontext(const char *const pat, ...)
 {
     dTHX;
     register SV *sv;
@@ -7550,7 +7935,7 @@
 */
 
 SV *
-Perl_newSVpvf(pTHX_ const char* pat, ...)
+Perl_newSVpvf(pTHX_ const char *const pat, ...)
 {
     register SV *sv;
     va_list args;
@@ -7566,7 +7951,7 @@
 /* backend for newSVpvf() and newSVpvf_nocontext() */
 
 SV *
-Perl_vnewSVpvf(pTHX_ const char* pat, va_list* args)
+Perl_vnewSVpvf(pTHX_ const char *const pat, va_list *const args)
 {
     dVAR;
     register SV *sv;
@@ -7588,7 +7973,7 @@
 */
 
 SV *
-Perl_newSVnv(pTHX_ NV n)
+Perl_newSVnv(pTHX_ const NV n)
 {
     dVAR;
     register SV *sv;
@@ -7608,7 +7993,7 @@
 */
 
 SV *
-Perl_newSViv(pTHX_ IV i)
+Perl_newSViv(pTHX_ const IV i)
 {
     dVAR;
     register SV *sv;
@@ -7628,7 +8013,7 @@
 */
 
 SV *
-Perl_newSVuv(pTHX_ UV u)
+Perl_newSVuv(pTHX_ const UV u)
 {
     dVAR;
     register SV *sv;
@@ -7648,7 +8033,7 @@
 */
 
 SV *
-Perl_newSV_type(pTHX_ svtype type)
+Perl_newSV_type(pTHX_ const svtype type)
 {
     register SV *sv;
 
@@ -7667,10 +8052,10 @@
 */
 
 SV *
-Perl_newRV_noinc(pTHX_ SV *tmpRef)
+Perl_newRV_noinc(pTHX_ SV *const tmpRef)
 {
     dVAR;
-    register SV *sv = newSV_type(SVt_RV);
+    register SV *sv = newSV_type(SVt_IV);
 
     PERL_ARGS_ASSERT_NEWRV_NOINC;
 
@@ -7685,7 +8070,7 @@
  */
 
 SV *
-Perl_newRV(pTHX_ SV *sv)
+Perl_newRV(pTHX_ SV *const sv)
 {
     dVAR;
 
@@ -7704,7 +8089,7 @@
 */
 
 SV *
-Perl_newSVsv(pTHX_ register SV *old)
+Perl_newSVsv(pTHX_ register SV *const old)
 {
     dVAR;
     register SV *sv;
@@ -7712,8 +8097,7 @@
     if (!old)
 	return NULL;
     if (SvTYPE(old) == SVTYPEMASK) {
-        if (ckWARN_d(WARN_INTERNAL))
-	    Perl_warner(aTHX_ packWARN(WARN_INTERNAL), "semi-panic: attempt to dup freed string");
+	Perl_ck_warner_d(aTHX_ packWARN(WARN_INTERNAL), "semi-panic: attempt to dup freed string");
 	return NULL;
     }
     new_SV(sv);
@@ -7734,7 +8118,7 @@
 */
 
 void
-Perl_sv_reset(pTHX_ register const char *s, HV *stash)
+Perl_sv_reset(pTHX_ register const char *s, HV *const stash)
 {
     dVAR;
     char todo[PERL_UCHAR_MAX+1];
@@ -7838,7 +8222,7 @@
 */
 
 IO*
-Perl_sv_2io(pTHX_ SV *sv)
+Perl_sv_2io(pTHX_ SV *const sv)
 {
     IO* io;
     GV* gv;
@@ -7880,13 +8264,13 @@
 
 Using various gambits, try to get a CV from an SV; in addition, try if
 possible to set C<*st> and C<*gvp> to the stash and GV associated with it.
-The flags in C<lref> are passed to sv_fetchsv.
+The flags in C<lref> are passed to gv_fetchsv.
 
 =cut
 */
 
 CV *
-Perl_sv_2cv(pTHX_ SV *sv, HV **st, GV **gvp, I32 lref)
+Perl_sv_2cv(pTHX_ SV *sv, HV **const st, GV **const gvp, const I32 lref)
 {
     dVAR;
     GV *gv = NULL;
@@ -7985,7 +8369,7 @@
 */
 
 I32
-Perl_sv_true(pTHX_ register SV *sv)
+Perl_sv_true(pTHX_ register SV *const sv)
 {
     if (!sv)
 	return 0;
@@ -8030,7 +8414,7 @@
 */
 
 char *
-Perl_sv_pvn_force_flags(pTHX_ SV *sv, STRLEN *lp, I32 flags)
+Perl_sv_pvn_force_flags(pTHX_ SV *const sv, STRLEN *const lp, const I32 flags)
 {
     dVAR;
 
@@ -8091,7 +8475,7 @@
 */
 
 char *
-Perl_sv_pvbyten_force(pTHX_ SV *sv, STRLEN *lp)
+Perl_sv_pvbyten_force(pTHX_ SV *const sv, STRLEN *const lp)
 {
     PERL_ARGS_ASSERT_SV_PVBYTEN_FORCE;
 
@@ -8110,7 +8494,7 @@
 */
 
 char *
-Perl_sv_pvutf8n_force(pTHX_ SV *sv, STRLEN *lp)
+Perl_sv_pvutf8n_force(pTHX_ SV *const sv, STRLEN *const lp)
 {
     PERL_ARGS_ASSERT_SV_PVUTF8N_FORCE;
 
@@ -8129,7 +8513,7 @@
 */
 
 const char *
-Perl_sv_reftype(pTHX_ const SV *sv, int ob)
+Perl_sv_reftype(pTHX_ const SV *const sv, const int ob)
 {
     PERL_ARGS_ASSERT_SV_REFTYPE;
 
@@ -8144,7 +8528,6 @@
 	case SVt_NULL:
 	case SVt_IV:
 	case SVt_NV:
-	case SVt_RV:
 	case SVt_PV:
 	case SVt_PVIV:
 	case SVt_PVNV:
@@ -8169,6 +8552,7 @@
 	case SVt_PVFM:		return "FORMAT";
 	case SVt_PVIO:		return "IO";
 	case SVt_BIND:		return "BIND";
+	case SVt_REGEXP:	return "REGEXP"; 
 	default:		return "UNKNOWN";
 	}
     }
@@ -8209,7 +8593,7 @@
 */
 
 int
-Perl_sv_isa(pTHX_ SV *sv, const char *name)
+Perl_sv_isa(pTHX_ SV *sv, const char *const name)
 {
     const char *hvname;
 
@@ -8242,7 +8626,7 @@
 */
 
 SV*
-Perl_newSVrv(pTHX_ SV *rv, const char *classname)
+Perl_newSVrv(pTHX_ SV *const rv, const char *const classname)
 {
     dVAR;
     SV *sv;
@@ -8261,7 +8645,7 @@
 	SvFLAGS(rv) = 0;
 	SvREFCNT(rv) = refcnt;
 
-	sv_upgrade(rv, SVt_RV);
+	sv_upgrade(rv, SVt_IV);
     } else if (SvROK(rv)) {
 	SvREFCNT_dec(SvRV(rv));
     } else {
@@ -8298,7 +8682,7 @@
 */
 
 SV*
-Perl_sv_setref_pv(pTHX_ SV *rv, const char *classname, void *pv)
+Perl_sv_setref_pv(pTHX_ SV *const rv, const char *const classname, void *const pv)
 {
     dVAR;
 
@@ -8326,7 +8710,7 @@
 */
 
 SV*
-Perl_sv_setref_iv(pTHX_ SV *rv, const char *classname, IV iv)
+Perl_sv_setref_iv(pTHX_ SV *const rv, const char *const classname, const IV iv)
 {
     PERL_ARGS_ASSERT_SV_SETREF_IV;
 
@@ -8347,7 +8731,7 @@
 */
 
 SV*
-Perl_sv_setref_uv(pTHX_ SV *rv, const char *classname, UV uv)
+Perl_sv_setref_uv(pTHX_ SV *const rv, const char *const classname, const UV uv)
 {
     PERL_ARGS_ASSERT_SV_SETREF_UV;
 
@@ -8368,7 +8752,7 @@
 */
 
 SV*
-Perl_sv_setref_nv(pTHX_ SV *rv, const char *classname, NV nv)
+Perl_sv_setref_nv(pTHX_ SV *const rv, const char *const classname, const NV nv)
 {
     PERL_ARGS_ASSERT_SV_SETREF_NV;
 
@@ -8392,7 +8776,8 @@
 */
 
 SV*
-Perl_sv_setref_pvn(pTHX_ SV *rv, const char *classname, const char *pv, STRLEN n)
+Perl_sv_setref_pvn(pTHX_ SV *const rv, const char *const classname,
+                   const char *const pv, const STRLEN n)
 {
     PERL_ARGS_ASSERT_SV_SETREF_PVN;
 
@@ -8411,7 +8796,7 @@
 */
 
 SV*
-Perl_sv_bless(pTHX_ SV *sv, HV *stash)
+Perl_sv_bless(pTHX_ SV *const sv, HV *const stash)
 {
     dVAR;
     SV *tmpRef;
@@ -8456,7 +8841,7 @@
  */
 
 STATIC void
-S_sv_unglob(pTHX_ SV *sv)
+S_sv_unglob(pTHX_ SV *const sv)
 {
     dVAR;
     void *xpvmg;
@@ -8514,7 +8899,7 @@
 */
 
 void
-Perl_sv_unref_flags(pTHX_ SV *ref, U32 flags)
+Perl_sv_unref_flags(pTHX_ SV *const ref, const U32 flags)
 {
     SV* const target = SvRV(ref);
 
@@ -8544,7 +8929,7 @@
 */
 
 void
-Perl_sv_untaint(pTHX_ SV *sv)
+Perl_sv_untaint(pTHX_ SV *const sv)
 {
     PERL_ARGS_ASSERT_SV_UNTAINT;
 
@@ -8563,7 +8948,7 @@
 */
 
 bool
-Perl_sv_tainted(pTHX_ SV *sv)
+Perl_sv_tainted(pTHX_ SV *const sv)
 {
     PERL_ARGS_ASSERT_SV_TAINTED;
 
@@ -8585,7 +8970,7 @@
 */
 
 void
-Perl_sv_setpviv(pTHX_ SV *sv, IV iv)
+Perl_sv_setpviv(pTHX_ SV *const sv, const IV iv)
 {
     char buf[TYPE_CHARS(UV)];
     char *ebuf;
@@ -8605,7 +8990,7 @@
 */
 
 void
-Perl_sv_setpviv_mg(pTHX_ SV *sv, IV iv)
+Perl_sv_setpviv_mg(pTHX_ SV *const sv, const IV iv)
 {
     PERL_ARGS_ASSERT_SV_SETPVIV_MG;
 
@@ -8621,7 +9006,7 @@
  */
 
 void
-Perl_sv_setpvf_nocontext(SV *sv, const char* pat, ...)
+Perl_sv_setpvf_nocontext(SV *const sv, const char *const pat, ...)
 {
     dTHX;
     va_list args;
@@ -8639,7 +9024,7 @@
  */
 
 void
-Perl_sv_setpvf_mg_nocontext(SV *sv, const char* pat, ...)
+Perl_sv_setpvf_mg_nocontext(SV *const sv, const char *const pat, ...)
 {
     dTHX;
     va_list args;
@@ -8662,7 +9047,7 @@
 */
 
 void
-Perl_sv_setpvf(pTHX_ SV *sv, const char* pat, ...)
+Perl_sv_setpvf(pTHX_ SV *const sv, const char *const pat, ...)
 {
     va_list args;
 
@@ -8685,7 +9070,7 @@
 */
 
 void
-Perl_sv_vsetpvf(pTHX_ SV *sv, const char* pat, va_list* args)
+Perl_sv_vsetpvf(pTHX_ SV *const sv, const char *const pat, va_list *const args)
 {
     PERL_ARGS_ASSERT_SV_VSETPVF;
 
@@ -8701,7 +9086,7 @@
 */
 
 void
-Perl_sv_setpvf_mg(pTHX_ SV *sv, const char* pat, ...)
+Perl_sv_setpvf_mg(pTHX_ SV *const sv, const char *const pat, ...)
 {
     va_list args;
 
@@ -8723,7 +9108,7 @@
 */
 
 void
-Perl_sv_vsetpvf_mg(pTHX_ SV *sv, const char* pat, va_list* args)
+Perl_sv_vsetpvf_mg(pTHX_ SV *const sv, const char *const pat, va_list *const args)
 {
     PERL_ARGS_ASSERT_SV_VSETPVF_MG;
 
@@ -8739,7 +9124,7 @@
  */
 
 void
-Perl_sv_catpvf_nocontext(SV *sv, const char* pat, ...)
+Perl_sv_catpvf_nocontext(SV *const sv, const char *const pat, ...)
 {
     dTHX;
     va_list args;
@@ -8757,7 +9142,7 @@
  */
 
 void
-Perl_sv_catpvf_mg_nocontext(SV *sv, const char* pat, ...)
+Perl_sv_catpvf_mg_nocontext(SV *const sv, const char *const pat, ...)
 {
     dTHX;
     va_list args;
@@ -8784,7 +9169,7 @@
 =cut */
 
 void
-Perl_sv_catpvf(pTHX_ SV *sv, const char* pat, ...)
+Perl_sv_catpvf(pTHX_ SV *const sv, const char *const pat, ...)
 {
     va_list args;
 
@@ -8807,7 +9192,7 @@
 */
 
 void
-Perl_sv_vcatpvf(pTHX_ SV *sv, const char* pat, va_list* args)
+Perl_sv_vcatpvf(pTHX_ SV *const sv, const char *const pat, va_list *const args)
 {
     PERL_ARGS_ASSERT_SV_VCATPVF;
 
@@ -8823,7 +9208,7 @@
 */
 
 void
-Perl_sv_catpvf_mg(pTHX_ SV *sv, const char* pat, ...)
+Perl_sv_catpvf_mg(pTHX_ SV *const sv, const char *const pat, ...)
 {
     va_list args;
 
@@ -8845,7 +9230,7 @@
 */
 
 void
-Perl_sv_vcatpvf_mg(pTHX_ SV *sv, const char* pat, va_list* args)
+Perl_sv_vcatpvf_mg(pTHX_ SV *const sv, const char *const pat, va_list *const args)
 {
     PERL_ARGS_ASSERT_SV_VCATPVF_MG;
 
@@ -8865,7 +9250,8 @@
 */
 
 void
-Perl_sv_vsetpvfn(pTHX_ SV *sv, const char *pat, STRLEN patlen, va_list *args, SV **svargs, I32 svmax, bool *maybe_tainted)
+Perl_sv_vsetpvfn(pTHX_ SV *const sv, const char *const pat, const STRLEN patlen,
+                 va_list *const args, SV **const svargs, const I32 svmax, bool *const maybe_tainted)
 {
     PERL_ARGS_ASSERT_SV_VSETPVFN;
 
@@ -8873,8 +9259,24 @@
     sv_vcatpvfn(sv, pat, patlen, args, svargs, svmax, maybe_tainted);
 }
 
+
+/*
+ * Warn of missing argument to sprintf, and then return a defined value
+ * to avoid inappropriate "use of uninit" warnings [perl #71000].
+ */
+#define WARN_MISSING WARN_UNINITIALIZED /* Not sure we want a new category */
+STATIC SV*
+S_vcatpvfn_missing_argument(pTHX) {
+    if (ckWARN(WARN_MISSING)) {
+	Perl_warner(aTHX_ packWARN(WARN_MISSING), "Missing argument in %s",
+		PL_op ? OP_DESC(PL_op) : "sv_vcatpvfn()");
+    }
+    return &PL_sv_no;
+}
+
+
 STATIC I32
-S_expect_number(pTHX_ char** pattern)
+S_expect_number(pTHX_ char **const pattern)
 {
     dVAR;
     I32 var = 0;
@@ -8897,7 +9299,7 @@
 }
 
 STATIC char *
-S_F0convert(NV nv, char *endbuf, STRLEN *len)
+S_F0convert(NV nv, char *const endbuf, STRLEN *const len)
 {
     const int neg = nv < 0;
     UV uv;
@@ -8947,7 +9349,8 @@
 /* XXX maybe_tainted is never assigned to, so the doc above is lying. */
 
 void
-Perl_sv_vcatpvfn(pTHX_ SV *sv, const char *pat, STRLEN patlen, va_list *args, SV **svargs, I32 svmax, bool *maybe_tainted)
+Perl_sv_vcatpvfn(pTHX_ SV *const sv, const char *const pat, const STRLEN patlen,
+                 va_list *const args, SV **const svargs, const I32 svmax, bool *const maybe_tainted)
 {
     dVAR;
     char *p;
@@ -9063,6 +9466,7 @@
 	STRLEN esignlen = 0;
 
 	const char *eptr = NULL;
+	const char *fmtstart;
 	STRLEN elen = 0;
 	SV *vecsv = NULL;
 	const U8 *vecstr = NULL;
@@ -9103,6 +9507,8 @@
 	if (q++ >= patend)
 	    break;
 
+	fmtstart = q;
+
 /*
     We allow format specification elements in this order:
 	\d+\$              explicit format parameter index
@@ -9152,9 +9558,8 @@
 		    goto string;
 		}
 		else if (n) {
-		    if (ckWARN_d(WARN_INTERNAL))
-			Perl_warner(aTHX_ packWARN(WARN_INTERNAL),
-			"internal %%<num>p might conflict with future printf extensions");
+		    Perl_ck_warner_d(aTHX_ packWARN(WARN_INTERNAL),
+				     "internal %%<num>p might conflict with future printf extensions");
 		}
 	    }
 	    q = r; 
@@ -9235,9 +9640,10 @@
 		    vecsv = va_arg(*args, SV*);
 		else if (evix) {
 		    vecsv = (evix > 0 && evix <= svmax)
-			? svargs[evix-1] : &PL_sv_undef;
+			? svargs[evix-1] : S_vcatpvfn_missing_argument(aTHX);
 		} else {
-		    vecsv = svix < svmax ? svargs[svix++] : &PL_sv_undef;
+		    vecsv = svix < svmax
+			? svargs[svix++] : S_vcatpvfn_missing_argument(aTHX);
 		}
 		dotstr = SvPV_const(vecsv, dotstrlen);
 		/* Keep the DO_UTF8 test *after* the SvPV call, else things go
@@ -9384,10 +9790,11 @@
 	if (!vectorize && !args) {
 	    if (efix) {
 		const I32 i = efix-1;
-		argsv = (i >= 0 && i < svmax) ? svargs[i] : &PL_sv_undef;
+		argsv = (i >= 0 && i < svmax)
+		    ? svargs[i] : S_vcatpvfn_missing_argument(aTHX);
 	    } else {
 		argsv = (svix >= 0 && svix < svmax)
-		    ? svargs[svix++] : &PL_sv_undef;
+		    ? svargs[svix++] : S_vcatpvfn_missing_argument(aTHX);
 	    }
 	}
 
@@ -9419,12 +9826,6 @@
 	    if (args) {
 		eptr = va_arg(*args, char*);
 		if (eptr)
-#ifdef MACOS_TRADITIONAL
-		  /* On MacOS, %#s format is used for Pascal strings */
-		  if (alt)
-		    elen = *eptr++;
-		  else
-#endif
 		    elen = strlen(eptr);
 		else {
 		    eptr = (char *)nullstr;
@@ -9499,8 +9900,11 @@
 		case 'l':	iv = va_arg(*args, long); break;
 		case 'V':	iv = va_arg(*args, IV); break;
 		default:	iv = va_arg(*args, int); break;
+		case 'q':
 #ifdef HAS_QUAD
-		case 'q':	iv = va_arg(*args, Quad_t); break;
+				iv = va_arg(*args, Quad_t); break;
+#else
+				goto unknown;
 #endif
 		}
 	    }
@@ -9511,8 +9915,11 @@
 		case 'l':	iv = (long)tiv; break;
 		case 'V':
 		default:	iv = tiv; break;
+		case 'q':
 #ifdef HAS_QUAD
-		case 'q':	iv = (Quad_t)tiv; break;
+				iv = (Quad_t)tiv; break;
+#else
+				goto unknown;
 #endif
 		}
 	    }
@@ -9584,8 +9991,11 @@
 		case 'l':  uv = va_arg(*args, unsigned long); break;
 		case 'V':  uv = va_arg(*args, UV); break;
 		default:   uv = va_arg(*args, unsigned); break;
+		case 'q':
 #ifdef HAS_QUAD
-		case 'q':  uv = va_arg(*args, Uquad_t); break;
+			   uv = va_arg(*args, Uquad_t); break;
+#else
+			   goto unknown;
 #endif
 		}
 	    }
@@ -9596,8 +10006,11 @@
 		case 'l':	uv = (unsigned long)tuv; break;
 		case 'V':
 		default:	uv = tuv; break;
+		case 'q':
 #ifdef HAS_QUAD
-		case 'q':	uv = (Uquad_t)tuv; break;
+				uv = (Uquad_t)tuv; break;
+#else
+				goto unknown;
 #endif
 		}
 	    }
@@ -9883,8 +10296,11 @@
 		default:	*(va_arg(*args, int*)) = i; break;
 		case 'l':	*(va_arg(*args, long*)) = i; break;
 		case 'V':	*(va_arg(*args, IV*)) = i; break;
+		case 'q':
 #ifdef HAS_QUAD
-		case 'q':	*(va_arg(*args, Quad_t*)) = i; break;
+				*(va_arg(*args, Quad_t*)) = i; break;
+#else
+				goto unknown;
 #endif
 		}
 	    }
@@ -9903,16 +10319,22 @@
 		SV * const msg = sv_newmortal();
 		Perl_sv_setpvf(aTHX_ msg, "Invalid conversion in %sprintf: ",
 			  (PL_op->op_type == OP_PRTF) ? "" : "s");
-		if (c) {
-		    if (isPRINT(c))
-			Perl_sv_catpvf(aTHX_ msg,
-				       "\"%%%c\"", c & 0xFF);
-		    else
-			Perl_sv_catpvf(aTHX_ msg,
-				       "\"%%\\%03"UVof"\"",
-				       (UV)c & 0xFF);
-		} else
+		if (fmtstart < patend) {
+		    const char * const fmtend = q < patend ? q : patend;
+		    const char * f;
+		    sv_catpvs(msg, "\"%");
+		    for (f = fmtstart; f < fmtend; f++) {
+			if (isPRINT(*f)) {
+			    sv_catpvn(msg, f, 1);
+			} else {
+			    Perl_sv_catpvf(aTHX_ msg,
+					   "\\%03"UVof, (UV)*f & 0xFF);
+			}
+		    }
+		    sv_catpvs(msg, "\"");
+		} else {
 		    sv_catpvs(msg, "end of string");
+		}
 		Perl_warner(aTHX_ packWARN(WARN_PRINTF), "%"SVf, SVfARG(msg)); /* yes, this is reentrant */
 	    }
 
@@ -10038,7 +10460,8 @@
 
 /* Certain cases in Perl_ss_dup have been merged, by relying on the fact
    that currently av_dup, gv_dup and hv_dup are the same as sv_dup.
-   If this changes, please unmerge ss_dup.  */
+   If this changes, please unmerge ss_dup.
+   Likewise, sv_dup_inc_multiple() relies on this fact.  */
 #define sv_dup_inc(s,t)	SvREFCNT_inc(sv_dup(s,t))
 #define sv_dup_inc_NN(s,t)	SvREFCNT_inc_NN(sv_dup(s,t))
 #define av_dup(s,t)	MUTABLE_AV(sv_dup((const SV *)s,t))
@@ -10057,7 +10480,7 @@
 /* clone a parser */
 
 yy_parser *
-Perl_parser_dup(pTHX_ const yy_parser *proto, CLONE_PARAMS* param)
+Perl_parser_dup(pTHX_ const yy_parser *const proto, CLONE_PARAMS *const param)
 {
     yy_parser *parser;
 
@@ -10180,7 +10603,7 @@
 /* duplicate a file handle */
 
 PerlIO *
-Perl_fp_dup(pTHX_ PerlIO *fp, char type, CLONE_PARAMS *param)
+Perl_fp_dup(pTHX_ PerlIO *const fp, const char type, CLONE_PARAMS *const param)
 {
     PerlIO *ret;
 
@@ -10204,7 +10627,7 @@
 /* duplicate a directory handle */
 
 DIR *
-Perl_dirp_dup(pTHX_ DIR *dp)
+Perl_dirp_dup(pTHX_ DIR *const dp)
 {
     PERL_UNUSED_CONTEXT;
     if (!dp)
@@ -10216,7 +10639,7 @@
 /* duplicate a typeglob */
 
 GP *
-Perl_gp_dup(pTHX_ GP *gp, CLONE_PARAMS* param)
+Perl_gp_dup(pTHX_ GP *const gp, CLONE_PARAMS *const param)
 {
     GP *ret;
 
@@ -10252,68 +10675,61 @@
 /* duplicate a chain of magic */
 
 MAGIC *
-Perl_mg_dup(pTHX_ MAGIC *mg, CLONE_PARAMS* param)
+Perl_mg_dup(pTHX_ MAGIC *mg, CLONE_PARAMS *const param)
 {
-    MAGIC *mgprev = (MAGIC*)NULL;
-    MAGIC *mgret;
+    MAGIC *mgret = NULL;
+    MAGIC **mgprev_p = &mgret;
 
     PERL_ARGS_ASSERT_MG_DUP;
 
-    if (!mg)
-	return (MAGIC*)NULL;
-    /* look for it in the table first */
-    mgret = (MAGIC*)ptr_table_fetch(PL_ptr_table, mg);
-    if (mgret)
-	return mgret;
-
     for (; mg; mg = mg->mg_moremagic) {
 	MAGIC *nmg;
-	Newxz(nmg, 1, MAGIC);
-	if (mgprev)
-	    mgprev->mg_moremagic = nmg;
-	else
-	    mgret = nmg;
-	nmg->mg_virtual	= mg->mg_virtual;	/* XXX copy dynamic vtable? */
-	nmg->mg_private	= mg->mg_private;
-	nmg->mg_type	= mg->mg_type;
-	nmg->mg_flags	= mg->mg_flags;
-	if (mg->mg_type == PERL_MAGIC_qr) {
-	    nmg->mg_obj	= MUTABLE_SV(CALLREGDUPE((REGEXP*)mg->mg_obj, param));
+	Newx(nmg, 1, MAGIC);
+	*mgprev_p = nmg;
+	mgprev_p = &(nmg->mg_moremagic);
+
+	/* There was a comment "XXX copy dynamic vtable?" but as we don't have
+	   dynamic vtables, I'm not sure why Sarathy wrote it. The comment dates
+	   from the original commit adding Perl_mg_dup() - revision 4538.
+	   Similarly there is the annotation "XXX random ptr?" next to the
+	   assignment to nmg->mg_ptr.  */
+	*nmg = *mg;
+
+	/* FIXME for plugins
+	if (nmg->mg_type == PERL_MAGIC_qr) {
+	    nmg->mg_obj	= MUTABLE_SV(CALLREGDUPE((REGEXP*)nmg->mg_obj, param));
 	}
-	else if(mg->mg_type == PERL_MAGIC_backref) {
+	else
+	*/
+	if(nmg->mg_type == PERL_MAGIC_backref) {
 	    /* The backref AV has its reference count deliberately bumped by
 	       1.  */
 	    nmg->mg_obj
-		= SvREFCNT_inc(av_dup_inc((const AV *) mg->mg_obj, param));
+		= SvREFCNT_inc(av_dup_inc((const AV *) nmg->mg_obj, param));
 	}
 	else {
-	    nmg->mg_obj	= (mg->mg_flags & MGf_REFCOUNTED)
-			      ? sv_dup_inc(mg->mg_obj, param)
-			      : sv_dup(mg->mg_obj, param);
-	}
-	nmg->mg_len	= mg->mg_len;
-	nmg->mg_ptr	= mg->mg_ptr;	/* XXX random ptr? */
-	if (mg->mg_ptr && mg->mg_type != PERL_MAGIC_regex_global) {
-	    if (mg->mg_len > 0) {
-		nmg->mg_ptr	= SAVEPVN(mg->mg_ptr, mg->mg_len);
-		if (mg->mg_type == PERL_MAGIC_overload_table &&
-			AMT_AMAGIC((AMT*)mg->mg_ptr))
+	    nmg->mg_obj	= (nmg->mg_flags & MGf_REFCOUNTED)
+			      ? sv_dup_inc(nmg->mg_obj, param)
+			      : sv_dup(nmg->mg_obj, param);
+	}
+
+	if (nmg->mg_ptr && nmg->mg_type != PERL_MAGIC_regex_global) {
+	    if (nmg->mg_len > 0) {
+		nmg->mg_ptr	= SAVEPVN(nmg->mg_ptr, nmg->mg_len);
+		if (nmg->mg_type == PERL_MAGIC_overload_table &&
+			AMT_AMAGIC((AMT*)nmg->mg_ptr))
 		{
-		    const AMT * const amtp = (AMT*)mg->mg_ptr;
 		    AMT * const namtp = (AMT*)nmg->mg_ptr;
-		    I32 i;
-		    for (i = 1; i < NofAMmeth; i++) {
-			namtp->table[i] = cv_dup_inc(amtp->table[i], param);
-		    }
+		    sv_dup_inc_multiple((SV**)(namtp->table),
+					(SV**)(namtp->table), NofAMmeth, param);
 		}
 	    }
-	    else if (mg->mg_len == HEf_SVKEY)
-		nmg->mg_ptr = (char*)sv_dup_inc((const SV *)mg->mg_ptr, param);
+	    else if (nmg->mg_len == HEf_SVKEY)
+		nmg->mg_ptr = (char*)sv_dup_inc((const SV *)nmg->mg_ptr, param);
 	}
-	if ((mg->mg_flags & MGf_DUP) && mg->mg_virtual && mg->mg_virtual->svt_dup) {
+	if ((nmg->mg_flags & MGf_DUP) && nmg->mg_virtual && nmg->mg_virtual->svt_dup) {
 	    CALL_FPTR(nmg->mg_virtual->svt_dup)(aTHX_ nmg, param);
 	}
-	mgprev = nmg;
     }
     return mgret;
 }
@@ -10328,7 +10744,7 @@
     PTR_TBL_t *tbl;
     PERL_UNUSED_CONTEXT;
 
-    Newxz(tbl, 1, PTR_TBL_t);
+    Newx(tbl, 1, PTR_TBL_t);
     tbl->tbl_max	= 511;
     tbl->tbl_items	= 0;
     Newxz(tbl->tbl_ary, tbl->tbl_max + 1, PTR_TBL_ENT_t*);
@@ -10349,7 +10765,7 @@
 /* map an existing pointer using a table */
 
 STATIC PTR_TBL_ENT_t *
-S_ptr_table_find(PTR_TBL_t *tbl, const void *sv)
+S_ptr_table_find(PTR_TBL_t *const tbl, const void *const sv)
 {
     PTR_TBL_ENT_t *tblent;
     const UV hash = PTR_TABLE_HASH(sv);
@@ -10365,7 +10781,7 @@
 }
 
 void *
-Perl_ptr_table_fetch(pTHX_ PTR_TBL_t *tbl, const void *sv)
+Perl_ptr_table_fetch(pTHX_ PTR_TBL_t *const tbl, const void *const sv)
 {
     PTR_TBL_ENT_t const *const tblent = ptr_table_find(tbl, sv);
 
@@ -10378,7 +10794,7 @@
 /* add a new entry to a pointer-mapping table */
 
 void
-Perl_ptr_table_store(pTHX_ PTR_TBL_t *tbl, const void *oldsv, void *newsv)
+Perl_ptr_table_store(pTHX_ PTR_TBL_t *const tbl, const void *const oldsv, void *const newsv)
 {
     PTR_TBL_ENT_t *tblent = ptr_table_find(tbl, oldsv);
 
@@ -10405,7 +10821,7 @@
 /* double the hash bucket size of an existing ptr table */
 
 void
-Perl_ptr_table_split(pTHX_ PTR_TBL_t *tbl)
+Perl_ptr_table_split(pTHX_ PTR_TBL_t *const tbl)
 {
     PTR_TBL_ENT_t **ary = tbl->tbl_ary;
     const UV oldsize = tbl->tbl_max + 1;
@@ -10440,7 +10856,7 @@
 /* remove all the entries from a ptr table */
 
 void
-Perl_ptr_table_clear(pTHX_ PTR_TBL_t *tbl)
+Perl_ptr_table_clear(pTHX_ PTR_TBL_t *const tbl)
 {
     if (tbl && tbl->tbl_items) {
 	register PTR_TBL_ENT_t * const * const array = tbl->tbl_ary;
@@ -10463,7 +10879,7 @@
 /* clear and free a ptr table */
 
 void
-Perl_ptr_table_free(pTHX_ PTR_TBL_t *tbl)
+Perl_ptr_table_free(pTHX_ PTR_TBL_t *const tbl)
 {
     if (!tbl) {
         return;
@@ -10476,7 +10892,7 @@
 #if defined(USE_ITHREADS)
 
 void
-Perl_rvpv_dup(pTHX_ SV *dstr, const SV *sstr, CLONE_PARAMS* param)
+Perl_rvpv_dup(pTHX_ SV *const dstr, const SV *const sstr, CLONE_PARAMS *const param)
 {
     PERL_ARGS_ASSERT_RVPV_DUP;
 
@@ -10517,17 +10933,28 @@
     }
     else {
 	/* Copy the NULL */
-	if (SvTYPE(dstr) == SVt_RV)
-	    SvRV_set(dstr, NULL);
-	else
-	    SvPV_set(dstr, NULL);
+	SvPV_set(dstr, NULL);
+    }
+}
+
+/* duplicate a list of SVs. source and dest may point to the same memory.  */
+static SV **
+S_sv_dup_inc_multiple(pTHX_ SV *const *source, SV **dest,
+		      SSize_t items, CLONE_PARAMS *const param)
+{
+    PERL_ARGS_ASSERT_SV_DUP_INC_MULTIPLE;
+
+    while (items-- > 0) {
+	*dest++ = sv_dup_inc(*source++, param);
     }
+
+    return dest;
 }
 
 /* duplicate an SV of any type (including AV, HV etc) */
 
 SV *
-Perl_sv_dup(pTHX_ const SV *sstr, CLONE_PARAMS* param)
+Perl_sv_dup(pTHX_ const SV *const sstr, CLONE_PARAMS *const param)
 {
     dVAR;
     SV *dstr;
@@ -10594,16 +11021,16 @@
 	break;
     case SVt_IV:
 	SvANY(dstr)	= (XPVIV*)((char*)&(dstr->sv_u.svu_iv) - STRUCT_OFFSET(XPVIV, xiv_iv));
-	SvIV_set(dstr, SvIVX(sstr));
+	if(SvROK(sstr)) {
+	    Perl_rvpv_dup(aTHX_ dstr, sstr, param);
+	} else {
+	    SvIV_set(dstr, SvIVX(sstr));
+	}
 	break;
     case SVt_NV:
 	SvANY(dstr)	= new_XNV();
 	SvNV_set(dstr, SvNVX(sstr));
 	break;
-    case SVt_RV:
-	SvANY(dstr)	= &(dstr->sv_u.svu_rv);
-	Perl_rvpv_dup(aTHX_ dstr, sstr, param);
-	break;
 	/* case SVt_BIND: */
     default:
 	{
@@ -10619,15 +11046,13 @@
 		break;
 
 	    case SVt_PVGV:
-		if (GvUNIQUE((const GV *)sstr)) {
-		    NOOP;   /* Do sharing here, and fall through */
-		}
 	    case SVt_PVIO:
 	    case SVt_PVFM:
 	    case SVt_PVHV:
 	    case SVt_PVAV:
 	    case SVt_PVCV:
 	    case SVt_PVLV:
+	    case SVt_REGEXP:
 	    case SVt_PVMG:
 	    case SVt_PVNV:
 	    case SVt_PVIV:
@@ -10682,6 +11107,10 @@
 		break;
 	    case SVt_PVMG:
 		break;
+	    case SVt_REGEXP:
+		/* FIXME for plugins */
+		re_dup_guts((REGEXP*) sstr, (REGEXP*) dstr, param);
+		break;
 	    case SVt_PVLV:
 		/* XXX LvTARGOFF sometimes holds PMOP* when DEBUGGING */
 		if (LvTYPE(dstr) == 't') /* for tie: unrefcnted fake (SV**) */
@@ -10695,10 +11124,23 @@
 		    GvNAME_HEK(dstr) = hek_dup(GvNAME_HEK(dstr), param);
 		    /* Don't call sv_add_backref here as it's going to be
 		       created as part of the magic cloning of the symbol
-		       table.  */
+		       table--unless this is during a join and the stash
+		       is not actually being cloned.  */
 		    /* Danger Will Robinson - GvGP(dstr) isn't initialised
 		       at the point of this comment.  */
 		    GvSTASH(dstr) = hv_dup(GvSTASH(dstr), param);
+		    if(param->flags & CLONEf_JOIN_IN) {
+			const HEK * const hvname
+			 = HvNAME_HEK(GvSTASH(dstr));
+			if( hvname
+			 && GvSTASH(dstr) == gv_stashpvn(
+			     HEK_KEY(hvname), HEK_LEN(hvname), 0
+			    )
+			  )
+			    Perl_sv_add_backref(
+			     aTHX_ MUTABLE_SV(GvSTASH(dstr)), dstr
+			    );
+		    }
 		    GvGP(dstr)	= gp_dup(GvGP(sstr), param);
 		    (void)GpREFCNT_inc(GvGP(dstr));
 		} else
@@ -10745,12 +11187,17 @@
 		    AvARRAY(MUTABLE_AV(dstr)) = dst_ary;
 		    AvALLOC((const AV *)dstr) = dst_ary;
 		    if (AvREAL((const AV *)sstr)) {
-			while (items-- > 0)
-			    *dst_ary++ = sv_dup_inc(*src_ary++, param);
+			dst_ary = sv_dup_inc_multiple(src_ary, dst_ary, items,
+						      param);
 		    }
 		    else {
 			while (items-- > 0)
 			    *dst_ary++ = sv_dup(*src_ary++, param);
+			if (!(param->flags & CLONEf_COPY_STACKS)
+			     && AvREIFY(sstr))
+			{
+			    av_reify(MUTABLE_AV(dstr)); /* #41138 */
+			}
 		    }
 		    items = AvMAX((const AV *)sstr) - AvFILLp((const AV *)sstr);
 		    while (items-- > 0) {
@@ -10759,9 +11206,9 @@
 		}
 		else {
 		    AvARRAY(MUTABLE_AV(dstr))	= NULL;
-		    AvALLOC(MUTABLE_AV(dstr))	= (SV**)NULL;
-		    AvMAX(  MUTABLE_AV(dstr))	= -1;
-		    AvFILLp(MUTABLE_AV(dstr))	= -1;
+		    AvALLOC((const AV *)dstr)	= (SV**)NULL;
+		    AvMAX(  (const AV *)dstr)	= -1;
+		    AvFILLp((const AV *)dstr)	= -1;
 		}
 		break;
 	    case SVt_PVHV:
@@ -10827,8 +11274,7 @@
 		    CvROOT(dstr) = OpREFCNT_inc(CvROOT(dstr));
 		OP_REFCNT_UNLOCK;
 		if (CvCONST(dstr) && CvISXSUB(dstr)) {
-		    CvXSUBANY(dstr).any_ptr = GvUNIQUE(CvGV(dstr)) ?
-			SvREFCNT_inc(CvXSUBANY(dstr).any_ptr) :
+		    CvXSUBANY(dstr).any_ptr =
 			sv_dup_inc((const SV *)CvXSUBANY(dstr).any_ptr, param);
 		}
 		/* don't dup if copying back - CvGV isn't refcounted, so the
@@ -10900,23 +11346,34 @@
 						      param);
 		ncx->blk_eval.cur_text	= sv_dup(ncx->blk_eval.cur_text, param);
 		break;
-	    case CXt_LOOP:
-		ncx->blk_loop.iterdata	= (CxPADLOOP(ncx)
-					   ? ncx->blk_loop.iterdata
-					   : gv_dup((const GV *)ncx->blk_loop.iterdata,
-						    param));
-		ncx->blk_loop.oldcomppad
-		    = (PAD*)ptr_table_fetch(PL_ptr_table,
-					    ncx->blk_loop.oldcomppad);
-		ncx->blk_loop.iterlval	= sv_dup_inc(ncx->blk_loop.iterlval,
-						     param);
-		ncx->blk_loop.iterary	= av_dup_inc(ncx->blk_loop.iterary,
-						     param);
+	    case CXt_LOOP_LAZYSV:
+		ncx->blk_loop.state_u.lazysv.end
+		    = sv_dup_inc(ncx->blk_loop.state_u.lazysv.end, param);
+		/* We are taking advantage of av_dup_inc and sv_dup_inc
+		   actually being the same function, and order equivalance of
+		   the two unions.
+		   We can assert the later [but only at run time :-(]  */
+		assert ((void *) &ncx->blk_loop.state_u.ary.ary ==
+			(void *) &ncx->blk_loop.state_u.lazysv.cur);
+	    case CXt_LOOP_FOR:
+		ncx->blk_loop.state_u.ary.ary
+		    = av_dup_inc(ncx->blk_loop.state_u.ary.ary, param);
+	    case CXt_LOOP_LAZYIV:
+	    case CXt_LOOP_PLAIN:
+		if (CxPADLOOP(ncx)) {
+		    ncx->blk_loop.oldcomppad
+			= (PAD*)ptr_table_fetch(PL_ptr_table,
+						ncx->blk_loop.oldcomppad);
+		} else {
+		    ncx->blk_loop.oldcomppad
+			= (PAD*)gv_dup((const GV *)ncx->blk_loop.oldcomppad,
+				       param);
+		}
 		break;
 	    case CXt_FORMAT:
-		ncx->blk_sub.cv		= cv_dup(ncx->blk_sub.cv, param);
-		ncx->blk_sub.gv		= gv_dup(ncx->blk_sub.gv, param);
-		ncx->blk_sub.dfoutgv	= gv_dup_inc(ncx->blk_sub.dfoutgv,
+		ncx->blk_format.cv	= cv_dup(ncx->blk_format.cv, param);
+		ncx->blk_format.gv	= gv_dup(ncx->blk_format.gv, param);
+		ncx->blk_format.dfoutgv	= gv_dup_inc(ncx->blk_format.dfoutgv,
 						     param);
 		break;
 	    case CXt_BLOCK:
@@ -11212,8 +11669,6 @@
 	    TOPPTR(nss,ix) = ptr;
 	    break;
 	case SAVEt_HINTS:
-	    i = POPINT(ss,ix);
-	    TOPINT(nss,ix) = i;
 	    ptr = POPPTR(ss,ix);
 	    if (ptr) {
 		HINTS_REFCNT_LOCK;
@@ -11221,6 +11676,8 @@
 		HINTS_REFCNT_UNLOCK;
 	    }
 	    TOPPTR(nss,ix) = ptr;
+	    i = POPINT(ss,ix);
+	    TOPINT(nss,ix) = i;
 	    if (i & HINT_LOCALIZE_HH) {
 		hv = (const HV *)POPPTR(ss,ix);
 		TOPPTR(nss,ix) = hv_dup_inc(hv, param);
@@ -11315,19 +11772,7 @@
 	    break;
 	case SAVEt_PARSER:
 	    ptr = POPPTR(ss,ix);
-	    TOPPTR(nss,ix) = ptr ? 
-		    parser_dup((const yy_parser*)ptr, param) : NULL;
-	    break;
-	case SAVEt_PADSV:
-	    /* Nothing should be using this any more, post the integration of
-	       blead change 33080. But keep it, in case something out there is
-	       generating these on the scope stack.  */
-	    longval = (long)POPLONG(ss,ix);
-	    TOPLONG(nss,ix) = longval;
-	    ptr = POPPTR(ss,ix);
-	    TOPPTR(nss,ix) = any_dup(ptr, proto_perl);
-	    sv = (SV*)POPPTR(ss,ix);
-	    TOPPTR(nss,ix) = sv_dup(sv, param);
+	    TOPPTR(nss,ix) = parser_dup((const yy_parser*)ptr, param);
 	    break;
 	default:
 	    Perl_croak(aTHX_
@@ -11344,7 +11789,7 @@
  * so we know which stashes want their objects cloned */
 
 static void
-do_mark_cloneable_stash(pTHX_ SV *sv)
+do_mark_cloneable_stash(pTHX_ SV *const sv)
 {
     const HEK * const hvname = HvNAME_HEK((const HV *)sv);
     if (hvname) {
@@ -11459,27 +11904,40 @@
     PerlInterpreter * const my_perl = (PerlInterpreter*)(*ipM->pMalloc)(ipM, sizeof(PerlInterpreter));
 
     PERL_ARGS_ASSERT_PERL_CLONE_USING;
+#else		/* !PERL_IMPLICIT_SYS */
+    IV i;
+    CLONE_PARAMS clone_params;
+    CLONE_PARAMS* param = &clone_params;
+    PerlInterpreter * const my_perl = (PerlInterpreter*)PerlMem_malloc(sizeof(PerlInterpreter));
+
+    PERL_ARGS_ASSERT_PERL_CLONE;
+#endif		/* PERL_IMPLICIT_SYS */
 
     /* for each stash, determine whether its objects should be cloned */
     S_visit(proto_perl, do_mark_cloneable_stash, SVt_PVHV, SVTYPEMASK);
     PERL_SET_THX(my_perl);
 
-#  ifdef DEBUGGING
+#ifdef DEBUGGING
     PoisonNew(my_perl, 1, PerlInterpreter);
     PL_op = NULL;
     PL_curcop = NULL;
     PL_markstack = 0;
     PL_scopestack = 0;
+    PL_scopestack_name = 0;
     PL_savestack = 0;
     PL_savestack_ix = 0;
     PL_savestack_max = -1;
     PL_sig_pending = 0;
     PL_parser = NULL;
     Zero(&PL_debug_pad, 1, struct perl_debug_pad);
-#  else	/* !DEBUGGING */
+#  ifdef DEBUG_LEAKING_SCALARS
+    PL_sv_serial = (((U32)my_perl >> 2) & 0xfff) * 1000000;
+#  endif
+#else	/* !DEBUGGING */
     Zero(my_perl, 1, PerlInterpreter);
-#  endif	/* DEBUGGING */
+#endif	/* DEBUGGING */
 
+#ifdef PERL_IMPLICIT_SYS
     /* host pointers */
     PL_Mem		= ipM;
     PL_MemShared	= ipMS;
@@ -11490,34 +11948,8 @@
     PL_Dir		= ipD;
     PL_Sock		= ipS;
     PL_Proc		= ipP;
-#else		/* !PERL_IMPLICIT_SYS */
-    IV i;
-    CLONE_PARAMS clone_params;
-    CLONE_PARAMS* param = &clone_params;
-    PerlInterpreter * const my_perl = (PerlInterpreter*)PerlMem_malloc(sizeof(PerlInterpreter));
-
-    PERL_ARGS_ASSERT_PERL_CLONE;
-
-    /* for each stash, determine whether its objects should be cloned */
-    S_visit(proto_perl, do_mark_cloneable_stash, SVt_PVHV, SVTYPEMASK);
-    PERL_SET_THX(my_perl);
-
-#    ifdef DEBUGGING
-    PoisonNew(my_perl, 1, PerlInterpreter);
-    PL_op = NULL;
-    PL_curcop = NULL;
-    PL_markstack = 0;
-    PL_scopestack = 0;
-    PL_savestack = 0;
-    PL_savestack_ix = 0;
-    PL_savestack_max = -1;
-    PL_sig_pending = 0;
-    PL_parser = NULL;
-    Zero(&PL_debug_pad, 1, struct perl_debug_pad);
-#    else	/* !DEBUGGING */
-    Zero(my_perl, 1, PerlInterpreter);
-#    endif	/* DEBUGGING */
 #endif		/* PERL_IMPLICIT_SYS */
+
     param->flags = flags;
     param->proto_perl = proto_perl;
 
@@ -11577,6 +12009,9 @@
     SvNV_set(&PL_sv_yes, 1);
     ptr_table_store(PL_ptr_table, &proto_perl->Isv_yes, &PL_sv_yes);
 
+    /* dbargs array probably holds garbage */
+    PL_dbargs		= NULL;
+
     /* create (a non-shared!) shared string table */
     PL_strtab		= newHV();
     HvSHAREKEYS_off(PL_strtab);
@@ -11632,7 +12067,6 @@
     PL_patchlevel	= sv_dup_inc(proto_perl->Ipatchlevel, param);
     PL_localpatches	= proto_perl->Ilocalpatches;
     PL_splitstr		= proto_perl->Isplitstr;
-    PL_preprocess	= proto_perl->Ipreprocess;
     PL_minus_n		= proto_perl->Iminus_n;
     PL_minus_p		= proto_perl->Iminus_p;
     PL_minus_l		= proto_perl->Iminus_l;
@@ -11675,29 +12109,15 @@
     PL_regmatch_slab	= NULL;
     
     /* Clone the regex array */
-    PL_regex_padav = newAV();
-    {
-	const I32 len = av_len((AV*)proto_perl->Iregex_padav);
-	SV* const * const regexen = AvARRAY((AV*)proto_perl->Iregex_padav);
-	IV i;
-	av_push(PL_regex_padav, sv_dup_inc_NN(regexen[0],param));
-	for(i = 1; i <= len; i++) {
-	    const SV * const regex = regexen[i];
-	    SV * const sv =
-		SvREPADTMP(regex)
-		    ? sv_dup_inc(regex, param)
-		    : SvREFCNT_inc(
-			newSViv(PTR2IV(CALLREGDUPE(
-				INT2PTR(REGEXP *, SvIVX(regex)), param))))
-		;
-	    if (SvFLAGS(regex) & SVf_BREAK)
-		SvFLAGS(sv) |= SVf_BREAK; /* unrefcnted PL_curpm */
-	    av_push(PL_regex_padav, sv);
-	}
-    }
+    /* ORANGE FIXME for plugins, probably in the SV dup code.
+       newSViv(PTR2IV(CALLREGDUPE(
+       INT2PTR(REGEXP *, SvIVX(regex)), param))))
+    */
+    PL_regex_padav = av_dup_inc(proto_perl->Iregex_padav, param);
     PL_regex_pad = AvARRAY(PL_regex_padav);
 
     /* shortcuts to various I/O objects */
+    PL_ofsgv            = gv_dup(proto_perl->Iofsgv, param);
     PL_stdingv		= gv_dup(proto_perl->Istdingv, param);
     PL_stderrgv		= gv_dup(proto_perl->Istderrgv, param);
     PL_defgv		= gv_dup(proto_perl->Idefgv, param);
@@ -11718,7 +12138,6 @@
     PL_DBsingle		= sv_dup(proto_perl->IDBsingle, param);
     PL_DBtrace		= sv_dup(proto_perl->IDBtrace, param);
     PL_DBsignal		= sv_dup(proto_perl->IDBsignal, param);
-    PL_dbargs		= av_dup(proto_perl->Idbargs, param);
 
     /* symbol tables */
     PL_defstash		= hv_dup_inc(proto_perl->Idefstash, param);
@@ -11840,8 +12259,7 @@
 
     PL_runops		= proto_perl->Irunops;
 
-    PL_parser		= proto_perl->Iparser ?
-			    parser_dup(proto_perl->Iparser, param): NULL;
+    PL_parser		= parser_dup(proto_perl->Iparser, param);
 
     /* XXX this only works if the saved cop has already been cloned */
     if (proto_perl->Iparser) {
@@ -11878,7 +12296,6 @@
 
     /* utf8 character classes */
     PL_utf8_alnum	= sv_dup_inc(proto_perl->Iutf8_alnum, param);
-    PL_utf8_alnumc	= sv_dup_inc(proto_perl->Iutf8_alnumc, param);
     PL_utf8_ascii	= sv_dup_inc(proto_perl->Iutf8_ascii, param);
     PL_utf8_alpha	= sv_dup_inc(proto_perl->Iutf8_alpha, param);
     PL_utf8_space	= sv_dup_inc(proto_perl->Iutf8_space, param);
@@ -11891,6 +12308,16 @@
     PL_utf8_punct	= sv_dup_inc(proto_perl->Iutf8_punct, param);
     PL_utf8_xdigit	= sv_dup_inc(proto_perl->Iutf8_xdigit, param);
     PL_utf8_mark	= sv_dup_inc(proto_perl->Iutf8_mark, param);
+    PL_utf8_X_begin	= sv_dup_inc(proto_perl->Iutf8_X_begin, param);
+    PL_utf8_X_extend	= sv_dup_inc(proto_perl->Iutf8_X_extend, param);
+    PL_utf8_X_prepend	= sv_dup_inc(proto_perl->Iutf8_X_prepend, param);
+    PL_utf8_X_non_hangul	= sv_dup_inc(proto_perl->Iutf8_X_non_hangul, param);
+    PL_utf8_X_L	= sv_dup_inc(proto_perl->Iutf8_X_L, param);
+    PL_utf8_X_LV	= sv_dup_inc(proto_perl->Iutf8_X_LV, param);
+    PL_utf8_X_LVT	= sv_dup_inc(proto_perl->Iutf8_X_LVT, param);
+    PL_utf8_X_T	= sv_dup_inc(proto_perl->Iutf8_X_T, param);
+    PL_utf8_X_V	= sv_dup_inc(proto_perl->Iutf8_X_V, param);
+    PL_utf8_X_LV_LVT_V	= sv_dup_inc(proto_perl->Iutf8_X_LV_LVT_V, param);
     PL_utf8_toupper	= sv_dup_inc(proto_perl->Iutf8_toupper, param);
     PL_utf8_totitle	= sv_dup_inc(proto_perl->Iutf8_totitle, param);
     PL_utf8_tolower	= sv_dup_inc(proto_perl->Iutf8_tolower, param);
@@ -11939,7 +12366,6 @@
 
     PL_glob_index	= proto_perl->Iglob_index;
     PL_srand_called	= proto_perl->Isrand_called;
-    PL_bitcount		= NULL;	/* reinits on demand */
 
     if (proto_perl->Ipsig_pend) {
 	Newxz(PL_psig_pend, SIG_SIZE, int);
@@ -11948,13 +12374,11 @@
 	PL_psig_pend	= (int*)NULL;
     }
 
-    if (proto_perl->Ipsig_ptr) {
-	Newxz(PL_psig_ptr,  SIG_SIZE, SV*);
-	Newxz(PL_psig_name, SIG_SIZE, SV*);
-	for (i = 1; i < SIG_SIZE; i++) {
-	    PL_psig_ptr[i]  = sv_dup_inc(proto_perl->Ipsig_ptr[i], param);
-	    PL_psig_name[i] = sv_dup_inc(proto_perl->Ipsig_name[i], param);
-	}
+    if (proto_perl->Ipsig_name) {
+	Newx(PL_psig_name, 2 * SIG_SIZE, SV*);
+	sv_dup_inc_multiple(proto_perl->Ipsig_name, PL_psig_name, 2 * SIG_SIZE,
+			    param);
+	PL_psig_ptr = PL_psig_name + SIG_SIZE;
     }
     else {
 	PL_psig_ptr	= (SV**)NULL;
@@ -11968,12 +12392,9 @@
 	PL_tmps_ix		= proto_perl->Itmps_ix;
 	PL_tmps_max		= proto_perl->Itmps_max;
 	PL_tmps_floor		= proto_perl->Itmps_floor;
-	Newxz(PL_tmps_stack, PL_tmps_max, SV*);
-	i = 0;
-	while (i <= PL_tmps_ix) {
-	    PL_tmps_stack[i]	= sv_dup_inc(proto_perl->Itmps_stack[i], param);
-	    ++i;
-	}
+	Newx(PL_tmps_stack, PL_tmps_max, SV*);
+	sv_dup_inc_multiple(proto_perl->Itmps_stack, PL_tmps_stack,
+			    PL_tmps_ix+1, param);
 
 	/* next PUSHMARK() sets *(PL_markstack_ptr+1) */
 	i = proto_perl->Imarkstack_max - proto_perl->Imarkstack;
@@ -11992,6 +12413,10 @@
 	Newxz(PL_scopestack, PL_scopestack_max, I32);
 	Copy(proto_perl->Iscopestack, PL_scopestack, PL_scopestack_ix, I32);
 
+#ifdef DEBUGGING
+	Newxz(PL_scopestack_name, PL_scopestack_max, const char *);
+	Copy(proto_perl->Iscopestack_name, PL_scopestack_name, PL_scopestack_ix, const char *);
+#endif
 	/* NOTE: si_dup() looks at PL_markstack */
 	PL_curstackinfo		= si_dup(proto_perl->Icurstackinfo, param);
 
@@ -12025,8 +12450,7 @@
 	    SV * const nsv = MUTABLE_SV(ptr_table_fetch(PL_ptr_table,
 		    proto_perl->Itmps_stack[i]));
 	    if (nsv && !SvREFCNT(nsv)) {
-		EXTEND_MORTAL(1);
-		PL_tmps_stack[++PL_tmps_ix] = SvREFCNT_inc_simple(nsv);
+		PUSH_EXTEND_MORTAL__SV_C(SvREFCNT_inc_simple(nsv));
 	    }
 	}
     }
@@ -12038,7 +12462,7 @@
 
     PL_Sv		= NULL;
     PL_Xpv		= (XPV*)NULL;
-    PL_na		= proto_perl->Ina;
+    my_perl->Ina	= proto_perl->Ina;
 
     PL_statbuf		= proto_perl->Istatbuf;
     PL_statcache	= proto_perl->Istatcache;
@@ -12052,7 +12476,6 @@
     PL_curpm		= proto_perl->Icurpm;	/* XXX No PMOP ref count */
     PL_rs		= sv_dup_inc(proto_perl->Irs, param);
     PL_last_in_gv	= gv_dup(proto_perl->Ilast_in_gv, param);
-    PL_ofs_sv		= sv_dup_inc(proto_perl->Iofs_sv, param);
     PL_defoutgv		= gv_dup_inc(proto_perl->Idefoutgv, param);
     PL_chopset		= proto_perl->Ichopset;	/* XXX never deallocated */
     PL_toptarget	= sv_dup_inc(proto_perl->Itoptarget, param);
@@ -12094,6 +12517,8 @@
 
     /* Pluggable optimizer */
     PL_peepp		= proto_perl->Ipeepp;
+    /* op_free() hook */
+    PL_opfreehook	= proto_perl->Iopfreehook;
 
     PL_stashcache       = newHV();
 
@@ -12280,7 +12705,7 @@
  * If so, return a mortal copy of the key. */
 
 STATIC SV*
-S_find_hash_subscript(pTHX_ HV *hv, SV* val)
+S_find_hash_subscript(pTHX_ const HV *const hv, const SV *const val)
 {
     dVAR;
     register HE **array;
@@ -12316,7 +12741,7 @@
  * If so, return the index, otherwise return -1. */
 
 STATIC I32
-S_find_array_subscript(pTHX_ AV *av, SV* val)
+S_find_array_subscript(pTHX_ const AV *const av, const SV *const val)
 {
     dVAR;
 
@@ -12349,8 +12774,8 @@
 #define FUV_SUBSCRIPT_WITHIN	4	/* "within @foo"   */
 
 STATIC SV*
-S_varname(pTHX_ GV *gv, const char gvtype, PADOFFSET targ,
-	SV* keyname, I32 aindex, int subscript_type)
+S_varname(pTHX_ const GV *const gv, const char gvtype, PADOFFSET targ,
+	const SV *const keyname, I32 aindex, int subscript_type)
 {
 
     SV * const name = sv_newmortal();
@@ -12425,13 +12850,13 @@
 */
 
 STATIC SV *
-S_find_uninit_var(pTHX_ OP* obase, SV* uninit_sv, bool match)
+S_find_uninit_var(pTHX_ const OP *const obase, const SV *const uninit_sv,
+		  bool match)
 {
     dVAR;
     SV *sv;
-    AV *av;
-    GV *gv;
-    OP *o, *o2, *kid;
+    const GV *gv;
+    const OP *o, *o2, *kid;
 
     if (!obase || (match && (!uninit_sv || uninit_sv == &PL_sv_undef ||
 			    uninit_sv == &PL_sv_placeholder)))
@@ -12469,12 +12894,12 @@
 
 	/* attempt to find a match within the aggregate */
 	if (hash) {
-	    keysv = find_hash_subscript((HV*)sv, uninit_sv);
+	    keysv = find_hash_subscript((const HV*)sv, uninit_sv);
 	    if (keysv)
 		subscript_type = FUV_SUBSCRIPT_HASH;
 	}
 	else {
-	    index = find_array_subscript((AV *)sv, uninit_sv);
+	    index = find_array_subscript((const AV *)sv, uninit_sv);
 	    if (index >= 0)
 		subscript_type = FUV_SUBSCRIPT_ARRAY;
 	}
@@ -12502,7 +12927,7 @@
 	if (obase->op_flags & OPf_SPECIAL) { /* lexical array */
 	    if (match) {
 		SV **svp;
-		av = MUTABLE_AV(PAD_SV(obase->op_targ));
+		AV *av = MUTABLE_AV(PAD_SV(obase->op_targ));
 		if (!av || SvRMAGICAL(av))
 		    break;
 		svp = av_fetch(av, (I32)obase->op_private, FALSE);
@@ -12518,7 +12943,7 @@
 		break;
 	    if (match) {
 		SV **svp;
-		av = GvAV(gv);
+		AV *const av = GvAV(gv);
 		if (!av || SvRMAGICAL(av))
 		    break;
 		svp = av_fetch(av, (I32)obase->op_private, FALSE);
@@ -12591,14 +13016,14 @@
 	    /* index is an expression;
 	     * attempt to find a match within the aggregate */
 	    if (obase->op_type == OP_HELEM) {
-		SV * const keysv = find_hash_subscript((HV*)sv, uninit_sv);
+		SV * const keysv = find_hash_subscript((const HV*)sv, uninit_sv);
 		if (keysv)
 		    return varname(gv, '%', o->op_targ,
 						keysv, 0, FUV_SUBSCRIPT_HASH);
 	    }
 	    else {
 		const I32 index
-		    = find_array_subscript((AV *)sv, uninit_sv);
+		    = find_array_subscript((const AV *)sv, uninit_sv);
 		if (index >= 0)
 		    return varname(gv, '@', o->op_targ,
 					NULL, index, FUV_SUBSCRIPT_ARRAY);
@@ -12731,7 +13156,7 @@
     case OP_GETLOGIN:
     case OP_UNDEF:
     case OP_SUBSTR:
-    /* case OP_AEACH: not in 5.10.x */
+    case OP_AEACH:
     case OP_EACH:
     case OP_SORT:
     case OP_CALLER:
@@ -12754,6 +13179,14 @@
 	  Need a better fix at dome point. DAPM 11/2007 */
 	break;
 
+    case OP_FLIP:
+    case OP_FLOP:
+    {
+	GV * const gv = gv_fetchpvs(".", GV_NOTQUAL, SVt_PV);
+	if (gv && GvSV(gv) == uninit_sv)
+	    return newSVpvs_flags("$.", SVs_TEMP);
+	goto do_op;
+    }
 
     case OP_POS:
 	/* def-ness of rval pos() is independent of the def-ness of its arg */
@@ -12819,7 +13252,7 @@
 */
 
 void
-Perl_report_uninit(pTHX_ SV* uninit_sv)
+Perl_report_uninit(pTHX_ const SV *uninit_sv)
 {
     dVAR;
     if (PL_op) {
Index: src/gnu/usr.bin/perl/sv.h
diff -u src/gnu/usr.bin/perl/sv.h:1.13 src/gnu/usr.bin/perl/sv.h:1.14
--- sv.h:1.13	Mon Oct 12 18:24:22 2009
+++ sv.h	Fri Sep 24 15:06:43 2010
@@ -48,11 +48,12 @@
 	SVt_BIND,	/* 1 */
 	SVt_IV,		/* 2 */
 	SVt_NV,		/* 3 */
-	SVt_RV,		/* 4 */
-	SVt_PV,		/* 5 */
-	SVt_PVIV,	/* 6 */
-	SVt_PVNV,	/* 7 */
-	SVt_PVMG,	/* 8 */
+	/* RV was here, before it was merged with IV.  */
+	SVt_PV,		/* 4 */
+	SVt_PVIV,	/* 5 */
+	SVt_PVNV,	/* 6 */
+	SVt_PVMG,	/* 7 */
+	SVt_REGEXP,	/* 8 */
 	/* PVBM was here, before BIND replaced it.  */
 	SVt_PVGV,	/* 9 */
 	SVt_PVLV,	/* 10 */
@@ -69,6 +70,9 @@
    purposes eternal code wanting to consider PVBM probably needs to think of
    PVMG instead.  */
 #  define SVt_PVBM	SVt_PVMG
+/* Anything wanting to create a reference from clean should ensure that it has
+   a scalar of type SVt_IV now:  */
+#  define SVt_RV	SVt_IV
 #endif
 
 /* There is collusion here with sv_clear - sv_clear exits early for SVt_NULL
@@ -99,10 +103,10 @@
 
 #define _SV_HEAD_UNION \
     union {				\
+	char*   svu_pv;		/* pointer to malloced string */	\
 	IV      svu_iv;			\
 	UV      svu_uv;			\
 	SV*     svu_rv;		/* pointer to another SV */		\
-	char*   svu_pv;		/* pointer to malloced string */	\
 	SV**    svu_array;		\
 	HE**	svu_hash;		\
 	GP*	svu_gp;			\
@@ -117,7 +121,7 @@
     PERL_BITFIELD32 sv_debug_inpad:1;	/* was allocated in a pad for an OP */
     PERL_BITFIELD32 sv_debug_cloned:1;	/* was cloned for an ithread */
     PERL_BITFIELD32 sv_debug_line:16;	/* the line where we were allocated */
-    U32		sv_debug_serial;	/* serial number of sv allocation   */
+    U32		    sv_debug_serial;	/* serial number of sv allocation   */
     char *	sv_debug_file;		/* the file where we were allocated */
 #endif
 };
@@ -147,6 +151,11 @@
     _SV_HEAD_UNION;
 };
 
+struct p5rx {
+    _SV_HEAD(struct regexp*);	/* pointer to regexp body */
+    _SV_HEAD_UNION;
+};
+
 #undef _SV_HEAD
 #undef _SV_HEAD_UNION		/* ensure no pollution */
 
@@ -213,7 +222,7 @@
 #define SvFLAGS(sv)	(sv)->sv_flags
 #define SvREFCNT(sv)	(sv)->sv_refcnt
 
-#if defined(__GNUC__) && !defined(__STRICT_ANSI__) && !defined(PERL_GCC_PEDANTIC)
+#if defined(__GNUC__) && !defined(PERL_GCC_BRACE_GROUPS_FORBIDDEN)
 #  define SvREFCNT_inc(sv)		\
     ({					\
 	SV * const _sv = MUTABLE_SV(sv);	\
@@ -256,7 +265,7 @@
 #define SvREFCNT_inc_void_NN(sv)	(void)(++SvREFCNT(MUTABLE_SV(sv)))
 #define SvREFCNT_inc_simple_void_NN(sv)	(void)(++SvREFCNT(MUTABLE_SV(sv)))
 
-#if defined(__GNUC__) && !defined(__STRICT_ANSI__) && !defined(PERL_GCC_PEDANTIC)
+#if defined(__GNUC__) && !defined(PERL_GCC_BRACE_GROUPS_FORBIDDEN)
 #  define SvREFCNT_dec(sv)		\
     ({					\
 	SV * const _sv = MUTABLE_SV(sv);	\
@@ -320,12 +329,10 @@
 				       3: For PVCV, whether CvUNIQUE(cv)
 					  refers to an eval or once only
 					  [CvEVAL(cv), CvSPECIAL(cv)]
-				       4: Whether the regexp pointer is in
-					  fact an offset [SvREPADTMP(sv)]
-				       5: On a pad name SV, that slot in the
+				       4: On a pad name SV, that slot in the
 					  frame AV is a REFCNT'ed reference
 					  to a lexical from "outside". */
-#define SVphv_REHASH	SVf_FAKE    /* 6: On a PVHV, hash values are being
+#define SVphv_REHASH	SVf_FAKE    /* 5: On a PVHV, hash values are being
 					  recalculated */
 #define SVf_OOK		0x02000000  /* has valid offset value. For a PVHV this
 				       means that a hv_aux struct is present
@@ -391,179 +398,77 @@
 /* RV upwards. However, SVf_ROK and SVp_IOK are exclusive  */
 #define SVprv_WEAKREF   0x80000000  /* Weak reference */
 
+#define _XPV_HEAD	\
+    union _xnvu xnv_u;	\
+    STRLEN	xpv_cur;	/* length of svu_pv as a C string */    \
+    STRLEN	xpv_len 	/* allocated size */
+
+union _xnvu {
+    NV	    xnv_nv;		/* numeric value, if any */
+    HV *    xgv_stash;
+    struct {
+	U32 xlow;
+	U32 xhigh;
+    }	    xpad_cop_seq;	/* used by pad.c for cop_sequence */
+    struct {
+	U32 xbm_previous;	/* how many characters in string before rare? */
+	U8  xbm_flags;
+	U8  xbm_rare;		/* rarest character in string */
+    }	    xbm_s;		/* fields from PVBM */
+};
 
-struct xpv {
-    union {
-	NV	xnv_nv;		/* numeric value, if any */
-	HV *	xgv_stash;
-	struct {
-	    U32	xlow;
-	    U32	xhigh;
-	}	xpad_cop_seq;	/* used by pad.c for cop_sequence */
-	struct {
-	    U32 xbm_previous;	/* how many characters in string before rare? */
-	    U8	xbm_flags;
-	    U8	xbm_rare;	/* rarest character in string */
-	}	xbm_s;		/* fields from PVBM */
-    }		xnv_u;
-    STRLEN	xpv_cur;	/* length of svu_pv as a C string */
-    STRLEN	xpv_len;	/* allocated size */
+union _xivu {
+    IV	    xivu_iv;		/* integer value */
+				/* xpvfm: lines */
+    UV	    xivu_uv;
+    void *  xivu_p1;
+    I32	    xivu_i32;
+    HEK *   xivu_namehek;	/* xpvlv, xpvgv: GvNAME */
+    HV *    xivu_hv;		/* regexp: paren_names */
 };
 
-typedef struct {
-    STRLEN	xpv_cur;	/* length of svu_pv as a C string */
-    STRLEN	xpv_len;	/* allocated size */
-} xpv_allocated;
+union _xmgu {
+    MAGIC*  xmg_magic;		/* linked list of magicalness */
+    HV*	    xmg_ourstash;	/* Stash for our (when SvPAD_OUR is true) */
+};
 
-struct xpviv {
-    union {
-	NV	xnv_nv;		/* numeric value, if any */
-	HV *	xgv_stash;
-	struct {
-	    U32	xlow;
-	    U32	xhigh;
-	}	xpad_cop_seq;	/* used by pad.c for cop_sequence */
-	struct {
-	    U32 xbm_previous;	/* how many characters in string before rare? */
-	    U8	xbm_flags;
-	    U8	xbm_rare;	/* rarest character in string */
-	}	xbm_s;		/* fields from PVBM */
-    }		xnv_u;
-    STRLEN	xpv_cur;	/* length of svu_pv as a C string */
-    STRLEN	xpv_len;	/* allocated size */
-    union {
-	IV	xivu_iv;	/* integer value or pv offset */
-	UV	xivu_uv;
-	void *	xivu_p1;
-	I32	xivu_i32;
-	HEK *	xivu_namehek;
-    }		xiv_u;
+struct xpv {
+    _XPV_HEAD;
 };
 
-typedef struct {
-    STRLEN	xpv_cur;	/* length of svu_pv as a C string */
-    STRLEN	xpv_len;	/* allocated size */
-    union {
-	IV	xivu_iv;	/* integer value or pv offset */
-	UV	xivu_uv;
-	void *	xivu_p1;
-	I32	xivu_i32;
-	HEK *	xivu_namehek;
-    }		xiv_u;
-} xpviv_allocated;
+struct xpviv {
+    _XPV_HEAD;
+    union _xivu xiv_u;
+};
 
 #define xiv_iv xiv_u.xivu_iv
 
 struct xpvuv {
-    union {
-	NV	xnv_nv;		/* numeric value, if any */
-	HV *	xgv_stash;
-	struct {
-	    U32	xlow;
-	    U32	xhigh;
-	}	xpad_cop_seq;	/* used by pad.c for cop_sequence */
-	struct {
-	    U32 xbm_previous;	/* how many characters in string before rare? */
-	    U8	xbm_flags;
-	    U8	xbm_rare;	/* rarest character in string */
-	}	xbm_s;		/* fields from PVBM */
-    }		xnv_u;
-    STRLEN	xpv_cur;	/* length of svu_pv as a C string */
-    STRLEN	xpv_len;	/* allocated size */
-    union {
-	IV	xuvu_iv;
-	UV	xuvu_uv;	/* unsigned value or pv offset */
-	void *	xuvu_p1;
-	HEK *	xivu_namehek;
-    }		xuv_u;
+    _XPV_HEAD;
+    union _xivu xuv_u;
 };
 
-#define xuv_uv xuv_u.xuvu_uv
+#define xuv_uv xuv_u.xivu_uv
 
 struct xpvnv {
-    union {
-	NV	xnv_nv;		/* numeric value, if any */
-	HV *	xgv_stash;
-	struct {
-	    U32	xlow;
-	    U32	xhigh;
-	}	xpad_cop_seq;	/* used by pad.c for cop_sequence */
-	struct {
-	    U32 xbm_previous;	/* how many characters in string before rare? */
-	    U8	xbm_flags;
-	    U8	xbm_rare;	/* rarest character in string */
-	}	xbm_s;		/* fields from PVBM */
-    }		xnv_u;
-    STRLEN	xpv_cur;	/* length of svu_pv as a C string */
-    STRLEN	xpv_len;	/* allocated size */
-    union {
-	IV	xivu_iv;	/* integer value or pv offset */
-	UV	xivu_uv;
-	void *	xivu_p1;
-	I32	xivu_i32;
-	HEK *	xivu_namehek;
-    }		xiv_u;
+    _XPV_HEAD;
+    union _xivu xiv_u;
 };
 
-/* These structure must match the beginning of struct xpvhv in hv.h. */
+#define _XPVMG_HEAD				    \
+    union _xivu xiv_u;				    \
+    union _xmgu	xmg_u;				    \
+    HV*		xmg_stash	/* class package */
+
+/* This structure must match the beginning of struct xpvhv in hv.h. */
 struct xpvmg {
-    union {
-	NV	xnv_nv;		/* numeric value, if any */
-	HV *	xgv_stash;
-	struct {
-	    U32	xlow;
-	    U32	xhigh;
-	}	xpad_cop_seq;	/* used by pad.c for cop_sequence */
-	struct {
-	    U32 xbm_previous;	/* how many characters in string before rare? */
-	    U8	xbm_flags;
-	    U8	xbm_rare;	/* rarest character in string */
-	}	xbm_s;		/* fields from PVBM */
-    }		xnv_u;
-    STRLEN	xpv_cur;	/* length of svu_pv as a C string */
-    STRLEN	xpv_len;	/* allocated size */
-    union {
-	IV	xivu_iv;	/* integer value or pv offset */
-	UV	xivu_uv;
-	void *	xivu_p1;
-	I32	xivu_i32;
-	HEK *	xivu_namehek;
-    }		xiv_u;
-    union {
-	MAGIC*	xmg_magic;	/* linked list of magicalness */
-	HV*	xmg_ourstash;	/* Stash for our (when SvPAD_OUR is true) */
-    } xmg_u;
-    HV*		xmg_stash;	/* class package */
+    _XPV_HEAD;
+    _XPVMG_HEAD;
 };
 
 struct xpvlv {
-    union {
-	NV	xnv_nv;		/* numeric value, if any */
-	HV *	xgv_stash;
-	struct {
-	    U32	xlow;
-	    U32	xhigh;
-	}	xpad_cop_seq;	/* used by pad.c for cop_sequence */
-	struct {
-	    U32 xbm_previous;	/* how many characters in string before rare? */
-	    U8	xbm_flags;
-	    U8	xbm_rare;	/* rarest character in string */
-	}	xbm_s;		/* fields from PVBM */
-    }		xnv_u;
-    STRLEN	xpv_cur;	/* length of svu_pv as a C string */
-    STRLEN	xpv_len;	/* allocated size */
-    union {
-	IV	xivu_iv;	/* integer value or pv offset */
-	UV	xivu_uv;
-	void *	xivu_p1;
-	I32	xivu_i32;
-	HEK *	xivu_namehek;	/* GvNAME */
-    }		xiv_u;
-    union {
-	MAGIC*	xmg_magic;	/* linked list of magicalness */
-	HV*	xmg_ourstash;	/* Stash for our (when SvPAD_OUR is true) */
-    } xmg_u;
-    HV*		xmg_stash;	/* class package */
+    _XPV_HEAD;
+    _XPVMG_HEAD;
 
     STRLEN	xlv_targoff;
     STRLEN	xlv_targlen;
@@ -575,182 +480,75 @@
 /* This structure works in 3 ways - regular scalar, GV with GP, or fast
    Boyer-Moore.  */
 struct xpvgv {
-    union {
-	NV	xnv_nv;
-	HV *	xgv_stash;	/* The stash of this GV */
-	struct {
-	    U32	xlow;
-	    U32	xhigh;
-	}	xpad_cop_seq;	/* used by pad.c for cop_sequence */
-	struct {
-	    U32 xbm_previous;	/* how many characters in string before rare? */
-	    U8	xbm_flags;
-	    U8	xbm_rare;	/* rarest character in string */
-	}	xbm_s;		/* fields from PVBM */
-    }		xnv_u;
-    STRLEN	xpv_cur;	/* xgv_flags */
-    STRLEN	xpv_len;	/* 0 */
-    union {
-	IV	xivu_iv;
-	UV	xivu_uv;
-	void *	xivu_p1;
-	I32	xivu_i32;	/* is this constant pattern being useful? */
-	HEK *	xivu_namehek;	/* GvNAME */
-    }		xiv_u;
-    union {
-	MAGIC*	xmg_magic;	/* linked list of magicalness */
-	HV*	xmg_ourstash;	/* Stash for our (when SvPAD_OUR is true) */
-    } xmg_u;
-    HV*		xmg_stash;	/* class package */
-
+    _XPV_HEAD;
+    _XPVMG_HEAD;
 };
 
 /* This structure must match XPVCV in cv.h */
 
 typedef U16 cv_flags_t;
 
+#define _XPVCV_COMMON								\
+    HV *	xcv_stash;							\
+    union {									\
+	OP *	xcv_start;							\
+	ANY	xcv_xsubany;							\
+    }		xcv_start_u;					    		\
+    union {									\
+	OP *	xcv_root;							\
+	void	(*xcv_xsub) (pTHX_ CV*);					\
+    }		xcv_root_u;							\
+    GV *	xcv_gv;								\
+    char *	xcv_file;							\
+    AV *	xcv_padlist;							\
+    CV *	xcv_outside;							\
+    U32		xcv_outside_seq; /* the COP sequence (at the point of our	\
+				  * compilation) in the lexically enclosing	\
+				  * sub */					\
+    cv_flags_t	xcv_flags
+
 struct xpvfm {
-    union {
-	NV	xnv_nv;		/* numeric value, if any */
-	HV *	xgv_stash;
-	struct {
-	    U32	xlow;
-	    U32	xhigh;
-	}	xpad_cop_seq;	/* used by pad.c for cop_sequence */
-	struct {
-	    U32 xbm_previous;	/* how many characters in string before rare? */
-	    U8	xbm_flags;
-	    U8	xbm_rare;	/* rarest character in string */
-	}	xbm_s;		/* fields from PVBM */
-    }		xnv_u;
-    STRLEN	xpv_cur;	/* length of svu_pv as a C string */
-    STRLEN	xpv_len;	/* allocated size */
-    union {
-	IV	xivu_iv;	/* PVFMs use the pv offset */
-	UV	xivu_uv;
-	void *	xivu_p1;
-	I32	xivu_i32;
-	HEK *	xivu_namehek;
-    }		xiv_u;
-    union {
-	MAGIC*	xmg_magic;	/* linked list of magicalness */
-	HV*	xmg_ourstash;	/* Stash for our (when SvPAD_OUR is true) */
-    } xmg_u;
-    HV*		xmg_stash;	/* class package */
-
-    HV *	xcv_stash;
-    union {
-	OP *	xcv_start;
-	ANY	xcv_xsubany;
-    }		xcv_start_u;
-    union {
-	OP *	xcv_root;
-	void	(*xcv_xsub) (pTHX_ CV*);
-    }		xcv_root_u;
-    GV *	xcv_gv;
-    char *	xcv_file;
-    AV *	xcv_padlist;
-    CV *	xcv_outside;
-    U32		xcv_outside_seq; /* the COP sequence (at the point of our
-				  * compilation) in the lexically enclosing
-				  * sub */
-    cv_flags_t	xcv_flags;
-    IV		xfm_lines;
+    _XPV_HEAD;
+    _XPVMG_HEAD;
+    _XPVCV_COMMON;
 };
 
-typedef struct {
-    STRLEN	xpv_cur;	/* length of svu_pv as a C string */
-    STRLEN	xpv_len;	/* allocated size */
-    union {
-	IV	xivu_iv;	/* PVFMs use the pv offset */
-	UV	xivu_uv;
-	void *	xivu_p1;
-	I32	xivu_i32;
-	HEK *	xivu_namehek;
-    }		xiv_u;
-    union {
-	MAGIC*	xmg_magic;	/* linked list of magicalness */
-	HV*	xmg_ourstash;	/* Stash for our (when SvPAD_OUR is true) */
-    } xmg_u;
-    HV*		xmg_stash;	/* class package */
-
-    HV *	xcv_stash;
-    union {
-	OP *	xcv_start;
-	ANY	xcv_xsubany;
-    }		xcv_start_u;
-    union {
-	OP *	xcv_root;
-	void	(*xcv_xsub) (pTHX_ CV*);
-    }		xcv_root_u;
-    GV *	xcv_gv;
-    char *	xcv_file;
-    AV *	xcv_padlist;
-    CV *	xcv_outside;
-    U32		xcv_outside_seq; /* the COP sequence (at the point of our
-				  * compilation) in the lexically enclosing
-				  * sub */
-    cv_flags_t	xcv_flags;
-    IV		xfm_lines;
-} xpvfm_allocated;
+#define _XPVIO_TAIL							\
+    PerlIO *	xio_ifp;	/* ifp and ofp are normally the same */	\
+    PerlIO *	xio_ofp;	/* but sockets need separate streams */	\
+    /* Cray addresses everything by word boundaries (64 bits) and	\
+     * code and data pointers cannot be mixed (which is exactly what	\
+     * Perl_filter_add() tries to do with the dirp), hence the		\
+     *  following union trick (as suggested by Gurusamy Sarathy).	\
+     * For further information see Geir Johansen's problem report	\
+     * titled [ID 20000612.002] Perl problem on Cray system		\
+     * The any pointer (known as IoANY()) will also be a good place	\
+     * to hang any IO disciplines to.					\
+     */									\
+    union {								\
+	DIR *	xiou_dirp;	/* for opendir, readdir, etc */		\
+	void *	xiou_any;	/* for alignment */			\
+    } xio_dirpu;							\
+    /* IV xio_lines is now in IVX  $. */				\
+    IV		xio_page;	/* $% */				\
+    IV		xio_page_len;	/* $= */				\
+    IV		xio_lines_left;	/* $- */				\
+    char *	xio_top_name;	/* $^ */				\
+    GV *	xio_top_gv;	/* $^ */				\
+    char *	xio_fmt_name;	/* $~ */				\
+    GV *	xio_fmt_gv;	/* $~ */				\
+    char *	xio_bottom_name;/* $^B */				\
+    GV *	xio_bottom_gv;	/* $^B */				\
+    char	xio_type;						\
+    U8		xio_flags
+
 
 struct xpvio {
-    union {
-	NV	xnv_nv;		/* numeric value, if any */
-	HV *	xgv_stash;
-	struct {
-	    U32	xlow;
-	    U32	xhigh;
-	}	xpad_cop_seq;	/* used by pad.c for cop_sequence */
-	struct {
-	    U32 xbm_previous;	/* how many characters in string before rare? */
-	    U8	xbm_flags;
-	    U8	xbm_rare;	/* rarest character in string */
-	}	xbm_s;		/* fields from PVBM */
-    }		xnv_u;
-    STRLEN	xpv_cur;	/* length of svu_pv as a C string */
-    STRLEN	xpv_len;	/* allocated size */
-    union {
-	IV	xivu_iv;	/* integer value or pv offset */
-	UV	xivu_uv;
-	void *	xivu_p1;
-	I32	xivu_i32;
-	HEK *	xivu_namehek;
-    }		xiv_u;
-    union {
-	MAGIC*	xmg_magic;	/* linked list of magicalness */
-	HV*	xmg_ourstash;	/* Stash for our (when SvPAD_OUR is true) */
-    } xmg_u;
-    HV*		xmg_stash;	/* class package */
-
-    PerlIO *	xio_ifp;	/* ifp and ofp are normally the same */
-    PerlIO *	xio_ofp;	/* but sockets need separate streams */
-    /* Cray addresses everything by word boundaries (64 bits) and
-     * code and data pointers cannot be mixed (which is exactly what
-     * Perl_filter_add() tries to do with the dirp), hence the following
-     * union trick (as suggested by Gurusamy Sarathy).
-     * For further information see Geir Johansen's problem report titled
-       [ID 20000612.002] Perl problem on Cray system
-     * The any pointer (known as IoANY()) will also be a good place
-     * to hang any IO disciplines to.
-     */
-    union {
-	DIR *	xiou_dirp;	/* for opendir, readdir, etc */
-	void *	xiou_any;	/* for alignment */
-    } xio_dirpu;
-    IV		xio_lines;	/* $. */
-    IV		xio_page;	/* $% */
-    IV		xio_page_len;	/* $= */
-    IV		xio_lines_left;	/* $- */
-    char *	xio_top_name;	/* $^ */
-    GV *	xio_top_gv;	/* $^ */
-    char *	xio_fmt_name;	/* $~ */
-    GV *	xio_fmt_gv;	/* $~ */
-    char *	xio_bottom_name;/* $^B */
-    GV *	xio_bottom_gv;	/* $^B */
-    char	xio_type;
-    U8		xio_flags;
+    _XPV_HEAD;
+    _XPVMG_HEAD;
+    _XPVIO_TAIL;
 };
+
 #define xio_dirp	xio_dirpu.xiou_dirp
 #define xio_any		xio_dirpu.xiou_any
 
@@ -846,10 +644,12 @@
 Returns a boolean indicating whether the SV contains a v-string.
 
 =for apidoc Am|U32|SvOOK|SV* sv
-Returns a U32 indicating whether the SvIVX is a valid offset value for
-the SvPVX.  This hack is used internally to speed up removal of characters
-from the beginning of a SvPV.  When SvOOK is true, then the start of the
-allocated string buffer is really (SvPVX - SvIVX).
+Returns a U32 indicating whether the pointer to the string buffer is offset.
+This hack is used internally to speed up removal of characters from the
+beginning of a SvPV.  When SvOOK is true, then the start of the
+allocated string buffer is actually C<SvOOK_offset()> bytes before SvPVX.
+This offset used to be stored in SvIVX, but is now stored within the spare
+part of the buffer.
 
 =for apidoc Am|U32|SvROK|SV* sv
 Tests if the SV is an RV.
@@ -954,7 +754,7 @@
 
 #define SvOKp(sv)		(SvFLAGS(sv) & (SVp_IOK|SVp_NOK|SVp_POK))
 #define SvIOKp(sv)		(SvFLAGS(sv) & SVp_IOK)
-#define SvIOKp_on(sv)		(assert_not_glob(sv) SvRELEASE_IVX(sv), \
+#define SvIOKp_on(sv)		(assert_not_glob(sv) SvRELEASE_IVX_(sv)	\
 				    SvFLAGS(sv) |= SVp_IOK)
 #define SvNOKp(sv)		(SvFLAGS(sv) & SVp_NOK)
 #define SvNOKp_on(sv)		(assert_not_glob(sv) SvFLAGS(sv) |= SVp_NOK)
@@ -963,7 +763,7 @@
 				 SvFLAGS(sv) |= SVp_POK)
 
 #define SvIOK(sv)		(SvFLAGS(sv) & SVf_IOK)
-#define SvIOK_on(sv)		(assert_not_glob(sv) SvRELEASE_IVX(sv), \
+#define SvIOK_on(sv)		(assert_not_glob(sv) SvRELEASE_IVX_(sv)	\
 				    SvFLAGS(sv) |= (SVf_IOK|SVp_IOK))
 #define SvIOK_off(sv)		(SvFLAGS(sv) &= ~(SVf_IOK|SVp_IOK|SVf_IVisUV))
 #define SvIOK_only(sv)		(SvOK_off(sv), \
@@ -1091,7 +891,7 @@
 
 #define SvGAMAGIC(sv)           (SvGMAGICAL(sv) || SvAMAGIC(sv))
 
-#define Gv_AMG(stash)           (PL_amagic_generation && Gv_AMupdate(stash))
+#define Gv_AMG(stash)           (PL_amagic_generation && Gv_AMupdate(stash, FALSE))
 
 #define SvWEAKREF(sv)		((SvFLAGS(sv) & (SVf_ROK|SVprv_WEAKREF)) \
 				  == (SVf_ROK|SVprv_WEAKREF))
@@ -1173,14 +973,6 @@
 #define SvTAIL_off(sv)		(SvFLAGS(sv) &= ~SVpbm_TAIL)
 
 
-#ifdef USE_ITHREADS
-/* The following uses the FAKE flag to show that a regex pointer is infact
-   its own offset in the regexpad for ithreads */
-#define SvREPADTMP(sv)		(SvFLAGS(sv) & SVf_FAKE)
-#define SvREPADTMP_on(sv)	(SvFLAGS(sv) |= SVf_FAKE)
-#define SvREPADTMP_off(sv)	(SvFLAGS(sv) &= ~SVf_FAKE)
-#endif
-
 #define SvPAD_TYPED(sv) \
 	((SvFLAGS(sv) & (SVpad_NAME|SVpad_TYPED)) == (SVpad_NAME|SVpad_TYPED))
 
@@ -1278,6 +1070,8 @@
 	    assert(SvTYPE(_svivx) != SVt_PVAV);				\
 	    assert(SvTYPE(_svivx) != SVt_PVHV);				\
 	    assert(SvTYPE(_svivx) != SVt_PVCV);				\
+	    assert(SvTYPE(_svivx) != SVt_PVFM);				\
+	    assert(SvTYPE(_svivx) != SVt_PVIO);				\
 	    assert(!isGV_with_GP(_svivx));				\
 	    &(((XPVIV*) MUTABLE_PTR(SvANY(_svivx)))->xiv_iv);		\
 	 }))
@@ -1287,6 +1081,8 @@
 	    assert(SvTYPE(_svuvx) != SVt_PVAV);				\
 	    assert(SvTYPE(_svuvx) != SVt_PVHV);				\
 	    assert(SvTYPE(_svuvx) != SVt_PVCV);				\
+	    assert(SvTYPE(_svuvx) != SVt_PVFM);				\
+	    assert(SvTYPE(_svuvx) != SVt_PVIO);				\
 	    assert(!isGV_with_GP(_svuvx));				\
 	    &(((XPVUV*) MUTABLE_PTR(SvANY(_svuvx)))->xuv_uv);		\
 	 }))
@@ -1297,12 +1093,13 @@
 	    assert(SvTYPE(_svnvx) != SVt_PVHV);				\
 	    assert(SvTYPE(_svnvx) != SVt_PVCV);				\
 	    assert(SvTYPE(_svnvx) != SVt_PVFM);				\
+	    assert(SvTYPE(_svnvx) != SVt_PVIO);				\
 	    assert(!isGV_with_GP(_svnvx));				\
 	    &(((XPVNV*) MUTABLE_PTR(SvANY(_svnvx)))->xnv_u.xnv_nv);	\
 	 }))
 #    define SvRV(sv)							\
 	(*({ SV *const _svrv = MUTABLE_SV(sv);				\
-	    assert(SvTYPE(_svrv) >= SVt_RV);				\
+	    assert(SvTYPE(_svrv) >= SVt_PV || SvTYPE(_svrv) == SVt_IV);	\
 	    assert(SvTYPE(_svrv) != SVt_PVAV);				\
 	    assert(SvTYPE(_svrv) != SVt_PVHV);				\
 	    assert(SvTYPE(_svrv) != SVt_PVCV);				\
@@ -1312,7 +1109,7 @@
 	 }))
 #    define SvRV_const(sv)						\
 	({ const SV *const _svrv = (const SV *)(sv);			\
-	    assert(SvTYPE(_svrv) >= SVt_RV);				\
+	    assert(SvTYPE(_svrv) >= SVt_PV || SvTYPE(_svrv) == SVt_IV);	\
 	    assert(SvTYPE(_svrv) != SVt_PVAV);				\
 	    assert(SvTYPE(_svrv) != SVt_PVHV);				\
 	    assert(SvTYPE(_svrv) != SVt_PVCV);				\
@@ -1382,6 +1179,7 @@
 	STMT_START { assert(SvTYPE(sv) == SVt_NV || SvTYPE(sv) >= SVt_PVNV); \
 	    assert(SvTYPE(sv) != SVt_PVAV); assert(SvTYPE(sv) != SVt_PVHV); \
 	    assert(SvTYPE(sv) != SVt_PVCV); assert(SvTYPE(sv) != SVt_PVFM); \
+		assert(SvTYPE(sv) != SVt_PVIO);		\
 		assert(!isGV_with_GP(sv));		\
 		(((XPVNV*)SvANY(sv))->xnv_u.xnv_nv = (val)); } STMT_END
 #define SvPV_set(sv, val) \
@@ -1398,7 +1196,7 @@
 		assert(!isGV_with_GP(sv));		\
 		(((XPVUV*)SvANY(sv))->xuv_uv = (val)); } STMT_END
 #define SvRV_set(sv, val) \
-        STMT_START { assert(SvTYPE(sv) >=  SVt_RV); \
+        STMT_START { assert(SvTYPE(sv) >=  SVt_PV || SvTYPE(sv) ==  SVt_IV); \
 		assert(SvTYPE(sv) != SVt_PVAV);		\
 		assert(SvTYPE(sv) != SVt_PVHV);		\
 		assert(SvTYPE(sv) != SVt_PVCV);		\
@@ -1445,7 +1243,9 @@
 		     if (SvLEN(sv)) {					\
 			 assert(!SvROK(sv));				\
 			 if(SvOOK(sv)) {				\
-			     SvPV_set(sv, SvPVX_mutable(sv) - SvIVX(sv)); \
+			     STRLEN zok; 				\
+			     SvOOK_offset(sv, zok);			\
+			     SvPV_set(sv, SvPVX_mutable(sv) - zok);	\
 			     SvFLAGS(sv) &= ~SVf_OOK;			\
 			 }						\
 			 Safefree(SvPVX(sv));				\
@@ -1457,9 +1257,9 @@
    a reference */
 #  define prepare_SV_for_RV(sv)						\
     STMT_START {							\
-		    if (SvTYPE(sv) < SVt_RV)				\
-			sv_upgrade(sv, SVt_RV);				\
-		    else if (SvPVX_const(sv)) {				\
+		    if (SvTYPE(sv) < SVt_PV && SvTYPE(sv) != SVt_IV)	\
+			sv_upgrade(sv, SVt_IV);				\
+		    else if (SvTYPE(sv) >= SVt_PV) {			\
 			SvPV_free(sv);					\
 			SvLEN_set(sv, 0);				\
                         SvCUR_set(sv, 0);				\
@@ -1506,7 +1306,7 @@
 
 #endif
 
-#define FmLINES(sv)	((XPVFM*)  SvANY(sv))->xfm_lines
+#define FmLINES(sv)	((XPVFM*)  SvANY(sv))->xiv_u.xivu_iv
 
 #define LvTYPE(sv)	((XPVLV*)  SvANY(sv))->xlv_type
 #define LvTARG(sv)	((XPVLV*)  SvANY(sv))->xlv_targ
@@ -1517,7 +1317,7 @@
 #define IoOFP(sv)	((XPVIO*)  SvANY(sv))->xio_ofp
 #define IoDIRP(sv)	((XPVIO*)  SvANY(sv))->xio_dirp
 #define IoANY(sv)	((XPVIO*)  SvANY(sv))->xio_any
-#define IoLINES(sv)	((XPVIO*)  SvANY(sv))->xio_lines
+#define IoLINES(sv)	((XPVIO*)  SvANY(sv))->xiv_u.xivu_iv
 #define IoPAGE(sv)	((XPVIO*)  SvANY(sv))->xio_page
 #define IoPAGE_LEN(sv)	((XPVIO*)  SvANY(sv))->xio_page_len
 #define IoLINES_LEFT(sv)((XPVIO*)  SvANY(sv))->xio_lines_left
@@ -1892,6 +1692,12 @@
 #define SV_COW_SHARED_HASH_KEYS	512
 /* This one is only enabled for PERL_OLD_COPY_ON_WRITE */
 #define SV_COW_OTHER_PVS	1024
+/* Make sv_2pv_flags return NULL if something is undefined.  */
+#define SV_UNDEF_RETURNS_NULL	2048
+/* Tell sv_utf8_upgrade() to not check to see if an upgrade is really needed.
+ * This is used when the caller has already determined it is, and avoids
+ * redundant work */
+#define SV_FORCE_UTF8_UPGRADE	4096
 
 /* The core is safe for this COW optimisation. XS code on CPAN may not be.
    So only default to doing the COW setup if we're in the core.
@@ -1923,10 +1729,16 @@
 
 #ifdef PERL_OLD_COPY_ON_WRITE
 #define SvRELEASE_IVX(sv)   \
-    ((SvIsCOW(sv) ? sv_force_normal_flags(sv, 0) : (void) 0), SvOOK_off(sv))
+    ((SvIsCOW(sv) ? sv_force_normal_flags(sv, 0) : (void) 0), 0)
 #  define SvIsCOW_normal(sv)	(SvIsCOW(sv) && SvLEN(sv))
+#  define SvRELEASE_IVX_(sv)	SvRELEASE_IVX(sv),
 #else
-#  define SvRELEASE_IVX(sv)   SvOOK_off(sv)
+#  define SvRELEASE_IVX(sv)   0
+/* This little game brought to you by the need to shut this warning up:
+mg.c: In function `Perl_magic_get':
+mg.c:1024: warning: left-hand operand of comma expression has no effect
+*/
+#  define SvRELEASE_IVX_(sv)  /**/
 #endif /* PERL_OLD_COPY_ON_WRITE */
 
 #define CAN_COW_MASK	(SVs_OBJECT|SVs_GMG|SVs_SMG|SVs_RMG|SVf_IOK|SVf_NOK| \
@@ -1945,6 +1757,7 @@
 #define sv_pvbyte(sv) SvPVbyte_nolen(sv)
 
 #define sv_pvn_force_nomg(sv, lp) sv_pvn_force_flags(sv, lp, 0)
+#define sv_utf8_upgrade_flags(sv, flags) sv_utf8_upgrade_flags_grow(sv, flags, 0)
 #define sv_utf8_upgrade_nomg(sv) sv_utf8_upgrade_flags(sv, 0)
 #define sv_catpvn_nomg(dsv, sstr, slen) sv_catpvn_flags(dsv, sstr, slen, 0)
 #define sv_setsv(dsv, ssv) \
@@ -2132,6 +1945,63 @@
 */
 
 #define newSVpvn_utf8(s, len, u) newSVpvn_flags((s), (len), (u) ? SVf_UTF8 : 0)
+
+/*
+=for apidoc Am|void|SvOOK_offset|NN SV*sv|STRLEN len
+
+Reads into I<len> the offset from SvPVX back to the true start of the
+allocated buffer, which will be non-zero if C<sv_chop> has been used to
+efficiently remove characters from start of the buffer. Implemented as a
+macro, which takes the address of I<len>, which must be of type C<STRLEN>.
+Evaluates I<sv> more than once. Sets I<len> to 0 if C<SvOOK(sv)> is false.
+
+=cut
+*/
+
+#ifdef DEBUGGING
+/* Does the bot know something I don't?
+10:28 <@Nicholas> metabatman
+10:28 <+meta> Nicholas: crash
+*/
+#  define SvOOK_offset(sv, offset) STMT_START {				\
+	assert(sizeof(offset) == sizeof(STRLEN));			\
+	if (SvOOK(sv)) {						\
+	    const U8 *crash = (U8*)SvPVX_const(sv);			\
+	    offset = *--crash;						\
+ 	    if (!offset) {						\
+		crash -= sizeof(STRLEN);				\
+		Copy(crash, (U8 *)&offset, sizeof(STRLEN), U8);		\
+	    }								\
+	    {								\
+		/* Validate the preceding buffer's sentinels to		\
+		   verify that no-one is using it.  */			\
+		const U8 *const bonk = (U8 *) SvPVX_const(sv) - offset;	\
+		while (crash > bonk) {					\
+		    --crash;						\
+		    assert (*crash == (U8)PTR2UV(crash));		\
+		}							\
+	    }								\
+	} else {							\
+	    offset = 0;							\
+	}								\
+    } STMT_END
+#else
+    /* This is the same code, but avoids using any temporary variables:  */
+#  define SvOOK_offset(sv, offset) STMT_START {				\
+	assert(sizeof(offset) == sizeof(STRLEN));			\
+	if (SvOOK(sv)) {						\
+	    offset = ((U8*)SvPVX_const(sv))[-1];			\
+	    if (!offset) {						\
+		Copy(SvPVX_const(sv) - 1 - sizeof(STRLEN),		\
+		     (U8 *)&offset, sizeof(STRLEN), U8);		\
+	    }								\
+	} else {							\
+	    offset = 0;							\
+	}								\
+    } STMT_END
+#endif
+
+#define newIO()	MUTABLE_IO(newSV_type(SVt_PVIO))
 
 /*
  * Local variables:
Index: src/gnu/usr.bin/perl/taint.c
diff -u src/gnu/usr.bin/perl/taint.c:1.12 src/gnu/usr.bin/perl/taint.c:1.13
--- taint.c:1.12	Mon Oct 12 18:24:22 2009
+++ taint.c	Fri Sep 24 15:06:43 2010
@@ -24,7 +24,7 @@
 #include "perl.h"
 
 void
-Perl_taint_proper(pTHX_ const char *f, const char *s)
+Perl_taint_proper(pTHX_ const char *f, const char *const s)
 {
 #if defined(HAS_SETEUID) && defined(DEBUGGING)
     dVAR;
@@ -66,8 +66,7 @@
         else
 	    ug = " while running with -T switch";
 	if (PL_unsafe || PL_taint_warn) {
-            if(ckWARN_d(WARN_TAINT))
-                Perl_warner(aTHX_ packWARN(WARN_TAINT), f, s, ug);
+	    Perl_ck_warner_d(aTHX_ packWARN(WARN_TAINT), f, s, ug);
         }
         else {
             Perl_croak(aTHX_ f, s, ug);
Index: src/gnu/usr.bin/perl/toke.c
diff -u src/gnu/usr.bin/perl/toke.c:1.14 src/gnu/usr.bin/perl/toke.c:1.15
--- toke.c:1.14	Mon Oct 12 18:24:22 2009
+++ toke.c	Fri Sep 24 15:06:43 2010
@@ -21,6 +21,21 @@
  * The main routine is yylex(), which returns the next token.
  */
 
+/*
+=head1 Lexer interface
+
+This is the lower layer of the Perl parser, managing characters and tokens.
+
+=for apidoc AmU|yy_parser *|PL_parser
+
+Pointer to a structure encapsulating the state of the parsing operation
+currently in progress.  The pointer can be locally changed to perform
+a nested parse without interfering with the state of an outer parse.
+Individual members of C<PL_parser> have their own documentation.
+
+=cut
+*/
+
 #include "EXTERN.h"
 #define PERL_IN_TOKE_C
 #include "perl.h"
@@ -96,16 +111,12 @@
 #  define PL_nextval		(PL_parser->nextval)
 #endif
 
+/* This can't be done with embed.fnc, because struct yy_parser contains a
+   member named pending_ident, which clashes with the generated #define  */
 static int
 S_pending_ident(pTHX);
 
 static const char ident_too_long[] = "Identifier too long";
-static const char commaless_variable_list[] = "comma-less variable list";
-
-#ifndef PERL_NO_UTF16_FILTER
-static I32 utf16_textfilter(pTHX_ int idx, SV *sv, int maxlen);
-static I32 utf16rev_textfilter(pTHX_ int idx, SV *sv, int maxlen);
-#endif
 
 #ifdef PERL_MAD
 #  define CURMAD(slot,sv) if (PL_madskills) { curmad(slot,sv); sv = 0; }
@@ -124,16 +135,14 @@
 #   define UTF ((PL_linestr && DO_UTF8(PL_linestr)) || (PL_hints & HINT_UTF8))
 #endif
 
+/* The maximum number of characters preceding the unrecognized one to display */
+#define UNRECOGNIZED_PRECEDE_COUNT 10
+
 /* In variables named $^X, these are the legal values for X.
  * 1999-02-27 mjd-perl-patch@plover.com */
 #define isCONTROLVAR(x) (isUPPER(x) || strchr("[\\]^_?", (x)))
 
-/* On MacOS, respect nonbreaking spaces */
-#ifdef MACOS_TRADITIONAL
-#define SPACE_OR_TAB(c) ((c)==' '||(c)=='\312'||(c)=='\t')
-#else
 #define SPACE_OR_TAB(c) ((c)==' '||(c)=='\t')
-#endif
 
 /* LEX_* are values for PL_lex_state, the state of the lexer.
  * They are arranged oddly so that the guard on the switch statement
@@ -349,6 +358,8 @@
     { OROP,		TOKENTYPE_IVAL,		"OROP" },
     { OROR,		TOKENTYPE_NONE,		"OROR" },
     { PACKAGE,		TOKENTYPE_NONE,		"PACKAGE" },
+    { PLUGEXPR,		TOKENTYPE_OPVAL,	"PLUGEXPR" },
+    { PLUGSTMT,		TOKENTYPE_OPVAL,	"PLUGSTMT" },
     { PMFUNC,		TOKENTYPE_OPVAL,	"PMFUNC" },
     { POSTDEC,		TOKENTYPE_NONE,		"POSTDEC" },
     { POSTINC,		TOKENTYPE_NONE,		"POSTINC" },
@@ -370,6 +381,7 @@
     { WHEN,		TOKENTYPE_IVAL,		"WHEN" },
     { WHILE,		TOKENTYPE_IVAL,		"WHILE" },
     { WORD,		TOKENTYPE_OPVAL,	"WORD" },
+    { YADAYADA,		TOKENTYPE_IVAL,		"YADAYADA" },
     { 0,		TOKENTYPE_NONE,		NULL }
 };
 
@@ -440,7 +452,7 @@
 /* print the buffer with suitable escapes */
 
 STATIC void
-S_printbuf(pTHX_ const char* fmt, const char* s)
+S_printbuf(pTHX_ const char *const fmt, const char *const s)
 {
     SV* const tmp = newSVpvs("");
 
@@ -452,6 +464,13 @@
 
 #endif
 
+static int
+S_deprecate_commaless_var_list(pTHX) {
+    PL_expect = XTERM;
+    deprecate("comma-less variable list");
+    return REPORT(','); /* grandfather non-comma-format format */
+}
+
 /*
  * S_ao
  *
@@ -490,7 +509,7 @@
  */
 
 STATIC void
-S_no_op(pTHX_ const char *what, char *s)
+S_no_op(pTHX_ const char *const what, char *s)
 {
     dVAR;
     char * const oldbp = PL_bufptr;
@@ -564,14 +583,14 @@
 	((0 != (PL_hints & HINT_LOCALIZE_HH))				\
 	    && S_feature_is_enabled(aTHX_ STR_WITH_LEN(name)))
 /* The longest string we pass in.  */
-#define MAX_FEATURE_LEN (sizeof("switch")-1)
+#define MAX_FEATURE_LEN (sizeof("unicode_strings")-1)
 
 /*
  * S_feature_is_enabled
  * Check whether the named feature is enabled.
  */
 STATIC bool
-S_feature_is_enabled(pTHX_ const char *name, STRLEN namelen)
+S_feature_is_enabled(pTHX_ const char *const name, STRLEN namelen)
 {
     dVAR;
     HV * const hinthv = GvHV(PL_hintgv);
@@ -586,37 +605,6 @@
 }
 
 /*
- * Perl_deprecate
- */
-
-void
-Perl_deprecate(pTHX_ const char *s)
-{
-    PERL_ARGS_ASSERT_DEPRECATE;
-
-    if (ckWARN(WARN_DEPRECATED))
-	Perl_warner(aTHX_ packWARN(WARN_DEPRECATED), "Use of %s is deprecated", s);
-}
-
-void
-Perl_deprecate_old(pTHX_ const char *s)
-{
-    /* This function should NOT be called for any new deprecated warnings */
-    /* Use Perl_deprecate instead                                         */
-    /*                                                                    */
-    /* It is here to maintain backward compatibility with the pre-5.8     */
-    /* warnings category hierarchy. The "deprecated" category used to     */
-    /* live under the "syntax" category. It is now a top-level category   */
-    /* in its own right.                                                  */
-
-    PERL_ARGS_ASSERT_DEPRECATE_OLD;
-
-    if (ckWARN2(WARN_DEPRECATED, WARN_SYNTAX))
-	Perl_warner(aTHX_ packWARN2(WARN_DEPRECATED, WARN_SYNTAX),
-			"Use of %s is deprecated", s);
-}
-
-/*
  * experimental text filters for win32 carriage-returns, utf16-to-utf8 and
  * utf16-to-utf8-reversed.
  */
@@ -783,6 +771,709 @@
 }
 
 /*
+=for apidoc AmxU|SV *|PL_parser-E<gt>linestr
+
+Buffer scalar containing the chunk currently under consideration of the
+text currently being lexed.  This is always a plain string scalar (for
+which C<SvPOK> is true).  It is not intended to be used as a scalar by
+normal scalar means; instead refer to the buffer directly by the pointer
+variables described below.
+
+The lexer maintains various C<char*> pointers to things in the
+C<PL_parser-E<gt>linestr> buffer.  If C<PL_parser-E<gt>linestr> is ever
+reallocated, all of these pointers must be updated.  Don't attempt to
+do this manually, but rather use L</lex_grow_linestr> if you need to
+reallocate the buffer.
+
+The content of the text chunk in the buffer is commonly exactly one
+complete line of input, up to and including a newline terminator,
+but there are situations where it is otherwise.  The octets of the
+buffer may be intended to be interpreted as either UTF-8 or Latin-1.
+The function L</lex_bufutf8> tells you which.  Do not use the C<SvUTF8>
+flag on this scalar, which may disagree with it.
+
+For direct examination of the buffer, the variable
+L</PL_parser-E<gt>bufend> points to the end of the buffer.  The current
+lexing position is pointed to by L</PL_parser-E<gt>bufptr>.  Direct use
+of these pointers is usually preferable to examination of the scalar
+through normal scalar means.
+
+=for apidoc AmxU|char *|PL_parser-E<gt>bufend
+
+Direct pointer to the end of the chunk of text currently being lexed, the
+end of the lexer buffer.  This is equal to C<SvPVX(PL_parser-E<gt>linestr)
++ SvCUR(PL_parser-E<gt>linestr)>.  A NUL character (zero octet) is
+always located at the end of the buffer, and does not count as part of
+the buffer's contents.
+
+=for apidoc AmxU|char *|PL_parser-E<gt>bufptr
+
+Points to the current position of lexing inside the lexer buffer.
+Characters around this point may be freely examined, within
+the range delimited by C<SvPVX(L</PL_parser-E<gt>linestr>)> and
+L</PL_parser-E<gt>bufend>.  The octets of the buffer may be intended to be
+interpreted as either UTF-8 or Latin-1, as indicated by L</lex_bufutf8>.
+
+Lexing code (whether in the Perl core or not) moves this pointer past
+the characters that it consumes.  It is also expected to perform some
+bookkeeping whenever a newline character is consumed.  This movement
+can be more conveniently performed by the function L</lex_read_to>,
+which handles newlines appropriately.
+
+Interpretation of the buffer's octets can be abstracted out by
+using the slightly higher-level functions L</lex_peek_unichar> and
+L</lex_read_unichar>.
+
+=for apidoc AmxU|char *|PL_parser-E<gt>linestart
+
+Points to the start of the current line inside the lexer buffer.
+This is useful for indicating at which column an error occurred, and
+not much else.  This must be updated by any lexing code that consumes
+a newline; the function L</lex_read_to> handles this detail.
+
+=cut
+*/
+
+/*
+=for apidoc Amx|bool|lex_bufutf8
+
+Indicates whether the octets in the lexer buffer
+(L</PL_parser-E<gt>linestr>) should be interpreted as the UTF-8 encoding
+of Unicode characters.  If not, they should be interpreted as Latin-1
+characters.  This is analogous to the C<SvUTF8> flag for scalars.
+
+In UTF-8 mode, it is not guaranteed that the lexer buffer actually
+contains valid UTF-8.  Lexing code must be robust in the face of invalid
+encoding.
+
+The actual C<SvUTF8> flag of the L</PL_parser-E<gt>linestr> scalar
+is significant, but not the whole story regarding the input character
+encoding.  Normally, when a file is being read, the scalar contains octets
+and its C<SvUTF8> flag is off, but the octets should be interpreted as
+UTF-8 if the C<use utf8> pragma is in effect.  During a string eval,
+however, the scalar may have the C<SvUTF8> flag on, and in this case its
+octets should be interpreted as UTF-8 unless the C<use bytes> pragma
+is in effect.  This logic may change in the future; use this function
+instead of implementing the logic yourself.
+
+=cut
+*/
+
+bool
+Perl_lex_bufutf8(pTHX)
+{
+    return UTF;
+}
+
+/*
+=for apidoc Amx|char *|lex_grow_linestr|STRLEN len
+
+Reallocates the lexer buffer (L</PL_parser-E<gt>linestr>) to accommodate
+at least I<len> octets (including terminating NUL).  Returns a
+pointer to the reallocated buffer.  This is necessary before making
+any direct modification of the buffer that would increase its length.
+L</lex_stuff_pvn> provides a more convenient way to insert text into
+the buffer.
+
+Do not use C<SvGROW> or C<sv_grow> directly on C<PL_parser-E<gt>linestr>;
+this function updates all of the lexer's variables that point directly
+into the buffer.
+
+=cut
+*/
+
+char *
+Perl_lex_grow_linestr(pTHX_ STRLEN len)
+{
+    SV *linestr;
+    char *buf;
+    STRLEN bufend_pos, bufptr_pos, oldbufptr_pos, oldoldbufptr_pos;
+    STRLEN linestart_pos, last_uni_pos, last_lop_pos;
+    linestr = PL_parser->linestr;
+    buf = SvPVX(linestr);
+    if (len <= SvLEN(linestr))
+	return buf;
+    bufend_pos = PL_parser->bufend - buf;
+    bufptr_pos = PL_parser->bufptr - buf;
+    oldbufptr_pos = PL_parser->oldbufptr - buf;
+    oldoldbufptr_pos = PL_parser->oldoldbufptr - buf;
+    linestart_pos = PL_parser->linestart - buf;
+    last_uni_pos = PL_parser->last_uni ? PL_parser->last_uni - buf : 0;
+    last_lop_pos = PL_parser->last_lop ? PL_parser->last_lop - buf : 0;
+    buf = sv_grow(linestr, len);
+    PL_parser->bufend = buf + bufend_pos;
+    PL_parser->bufptr = buf + bufptr_pos;
+    PL_parser->oldbufptr = buf + oldbufptr_pos;
+    PL_parser->oldoldbufptr = buf + oldoldbufptr_pos;
+    PL_parser->linestart = buf + linestart_pos;
+    if (PL_parser->last_uni)
+	PL_parser->last_uni = buf + last_uni_pos;
+    if (PL_parser->last_lop)
+	PL_parser->last_lop = buf + last_lop_pos;
+    return buf;
+}
+
+/*
+=for apidoc Amx|void|lex_stuff_pvn|char *pv|STRLEN len|U32 flags
+
+Insert characters into the lexer buffer (L</PL_parser-E<gt>linestr>),
+immediately after the current lexing point (L</PL_parser-E<gt>bufptr>),
+reallocating the buffer if necessary.  This means that lexing code that
+runs later will see the characters as if they had appeared in the input.
+It is not recommended to do this as part of normal parsing, and most
+uses of this facility run the risk of the inserted characters being
+interpreted in an unintended manner.
+
+The string to be inserted is represented by I<len> octets starting
+at I<pv>.  These octets are interpreted as either UTF-8 or Latin-1,
+according to whether the C<LEX_STUFF_UTF8> flag is set in I<flags>.
+The characters are recoded for the lexer buffer, according to how the
+buffer is currently being interpreted (L</lex_bufutf8>).  If a string
+to be interpreted is available as a Perl scalar, the L</lex_stuff_sv>
+function is more convenient.
+
+=cut
+*/
+
+void
+Perl_lex_stuff_pvn(pTHX_ char *pv, STRLEN len, U32 flags)
+{
+    dVAR;
+    char *bufptr;
+    PERL_ARGS_ASSERT_LEX_STUFF_PVN;
+    if (flags & ~(LEX_STUFF_UTF8))
+	Perl_croak(aTHX_ "Lexing code internal error (%s)", "lex_stuff_pvn");
+    if (UTF) {
+	if (flags & LEX_STUFF_UTF8) {
+	    goto plain_copy;
+	} else {
+	    STRLEN highhalf = 0;
+	    char *p, *e = pv+len;
+	    for (p = pv; p != e; p++)
+		highhalf += !!(((U8)*p) & 0x80);
+	    if (!highhalf)
+		goto plain_copy;
+	    lex_grow_linestr(SvCUR(PL_parser->linestr)+1+len+highhalf);
+	    bufptr = PL_parser->bufptr;
+	    Move(bufptr, bufptr+len+highhalf, PL_parser->bufend+1-bufptr, char);
+	    SvCUR_set(PL_parser->linestr,
+	    	SvCUR(PL_parser->linestr) + len+highhalf);
+	    PL_parser->bufend += len+highhalf;
+	    for (p = pv; p != e; p++) {
+		U8 c = (U8)*p;
+		if (c & 0x80) {
+		    *bufptr++ = (char)(0xc0 | (c >> 6));
+		    *bufptr++ = (char)(0x80 | (c & 0x3f));
+		} else {
+		    *bufptr++ = (char)c;
+		}
+	    }
+	}
+    } else {
+	if (flags & LEX_STUFF_UTF8) {
+	    STRLEN highhalf = 0;
+	    char *p, *e = pv+len;
+	    for (p = pv; p != e; p++) {
+		U8 c = (U8)*p;
+		if (c >= 0xc4) {
+		    Perl_croak(aTHX_ "Lexing code attempted to stuff "
+				"non-Latin-1 character into Latin-1 input");
+		} else if (c >= 0xc2 && p+1 != e &&
+			    (((U8)p[1]) & 0xc0) == 0x80) {
+		    p++;
+		    highhalf++;
+		} else if (c >= 0x80) {
+		    /* malformed UTF-8 */
+		    ENTER;
+		    SAVESPTR(PL_warnhook);
+		    PL_warnhook = PERL_WARNHOOK_FATAL;
+		    utf8n_to_uvuni((U8*)p, e-p, NULL, 0);
+		    LEAVE;
+		}
+	    }
+	    if (!highhalf)
+		goto plain_copy;
+	    lex_grow_linestr(SvCUR(PL_parser->linestr)+1+len-highhalf);
+	    bufptr = PL_parser->bufptr;
+	    Move(bufptr, bufptr+len-highhalf, PL_parser->bufend+1-bufptr, char);
+	    SvCUR_set(PL_parser->linestr,
+	    	SvCUR(PL_parser->linestr) + len-highhalf);
+	    PL_parser->bufend += len-highhalf;
+	    for (p = pv; p != e; p++) {
+		U8 c = (U8)*p;
+		if (c & 0x80) {
+		    *bufptr++ = (char)(((c & 0x3) << 6) | (p[1] & 0x3f));
+		    p++;
+		} else {
+		    *bufptr++ = (char)c;
+		}
+	    }
+	} else {
+	    plain_copy:
+	    lex_grow_linestr(SvCUR(PL_parser->linestr)+1+len);
+	    bufptr = PL_parser->bufptr;
+	    Move(bufptr, bufptr+len, PL_parser->bufend+1-bufptr, char);
+	    SvCUR_set(PL_parser->linestr, SvCUR(PL_parser->linestr) + len);
+	    PL_parser->bufend += len;
+	    Copy(pv, bufptr, len, char);
+	}
+    }
+}
+
+/*
+=for apidoc Amx|void|lex_stuff_sv|SV *sv|U32 flags
+
+Insert characters into the lexer buffer (L</PL_parser-E<gt>linestr>),
+immediately after the current lexing point (L</PL_parser-E<gt>bufptr>),
+reallocating the buffer if necessary.  This means that lexing code that
+runs later will see the characters as if they had appeared in the input.
+It is not recommended to do this as part of normal parsing, and most
+uses of this facility run the risk of the inserted characters being
+interpreted in an unintended manner.
+
+The string to be inserted is the string value of I<sv>.  The characters
+are recoded for the lexer buffer, according to how the buffer is currently
+being interpreted (L</lex_bufutf8>).  If a string to be interpreted is
+not already a Perl scalar, the L</lex_stuff_pvn> function avoids the
+need to construct a scalar.
+
+=cut
+*/
+
+void
+Perl_lex_stuff_sv(pTHX_ SV *sv, U32 flags)
+{
+    char *pv;
+    STRLEN len;
+    PERL_ARGS_ASSERT_LEX_STUFF_SV;
+    if (flags)
+	Perl_croak(aTHX_ "Lexing code internal error (%s)", "lex_stuff_sv");
+    pv = SvPV(sv, len);
+    lex_stuff_pvn(pv, len, flags | (SvUTF8(sv) ? LEX_STUFF_UTF8 : 0));
+}
+
+/*
+=for apidoc Amx|void|lex_unstuff|char *ptr
+
+Discards text about to be lexed, from L</PL_parser-E<gt>bufptr> up to
+I<ptr>.  Text following I<ptr> will be moved, and the buffer shortened.
+This hides the discarded text from any lexing code that runs later,
+as if the text had never appeared.
+
+This is not the normal way to consume lexed text.  For that, use
+L</lex_read_to>.
+
+=cut
+*/
+
+void
+Perl_lex_unstuff(pTHX_ char *ptr)
+{
+    char *buf, *bufend;
+    STRLEN unstuff_len;
+    PERL_ARGS_ASSERT_LEX_UNSTUFF;
+    buf = PL_parser->bufptr;
+    if (ptr < buf)
+	Perl_croak(aTHX_ "Lexing code internal error (%s)", "lex_unstuff");
+    if (ptr == buf)
+	return;
+    bufend = PL_parser->bufend;
+    if (ptr > bufend)
+	Perl_croak(aTHX_ "Lexing code internal error (%s)", "lex_unstuff");
+    unstuff_len = ptr - buf;
+    Move(ptr, buf, bufend+1-ptr, char);
+    SvCUR_set(PL_parser->linestr, SvCUR(PL_parser->linestr) - unstuff_len);
+    PL_parser->bufend = bufend - unstuff_len;
+}
+
+/*
+=for apidoc Amx|void|lex_read_to|char *ptr
+
+Consume text in the lexer buffer, from L</PL_parser-E<gt>bufptr> up
+to I<ptr>.  This advances L</PL_parser-E<gt>bufptr> to match I<ptr>,
+performing the correct bookkeeping whenever a newline character is passed.
+This is the normal way to consume lexed text.
+
+Interpretation of the buffer's octets can be abstracted out by
+using the slightly higher-level functions L</lex_peek_unichar> and
+L</lex_read_unichar>.
+
+=cut
+*/
+
+void
+Perl_lex_read_to(pTHX_ char *ptr)
+{
+    char *s;
+    PERL_ARGS_ASSERT_LEX_READ_TO;
+    s = PL_parser->bufptr;
+    if (ptr < s || ptr > PL_parser->bufend)
+	Perl_croak(aTHX_ "Lexing code internal error (%s)", "lex_read_to");
+    for (; s != ptr; s++)
+	if (*s == '\n') {
+	    CopLINE_inc(PL_curcop);
+	    PL_parser->linestart = s+1;
+	}
+    PL_parser->bufptr = ptr;
+}
+
+/*
+=for apidoc Amx|void|lex_discard_to|char *ptr
+
+Discards the first part of the L</PL_parser-E<gt>linestr> buffer,
+up to I<ptr>.  The remaining content of the buffer will be moved, and
+all pointers into the buffer updated appropriately.  I<ptr> must not
+be later in the buffer than the position of L</PL_parser-E<gt>bufptr>:
+it is not permitted to discard text that has yet to be lexed.
+
+Normally it is not necessarily to do this directly, because it suffices to
+use the implicit discarding behaviour of L</lex_next_chunk> and things
+based on it.  However, if a token stretches across multiple lines,
+and the lexing code has kept multiple lines of text in the buffer fof
+that purpose, then after completion of the token it would be wise to
+explicitly discard the now-unneeded earlier lines, to avoid future
+multi-line tokens growing the buffer without bound.
+
+=cut
+*/
+
+void
+Perl_lex_discard_to(pTHX_ char *ptr)
+{
+    char *buf;
+    STRLEN discard_len;
+    PERL_ARGS_ASSERT_LEX_DISCARD_TO;
+    buf = SvPVX(PL_parser->linestr);
+    if (ptr < buf)
+	Perl_croak(aTHX_ "Lexing code internal error (%s)", "lex_discard_to");
+    if (ptr == buf)
+	return;
+    if (ptr > PL_parser->bufptr)
+	Perl_croak(aTHX_ "Lexing code internal error (%s)", "lex_discard_to");
+    discard_len = ptr - buf;
+    if (PL_parser->oldbufptr < ptr)
+	PL_parser->oldbufptr = ptr;
+    if (PL_parser->oldoldbufptr < ptr)
+	PL_parser->oldoldbufptr = ptr;
+    if (PL_parser->last_uni && PL_parser->last_uni < ptr)
+	PL_parser->last_uni = NULL;
+    if (PL_parser->last_lop && PL_parser->last_lop < ptr)
+	PL_parser->last_lop = NULL;
+    Move(ptr, buf, PL_parser->bufend+1-ptr, char);
+    SvCUR_set(PL_parser->linestr, SvCUR(PL_parser->linestr) - discard_len);
+    PL_parser->bufend -= discard_len;
+    PL_parser->bufptr -= discard_len;
+    PL_parser->oldbufptr -= discard_len;
+    PL_parser->oldoldbufptr -= discard_len;
+    if (PL_parser->last_uni)
+	PL_parser->last_uni -= discard_len;
+    if (PL_parser->last_lop)
+	PL_parser->last_lop -= discard_len;
+}
+
+/*
+=for apidoc Amx|bool|lex_next_chunk|U32 flags
+
+Reads in the next chunk of text to be lexed, appending it to
+L</PL_parser-E<gt>linestr>.  This should be called when lexing code has
+looked to the end of the current chunk and wants to know more.  It is
+usual, but not necessary, for lexing to have consumed the entirety of
+the current chunk at this time.
+
+If L</PL_parser-E<gt>bufptr> is pointing to the very end of the current
+chunk (i.e., the current chunk has been entirely consumed), normally the
+current chunk will be discarded at the same time that the new chunk is
+read in.  If I<flags> includes C<LEX_KEEP_PREVIOUS>, the current chunk
+will not be discarded.  If the current chunk has not been entirely
+consumed, then it will not be discarded regardless of the flag.
+
+Returns true if some new text was added to the buffer, or false if the
+buffer has reached the end of the input text.
+
+=cut
+*/
+
+#define LEX_FAKE_EOF 0x80000000
+
+bool
+Perl_lex_next_chunk(pTHX_ U32 flags)
+{
+    SV *linestr;
+    char *buf;
+    STRLEN old_bufend_pos, new_bufend_pos;
+    STRLEN bufptr_pos, oldbufptr_pos, oldoldbufptr_pos;
+    STRLEN linestart_pos, last_uni_pos, last_lop_pos;
+    bool got_some_for_debugger = 0;
+    bool got_some;
+    if (flags & ~(LEX_KEEP_PREVIOUS|LEX_FAKE_EOF))
+	Perl_croak(aTHX_ "Lexing code internal error (%s)", "lex_next_chunk");
+    linestr = PL_parser->linestr;
+    buf = SvPVX(linestr);
+    if (!(flags & LEX_KEEP_PREVIOUS) &&
+	    PL_parser->bufptr == PL_parser->bufend) {
+	old_bufend_pos = bufptr_pos = oldbufptr_pos = oldoldbufptr_pos = 0;
+	linestart_pos = 0;
+	if (PL_parser->last_uni != PL_parser->bufend)
+	    PL_parser->last_uni = NULL;
+	if (PL_parser->last_lop != PL_parser->bufend)
+	    PL_parser->last_lop = NULL;
+	last_uni_pos = last_lop_pos = 0;
+	*buf = 0;
+	SvCUR(linestr) = 0;
+    } else {
+	old_bufend_pos = PL_parser->bufend - buf;
+	bufptr_pos = PL_parser->bufptr - buf;
+	oldbufptr_pos = PL_parser->oldbufptr - buf;
+	oldoldbufptr_pos = PL_parser->oldoldbufptr - buf;
+	linestart_pos = PL_parser->linestart - buf;
+	last_uni_pos = PL_parser->last_uni ? PL_parser->last_uni - buf : 0;
+	last_lop_pos = PL_parser->last_lop ? PL_parser->last_lop - buf : 0;
+    }
+    if (flags & LEX_FAKE_EOF) {
+	goto eof;
+    } else if (!PL_parser->rsfp) {
+	got_some = 0;
+    } else if (filter_gets(linestr, old_bufend_pos)) {
+	got_some = 1;
+	got_some_for_debugger = 1;
+    } else {
+	if (!SvPOK(linestr))   /* can get undefined by filter_gets */
+	    sv_setpvs(linestr, "");
+	eof:
+	/* End of real input.  Close filehandle (unless it was STDIN),
+	 * then add implicit termination.
+	 */
+	if ((PerlIO*)PL_parser->rsfp == PerlIO_stdin())
+	    PerlIO_clearerr(PL_parser->rsfp);
+	else if (PL_parser->rsfp)
+	    (void)PerlIO_close(PL_parser->rsfp);
+	PL_parser->rsfp = NULL;
+	PL_doextract = FALSE;
+#ifdef PERL_MAD
+	if (PL_madskills && !PL_in_eval && (PL_minus_p || PL_minus_n))
+	    PL_faketokens = 1;
+#endif
+	if (!PL_in_eval && PL_minus_p) {
+	    sv_catpvs(linestr,
+		/*{*/";}continue{print or die qq(-p destination: $!\\n);}");
+	    PL_minus_n = PL_minus_p = 0;
+	} else if (!PL_in_eval && PL_minus_n) {
+	    sv_catpvs(linestr, /*{*/";}");
+	    PL_minus_n = 0;
+	} else
+	    sv_catpvs(linestr, ";");
+	got_some = 1;
+    }
+    buf = SvPVX(linestr);
+    new_bufend_pos = SvCUR(linestr);
+    PL_parser->bufend = buf + new_bufend_pos;
+    PL_parser->bufptr = buf + bufptr_pos;
+    PL_parser->oldbufptr = buf + oldbufptr_pos;
+    PL_parser->oldoldbufptr = buf + oldoldbufptr_pos;
+    PL_parser->linestart = buf + linestart_pos;
+    if (PL_parser->last_uni)
+	PL_parser->last_uni = buf + last_uni_pos;
+    if (PL_parser->last_lop)
+	PL_parser->last_lop = buf + last_lop_pos;
+    if (got_some_for_debugger && (PERLDB_LINE || PERLDB_SAVESRC) &&
+	    PL_curstash != PL_debstash) {
+	/* debugger active and we're not compiling the debugger code,
+	 * so store the line into the debugger's array of lines
+	 */
+	update_debugger_info(NULL, buf+old_bufend_pos,
+	    new_bufend_pos-old_bufend_pos);
+    }
+    return got_some;
+}
+
+/*
+=for apidoc Amx|I32|lex_peek_unichar|U32 flags
+
+Looks ahead one (Unicode) character in the text currently being lexed.
+Returns the codepoint (unsigned integer value) of the next character,
+or -1 if lexing has reached the end of the input text.  To consume the
+peeked character, use L</lex_read_unichar>.
+
+If the next character is in (or extends into) the next chunk of input
+text, the next chunk will be read in.  Normally the current chunk will be
+discarded at the same time, but if I<flags> includes C<LEX_KEEP_PREVIOUS>
+then the current chunk will not be discarded.
+
+If the input is being interpreted as UTF-8 and a UTF-8 encoding error
+is encountered, an exception is generated.
+
+=cut
+*/
+
+I32
+Perl_lex_peek_unichar(pTHX_ U32 flags)
+{
+    dVAR;
+    char *s, *bufend;
+    if (flags & ~(LEX_KEEP_PREVIOUS))
+	Perl_croak(aTHX_ "Lexing code internal error (%s)", "lex_peek_unichar");
+    s = PL_parser->bufptr;
+    bufend = PL_parser->bufend;
+    if (UTF) {
+	U8 head;
+	I32 unichar;
+	STRLEN len, retlen;
+	if (s == bufend) {
+	    if (!lex_next_chunk(flags))
+		return -1;
+	    s = PL_parser->bufptr;
+	    bufend = PL_parser->bufend;
+	}
+	head = (U8)*s;
+	if (!(head & 0x80))
+	    return head;
+	if (head & 0x40) {
+	    len = PL_utf8skip[head];
+	    while ((STRLEN)(bufend-s) < len) {
+		if (!lex_next_chunk(flags | LEX_KEEP_PREVIOUS))
+		    break;
+		s = PL_parser->bufptr;
+		bufend = PL_parser->bufend;
+	    }
+	}
+	unichar = utf8n_to_uvuni((U8*)s, bufend-s, &retlen, UTF8_CHECK_ONLY);
+	if (retlen == (STRLEN)-1) {
+	    /* malformed UTF-8 */
+	    ENTER;
+	    SAVESPTR(PL_warnhook);
+	    PL_warnhook = PERL_WARNHOOK_FATAL;
+	    utf8n_to_uvuni((U8*)s, bufend-s, NULL, 0);
+	    LEAVE;
+	}
+	return unichar;
+    } else {
+	if (s == bufend) {
+	    if (!lex_next_chunk(flags))
+		return -1;
+	    s = PL_parser->bufptr;
+	}
+	return (U8)*s;
+    }
+}
+
+/*
+=for apidoc Amx|I32|lex_read_unichar|U32 flags
+
+Reads the next (Unicode) character in the text currently being lexed.
+Returns the codepoint (unsigned integer value) of the character read,
+and moves L</PL_parser-E<gt>bufptr> past the character, or returns -1
+if lexing has reached the end of the input text.  To non-destructively
+examine the next character, use L</lex_peek_unichar> instead.
+
+If the next character is in (or extends into) the next chunk of input
+text, the next chunk will be read in.  Normally the current chunk will be
+discarded at the same time, but if I<flags> includes C<LEX_KEEP_PREVIOUS>
+then the current chunk will not be discarded.
+
+If the input is being interpreted as UTF-8 and a UTF-8 encoding error
+is encountered, an exception is generated.
+
+=cut
+*/
+
+I32
+Perl_lex_read_unichar(pTHX_ U32 flags)
+{
+    I32 c;
+    if (flags & ~(LEX_KEEP_PREVIOUS))
+	Perl_croak(aTHX_ "Lexing code internal error (%s)", "lex_read_unichar");
+    c = lex_peek_unichar(flags);
+    if (c != -1) {
+	if (c == '\n')
+	    CopLINE_inc(PL_curcop);
+	PL_parser->bufptr += UTF8SKIP(PL_parser->bufptr);
+    }
+    return c;
+}
+
+/*
+=for apidoc Amx|void|lex_read_space|U32 flags
+
+Reads optional spaces, in Perl style, in the text currently being
+lexed.  The spaces may include ordinary whitespace characters and
+Perl-style comments.  C<#line> directives are processed if encountered.
+L</PL_parser-E<gt>bufptr> is moved past the spaces, so that it points
+at a non-space character (or the end of the input text).
+
+If spaces extend into the next chunk of input text, the next chunk will
+be read in.  Normally the current chunk will be discarded at the same
+time, but if I<flags> includes C<LEX_KEEP_PREVIOUS> then the current
+chunk will not be discarded.
+
+=cut
+*/
+
+#define LEX_NO_NEXT_CHUNK 0x80000000
+
+void
+Perl_lex_read_space(pTHX_ U32 flags)
+{
+    char *s, *bufend;
+    bool need_incline = 0;
+    if (flags & ~(LEX_KEEP_PREVIOUS|LEX_NO_NEXT_CHUNK))
+	Perl_croak(aTHX_ "Lexing code internal error (%s)", "lex_read_space");
+#ifdef PERL_MAD
+    if (PL_skipwhite) {
+	sv_free(PL_skipwhite);
+	PL_skipwhite = NULL;
+    }
+    if (PL_madskills)
+	PL_skipwhite = newSVpvs("");
+#endif /* PERL_MAD */
+    s = PL_parser->bufptr;
+    bufend = PL_parser->bufend;
+    while (1) {
+	char c = *s;
+	if (c == '#') {
+	    do {
+		c = *++s;
+	    } while (!(c == '\n' || (c == 0 && s == bufend)));
+	} else if (c == '\n') {
+	    s++;
+	    PL_parser->linestart = s;
+	    if (s == bufend)
+		need_incline = 1;
+	    else
+		incline(s);
+	} else if (isSPACE(c)) {
+	    s++;
+	} else if (c == 0 && s == bufend) {
+	    bool got_more;
+#ifdef PERL_MAD
+	    if (PL_madskills)
+		sv_catpvn(PL_skipwhite, PL_parser->bufptr, s-PL_parser->bufptr);
+#endif /* PERL_MAD */
+	    if (flags & LEX_NO_NEXT_CHUNK)
+		break;
+	    PL_parser->bufptr = s;
+	    CopLINE_inc(PL_curcop);
+	    got_more = lex_next_chunk(flags);
+	    CopLINE_dec(PL_curcop);
+	    s = PL_parser->bufptr;
+	    bufend = PL_parser->bufend;
+	    if (!got_more)
+		break;
+	    if (need_incline && PL_parser->rsfp) {
+		incline(s);
+		need_incline = 0;
+	    }
+	} else {
+	    break;
+	}
+    }
+#ifdef PERL_MAD
+    if (PL_madskills)
+	sv_catpvn(PL_skipwhite, PL_parser->bufptr, s-PL_parser->bufptr);
+#endif /* PERL_MAD */
+    PL_parser->bufptr = s;
+}
+
+/*
  * S_incline
  * This subroutine has nothing to do with tilting, whether at windmills
  * or pinball tables.  Its name is short for "increment line".  It
@@ -823,6 +1514,8 @@
     n = s;
     while (isDIGIT(*s))
 	s++;
+    if (!SPACE_OR_TAB(*s) && *s != '\r' && *s != '\n' && *s != '\0')
+	return;
     while (SPACE_OR_TAB(*s))
 	s++;
     if (*s == '"' && (t = strchr(s+1, '"'))) {
@@ -995,7 +1688,7 @@
 #endif
 
 STATIC void
-S_update_debugger_info(pTHX_ SV *orig_sv, const char *buf, STRLEN len)
+S_update_debugger_info(pTHX_ SV *orig_sv, const char *const buf, STRLEN len)
 {
     AV *av = CopFILEAVx(PL_curcop);
     if (av) {
@@ -1019,179 +1712,36 @@
 STATIC char *
 S_skipspace(pTHX_ register char *s)
 {
-    dVAR;
 #ifdef PERL_MAD
-    int curoff;
-    int startoff = s - SvPVX(PL_linestr);
-
+    char *start = s;
+#endif /* PERL_MAD */
     PERL_ARGS_ASSERT_SKIPSPACE;
-
+#ifdef PERL_MAD
     if (PL_skipwhite) {
 	sv_free(PL_skipwhite);
-	PL_skipwhite = 0;
+	PL_skipwhite = NULL;
     }
-#endif
-    PERL_ARGS_ASSERT_SKIPSPACE;
-
+#endif /* PERL_MAD */
     if (PL_lex_formbrack && PL_lex_brackets <= PL_lex_formbrack) {
 	while (s < PL_bufend && SPACE_OR_TAB(*s))
 	    s++;
-#ifdef PERL_MAD
-	goto done;
-#else
-	return s;
-#endif
-    }
-    for (;;) {
-	STRLEN prevlen;
-	SSize_t oldprevlen, oldoldprevlen;
-	SSize_t oldloplen = 0, oldunilen = 0;
-	while (s < PL_bufend && isSPACE(*s)) {
-	    if (*s++ == '\n' && PL_in_eval && !PL_rsfp)
-		incline(s);
-	}
-
-	/* comment */
-	if (s < PL_bufend && *s == '#') {
-	    while (s < PL_bufend && *s != '\n')
-		s++;
-	    if (s < PL_bufend) {
-		s++;
-		if (PL_in_eval && !PL_rsfp) {
-		    incline(s);
-		    continue;
-		}
-	    }
-	}
-
-	/* only continue to recharge the buffer if we're at the end
-	 * of the buffer, we're not reading from a source filter, and
-	 * we're in normal lexing mode
-	 */
-	if (s < PL_bufend || !PL_rsfp || PL_sublex_info.sub_inwhat ||
-		PL_lex_state == LEX_FORMLINE)
-#ifdef PERL_MAD
-	    goto done;
-#else
-	    return s;
-#endif
-
-	/* try to recharge the buffer */
-#ifdef PERL_MAD
-	curoff = s - SvPVX(PL_linestr);
-#endif
-
-	if ((s = filter_gets(PL_linestr, PL_rsfp,
-			     (prevlen = SvCUR(PL_linestr)))) == NULL)
-	{
-#ifdef PERL_MAD
-	    if (PL_madskills && curoff != startoff) {
-		if (!PL_skipwhite)
-		    PL_skipwhite = newSVpvs("");
-		sv_catpvn(PL_skipwhite, SvPVX(PL_linestr) + startoff,
-					curoff - startoff);
-	    }
-
-	    /* mustn't throw out old stuff yet if madpropping */
-	    SvCUR(PL_linestr) = curoff;
-	    s = SvPVX(PL_linestr) + curoff;
-	    *s = 0;
-	    if (curoff && s[-1] == '\n')
-		s[-1] = ' ';
-#endif
-
-	    /* end of file.  Add on the -p or -n magic */
-	    /* XXX these shouldn't really be added here, can't set PL_faketokens */
-	    if (PL_minus_p) {
-#ifdef PERL_MAD
-		sv_catpvs(PL_linestr,
-			 ";}continue{print or die qq(-p destination: $!\\n);}");
-#else
-		sv_setpvs(PL_linestr,
-			 ";}continue{print or die qq(-p destination: $!\\n);}");
-#endif
-		PL_minus_n = PL_minus_p = 0;
-	    }
-	    else if (PL_minus_n) {
-#ifdef PERL_MAD
-		sv_catpvs(PL_linestr, ";}");
-#else
-		sv_setpvs(PL_linestr, ";}");
-#endif
-		PL_minus_n = 0;
-	    }
-	    else
-#ifdef PERL_MAD
-		sv_catpvs(PL_linestr,";");
-#else
-		sv_setpvs(PL_linestr,";");
-#endif
-
-	    /* reset variables for next time we lex */
-	    PL_oldoldbufptr = PL_oldbufptr = PL_bufptr = s = PL_linestart
-		= SvPVX(PL_linestr)
-#ifdef PERL_MAD
-		+ curoff
-#endif
-		;
-	    PL_bufend = SvPVX(PL_linestr) + SvCUR(PL_linestr);
-	    PL_last_lop = PL_last_uni = NULL;
-
-	    /* Close the filehandle.  Could be from -P preprocessor,
-	     * STDIN, or a regular file.  If we were reading code from
-	     * STDIN (because the commandline held no -e or filename)
-	     * then we don't close it, we reset it so the code can
-	     * read from STDIN too.
-	     */
-
-	    if (PL_preprocess && !PL_in_eval)
-		(void)PerlProc_pclose(PL_rsfp);
-	    else if ((PerlIO*)PL_rsfp == PerlIO_stdin())
-		PerlIO_clearerr(PL_rsfp);
-	    else
-		(void)PerlIO_close(PL_rsfp);
-	    PL_rsfp = NULL;
-	    return s;
-	}
-
-	/* not at end of file, so we only read another line */
-	/* make corresponding updates to old pointers, for yyerror() */
-	oldprevlen = PL_oldbufptr - PL_bufend;
-	oldoldprevlen = PL_oldoldbufptr - PL_bufend;
-	if (PL_last_uni)
-	    oldunilen = PL_last_uni - PL_bufend;
-	if (PL_last_lop)
-	    oldloplen = PL_last_lop - PL_bufend;
-	PL_linestart = PL_bufptr = s + prevlen;
-	PL_bufend = s + SvCUR(PL_linestr);
+    } else {
+	STRLEN bufptr_pos = PL_bufptr - SvPVX(PL_linestr);
+	PL_bufptr = s;
+	lex_read_space(LEX_KEEP_PREVIOUS |
+		(PL_sublex_info.sub_inwhat || PL_lex_state == LEX_FORMLINE ?
+		    LEX_NO_NEXT_CHUNK : 0));
 	s = PL_bufptr;
-	PL_oldbufptr = s + oldprevlen;
-	PL_oldoldbufptr = s + oldoldprevlen;
-	if (PL_last_uni)
-	    PL_last_uni = s + oldunilen;
-	if (PL_last_lop)
-	    PL_last_lop = s + oldloplen;
-	incline(s);
-
-	/* debugger active and we're not compiling the debugger code,
-	 * so store the line into the debugger's array of lines
-	 */
-	if ((PERLDB_LINE || PERLDB_SAVESRC) && PL_curstash != PL_debstash)
-	    update_debugger_info(NULL, PL_bufptr, PL_bufend - PL_bufptr);
+	PL_bufptr = SvPVX(PL_linestr) + bufptr_pos;
+	if (PL_linestart > PL_bufptr)
+	    PL_bufptr = PL_linestart;
+	return s;
     }
-
 #ifdef PERL_MAD
-  done:
-    if (PL_madskills) {
-	if (!PL_skipwhite)
-	    PL_skipwhite = newSVpvs("");
-	curoff = s - SvPVX(PL_linestr);
-	if (curoff - startoff)
-	    sv_catpvn(PL_skipwhite, SvPVX(PL_linestr) + startoff,
-				curoff - startoff);
-    }
+    if (PL_madskills)
+	PL_skipwhite = newSVpvn(start, s-start);
+#endif /* PERL_MAD */
     return s;
-#endif
 }
 
 /*
@@ -1220,11 +1770,9 @@
     if ((t = strchr(s, '(')) && t < PL_bufptr)
 	return;
 
-    if (ckWARN_d(WARN_AMBIGUOUS)){
-        Perl_warner(aTHX_ packWARN(WARN_AMBIGUOUS),
-		   "Warning: Use of \"%.*s\" without parentheses is ambiguous",
-		   (int)(s - PL_last_uni), PL_last_uni);
-    }
+    Perl_ck_warner_d(aTHX_ packWARN(WARN_AMBIGUOUS),
+		     "Warning: Use of \"%.*s\" without parentheses is ambiguous",
+		     (int)(s - PL_last_uni), PL_last_uni);
 }
 
 /*
@@ -1381,11 +1929,13 @@
 }
 
 STATIC SV *
-S_newSV_maybe_utf8(pTHX_ const char *start, STRLEN len)
+S_newSV_maybe_utf8(pTHX_ const char *const start, STRLEN len)
 {
     dVAR;
     SV * const sv = newSVpvn_utf8(start, len,
-				  UTF && !IN_BYTES
+				  !IN_BYTES
+				  && UTF
+				  && !is_ascii_string((const U8*)start, len)
 				  && is_utf8_string((const U8*)start, len));
     return sv;
 }
@@ -1550,7 +2100,13 @@
 #endif
         if (*d == ';' || isSPACE(*d) || *d == '}' || !*d) {
 	    SV *ver;
+#ifdef USE_LOCALE_NUMERIC
+	    char *loc = setlocale(LC_NUMERIC, "C");
+#endif
             s = scan_num(s, &pl_yylval);
+#ifdef USE_LOCALE_NUMERIC
+	    setlocale(LC_NUMERIC, loc);
+#endif
             version = pl_yylval.opval;
 	    ver = cSVOPx(version)->op_sv;
 	    if (SvPOK(ver) && !SvNIOK(ver)) {
@@ -1561,14 +2117,61 @@
         }
 	else if (guessing) {
 #ifdef PERL_MAD
-	    if (PL_madskills) {
-		sv_free(PL_nextwhite);	/* let next token collect whitespace */
-		PL_nextwhite = 0;
-		s = SvPVX(PL_linestr) + startoff;
-	    }
+	    if (PL_madskills) {
+		sv_free(PL_nextwhite);	/* let next token collect whitespace */
+		PL_nextwhite = 0;
+		s = SvPVX(PL_linestr) + startoff;
+	    }
+#endif
+	    return s;
+	}
+    }
+
+#ifdef PERL_MAD
+    if (PL_madskills && !version) {
+	sv_free(PL_nextwhite);	/* let next token collect whitespace */
+	PL_nextwhite = 0;
+	s = SvPVX(PL_linestr) + startoff;
+    }
+#endif
+    /* NOTE: The parser sees the package name and the VERSION swapped */
+    start_force(PL_curforce);
+    NEXTVAL_NEXTTOKE.opval = version;
+    force_next(WORD);
+
+    return s;
+}
+
+/*
+ * S_force_strict_version
+ * Forces the next token to be a version number using strict syntax rules.
+ */
+
+STATIC char *
+S_force_strict_version(pTHX_ char *s)
+{
+    dVAR;
+    OP *version = NULL;
+#ifdef PERL_MAD
+    I32 startoff = s - SvPVX(PL_linestr);
 #endif
-	    return s;
-	}
+    const char *errstr = NULL;
+
+    PERL_ARGS_ASSERT_FORCE_STRICT_VERSION;
+
+    while (isSPACE(*s)) /* leading whitespace */
+	s++;
+
+    if (is_STRICT_VERSION(s,&errstr)) {
+	SV *ver = newSV(0);
+	s = (char *)scan_version(s, ver, 0);
+	version = newSVOP(OP_CONST, 0, ver);
+    }
+    else if ( (*s != ';' && *s != '}' ) && (s = SKIPSPACE1(s), (*s != ';' && *s !='}' ))) {
+	PL_bufptr = s;
+	if (errstr)
+	    yyerror(errstr); /* version required */
+	return s;
     }
 
 #ifdef PERL_MAD
@@ -1875,10 +2478,7 @@
 
   In patterns:
     backslashes:
-      double-quoted style: \r and \n
-      regexp special ones: \D \s
-      constants: \x31
-      backrefs: \1
+      constants: \N{NAME} only
       case and quoting: \U \Q \E
     stops on @ and $, but not for $ as tail anchor
 
@@ -1892,7 +2492,7 @@
   In double-quoted strings:
     backslashes:
       double-quoted style: \r and \n
-      constants: \x31
+      constants: \x31, etc.
       deprecated backrefs: \1 (in substitution replacements)
       case and quoting: \U \Q \E
     stops on @ and $
@@ -1920,14 +2520,14 @@
 	  check for embedded arrays
 	  check for embedded scalars
 	  if (backslash) {
-	      leave intact backslashes from leaveit (below)
 	      deprecate \1 in substitution replacements
 	      handle string-changing backslashes \l \U \Q \E, etc.
 	      switch (what was escaped) {
 		  handle \- in a transliteration (becomes a literal -)
+		  if a pattern and not \N{, go treat as regular character
 		  handle \132 (octal characters)
 		  handle \x15 and \x{1234} (hex characters)
-		  handle \N{name} (named characters)
+		  handle \N{name} (named characters, also \N{3,5} in a pattern)
 		  handle \cV (control characters)
 		  handle printf-style backslashes (\f, \r, \n, etc)
 	      } (end switch)
@@ -1985,6 +2585,7 @@
 
 
     while (s < send || dorange) {
+
         /* get transliterations out of the way (they're most literal) */
 	if (PL_lex_inwhat == OP_TRANS) {
 	    /* expand a range A-Z to the full set of characters.  AIE! */
@@ -2191,22 +2792,28 @@
 	else if (*s == '$') {
 	    if (!PL_lex_inpat)	/* not a regexp, so $ must be var */
 		break;
-	    if (s + 1 < send && !strchr("()| \r\n\t", s[1]))
+	    if (s + 1 < send && !strchr("()| \r\n\t", s[1])) {
+		if (s[1] == '\\') {
+		    Perl_ck_warner(aTHX_ packWARN(WARN_AMBIGUOUS),
+				   "Possible unintended interpolation of $\\ in regex");
+		}
 		break;		/* in regexp, $ might be tail anchor */
+            }
 	}
 
 	/* End of else if chain - OP_TRANS rejoin rest */
 
 	/* backslashes */
 	if (*s == '\\' && s+1 < send) {
+	    char* e;	/* Can be used for ending '}', etc. */
+
 	    s++;
 
 	    /* deprecate \1 in strings and substitution replacements */
 	    if (PL_lex_inwhat == OP_SUBST && !PL_lex_inpat &&
 		isDIGIT(*s) && *s != '0' && !isDIGIT(s[1]))
 	    {
-		if (ckWARN(WARN_SYNTAX))
-		    Perl_warner(aTHX_ packWARN(WARN_SYNTAX), "\\%c better written as $%c", *s, *s);
+		Perl_ck_warner(aTHX_ packWARN(WARN_SYNTAX), "\\%c better written as $%c", *s, *s);
 		*--s = '$';
 		break;
 	    }
@@ -2216,13 +2823,28 @@
 		--s;
 		break;
 	    }
-	    /* skip any other backslash escapes in a pattern */
-	    else if (PL_lex_inpat) {
+	    /* In a pattern, process \N, but skip any other backslash escapes.
+	     * This is because we don't want to translate an escape sequence
+	     * into a meta symbol and have the regex compiler use the meta
+	     * symbol meaning, e.g. \x{2E} would be confused with a dot.  But
+	     * in spite of this, we do have to process \N here while the proper
+	     * charnames handler is in scope.  See bugs #56444 and #62056.
+	     * There is a complication because \N in a pattern may also stand
+	     * for 'match a non-nl', and not mean a charname, in which case its
+	     * processing should be deferred to the regex compiler.  To be a
+	     * charname it must be followed immediately by a '{', and not look
+	     * like \N followed by a curly quantifier, i.e., not something like
+	     * \N{3,}.  regcurly returns a boolean indicating if it is a legal
+	     * quantifier */
+	    else if (PL_lex_inpat
+		    && (*s != 'N'
+			|| s[1] != '{'
+			|| regcurly(s + 1)))
+	    {
 		*d++ = NATIVE_TO_NEED(has_utf8,'\\');
 		goto default_action;
 	    }
 
-	    /* if we get here, it's either a quoted -, or a digit */
 	    switch (*s) {
 
 	    /* quoted - in transliterations */
@@ -2234,11 +2856,10 @@
 		/* FALL THROUGH */
 	    default:
 	        {
-		    if ((isALPHA(*s) || isDIGIT(*s)) &&
-			ckWARN(WARN_MISC))
-			Perl_warner(aTHX_ packWARN(WARN_MISC),
-				    "Unrecognized escape \\%c passed through",
-				    *s);
+		    if ((isALPHA(*s) || isDIGIT(*s)))
+			Perl_ck_warner(aTHX_ packWARN(WARN_MISC),
+				       "Unrecognized escape \\%c passed through",
+				       *s);
 		    /* default action is to copy the quoted character */
 		    goto default_action;
 		}
@@ -2282,15 +2903,13 @@
 		}
 
 	      NUM_ESCAPE_INSERT:
-		/* Insert oct, hex, or \N{U+...} escaped character.  There will
-		 * always be enough room in sv since such escapes will be
-		 * longer than any UTF-8 sequence they can end up as, except if
-		 * they force us to recode the rest of the string into utf8 */
+		/* Insert oct or hex escaped character.  There will always be
+		 * enough room in sv since such escapes will be longer than any
+		 * UTF-8 sequence they can end up as, except if they force us
+		 * to recode the rest of the string into utf8 */
 		
 		/* Here uv is the ordinal of the next character being added in
-		 * unicode (converted from native).  (It has to be done before
-		 * here because \N is interpreted as unicode, and oct and hex
-		 * as native.) */
+		 * unicode (converted from native). */
 		if (!UNI_IS_INVARIANT(uv)) {
 		    if (!has_utf8 && uv > 255) {
 			/* Might need to recode whatever we have accumulated so
@@ -2300,9 +2919,10 @@
 			SvCUR_set(sv, d - SvPVX_const(sv));
 			SvPOK_on(sv);
 			*d = '\0';
-			sv_utf8_upgrade(sv);
 			/* See Note on sizing above.  */
-			SvGROW(sv, SvCUR(sv) + UNISKIP(uv) + (STRLEN)(send - s) + 1);
+			sv_utf8_upgrade_flags_grow(sv,
+					SV_GMAGIC|SV_FORCE_UTF8_UPGRADE,
+					UNISKIP(uv) + (STRLEN)(send - s) + 1);
 			d = SvPVX(sv) + SvCUR(sv);
 			has_utf8 = TRUE;
                     }
@@ -2329,91 +2949,339 @@
 		}
 		continue;
 
-	    /* \N{LATIN SMALL LETTER A} is a named character, and so is
-	     * \N{U+0041} */
  	    case 'N':
- 		++s;
- 		if (*s == '{') {
- 		    char* e = strchr(s, '}');
- 		    SV *res;
- 		    STRLEN len;
- 		    const char *str;
+		/* In a non-pattern \N must be a named character, like \N{LATIN
+		 * SMALL LETTER A} or \N{U+0041}.  For patterns, it also can
+		 * mean to match a non-newline.  For non-patterns, named
+		 * characters are converted to their string equivalents. In
+		 * patterns, named characters are not converted to their
+		 * ultimate forms for the same reasons that other escapes
+		 * aren't.  Instead, they are converted to the \N{U+...} form
+		 * to get the value from the charnames that is in effect right
+		 * now, while preserving the fact that it was a named character
+		 * so that the regex compiler knows this */
+
+		/* This section of code doesn't generally use the
+		 * NATIVE_TO_NEED() macro to transform the input.  I (khw) did
+		 * a close examination of this macro and determined it is a
+		 * no-op except on utfebcdic variant characters.  Every
+		 * character generated by this that would normally need to be
+		 * enclosed by this macro is invariant, so the macro is not
+		 * needed, and would complicate use of copy(). There are other
+		 * parts of this file where the macro is used inconsistently,
+		 * but are saved by it being a no-op */
+
+		/* The structure of this section of code (besides checking for
+		 * errors and upgrading to utf8) is:
+		 *  Further disambiguate between the two meanings of \N, and if
+		 *	not a charname, go process it elsewhere
+		 *  If of form \N{U+...}, pass it through if a pattern;
+		 *	otherwise convert to utf8
+		 *  Otherwise must be \N{NAME}: convert to \N{U+c1.c2...} if a
+		 *  pattern; otherwise convert to utf8 */
+
+		/* Here, s points to the 'N'; the test below is guaranteed to
+		 * succeed if we are being called on a pattern as we already
+		 * know from a test above that the next character is a '{'.
+		 * On a non-pattern \N must mean 'named sequence, which
+		 * requires braces */
+		s++;
+		if (*s != '{') {
+		    yyerror("Missing braces on \\N{}"); 
+		    continue;
+		}
+		s++;
 
- 		    if (!e) {
+		/* If there is no matching '}', it is an error. */
+		if (! (e = strchr(s, '}'))) {
+		    if (! PL_lex_inpat) {
 			yyerror("Missing right brace on \\N{}");
-			e = s - 1;
-			goto cont_scan;
-		    }
-		    if (e > s + 2 && s[1] == 'U' && s[2] == '+') {
-			/* \N{U+...} The ... is a unicode value even on EBCDIC
-			 * machines */
-		        I32 flags = PERL_SCAN_ALLOW_UNDERSCORES |
-			  PERL_SCAN_DISALLOW_PREFIX;
-		        s += 3;
-			len = e - s;
-			uv = grok_hex(s, &len, &flags, NULL);
-			if ( e > s && len != (STRLEN)(e - s) ) {
-			    uv = 0xFFFD;
-			}
-			s = e + 1;
-			goto NUM_ESCAPE_INSERT;
+		    } else {
+			yyerror("Missing right brace on \\N{} or unescaped left brace after \\N.");
 		    }
-		    res = newSVpvn(s + 1, e - s - 1);
-		    res = new_constant( NULL, 0, "charnames",
-					res, NULL, s - 2, e - s + 3 );
-		    if (has_utf8)
-			sv_utf8_upgrade(res);
-		    str = SvPV_const(res,len);
-#ifdef EBCDIC_NEVER_MIND
-		    /* charnames uses pack U and that has been
-		     * recently changed to do the below uni->native
-		     * mapping, so this would be redundant (and wrong,
-		     * the code point would be doubly converted).
-		     * But leave this in just in case the pack U change
-		     * gets revoked, but the semantics is still
-		     * desireable for charnames. --jhi */
-		    {
-			 UV uv = utf8_to_uvchr((const U8*)str, 0);
+		    continue;
+		}
 
-			 if (uv < 0x100) {
-			      U8 tmpbuf[UTF8_MAXBYTES+1], *d;
+		/* Here it looks like a named character */
 
-			      d = uvchr_to_utf8(tmpbuf, UNI_TO_NATIVE(uv));
-			      sv_setpvn(res, (char *)tmpbuf, d - tmpbuf);
-			      str = SvPV_const(res, len);
-			 }
-		    }
-#endif
-		    /* If destination is not in utf8 but this new character is,
-		     * recode the dest to utf8 */
-		    if (!has_utf8 && SvUTF8(res)) {
+		if (PL_lex_inpat) {
+
+		    /* XXX This block is temporary code.  \N{} implies that the
+		     * pattern is to have Unicode semantics, and therefore
+		     * currently has to be encoded in utf8.  By putting it in
+		     * utf8 now, we save a whole pass in the regular expression
+		     * compiler.  Once that code is changed so Unicode
+		     * semantics doesn't necessarily have to be in utf8, this
+		     * block should be removed */
+		    if (!has_utf8) {
 			SvCUR_set(sv, d - SvPVX_const(sv));
 			SvPOK_on(sv);
 			*d = '\0';
-			sv_utf8_upgrade(sv);
 			/* See Note on sizing above.  */
-			SvGROW(sv, SvCUR(sv) + len + (STRLEN)(send - s) + 1);
+			sv_utf8_upgrade_flags_grow(sv,
+					SV_GMAGIC|SV_FORCE_UTF8_UPGRADE,
+					/* 5 = '\N{' + cur char + NUL */
+					(STRLEN)(send - s) + 5);
 			d = SvPVX(sv) + SvCUR(sv);
 			has_utf8 = TRUE;
-		    } else if (len > (STRLEN)(e - s + 4)) { /* I _guess_ 4 is \N{} --jhi */
+		    }
+		}
+
+		if (*s == 'U' && s[1] == '+') { /* \N{U+...} */
+		    I32 flags = PERL_SCAN_ALLOW_UNDERSCORES
+				| PERL_SCAN_DISALLOW_PREFIX;
+		    STRLEN len;
+
+		    /* For \N{U+...}, the '...' is a unicode value even on
+		     * EBCDIC machines */
+		    s += 2;	    /* Skip to next char after the 'U+' */
+		    len = e - s;
+		    uv = grok_hex(s, &len, &flags, NULL);
+		    if (len == 0 || len != (STRLEN)(e - s)) {
+			yyerror("Invalid hexadecimal number in \\N{U+...}");
+			s = e + 1;
+			continue;
+		    }
+
+		    if (PL_lex_inpat) {
+
+			/* Pass through to the regex compiler unchanged.  The
+			 * reason we evaluated the number above is to make sure
+			 * there wasn't a syntax error. */
+			s -= 5;	    /* Include the '\N{U+' */
+			Copy(s, d, e - s + 1, char);	/* 1 = include the } */
+			d += e - s + 1;
+		    }
+		    else {  /* Not a pattern: convert the hex to string */
+
+			 /* If destination is not in utf8, unconditionally
+			  * recode it to be so.  This is because \N{} implies
+			  * Unicode semantics, and scalars have to be in utf8
+			  * to guarantee those semantics */
+			if (! has_utf8) {
+			    SvCUR_set(sv, d - SvPVX_const(sv));
+			    SvPOK_on(sv);
+			    *d = '\0';
+			    /* See Note on sizing above.  */
+			    sv_utf8_upgrade_flags_grow(
+					sv,
+					SV_GMAGIC|SV_FORCE_UTF8_UPGRADE,
+					UNISKIP(uv) + (STRLEN)(send - e) + 1);
+			    d = SvPVX(sv) + SvCUR(sv);
+			    has_utf8 = TRUE;
+			}
+
+			/* Add the string to the output */
+			if (UNI_IS_INVARIANT(uv)) {
+			    *d++ = (char) uv;
+			}
+			else d = (char*)uvuni_to_utf8((U8*)d, uv);
+		    }
+		}
+		else { /* Here is \N{NAME} but not \N{U+...}. */
+
+		    SV *res;		/* result from charnames */
+		    const char *str;    /* the string in 'res' */
+		    STRLEN len;		/* its length */
+
+		    /* Get the value for NAME */
+		    res = newSVpvn(s, e - s);
+		    res = new_constant( NULL, 0, "charnames",
+					/* includes all of: \N{...} */
+					res, NULL, s - 3, e - s + 4 );
+
+		    /* Most likely res will be in utf8 already since the
+		     * standard charnames uses pack U, but a custom translator
+		     * can leave it otherwise, so make sure.  XXX This can be
+		     * revisited to not have charnames use utf8 for characters
+		     * that don't need it when regexes don't have to be in utf8
+		     * for Unicode semantics.  If doing so, remember EBCDIC */
+		    sv_utf8_upgrade(res);
+		    str = SvPV_const(res, len);
+
+		    /* Don't accept malformed input */
+		    if (! is_utf8_string((U8 *) str, len)) {
+			yyerror("Malformed UTF-8 returned by \\N");
+		    }
+		    else if (PL_lex_inpat) {
+
+			if (! len) { /* The name resolved to an empty string */
+			    Copy("\\N{}", d, 4, char);
+			    d += 4;
+			}
+			else {
+			    /* In order to not lose information for the regex
+			    * compiler, pass the result in the specially made
+			    * syntax: \N{U+c1.c2.c3...}, where c1 etc. are
+			    * the code points in hex of each character
+			    * returned by charnames */
+
+			    const char *str_end = str + len;
+			    STRLEN char_length;	    /* cur char's byte length */
+			    STRLEN output_length;   /* and the number of bytes
+						       after this is translated
+						       into hex digits */
+			    const STRLEN off = d - SvPVX_const(sv);
+
+			    /* 2 hex per byte; 2 chars for '\N'; 2 chars for
+			     * max('U+', '.'); and 1 for NUL */
+			    char hex_string[2 * UTF8_MAXBYTES + 5];
+
+			    /* Get the first character of the result. */
+			    U32 uv = utf8n_to_uvuni((U8 *) str,
+						    len,
+						    &char_length,
+						    UTF8_ALLOW_ANYUV);
+
+			    /* The call to is_utf8_string() above hopefully
+			     * guarantees that there won't be an error.  But
+			     * it's easy here to make sure.  The function just
+			     * above warns and returns 0 if invalid utf8, but
+			     * it can also return 0 if the input is validly a
+			     * NUL. Disambiguate */
+			    if (uv == 0 && NATIVE_TO_ASCII(*str) != '\0') {
+				uv = UNICODE_REPLACEMENT;
+			    }
+
+			    /* Convert first code point to hex, including the
+			     * boiler plate before it */
+			    snprintf(hex_string, sizeof(hex_string),
+				     "\\N{U+%X", (unsigned int) uv);
+			    output_length = strlen(hex_string);
+
+			    /* Make sure there is enough space to hold it */
+			    d = off + SvGROW(sv, off
+						 + output_length
+						 + (STRLEN)(send - e)
+						 + 2);	/* '}' + NUL */
+			    /* And output it */
+			    Copy(hex_string, d, output_length, char);
+			    d += output_length;
+
+			    /* For each subsequent character, append dot and
+			     * its ordinal in hex */
+			    while ((str += char_length) < str_end) {
+				const STRLEN off = d - SvPVX_const(sv);
+				U32 uv = utf8n_to_uvuni((U8 *) str,
+							str_end - str,
+							&char_length,
+							UTF8_ALLOW_ANYUV);
+				if (uv == 0 && NATIVE_TO_ASCII(*str) != '\0') {
+				    uv = UNICODE_REPLACEMENT;
+				}
+
+				snprintf(hex_string, sizeof(hex_string),
+					".%X", (unsigned int) uv);
+				output_length = strlen(hex_string);
+
+				d = off + SvGROW(sv, off
+						     + output_length
+						     + (STRLEN)(send - e)
+						     + 2);	/* '}' +  NUL */
+				Copy(hex_string, d, output_length, char);
+				d += output_length;
+			    }
 
-			/* See Note on sizing above.  (NOTE: SvCUR() is not set
-			 * correctly here). */
-			const STRLEN off = d - SvPVX_const(sv);
-			d = SvGROW(sv, off + len + (STRLEN)(send - s) + 1) + off;
+			    *d++ = '}';	/* Done.  Add the trailing brace */
+			}
+		    }
+		    else { /* Here, not in a pattern.  Convert the name to a
+			    * string. */
+
+			 /* If destination is not in utf8, unconditionally
+			  * recode it to be so.  This is because \N{} implies
+			  * Unicode semantics, and scalars have to be in utf8
+			  * to guarantee those semantics */
+			if (! has_utf8) {
+			    SvCUR_set(sv, d - SvPVX_const(sv));
+			    SvPOK_on(sv);
+			    *d = '\0';
+			    /* See Note on sizing above.  */
+			    sv_utf8_upgrade_flags_grow(sv,
+						SV_GMAGIC|SV_FORCE_UTF8_UPGRADE,
+						len + (STRLEN)(send - s) + 1);
+			    d = SvPVX(sv) + SvCUR(sv);
+			    has_utf8 = TRUE;
+			} else if (len > (STRLEN)(e - s + 4)) { /* I _guess_ 4 is \N{} --jhi */
+
+			    /* See Note on sizing above.  (NOTE: SvCUR() is not
+			     * set correctly here). */
+			    const STRLEN off = d - SvPVX_const(sv);
+			    d = off + SvGROW(sv, off + len + (STRLEN)(send - s) + 1);
+			}
+			Copy(str, d, len, char);
+			d += len;
+		    }
+		    SvREFCNT_dec(res);
+
+		    /* Deprecate non-approved name syntax */
+		    if (ckWARN_d(WARN_DEPRECATED)) {
+			bool problematic = FALSE;
+			char* i = s;
+
+			/* For non-ut8 input, look to see that the first
+			 * character is an alpha, then loop through the rest
+			 * checking that each is a continuation */
+			if (! this_utf8) {
+			    if (! isALPHAU(*i)) problematic = TRUE;
+			    else for (i = s + 1; i < e; i++) {
+				if (isCHARNAME_CONT(*i)) continue;
+				problematic = TRUE;
+				break;
+			    }
+			}
+			else {
+			    /* Similarly for utf8.  For invariants can check
+			     * directly.  We accept anything above the latin1
+			     * range because it is immaterial to Perl if it is
+			     * correct or not, and is expensive to check.  But
+			     * it is fairly easy in the latin1 range to convert
+			     * the variants into a single character and check
+			     * those */
+			    if (UTF8_IS_INVARIANT(*i)) {
+				if (! isALPHAU(*i)) problematic = TRUE;
+			    } else if (UTF8_IS_DOWNGRADEABLE_START(*i)) {
+				if (! isALPHAU(UNI_TO_NATIVE(UTF8_ACCUMULATE(*i,
+									    *(i+1)))))
+				{
+				    problematic = TRUE;
+				}
+			    }
+			    if (! problematic) for (i = s + UTF8SKIP(s);
+						    i < e;
+						    i+= UTF8SKIP(i))
+			    {
+				if (UTF8_IS_INVARIANT(*i)) {
+				    if (isCHARNAME_CONT(*i)) continue;
+				} else if (! UTF8_IS_DOWNGRADEABLE_START(*i)) {
+				    continue;
+				} else if (isCHARNAME_CONT(
+					    UNI_TO_NATIVE(
+					    UTF8_ACCUMULATE(*i, *(i+1)))))
+				{
+				    continue;
+				}
+				problematic = TRUE;
+				break;
+			    }
+			}
+			if (problematic) {
+			    char *string;
+			    Newx(string, e - i + 1, char);
+			    Copy(i, string, e - i, char);
+			    string[e - i] = '\0';
+			    Perl_warner(aTHX_ packWARN(WARN_DEPRECATED),
+				"Deprecated character(s) in \\N{...} starting at '%s'",
+				string);
+			    Safefree(string);
+			}
 		    }
+		} /* End \N{NAME} */
 #ifdef EBCDIC
-		    if (!dorange)
-			native_range = FALSE; /* \N{} is guessed to be Unicode */
+		if (!dorange) 
+		    native_range = FALSE; /* \N{} is defined to be Unicode */
 #endif
-		    Copy(str, d, len, char);
-		    d += len;
-		    SvREFCNT_dec(res);
-		  cont_scan:
-		    s = e + 1;
-		}
-		else
-		    yyerror("Missing braces on \\N{}");
+		s = e + 1;  /* Point to just after the '}' */
 		continue;
 
 	    /* \c is a control character */
@@ -2484,10 +3352,10 @@
 		SvCUR_set(sv, d - SvPVX_const(sv));
 		SvPOK_on(sv);
 		*d = '\0';
-		sv_utf8_upgrade(sv);
-
 		/* See Note on sizing above.  */
-		SvGROW(sv, SvCUR(sv) + need + (STRLEN)(send - s) + 1);
+		sv_utf8_upgrade_flags_grow(sv,
+					SV_GMAGIC|SV_FORCE_UTF8_UPGRADE,
+					need + (STRLEN)(send - s) + 1);
 		d = SvPVX(sv) + SvCUR(sv);
 		has_utf8 = TRUE;
 	    } else if (need > len) {
@@ -2818,7 +3686,7 @@
       bare_package:
 	    start_force(PL_curforce);
 	    NEXTVAL_NEXTTOKE.opval = (OP*)newSVOP(OP_CONST, 0,
-						   newSVpvn(tmpbuf,len));
+						  S_newSV_maybe_utf8(aTHX_ tmpbuf, len));
 	    NEXTVAL_NEXTTOKE.opval->op_private = OPpCONST_BARE;
 	    if (PL_madskills)
 		curmad('X', newSVpvn(start,SvPVX(PL_linestr) + soff - start));
@@ -2941,7 +3809,7 @@
 	    const int old_len = SvCUR(buf_sv);
 
 	    /* ensure buf_sv is large enough */
-	    SvGROW(buf_sv, (STRLEN)(old_len + correct_length)) ;
+	    SvGROW(buf_sv, (STRLEN)(old_len + correct_length + 1)) ;
 	    if ((len = PerlIO_read(PL_rsfp, SvPVX(buf_sv) + old_len,
 				   correct_length)) <= 0) {
 		if (PerlIO_error(PL_rsfp))
@@ -2950,6 +3818,7 @@
 		    return 0 ;		/* end of file */
 	    }
 	    SvCUR_set(buf_sv, old_len + len) ;
+	    SvPVX(buf_sv)[old_len + len] = '\0';
 	} else {
 	    /* Want a line */
             if (sv_gets(buf_sv, PL_rsfp, SvCUR(buf_sv)) == NULL) {
@@ -2980,7 +3849,7 @@
 }
 
 STATIC char *
-S_filter_gets(pTHX_ register SV *sv, register PerlIO *fp, STRLEN append)
+S_filter_gets(pTHX_ register SV *sv, STRLEN append)
 {
     dVAR;
 
@@ -3000,7 +3869,7 @@
 	    return NULL ;
     }
     else
-        return (sv_gets(sv, fp, append));
+        return (sv_gets(sv, PL_rsfp, append));
 }
 
 STATIC HV *
@@ -3254,7 +4123,8 @@
     s = SKIPSPACE1(s);
     if (isDIGIT(*s) || (*s == 'v' && isDIGIT(s[1]))) {
 	s = force_version(s, TRUE);
-	if (*s == ';' || (s = SKIPSPACE1(s), *s == ';')) {
+	if (*s == ';' || *s == '}'
+		|| (s = SKIPSPACE1(s), (*s == ';' || *s == '}'))) {
 	    start_force(PL_curforce);
 	    NEXTVAL_NEXTTOKE.opval = NULL;
 	    force_next(WORD);
@@ -3315,6 +4185,7 @@
     register char *d;
     STRLEN len;
     bool bof = FALSE;
+    U32 fake_eof = 0;
 
     /* orig_keyword, gvp, and gv are initialized here because
      * jump to the label just_a_word_zero can bypass their
@@ -3649,8 +4520,17 @@
     default:
 	if (isIDFIRST_lazy_if(s,UTF))
 	    goto keylookup;
-	len = UTF ? Perl_utf8_length(aTHX_ (U8 *) PL_linestart, (U8 *) s) : (STRLEN) (s - PL_linestart);
-	Perl_croak(aTHX_ "Unrecognized character \\x%02X in column %d", *s & 255, (int) len + 1);
+	{
+        unsigned char c = *s;
+        len = UTF ? Perl_utf8_length(aTHX_ (U8 *) PL_linestart, (U8 *) s) : (STRLEN) (s - PL_linestart);
+        if (len > UNRECOGNIZED_PRECEDE_COUNT) {
+            d = UTF ? (char *) Perl_utf8_hop(aTHX_ (U8 *) s, -UNRECOGNIZED_PRECEDE_COUNT) : s - UNRECOGNIZED_PRECEDE_COUNT;
+        } else {
+            d = PL_linestart;
+        }	
+        *s = '\0';
+        Perl_croak(aTHX_ "Unrecognized character \\x%02X; marked by <-- HERE after %s<-- HERE near column %d", c, d, (int) len + 1);
+    }
     case 4:
     case 26:
 	goto fake_eof;			/* emulate EOF on ^D or ^Z */
@@ -3714,7 +4594,7 @@
 		sv_catpvs(PL_linestr,
 			  "use feature ':5." STRINGIFY(PERL_VERSION) "';");
 	    if (PL_minus_n || PL_minus_p) {
-		sv_catpvs(PL_linestr, "LINE: while (<>) {");
+		sv_catpvs(PL_linestr, "LINE: while (<>) {"/*}*/);
 		if (PL_minus_l)
 		    sv_catpvs(PL_linestr,"chomp;");
 		if (PL_minus_a) {
@@ -3753,72 +4633,33 @@
 	    goto retry;
 	}
 	do {
+	    fake_eof = 0;
 	    bof = PL_rsfp ? TRUE : FALSE;
-	    if ((s = filter_gets(PL_linestr, PL_rsfp, 0)) == NULL) {
+	    if (0) {
 	      fake_eof:
+		fake_eof = LEX_FAKE_EOF;
+	    }
+	    PL_bufptr = PL_bufend;
+	    CopLINE_inc(PL_curcop);
+	    if (!lex_next_chunk(fake_eof)) {
+		CopLINE_dec(PL_curcop);
+		s = PL_bufptr;
+		TOKEN(';');	/* not infinite loop because rsfp is NULL now */
+	    }
+	    CopLINE_dec(PL_curcop);
 #ifdef PERL_MAD
+	    if (!PL_rsfp)
 		PL_realtokenstart = -1;
 #endif
-		if (PL_rsfp) {
-		    if (PL_preprocess && !PL_in_eval)
-			(void)PerlProc_pclose(PL_rsfp);
-		    else if ((PerlIO *)PL_rsfp == PerlIO_stdin())
-			PerlIO_clearerr(PL_rsfp);
-		    else
-			(void)PerlIO_close(PL_rsfp);
-		    PL_rsfp = NULL;
-		    PL_doextract = FALSE;
-		}
-		if (!PL_in_eval && (PL_minus_n || PL_minus_p)) {
-#ifdef PERL_MAD
-		    if (PL_madskills)
-			PL_faketokens = 1;
-#endif
-		    if (PL_minus_p)
-			sv_setpvs(PL_linestr, ";}continue{print;}");
-		    else
-			sv_setpvs(PL_linestr, ";}");
-		    PL_oldoldbufptr = PL_oldbufptr = s = PL_linestart = SvPVX(PL_linestr);
-		    PL_bufend = SvPVX(PL_linestr) + SvCUR(PL_linestr);
-		    PL_last_lop = PL_last_uni = NULL;
-		    PL_minus_n = PL_minus_p = 0;
-		    goto retry;
-		}
-		PL_oldoldbufptr = PL_oldbufptr = s = PL_linestart = SvPVX(PL_linestr);
-		PL_last_lop = PL_last_uni = NULL;
-		sv_setpvs(PL_linestr,"");
-		TOKEN(';');	/* not infinite loop because rsfp is NULL now */
-	    }
+	    s = PL_bufptr;
 	    /* If it looks like the start of a BOM or raw UTF-16,
 	     * check if it in fact is. */
-	    else if (bof &&
+	    if (bof && PL_rsfp &&
 		     (*s == 0 ||
 		      *(U8*)s == 0xEF ||
 		      *(U8*)s >= 0xFE ||
 		      s[1] == 0)) {
-#ifdef PERLIO_IS_STDIO
-#  ifdef __GNU_LIBRARY__
-#    if __GNU_LIBRARY__ == 1 /* Linux glibc5 */
-#      define FTELL_FOR_PIPE_IS_BROKEN
-#    endif
-#  else
-#    ifdef __GLIBC__
-#      if __GLIBC__ == 1 /* maybe some glibc5 release had it like this? */
-#        define FTELL_FOR_PIPE_IS_BROKEN
-#      endif
-#    endif
-#  endif
-#endif
-#ifdef FTELL_FOR_PIPE_IS_BROKEN
-		/* This loses the possibility to detect the bof
-		 * situation on perl -P when the libc5 is being used.
-		 * Workaround?  Maybe attach some extra state to PL_rsfp?
-		 */
-		if (!PL_preprocess)
-		    bof = PerlIO_tell(PL_rsfp) == SvCUR(PL_linestr);
-#else
 		bof = PerlIO_tell(PL_rsfp) == (Off_t)SvCUR(PL_linestr);
-#endif
 		if (bof) {
 		    PL_bufend = SvPVX(PL_linestr) + SvCUR(PL_linestr);
 		    s = swallow_bom((U8*)s);
@@ -3838,11 +4679,10 @@
 		    PL_doextract = FALSE;
 		}
 	    }
-	    incline(s);
+	    if (PL_rsfp)
+		incline(s);
 	} while (PL_doextract);
 	PL_oldoldbufptr = PL_oldbufptr = PL_bufptr = PL_linestart = s;
-	if ((PERLDB_LINE || PERLDB_SAVESRC) && PL_curstash != PL_debstash)
-	    update_debugger_info(PL_linestr, NULL, 0);
 	PL_bufend = SvPVX(PL_linestr) + SvCUR(PL_linestr);
 	PL_last_lop = PL_last_uni = NULL;
 	if (CopLINE(PL_curcop) == 1) {
@@ -3951,7 +4791,6 @@
 			*s = '#';	/* Don't try to parse shebang line */
 		}
 #endif /* ALTERNATE_SHEBANG */
-#ifndef MACOS_TRADITIONAL
 		if (!d &&
 		    *s == '#' &&
 		    ipathend > ipath &&
@@ -3967,7 +4806,7 @@
 		    while (s < PL_bufend && isSPACE(*s))
 			s++;
 		    if (s < PL_bufend) {
-			Newxz(newargv,PL_origargc+3,char*);
+			Newx(newargv,PL_origargc+3,char*);
 			newargv[1] = s;
 			while (s < PL_bufend && !isSPACE(*s))
 			    s++;
@@ -3982,7 +4821,6 @@
 		    PERL_FPU_POST_EXEC
 		    Perl_croak(aTHX_ "Can't exec %s", ipath);
 		}
-#endif
 		if (d) {
 		    while (*d && !isSPACE(*d))
 			d++;
@@ -4052,9 +4890,6 @@
       "\t(Maybe you didn't strip carriage returns after a network transfer?)\n");
 #endif
     case ' ': case '\t': case '\f': case 013:
-#ifdef MACOS_TRADITIONAL
-    case '\312':
-#endif
 #ifdef PERL_MAD
 	PL_realtokenstart = -1;
 	if (!PL_thiswhite)
@@ -4328,6 +5163,9 @@
 	    if (!PL_in_my || PL_lex_state != LEX_NORMAL)
 		break;
 	    PL_bufptr = s;	/* update in case we back off */
+	    if (*s == '=') {
+		deprecate(":= for an empty attribute list");
+	    }
 	    goto grabattrs;
 	case XATTRBLOCK:
 	    PL_expect = XBLOCK;
@@ -4350,6 +5188,7 @@
 		    case KEY_or:
 		    case KEY_and:
 		    case KEY_for:
+		    case KEY_foreach:
 		    case KEY_unless:
 		    case KEY_if:
 		    case KEY_while:
@@ -4385,11 +5224,6 @@
 		    if (len == 6 && strnEQ(SvPVX(sv), "unique", len)) {
 			sv_free(sv);
 			if (PL_in_my == KEY_our) {
-#ifdef USE_ITHREADS
-			    GvUNIQUE_on(cGVOPx_gv(pl_yylval.opval));
-#else
-			    /* skip to avoid loading attributes.pm */
-#endif
 			    deprecate(":unique");
 			}
 			else
@@ -4404,7 +5238,7 @@
 		    }
 		    else if (!PL_in_my && len == 6 && strnEQ(SvPVX(sv), "locked", len)) {
 			sv_free(sv);
-			CvLOCKED_on(PL_compcv);
+			deprecate(":locked");
 		    }
 		    else if (!PL_in_my && len == 6 && strnEQ(SvPVX(sv), "method", len)) {
 			sv_free(sv);
@@ -4886,9 +5720,7 @@
 
 	if (PL_expect == XOPERATOR) {
 	    if (PL_lex_formbrack && PL_lex_brackets == PL_lex_formbrack) {
-		PL_expect = XTERM;
-		deprecate_old(commaless_variable_list);
-		return REPORT(','); /* grandfather non-comma-format format */
+		return deprecate_commaless_var_list();
 	    }
 	}
 
@@ -4927,7 +5759,7 @@
 	d = s;
 	{
 	    const char tmp = *s;
-	    if (PL_lex_state == LEX_NORMAL)
+	    if (PL_lex_state == LEX_NORMAL || PL_lex_brackets)
 		s = SKIPSPACE1(s);
 
 	    if ((PL_expect != XREF || PL_oldoldbufptr == PL_last_lop)
@@ -5068,10 +5900,10 @@
 	    AOPERATOR(DORDOR);
 	}
      case '?':			/* may either be conditional or pattern */
-	 if(PL_expect == XOPERATOR) {
+	if (PL_expect == XOPERATOR) {
 	     char tmp = *s++;
 	     if(tmp == '?') {
-    	          OPERATOR('?');
+		OPERATOR('?');
 	     }
              else {
 	         tmp = *s++;
@@ -5110,6 +5942,10 @@
 	    PL_expect = XSTATE;
 	    goto rightbracket;
 	}
+	if (PL_expect == XSTATE && s[1] == '.' && s[2] == '.') {
+	    s += 3;
+	    OPERATOR(YADAYADA);
+	}
 	if (PL_expect == XOPERATOR || !isDIGIT(s[1])) {
 	    char tmp = *s++;
 	    if (*s == tmp) {
@@ -5122,8 +5958,6 @@
 		    pl_yylval.ival = 0;
 		OPERATOR(DOTDOT);
 	    }
-	    if (PL_expect != XOPERATOR)
-		check_uni();
 	    Aop(OP_CONCAT);
 	}
 	/* FALL THROUGH */
@@ -5140,9 +5974,7 @@
 	DEBUG_T( { printbuf("### Saw string before %s\n", s); } );
 	if (PL_expect == XOPERATOR) {
 	    if (PL_lex_formbrack && PL_lex_brackets == PL_lex_formbrack) {
-		PL_expect = XTERM;
-		deprecate_old(commaless_variable_list);
-		return REPORT(','); /* grandfather non-comma-format format */
+		return deprecate_commaless_var_list();
 	    }
 	    else
 		no_op("String",s);
@@ -5157,9 +5989,7 @@
 	DEBUG_T( { printbuf("### Saw string before %s\n", s); } );
 	if (PL_expect == XOPERATOR) {
 	    if (PL_lex_formbrack && PL_lex_brackets == PL_lex_formbrack) {
-		PL_expect = XTERM;
-		deprecate_old(commaless_variable_list);
-		return REPORT(','); /* grandfather non-comma-format format */
+		return deprecate_commaless_var_list();
 	    }
 	    else
 		no_op("String",s);
@@ -5189,9 +6019,9 @@
 
     case '\\':
 	s++;
-	if (PL_lex_inwhat && isDIGIT(*s) && ckWARN(WARN_SYNTAX))
-	    Perl_warner(aTHX_ packWARN(WARN_SYNTAX),"Can't use \\%c to mean $%c in expression",
-			*s, *s);
+	if (PL_lex_inwhat && isDIGIT(*s))
+	    Perl_ck_warner(aTHX_ packWARN(WARN_SYNTAX),"Can't use \\%c to mean $%c in expression",
+			   *s, *s);
 	if (PL_expect == XOPERATOR)
 	    no_op("Backslash",s);
 	OPERATOR(REFGEN);
@@ -5253,6 +6083,7 @@
     case 'z': case 'Z':
 
       keylookup: {
+	bool anydelim;
 	I32 tmp;
 
 	orig_keyword = 0;
@@ -5263,31 +6094,19 @@
 	s = scan_word(s, PL_tokenbuf, sizeof PL_tokenbuf, FALSE, &len);
 
 	/* Some keywords can be followed by any delimiter, including ':' */
-	tmp = ((len == 1 && strchr("msyq", PL_tokenbuf[0])) ||
+	anydelim = ((len == 1 && strchr("msyq", PL_tokenbuf[0])) ||
 	       (len == 2 && ((PL_tokenbuf[0] == 't' && PL_tokenbuf[1] == 'r') ||
 			     (PL_tokenbuf[0] == 'q' &&
 			      strchr("qwxr", PL_tokenbuf[1])))));
 
 	/* x::* is just a word, unless x is "CORE" */
-	if (!tmp && *s == ':' && s[1] == ':' && strNE(PL_tokenbuf, "CORE"))
+	if (!anydelim && *s == ':' && s[1] == ':' && strNE(PL_tokenbuf, "CORE"))
 	    goto just_a_word;
 
 	d = s;
 	while (d < PL_bufend && isSPACE(*d))
 		d++;	/* no comments skipped here, or s### is misparsed */
 
-	/* Is this a label? */
-	if (!tmp && PL_expect == XSTATE
-	      && d < PL_bufend && *d == ':' && *(d + 1) != ':') {
-	    s = d + 1;
-	    pl_yylval.pval = CopLABEL_alloc(PL_tokenbuf);
-	    CLINE;
-	    TOKEN(LABEL);
-	}
-
-	/* Check for keywords */
-	tmp = keyword(PL_tokenbuf, len, 0);
-
 	/* Is this a word before a => operator? */
 	if (*d == '=' && d[1] == '>') {
 	    CLINE;
@@ -5298,6 +6117,45 @@
 	    TERM(WORD);
 	}
 
+	/* Check for plugged-in keyword */
+	{
+	    OP *o;
+	    int result;
+	    char *saved_bufptr = PL_bufptr;
+	    PL_bufptr = s;
+	    result = CALL_FPTR(PL_keyword_plugin)(aTHX_ PL_tokenbuf, len, &o);
+	    s = PL_bufptr;
+	    if (result == KEYWORD_PLUGIN_DECLINE) {
+		/* not a plugged-in keyword */
+		PL_bufptr = saved_bufptr;
+	    } else if (result == KEYWORD_PLUGIN_STMT) {
+		pl_yylval.opval = o;
+		CLINE;
+		PL_expect = XSTATE;
+		return REPORT(PLUGSTMT);
+	    } else if (result == KEYWORD_PLUGIN_EXPR) {
+		pl_yylval.opval = o;
+		CLINE;
+		PL_expect = XOPERATOR;
+		return REPORT(PLUGEXPR);
+	    } else {
+		Perl_croak(aTHX_ "Bad plugin affecting keyword '%s'",
+					PL_tokenbuf);
+	    }
+	}
+
+	/* Check for built-in keyword */
+	tmp = keyword(PL_tokenbuf, len, 0);
+
+	/* Is this a label? */
+	if (!anydelim && PL_expect == XSTATE
+	      && d < PL_bufend && *d == ':' && *(d + 1) != ':') {
+	    s = d + 1;
+	    pl_yylval.pval = CopLABEL_alloc(PL_tokenbuf);
+	    CLINE;
+	    TOKEN(LABEL);
+	}
+
 	if (tmp < 0) {			/* second-class keyword? */
 	    GV *ogv = NULL;	/* override (winner) */
 	    GV *hgv = NULL;	/* hidden (loser) */
@@ -5331,17 +6189,16 @@
 	    }
 	    else {			/* no override */
 		tmp = -tmp;
-		if (tmp == KEY_dump && ckWARN(WARN_MISC)) {
-		    Perl_warner(aTHX_ packWARN(WARN_MISC),
-			    "dump() better written as CORE::dump()");
+		if (tmp == KEY_dump) {
+		    Perl_ck_warner(aTHX_ packWARN(WARN_MISC),
+				   "dump() better written as CORE::dump()");
 		}
 		gv = NULL;
 		gvp = 0;
-		if (hgv && tmp != KEY_x && tmp != KEY_CORE
-			&& ckWARN(WARN_AMBIGUOUS))	/* never ambiguous */
-		    Perl_warner(aTHX_ packWARN(WARN_AMBIGUOUS),
-		    	"Ambiguous call resolved as CORE::%s(), %s",
-			 GvENAME(hgv), "qualify as such or use &");
+		if (hgv && tmp != KEY_x && tmp != KEY_CORE)	/* never ambiguous */
+		    Perl_ck_warner(aTHX_ packWARN(WARN_AMBIGUOUS),
+				   "Ambiguous call resolved as CORE::%s(), %s",
+				   GvENAME(hgv), "qualify as such or use &");
 	    }
 	}
 
@@ -5363,6 +6220,7 @@
 		SV *sv;
 		int pkgname = 0;
 		const char lastchar = (PL_bufptr == PL_oldoldbufptr ? 0 : PL_bufptr[-1]);
+		OP *rv2cv_op;
 		CV *cv;
 #ifdef PERL_MAD
 		SV *nextPL_nextwhite = 0;
@@ -5456,19 +6314,29 @@
 		if (len)
 		    goto safe_bareword;
 
-		/* Do the explicit type check so that we don't need to force
-		   the initialisation of the symbol table to have a real GV.
-		   Beware - gv may not really be a PVGV, cv may not really be
-		   a PVCV, (because of the space optimisations that gv_init
-		   understands) But they're true if for this symbol there is
-		   respectively a typeglob and a subroutine.
-		*/
-		cv = gv ? ((SvTYPE(gv) == SVt_PVGV)
-		    /* Real typeglob, so get the real subroutine: */
-			   ? GvCVu(gv)
-		    /* A proxy for a subroutine in this package? */
-			   : SvOK(gv) ? MUTABLE_CV(gv) : NULL)
-		    : NULL;
+		cv = NULL;
+		{
+		    OP *const_op = newSVOP(OP_CONST, 0, SvREFCNT_inc(sv));
+		    const_op->op_private = OPpCONST_BARE;
+		    rv2cv_op = newCVREF(0, const_op);
+		}
+		if (rv2cv_op->op_type == OP_RV2CV &&
+			(rv2cv_op->op_flags & OPf_KIDS)) {
+		    OP *rv_op = cUNOPx(rv2cv_op)->op_first;
+		    switch (rv_op->op_type) {
+			case OP_CONST: {
+			    SV *sv = cSVOPx_sv(rv_op);
+			    if (SvROK(sv) && SvTYPE(SvRV(sv)) == SVt_PVCV)
+				cv = (CV*)SvRV(sv);
+			} break;
+			case OP_GV: {
+			    GV *gv = cGVOPx_gv(rv_op);
+			    CV *maybe_cv = GvCVu(gv);
+			    if (maybe_cv && SvTYPE((SV*)maybe_cv) == SVt_PVCV)
+				cv = maybe_cv;
+			} break;
+		    }
+		}
 
 		/* See if it's the indirect object for a list operator. */
 
@@ -5491,8 +6359,10 @@
 		    /* Two barewords in a row may indicate method call. */
 
 		    if ((isIDFIRST_lazy_if(s,UTF) || *s == '$') &&
-			(tmp = intuit_method(s, gv, cv)))
+			(tmp = intuit_method(s, gv, cv))) {
+			op_free(rv2cv_op);
 			return REPORT(tmp);
+		    }
 
 		    /* If not a declared subroutine, it's an indirect object. */
 		    /* (But it's an indir obj regardless for sort.) */
@@ -5500,7 +6370,7 @@
 
 		    if (
 			( !immediate_paren && (PL_last_lop_op == OP_SORT ||
-                         ((!gv || !cv) &&
+                         (!cv &&
                         (PL_last_lop_op != OP_MAPSTART &&
 			 PL_last_lop_op != OP_GREPSTART))))
 		       || (PL_tokenbuf[0] == '_' && PL_tokenbuf[1] == '\0'
@@ -5523,6 +6393,7 @@
 
 		/* Is this a word before a => operator? */
 		if (*s == '=' && s[1] == '>' && !pkgname) {
+		    op_free(rv2cv_op);
 		    CLINE;
 		    sv_setpv(((SVOP*)pl_yylval.opval)->op_sv, PL_tokenbuf);
 		    if (UTF && !IN_BYTES && is_utf8_string((U8*)PL_tokenbuf, len))
@@ -5537,7 +6408,7 @@
 			d = s + 1;
 			while (SPACE_OR_TAB(*d))
 			    d++;
-			if (*d == ')' && (sv = gv_const_sv(gv))) {
+			if (*d == ')' && (sv = cv_const_sv(cv))) {
 			    s = d + 1;
 			    goto its_constant;
 			}
@@ -5558,6 +6429,7 @@
 			PL_thistoken = newSVpvs("");
 		    }
 #endif
+		    op_free(rv2cv_op);
 		    force_next(WORD);
 		    pl_yylval.ival = 0;
 		    TOKEN('&');
@@ -5565,7 +6437,8 @@
 
 		/* If followed by var or block, call it a method (unless sub) */
 
-		if ((*s == '$' || *s == '{') && (!gv || !cv)) {
+		if ((*s == '$' || *s == '{') && !cv) {
+		    op_free(rv2cv_op);
 		    PL_last_lop = PL_oldbufptr;
 		    PL_last_lop_op = OP_METHOD;
 		    PREBLOCK(METHOD);
@@ -5575,36 +6448,30 @@
 
 		if (!orig_keyword
 			&& (isIDFIRST_lazy_if(s,UTF) || *s == '$')
-			&& (tmp = intuit_method(s, gv, cv)))
+			&& (tmp = intuit_method(s, gv, cv))) {
+		    op_free(rv2cv_op);
 		    return REPORT(tmp);
+		}
 
 		/* Not a method, so call it a subroutine (if defined) */
 
 		if (cv) {
-		    if (lastchar == '-' && ckWARN_d(WARN_AMBIGUOUS))
-			Perl_warner(aTHX_ packWARN(WARN_AMBIGUOUS),
-				"Ambiguous use of -%s resolved as -&%s()",
-				PL_tokenbuf, PL_tokenbuf);
+		    if (lastchar == '-')
+			Perl_ck_warner_d(aTHX_ packWARN(WARN_AMBIGUOUS),
+					 "Ambiguous use of -%s resolved as -&%s()",
+					 PL_tokenbuf, PL_tokenbuf);
 		    /* Check for a constant sub */
-		    if ((sv = gv_const_sv(gv))) {
+		    if ((sv = cv_const_sv(cv))) {
 		  its_constant:
+			op_free(rv2cv_op);
 			SvREFCNT_dec(((SVOP*)pl_yylval.opval)->op_sv);
 			((SVOP*)pl_yylval.opval)->op_sv = SvREFCNT_inc_simple(sv);
 			pl_yylval.opval->op_private = 0;
 			TOKEN(WORD);
 		    }
 
-		    /* Resolve to GV now. */
-		    if (SvTYPE(gv) != SVt_PVGV) {
-			gv = gv_fetchpv(PL_tokenbuf, 0, SVt_PVCV);
-			assert (SvTYPE(gv) == SVt_PVGV);
-			/* cv must have been some sort of placeholder, so
-			   now needs replacing with a real code reference.  */
-			cv = GvCV(gv);
-		    }
-
 		    op_free(pl_yylval.opval);
-		    pl_yylval.opval = newCVREF(0, newGVOP(OP_GV, 0, gv));
+		    pl_yylval.opval = rv2cv_op;
 		    pl_yylval.opval->op_private |= OPpENTERSUB_NOPAREN;
 		    PL_last_lop = PL_oldbufptr;
 		    PL_last_lop_op = OP_ENTERSUB;
@@ -5672,7 +6539,7 @@
 		    if (probable_sub) {
 			gv = gv_fetchpv(PL_tokenbuf, GV_ADD, SVt_PVCV);
 			op_free(pl_yylval.opval);
-			pl_yylval.opval = newCVREF(0, newGVOP(OP_GV, 0, gv));
+			pl_yylval.opval = rv2cv_op;
 			pl_yylval.opval->op_private |= OPpENTERSUB_NOPAREN;
 			PL_last_lop = PL_oldbufptr;
 			PL_last_lop_op = OP_ENTERSUB;
@@ -5701,6 +6568,18 @@
 		    pl_yylval.opval->op_private |= OPpCONST_STRICT;
 		else {
 		bareword:
+		    /* after "print" and similar functions (corresponding to
+		     * "F? L" in opcode.pl), whatever wasn't already parsed as
+		     * a filehandle should be subject to "strict subs".
+		     * Likewise for the optional indirect-object argument to system
+		     * or exec, which can't be a bareword */
+		    if ((PL_last_lop_op == OP_PRINT
+			    || PL_last_lop_op == OP_PRTF
+			    || PL_last_lop_op == OP_SAY
+			    || PL_last_lop_op == OP_SYSTEM
+			    || PL_last_lop_op == OP_EXEC)
+			    && (PL_hints & HINT_STRICT_SUBS))
+			pl_yylval.opval->op_private |= OPpCONST_STRICT;
 		    if (lastchar != '-') {
 			if (ckWARN(WARN_RESERVED)) {
 			    d = PL_tokenbuf;
@@ -5712,16 +6591,16 @@
 			}
 		    }
 		}
+		op_free(rv2cv_op);
 
 	    safe_bareword:
-		if ((lastchar == '*' || lastchar == '%' || lastchar == '&')
-		    && ckWARN_d(WARN_AMBIGUOUS)) {
-		    Perl_warner(aTHX_ packWARN(WARN_AMBIGUOUS),
-		  	"Operator or semicolon missing before %c%s",
-			lastchar, PL_tokenbuf);
-		    Perl_warner(aTHX_ packWARN(WARN_AMBIGUOUS),
-			"Ambiguous use of %c resolved as operator %c",
-			lastchar, lastchar);
+		if ((lastchar == '*' || lastchar == '%' || lastchar == '&')) {
+		    Perl_ck_warner_d(aTHX_ packWARN(WARN_AMBIGUOUS),
+				     "Operator or semicolon missing before %c%s",
+				     lastchar, PL_tokenbuf);
+		    Perl_ck_warner_d(aTHX_ packWARN(WARN_AMBIGUOUS),
+				     "Ambiguous use of %c resolved as operator %c",
+				     lastchar, lastchar);
 		}
 		TOKEN(WORD);
 	    }
@@ -5764,9 +6643,7 @@
 #endif
 		/* Mark this internal pseudo-handle as clean */
 		IoFLAGS(GvIOp(gv)) |= IOf_UNTAINT;
-		if (PL_preprocess)
-		    IoTYPE(GvIOp(gv)) = IoTYPE_PIPE;
-		else if ((PerlIO*)PL_rsfp == PerlIO_stdin())
+		if ((PerlIO*)PL_rsfp == PerlIO_stdin())
 		    IoTYPE(GvIOp(gv)) = IoTYPE_STD;
 		else
 		    IoTYPE(GvIOp(gv)) = IoTYPE_RDONLY;
@@ -5834,8 +6711,8 @@
 			sv_catpvn(PL_endwhite, tstart, PL_bufend - tstart);
 			PL_realtokenstart = -1;
 		    }
-		    while ((s = filter_gets(PL_endwhite, PL_rsfp,
-				 SvCUR(PL_endwhite))) != NULL) ;
+		    while ((s = filter_gets(PL_endwhite, SvCUR(PL_endwhite)))
+			   != NULL) ;
 		}
 #endif
 		PL_rsfp = NULL;
@@ -6024,8 +6901,14 @@
 
 	case KEY_eval:
 	    s = SKIPSPACE1(s);
-	    PL_expect = (*s == '{') ? XTERMBLOCK : XTERM;
-	    UNIBRACK(OP_ENTEREVAL);
+	    if (*s == '{') { /* block eval */
+		PL_expect = XTERMBLOCK;
+		UNIBRACK(OP_ENTERTRY);
+	    }
+	    else { /* string eval */
+		PL_expect = XTERM;
+		UNIBRACK(OP_ENTEREVAL);
+	    }
 
 	case KEY_eof:
 	    UNI(OP_EOF);
@@ -6396,6 +7279,8 @@
 
 	case KEY_package:
 	    s = force_word(s,WORD,FALSE,TRUE,FALSE);
+	    s = SKIPSPACE1(s);
+	    s = force_strict_version(s);
 	    OPERATOR(PACKAGE);
 
 	case KEY_pipe:
@@ -6776,7 +7661,13 @@
 		if (*s == '(') {
 		    char *p;
 		    bool bad_proto = FALSE;
-		    const bool warnsyntax = ckWARN(WARN_SYNTAX);
+		    bool in_brackets = FALSE;
+		    char greedy_proto = ' ';
+		    bool proto_after_greedy_proto = FALSE;
+		    bool must_be_last = FALSE;
+		    bool underscore = FALSE;
+		    bool seen_underscore = FALSE;
+		    const bool warnillegalproto = ckWARN(WARN_ILLEGALPROTO);
 
 		    s = scan_str(s,!!PL_madskills,FALSE);
 		    if (!s)
@@ -6787,14 +7678,47 @@
 		    for (p = d; *p; ++p) {
 			if (!isSPACE(*p)) {
 			    d[tmp++] = *p;
-			    if (warnsyntax && !strchr("$@%*;[]&\\_", *p))
-				bad_proto = TRUE;
+
+			    if (warnillegalproto) {
+				if (must_be_last)
+				    proto_after_greedy_proto = TRUE;
+				if (!strchr("$@%*;[]&\\_", *p)) {
+				    bad_proto = TRUE;
+				}
+				else {
+				    if ( underscore ) {
+					if ( *p != ';' )
+					    bad_proto = TRUE;
+					underscore = FALSE;
+				    }
+				    if ( *p == '[' ) {
+					in_brackets = TRUE;
+				    }
+				    else if ( *p == ']' ) {
+					in_brackets = FALSE;
+				    }
+				    else if ( (*p == '@' || *p == '%') &&
+					 ( tmp < 2 || d[tmp-2] != '\\' ) &&
+					 !in_brackets ) {
+					must_be_last = TRUE;
+					greedy_proto = *p;
+				    }
+				    else if ( *p == '_' ) {
+					underscore = seen_underscore = TRUE;
+				    }
+				}
+			    }
 			}
 		    }
 		    d[tmp] = '\0';
+		    if (proto_after_greedy_proto)
+			Perl_warner(aTHX_ packWARN(WARN_ILLEGALPROTO),
+				    "Prototype after '%c' for %"SVf" : %s",
+				    greedy_proto, SVfARG(PL_subname), d);
 		    if (bad_proto)
-			Perl_warner(aTHX_ packWARN(WARN_SYNTAX),
-				    "Illegal character in prototype for %"SVf" : %s",
+			Perl_warner(aTHX_ packWARN(WARN_ILLEGALPROTO),
+				    "Illegal character %sin prototype for %"SVf" : %s",
+				    seen_underscore ? "after '_' " : "",
 				    SVfARG(PL_subname), d);
 		    SvCUR_set(PL_lex_stuff, tmp);
 		    have_proto = TRUE;
@@ -6823,7 +7747,7 @@
 		else if (*s != '{' && key == KEY_sub) {
 		    if (!have_name)
 			Perl_croak(aTHX_ "Illegal declaration of anonymous subroutine");
-		    else if (*s != ';')
+		    else if (*s != ';' && *s != '}')
 			Perl_croak(aTHX_ "Illegal declaration of subroutine %"SVf, SVfARG(PL_subname));
 		}
 
@@ -7036,7 +7960,7 @@
                 yyerror(Perl_form(aTHX_ "No package name allowed for "
                                   "variable %s in \"our\"",
                                   PL_tokenbuf));
-            tmp = allocmy(PL_tokenbuf);
+            tmp = allocmy(PL_tokenbuf, tokenbuf_len, 0);
         }
         else {
             if (has_colon)
@@ -7044,7 +7968,7 @@
 			    PL_in_my == KEY_my ? "my" : "state", PL_tokenbuf));
 
             pl_yylval.opval = newOP(OP_PADANY, 0);
-            pl_yylval.opval->op_targ = allocmy(PL_tokenbuf);
+            pl_yylval.opval->op_targ = allocmy(PL_tokenbuf, tokenbuf_len, 0);
             return PRIVATEREF;
         }
     }
@@ -7063,7 +7987,7 @@
 
     if (!has_colon) {
 	if (!PL_in_my)
-	    tmp = pad_findmy(PL_tokenbuf);
+	    tmp = pad_findmy(PL_tokenbuf, tokenbuf_len, 0);
         if (tmp != NOT_IN_PAD) {
             /* might be an "our" variable" */
             if (PAD_COMPNAME_FLAGS_isOUR(tmp)) {
@@ -7114,11 +8038,11 @@
        and @foo isn't a variable we can find in the symbol
        table.
     */
-    if (pit == '@' && PL_lex_state != LEX_NORMAL && !PL_lex_brackets) {
+    if (ckWARN(WARN_AMBIGUOUS) &&
+	pit == '@' && PL_lex_state != LEX_NORMAL && !PL_lex_brackets) {
         GV *const gv = gv_fetchpvn_flags(PL_tokenbuf + 1, tokenbuf_len - 1, 0,
 					 SVt_PVAV);
         if ((!gv || ((PL_tokenbuf[0] == '@') ? !GvAV(gv) : !GvHV(gv)))
-		&& ckWARN(WARN_AMBIGUOUS)
 		/* DO NOT warn for @- and @+ */
 		&& !( PL_tokenbuf[2] == '\0' &&
 		    ( PL_tokenbuf[1] == '-' || PL_tokenbuf[1] == '+' ))
@@ -7126,8 +8050,8 @@
         {
             /* Downgraded from fatal to warning 20000522 mjd */
             Perl_warner(aTHX_ packWARN(WARN_AMBIGUOUS),
-                        "Possible unintended interpolation of %s in string",
-                         PL_tokenbuf);
+			"Possible unintended interpolation of %s in string",
+			PL_tokenbuf);
         }
     }
 
@@ -8668,8 +9592,7 @@
                   name[4] == 'i' &&
                   name[5] == 'f')
               {                                   /* elseif     */
-                if(ckWARN_d(WARN_SYNTAX))
-                  Perl_warner(aTHX_ packWARN(WARN_SYNTAX), "elseif should be elsif");
+                  Perl_ck_warner_d(aTHX_ packWARN(WARN_SYNTAX), "elseif should be elsif");
               }
 
               goto unknown;
@@ -10650,6 +11573,11 @@
  	SvREFCNT_dec(msg);
   	return sv;
     }
+
+    /* charnames doesn't work well if there have been errors found */
+    if (PL_error_count > 0 && strEQ(key,"charnames"))
+	return &PL_sv_undef;
+
     cvp = hv_fetch(table, key, keylen, FALSE);
     if (!cvp || !SvOK(*cvp)) {
 	why1 = "$^H{";
@@ -10763,7 +11691,7 @@
     char *bracket = NULL;
     char funny = *s++;
     register char *d = dest;
-    register char * const e = d + destlen + 3;    /* two-character token, ending NUL */
+    register char * const e = d + destlen - 3;    /* two-character token, ending NUL */
 
     PERL_ARGS_ASSERT_SCAN_IDENT;
 
@@ -10918,21 +11846,28 @@
     return s;
 }
 
+static U32
+S_pmflag(U32 pmfl, const char ch) {
+    switch (ch) {
+	CASE_STD_PMMOD_FLAGS_PARSE_SET(&pmfl);
+    case GLOBAL_PAT_MOD:    pmfl |= PMf_GLOBAL; break;
+    case CONTINUE_PAT_MOD:  pmfl |= PMf_CONTINUE; break;
+    case ONCE_PAT_MOD:      pmfl |= PMf_KEEP; break;
+    case KEEPCOPY_PAT_MOD:  pmfl |= PMf_KEEPCOPY; break;
+    }
+    return pmfl;
+}
+
 void
 Perl_pmflag(pTHX_ U32* pmfl, int ch)
 {
     PERL_ARGS_ASSERT_PMFLAG;
 
-    PERL_UNUSED_CONTEXT;
+    Perl_ck_warner_d(aTHX_ packWARN(WARN_DEPRECATED),
+		     "Perl_pmflag() is deprecated, and will be removed from the XS API");
+
     if (ch<256) {
-        char c = (char)ch;
-        switch (c) {
-            CASE_STD_PMMOD_FLAGS_PARSE_SET(pmfl);
-            case GLOBAL_PAT_MOD:    *pmfl |= PMf_GLOBAL; break;
-            case CONTINUE_PAT_MOD:  *pmfl |= PMf_CONTINUE; break;
-            case ONCE_PAT_MOD:      *pmfl |= PMf_KEEP; break;
-            case KEEPCOPY_PAT_MOD:  *pmfl |= PMf_KEEPCOPY; break;
-        }
+	*pmfl = S_pmflag(*pmfl, (char)ch);
     }
 }
 
@@ -10986,7 +11921,7 @@
     modstart = s;
 #endif
     while (*s && strchr(valid_flags, *s))
-	pmflag(&pm->op_pmflags,*s++);
+	pm->op_pmflags = S_pmflag(pm->op_pmflags, *s++);
 #ifdef PERL_MAD
     if (PL_madskills && modstart != s) {
 	SV* tmptoken = newSVpvn(modstart, s - modstart);
@@ -10994,11 +11929,10 @@
     }
 #endif
     /* issue a warning if /c is specified,but /g is not */
-    if ((pm->op_pmflags & PMf_CONTINUE) && !(pm->op_pmflags & PMf_GLOBAL)
-	    && ckWARN(WARN_REGEXP))
+    if ((pm->op_pmflags & PMf_CONTINUE) && !(pm->op_pmflags & PMf_GLOBAL))
     {
-        Perl_warner(aTHX_ packWARN(WARN_REGEXP), 
-            "Use of /c modifier is meaningless without /g" );
+        Perl_ck_warner(aTHX_ packWARN(WARN_REGEXP), 
+		       "Use of /c modifier is meaningless without /g" );
     }
 
     PL_lex_op = (OP*)pm;
@@ -11067,7 +12001,7 @@
 	    es++;
 	}
 	else if (strchr(S_PAT_MODS, *s))
-	    pmflag(&pm->op_pmflags,*s++);
+	    pm->op_pmflags = S_pmflag(pm->op_pmflags, *s++);
 	else
 	    break;
     }
@@ -11080,8 +12014,8 @@
 	PL_thismad = 0;
     }
 #endif
-    if ((pm->op_pmflags & PMf_CONTINUE) && ckWARN(WARN_REGEXP)) {
-        Perl_warner(aTHX_ packWARN(WARN_REGEXP), "Use of /c modifier is meaningless in s///" );
+    if ((pm->op_pmflags & PMf_CONTINUE)) {
+        Perl_ck_warner(aTHX_ packWARN(WARN_REGEXP), "Use of /c modifier is meaningless in s///" );
     }
 
     if (es) {
@@ -11249,7 +12183,7 @@
 	else
 	    term = '"';
 	if (!isALNUM_lazy_if(s,UTF))
-	    deprecate_old("bare << to mean <<\"\"");
+	    deprecate("bare << to mean <<\"\"");
 	for (; isALNUM_lazy_if(s,UTF); s++) {
 	    if (d < e)
 		*d++ = *s;
@@ -11409,11 +12343,14 @@
 		PL_thisstuff = newSVpvn(tstart, PL_bufend - tstart);
 	}
 #endif
-	if (!outer ||
-	 !(PL_oldoldbufptr = PL_oldbufptr = s = PL_linestart = filter_gets(PL_linestr, PL_rsfp, 0))) {
+	PL_bufptr = s;
+	CopLINE_inc(PL_curcop);
+	if (!outer || !lex_next_chunk(0)) {
 	    CopLINE_set(PL_curcop, (line_t)PL_multi_start);
 	    missingterm(PL_tokenbuf);
 	}
+	CopLINE_dec(PL_curcop);
+	s = PL_bufptr;
 #ifdef PERL_MAD
 	stuffstart = s - SvPVX(PL_linestr);
 #endif
@@ -11435,8 +12372,6 @@
 	else if (PL_bufend - PL_linestart == 1 && PL_bufend[-1] == '\r')
 	    PL_bufend[-1] = '\n';
 #endif
-	if ((PERLDB_LINE || PERLDB_SAVESRC) && PL_curstash != PL_debstash)
-	    update_debugger_info(PL_linestr, NULL, 0);
 	if (*s == term && memEQ(s,PL_tokenbuf,len)) {
 	    STRLEN off = PL_bufend - 1 - SvPVX_const(PL_linestr);
 	    *(SvPVX(PL_linestr) + off ) = ' ';
@@ -11565,7 +12500,7 @@
 	    /* try to find it in the pad for this block, otherwise find
 	       add symbol table ops
 	    */
-	    const PADOFFSET tmp = pad_findmy(d);
+	    const PADOFFSET tmp = pad_findmy(d, len, 0);
 	    if (tmp != NOT_IN_PAD) {
 		if (PAD_COMPNAME_FLAGS_isOUR(tmp)) {
 		    HV * const stash = PAD_COMPNAME_OURSTASH(tmp);
@@ -11921,25 +12856,17 @@
 		PL_thisstuff = newSVpvn(tstart, PL_bufend - tstart);
 	}
 #endif
-	if (!PL_rsfp ||
-	 !(PL_oldoldbufptr = PL_oldbufptr = s = PL_linestart = filter_gets(PL_linestr, PL_rsfp, 0))) {
+	CopLINE_inc(PL_curcop);
+	PL_bufptr = PL_bufend;
+	if (!lex_next_chunk(0)) {
 	    sv_free(sv);
 	    CopLINE_set(PL_curcop, (line_t)PL_multi_start);
 	    return NULL;
 	}
+	s = PL_bufptr;
 #ifdef PERL_MAD
 	stuffstart = 0;
 #endif
-	/* we read a line, so increment our line counter */
-	CopLINE_inc(PL_curcop);
-
-	/* update debugger info */
-	if ((PERLDB_LINE || PERLDB_SAVESRC) && PL_curstash != PL_debstash)
-	    update_debugger_info(PL_linestr, NULL, 0);
-
-	/* having changed the buffer, we must update PL_bufend */
-	PL_bufend = SvPVX(PL_linestr) + SvCUR(PL_linestr);
-	PL_last_lop = PL_last_uni = NULL;
     }
 
     /* at this point, we have successfully read the delimited string */
@@ -12093,8 +13020,7 @@
 	    }
 
 	    if (*s == '_') {
-	       if (ckWARN(WARN_SYNTAX))
-		   Perl_warner(aTHX_ packWARN(WARN_SYNTAX),
+		Perl_ck_warner(aTHX_ packWARN(WARN_SYNTAX),
 			       "Misplaced _ in number");
 	       lastub = s++;
 	    }
@@ -12117,9 +13043,9 @@
 
 		/* _ are ignored -- but warned about if consecutive */
 		case '_':
-		    if (lastub && s == lastub + 1 && ckWARN(WARN_SYNTAX))
-		        Perl_warner(aTHX_ packWARN(WARN_SYNTAX),
-				    "Misplaced _ in number");
+		    if (lastub && s == lastub + 1)
+		        Perl_ck_warner(aTHX_ packWARN(WARN_SYNTAX),
+				       "Misplaced _ in number");
 		    lastub = s++;
 		    break;
 
@@ -12161,10 +13087,9 @@
 			    && !(PL_hints & HINT_NEW_BINARY)) {
 			    overflowed = TRUE;
 			    n = (NV) u;
-			    if (ckWARN_d(WARN_OVERFLOW))
-				Perl_warner(aTHX_ packWARN(WARN_OVERFLOW),
-					    "Integer overflow in %s number",
-					    base);
+			    Perl_ck_warner_d(aTHX_ packWARN(WARN_OVERFLOW),
+					     "Integer overflow in %s number",
+					     base);
 			} else
 			    u = x | b;		/* add the digit to the end */
 		    }
@@ -12191,24 +13116,23 @@
 
 	    /* final misplaced underbar check */
 	    if (s[-1] == '_') {
-	        if (ckWARN(WARN_SYNTAX))
-		    Perl_warner(aTHX_ packWARN(WARN_SYNTAX), "Misplaced _ in number");
+		Perl_ck_warner(aTHX_ packWARN(WARN_SYNTAX), "Misplaced _ in number");
 	    }
 
 	    sv = newSV(0);
 	    if (overflowed) {
-		if (n > 4294967295.0 && ckWARN(WARN_PORTABLE))
-		    Perl_warner(aTHX_ packWARN(WARN_PORTABLE),
-				"%s number > %s non-portable",
-				Base, max);
+		if (n > 4294967295.0)
+		    Perl_ck_warner(aTHX_ packWARN(WARN_PORTABLE),
+				   "%s number > %s non-portable",
+				   Base, max);
 		sv_setnv(sv, n);
 	    }
 	    else {
 #if UVSIZE > 4
-		if (u > 0xffffffff && ckWARN(WARN_PORTABLE))
-		    Perl_warner(aTHX_ packWARN(WARN_PORTABLE),
-				"%s number > %s non-portable",
-				Base, max);
+		if (u > 0xffffffff)
+		    Perl_ck_warner(aTHX_ packWARN(WARN_PORTABLE),
+				   "%s number > %s non-portable",
+				   Base, max);
 #endif
 		sv_setuv(sv, u);
 	    }
@@ -12237,9 +13161,9 @@
 	       if -w is on
 	    */
 	    if (*s == '_') {
-		if (lastub && s == lastub + 1 && ckWARN(WARN_SYNTAX))
-		    Perl_warner(aTHX_ packWARN(WARN_SYNTAX),
-				"Misplaced _ in number");
+		if (lastub && s == lastub + 1)
+		    Perl_ck_warner(aTHX_ packWARN(WARN_SYNTAX),
+				   "Misplaced _ in number");
 		lastub = s++;
 	    }
 	    else {
@@ -12253,8 +13177,7 @@
 
 	/* final misplaced underbar check */
 	if (lastub && s == lastub + 1) {
-	    if (ckWARN(WARN_SYNTAX))
-		Perl_warner(aTHX_ packWARN(WARN_SYNTAX), "Misplaced _ in number");
+	    Perl_ck_warner(aTHX_ packWARN(WARN_SYNTAX), "Misplaced _ in number");
 	}
 
 	/* read a decimal portion if there is one.  avoid
@@ -12266,9 +13189,8 @@
 	    *d++ = *s++;
 
 	    if (*s == '_') {
-	        if (ckWARN(WARN_SYNTAX))
-		    Perl_warner(aTHX_ packWARN(WARN_SYNTAX),
-				"Misplaced _ in number");
+		Perl_ck_warner(aTHX_ packWARN(WARN_SYNTAX),
+			       "Misplaced _ in number");
 		lastub = s;
 	    }
 
@@ -12279,9 +13201,9 @@
 		if (d >= e)
 		    Perl_croak(aTHX_ number_too_long);
 		if (*s == '_') {
-		   if (lastub && s == lastub + 1 && ckWARN(WARN_SYNTAX))
-		       Perl_warner(aTHX_ packWARN(WARN_SYNTAX),
-				   "Misplaced _ in number");
+		   if (lastub && s == lastub + 1)
+		       Perl_ck_warner(aTHX_ packWARN(WARN_SYNTAX),
+				      "Misplaced _ in number");
 		   lastub = s;
 		}
 		else
@@ -12289,9 +13211,8 @@
 	    }
 	    /* fractional part ending in underbar? */
 	    if (s[-1] == '_') {
-	        if (ckWARN(WARN_SYNTAX))
-		    Perl_warner(aTHX_ packWARN(WARN_SYNTAX),
-				"Misplaced _ in number");
+		Perl_ck_warner(aTHX_ packWARN(WARN_SYNTAX),
+			       "Misplaced _ in number");
 	    }
 	    if (*s == '.' && isDIGIT(s[1])) {
 		/* oops, it's really a v-string, but without the "v" */
@@ -12310,9 +13231,8 @@
 
 	    /* stray preinitial _ */
 	    if (*s == '_') {
-	        if (ckWARN(WARN_SYNTAX))
-		    Perl_warner(aTHX_ packWARN(WARN_SYNTAX),
-				"Misplaced _ in number");
+		Perl_ck_warner(aTHX_ packWARN(WARN_SYNTAX),
+			       "Misplaced _ in number");
 	        lastub = s++;
 	    }
 
@@ -12322,9 +13242,8 @@
 
 	    /* stray initial _ */
 	    if (*s == '_') {
-	        if (ckWARN(WARN_SYNTAX))
-		    Perl_warner(aTHX_ packWARN(WARN_SYNTAX),
-				"Misplaced _ in number");
+		Perl_ck_warner(aTHX_ packWARN(WARN_SYNTAX),
+			       "Misplaced _ in number");
 	        lastub = s++;
 	    }
 
@@ -12337,10 +13256,9 @@
 		}
 		else {
 		   if (((lastub && s == lastub + 1) ||
-			(!isDIGIT(s[1]) && s[1] != '_'))
-	   	    && ckWARN(WARN_SYNTAX))
-		       Perl_warner(aTHX_ packWARN(WARN_SYNTAX),
-				   "Misplaced _ in number");
+			(!isDIGIT(s[1]) && s[1] != '_')))
+		       Perl_ck_warner(aTHX_ packWARN(WARN_SYNTAX),
+				      "Misplaced _ in number");
 		   lastub = s++;
 		}
 	    }
@@ -12474,6 +13392,7 @@
 	}
 	s = (char*)eol;
 	if (PL_rsfp) {
+	    bool got_some;
 #ifdef PERL_MAD
 	    if (PL_madskills) {
 		if (PL_thistoken)
@@ -12482,18 +13401,16 @@
 		    PL_thistoken = newSVpvn(tokenstart, PL_bufend - tokenstart);
 	    }
 #endif
-	    s = filter_gets(PL_linestr, PL_rsfp, 0);
+	    PL_bufptr = PL_bufend;
+	    CopLINE_inc(PL_curcop);
+	    got_some = lex_next_chunk(0);
+	    CopLINE_dec(PL_curcop);
+	    s = PL_bufptr;
 #ifdef PERL_MAD
-	    tokenstart = PL_oldoldbufptr = PL_oldbufptr = PL_bufptr = PL_linestart = SvPVX(PL_linestr);
-#else
-	    PL_oldoldbufptr = PL_oldbufptr = PL_bufptr = PL_linestart = SvPVX(PL_linestr);
+	    tokenstart = PL_bufptr;
 #endif
-	    PL_bufend = PL_bufptr + SvCUR(PL_linestr);
-	    PL_last_lop = PL_last_uni = NULL;
-	    if (!s) {
-		s = PL_bufptr;
+	    if (!got_some)
 		break;
-	    }
 	}
 	incline(s);
     }
@@ -12567,8 +13484,8 @@
 #ifdef __SC__
 #pragma segment Perl_yylex
 #endif
-int
-Perl_yywarn(pTHX_ const char *s)
+static int
+S_yywarn(pTHX_ const char *const s)
 {
     dVAR;
 
@@ -12581,7 +13498,7 @@
 }
 
 int
-Perl_yyerror(pTHX_ const char *s)
+Perl_yyerror(pTHX_ const char *const s)
 {
     dVAR;
     const char *where = NULL;
@@ -12664,8 +13581,7 @@
         PL_multi_end = 0;
     }
     if (PL_in_eval & EVAL_WARNONLY) {
-	if (ckWARN_d(WARN_SYNTAX))
-	    Perl_warner(aTHX_ packWARN(WARN_SYNTAX), "%"SVf, SVfARG(msg));
+	Perl_ck_warner_d(aTHX_ packWARN(WARN_SYNTAX), "%"SVf, SVfARG(msg));
     }
     else
 	qerror(msg);
@@ -12696,39 +13612,17 @@
     switch (s[0]) {
     case 0xFF:
 	if (s[1] == 0xFE) {
-	    /* UTF-16 little-endian? (or UTF32-LE?) */
+	    /* UTF-16 little-endian? (or UTF-32LE?) */
 	    if (s[2] == 0 && s[3] == 0)  /* UTF-32 little-endian */
-		Perl_croak(aTHX_ "Unsupported script encoding UTF32-LE");
+		Perl_croak(aTHX_ "Unsupported script encoding UTF-32LE");
 #ifndef PERL_NO_UTF16_FILTER
-	    if (DEBUG_p_TEST || DEBUG_T_TEST) PerlIO_printf(Perl_debug_log, "UTF16-LE script encoding (BOM)\n");
+	    if (DEBUG_p_TEST || DEBUG_T_TEST) PerlIO_printf(Perl_debug_log, "UTF-16LE script encoding (BOM)\n");
 	    s += 2;
-	utf16le:
 	    if (PL_bufend > (char*)s) {
-		U8 *news;
-		I32 newlen;
-
-		filter_add(utf16rev_textfilter, NULL);
-		Newx(news, (PL_bufend - (char*)s) * 3 / 2 + 1, U8);
-		utf16_to_utf8_reversed(s, news,
-				       PL_bufend - (char*)s - 1,
-				       &newlen);
-		sv_setpvn(PL_linestr, (const char*)news, newlen);
-#ifdef PERL_MAD
-		s = (U8*)SvPVX(PL_linestr);
-  		Copy(news, s, newlen, U8);
-		s[newlen] = '\0';
-#endif
-		Safefree(news);
-		SvUTF8_on(PL_linestr);
-		s = (U8*)SvPVX(PL_linestr);
-#ifdef PERL_MAD
-		/* FIXME - is this a general bug fix?  */
-		s[newlen] = '\0';
-#endif
-		PL_bufend = SvPVX(PL_linestr) + newlen;
+		s = add_utf16_textfilter(s, TRUE);
 	    }
 #else
-	    Perl_croak(aTHX_ "Unsupported script encoding UTF16-LE");
+	    Perl_croak(aTHX_ "Unsupported script encoding UTF-16LE");
 #endif
 	}
 	break;
@@ -12737,24 +13631,11 @@
 #ifndef PERL_NO_UTF16_FILTER
 	    if (DEBUG_p_TEST || DEBUG_T_TEST) PerlIO_printf(Perl_debug_log, "UTF-16BE script encoding (BOM)\n");
 	    s += 2;
-	utf16be:
 	    if (PL_bufend > (char *)s) {
-		U8 *news;
-		I32 newlen;
-
-		filter_add(utf16_textfilter, NULL);
-		Newx(news, (PL_bufend - (char*)s) * 3 / 2 + 1, U8);
-		utf16_to_utf8(s, news,
-			      PL_bufend - (char*)s,
-			      &newlen);
-		sv_setpvn(PL_linestr, (const char*)news, newlen);
-		Safefree(news);
-		SvUTF8_on(PL_linestr);
-		s = (U8*)SvPVX(PL_linestr);
-		PL_bufend = SvPVX(PL_linestr) + newlen;
+		s = add_utf16_textfilter(s, FALSE);
 	    }
 #else
-	    Perl_croak(aTHX_ "Unsupported script encoding UTF16-BE");
+	    Perl_croak(aTHX_ "Unsupported script encoding UTF-16BE");
 #endif
 	}
 	break;
@@ -12769,15 +13650,19 @@
 	     if (s[1] == 0) {
 		  if (s[2] == 0xFE && s[3] == 0xFF) {
 		       /* UTF-32 big-endian */
-		       Perl_croak(aTHX_ "Unsupported script encoding UTF32-BE");
+		       Perl_croak(aTHX_ "Unsupported script encoding UTF-32BE");
 		  }
 	     }
 	     else if (s[2] == 0 && s[3] != 0) {
 		  /* Leading bytes
 		   * 00 xx 00 xx
 		   * are a good indicator of UTF-16BE. */
+#ifndef PERL_NO_UTF16_FILTER
 		  if (DEBUG_p_TEST || DEBUG_T_TEST) PerlIO_printf(Perl_debug_log, "UTF-16BE script encoding (no BOM)\n");
-		  goto utf16be;
+		  s = add_utf16_textfilter(s, FALSE);
+#else
+		  Perl_croak(aTHX_ "Unsupported script encoding UTF-16BE");
+#endif
 	     }
 	}
 #ifdef EBCDIC
@@ -12794,8 +13679,12 @@
 		  /* Leading bytes
 		   * xx 00 xx 00
 		   * are a good indicator of UTF-16LE. */
+#ifndef PERL_NO_UTF16_FILTER
 	      if (DEBUG_p_TEST || DEBUG_T_TEST) PerlIO_printf(Perl_debug_log, "UTF-16LE script encoding (no BOM)\n");
-	      goto utf16le;
+	      s = add_utf16_textfilter(s, TRUE);
+#else
+	      Perl_croak(aTHX_ "Unsupported script encoding UTF-16LE");
+#endif
 	 }
     }
     return (char*)s;
@@ -12804,49 +13693,146 @@
 
 #ifndef PERL_NO_UTF16_FILTER
 static I32
-utf16_textfilter(pTHX_ int idx, SV *sv, int maxlen)
+S_utf16_textfilter(pTHX_ int idx, SV *sv, int maxlen)
 {
     dVAR;
-    const STRLEN old = SvCUR(sv);
-    const I32 count = FILTER_READ(idx+1, sv, maxlen);
+    SV *const filter = FILTER_DATA(idx);
+    /* We re-use this each time round, throwing the contents away before we
+       return.  */
+    SV *const utf16_buffer = MUTABLE_SV(IoTOP_GV(filter));
+    SV *const utf8_buffer = filter;
+    IV status = IoPAGE(filter);
+    const bool reverse = (bool) IoLINES(filter);
+    I32 retval;
+
+    /* As we're automatically added, at the lowest level, and hence only called
+       from this file, we can be sure that we're not called in block mode. Hence
+       don't bother writing code to deal with block mode.  */
+    if (maxlen) {
+	Perl_croak(aTHX_ "panic: utf16_textfilter called in block mode (for %d characters)", maxlen);
+    }
+    if (status < 0) {
+	Perl_croak(aTHX_ "panic: utf16_textfilter called after error (status=%"IVdf")", status);
+    }
     DEBUG_P(PerlIO_printf(Perl_debug_log,
-			  "utf16_textfilter(%p): %d %d (%d)\n",
-			  FPTR2DPTR(void *, utf16_textfilter),
-			  idx, maxlen, (int) count));
-    if (count) {
-	U8* tmps;
+			  "utf16_textfilter(%p,%ce): idx=%d maxlen=%d status=%"IVdf" utf16=%"UVuf" utf8=%"UVuf"\n",
+			  FPTR2DPTR(void *, S_utf16_textfilter),
+			  reverse ? 'l' : 'b', idx, maxlen, status,
+			  (UV)SvCUR(utf16_buffer), (UV)SvCUR(utf8_buffer)));
+
+    while (1) {
+	STRLEN chars;
+	STRLEN have;
 	I32 newlen;
-	Newx(tmps, SvCUR(sv) * 3 / 2 + 1, U8);
-	Copy(SvPVX_const(sv), tmps, old, char);
-	utf16_to_utf8((U8*)SvPVX_const(sv) + old, tmps + old,
-		      SvCUR(sv) - old, &newlen);
-	sv_usepvn(sv, (char*)tmps, (STRLEN)newlen + old);
+	U8 *end;
+	/* First, look in our buffer of existing UTF-8 data:  */
+	char *nl = (char *)memchr(SvPVX(utf8_buffer), '\n', SvCUR(utf8_buffer));
+
+	if (nl) {
+	    ++nl;
+	} else if (status == 0) {
+	    /* EOF */
+	    IoPAGE(filter) = 0;
+	    nl = SvEND(utf8_buffer);
+	}
+	if (nl) {
+	    STRLEN got = nl - SvPVX(utf8_buffer);
+	    /* Did we have anything to append?  */
+	    retval = got != 0;
+	    sv_catpvn(sv, SvPVX(utf8_buffer), got);
+	    /* Everything else in this code works just fine if SVp_POK isn't
+	       set.  This, however, needs it, and we need it to work, else
+	       we loop infinitely because the buffer is never consumed.  */
+	    sv_chop(utf8_buffer, nl);
+	    break;
+	}
+
+	/* OK, not a complete line there, so need to read some more UTF-16.
+	   Read an extra octect if the buffer currently has an odd number. */
+	while (1) {
+	    if (status <= 0)
+		break;
+	    if (SvCUR(utf16_buffer) >= 2) {
+		/* Location of the high octet of the last complete code point.
+		   Gosh, UTF-16 is a pain. All the benefits of variable length,
+		   *coupled* with all the benefits of partial reads and
+		   endianness.  */
+		const U8 *const last_hi = (U8*)SvPVX(utf16_buffer)
+		    + ((SvCUR(utf16_buffer) & ~1) - (reverse ? 1 : 2));
+
+		if (*last_hi < 0xd8 || *last_hi > 0xdb) {
+		    break;
+		}
+
+		/* We have the first half of a surrogate. Read more.  */
+		DEBUG_P(PerlIO_printf(Perl_debug_log, "utf16_textfilter partial surrogate detected at %p\n", last_hi));
+	    }
+
+	    status = FILTER_READ(idx + 1, utf16_buffer,
+				 160 + (SvCUR(utf16_buffer) & 1));
+	    DEBUG_P(PerlIO_printf(Perl_debug_log, "utf16_textfilter status=%"IVdf" SvCUR(sv)=%"UVuf"\n", status, (UV)SvCUR(utf16_buffer)));
+	    DEBUG_P({ sv_dump(utf16_buffer); sv_dump(utf8_buffer);});
+	    if (status < 0) {
+		/* Error */
+		IoPAGE(filter) = status;
+		return status;
+	    }
+	}
+
+	chars = SvCUR(utf16_buffer) >> 1;
+	have = SvCUR(utf8_buffer);
+	SvGROW(utf8_buffer, have + chars * 3 + 1);
+
+	if (reverse) {
+	    end = utf16_to_utf8_reversed((U8*)SvPVX(utf16_buffer),
+					 (U8*)SvPVX_const(utf8_buffer) + have,
+					 chars * 2, &newlen);
+	} else {
+	    end = utf16_to_utf8((U8*)SvPVX(utf16_buffer),
+				(U8*)SvPVX_const(utf8_buffer) + have,
+				chars * 2, &newlen);
+	}
+	SvCUR_set(utf8_buffer, have + newlen);
+	*end = '\0';
+
+	/* No need to keep this SV "well-formed" with a '\0' after the end, as
+	   it's private to us, and utf16_to_utf8{,reversed} take a
+	   (pointer,length) pair, rather than a NUL-terminated string.  */
+	if(SvCUR(utf16_buffer) & 1) {
+	    *SvPVX(utf16_buffer) = SvEND(utf16_buffer)[-1];
+	    SvCUR_set(utf16_buffer, 1);
+	} else {
+	    SvCUR_set(utf16_buffer, 0);
+	}
     }
-    DEBUG_P({sv_dump(sv);});
-    return SvCUR(sv);
+    DEBUG_P(PerlIO_printf(Perl_debug_log,
+			  "utf16_textfilter: returns, status=%"IVdf" utf16=%"UVuf" utf8=%"UVuf"\n",
+			  status,
+			  (UV)SvCUR(utf16_buffer), (UV)SvCUR(utf8_buffer)));
+    DEBUG_P({ sv_dump(utf8_buffer); sv_dump(sv);});
+    return retval;
 }
 
-static I32
-utf16rev_textfilter(pTHX_ int idx, SV *sv, int maxlen)
+static U8 *
+S_add_utf16_textfilter(pTHX_ U8 *const s, bool reversed)
 {
-    dVAR;
-    const STRLEN old = SvCUR(sv);
-    const I32 count = FILTER_READ(idx+1, sv, maxlen);
-    DEBUG_P(PerlIO_printf(Perl_debug_log,
-			  "utf16rev_textfilter(%p): %d %d (%d)\n",
-			  FPTR2DPTR(void *, utf16rev_textfilter),
-			  idx, maxlen, (int) count));
-    if (count) {
-	U8* tmps;
-	I32 newlen;
-	Newx(tmps, SvCUR(sv) * 3 / 2 + 1, U8);
-	Copy(SvPVX_const(sv), tmps, old, char);
-	utf16_to_utf8((U8*)SvPVX_const(sv) + old, tmps + old,
-		      SvCUR(sv) - old, &newlen);
-	sv_usepvn(sv, (char*)tmps, (STRLEN)newlen + old);
+    SV *filter = filter_add(S_utf16_textfilter, NULL);
+
+    IoTOP_GV(filter) = MUTABLE_GV(newSVpvn((char *)s, PL_bufend - (char*)s));
+    sv_setpvs(filter, "");
+    IoLINES(filter) = reversed;
+    IoPAGE(filter) = 1; /* Not EOF */
+
+    /* Sadly, we have to return a valid pointer, come what may, so we have to
+       ignore any error return from this.  */
+    SvCUR_set(PL_linestr, 0);
+    if (FILTER_READ(0, PL_linestr, 0)) {
+	SvUTF8_on(PL_linestr);
+    } else {
+	SvUTF8_on(PL_linestr);
     }
-    DEBUG_P({ sv_dump(sv); });
-    return count;
+    PL_bufend = SvEND(PL_linestr);
+    return (U8*)SvPVX(PL_linestr);
 }
 #endif
 
@@ -12866,7 +13852,7 @@
 */
 
 char *
-Perl_scan_vstring(pTHX_ const char *s, const char *e, SV *sv)
+Perl_scan_vstring(pTHX_ const char *s, const char *const e, SV *sv)
 {
     dVAR;
     const char *pos = s;
@@ -12908,9 +13894,9 @@
 		    const UV orev = rev;
 		    rev += (*end - '0') * mult;
 		    mult *= 10;
-		    if (orev > rev && ckWARN_d(WARN_OVERFLOW))
-			Perl_warner(aTHX_ packWARN(WARN_OVERFLOW),
-				    "Integer overflow in decimal number");
+		    if (orev > rev)
+			Perl_ck_warner_d(aTHX_ packWARN(WARN_OVERFLOW),
+					 "Integer overflow in decimal number");
 		}
 	    }
 #ifdef EBCDIC
@@ -12936,6 +13922,18 @@
 	SvRMAGICAL_on(sv);
     }
     return (char *)s;
+}
+
+int
+Perl_keyword_plugin_standard(pTHX_
+	char *keyword_ptr, STRLEN keyword_len, OP **op_ptr)
+{
+    PERL_ARGS_ASSERT_KEYWORD_PLUGIN_STANDARD;
+    PERL_UNUSED_CONTEXT;
+    PERL_UNUSED_ARG(keyword_ptr);
+    PERL_UNUSED_ARG(keyword_len);
+    PERL_UNUSED_ARG(op_ptr);
+    return KEYWORD_PLUGIN_DECLINE;
 }
 
 /*
Index: src/gnu/usr.bin/perl/universal.c
diff -u src/gnu/usr.bin/perl/universal.c:1.13 src/gnu/usr.bin/perl/universal.c:1.14
--- universal.c:1.13	Mon Oct 12 18:24:22 2009
+++ universal.c	Fri Sep 24 15:06:43 2010
@@ -121,7 +121,7 @@
 */
 
 bool
-Perl_sv_derived_from(pTHX_ SV *sv, const char *name)
+Perl_sv_derived_from(pTHX_ SV *sv, const char *const name)
 {
     dVAR;
     HV *stash;
@@ -157,7 +157,7 @@
 #include "XSUB.h"
 
 bool
-Perl_sv_does(pTHX_ SV *sv, const char *name)
+Perl_sv_does(pTHX_ SV *sv, const char *const name)
 {
     const char *classname;
     bool does_it;
@@ -172,8 +172,10 @@
     SvGETMAGIC(sv);
 
     if (!SvOK(sv) || !(SvROK(sv) || (SvPOK(sv) && SvCUR(sv))
-		|| (SvGMAGICAL(sv) && SvPOKp(sv) && SvCUR(sv))))
+	    || (SvGMAGICAL(sv) && SvPOKp(sv) && SvCUR(sv)))) {
+	LEAVE;
 	return FALSE;
+    }
 
     if (sv_isobject(sv)) {
 	classname = sv_reftype(SvRV(sv),TRUE);
@@ -181,8 +183,10 @@
 	classname = SvPV_nolen(sv);
     }
 
-    if (strEQ(name,classname))
+    if (strEQ(name,classname)) {
+	LEAVE;
 	return TRUE;
+    }
 
     PUSHMARK(SP);
     XPUSHs(sv);
@@ -234,7 +238,6 @@
 XS(XS_Internals_SvREFCNT);
 XS(XS_Internals_hv_clear_placehold);
 XS(XS_PerlIO_get_layers);
-XS(XS_Regexp_DESTROY);
 XS(XS_Internals_hash_seed);
 XS(XS_Internals_rehash_seed);
 XS(XS_Internals_HvREHASH);
@@ -301,7 +304,9 @@
                XS_Internals_hv_clear_placehold, file, "\\%");
     newXSproto("PerlIO::get_layers",
                XS_PerlIO_get_layers, file, "*;@");
-    newXS("Regexp::DESTROY", XS_Regexp_DESTROY, file);
+    /* Providing a Regexp::DESTROY fixes #21347. See test in t/op/ref.t  */
+    CvFILE(newCONSTSUB(get_hv("Regexp::", GV_ADD), "DESTROY", NULL))
+	= (char *)file;
     newXSproto("Internals::hash_seed",XS_Internals_hash_seed, file, "");
     newXSproto("Internals::rehash_seed",XS_Internals_rehash_seed, file, "");
     newXSproto("Internals::HvREHASH", XS_Internals_HvREHASH, file, "\\%");
@@ -541,10 +546,10 @@
 		? HvNAME(SvSTASH(SvRV(ST(0))))
 		: (char *)SvPV_nolen(ST(0));
 
-	if ( items == 1 || vs == &PL_sv_undef ) { /* no param or explicit undef */
+	if ( items == 1 || ! SvOK(vs) ) { /* no param or explicit undef */
 	    /* create empty object */
 	    vs = sv_newmortal();
-	    sv_setpvs(vs,"");
+	    sv_setpvs(vs, "0");
 	}
 	else if ( items == 3 ) {
 	    vs = sv_newmortal();
@@ -654,7 +659,7 @@
 
 	       if ( ! sv_derived_from(robj, "version") )
 	       {
-		    robj = new_version(robj);
+		    robj = new_version(SvOK(robj) ? robj : newSVpvs("0"));
 	       }
 	       rvs = SvRV(robj);
 
@@ -738,7 +743,7 @@
 	SV * ver = ST(0);
 	SV * rv;
 	const char * classname = "";
-	if ( items == 2 && (ST(1)) != &PL_sv_undef ) {
+	if ( items == 2 && SvOK(ST(1)) ) {
 	    /* getting called as object or class method */
 	    ver = ST(1);
 	    classname = 
@@ -789,7 +794,8 @@
      if (items != 1)
 	 croak_xs_usage(cv, "sv");
      else {
-	const SV * const sv = ST(0);
+	SV * const sv = ST(0);
+	SvGETMAGIC(sv);
 	    if (SvUTF8(sv))
 		XSRETURN_YES;
 	    else
@@ -959,12 +965,6 @@
     }
 }
 
-XS(XS_Regexp_DESTROY)
-{
-    PERL_UNUSED_CONTEXT;
-    PERL_UNUSED_ARG(cv);
-}
-
 XS(XS_PerlIO_get_layers)
 {
     dVAR;
@@ -1044,16 +1044,22 @@
 		  const bool flgok = flgsvp && *flgsvp && SvIOK(*flgsvp);
 
 		  if (details) {
+		      /* Indents of 5? Yuck.  */
+		      /* We know that PerlIO_get_layers creates a new SV for
+			 the name and flags, so we can just take a reference
+			 and "steal" it when we free the AV below.  */
 		       XPUSHs(namok
-			      ? sv_2mortal(newSVpvn(SvPVX_const(*namsvp), SvCUR(*namsvp)))
+			      ? sv_2mortal(SvREFCNT_inc_simple_NN(*namsvp))
 			      : &PL_sv_undef);
 		       XPUSHs(argok
-			      ? sv_2mortal(newSVpvn(SvPVX_const(*argsvp), SvCUR(*argsvp)))
+			      ? newSVpvn_flags(SvPVX_const(*argsvp),
+					       SvCUR(*argsvp),
+					       (SvUTF8(*argsvp) ? SVf_UTF8 : 0)
+					       | SVs_TEMP)
+			      : &PL_sv_undef);
+		       XPUSHs(flgok
+			      ? sv_2mortal(SvREFCNT_inc_simple_NN(*flgsvp))
 			      : &PL_sv_undef);
-		       if (flgok)
-			    mXPUSHi(SvIVX(*flgsvp));
-		       else
-			    XPUSHs(&PL_sv_undef);
 		       nitem += 3;
 		  }
 		  else {
@@ -1062,8 +1068,7 @@
 						 SVfARG(*namsvp),
 						 SVfARG(*argsvp))));
 		       else if (namok)
-			    XPUSHs(sv_2mortal(Perl_newSVpvf(aTHX_ "%"SVf,
-						 SVfARG(*namsvp))));
+			   XPUSHs(sv_2mortal(SvREFCNT_inc_simple_NN(*namsvp)));
 		       else
 			    XPUSHs(&PL_sv_undef);
 		       nitem++;
@@ -1364,7 +1369,7 @@
 
     rx = PL_curpm ? PM_GETRE(PL_curpm) : NULL;
 
-    if (!rx)
+    if (!rx || !SvROK(ST(0)))
         XSRETURN_UNDEF;
 
     SP -= items;
@@ -1394,7 +1399,7 @@
 
     rx = PL_curpm ? PM_GETRE(PL_curpm) : NULL;
 
-    if (!rx) {
+    if (!rx || !SvROK(ST(0))) {
         if (!PL_localizing)
             Perl_croak(aTHX_ "%s", PL_no_modify);
         else
@@ -1417,7 +1422,7 @@
     if (items != 2)
 	croak_xs_usage(cv, "$key, $flags");
 
-    if (!rx)
+    if (!rx || !SvROK(ST(0)))
         Perl_croak(aTHX_ "%s", PL_no_modify);
 
     SP -= items;
@@ -1438,7 +1443,7 @@
 
     rx = PL_curpm ? PM_GETRE(PL_curpm) : NULL;
 
-    if (!rx)
+    if (!rx || !SvROK(ST(0)))
         Perl_croak(aTHX_ "%s", PL_no_modify);
 
     SP -= items;
@@ -1460,7 +1465,7 @@
 
     rx = PL_curpm ? PM_GETRE(PL_curpm) : NULL;
 
-    if (!rx)
+    if (!rx || !SvROK(ST(0)))
         XSRETURN_UNDEF;
 
     SP -= items;
@@ -1488,7 +1493,7 @@
 
     rx = PL_curpm ? PM_GETRE(PL_curpm) : NULL;
 
-    if (!rx)
+    if (!rx || !SvROK(ST(0)))
         XSRETURN_UNDEF;
 
     SP -= items;
@@ -1520,7 +1525,7 @@
 
     rx = PL_curpm ? PM_GETRE(PL_curpm) : NULL;
 
-    if (!rx)
+    if (!rx || !SvROK(ST(0)))
         XSRETURN_UNDEF;
 
     SP -= items;
@@ -1551,7 +1556,7 @@
 
     rx = PL_curpm ? PM_GETRE(PL_curpm) : NULL;
 
-    if (!rx)
+    if (!rx || !SvROK(ST(0)))
         XSRETURN_UNDEF;
 
     SP -= items;
Index: src/gnu/usr.bin/perl/util.c
diff -u src/gnu/usr.bin/perl/util.c:1.13 src/gnu/usr.bin/perl/util.c:1.14
--- util.c:1.13	Mon Oct 12 18:24:22 2009
+++ util.c	Fri Sep 24 15:06:43 2010
@@ -369,10 +369,9 @@
 /* copy a string up to some (non-backslashed) delimiter, if any */
 
 char *
-Perl_delimcpy(pTHX_ register char *to, register const char *toend, register const char *from, register const char *fromend, register int delim, I32 *retlen)
+Perl_delimcpy(register char *to, register const char *toend, register const char *from, register const char *fromend, register int delim, I32 *retlen)
 {
     register I32 tolen;
-    PERL_UNUSED_CONTEXT;
 
     PERL_ARGS_ASSERT_DELIMCPY;
 
@@ -400,10 +399,9 @@
 /* This routine was donated by Corey Satten. */
 
 char *
-Perl_instr(pTHX_ register const char *big, register const char *little)
+Perl_instr(register const char *big, register const char *little)
 {
     register I32 first;
-    PERL_UNUSED_CONTEXT;
 
     PERL_ARGS_ASSERT_INSTR;
 
@@ -435,14 +433,13 @@
 /* same as instr but allow embedded nulls */
 
 char *
-Perl_ninstr(pTHX_ const char *big, const char *bigend, const char *little, const char *lend)
+Perl_ninstr(const char *big, const char *bigend, const char *little, const char *lend)
 {
     PERL_ARGS_ASSERT_NINSTR;
-    PERL_UNUSED_CONTEXT;
     if (little >= lend)
         return (char*)big;
     {
-        char first = *little;
+        const char first = *little;
         const char *s, *x;
         bigend -= lend - little++;
     OUTER:
@@ -462,12 +459,11 @@
 /* reverse of the above--find last substring */
 
 char *
-Perl_rninstr(pTHX_ register const char *big, const char *bigend, const char *little, const char *lend)
+Perl_rninstr(register const char *big, const char *bigend, const char *little, const char *lend)
 {
     register const char *bigbeg;
     register const I32 first = *little;
     register const char * const littleend = lend;
-    PERL_UNUSED_CONTEXT;
 
     PERL_ARGS_ASSERT_RNINSTR;
 
@@ -883,11 +879,10 @@
 }
 
 I32
-Perl_ibcmp(pTHX_ const char *s1, const char *s2, register I32 len)
+Perl_ibcmp(const char *s1, const char *s2, register I32 len)
 {
     register const U8 *a = (const U8 *)s1;
     register const U8 *b = (const U8 *)s2;
-    PERL_UNUSED_CONTEXT;
 
     PERL_ARGS_ASSERT_IBCMP;
 
@@ -900,12 +895,11 @@
 }
 
 I32
-Perl_ibcmp_locale(pTHX_ const char *s1, const char *s2, register I32 len)
+Perl_ibcmp_locale(const char *s1, const char *s2, register I32 len)
 {
     dVAR;
     register const U8 *a = (const U8 *)s1;
     register const U8 *b = (const U8 *)s2;
-    PERL_UNUSED_CONTEXT;
 
     PERL_ARGS_ASSERT_IBCMP_LOCALE;
 
@@ -1235,7 +1229,7 @@
 }
 
 void
-Perl_write_to_stderr(pTHX_ const char* message, int msglen)
+Perl_write_to_stderr(pTHX_ SV* msv)
 {
     dVAR;
     IO *io;
@@ -1260,7 +1254,7 @@
 	PUSHMARK(SP);
 	EXTEND(SP,2);
 	PUSHs(SvTIED_obj(MUTABLE_SV(io), mg));
-	mPUSHp(message, msglen);
+	PUSHs(msv);
 	PUTBACK;
 	call_method("PRINT", G_SCALAR);
 
@@ -1274,6 +1268,8 @@
 	dSAVED_ERRNO;
 #endif
 	PerlIO * const serr = Perl_error_log;
+	STRLEN msglen;
+	const char* message = SvPVx_const(msv, msglen);
 
 	PERL_WRITE_MSG_TO_CONSOLE(serr, message, msglen);
 	(void)PerlIO_flush(serr);
@@ -1286,7 +1282,7 @@
 /* Common code used by vcroak, vdie, vwarn and vwarner  */
 
 STATIC bool
-S_vdie_common(pTHX_ const char *message, STRLEN msglen, I32 utf8, bool warn)
+S_vdie_common(pTHX_ SV *message, bool warn)
 {
     dVAR;
     HV *stash;
@@ -1314,7 +1310,7 @@
 	    *hook = NULL;
 	}
 	if (warn || message) {
-	    msg = newSVpvn_flags(message, msglen, utf8);
+	    msg = newSVsv(message);
 	    SvREADONLY_on(msg);
 	    SAVEFREESV(msg);
 	}
@@ -1334,60 +1330,43 @@
     return FALSE;
 }
 
-STATIC const char *
-S_vdie_croak_common(pTHX_ const char* pat, va_list* args, STRLEN* msglen,
-		    I32* utf8)
+STATIC SV *
+S_vdie_croak_common(pTHX_ const char* pat, va_list* args)
 {
     dVAR;
-    const char *message;
+    SV *message;
 
     if (pat) {
 	SV * const msv = vmess(pat, args);
 	if (PL_errors && SvCUR(PL_errors)) {
 	    sv_catsv(PL_errors, msv);
-	    message = SvPV_const(PL_errors, *msglen);
+	    message = sv_mortalcopy(PL_errors);
 	    SvCUR_set(PL_errors, 0);
 	}
 	else
-	    message = SvPV_const(msv,*msglen);
-	*utf8 = SvUTF8(msv);
+	    message = msv;
     }
     else {
 	message = NULL;
     }
 
-    DEBUG_S(PerlIO_printf(Perl_debug_log,
-			  "%p: die/croak: message = %s\ndiehook = %p\n",
-			  (void*)thr, message, (void*)PL_diehook));
     if (PL_diehook) {
-	S_vdie_common(aTHX_ message, *msglen, *utf8, FALSE);
+	S_vdie_common(aTHX_ message, FALSE);
     }
     return message;
 }
 
-OP *
-Perl_vdie(pTHX_ const char* pat, va_list *args)
+static OP *
+S_vdie(pTHX_ const char* pat, va_list *args)
 {
     dVAR;
-    const char *message;
-    const int was_in_eval = PL_in_eval;
-    STRLEN msglen;
-    I32 utf8 = 0;
-
-    DEBUG_S(PerlIO_printf(Perl_debug_log,
-			  "%p: die: curstack = %p, mainstack = %p\n",
-			  (void*)thr, (void*)PL_curstack, (void*)PL_mainstack));
-
-    message = vdie_croak_common(pat, args, &msglen, &utf8);
-
-    PL_restartop = die_where(message, msglen);
-    SvFLAGS(ERRSV) |= utf8;
-    DEBUG_S(PerlIO_printf(Perl_debug_log,
-	  "%p: die: restartop = %p, was_in_eval = %d, top_env = %p\n",
-	  (void*)thr, (void*)PL_restartop, was_in_eval, (void*)PL_top_env));
-    if ((!PL_restartop && was_in_eval) || PL_top_env->je_prev)
-	JMPENV_JUMP(3);
-    return PL_restartop;
+    SV *message;
+
+    message = vdie_croak_common(pat, args);
+
+    die_where(message);
+    /* NOTREACHED */
+    return NULL;
 }
 
 #if defined(PERL_IMPLICIT_CONTEXT)
@@ -1419,22 +1398,11 @@
 Perl_vcroak(pTHX_ const char* pat, va_list *args)
 {
     dVAR;
-    const char *message;
-    STRLEN msglen;
-    I32 utf8 = 0;
-
-    message = S_vdie_croak_common(aTHX_ pat, args, &msglen, &utf8);
-
-    if (PL_in_eval) {
-	PL_restartop = die_where(message, msglen);
-	SvFLAGS(ERRSV) |= utf8;
-	JMPENV_JUMP(3);
-    }
-    else if (!message)
-	message = SvPVx_const(ERRSV, msglen);
+    SV *msv;
+
+    msv = S_vdie_croak_common(aTHX_ pat, args);
 
-    write_to_stderr(message, msglen);
-    my_failure_exit();
+    die_where(msv);
 }
 
 #if defined(PERL_IMPLICIT_CONTEXT)
@@ -1484,19 +1452,16 @@
 Perl_vwarn(pTHX_ const char* pat, va_list *args)
 {
     dVAR;
-    STRLEN msglen;
     SV * const msv = vmess(pat, args);
-    const I32 utf8 = SvUTF8(msv);
-    const char * const message = SvPV_const(msv, msglen);
 
     PERL_ARGS_ASSERT_VWARN;
 
     if (PL_warnhook) {
-	if (vdie_common(message, msglen, utf8, TRUE))
+	if (vdie_common(msv, TRUE))
 	    return;
     }
 
-    write_to_stderr(message, msglen);
+    write_to_stderr(msv);
 }
 
 #if defined(PERL_IMPLICIT_CONTEXT)
@@ -1545,6 +1510,32 @@
 #endif /* PERL_IMPLICIT_CONTEXT */
 
 void
+Perl_ck_warner_d(pTHX_ U32 err, const char* pat, ...)
+{
+    PERL_ARGS_ASSERT_CK_WARNER_D;
+
+    if (Perl_ckwarn_d(aTHX_ err)) {
+	va_list args;
+	va_start(args, pat);
+	vwarner(err, pat, &args);
+	va_end(args);
+    }
+}
+
+void
+Perl_ck_warner(pTHX_ U32 err, const char* pat, ...)
+{
+    PERL_ARGS_ASSERT_CK_WARNER;
+
+    if (Perl_ckwarn(aTHX_ err)) {
+	va_list args;
+	va_start(args, pat);
+	vwarner(err, pat, &args);
+	va_end(args);
+    }
+}
+
+void
 Perl_warner(pTHX_ U32  err, const char* pat,...)
 {
     va_list args;
@@ -1561,21 +1552,12 @@
     PERL_ARGS_ASSERT_VWARNER;
     if (PL_warnhook == PERL_WARNHOOK_FATAL || ckDEAD(err)) {
 	SV * const msv = vmess(pat, args);
-	STRLEN msglen;
-	const char * const message = SvPV_const(msv, msglen);
-	const I32 utf8 = SvUTF8(msv);
 
 	if (PL_diehook) {
-	    assert(message);
-	    S_vdie_common(aTHX_ message, msglen, utf8, FALSE);
+	    assert(msv);
+	    S_vdie_common(aTHX_ msv, FALSE);
 	}
-	if (PL_in_eval) {
-	    PL_restartop = die_where(message, msglen);
-	    SvFLAGS(ERRSV) |= utf8;
-	    JMPENV_JUMP(3);
-	}
-	write_to_stderr(message, msglen);
-	my_failure_exit();
+	die_where(msv);
     }
     else {
 	Perl_vwarn(aTHX_ pat, args);
@@ -1588,26 +1570,11 @@
 Perl_ckwarn(pTHX_ U32 w)
 {
     dVAR;
-    return
-	(
-	       isLEXWARN_on
-	    && PL_curcop->cop_warnings != pWARN_NONE
-	    && (
-		   PL_curcop->cop_warnings == pWARN_ALL
-		|| isWARN_on(PL_curcop->cop_warnings, unpackWARN1(w))
-		|| (unpackWARN2(w) &&
-		     isWARN_on(PL_curcop->cop_warnings, unpackWARN2(w)))
-		|| (unpackWARN3(w) &&
-		     isWARN_on(PL_curcop->cop_warnings, unpackWARN3(w)))
-		|| (unpackWARN4(w) &&
-		     isWARN_on(PL_curcop->cop_warnings, unpackWARN4(w)))
-		)
-	)
-	||
-	(
-	    isLEXWARN_off && PL_dowarn & G_WARN_ON
-	)
-	;
+    /* If lexical warnings have not been set, use $^W.  */
+    if (isLEXWARN_off)
+	return PL_dowarn & G_WARN_ON;
+
+    return ckwarn_common(w);
 }
 
 /* implements the ckWARN?_d macro */
@@ -1616,22 +1583,42 @@
 Perl_ckwarn_d(pTHX_ U32 w)
 {
     dVAR;
-    return
-	   isLEXWARN_off
-	|| PL_curcop->cop_warnings == pWARN_ALL
-	|| (
-	      PL_curcop->cop_warnings != pWARN_NONE 
-	   && (
-		   isWARN_on(PL_curcop->cop_warnings, unpackWARN1(w))
-	      || (unpackWARN2(w) &&
-		   isWARN_on(PL_curcop->cop_warnings, unpackWARN2(w)))
-	      || (unpackWARN3(w) &&
-		   isWARN_on(PL_curcop->cop_warnings, unpackWARN3(w)))
-	      || (unpackWARN4(w) &&
-		   isWARN_on(PL_curcop->cop_warnings, unpackWARN4(w)))
-	      )
-	   )
-	;
+    /* If lexical warnings have not been set then default classes warn.  */
+    if (isLEXWARN_off)
+	return TRUE;
+
+    return ckwarn_common(w);
+}
+
+static bool
+S_ckwarn_common(pTHX_ U32 w)
+{
+    if (PL_curcop->cop_warnings == pWARN_ALL)
+	return TRUE;
+
+    if (PL_curcop->cop_warnings == pWARN_NONE)
+	return FALSE;
+
+    /* Check the assumption that at least the first slot is non-zero.  */
+    assert(unpackWARN1(w));
+
+    /* Check the assumption that it is valid to stop as soon as a zero slot is
+       seen.  */
+    if (!unpackWARN2(w)) {
+	assert(!unpackWARN3(w));
+	assert(!unpackWARN4(w));
+    } else if (!unpackWARN3(w)) {
+	assert(!unpackWARN4(w));
+    }
+	
+    /* Right, dealt with all the special cases, which are implemented as non-
+       pointers, so there is a pointer to a real warnings mask.  */
+    do {
+	if (isWARN_on(PL_curcop->cop_warnings, unpackWARN1(w)))
+	    return TRUE;
+    } while (w >>= WARNshift);
+
+    return FALSE;
 }
 
 /* Set buffer=NULL to get a new one.  */
@@ -1676,9 +1663,16 @@
 #ifndef PERL_USE_SAFE_PUTENV
     if (!PL_use_safe_putenv) {
     /* most putenv()s leak, so we manipulate environ directly */
-    register I32 i=setenv_getix(nam);          /* where does it go? */
+    register I32 i;
+    register const I32 len = strlen(nam);
     int nlen, vlen;
 
+    /* where does it go? */
+    for (i = 0; environ[i]; i++) {
+        if (strnEQ(environ[i],nam,len) && environ[i][len] == '=')
+            break;
+    }
+
     if (environ == PL_origenviron) {   /* need we copy environment? */
        I32 j;
        I32 max;
@@ -1782,30 +1776,6 @@
 
 #endif /* WIN32 || NETWARE */
 
-#ifndef PERL_MICRO
-I32
-Perl_setenv_getix(pTHX_ const char *nam)
-{
-    register I32 i;
-    register const I32 len = strlen(nam);
-
-    PERL_ARGS_ASSERT_SETENV_GETIX;
-    PERL_UNUSED_CONTEXT;
-
-    for (i = 0; environ[i]; i++) {
-	if (
-#ifdef WIN32
-	    strnicmp(environ[i],nam,len) == 0
-#else
-	    strnEQ(environ[i],nam,len)
-#endif
-	    && environ[i][len] == '=')
-	    break;			/* strnEQ must come first to avoid */
-    }					/* potential SEGV's */
-    return i;
-}
-#endif /* !PERL_MICRO */
-
 #endif /* !VMS && !EPOC*/
 
 #ifdef UNLINK_ALL_VERSIONS
@@ -2279,9 +2249,9 @@
 }
 
 PerlIO *
-Perl_my_popen_list(pTHX_ char *mode, int n, SV **args)
+Perl_my_popen_list(pTHX_ const char *mode, int n, SV **args)
 {
-#if (!defined(DOSISH) || defined(HAS_FORK) || defined(AMIGAOS)) && !defined(OS2) && !defined(VMS) && !defined(__OPEN_VM) && !defined(EPOC) && !defined(MACOS_TRADITIONAL) && !defined(NETWARE) && !defined(__LIBCATAMOUNT__)
+#if (!defined(DOSISH) || defined(HAS_FORK) || defined(AMIGAOS)) && !defined(OS2) && !defined(VMS) && !defined(__OPEN_VM) && !defined(EPOC) && !defined(NETWARE) && !defined(__LIBCATAMOUNT__)
     dVAR;
     int p[2];
     register I32 This, that;
@@ -2314,6 +2284,7 @@
 	    }
 	    return NULL;
 	}
+	Perl_ck_warner(aTHX_ packWARN(WARN_PIPE), "Can't fork, trying again in 5 seconds");
 	sleep(5);
     }
     if (pid == 0) {
@@ -2371,9 +2342,7 @@
     else
 	PerlLIO_close(p[that]);		/* close child's end of pipe */
 
-    LOCK_FDPID_MUTEX;
     sv = *av_fetch(PL_fdpid,p[This],TRUE);
-    UNLOCK_FDPID_MUTEX;
     SvUPGRADE(sv,SVt_IV);
     SvIV_set(sv, pid);
     PL_forkprocess = pid;
@@ -2419,7 +2388,7 @@
 }
 
     /* VMS' my_popen() is in VMS.c, same with OS/2. */
-#if (!defined(DOSISH) || defined(HAS_FORK) || defined(AMIGAOS)) && !defined(VMS) && !defined(__OPEN_VM) && !defined(EPOC) && !defined(MACOS_TRADITIONAL) && !defined(__LIBCATAMOUNT__)
+#if (!defined(DOSISH) || defined(HAS_FORK) || defined(AMIGAOS)) && !defined(VMS) && !defined(__OPEN_VM) && !defined(EPOC) && !defined(__LIBCATAMOUNT__)
 PerlIO *
 Perl_my_popen(pTHX_ const char *cmd, const char *mode)
 {
@@ -2459,9 +2428,10 @@
 		PerlLIO_close(pp[1]);
 	    }
 	    if (!doexec)
-		Perl_croak(aTHX_ "Can't fork");
+		Perl_croak(aTHX_ "Can't fork: %s", Strerror(errno));
 	    return NULL;
 	}
+	Perl_ck_warner(aTHX_ packWARN(WARN_PIPE), "Can't fork, trying again in 5 seconds");
 	sleep(5);
     }
     if (pid == 0) {
@@ -2539,9 +2509,7 @@
     else
 	PerlLIO_close(p[that]);
 
-    LOCK_FDPID_MUTEX;
     sv = *av_fetch(PL_fdpid,p[This],TRUE);
-    UNLOCK_FDPID_MUTEX;
     SvUPGRADE(sv,SVt_IV);
     SvIV_set(sv, pid);
     PL_forkprocess = pid;
@@ -2668,7 +2636,7 @@
 
 #ifdef DUMP_FDS
 void
-Perl_dump_fds(pTHX_ char *s)
+Perl_dump_fds(pTHX_ const char *const s)
 {
     int fd;
     Stat_t tmpstatbuf;
@@ -2722,11 +2690,6 @@
 #ifndef PERL_MICRO
 #ifdef HAS_SIGACTION
 
-#ifdef MACOS_TRADITIONAL
-/* We don't want restart behavior on MacOS */
-#undef SA_RESTART
-#endif
-
 Sighandler_t
 Perl_rsignal(pTHX_ int signo, Sighandler_t handler)
 {
@@ -2877,7 +2840,7 @@
 #endif /* !PERL_MICRO */
 
     /* VMS' my_pclose() is in VMS.c; same with OS/2 */
-#if (!defined(DOSISH) || defined(HAS_FORK) || defined(AMIGAOS)) && !defined(VMS) && !defined(__OPEN_VM) && !defined(EPOC) && !defined(MACOS_TRADITIONAL) && !defined(__LIBCATAMOUNT__)
+#if (!defined(DOSISH) || defined(HAS_FORK) || defined(AMIGAOS)) && !defined(VMS) && !defined(__OPEN_VM) && !defined(EPOC) && !defined(__LIBCATAMOUNT__)
 I32
 Perl_my_pclose(pTHX_ PerlIO *ptr)
 {
@@ -2890,9 +2853,7 @@
     bool close_failed;
     dSAVEDERRNO;
 
-    LOCK_FDPID_MUTEX;
     svp = av_fetch(PL_fdpid,PerlIO_fileno(ptr),TRUE);
-    UNLOCK_FDPID_MUTEX;
     pid = (SvTYPE(*svp) == SVt_IV) ? SvIVX(*svp) : -1;
     SvREFCNT_dec(*svp);
     *svp = &PL_sv_undef;
@@ -2935,7 +2896,7 @@
 #endif
 #endif /* !DOSISH */
 
-#if  (!defined(DOSISH) || defined(OS2) || defined(WIN32) || defined(NETWARE)) && !defined(MACOS_TRADITIONAL) && !defined(__LIBCATAMOUNT__)
+#if  (!defined(DOSISH) || defined(OS2) || defined(WIN32) || defined(NETWARE)) && !defined(__LIBCATAMOUNT__)
 I32
 Perl_wait4pid(pTHX_ Pid_t pid, int *statusp, int flags)
 {
@@ -3022,7 +2983,7 @@
 
 #ifdef PERL_USES_PL_PIDSTATUS
 void
-Perl_pidgone(pTHX_ Pid_t pid, int status)
+S_pidgone(pTHX_ Pid_t pid, int status)
 {
     register SV *sv;
 
@@ -3066,26 +3027,36 @@
 }
 #endif
 
+#define PERL_REPEATCPY_LINEAR 4
 void
-Perl_repeatcpy(pTHX_ register char *to, register const char *from, I32 len, register I32 count)
+Perl_repeatcpy(register char *to, register const char *from, I32 len, register I32 count)
 {
-    register I32 todo;
-    register const char * const frombase = from;
-    PERL_UNUSED_CONTEXT;
-
     PERL_ARGS_ASSERT_REPEATCPY;
 
-    if (len == 1) {
-	register const char c = *from;
-	while (count-- > 0)
-	    *to++ = c;
-	return;
-    }
-    while (count-- > 0) {
-	for (todo = len; todo > 0; todo--) {
-	    *to++ = *from++;
+    if (len == 1)
+	memset(to, *from, count);
+    else if (count) {
+	register char *p = to;
+	I32 items, linear, half;
+
+	linear = count < PERL_REPEATCPY_LINEAR ? count : PERL_REPEATCPY_LINEAR;
+	for (items = 0; items < linear; ++items) {
+	    register const char *q = from;
+	    I32 todo;
+	    for (todo = len; todo > 0; todo--)
+		*p++ = *q++;
+        }
+
+	half = count / 2;
+	while (items <= half) {
+	    I32 size = items * len;
+	    memcpy(p, to, size);
+	    p     += size;
+	    items *= 2;
 	}
-	from = frombase;
+
+	if (count > items)
+	    memcpy(p, to, (count - items) * len);
     }
 }
 
@@ -3253,26 +3224,16 @@
     }
 #endif
 
-#ifdef MACOS_TRADITIONAL
-    if (dosearch && !strchr(scriptname, ':') &&
-	(s = PerlEnv_getenv("Commands")))
-#else
     if (dosearch && !strchr(scriptname, '/')
 #ifdef DOSISH
 		 && !strchr(scriptname, '\\')
 #endif
 		 && (s = PerlEnv_getenv("PATH")))
-#endif
     {
 	bool seen_dot = 0;
 
 	bufend = s + strlen(s);
 	while (s < bufend) {
-#ifdef MACOS_TRADITIONAL
-	    s = delimcpy(tmpbuf, tmpbuf + sizeof tmpbuf, s, bufend,
-			',',
-			&len);
-#else
 #if defined(atarist) || defined(DOSISH)
 	    for (len = 0; *s
 #  ifdef atarist
@@ -3289,17 +3250,12 @@
 			':',
 			&len);
 #endif /* ! (atarist || DOSISH) */
-#endif /* MACOS_TRADITIONAL */
 	    if (s < bufend)
 		s++;
 	    if (len + 1 + strlen(scriptname) + MAX_EXT_LEN >= sizeof tmpbuf)
 		continue;	/* don't search dir with too-long name */
-#ifdef MACOS_TRADITIONAL
-	    if (len && tmpbuf[len - 1] != ':')
-	    	tmpbuf[len++] = ':';
-#else
 	    if (len
-#  if defined(atarist) || defined(__MINT__) || defined(DOSISH)
+#  if defined(atarist) || defined(DOSISH)
 		&& tmpbuf[len - 1] != '/'
 		&& tmpbuf[len - 1] != '\\'
 #  endif
@@ -3307,7 +3263,6 @@
 		tmpbuf[len++] = '/';
 	    if (len == 2 && tmpbuf[0] == '.')
 		seen_dot = 1;
-#endif
 	    (void)my_strlcpy(tmpbuf + len, scriptname, sizeof(tmpbuf) - len);
 #endif  /* !VMS */
 
@@ -3332,7 +3287,7 @@
 		continue;
 	    if (S_ISREG(PL_statbuf.st_mode)
 		&& cando(S_IRUSR,TRUE,&PL_statbuf)
-#if !defined(DOSISH) && !defined(MACOS_TRADITIONAL)
+#if !defined(DOSISH)
 		&& cando(S_IXUSR,TRUE,&PL_statbuf)
 #endif
 		)
@@ -4226,6 +4181,210 @@
 }
 
 #define VERSION_MAX 0x7FFFFFFF
+
+/*
+=for apidoc prescan_version
+
+=cut
+*/
+const char *
+Perl_prescan_version(pTHX_ const char *s, bool strict,
+		     const char **errstr,
+		     bool *sqv, int *ssaw_decimal, int *swidth, bool *salpha) {
+    bool qv = (sqv ? *sqv : FALSE);
+    int width = 3;
+    int saw_decimal = 0;
+    bool alpha = FALSE;
+    const char *d = s;
+
+    PERL_ARGS_ASSERT_PRESCAN_VERSION;
+
+    if (qv && isDIGIT(*d))
+	goto dotted_decimal_version;
+
+    if (*d == 'v') { /* explicit v-string */
+	d++;
+	if (isDIGIT(*d)) {
+	    qv = TRUE;
+	}
+	else { /* degenerate v-string */
+	    /* requires v1.2.3 */
+	    BADVERSION(s,errstr,"Invalid version format (dotted-decimal versions require at least three parts)");
+	}
+
+dotted_decimal_version:
+	if (strict && d[0] == '0' && isDIGIT(d[1])) {
+	    /* no leading zeros allowed */
+	    BADVERSION(s,errstr,"Invalid version format (no leading zeros)");
+	}
+
+	while (isDIGIT(*d)) 	/* integer part */
+	    d++;
+
+	if (*d == '.')
+	{
+	    saw_decimal++;
+	    d++; 		/* decimal point */
+	}
+	else
+	{
+	    if (strict) {
+		/* require v1.2.3 */
+		BADVERSION(s,errstr,"Invalid version format (dotted-decimal versions require at least three parts)");
+	    }
+	    else {
+		goto version_prescan_finish;
+	    }
+	}
+
+	{
+	    int i = 0;
+	    int j = 0;
+	    while (isDIGIT(*d)) {	/* just keep reading */
+		i++;
+		while (isDIGIT(*d)) {
+		    d++; j++;
+		    /* maximum 3 digits between decimal */
+		    if (strict && j > 3) {
+			BADVERSION(s,errstr,"Invalid version format (maximum 3 digits between decimals)");
+		    }
+		}
+		if (*d == '_') {
+		    if (strict) {
+			BADVERSION(s,errstr,"Invalid version format (no underscores)");
+		    }
+		    if ( alpha ) {
+			BADVERSION(s,errstr,"Invalid version format (multiple underscores)");
+		    }
+		    d++;
+		    alpha = TRUE;
+		}
+		else if (*d == '.') {
+		    if (alpha) {
+			BADVERSION(s,errstr,"Invalid version format (underscores before decimal)");
+		    }
+		    saw_decimal++;
+		    d++;
+		}
+		else if (!isDIGIT(*d)) {
+		    break;
+		}
+		j = 0;
+	    }
+
+	    if (strict && i < 2) {
+		/* requires v1.2.3 */
+		BADVERSION(s,errstr,"Invalid version format (dotted-decimal versions require at least three parts)");
+	    }
+	}
+    } 					/* end if dotted-decimal */
+    else
+    {					/* decimal versions */
+	/* special strict case for leading '.' or '0' */
+	if (strict) {
+	    if (*d == '.') {
+		BADVERSION(s,errstr,"Invalid version format (0 before decimal required)");
+	    }
+	    if (*d == '0' && isDIGIT(d[1])) {
+		BADVERSION(s,errstr,"Invalid version format (no leading zeros)");
+	    }
+	}
+
+	/* consume all of the integer part */
+	while (isDIGIT(*d))
+	    d++;
+
+	/* look for a fractional part */
+	if (*d == '.') {
+	    /* we found it, so consume it */
+	    saw_decimal++;
+	    d++;
+	}
+	else if (!*d || *d == ';' || isSPACE(*d) || *d == '}') {
+	    if ( d == s ) {
+		/* found nothing */
+		BADVERSION(s,errstr,"Invalid version format (version required)");
+	    }
+	    /* found just an integer */
+	    goto version_prescan_finish;
+	}
+	else if ( d == s ) {
+	    /* didn't find either integer or period */
+	    BADVERSION(s,errstr,"Invalid version format (non-numeric data)");
+	}
+	else if (*d == '_') {
+	    /* underscore can't come after integer part */
+	    if (strict) {
+		BADVERSION(s,errstr,"Invalid version format (no underscores)");
+	    }
+	    else if (isDIGIT(d[1])) {
+		BADVERSION(s,errstr,"Invalid version format (alpha without decimal)");
+	    }
+	    else {
+		BADVERSION(s,errstr,"Invalid version format (misplaced underscore)");
+	    }
+	}
+	else {
+	    /* anything else after integer part is just invalid data */
+	    BADVERSION(s,errstr,"Invalid version format (non-numeric data)");
+	}
+
+	/* scan the fractional part after the decimal point*/
+
+	if (!isDIGIT(*d) && (strict || ! (!*d || *d == ';' || isSPACE(*d) || *d == '}') )) {
+		/* strict or lax-but-not-the-end */
+		BADVERSION(s,errstr,"Invalid version format (fractional part required)");
+	}
+
+	while (isDIGIT(*d)) {
+	    d++;
+	    if (*d == '.' && isDIGIT(d[-1])) {
+		if (alpha) {
+		    BADVERSION(s,errstr,"Invalid version format (underscores before decimal)");
+		}
+		if (strict) {
+		    BADVERSION(s,errstr,"Invalid version format (dotted-decimal versions must begin with 'v')");
+		}
+		d = (char *)s; 		/* start all over again */
+		qv = TRUE;
+		goto dotted_decimal_version;
+	    }
+	    if (*d == '_') {
+		if (strict) {
+		    BADVERSION(s,errstr,"Invalid version format (no underscores)");
+		}
+		if ( alpha ) {
+		    BADVERSION(s,errstr,"Invalid version format (multiple underscores)");
+		}
+		if ( ! isDIGIT(d[1]) ) {
+		    BADVERSION(s,errstr,"Invalid version format (misplaced underscore)");
+		}
+		d++;
+		alpha = TRUE;
+	    }
+	}
+    }
+
+version_prescan_finish:
+    while (isSPACE(*d))
+	d++;
+
+    if (!isDIGIT(*d) && (! (!*d || *d == ';' || *d == '}') )) {
+	/* trailing non-numeric data */
+	BADVERSION(s,errstr,"Invalid version format (non-numeric data)");
+    }
+
+    if (sqv)
+	*sqv = qv;
+    if (swidth)
+	*swidth = width;
+    if (ssaw_decimal)
+	*ssaw_decimal = saw_decimal;
+    if (salpha)
+	*salpha = alpha;
+    return d;
+}
+
 /*
 =for apidoc scan_version
 
@@ -4254,9 +4413,10 @@
     const char *start;
     const char *pos;
     const char *last;
-    int saw_period = 0;
-    int alpha = 0;
+    const char *errstr = NULL;
+    int saw_decimal = 0;
     int width = 3;
+    bool alpha = FALSE;
     bool vinf = FALSE;
     AV * const av = newAV();
     SV * const hv = newSVrv(rv, "version"); /* create an SV and upgrade the RV */
@@ -4265,54 +4425,24 @@
 
     (void)sv_upgrade(hv, SVt_PVHV); /* needs to be an HV type */
 
+#ifndef NODEFAULT_SHAREKEYS
+    HvSHAREKEYS_on(hv);         /* key-sharing on by default */
+#endif
+
     while (isSPACE(*s)) /* leading whitespace is OK */
 	s++;
 
-    start = last = s;
-
-    if (*s == 'v') {
-	s++;  /* get past 'v' */
-	qv = 1; /* force quoted version processing */
-    }
-
-    pos = s;
-
-    /* pre-scan the input string to check for decimals/underbars */
-    while ( *pos == '.' || *pos == '_' || *pos == ',' || isDIGIT(*pos) )
-    {
-	if ( *pos == '.' )
-	{
-	    if ( alpha )
-		Perl_croak(aTHX_ "Invalid version format (underscores before decimal)");
-	    saw_period++ ;
-	    last = pos;
-	}
-	else if ( *pos == '_' )
-	{
-	    if ( alpha )
-		Perl_croak(aTHX_ "Invalid version format (multiple underscores)");
-	    alpha = 1;
-	    width = pos - last - 1; /* natural width of sub-version */
+    last = prescan_version(s, FALSE, &errstr, &qv, &saw_decimal, &width, &alpha);
+    if (errstr) {
+	/* "undef" is a special case and not an error */
+	if ( ! ( *s == 'u' && strEQ(s,"undef")) ) {
+	    Perl_croak(aTHX_ "%s", errstr);
 	}
-	else if ( *pos == ',' && isDIGIT(pos[1]) )
-	{
-	    saw_period++ ;
-	    last = pos;
-	}
-
-	pos++;
     }
 
-    if ( alpha && !saw_period )
-	Perl_croak(aTHX_ "Invalid version format (alpha without decimal)");
-
-    if ( alpha && saw_period && width == 0 )
-	Perl_croak(aTHX_ "Invalid version format (misplaced _ in number)");
-
-    if ( saw_period > 1 )
-	qv = 1; /* force quoted version processing */
-
-    last = pos;
+    start = s;
+    if (*s == 'v')
+	s++;
     pos = s;
 
     if ( qv )
@@ -4339,7 +4469,7 @@
 		 * point of a version originally created with a bare
 		 * floating point number, i.e. not quoted in any way
 		 */
- 		if ( !qv && s > start && saw_period == 1 ) {
+		if ( !qv && s > start && saw_decimal == 1 ) {
 		    mult *= 100;
  		    while ( s < end ) {
 			orev = rev;
@@ -4347,9 +4477,8 @@
  			mult /= 10;
 			if (   (PERL_ABS(orev) > PERL_ABS(rev)) 
 			    || (PERL_ABS(rev) > VERSION_MAX )) {
-			    if(ckWARN(WARN_OVERFLOW))
-				Perl_warner(aTHX_ packWARN(WARN_OVERFLOW), 
-				"Integer overflow in version %d",VERSION_MAX);
+			    Perl_ck_warner(aTHX_ packWARN(WARN_OVERFLOW), 
+					   "Integer overflow in version %d",VERSION_MAX);
 			    s = end - 1;
 			    rev = VERSION_MAX;
 			    vinf = 1;
@@ -4366,9 +4495,8 @@
  			mult *= 10;
 			if (   (PERL_ABS(orev) > PERL_ABS(rev)) 
 			    || (PERL_ABS(rev) > VERSION_MAX )) {
-			    if(ckWARN(WARN_OVERFLOW))
-				Perl_warner(aTHX_ packWARN(WARN_OVERFLOW), 
-				"Integer overflow in version");
+			    Perl_ck_warner(aTHX_ packWARN(WARN_OVERFLOW), 
+					   "Integer overflow in version");
 			    end = s - 1;
 			    rev = VERSION_MAX;
 			    vinf = 1;
@@ -4431,7 +4559,7 @@
     }
     else if ( s > start ) {
 	SV * orig = newSVpvn(start,s-start);
-	if ( qv && saw_period == 1 && *start != 'v' ) {
+	if ( qv && saw_decimal == 1 && *start != 'v' ) {
 	    /* need to insert a v to be consistent */
 	    sv_insert(orig, 0, 0, "v", 1);
 	}
@@ -4480,6 +4608,9 @@
 	/* This will get reblessed later if a derived class*/
 	SV * const hv = newSVrv(rv, "version"); 
 	(void)sv_upgrade(hv, SVt_PVHV); /* needs to be an HV type */
+#ifndef NODEFAULT_SHAREKEYS
+	HvSHAREKEYS_on(hv);         /* key-sharing on by default */
+#endif
 
 	if ( SvROK(ver) )
 	    ver = SvRV(ver);
@@ -4522,7 +4653,7 @@
 	    char * const version = savepvn( (const char*)mg->mg_ptr, len);
 	    sv_setpvn(rv,version,len);
 	    /* this is for consistency with the pure Perl class */
-	    if ( *version != 'v' ) 
+	    if ( isDIGIT(*version) )
 		sv_insert(rv, 0, 0, "v", 1);
 	    Safefree(version);
 	}
@@ -4577,7 +4708,7 @@
 #ifdef SvVOK
     else if ( (mg = SvVSTRING_mg(ver)) ) { /* already a v-string */
 	version = savepvn( (const char*)mg->mg_ptr,mg->mg_len );
-	qv = 1;
+	qv = TRUE;
     }
 #endif
     else /* must be a string or something like a string */
@@ -4587,12 +4718,14 @@
 #ifndef SvVOK
 #  if PERL_VERSION > 5
 	/* This will only be executed for 5.6.0 - 5.8.0 inclusive */
-	if ( len == 3 && !instr(version,".") && !instr(version,"_") ) {
+	if ( len >= 3 && !instr(version,".") && !instr(version,"_")
+	    && !(*version == 'u' && strEQ(version, "undef"))
+	    && (*version < '0' || *version > '9') ) {
 	    /* may be a v-string */
 	    SV * const nsv = sv_newmortal();
 	    const char *nver;
 	    const char *pos;
-	    int saw_period = 0;
+	    int saw_decimal = 0;
 	    sv_setpvf(nsv,"v%vd",ver);
 	    pos = nver = savepv(SvPV_nolen(nsv));
 
@@ -4600,12 +4733,12 @@
 	    pos++; /* skip the leading 'v' */
 	    while ( *pos == '.' || isDIGIT(*pos) ) {
 		if ( *pos == '.' )
-		    saw_period++ ;
+		    saw_decimal++ ;
 		pos++;
 	    }
 
 	    /* is definitely a v-string */
-	    if ( saw_period == 2 ) {	
+	    if ( saw_decimal >= 2 ) {
 		Safefree(version);
 		version = nver;
 	    }
@@ -4616,10 +4749,9 @@
 
     s = scan_version(version, ver, qv);
     if ( *s != '\0' ) 
-	if(ckWARN(WARN_MISC))
-	    Perl_warner(aTHX_ packWARN(WARN_MISC), 
-		"Version string '%s' contains invalid data; "
-		"ignoring: '%s'", version, s);
+	Perl_ck_warner(aTHX_ packWARN(WARN_MISC), 
+		       "Version string '%s' contains invalid data; "
+		       "ignoring: '%s'", version, s);
     Safefree(version);
     return ver;
 }
@@ -4687,7 +4819,7 @@
     I32 i, len, digit;
     int width;
     bool alpha = FALSE;
-    SV * const sv = newSV(0);
+    SV *sv;
     AV *av;
 
     PERL_ARGS_ASSERT_VNUMIFY;
@@ -4709,19 +4841,17 @@
 
     /* attempt to retrieve the version array */
     if ( !(av = MUTABLE_AV(SvRV(*hv_fetchs(MUTABLE_HV(vs), "version", FALSE))) ) ) {
-	sv_catpvs(sv,"0");
-	return sv;
+	return newSVpvs("0");
     }
 
     len = av_len(av);
     if ( len == -1 )
     {
-	sv_catpvs(sv,"0");
-	return sv;
+	return newSVpvs("0");
     }
 
     digit = SvIV(*av_fetch(av, 0, 0));
-    Perl_sv_setpvf(aTHX_ sv, "%d.", (int)PERL_ABS(digit));
+    sv = Perl_newSVpvf(aTHX_ "%d.", (int)PERL_ABS(digit));
     for ( i = 1 ; i < len ; i++ )
     {
 	digit = SvIV(*av_fetch(av, i, 0));
@@ -4768,7 +4898,7 @@
 {
     I32 i, len, digit;
     bool alpha = FALSE;
-    SV * const sv = newSV(0);
+    SV *sv;
     AV *av;
 
     PERL_ARGS_ASSERT_VNORMAL;
@@ -4786,11 +4916,10 @@
     len = av_len(av);
     if ( len == -1 )
     {
-	sv_catpvs(sv,"");
-	return sv;
+	return newSVpvs("");
     }
     digit = SvIV(*av_fetch(av, 0, 0));
-    Perl_sv_setpvf(aTHX_ sv, "v%"IVdf, (IV)digit);
+    sv = Perl_newSVpvf(aTHX_ "v%"IVdf, (IV)digit);
     for ( i = 1 ; i < len ; i++ ) {
 	digit = SvIV(*av_fetch(av, i, 0));
 	Perl_sv_catpvf(aTHX_ sv, ".%"IVdf, (IV)digit);
@@ -4827,7 +4956,6 @@
 SV *
 Perl_vstringify(pTHX_ SV *vs)
 {
-
     PERL_ARGS_ASSERT_VSTRINGIFY;
 
     if ( SvROK(vs) )
@@ -5415,7 +5543,7 @@
 	   * help.  Sum in another random number that will
 	   * fill in the low bits. */
 	  myseed +=
-	       (UV)(Drand01() * (NV)((1 << ((UVSIZE * 8 - RANDBITS))) - 1));
+	       (UV)(Drand01() * (NV)((((UV)1) << ((UVSIZE * 8 - RANDBITS))) - 1));
 #endif /* RANDBITS < (UVSIZE * 8) */
 	  if (myseed == 0) { /* Superparanoia. */
 	      myseed = (UV)(Drand01() * (NV)UV_MAX); /* One more chance. */
@@ -5529,38 +5657,35 @@
 
 #ifdef PERL_MEM_LOG
 
-/*
- * PERL_MEM_LOG: the Perl_mem_log_..() will be compiled.
+/* -DPERL_MEM_LOG: the Perl_mem_log_..() is compiled, including the
+ * the default implementation, unless -DPERL_MEM_LOG_NOIMPL is also
+ * given, and you supply your own implementation.
  *
- * PERL_MEM_LOG_ENV: if defined, during run time the environment
- * variables PERL_MEM_LOG and PERL_SV_LOG will be consulted, and
- * if the integer value of that is true, the logging will happen.
- * (The default is to always log if the PERL_MEM_LOG define was
- * in effect.)
+ * The default implementation reads a single env var, PERL_MEM_LOG,
+ * expecting one or more of the following:
  *
- * PERL_MEM_LOG_TIMESTAMP: if defined, a timestamp will be logged
- * before every memory logging entry. This can be turned off at run
- * time by setting the environment variable PERL_MEM_LOG_TIMESTAMP
- * to zero.
+ *    \d+ - fd		fd to write to		: must be 1st (atoi)
+ *    'm' - memlog	was PERL_MEM_LOG=1
+ *    's' - svlog	was PERL_SV_LOG=1
+ *    't' - timestamp	was PERL_MEM_LOG_TIMESTAMP=1
+ *
+ * This makes the logger controllable enough that it can reasonably be
+ * added to the system perl.
  */
 
-/*
- * PERL_MEM_LOG_SPRINTF_BUF_SIZE: size of a (stack-allocated) buffer
+/* -DPERL_MEM_LOG_SPRINTF_BUF_SIZE=X: size of a (stack-allocated) buffer
  * the Perl_mem_log_...() will use (either via sprintf or snprintf).
  */
 #define PERL_MEM_LOG_SPRINTF_BUF_SIZE 128
 
-/*
- * PERL_MEM_LOG_FD: the file descriptor the Perl_mem_log_...() will
- * log to.  You can also define in compile time PERL_MEM_LOG_ENV_FD,
- * in which case the environment variable PERL_MEM_LOG_FD will be
- * consulted for the file descriptor number to use.
+/* -DPERL_MEM_LOG_FD=N: the file descriptor the Perl_mem_log_...()
+ * writes to.  In the default logger, this is settable at runtime.
  */
 #ifndef PERL_MEM_LOG_FD
 #  define PERL_MEM_LOG_FD 2 /* If STDERR is too boring for you. */
 #endif
 
-#ifdef PERL_MEM_LOG_STDERR
+#ifndef PERL_MEM_LOG_NOIMPL
 
 # ifdef DEBUG_LEAKING_SCALARS
 #   define SV_LOG_SERIAL_FMT	    " [%lu]"
@@ -5571,23 +5696,25 @@
 # endif
 
 static void
-S_mem_log_common(enum mem_log_type mlt, const UV n, const UV typesize, const char *type_name, const SV *sv, Malloc_t oldalloc, Malloc_t newalloc, const char *filename, const int linenumber, const char *funcname)
+S_mem_log_common(enum mem_log_type mlt, const UV n, 
+		 const UV typesize, const char *type_name, const SV *sv,
+		 Malloc_t oldalloc, Malloc_t newalloc,
+		 const char *filename, const int linenumber,
+		 const char *funcname)
 {
-# if defined(PERL_MEM_LOG_ENV) || defined(PERL_MEM_LOG_ENV_FD)
-    const char *s;
-# endif
+    const char *pmlenv;
 
     PERL_ARGS_ASSERT_MEM_LOG_COMMON;
 
-# ifdef PERL_MEM_LOG_ENV
-    s = PerlEnv_getenv(mlt < MLT_NEW_SV ? "PERL_MEM_LOG" : "PERL_SV_LOG");
-    if (s ? atoi(s) : 0)
-# endif
+    pmlenv = PerlEnv_getenv("PERL_MEM_LOG");
+    if (!pmlenv)
+	return;
+    if (mlt < MLT_NEW_SV ? strchr(pmlenv,'m') : strchr(pmlenv,'s'))
     {
 	/* We can't use SVs or PerlIO for obvious reasons,
 	 * so we'll use stdio and low-level IO instead. */
 	char buf[PERL_MEM_LOG_SPRINTF_BUF_SIZE];
-# ifdef PERL_MEM_LOG_TIMESTAMP
+
 #   ifdef HAS_GETTIMEOFDAY
 #     define MEM_LOG_TIME_FMT	"%10d.%06d: "
 #     define MEM_LOG_TIME_ARG	(int)tv.tv_sec, (int)tv.tv_usec
@@ -5603,24 +5730,17 @@
 	 * gettimeofday() (see ext/Time-HiRes), the easiest way is
 	 * probably that they would be used to fill in the struct
 	 * timeval. */
-# endif
 	{
-	    int fd = PERL_MEM_LOG_FD;
 	    STRLEN len;
+	    int fd = atoi(pmlenv);
+	    if (!fd)
+		fd = PERL_MEM_LOG_FD;
 
-# ifdef PERL_MEM_LOG_ENV_FD
-	    if ((s = PerlEnv_getenv("PERL_MEM_LOG_FD"))) {
-		fd = atoi(s);
-	    }
-# endif
-# ifdef PERL_MEM_LOG_TIMESTAMP
-	    s = PerlEnv_getenv("PERL_MEM_LOG_TIMESTAMP");
-	    if (!s || atoi(s)) {
+	    if (strchr(pmlenv, 't')) {
 		len = my_snprintf(buf, sizeof(buf),
 				MEM_LOG_TIME_FMT, MEM_LOG_TIME_ARG);
 		PerlLIO_write(fd, buf, len);
 	    }
-# endif
 	    switch (mlt) {
 	    case MLT_ALLOC:
 		len = my_snprintf(buf, sizeof(buf),
@@ -5651,54 +5771,78 @@
 			filename, linenumber, funcname,
 			PTR2UV(sv) _SV_LOG_SERIAL_ARG(sv));
 		break;
+	    default:
+		len = 0;
 	    }
 	    PerlLIO_write(fd, buf, len);
 	}
     }
 }
+#endif /* !PERL_MEM_LOG_NOIMPL */
+
+#ifndef PERL_MEM_LOG_NOIMPL
+# define \
+    mem_log_common_if(alty, num, tysz, tynm, sv, oal, nal, flnm, ln, fnnm) \
+    mem_log_common   (alty, num, tysz, tynm, sv, oal, nal, flnm, ln, fnnm)
+#else
+/* this is suboptimal, but bug compatible.  User is providing their
+   own implemenation, but is getting these functions anyway, and they
+   do nothing. But _NOIMPL users should be able to cope or fix */
+# define \
+    mem_log_common_if(alty, num, tysz, tynm, u, oal, nal, flnm, ln, fnnm) \
+    /* mem_log_common_if_PERL_MEM_LOG_NOIMPL */
 #endif
 
 Malloc_t
-Perl_mem_log_alloc(const UV n, const UV typesize, const char *type_name, Malloc_t newalloc, const char *filename, const int linenumber, const char *funcname)
-{
-#ifdef PERL_MEM_LOG_STDERR
-    mem_log_common(MLT_ALLOC, n, typesize, type_name, NULL, NULL, newalloc, filename, linenumber, funcname);
-#endif
+Perl_mem_log_alloc(const UV n, const UV typesize, const char *type_name,
+		   Malloc_t newalloc, 
+		   const char *filename, const int linenumber,
+		   const char *funcname)
+{
+    mem_log_common_if(MLT_ALLOC, n, typesize, type_name,
+		      NULL, NULL, newalloc,
+		      filename, linenumber, funcname);
     return newalloc;
 }
 
 Malloc_t
-Perl_mem_log_realloc(const UV n, const UV typesize, const char *type_name, Malloc_t oldalloc, Malloc_t newalloc, const char *filename, const int linenumber, const char *funcname)
-{
-#ifdef PERL_MEM_LOG_STDERR
-    mem_log_common(MLT_REALLOC, n, typesize, type_name, NULL, oldalloc, newalloc, filename, linenumber, funcname);
-#endif
+Perl_mem_log_realloc(const UV n, const UV typesize, const char *type_name,
+		     Malloc_t oldalloc, Malloc_t newalloc, 
+		     const char *filename, const int linenumber, 
+		     const char *funcname)
+{
+    mem_log_common_if(MLT_REALLOC, n, typesize, type_name,
+		      NULL, oldalloc, newalloc, 
+		      filename, linenumber, funcname);
     return newalloc;
 }
 
 Malloc_t
-Perl_mem_log_free(Malloc_t oldalloc, const char *filename, const int linenumber, const char *funcname)
+Perl_mem_log_free(Malloc_t oldalloc, 
+		  const char *filename, const int linenumber, 
+		  const char *funcname)
 {
-#ifdef PERL_MEM_LOG_STDERR
-    mem_log_common(MLT_FREE, 0, 0, "", NULL, oldalloc, NULL, filename, linenumber, funcname);
-#endif
+    mem_log_common_if(MLT_FREE, 0, 0, "", NULL, oldalloc, NULL, 
+		      filename, linenumber, funcname);
     return oldalloc;
 }
 
 void
-Perl_mem_log_new_sv(const SV *sv, const char *filename, const int linenumber, const char *funcname)
+Perl_mem_log_new_sv(const SV *sv, 
+		    const char *filename, const int linenumber,
+		    const char *funcname)
 {
-#ifdef PERL_MEM_LOG_STDERR
-    mem_log_common(MLT_NEW_SV, 0, 0, "", sv, NULL, NULL, filename, linenumber, funcname);
-#endif
+    mem_log_common_if(MLT_NEW_SV, 0, 0, "", sv, NULL, NULL,
+		      filename, linenumber, funcname);
 }
 
 void
-Perl_mem_log_del_sv(const SV *sv, const char *filename, const int linenumber, const char *funcname)
+Perl_mem_log_del_sv(const SV *sv,
+		    const char *filename, const int linenumber, 
+		    const char *funcname)
 {
-#ifdef PERL_MEM_LOG_STDERR
-    mem_log_common(MLT_DEL_SV, 0, 0, "", sv, NULL, NULL, filename, linenumber, funcname);
-#endif
+    mem_log_common_if(MLT_DEL_SV, 0, 0, "", sv, NULL, NULL, 
+		      filename, linenumber, funcname);
 }
 
 #endif /* PERL_MEM_LOG */
@@ -5870,9 +6014,13 @@
     PERL_ARGS_ASSERT_MY_CXT_INIT;
     if (*index == -1) {
 	/* this module hasn't been allocated an index yet */
+#if defined(USE_ITHREADS)
 	MUTEX_LOCK(&PL_my_ctx_mutex);
+#endif
 	*index = PL_my_cxt_index++;
+#if defined(USE_ITHREADS)
 	MUTEX_UNLOCK(&PL_my_ctx_mutex);
+#endif
     }
     
     /* make sure the array is big enough */
@@ -5927,9 +6075,13 @@
     index = Perl_my_cxt_index(aTHX_ my_cxt_key);
     if (index == -1) {
 	/* this module hasn't been allocated an index yet */
+#if defined(USE_ITHREADS)
 	MUTEX_LOCK(&PL_my_ctx_mutex);
+#endif
 	index = PL_my_cxt_index++;
+#if defined(USE_ITHREADS)
 	MUTEX_UNLOCK(&PL_my_ctx_mutex);
+#endif
     }
 
     /* make sure the array is big enough */
@@ -6059,19 +6211,14 @@
 
 REGEXP *
 Perl_get_re_arg(pTHX_ SV *sv) {
-    SV    *tmpsv;
-    MAGIC *mg;
 
     if (sv) {
         if (SvMAGICAL(sv))
             mg_get(sv);
-        if (SvROK(sv) &&
-            (tmpsv = MUTABLE_SV(SvRV(sv))) &&            /* assign deliberate */
-            SvTYPE(tmpsv) == SVt_PVMG &&
-            (mg = mg_find(tmpsv, PERL_MAGIC_qr))) /* assign deliberate */
-        {
-            return (REGEXP *)mg->mg_obj;
-        }
+        if (SvROK(sv))
+	    sv = MUTABLE_SV(SvRV(sv));
+        if (SvTYPE(sv) == SVt_REGEXP)
+            return (REGEXP*) sv;
     }
  
     return NULL;
Index: src/gnu/usr.bin/perl/util.h
diff -u src/gnu/usr.bin/perl/util.h:1.10 src/gnu/usr.bin/perl/util.h:1.11
--- util.h:1.10	Mon Oct 12 18:24:22 2009
+++ util.h	Fri Sep 24 15:06:43 2010
@@ -32,11 +32,7 @@
 	(*(f) == '/'							\
 	 || ((f)[0] && (f)[1] == ':'))		/* drive name */
 #    else	/* NEITHER DOSISH NOR EPOCISH NOR SYMBIANISH */
-#      ifdef MACOS_TRADITIONAL
-#        define PERL_FILE_IS_ABSOLUTE(f)	(strchr(f, ':') && *(f) != ':')
-#      else /* !MACOS_TRADITIONAL */
-#        define PERL_FILE_IS_ABSOLUTE(f)	(*(f) == '/')
-#      endif /* MACOS_TRADITIONAL */
+#      define PERL_FILE_IS_ABSOLUTE(f)	(*(f) == '/')
 #    endif	/* DOSISH */
 #   endif	/* NETWARE */
 #  endif	/* WIN32 */
Index: src/gnu/usr.bin/perl/Cross/README
diff -u src/gnu/usr.bin/perl/Cross/README:1.5 src/gnu/usr.bin/perl/Cross/README:1.6
--- Cross/README:1.5	Mon Sep 29 17:36:00 2008
+++ Cross/README	Fri Sep 24 15:06:43 2010
@@ -84,4 +84,3 @@
 ----------
 Redvers Davies <red@criticalintegration.com>
 Open Zaurus http://www.openzaurus.org/
-Perl OZ Packages http://www.criticalintegration.com/perl-oz/
Index: src/gnu/usr.bin/perl/Porting/Glossary
diff -u src/gnu/usr.bin/perl/Porting/Glossary:1.10 src/gnu/usr.bin/perl/Porting/Glossary:1.11
--- Porting/Glossary:1.10	Mon Oct 12 18:24:22 2009
+++ Porting/Glossary	Fri Sep 24 15:06:44 2010
@@ -150,6 +150,11 @@
 	is most often a local directory such as /usr/local/bin. Programs using
 	this variable must be prepared to deal with ~name substitution.
 
+bin_ELF (dlsrc.U):
+	This variable saves the result from configure if generated binaries
+	are in ELF format. Only set to defined when the test has actually
+	been performed, and the result was positive.
+
 binexp (bin.U):
 	This is the same as the bin variable, but is filename expanded at
 	configuration time, for use in your makefiles.
@@ -244,6 +249,14 @@
 	Holds the output of the "date" command when the configuration file was
 	produced. This is used to tag both config.sh and config_h.SH.
 
+charbits (charsize.U):
+	This variable contains the value of the CHARBITS symbol, which
+	indicates to the C program how many bits there are in a character.
+
+charsize (charsize.U):
+	This variable contains the value of the CHARSIZE symbol, which
+	indicates to the C program how many bytes there are in a character.
+
 chgrp (Loc.U):
 	This variable is defined but not used by Configure.
 	The value is the empty string and is not useful.
@@ -271,6 +284,23 @@
 	This variable is defined but not used by Configure.
 	The value is the empty string and is not useful.
 
+config_arg0 (Options.U):
+	This variable contains the string used to invoke the Configure
+	command, as reported by the shell in the $0 variable.
+
+config_argc (Options.U):
+	This variable countains the number of command-line arguments
+	passed to Configure, as reported by the shell in the $# variable.
+	The individual arguments are stored as variables config_argc1,
+	config_argc2, etc.
+
+config_args (Options.U):
+	This variable contains a single string giving the command-line
+	arguments passed to Configure.	Spaces within arguments,
+	quotes, and escaped characters are not correctly preserved.
+	To reconstruct the command line, you must assemble the individual
+	command line pieces, given in config_arg[0-9]*.
+
 contains (contains.U):
 	This variable holds the command to do a grep with a proper return
 	status.  On most sane systems it is simply "grep".  On insane systems
@@ -5065,6 +5095,11 @@
 uvXUformat (perlxvf.U):
 	This variable contains the format string used for printing
 	a Perl UV as an unsigned hexadecimal integer in uppercase ABCDEF.
+
+vaproto (vaproto.U):
+	This variable conditionally defines CAN_VAPROTO on systems supporting
+	prototype declaration of functions with a variable number of
+	arguments. See also prototype.
 
 vendorarch (vendorarch.U):
 	This variable contains the value of the PERL_VENDORARCH symbol.
Index: src/gnu/usr.bin/perl/Porting/Maintainers.pl
diff -u src/gnu/usr.bin/perl/Porting/Maintainers.pl:1.1 src/gnu/usr.bin/perl/Porting/Maintainers.pl:1.2
--- Porting/Maintainers.pl:1.1	Wed Dec  3 02:44:29 2003
+++ Porting/Maintainers.pl	Fri Sep 24 15:06:44 2010
@@ -8,558 +8,1988 @@
 
 package Maintainers;
 
+use File::Glob qw(:case);
+
 %Maintainers =
-	(
-	'abergman'	=> 'Arthur Bergman <abergman@cpan.org>',
-	'ams'		=> 'Abhijit Menon-Sen <ams@cpan.org>',
-	'andk'		=> 'Andreas J. Koenig <andk@cpan.org>',
-	'bbb'		=> 'Rob Brown <bbb@cpan.org>',
-	'craig'		=> 'Craig Berry <craigberry@mac.com>',
-	'dankogai'	=> 'Dan Kogai <dankogai@cpan.org>',
-	'dconway'	=> 'Damian Conway <dconway@cpan.org>',
-	'drolsky'	=> 'Dave Rolsky <drolsky@cpan.org>',
-	'elizabeth'	=> 'Elizabeth Mattijsen <liz@dijkmat.nl>',
-	'gbarr'		=> 'Graham Barr <gbarr@cpan.org>',
-	'gaas'		=> 'Gisle Aas <gaas@cpan.org>',
-	'gsar'		=> 'Gurusamy Sarathy <gsar@activestate.com>',
-	'ilyam'		=> 'Ilya Martynov <ilyam@cpan.org>',
-	'ilyaz'		=> 'Ilya Zakharevich <ilyaz@cpan.org>',
-	'jhi'		=> 'Jarkko Hietaniemi <jhi@cpan.org>',
-	'jstowe'	=> 'Jonathan Stowe <jstowe@cpan.org>',
-	'jv'		=> 'Johan Vromans <jv@cpan.org>',
-	'kwilliams'	=> 'Ken Williams <kwilliams@cpan.org>',
-	'laun'		=> 'Wolfgang Laun <Wolfgang.Laun@alcatel.at>',
-	'lstein'	=> 'Lincoln D. Stein <lds@cpan.org>',
-	'marekr'	=> 'Marek Rouchal <marekr@cpan.org>',
-	'mjd'		=> 'Mark-Jason Dominus <mjd@cpan.org>',
-	'muir'		=> 'David Muir Sharnoff <muir@cpan.org>',
-	'neilb'		=> 'Neil Bowers <neilb@cpan.org>',
-	'ni-s'		=> 'Nick Ing-Simmons <nick@ing-simmons.net>',
-	'p5p'		=> 'perl5-porters <perl5-porters@perl.org>',
-	'perlfaq'	=> 'perlfaq-workers <perlfaq-workers@perl.org>',
-	'perlref'	=> 'Mark-Jason Dominus <mjd@cpan.org>',
-	'petdance'	=> 'Andy Lester <petdance@cpan.org>',
-	'pmqs'		=> 'Paul Marquess <pmqs@cpan.org>',
-	'pvhp'		=> 'Peter Prymmer <pvhp@best.com>',
-	'rmbarker'	=> 'Robin Barker <rmbarker@cpan.org>',
-	'rra'		=> 'Russ Allbery <rra@cpan.org>',
-	'sadahiro'	=> 'SADAHIRO Tomoyuki <SADAHIRO@cpan.org>',
-	'sburke'	=> 'Sean Burke <sburke@cpan.org>',
-	'mschwern'	=> 'Michael Schwern <mschwern@cpan.org>',
-	'smccam'	=> 'Stephen McCamant <smccam@cpan.org>',
-	'tels'		=> 'perl_dummy a-t bloodgate.com',
-	'tjenness'	=> 'Tim Jenness <tjenness@cpan.org>'
-	);
-
-# The FILES is either filenames, or glob patterns, or directory
-# names to be recursed down.  The CPAN can be either 1 (get the
-# latest one from CPAN) or 0 (there is no valid CPAN release).
+    (
+    'abergman'	=> 'Arthur Bergman <abergman@cpan.org>',
+    'abigail'	=> 'Abigail <abigail@abigail.be>',
+    'ams'	=> 'Abhijit Menon-Sen <ams@cpan.org>',
+    'andk'	=> 'Andreas J. Koenig <andk@cpan.org>',
+    'andya'	=> 'Andy Armstrong <andy@hexten.net>',
+    'arandal'	=> 'Allison Randal <allison@perl.org>',
+    'audreyt'	=> 'Audrey Tang <cpan@audreyt.org>',
+    'avar'	=> 'var Arnfjr Bjarmason <avar@cpan.org>',
+    'bingos'	=> 'Chris Williams <chris@bingosnet.co.uk>',
+    'chorny'	=> 'Alexandr Ciornii <alexchorny@gmail.com>',
+    'corion'	=> 'Max Maischein <corion@corion.net>',
+    'craig'	=> 'Craig Berry <craigberry@mac.com>',
+    'dankogai'	=> 'Dan Kogai <dankogai@cpan.org>',
+    'dconway'	=> 'Damian Conway <dconway@cpan.org>',
+    'dland'	=> 'David Landgren <dland@cpan.org>',
+    'dmanura'	=> 'David Manura <dmanura@cpan.org>',
+    'drolsky'	=> 'Dave Rolsky <drolsky@cpan.org>',
+    'elizabeth'	=> 'Elizabeth Mattijsen <liz@dijkmat.nl>',
+    'ferreira'	=> 'Adriano Ferreira <ferreira@cpan.org>',
+    'gbarr'	=> 'Graham Barr <gbarr@cpan.org>',
+    'gaas'	=> 'Gisle Aas <gaas@cpan.org>',
+    'gsar'	=> 'Gurusamy Sarathy <gsar@activestate.com>',
+    'ilyam'	=> 'Ilya Martynov <ilyam@cpan.org>',
+    'ilyaz'	=> 'Ilya Zakharevich <ilyaz@cpan.org>',
+    'jand'	=> 'Jan Dubois <jand@activestate.com>',
+    'jdhedden'	=> 'Jerry D. Hedden <jdhedden@cpan.org>',
+    'jesse'   	=> 'Jesse Vincent <jesse@bestpractical.com>',
+    'jhi'	=> 'Jarkko Hietaniemi <jhi@cpan.org>',
+    'jjore'	=> 'Joshua ben Jore <jjore@cpan.org>',
+    'jpeacock'	=> 'John Peacock <jpeacock@cpan.org>',
+    'jstowe'	=> 'Jonathan Stowe <jstowe@cpan.org>',
+    'jv'	=> 'Johan Vromans <jv@cpan.org>',
+    'kane'	=> 'Jos Boumans <kane@cpan.org>',
+    'kwilliams'	=> 'Ken Williams <kwilliams@cpan.org>',
+    'laun'	=> 'Wolfgang Laun <Wolfgang.Laun@alcatel.at>',
+    'lstein'	=> 'Lincoln D. Stein <lds@cpan.org>',
+    'lwall'	=> 'Larry Wall <lwall@cpan.org>',
+    'marekr'	=> 'Marek Rouchal <marekr@cpan.org>',
+    'markm'	=> 'Mark Mielke <markm@cpan.org>',
+    'mhx'	=> 'Marcus Holland-Moritz <mhx@cpan.org>',
+    'mjd'	=> 'Mark-Jason Dominus <mjd@plover.com>',
+    'msergeant'	=> 'Matt Sergeant <msergeant@cpan.org>',
+    'mshelor'	=> 'Mark Shelor <mshelor@cpan.org>',
+    'muir'	=> 'David Muir Sharnoff <muir@cpan.org>',
+    'neilb'	=> 'Neil Bowers <neilb@cpan.org>',
+    'nuffin'	=> 'Yuval Kogman <nothingmuch@woobling.org>',
+    'nwclark'	=> 'Nicholas Clark <nwclark@cpan.org>',
+    'osfameron'	=> 'Hakim Cassimally <osfameron@perl.org>',
+    'p5p'	=> 'perl5-porters <perl5-porters@perl.org>',
+    'perlfaq'	=> 'perlfaq-workers <perlfaq-workers@perl.org>',
+    'petdance'	=> 'Andy Lester <andy@petdance.com>',
+    'pjf'	=> 'Paul Fenwick <pjf@cpan.org>',
+    'pmqs'	=> 'Paul Marquess <pmqs@cpan.org>',
+    'pvhp'	=> 'Peter Prymmer <pvhp@best.com>',
+    'rafl'	=> 'Florian Ragwitz <flora@cpan.org>',
+    'rclamp'	=> 'Richard Clamp <rclamp@cpan.org>',
+    'rgarcia'	=> 'Rafael Garcia-Suarez <rgarcia@cpan.org>',
+    'rkobes'	=> 'Randy Kobes <rkobes@cpan.org>',
+    'rmbarker'	=> 'Robin Barker <rmbarker@cpan.org>',
+    'rra'	=> 'Russ Allbery <rra@cpan.org>',
+    'rurban'	=> 'Reini Urban <rurban@cpan.org>',
+    'sadahiro'	=> 'SADAHIRO Tomoyuki <SADAHIRO@cpan.org>',
+    'salva'	=> 'Salvador Fandio Garca <salva@cpan.org>',
+    'saper'	=> 'Sbastien Aperghis-Tramoni <saper@cpan.org>',
+    'sbeck'     => 'Sullivan Beck <sbeck@cpan.org>',
+    'sburke'	=> 'Sean Burke <sburke@cpan.org>',
+    'mschwern'	=> 'Michael Schwern <mschwern@cpan.org>',
+    'simonw'	=> 'Simon Wistow <simonw@cpan.org>',
+    'smccam'	=> 'Stephen McCamant <smccam@cpan.org>',
+    'smpeters'	=> 'Steve Peters <steve@fisharerojo.org>',
+    'smueller'	=> 'Steffen Mueller <smueller@cpan.org>',
+    'tels'	=> 'Tels <nospam-abuse@bloodgate.com>',
+    'tomhughes'	=> 'Tom Hughes <tomhughes@cpan.org>',
+    'tjenness'	=> 'Tim Jenness <tjenness@cpan.org>',
+    'tyemq'	=> 'Tye McQueen <tyemq@cpan.org>',
+    'yves'	=> 'Yves Orton <yves@cpan.org>',
+    'zefram'	=> 'Andrew Main <zefram@cpan.org>',
+    );
+
+
+# IGNORABLE: files which, if they appear in the root of a CPAN
+# distribution, need not appear in core (i.e. core-cpan-diff won't
+# complain if it can't find them)
+
+@IGNORABLE = qw(
+    .cvsignore .dualLivedDiffConfig .gitignore
+    ANNOUNCE Announce Artistic AUTHORS BENCHMARK BUGS Build.PL
+    CHANGELOG ChangeLog CHANGES Changes COPYING Copying CREDITS
+    GOALS HISTORY INSTALL INSTALL.SKIP LICENSE Makefile.PL
+    MANIFEST MANIFEST.SKIP META.yml MYMETA.yml NEW NOTES ppport.h README
+    SIGNATURE THANKS TODO Todo VERSION WHATSNEW
+);
+
+
+# Each entry in the  %Modules hash roughly represents a distribution,
+# except in the case of CPAN=1, where it *exactly* represents a single
+# CPAN distribution.
+
+# The keys of %Modules are human descriptions of the distributions, and
+# may not exactly match a module or distribution name. Distributions
+# which have an obvious top-level module associated with them will usually
+# have a key named for that module, e.g. 'Archive::Extract' for
+# Archive-Extract-N.NN.tar.gz; the remaining keys are likely to be based
+# on the name of the distribution, e.g. 'Locale-Codes' for
+# Locale-Codes-N.NN.tar.gz'.
+#
+# FILES is a list of filenames, glob patterns, and directory
+# names to be recursed down, which collectively generate a complete list
+# of the files associated with the distribution.
+
+# CPAN can be either 1 (this distribution is also available on CPAN),
+# or 0 (there is no # valid CPAN release).
+
+# UPSTREAM indicates where patches should go. undef implies
+# that this hasn't been discussed for the module at hand.
+# "blead" indicates that the copy of the module in the blead
+# sources is to be considered canonical, "cpan" means that the
+# module on CPAN is to be patched first. "first-come" means
+# that blead can be patched freely if it is in sync with the
+# latest release on CPAN.
+
+# BUGS is an email or url to post bug reports.  For modules with
+# UPSTREAM => 'blead', use perl5-porters@perl.org.  rt.cpan.org
+# appears to automatically provide a URL for CPAN modules; any value
+# given here overrides the default:
+# http://rt.cpan.org/Public/Dist/Display.html?Name=$ModuleName
+
+# DISTRIBUTION names the tarball on CPAN which (allegedly) the files
+# included in core are derived from. Note that the file's version may not
+# necessarily match the newest version on CPAN.
+
+# EXCLUDED is a list of files to be excluded from a CPAN tarball before
+# comparing the remaining contents with core. Each item can either be a
+# full pathname (eg 't/foo.t') or a pattern (e.g. qr{^t/}).
+# It defaults to the empty list.
+
+# DEPRECATED contains the *first* version of Perl in which the module
+# was considered deprecated.  It should only be present if the module is
+# actually deprecated.  Such modules should use deprecated.pm to
+# issue a warning if used.  E.g.:
+#
+#     use if $] >= 5.011, 'deprecate';
+#
+
+# MAP is a hash that maps CPAN paths to their core equivalents.
+# Each key reprepresents a string prefix, with longest prefixes checked
+# first. The first match causes that prefix to be replaced with the
+# corresponding key. For example, with the following MAP:
+#   {
+#     'lib/'	 => 'lib/',
+#     ''	 => 'lib/Foo/',
+#   },
+#
+# these files are mapped as shown:
+#
+#    README     becomes lib/Foo/README
+#    lib/Foo.pm becomes lib/Foo.pm
+#
+# The default is dependent on the type of module.
+# For distributions which appear to be stored under ext/, it defaults to:
+#
+#   { '' => 'ext/Foo-Bar/' }
+#
+# otherwise, it's
+#
+#   {
+#     'lib/'	 => 'lib/',
+#     ''	 => 'lib/Foo/Bar/',
+#   }
 
 %Modules = (
 
-	'Attribute::Handlers' =>
-		{
-		'MAINTAINER'	=> 'abergman',
-		'FILES'		=> q[lib/Attribute/Handlers.pm
-				     lib/Attribute/Handlers],
-		'CPAN'		=> 1,
-		},
-
-	'B::Concise' =>
-		{
-		'MAINTAINER'	=> 'smccam',
-		'FILES'		=> q[ext/B/B/Concise.pm ext/B/t/concise.t],
-		'CPAN'		=> 0,
-		},
-
-	'B::Deparse' =>
-		{
-		'MAINTAINER'	=> 'smccam',
-		'FILES'		=> q[ext/B/B/Deparse.pm ext/B/t/deparse.t],
-		'CPAN'		=> 0,
-		},
-
-	'bignum' =>
-		{
-		'MAINTAINER'	=> 'tels',
-		'FILES'		=> q[lib/big{int,num,rat}.pm lib/bignum],
-		'CPAN'		=> 1,
-		},
-
-	'CGI' =>
-		{
-		'MAINTAINER'	=> 'lstein',
-		'FILES'		=> q[lib/CGI.pm lib/CGI],
-		'CPAN'		=> 1,
-		},
-
-	'Class::ISA' =>
-		{
-		'MAINTAINER'	=> 'sburke',
-		'FILES'		=> q[lib/Class/ISA.pm lib/Class/ISA],
-		'CPAN'		=> 1,
-		},
-
-	'CPAN' =>
-		{
-		'MAINTAINER'	=> 'andk',
-		'FILES'		=> q[lib/CPAN.pm lib/CPAN],
-		'CPAN'		=> 1,
-		},
-
-	'Data::Dumper' =>
-		{
-		'MAINTAINER'	=> 'ilyam', # Not gsar.
-		'FILES'		=> q[ext/Data/Dumper],
-		'CPAN'		=> 1,
-		},
-
-	'DB::File' =>
-		{
-		'MAINTAINER'	=> 'pmqs',
-		'FILES'		=> q[ext/DB_File],
-		'CPAN'		=> 1,
-		},
-
-	'Devel::PPPort' =>
-		{
-		'MAINTAINER'	=> 'pmqs',
-		'FILES'		=> q[ext/Devel/PPPort],
-		'CPAN'		=> 1,
-		},
-
-	'Digest' =>
-		{
-		'MAINTAINER'	=> 'gaas',
-		'FILES'		=> q[lib/Digest.{pm,t}],
-		'CPAN'		=> 1,
-		},
-
-	'Digest::MD5' =>
-		{
-		'MAINTAINER'	=> 'gaas',
-		'FILES'		=> q[ext/Digest/MD5],
-		'CPAN'		=> 1,
-		},
-
-	'Encode' =>
-		{
-		'MAINTAINER'	=> 'dankogai',
-		'FILES'		=> q[ext/Encode],
-		'CPAN'		=> 1,
-		},
-
-	'Errno' =>
-		{
-		'MAINTAINER'	=> 'p5p', # Not gbarr.
-		'FILES'		=> q[ext/Errno],
-		'CPAN'		=> 0,
-		},
-
-	'ExtUtils::MakeMaker' =>
-		{
-		'MAINTAINER'	=> 'mschwern',
-		'FILES'		=> q[lib/ExtUtils/{Command,Install,Installed,Liblist,MakeMaker,Manifest,Mkbootstrap,Mksymlists,MM*,MY,Packlist,testlib}.pm lib/ExtUtils/{Command,Liblist,MakeMaker}
-				     lib/ExtUtils/t t/lib/MakeMaker t/lib/TieIn.pm t/lib/TieOut.pm],
-		'CPAN'		=> 1,
-		},
-
-	'faq' =>
-		{
-		'MAINTAINER'	=> 'perlfaq',
-		'FILES'		=> q[pod/perlfaq*],
-		'CPAN'		=> 0,
-		},
-
-	'File::Spec' =>
-		{
-		'MAINTAINER'	=> 'kwilliams',
-		'FILES'		=> q[lib/File/Spec.pm lib/File/Spec],
-		'CPAN'		=> 1,
-		},
-
-	'File::Temp' =>
-		{
-		'MAINTAINER'	=> 'tjenness',
-		'FILES'		=> q[lib/File/Temp.pm lib/File/Temp],
-		'CPAN'		=> 1,
-		},
-
-	'Filter::Simple' =>
-		{
-		'MAINTAINER'	=> 'dconway',
-		'FILES'		=> q[lib/Filter/Simple.pm lib/Filter/Simple
-				     t/lib/Filter/Simple],
-		'CPAN'		=> 1,
-		},
-
-	'Filter::Util::Call' =>
-		{
-		'MAINTAINER'	=> 'pmqs',
-		'FILES'		=> q[ext/Filter/Util/Call ext/Filter/t/call.t
-				     t/lib/filter-util.pl],
-		'CPAN'		=> 1,
-		},
-
-	'Getopt::Long' =>
-		{
-		'MAINTAINER'	=> 'jv',
-		'FILES'		=> q[lib/Getopt/Long.pm lib/Getopt/Long],
-		'CPAN'		=> 1,
-		},
-
-	'I18N::LangTags' =>
-		{
-		'MAINTAINER'	=> 'sburke',
-		'FILES'		=> q[lib/I18N/LangTags.pm lib/I18N/LangTags],
-		'CPAN'		=> 1,
-		},
-
-	'if' =>
-		{
-		'MAINTAINER'	=> 'ilyaz',
-		'FILES'		=> q[lib/if.{pm,t}],
-		'CPAN'		=> 1,
-		},
-
-	'IO' =>
-		{
-		'MAINTAINER'	=> 'p5p', # Not gbarr.
-		'FILES'		=> q[ext/IO],
-		'CPAN'		=> 0,
-		},
-
-	'libnet' =>
-		{
-		'MAINTAINER'	=> 'gbarr',
-		'FILES'		=>
-			q[lib/Net/{Cmd,Config,Domain,FTP,Netrc,NNTP,POP3,SMTP,Time}.pm lib/Net/ChangeLog.libnet lib/Net/FTP lib/Net/*.eg lib/Net/libnetFAQ.pod lib/Net/README.libnet lib/Net/t],
-		'CPAN'		=> 1,
-		},
-
-	'Scalar-List-Utils' =>
-		{
-		'MAINTAINER'	=> 'gbarr',
-		'FILES'		=> q[ext/List/Util],
-		'CPAN'		=> 1,
-		},
-
-	'Locale::Codes' =>
-		{
-		'MAINTAINER'	=> 'neilb',
-		'FILES'		=> q[lib/Locale/{Codes,Constants,Country,Currency,Language,Script}*],
-		'CPAN'		=> 1,
-		},
-
-	'Locale::Maketext' =>
-		{
-		'MAINTAINER'	=> 'sburke',
-		'FILES'		=> q[lib/Locale/Maketext.pm lib/Locale/Maketext],
-		'CPAN'		=> 1,
-		},
-
-	'Math::BigFloat' =>
-		{
-		'MAINTAINER'	=> 'tels',
-		'FILES'		=> q[lib/Math/BigFloat.pm lib/Math/BigFloat],
-		'CPAN'		=> 1,
-		},
-
-	'Math::BigInt' =>
-		{
-		'MAINTAINER'	=> 'tels',
-		'FILES'		=> q[lib/Math/BigInt.pm lib/Math/BigInt
-				     t/lib/Math],
-		'CPAN'		=> 1,
-		},
-
-	'Math::BigRat' =>
-		{
-		'MAINTAINER'	=> 'tels',
-		'FILES'		=> q[lib/Math/BigRat.pm lib/Math/BigRat],
-		'CPAN'		=> 1,
-		},
-
-	'Memoize' =>
-		{
-		'MAINTAINER'	=> 'mjd',
-		'FILES'		=> q[lib/Memoize.pm lib/Memoize],
-		'CPAN'		=> 1,
-		},
-
-	'MIME::Base64' =>
-		{
-		'MAINTAINER'	=> 'gaas',
-		'FILES'		=> q[ext/MIME/Base64],
-		'CPAN'		=> 1,
-		},
-
-	'Net::Ping' =>
-		{
-		'MAINTAINER'	=> 'bbb',
-		'FILES'		=> q[lib/Net/Ping.pm lib/Net/Ping],
-		'CPAN'		=> 1,
-		},
-
-	'NEXT' =>
-		{
-		'MAINTAINER'	=> 'dconway',
-		'FILES'		=> q[lib/NEXT.pm lib/NEXT],
-		'CPAN'		=> 1,
-		},
-
-	'perlebcdic' =>
-		{
-		'MAINTAINER'	=> 'pvhp',
-		'FILES'		=> q[pod/perlebcdic.pod],
-		'CPAN'		=> 0,
-		},
-
-	'PerlIO' =>
-		{
-		'MAINTAINER'	=> 'p5p',
-		'FILES'		=> q[ext/PerlIO],
-		'CPAN'		=> 1,
-		},
-
-	'perlio-doc' =>
-		{
-		'MAINTAINER'	=> 'ni-s',
-		'FILES'		=> q[pod/perlapio.pod
-				     pod/perliol.pod
-				     lib/PerlIO.pm],
-		'CPAN'		=> 0,
-		},
-
-	'PerlIO::via::QuotedPrint' =>
-		{
-		'MAINTAINER'	=> 'elizabeth',
-		'FILES'		=> q[lib/PerlIO/via/QuotedPrint.pm
-				     lib/PerlIO/via/t/QuotedPrint.t],
-		'CPAN'		=> 1,
-		},
-
-	'perlref' =>
-		{
-		'MAINTAINER'	=> 'mjd',
-		'FILES'		=> q[pod/perlref.pod],
-		'CPAN'		=> 0,
-		},
-
-	'perlpacktut' =>
-		{
-		'MAINTAINER'	=> 'laun',
-		'FILES'		=> q[pod/perlpacktut.pod],
-		'CPAN'		=> 0,
-		},
-
-	'perlpodspec' =>
-		{
-		'MAINTAINER'	=> 'sburke',
-		'FILES'		=> q[pod/perlpodspec.pod],
-		'CPAN'		=> 0,
-		},
-
-	'perlthrtut' =>
-		{
-		'MAINTAINER'	=> 'elizabeth',
-		'FILES'		=> q[pod/perlthrtut.pod],
-		'CPAN'		=> 0,
-		},
-
-	'PodParser' => {
-		'MAINTAINER'	=> 'marekr',
-		'FILES' => q[lib/Pod/{InputObjects,Parser,ParseUtils,Select,PlainText,Usage,Checker,Find}.pm pod/pod{select,2usage,checker}.PL t/pod/testcmp.pl t/pod/testp2pt.pl t/pod/testpchk.pl t/pod/emptycmd.* t/pod/find.t t/pod/for.* t/pod/headings.* t/pod/include.* t/pod/included.* t/pod/lref.* t/pod/multiline_items.* t/pod/nested_items.* t/pod/nested_seqs.* t/pod/oneline_cmds.* t/pod/poderrs.* t/pod/pod2usage.* t/pod/podselect.* t/pod/special_seqs.*],
-		'CPAN'		=> 1,
-		},
-
-	'Pod::LaTeX' =>
-		{
-		'MAINTAINER'	=> 'tjenness',
-		'FILES'		=> q[lib/Pod/LaTeX.pm lib/Pod/t/pod2latex.t],
-		'CPAN'		=> 1,
-		},
-
-	'podlators' =>
-		{
-		'MAINTAINER'	=> 'rra',
-		'FILES'		=> q[lib/Pod/{Html,Man,ParseLink,Text,Text/{Color,Overstrike,Termcap}}.pm pod/pod2man.PL pod/pod2text.PL lib/Pod/t/{basic.*,{man,parselink,text*}.t}],
-		'CPAN'		=> 1,
-		},
-
-	'Pod::Perldoc' =>
-		{
-		'MAINTAINER'	=> 'sburke',
-		'FILES'		=> q[lib/Pod/Perldoc.pm lib/Pod/Perldoc],
-		'CPAN'		=> 1,
-		},
-
-	'Pod::Plainer' =>
-		{
-		'MAINTAINER'	=> 'rmbarker',
-		'FILES'		=> q[lib/Pod/Plainer.pm t/pod/plainer.t],
-		'CPAN'		=> 0,
-		},
-
-	'Safe' =>
-		{
-		'MAINTAINER'	=> 'abergman',
-		'FILES'		=> q[ext/Safe],
-		'CPAN'		=> 1,
-		},
-
-	'Storable' =>
-		{
-		'MAINTAINER'	=> 'ams',
-		'FILES'		=> q[ext/Storable],
-		'CPAN'		=> 1,
-		},
-
-	'Switch' =>
-		{
-		'MAINTAINER'	=> 'dconway',
-		'FILES'		=> q[lib/Switch.pm lib/Switch],
-		'CPAN'		=> 1,
-		},
-
-	'TabsWrap' =>
-		{
-		'MAINTAINER'	=> 'muir',
-		'FILES'		=>
-			q[lib/Text/{Tabs,Wrap}.pm lib/Text/TabsWrap],
-		'CPAN'		=> 1,
-		},
-
-	'Text::Balanced' =>
-		{
-		'MAINTAINER'	=> 'dconway',
-		'FILES'		=> q[lib/Text/Balanced.pm lib/Text/Balanced],
-		'CPAN'		=> 1,
-		},
-
-	'Term::ANSIColor' =>
-		{
-		'MAINTAINER'	=> 'rra',
-		'FILES'		=> q[lib/Term/ANSIColor.pm lib/Term/ANSIColor],
-		'CPAN'		=> 1,
-		},
-
-	'Test' =>
-		{
-		'MAINTAINER'	=> 'sburke',
-		'FILES'		=> q[lib/Test.pm lib/Test/t],
-		'CPAN'		=> 1,
-		},
-
-	'Test::Builder' =>
-		{
-		'MAINTAINER'	=> 'mschwern',
-		'FILES'		=> q[lib/Test/Builder.pm],
-		'CPAN'		=> 1,
-		},
-
-	'Test::Harness' =>
-		{
-		'MAINTAINER'	=> 'petdance',
-		'FILES'		=> q[lib/Test/Harness.pm lib/Test/Harness
-				     t/lib/sample-tests],
-		'CPAN'		=> 1,
-		},
-
-	'Test::More' =>
-		{
-		'MAINTAINER'	=> 'mschwern',
-		'FILES'		=> q[lib/Test/More.pm],
-		'CPAN'		=> 1,
-		},
-
-	'Test::Simple' =>
-		{
-		'MAINTAINER'	=> 'mschwern',
-		'FILES'		=> q[lib/Test/Simple.pm lib/Test/Simple
-				     t/lib/Test/Simple],
-		'CPAN'		=> 1,
-		},
-
-	'Term::Cap' =>
-		{
-		'MAINTAINER'	=> 'jstowe',
-		'FILES'		=> q[lib/Term/Cap.{pm,t}],
-		'CPAN'		=> 1,
-		},
-
-	'threads' =>
-		{
-		'MAINTAINER' => 'abergman',
-		'FILES'	 => q[ext/threads],
-		'CPAN'		=> 1,
-		},
-
-	'Tie::File' =>
-		{
-		'MAINTAINER'	=> 'mjd',
-		'FILES'		=> q[lib/Tie/File.pm lib/Tie/File],
-		'CPAN'		=> 1,
-		},
-
-	'Time::HiRes' =>
-		{
-		'MAINTAINER'	=> 'jhi',
-		'FILES'		=> q[ext/Time/HiRes],
-		'CPAN'		=> 1,
-		},
-
-	'Time::Local' =>
-		{
-		'MAINTAINER'	=> 'drolsky',
-		'FILES'		=> q[lib/Time/Local.{pm,t}],
-		'CPAN'		=> 1,
-		},
-
-	'Unicode::Collate' =>
-		{
-		'MAINTAINER'	=> 'sadahiro',
-		'FILES'		=> q[lib/Unicode/Collate.pm
-				     lib/Unicode/Collate],
-		'CPAN'		=> 1,
-		},
-
-	'Unicode::Normalize' =>
-		{
-		'MAINTAINER'	=> 'sadahiro',
-		'FILES'		=> q[ext/Unicode/Normalize],
-		'CPAN'		=> 1,
-		},
-
-	'vms' =>
-		{
-		'MAINTAINER'	=> 'craig',
-		'FILES'		=> q[vms configure.com README.vms],
-		'CPAN'		=> 0,
-		},
-
-	'warnings' =>
-		{
-		'MAINTAINER'	=> 'pmqs',
-		'FILES'		=> q[warnings.pl lib/warnings.{pm,t}
-				     lib/warnings t/lib/warnings],
-		'CPAN'		=> 0,
-		},
-
-	'win32' =>
-		{
-		'MAINTAINER'	=> 'gsar',
-		'FILES'		=> q[win32 README.win32 lib/Win32.pod t/win32],
-		'CPAN'		=> 0,
-		},
-
-	's2p' =>
-		{
-		'MAINTAINER'	=> 'laun',
-		'FILES'		=> q[x2p/s2p.PL],
-		'CPAN'		=> 0,
-		},
-
-	);
+    'Archive::Extract' =>
+	{
+	'MAINTAINER'	=> 'kane',
+	'DISTRIBUTION'	=> 'BINGOS/Archive-Extract-0.38.tar.gz',
+	'FILES'		=> q[cpan/Archive-Extract],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	'BUGS'		=> 'bug-archive-extract@rt.cpan.org',
+	},
+
+    'Archive::Tar' =>
+	{
+	'MAINTAINER'	=> 'kane',
+	'DISTRIBUTION'	=> 'BINGOS/Archive-Tar-1.54.tar.gz',
+	'FILES'		=> q[cpan/Archive-Tar],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	'BUGS'		=> 'bug-archive-tar@rt.cpan.org',
+	},
+
+    'Attribute::Handlers' =>
+	{
+	'MAINTAINER'	=> 'rgarcia',
+	'DISTRIBUTION'	=> 'SMUELLER/Attribute-Handlers-0.87.tar.gz',
+	'FILES'		=> q[dist/Attribute-Handlers],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'autodie' =>
+	{
+	'MAINTAINER'	=> 'pjf',
+	'DISTRIBUTION'	=> 'PJF/autodie-2.06_01.tar.gz',
+	'FILES' 	=> q[cpan/autodie],
+	'EXCLUDED'	=> [ qr{^inc/Module/},
+
+                             # All these tests depend upon external
+                             # modules that don't exist when we're
+                             # building the core.  Hence, they can
+                             # never run, and should not be merged.
+
+			     qw(
+				t/boilerplate.t
+				t/critic.t
+				t/fork.t
+				t/kwalitee.t
+				t/lex58.t
+				t/pod-coverage.t
+				t/pod.t
+				t/socket.t
+				t/system.t
+			      )
+			   ],
+	'CPAN'  	=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'AutoLoader' =>
+	{
+	'MAINTAINER'	=> 'smueller',
+	'DISTRIBUTION'	=> 'SMUELLER/AutoLoader-5.70.tar.gz',
+	'FILES'		=> q[cpan/AutoLoader],
+	'EXCLUDED'	=> [ qw( t/00pod.t ) ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'B::Concise' =>
+	{
+	'MAINTAINER'	=> 'smccam',
+	'FILES'		=> q[ext/B/B/Concise.pm ext/B/t/concise.t],
+	'CPAN'		=> 0,
+	'UPSTREAM'	=> undef,
+	},
+
+    'B::Debug' =>
+	{
+	'MAINTAINER'	=> 'rurban',
+	'DISTRIBUTION'	=> 'RURBAN/B-Debug-1.12.tar.gz',
+	'FILES'		=> q[cpan/B-Debug],
+	'EXCLUDED'	=> [ qw( t/coverage.html t/pod.t ) ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'B::Deparse' =>
+	{
+	'MAINTAINER'	=> 'smccam',
+	'FILES'		=> q[dist/B-Deparse],
+	'CPAN'		=> 0,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'B::Lint' =>
+	{
+	'MAINTAINER'	=> 'jjore',
+	'DISTRIBUTION'	=> 'JJORE/B-Lint-1.11.tar.gz',
+	'FILES'		=> q[cpan/B-Lint],
+	'EXCLUDED'	=> [ qw( t/test.pl ) ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'base' =>
+	{
+	'MAINTAINER'	=> 'rgarcia',
+	'DISTRIBUTION'	=> 'RGARCIA/base-2.15.tar.gz',
+	'FILES'		=> q[dist/base],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'bignum' =>
+	{
+	'MAINTAINER'	=> 'tels',
+	'DISTRIBUTION'	=> 'TELS/math/bignum-0.23.tar.gz',
+	'FILES'		=> q[cpan/bignum],
+	'EXCLUDED'	=> [ qr{^inc/Module/}, qw(t/pod.t t/pod_cov.t) ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'CGI' =>
+	{
+	'MAINTAINER'	=> 'lstein',
+	'DISTRIBUTION'	=> 'LDS/CGI.pm-3.49.tar.gz',
+	'FILES'		=> q[cpan/CGI],
+	'EXCLUDED'	=> [ qr{^t/lib/Test},
+				qw( cgi-lib_porting.html
+				    cgi_docs.html
+				    examples/WORLD_WRITABLE/18.157.1.253.sav
+				    t/gen-tests/gen-start-end-tags.pl
+				    t/fast.t
+				)
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Class::ISA' =>
+	{
+	'MAINTAINER'	=> 'smueller',
+	'DISTRIBUTION'	=> 'SMUELLER/Class-ISA-0.36.tar.gz',
+	'FILES'		=> q[cpan/Class-ISA],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	'DEPRECATED'	=> 5.011,
+	},
+
+    'Compress::Raw::Bzip2' =>
+	{
+	'MAINTAINER'	=> 'pmqs',
+	'DISTRIBUTION'	=> 'PMQS/Compress-Raw-Bzip2-2.021.tar.gz',
+	'FILES'		=> q[cpan/Compress-Raw-Bzip2],
+	'EXCLUDED'	=> [ qr{^t/Test/},
+			     qw( bzip2-src/bzip2-cpp.patch
+			     )
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Compress::Raw::Zlib' =>
+	{
+	'MAINTAINER'	=> 'pmqs',
+	'DISTRIBUTION'	=> 'PMQS/Compress-Raw-Zlib-2.021.tar.gz',
+
+	'FILES'		=> q[cpan/Compress-Raw-Zlib],
+	'EXCLUDED'	=> [ qr{^t/Test/},
+			     qw( t/000prereq.t
+				 t/99pod.t
+			       )
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'constant' =>
+	{
+	'MAINTAINER'	=> 'saper',
+	'DISTRIBUTION'	=> 'SAPER/constant-1.19.tar.gz',
+	'FILES'		=> q[dist/constant],
+	'EXCLUDED'	=> [ qw( t/00-load.t
+				 t/more-tests.t
+				 t/pod-coverage.t
+				 t/pod.t
+				 eg/synopsis.pl
+			       )
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'CPAN' =>
+	{
+	'MAINTAINER'	=> 'andk',
+	'DISTRIBUTION'	=> 'ANDK/CPAN-1.94_56.tar.gz',
+	'FILES'		=> q[cpan/CPAN],
+	'EXCLUDED'	=> [ qr{^distroprefs/},
+			     qr{^inc/Test/},
+			     qr{^t/CPAN/authors/},
+			     qw{
+				lib/CPAN/Admin.pm
+				Makefile.PL
+				SlayMakefile
+				t/00signature.t
+				t/04clean_load.t
+				t/12cpan.t
+				t/13tarzip.t
+				t/14forkbomb.t
+				t/30shell.coverage
+				t/30shell.t
+				t/31sessions.t
+				t/41distribution.t
+				t/42distroprefs.t
+				t/43distroprefspref.t
+				t/50pod.t
+				t/51pod.t
+				t/52podcover.t
+				t/60credentials.t
+				t/70_critic.t
+				t/CPAN/CpanTestDummies-1.55.pm
+				t/CPAN/TestConfig.pm
+				t/CPAN/TestMirroredBy
+				t/CPAN/TestPatch.txt
+				t/CPAN/modules/02packages.details.txt
+				t/CPAN/modules/03modlist.data
+				t/data/META-dynamic.yml
+				t/data/META-static.yml
+				t/local_utils.pm
+				t/perlcriticrc
+				t/yaml_code.yml
+			       },
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'CPANPLUS' =>
+	{
+	'MAINTAINER'	=> 'kane',
+	'DISTRIBUTION'	=> 'BINGOS/CPANPLUS-0.90.tar.gz',
+	'FILES'		=> q[cpan/CPANPLUS],
+	'EXCLUDED'	=> [ qr{^inc/},
+			     qr{^t/dummy-.*\.hidden$},
+			     qw{ bin/cpanp-boxed },
+			     # SQLite tests would be skipped in core, and
+			     # the filenames are too long for VMS!
+			     qw{
+				 t/031_CPANPLUS-Internals-Source-SQLite.t
+				 t/032_CPANPLUS-Internals-Source-via-sqlite.t
+			       },
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	'BUGS'		=> 'bug-cpanplus@rt.cpan.org',
+	},
+
+    'CPANPLUS::Dist::Build' =>
+	{
+	'MAINTAINER'	=> 'bingos',
+	'DISTRIBUTION'	=> 'BINGOS/CPANPLUS-Dist-Build-0.46.tar.gz',
+	'FILES'		=> q[cpan/CPANPLUS-Dist-Build],
+	'EXCLUDED'	=> [ qr{^inc/},
+			     qw{ t/99_pod.t
+			         t/99_pod_coverage.t
+			       },
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Data::Dumper' =>
+	{
+	'MAINTAINER'	=> 'p5p', # Not gsar. Not ilyam
+	'DISTRIBUTION'	=> 'SMUELLER/Data-Dumper-2.125.tar.gz',
+	'FILES'		=> q[dist/Data-Dumper],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'DB_File' =>
+	{
+	'MAINTAINER'	=> 'pmqs',
+	'DISTRIBUTION'	=> 'PMQS/DB_File-1.820.tar.gz',
+	'FILES'		=> q[cpan/DB_File],
+	'EXCLUDED'	=> [ qr{^patches/},
+			     qw{ t/pod.t
+			         fallback.h
+				 fallback.xs
+			       },
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Devel::PPPort' =>
+	{
+	'MAINTAINER'	=> 'mhx',
+	'DISTRIBUTION'	=> 'MHX/Devel-PPPort-3.19.tar.gz',
+	'FILES'		=> q[cpan/Devel-PPPort],
+	'EXCLUDED'	=> [ qw{PPPort.pm} ], # we use PPPort_pm.PL instead
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Digest' =>
+	{
+	'MAINTAINER'	=> 'gaas',
+	'DISTRIBUTION'	=> 'GAAS/Digest-1.16.tar.gz',
+	'FILES'		=> q[cpan/Digest],
+	'EXCLUDED'	=> [ qw{digest-bench} ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Digest::MD5' =>
+	{
+	'MAINTAINER'	=> 'gaas',
+	'DISTRIBUTION'	=> 'GAAS/Digest-MD5-2.39.tar.gz',
+	'FILES'		=> q[cpan/Digest-MD5],
+	'EXCLUDED'	=> [ qw{rfc1321.txt} ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Digest::SHA' =>
+	{
+	'MAINTAINER'	=> 'mshelor',
+	'DISTRIBUTION'	=> 'MSHELOR/Digest-SHA-5.47.tar.gz',
+	'FILES' 	=> q[cpan/Digest-SHA],
+	'EXCLUDED'	=> [ qw{t/pod.t t/podcover.t examples/dups} ],
+	'CPAN'  	=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Encode' =>
+	{
+	'MAINTAINER'	=> 'dankogai',
+	'DISTRIBUTION'	=> 'DANKOGAI/Encode-2.39.tar.gz',
+	'FILES'		=> q[cpan/Encode],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'encoding::warnings' =>
+	{
+	'MAINTAINER'	=> 'audreyt',
+	'DISTRIBUTION'	=> 'AUDREYT/encoding-warnings-0.11.tar.gz',
+	'FILES'		=> q[cpan/encoding-warnings],
+	'EXCLUDED'	=> [ qr{^inc/Module/},
+			     qw{t/0-signature.t Makefile.PL MANIFEST META.yml
+			     README SIGNATURE},
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Exporter' =>
+	{
+	'MAINTAINER'	=> 'ferreira',
+	'DISTRIBUTION'	=> 'FERREIRA/Exporter-5.63.tar.gz',
+	'FILES'		=> q[lib/Exporter.pm
+			     lib/Exporter.t
+			     lib/Exporter/Heavy.pm
+			    ],
+	'EXCLUDED'	=> [ qw{t/pod.t t/use.t}, ],
+	'MAP'		=> { 't/'	=> 'lib/',
+			     'lib/'	=> 'lib/',
+			   },
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'ExtUtils::CBuilder' =>
+	{
+	'MAINTAINER'	=> 'kwilliams',
+	'DISTRIBUTION'	=> 'DAGOLDEN/ExtUtils-CBuilder-0.27.tar.gz',
+	'FILES'		=> q[cpan/ExtUtils-CBuilder],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'ExtUtils::Command' =>
+	{
+	'MAINTAINER'	=> 'rkobes',
+	'DISTRIBUTION'	=> 'RKOBES/ExtUtils-Command-1.16.tar.gz',
+	'FILES'		=> q[cpan/ExtUtils-Command],
+	'EXCLUDED'	=> [ qw{ t/shell_command.t
+				 t/shell_exit.t
+				 lib/Shell/Command.pm
+			       },
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'ExtUtils::Constant' =>
+	{
+	'MAINTAINER'	=> 'nwclark',
+	 # Nick has confirmed that while we have diverged from CPAN,
+	 # this package isn't primarily maintained in core
+	 # Another release wll happen "Sometime"
+	 'DISTRIBUTION'	=> '',#'NWCLARK/ExtUtils-Constant-0.16.tar.gz',
+	'FILES'		=> q[cpan/ExtUtils-Constant],
+	'EXCLUDED'	=> [ qw{ lib/ExtUtils/Constant/Aaargh56Hash.pm
+				 examples/perl_keyword.pl
+				 examples/perl_regcomp_posix_keyword.pl
+			       },
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'ExtUtils::Install' =>
+	{
+	'MAINTAINER'	=> 'yves',
+	'DISTRIBUTION'	=> 'YVES/ExtUtils-Install-1.54.tar.gz',
+	'FILES' 	=> q[dist/ExtUtils-Install],
+	'EXCLUDED'	=> [ qw{ t/lib/Test/Builder.pm
+				 t/lib/Test/Builder/Module.pm
+				 t/lib/Test/More.pm
+				 t/lib/Test/Simple.pm
+				 t/pod-coverage.t
+				 t/pod.t
+			       },
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'ExtUtils::MakeMaker' =>
+	{
+	'MAINTAINER'	=> 'mschwern',
+	'DISTRIBUTION'	=> 'MSCHWERN/ExtUtils-MakeMaker-6.56.tar.gz',
+	'FILES'		=> q[cpan/ExtUtils-MakeMaker],
+	'EXCLUDED'	=> [ qr{^t/lib/Test/},
+			     qr{^inc/ExtUtils/},
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'first-come',
+	},
+
+    'ExtUtils::Manifest' =>
+	{
+	'MAINTAINER'	=> 'rkobes',
+	'DISTRIBUTION'	=> 'RKOBES/ExtUtils-Manifest-1.57.tar.gz',
+	'FILES'		=> q[cpan/ExtUtils-Manifest],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'ExtUtils::ParseXS' =>
+	{
+	'MAINTAINER'	=> 'kwilliams',
+    'DISTRIBUTION' => 'DAGOLDEN/ExtUtils-ParseXS-2.21.tar.gz',
+    'EXCLUDED'  => [ qw{
+	                t/bugs/RT48104.xs
+				    t/bugs/typemap
+					t/include/nsUniversalDetector.h
+					t/include/nscore.h
+				   }],
+	'FILES'		=> q[cpan/ExtUtils-ParseXS],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'faq' =>
+	{
+	'MAINTAINER'	=> 'perlfaq',
+	'FILES'		=> q[pod/perlfaq*],
+	'CPAN'		=> 0,
+	'UPSTREAM'	=> undef,
+	},
+
+    'File::Fetch' =>
+	{
+	'MAINTAINER'	=> 'kane',
+	'DISTRIBUTION'	=> 'BINGOS/File-Fetch-0.24.tar.gz',
+	'FILES'		=> q[cpan/File-Fetch],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'File::Path' =>
+	{
+	'MAINTAINER'	=> 'dland',
+	'DISTRIBUTION'	=> 'DLAND/File-Path-2.08.tar.gz',
+	'FILES'		=> q[cpan/File-Path],
+	'EXCLUDED'	=> [ qw{eg/setup-extra-tests
+				t/pod.t
+			       }
+			   ],
+	'MAP'		=> { ''		=> 'cpan/File-Path/lib/File/',
+			     't/'	=> 'cpan/File-Path/t/',
+			   },
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'File::Temp' =>
+	{
+	'MAINTAINER'	=> 'tjenness',
+	'DISTRIBUTION'	=> 'TJENNESS/File-Temp-0.22.tar.gz',
+	'FILES'		=> q[cpan/File-Temp],
+	'EXCLUDED'	=> [ qw{misc/benchmark.pl
+				misc/results.txt
+			       }
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Filter::Simple' =>
+	{
+	'MAINTAINER'	=> 'smueller',
+	'DISTRIBUTION'	=> 'SMUELLER/Filter-Simple-0.84.tar.gz',
+	'FILES'		=> q[dist/Filter-Simple],
+	'EXCLUDED'	=> [ qw(Makefile.PL MANIFEST README META.yml),
+			     qr{^demo/}
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'Filter::Util::Call' =>
+	{
+	'MAINTAINER'	=> 'pmqs',
+	'DISTRIBUTION'	=> 'PMQS/Filter-1.37.tar.gz',
+	'FILES'		=> q[cpan/Filter-Util-Call
+			     t/lib/filter-util.pl
+			     pod/perlfilter.pod
+			    ],
+	'EXCLUDED'	=> [ qr{^decrypt/},
+			     qr{^examples/},
+			     qr{^Exec/},
+			     qr{^lib/Filter/},
+			     qr{^tee/},
+			     qw{ Call/Makefile.PL
+				 Call/ppport.h
+				 Call/typemap
+				 mytest
+				 t/cpp.t
+				 t/decrypt.t
+				 t/exec.t
+				 t/order.t
+				 t/pod.t
+				 t/sh.t
+				 t/tee.t
+			       }
+			   ],
+	'MAP'		=> { 'Call/'	      => 'cpan/Filter-Util-Call/',
+			     'filter-util.pl' => 'cpan/Filter-Util-Call/filter-util.pl',
+			     'perlfilter.pod' => 'pod/perlfilter.pod',
+			     ''		      => 'cpan/Filter-Util-Call/',
+			   },
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Getopt::Long' =>
+	{
+	'MAINTAINER'	=> 'jv',
+	'DISTRIBUTION'	=> 'JV/Getopt-Long-2.38.tar.gz',
+	'FILES'		=> q[cpan/Getopt-Long
+			     lib/newgetopt.pl
+			    ],
+	'EXCLUDED'	=> [ qr{^examples/},
+			     qw{perl-Getopt-Long.spec},
+			   ],
+	'MAP'		=> { ''		       => 'cpan/Getopt-Long/',
+			     'lib/newgetopt.pl' => 'lib/newgetopt.pl',
+			   },
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    # Sean has donated it to us.
+    # Nothing has changed since his last CPAN release.
+    # (not strictly true: there have been some trivial typo fixes; DAPM 6/2009)
+    'I18N::LangTags' =>
+	{
+	'MAINTAINER'	=> 'p5p',
+	'DISTRIBUTION'	=> 'SBURKE/I18N-LangTags-0.35.tar.gz',
+	'FILES'		=> q[dist/I18N-LangTags],
+	'CPAN'		=> 0,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'if' =>
+	{
+	'MAINTAINER'	=> 'ilyaz',
+	'DISTRIBUTION'	=> 'ILYAZ/modules/if-0.0401.tar.gz',
+	'FILES'		=> q[cpan/if],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'IO' =>
+	{
+	'MAINTAINER'	=> 'p5p',
+	'DISTRIBUTION'	=> 'GBARR/IO-1.25.tar.gz',
+	'FILES'		=> q[dist/IO/],
+	'EXCLUDED'	=> [ qw{t/test.pl}, ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'IO-Compress' =>
+	{
+	'MAINTAINER'	=> 'pmqs',
+	'DISTRIBUTION'	=> 'PMQS/IO-Compress-2.021.tar.gz',
+	'FILES'		=> q[cpan/IO-Compress],
+	'EXCLUDED'	=> [ qr{t/Test/} ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'IO::Zlib' =>
+	{
+	'MAINTAINER'	=> 'tomhughes',
+	'DISTRIBUTION'	=> 'TOMHUGHES/IO-Zlib-1.10.tar.gz',
+	'FILES'		=> q[cpan/IO-Zlib],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'IPC::Cmd' =>
+	{
+	'MAINTAINER'	=> 'kane',
+	'DISTRIBUTION'	=> 'BINGOS/IPC-Cmd-0.54.tar.gz',
+	'FILES'		=> q[cpan/IPC-Cmd],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'IPC::SysV' =>
+	{
+	'MAINTAINER'	=> 'mhx',
+	'DISTRIBUTION'	=> 'MHX/IPC-SysV-2.01.tar.gz',
+	'FILES'		=> q[cpan/IPC-SysV],
+	'EXCLUDED'	=> [ qw{const-c.inc const-xs.inc} ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'lib' =>
+	{
+	'MAINTAINER'	=> 'smueller',
+	'DISTRIBUTION'	=> 'SMUELLER/lib-0.62.tar.gz',
+	'FILES'		=> q[dist/lib/],
+	'EXCLUDED'	=> [ qw{forPAUSE/lib.pm t/00pod.t} ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'libnet' =>
+	{
+	'MAINTAINER'	=> 'gbarr',
+	'DISTRIBUTION'	=> 'GBARR/libnet-1.22.tar.gz',
+	'FILES'		=> q[cpan/libnet],
+	'EXCLUDED'	=> [ qw{Configure install-nomake} ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Locale-Codes' =>
+	{
+	'MAINTAINER'	=> 'sbeck',
+	'DISTRIBUTION'	=> 'NEILB/Locale-Codes-2.07.tar.gz',
+	'FILES'		=> q[cpan/Locale-Codes],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Locale::Maketext' =>
+	{
+	'MAINTAINER'	=> 'ferreira',
+	'DISTRIBUTION'	=> 'FERREIRA/Locale-Maketext-1.13.tar.gz',
+	'FILES'		=> q[dist/Locale-Maketext],
+	'EXCLUDED'	=> [ qw{perlcriticrc t/00_load.t t/pod.t} ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'Locale::Maketext::Simple' =>
+	{
+	'MAINTAINER'	=> 'audreyt',
+	'DISTRIBUTION'	=> 'JESSE/Locale-Maketext-Simple-0.21.tar.gz',
+	'FILES'		=> q[cpan/Locale-Maketext-Simple],
+	'EXCLUDED'	=> [ qr{^inc/} ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Log::Message' =>
+	{
+	'MAINTAINER'	=> 'kane',
+	'DISTRIBUTION'	=> 'KANE/Log-Message-0.02.tar.gz',
+	'FILES'		=> q[cpan/Log-Message],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Log::Message::Simple' =>
+	{
+	'MAINTAINER'	=> 'kane',
+	'DISTRIBUTION'	=> 'BINGOS/Log-Message-Simple-0.06.tar.gz',
+	'FILES'		=> q[cpan/Log-Message-Simple],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'mad' =>
+	{
+	'MAINTAINER'	=> 'lwall',
+	'FILES'		=> q[mad],
+	'CPAN'		=> 0,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Math::BigInt' =>
+	{
+	'MAINTAINER'	=> 'tels',
+	'DISTRIBUTION'	=> 'TELS/math/Math-BigInt-1.89.tar.gz',
+	'FILES'		=> q[cpan/Math-BigInt],
+	'EXCLUDED'	=> [ qr{^inc/},
+			     qr{^examples/},
+			     qw{t/pod.t
+				t/pod_cov.t
+			       }
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Math::BigInt::FastCalc' =>
+	{
+	'MAINTAINER'	=> 'tels',
+	'DISTRIBUTION'	=> 'TELS/math/Math-BigInt-FastCalc-0.19.tar.gz',
+	'FILES'		=> q[cpan/Math-BigInt-FastCalc],
+	'EXCLUDED'	=> [ qr{^inc/},
+			     qw{
+				t/pod.t
+				t/pod_cov.t
+			       },
+			     # instead we use the versions of these test
+			     # files that come with Math::BigInt:
+			     qw{t/bigfltpm.inc
+				t/bigfltpm.t
+				t/bigintpm.inc
+				t/bigintpm.t
+				t/mbimbf.inc
+				t/mbimbf.t
+			       },
+			   ],
+	'MAP'		=> { '' => 'cpan/Math-BigInt-FastCalc/',
+			     'lib/Math/BigInt/FastCalc.pm'
+				    => 'cpan/Math-BigInt-FastCalc/FastCalc.pm',
+			   },
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Math::BigRat' =>
+	{
+	'MAINTAINER'	=> 'tels',
+	'DISTRIBUTION'	=> 'LETO/Math-BigRat-0.24.tar.gz',
+	'FILES'		=> q[cpan/Math-BigRat],
+	'EXCLUDED'	=> [ qr{^inc/},
+			     qw{
+				t/pod.t
+				t/pod_cov.t
+			       },
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Math::Complex' =>
+	{
+	'MAINTAINER'	=> 'zefram',
+	'DISTRIBUTION'	=> 'JHI/Math-Complex-1.56.tar.gz',
+	'FILES'		=> q[cpan/Math-Complex],
+	'EXCLUDED'	=> [
+			     qw{
+				t/pod.t
+				t/pod-coverage.t
+			       },
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Memoize' =>
+	{
+	'MAINTAINER'	=> 'mjd',
+	'DISTRIBUTION'	=> 'MJD/Memoize-1.01.tar.gz',
+	'FILES'		=> q[cpan/Memoize],
+	'EXCLUDED'	=> [
+			     qw{
+				article.html
+				Memoize/Saves.pm
+			       },
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'MIME::Base64' =>
+	{
+	'MAINTAINER'	=> 'gaas',
+	'DISTRIBUTION'	=> 'GAAS/MIME-Base64-3.08.tar.gz',
+	'FILES'		=> q[cpan/MIME-Base64],
+	'EXCLUDED'	=> [ qw{ t/bad-sv.t }, ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Module::Build' =>
+	{
+	'MAINTAINER'	=> 'kwilliams',
+	'DISTRIBUTION'	=> 'DAGOLDEN/Module-Build-0.3603.tar.gz',
+	'FILES'		=> q[cpan/Module-Build],
+	'EXCLUDED'	=> [ qw{ t/par.t t/signature.t },
+			     qr!^contrib/!,  qr!^devtools! ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Module::CoreList' =>
+	{
+	'MAINTAINER'	=> 'rgarcia',
+	'DISTRIBUTION'	=> 'BINGOS/Module-CoreList-2.36.tar.gz',
+	'FILES'		=> q[dist/Module-CoreList],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'Module::Load' =>
+	{
+	'MAINTAINER'	=> 'kane',
+	'DISTRIBUTION'	=> 'KANE/Module-Load-0.16.tar.gz',
+	'FILES'		=> q[cpan/Module-Load],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Module::Load::Conditional' =>
+	{
+	'MAINTAINER'	=> 'kane',
+	'DISTRIBUTION'	=> 'BINGOS/Module-Load-Conditional-0.38.tar.gz',
+	'FILES'		=> q[cpan/Module-Load-Conditional],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Module::Loaded' =>
+	{
+	'MAINTAINER'	=> 'kane',
+	'DISTRIBUTION'	=> 'BINGOS/Module-Loaded-0.06.tar.gz',
+	'FILES'		=> q[cpan/Module-Loaded],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Module::Pluggable' =>
+	{
+	'MAINTAINER'	=> 'simonw',
+	'DISTRIBUTION'	=> 'SIMONW/Module-Pluggable-3.9.tar.gz',
+	'FILES'		=> q[cpan/Module-Pluggable],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Net::Ping' =>
+	{
+	'MAINTAINER'	=> 'smpeters',
+	'DISTRIBUTION'	=> 'SMPETERS/Net-Ping-2.36.tar.gz',
+	'FILES'		=> q[dist/Net-Ping],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'NEXT' =>
+	{
+	'MAINTAINER'	=> 'rafl',
+	'DISTRIBUTION'	=> 'FLORA/NEXT-0.64.tar.gz',
+	'FILES'		=> q[cpan/NEXT],
+	'EXCLUDED'	=> [ qr{^demo/} ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Object::Accessor' =>
+	{
+	'MAINTAINER'	=> 'kane',
+	'DISTRIBUTION'	=> 'BINGOS/Object-Accessor-0.36.tar.gz',
+	'FILES'		=> q[cpan/Object-Accessor],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Package::Constants' =>
+	{
+	'MAINTAINER'	=> 'kane',
+	'DISTRIBUTION'	=> 'KANE/Package-Constants-0.02.tar.gz',
+	'FILES'		=> q[cpan/Package-Constants],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Params::Check' =>
+	{
+	'MAINTAINER'	=> 'kane',
+	'DISTRIBUTION'	=> 'KANE/Params-Check-0.26.tar.gz',
+	# For some reason a file of this name appears within
+	# the tarball. Russell's Paradox eat your heart out.
+	'EXCLUDED'	=> [ qw( Params-Check-0.26.tar.gz ) ],
+	'FILES'		=> q[cpan/Params-Check],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'parent' =>
+	{
+	'MAINTAINER'	=> 'corion',
+	'DISTRIBUTION'	=> 'CORION/parent-0.223.tar.gz',
+	'FILES'		=> q[cpan/parent],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Parse::CPAN::Meta' =>
+	{
+	'MAINTAINER'	=> 'smueller',
+	'DISTRIBUTION'	=> 'SMUELLER/Parse-CPAN-Meta-1.40.tar.gz',
+	'FILES'		=> q[cpan/Parse-CPAN-Meta],
+	'EXCLUDED'	=> [ qw( t/97_meta.t t/98_pod.t t/99_pmv.t ) ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	# NOTE: 'perl uupacktool.pl t/data/utf_16_le_bom.yml.packed'
+	# run by hand after import, as the core's test harness doesn't
+	# run dists' "make test" steps
+	},
+
+    'PathTools' =>
+	{
+	'MAINTAINER'	=> 'kwilliams',
+	'DISTRIBUTION'	=> 'SMUELLER/PathTools-3.31.tar.gz',
+	'FILES'		=> q[cpan/Cwd],
+	'EXCLUDED'	=> [ qr{^t/lib/Test/} ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> "cpan",
+	# NOTE: PathTools is in cpan/Cwd/ because it contains Cwd.xs and
+	# something, possibly Makefile.SH, makes an assumption that the
+	# leafname of some  file corresponds with the pathname of the directory.
+	},
+
+    'perlebcdic' =>
+	{
+	'MAINTAINER'	=> 'pvhp',
+	'FILES'		=> q[pod/perlebcdic.pod],
+	'CPAN'		=> 0,
+	'UPSTREAM'	=> undef,
+	},
+
+    'PerlIO' =>
+	{
+	'MAINTAINER'	=> 'p5p',
+	'FILES'		=> q[ext/PerlIO],
+	'CPAN'		=> 0,
+	'UPSTREAM'	=> undef,
+	},
+
+    'PerlIO::via::QuotedPrint' =>
+	{
+	'MAINTAINER'	=> 'elizabeth',
+	'DISTRIBUTION'	=> 'ELIZABETH/PerlIO-via-QuotedPrint-0.06.tar.gz',
+	'FILES'		=> q[cpan/PerlIO-via-QuotedPrint],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'perlpacktut' =>
+	{
+	'MAINTAINER'	=> 'laun',
+	'FILES'		=> q[pod/perlpacktut.pod],
+	'CPAN'		=> 0,
+	'UPSTREAM'	=> undef,
+	},
+
+    'perlpodspec' =>
+	{
+	'MAINTAINER'	=> 'sburke',
+	'FILES'		=> q[pod/perlpodspec.pod],
+	'CPAN'		=> 0,
+	'UPSTREAM'	=> undef,
+	},
+
+    'perlre' =>
+	{
+	'MAINTAINER'	=> 'abigail',
+	'FILES'		=> q[pod/perlrecharclass.pod
+			     pod/perlrebackslash.pod],
+	'CPAN'		=> 0,
+	'UPSTREAM'	=> undef,
+	},
+
+
+    'perlreapi' =>
+	{
+	MAINTAINER	=> 'avar',
+	FILES		=> q[pod/perlreapi.pod],
+	CPAN		=> 0,
+	'UPSTREAM'	=> undef,
+	},
+
+    'perlreftut' =>
+	{
+	'MAINTAINER'	=> 'mjd',
+	'FILES'		=> q[pod/perlreftut.pod],
+	'CPAN'		=> 0,
+	'UPSTREAM'	=> undef,
+	},
+
+    'perlthrtut' =>
+	{
+	'MAINTAINER'	=> 'elizabeth',
+	'FILES'		=> q[pod/perlthrtut.pod],
+	'CPAN'		=> 0,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Pod::Escapes' =>
+	{
+	'MAINTAINER'	=> 'arandal',
+	'DISTRIBUTION'	=> 'SBURKE/Pod-Escapes-1.04.tar.gz',
+	'FILES'		=> q[cpan/Pod-Escapes],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Pod::LaTeX' =>
+	{
+	'MAINTAINER'	=> 'tjenness',
+	'DISTRIBUTION'	=> 'TJENNESS/Pod-LaTeX-0.58.tar.gz',
+	'FILES'		=> q[cpan/Pod-LaTeX
+			     pod/pod2latex.PL
+			    ],
+	'EXCLUDED'	=> [ qw( t/require.t ) ],
+	'MAP'		=> { '' => 'cpan/Pod-LaTeX/',
+			     'pod2latex.PL' => 'pod/pod2latex.PL',
+			   },
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Pod::Parser'	=> {
+	'MAINTAINER'	=> 'marekr',
+
+	# XXX Parser.pm in the 1.38 distribution identifies itself as
+	# version 1.37!
+
+	'DISTRIBUTION'	=> 'MAREKR/Pod-Parser-1.38.tar.gz',
+	'FILES'		=> q[cpan/Pod-Parser
+			     pod/pod{2usage,checker,select}.PL
+			    ],
+	'MAP'		=> { '' => 'cpan/Pod-Parser/',
+			     'scripts/' => 'pod/',
+			   },
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Pod::Perldoc' =>
+	{
+	'MAINTAINER'	=> 'ferreira',
+	'DISTRIBUTION'	=> 'FERREIRA/Pod-Perldoc-3.15_01.tar.gz',
+	# I don't know whether it's conceptually cleaner to a rule to copy
+	# ext/Pod-Perldoc/pod/perldoc.pod to pod/perldoc.pod at make time
+	# (in 4 places), or leave it as 1 mapping here.
+	'FILES'		=> q[dist/Pod-Perldoc
+			     pod/perldoc.pod
+			    ],
+	# in blead, the perldoc executable is generated by perldoc.PL
+	# instead
+	# XXX We can and should fix this, but clean up the DRY-failure in utils
+	# first
+	'EXCLUDED'	=> [ qw( perldoc ) ],
+	'MAP'		=> { '' => 'dist/Pod-Perldoc/',
+			     'lib/perldoc.pod' => 'pod/perldoc.pod',
+			   },
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'Pod::Plainer' =>
+	{
+	'DISTRIBUTION'	=> 'RMBARKER/Pod-Plainer-1.02.tar.gz',
+	'MAINTAINER'	=> 'rmbarker',
+	'FILES'		=> q[dist/Pod-Plainer],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	'EXCLUDED'	=> [ qw(t/pod.t t/pod-coverage.t) ],
+	'DEPRECATED'	=> 5.011,
+	},
+
+    'Pod::Simple' =>
+	{
+	'MAINTAINER'	=> 'arandal',
+	'DISTRIBUTION'	=> 'DWHEELER/Pod-Simple-3.13.tar.gz',
+	'FILES'		=> q[cpan/Pod-Simple],
+	# XXX these two files correspond to similar ones in blead under
+	# pod/, but the blead ones have newer changes, and also seem to
+	# have been in blead a long time. I'm going to assume then that
+	# the blead versions of these two files are authoritative - DAPM
+	'EXCLUDED'	=> [ qw( lib/perlpod.pod lib/perlpodspec.pod ) ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'podlators' =>
+	{
+	'MAINTAINER'	=> 'rra',
+	'DISTRIBUTION'	=> 'RRA/podlators-2.3.1.tar.gz',
+	'FILES'		=> q[cpan/podlators
+			     pod/pod2man.PL
+			     pod/pod2text.PL
+			    ],
+	'MAP'		=> { '' => 'cpan/podlators/',
+			     'scripts/' => 'pod/',
+			   },
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Safe' =>
+	{
+	'MAINTAINER'	=> 'rgarcia',
+	'DISTRIBUTION'	=> 'RGARCIA/Safe-2.22.tar.gz',
+	'FILES'		=> q[dist/Safe],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'Scalar-List-Utils' =>
+	{
+	'MAINTAINER'	=> 'gbarr',
+	'DISTRIBUTION'	=> 'GBARR/Scalar-List-Utils-1.21.tar.gz',
+	# Note that perl uses its own version of Makefile.PL
+	'FILES'		=> q[cpan/List-Util],
+	'EXCLUDED'	=> [ qr{^inc/Module/},
+			     qr{^inc/Test/},
+			     qw{ mytypemap },
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'SelfLoader' =>
+	{
+	'MAINTAINER'	=> 'smueller',
+	'DISTRIBUTION'	=> 'SMUELLER/SelfLoader-1.17.tar.gz',
+	'FILES'		=> q[dist/SelfLoader],
+	'EXCLUDED'	=> [ qw{ t/00pod.t } ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'Shell' =>
+	{
+	'MAINTAINER'	=> 'ferreira',
+	'DISTRIBUTION'	=> 'FERREIRA/Shell-0.72_01.tar.gz',
+	'FILES'		=> q[cpan/Shell],
+	'EXCLUDED'	=> [ qw{ t/01_use.t t/99_pod.t } ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	'DEPRECATED'	=> 5.011,
+	},
+
+    'Storable' =>
+	{
+	'MAINTAINER'	=> 'ams',
+	'DISTRIBUTION'	=> 'AMS/Storable-2.21.tar.gz',
+	'FILES'		=> q[dist/Storable],
+	'EXCLUDED'	=> [ qr{^t/Test/} ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'Switch' =>
+	{
+	'MAINTAINER'	=> 'rgarcia',
+	'DISTRIBUTION'	=> 'RGARCIA/Switch-2.15.tar.gz',
+	'FILES'		=> q[dist/Switch],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	'DEPRECATED'	=> 5.011,
+	},
+
+    'Sys::Syslog' =>
+	{
+	'MAINTAINER'	=> 'saper',
+	'DISTRIBUTION'	=> 'SAPER/Sys-Syslog-0.27.tar.gz',
+	'FILES'		=> q[cpan/Sys-Syslog],
+	'EXCLUDED'	=> [ qr{^eg/},
+			     qw{t/data-validation.t
+			        t/distchk.t
+				t/pod.t
+				t/podcover.t
+				t/podspell.t
+				t/portfs.t
+				win32/PerlLog.RES
+			       },
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Term::ANSIColor' =>
+	{
+	'MAINTAINER'	=> 'rra',
+	'DISTRIBUTION'	=> 'RRA/ANSIColor-2.02.tar.gz',
+	'FILES'		=> q[cpan/Term-ANSIColor],
+	'EXCLUDED'	=> [ qr{^tests/}, qw(t/pod-spelling.t t/pod.t) ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Term::Cap' =>
+	{
+	'MAINTAINER'	=> 'jstowe',
+	'DISTRIBUTION'	=> 'JSTOWE/Term-Cap-1.12.tar.gz',
+	'FILES'		=> q[cpan/Term-Cap],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Term::UI' =>
+	{
+	'MAINTAINER'	=> 'kane',
+	'DISTRIBUTION'	=> 'KANE/Term-UI-0.20.tar.gz',
+	'FILES'		=> q[cpan/Term-UI],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Test' =>
+	{
+	'MAINTAINER'	=> 'jesse',
+	'DISTRIBUTION'	=> 'JESSE/Test-1.25_02.tar.gz',
+	'FILES'		=> q[cpan/Test],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Test::Harness' =>
+	{
+	'MAINTAINER'	=> 'andya',
+	'DISTRIBUTION'	=> 'ANDYA/Test-Harness-3.17.tar.gz',
+	'FILES'		=> q[cpan/Test-Harness],
+	'EXCLUDED'	=> [ qr{^examples/},
+			     qr{^inc/},
+			     qr{^t/lib/Test/},
+			     qr{^xt/},
+			     qw{Changes-2.64
+				HACKING.pod
+				perlcriticrc
+				t/lib/if.pm
+			       }
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Test::Simple' =>
+	{
+	'MAINTAINER'	=> 'mschwern',
+	'DISTRIBUTION'	=> 'MSCHWERN/Test-Simple-0.94.tar.gz',
+	'FILES'		=> q[cpan/Test-Simple],
+	'EXCLUDED'	=> [
+			     qw{.perlcriticrc
+				.perltidyrc
+				t/00compile.t
+				t/pod.t
+				t/pod-coverage.t
+				t/Builder/reset_outputs.t
+				lib/Test/Builder/IO/Scalar.pm
+			       }
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Text::Balanced' =>
+	{
+	'MAINTAINER'	=> 'dmanura',
+	'DISTRIBUTION'	=> 'ADAMK/Text-Balanced-2.02.tar.gz',
+	'FILES'		=> q[cpan/Text-Balanced],
+	'EXCLUDED'	=> [ qw( t/97_meta.t t/98_pod.t t/99_pmv.t ) ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Text::ParseWords' =>
+	{
+	'MAINTAINER'	=> 'chorny',
+	'DISTRIBUTION'	=> 'CHORNY/Text-ParseWords-3.27.zip',
+	'FILES'		=> q[cpan/Text-ParseWords],
+	'EXCLUDED'	=> [ qw( t/pod.t ) ],
+	# For the benefit of make_ext.pl, we have to have this accessible:
+	'MAP'		=> {
+			     'ParseWords.pm' => 'cpan/Text-ParseWords/lib/Text/ParseWords.pm',
+			     ''              => 'cpan/Text-ParseWords/',
+			   },
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Text::Soundex' =>
+	{
+	'MAINTAINER'	=> 'markm',
+	'DISTRIBUTION'	=> 'MARKM/Text-Soundex-3.03.tar.gz',
+	'FILES'		=> q[cpan/Text-Soundex],
+	'MAP'		=> { ''               => 'cpan/Text-Soundex/',
+			     # XXX these two files are clearly related,
+			     # but they appear to have diverged
+			     # considerably over the years
+	                     'test.pl'        => 'cpan/Text-Soundex/t/Soundex.t',
+			   },
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Text-Tabs+Wrap' =>
+	{
+	'MAINTAINER'	=> 'muir',
+	'DISTRIBUTION'	=> 'MUIR/modules/Text-Tabs+Wrap-2009.0305.tar.gz',
+	'FILES'		=> q[cpan/Text-Tabs],
+	'EXCLUDED'	=> [ qw( t/dnsparks.t ) ], # see af6492bf9e
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Thread::Queue' =>
+	{
+	'MAINTAINER'	=> 'jdhedden',
+	'DISTRIBUTION'	=> 'JDHEDDEN/Thread-Queue-2.11.tar.gz',
+	'FILES'		=> q[dist/Thread-Queue],
+	'EXCLUDED'	=> [ qw(examples/queue.pl
+				t/00_load.t
+				t/99_pod.t
+				t/test.pl
+			       ) ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'Thread::Semaphore' =>
+	{
+	'MAINTAINER'	=> 'jdhedden',
+	'DISTRIBUTION'	=> 'JDHEDDEN/Thread-Semaphore-2.09.tar.gz',
+	'FILES'		=> q[dist/Thread-Semaphore],
+	'EXCLUDED'	=> [ qw(examples/semaphore.pl
+				t/00_load.t
+				t/99_pod.t
+				t/test.pl
+			       ) ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'threads' =>
+	{
+	'MAINTAINER'	=> 'jdhedden',
+	'DISTRIBUTION'	=> 'JDHEDDEN/threads-1.75.tar.gz',
+	'FILES'		=> q[dist/threads],
+	'EXCLUDED'	=> [ qw(examples/pool.pl
+				t/pod.t
+				t/test.pl
+				threads.h
+			       ) ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'threads::shared' =>
+	{
+	'MAINTAINER'	=> 'jdhedden',
+	'DISTRIBUTION'	=> 'JDHEDDEN/threads-shared-1.32.tar.gz',
+	'FILES'		=> q[dist/threads-shared],
+	'EXCLUDED'	=> [ qw(examples/class.pl
+				shared.h
+				t/pod.t
+				t/test.pl
+			       ) ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'Tie::File' =>
+	{
+	'MAINTAINER'	=> 'mjd',
+	'DISTRIBUTION'	=> 'MJD/Tie-File-0.96.tar.gz',
+	'FILES'		=> q[cpan/Tie-File],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Tie::RefHash' =>
+	{
+	'MAINTAINER'	=> 'nuffin',
+	'DISTRIBUTION'	=> 'NUFFIN/Tie-RefHash-1.38.tar.gz',
+	'FILES'		=> q[cpan/Tie-RefHash],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Time::HiRes' =>
+	{
+	'MAINTAINER'	=> 'zefram',
+	'DISTRIBUTION'	=> 'JHI/Time-HiRes-1.9719.tar.gz',
+	'FILES'		=> q[cpan/Time-HiRes],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Time::Local' =>
+	{
+	'MAINTAINER'	=> 'drolsky',
+	'DISTRIBUTION'	=> 'DROLSKY/Time-Local-1.1901.tar.gz',
+	'FILES'		=> q[ext/Time-Local],
+	'EXCLUDED'	=> [ qw(t/pod-coverage.t t/pod.t) ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	# Currently Time::Local is no longer backwards compatible with Pre-5.11 perls
+	# the version in core has now deviated from the CPAN version. To re-dual-life
+	# this module, we'll need to rewrite a hybrid version
+	},
+
+    'Time::Piece' =>
+	{
+	'MAINTAINER'	=> 'msergeant',
+	'DISTRIBUTION'	=> 'MSERGEANT/Time-Piece-1.15.tar.gz',
+	'FILES'		=> q[cpan/Time-Piece],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Unicode::Collate' =>
+	{
+	'MAINTAINER'	=> 'sadahiro',
+	'DISTRIBUTION'	=> 'SADAHIRO/Unicode-Collate-0.52.tar.gz',
+	'FILES'		=> q[cpan/Unicode-Collate],
+			    # ignore experimental XS version
+	'EXCLUDED'	=> [ qr{X$},
+			     qw{disableXS enableXS }
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'first-come',
+	},
+
+    'Unicode::Normalize' =>
+	{
+	'MAINTAINER'	=> 'sadahiro',
+	'DISTRIBUTION'	=> 'SADAHIRO/Unicode-Normalize-1.03.tar.gz',
+	'FILES'		=> q[cpan/Unicode-Normalize],
+	'EXCLUDED'	=> [ qw{MANIFEST.N Normalize.pmN disableXS enableXS }],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'first-come',
+	},
+
+    'version' =>
+	{
+	'MAINTAINER'	=> 'jpeacock',
+	'DISTRIBUTION'	=> 'JPEACOCK/version-0.77.tar.gz',
+	'FILES'		=> q[lib/version.pm lib/version.pod lib/version.t
+			     lib/version],
+	'EXCLUDED'	=> [ qr{^t/.*\.t$}, qw{t/survey_locales}, qr{^vutil/},
+			     qw{lib/version/typemap},
+			     qw{vperl/vpp.pm},
+			   ],
+	'MAP'		=> { 'lib/'	      => 'lib/',
+			     't/coretests.pm' => 'lib/version.t',
+			   },
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> undef,
+	},
+
+    'vms' =>
+	{
+	'MAINTAINER'	=> 'craig',
+	'FILES'		=> q[vms configure.com README.vms],
+	'CPAN'		=> 0,
+	'UPSTREAM'	=> undef,
+	},
+
+    'VMS::DCLsym' =>
+	{
+	'MAINTAINER'	=> 'craig',
+	'FILES'		=> q[ext/VMS-DCLsym],
+	'CPAN'		=> 0,
+	'UPSTREAM'	=> undef,
+	},
+
+    'VMS::Stdio' =>
+	{
+	'MAINTAINER'	=> 'craig',
+	'FILES'		=> q[ext/VMS-Stdio],
+	'CPAN'		=> 0,
+	'UPSTREAM'	=> undef,
+	},
+
+    'warnings' =>
+	{
+	'MAINTAINER'	=> 'pmqs',
+	'FILES'		=> q[warnings.pl
+			     lib/warnings.{pm,t}
+			     lib/warnings
+			     t/lib/warnings
+			    ],
+	'CPAN'		=> 0,
+	'UPSTREAM'	=> undef,
+	},
+
+    'win32' =>
+	{
+	'MAINTAINER'	=> 'jand',
+	'FILES'		=> q[win32 t/win32 README.win32 ext/Win32CORE],
+	'CPAN'		=> 0,
+	'UPSTREAM'	=> undef,
+	},
+
+    'Win32' =>
+	{
+	'MAINTAINER'	=> 'jand',
+	'DISTRIBUTION'	=> "JDB/Win32-0.39.tar.gz",
+	'FILES'		=> q[cpan/Win32],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'Win32API::File' =>
+	{
+	'MAINTAINER'	=> 'chorny',
+	'DISTRIBUTION'	=> 'CHORNY/Win32API-File-0.1101.zip',
+	'FILES'		=> q[cpan/Win32API-File],
+	'EXCLUDED'	=> [ qr{^ex/},
+			     qw{t/pod.t},
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'cpan',
+	},
+
+    'XS::APItest::KeywordRPN' =>
+	{
+	'MAINTAINER'	=> 'zefram',
+	'FILES'		=> q[ext/XS-APItest-KeywordRPN],
+	'CPAN'		=> 0,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    'XSLoader' =>
+	{
+	'MAINTAINER'	=> 'saper',
+	'DISTRIBUTION'	=> 'SAPER/XSLoader-0.10.tar.gz',
+	'FILES'		=> q[dist/XSLoader],
+	'EXCLUDED'	=> [ qr{^eg/},
+			     qw{t/pod.t
+			        t/podcover.t
+				t/portfs.t
+				XSLoader.pm}, # we use XSLoader_pm.PL
+			   ],
+	'CPAN'		=> 1,
+	'UPSTREAM'	=> 'blead',
+	},
+
+    's2p' =>
+	{
+	'MAINTAINER'	=> 'laun',
+	'FILES'		=> q[x2p/s2p.PL],
+	'CPAN'		=> 0,
+	'UPSTREAM'	=> undef,
+	},
+
+
+    # this pseudo-module represents all the files under ext/ and lib/
+    # that aren't otherwise claimed. This means that the following two
+    # commands will check that every file under ext/ and lib/ is
+    # accounted for, and that there are no duplicates:
+    #
+    #    perl Porting/Maintainers --checkmani lib ext
+    #    perl Porting/Maintainers --checkmani
+
+    '_PERLLIB' =>
+	{
+	'MAINTAINER'	=> 'p5p',
+	'FILES'		=> q[
+				ext/autouse/lib
+				ext/autouse/t
+				ext/B/B.pm
+				ext/B/typemap
+				ext/B/Makefile.PL
+				ext/B/defsubs_h.PL
+				ext/B/O.pm
+				ext/B/B.xs
+				ext/B/B/Terse.pm
+				ext/B/B/Showlex.pm
+				ext/B/B/Xref.pm
+				ext/B/t/f_map
+				ext/B/t/showlex.t
+				ext/B/t/o.t
+				ext/B/t/optree_varinit.t
+				ext/B/t/concise-xs.t
+				ext/B/t/optree_check.t
+				ext/B/t/OptreeCheck.pm
+				ext/B/t/optree_specials.t
+				ext/B/t/f_sort.t
+				ext/B/t/pragma.t
+				ext/B/t/f_sort
+				ext/B/t/b.t
+				ext/B/t/optree_samples.t
+				ext/B/t/optree_concise.t
+				ext/B/t/optree_constants.t
+				ext/B/t/optree_sort.t
+				ext/B/t/terse.t
+				ext/B/t/xref.t
+				ext/B/t/f_map.t
+				ext/B/t/optree_misc.t
+				ext/B/hints/openbsd.pl
+				ext/B/hints/darwin.pl
+
+				ext/Devel-DProf/
+				ext/Devel-Peek/
+				ext/Devel-SelfStubber/
+				ext/DynaLoader/
+				    !ext/DynaLoader/t/XSLoader.t
+				    !ext/DynaLoader/XSLoader_pm.PL
+				ext/Errno
+				ext/Fcntl/
+				ext/File-Glob/
+				ext/FileCache/lib
+				ext/FileCache/t
+				ext/GDBM_File/
+				ext/Hash-Util-FieldHash/
+				ext/Hash-Util/
+				ext/I18N-Langinfo/
+				ext/IPC-Open2/
+				ext/IPC-Open3/
+				ext/NDBM_File/
+				ext/ODBM_File/
+				ext/Opcode/
+				ext/POSIX/
+				ext/PerlIO-encoding/
+				ext/PerlIO-scalar/
+				ext/PerlIO-via/
+				ext/SDBM_File/
+				ext/Socket/
+				ext/Sys-Hostname/
+				ext/Tie-Memoize/
+				ext/XS-APItest/
+				ext/XS-Typemap/
+				ext/attributes/
+				ext/mro/
+				ext/re/
+				lib/AnyDBM_File.{pm,t}
+				lib/Benchmark.{pm,t}
+				lib/CORE.pod
+				lib/Carp.{pm,t}
+				lib/Carp/Heavy.pm
+				lib/Class/Struct.{pm,t}
+				lib/Config.t
+				lib/Config_git.pl
+				lib/Config/Extensions.{pm,t}
+				lib/DB.{pm,t}
+				lib/DBM_Filter.pm
+				lib/DBM_Filter/
+				lib/DirHandle.{pm,t}
+				lib/Dumpvalue.{pm,t}
+				lib/English.{pm,t}
+				lib/Env.pm
+				lib/Env/t/
+				lib/ExtUtils/Embed.pm
+				lib/ExtUtils/XSSymSet.pm
+				lib/ExtUtils/t/Embed.t
+				lib/ExtUtils/typemap
+				lib/File/Basename.{pm,t}
+				lib/File/CheckTree.{pm,t}
+				lib/File/Compare.{pm,t}
+				lib/File/Copy.{pm,t}
+				lib/File/DosGlob.{pm,t}
+				lib/File/Find.pm
+				lib/File/Find/
+				lib/File/stat.{pm,t}
+				lib/FileHandle.{pm,t}
+				lib/FindBin.{pm,t}
+				lib/Getopt/Std.{pm,t}
+				lib/I18N/Collate.{pm,t}
+				lib/Internals.t
+				lib/Module/Build/ConfigData.pm
+				lib/Net/hostent.{pm,t}
+				lib/Net/netent.{pm,t}
+				lib/Net/protoent.{pm,t}
+				lib/Net/servent.{pm,t}
+				lib/PerlIO.pm
+				lib/Pod/Functions.pm
+				lib/Pod/Html.pm
+				lib/Pod/t/Functions.t
+				lib/Pod/t/InputObjects.t
+				lib/Pod/t/Select.t
+				lib/Pod/t/Usage.t
+				lib/Pod/t/eol.t
+				lib/Pod/t/html*
+				lib/Pod/t/pod2html-lib.pl
+				lib/Pod/t/utils.t
+				lib/Search/Dict.{pm,t}
+				lib/SelectSaver.{pm,t}
+				lib/Symbol.{pm,t}
+				lib/Term/Complete.{pm,t}
+				lib/Term/ReadLine.{pm,t}
+				lib/Text/Abbrev.{pm,t}
+				lib/Thread.{pm,t}
+				lib/Tie/Array.pm
+				lib/Tie/Array/
+				lib/Tie/Handle.pm
+				lib/Tie/Handle/
+				lib/Tie/Hash.pm
+				lib/Tie/Hash/NamedCapture.pm
+				lib/Tie/Scalar.{pm,t}
+				lib/Tie/StdHandle.pm
+				lib/Tie/SubstrHash.{pm,t}
+				lib/Time/gmtime.{pm,t}
+				lib/Time/localtime.{pm,t}
+				lib/Time/tm.pm
+				lib/UNIVERSAL.pm
+				lib/Unicode/README
+				lib/Unicode/UCD.{pm,t}
+				lib/User/grent.{pm,t}
+				lib/User/pwent.{pm,t}
+				lib/abbrev.pl
+				lib/assert.pl
+				lib/bigfloat{.pl,pl.t}
+				lib/bigint{.pl,pl.t}
+				lib/bigrat.pl
+				lib/blib.{pm,t}
+				lib/bytes.{pm,t}
+				lib/bytes_heavy.pl
+				lib/cacheout.pl
+				lib/charnames.{pm,t}
+				lib/complete.pl
+				lib/ctime.pl
+				lib/dbm_filter_util.pl
+				lib/deprecate.pm
+				lib/diagnostics.{pm,t}
+				lib/dotsh.pl
+				lib/dumpvar.{pl,t}
+				lib/exceptions.pl
+				lib/fastcwd.pl
+				lib/feature.{pm,t}
+				lib/feature/
+				lib/filetest.{pm,t}
+				lib/find.pl
+				lib/finddepth.pl
+				lib/flush.pl
+				lib/getcwd.pl
+				lib/getopt.pl
+				lib/getopts.pl
+				lib/h2ph.t
+				lib/h2xs.t
+				lib/hostname.pl
+				lib/importenv.pl
+				lib/integer.{pm,t}
+				lib/legacy.{pm,t}
+				lib/less.{pm,t}
+				lib/locale.{pm,t}
+				lib/look.pl
+				lib/open.{pm,t}
+				lib/open2.pl
+				lib/open3.pl
+				lib/overload{.pm,.t,64.t}
+				lib/overload/numbers.pm
+				lib/overloading.{pm,t}
+				lib/perl5db.{pl,t}
+				lib/perl5db/
+				lib/pwd.pl
+				lib/shellwords.pl
+				lib/sigtrap.{pm,t}
+				lib/sort.{pm,t}
+				lib/stat.pl
+				lib/strict.{pm,t}
+				lib/subs.{pm,t}
+				lib/syslog.pl
+				lib/tainted.pl
+				lib/termcap.pl
+				lib/timelocal.pl
+				lib/unicore/
+				lib/utf8.{pm,t}
+				lib/utf8_heavy.pl
+				lib/validate.pl
+				lib/vars{.pm,.t,_carp.t}
+				lib/vmsish.{pm,t}
+			    ],
+	'CPAN'		=> 0,
+	'UPSTREAM'	=> undef,
+	},
+);
 
 1;
Index: src/gnu/usr.bin/perl/Porting/config_H
diff -u src/gnu/usr.bin/perl/Porting/config_H:1.11 src/gnu/usr.bin/perl/Porting/config_H:1.12
--- Porting/config_H:1.11	Mon Oct 12 18:24:22 2009
+++ Porting/config_H	Fri Sep 24 15:06:44 2010
@@ -952,8 +952,8 @@
  *	This symbol contains the ~name expanded version of ARCHLIB, to be used
  *	in programs that are not prepared to deal with ~ expansion at run-time.
  */
-#define ARCHLIB "/pro/lib/perl5/5.11.0/i686-linux-64int"		/**/
-#define ARCHLIB_EXP "/pro/lib/perl5/5.11.0/i686-linux-64int"		/**/
+#define ARCHLIB "/pro/lib/perl5/5.12.2/i686-linux-64int"		/**/
+#define ARCHLIB_EXP "/pro/lib/perl5/5.12.2/i686-linux-64int"		/**/
 
 /* ARCHNAME:
  *	This symbol holds a string representing the architecture name.
@@ -2594,8 +2594,8 @@
  *	This symbol contains the ~name expanded version of PRIVLIB, to be used
  *	in programs that are not prepared to deal with ~ expansion at run-time.
  */
-#define PRIVLIB "/pro/lib/perl5/5.11.0"		/**/
-#define PRIVLIB_EXP "/pro/lib/perl5/5.11.0"		/**/
+#define PRIVLIB "/pro/lib/perl5/5.12.2"		/**/
+#define PRIVLIB_EXP "/pro/lib/perl5/5.12.2"		/**/
 
 /* CAN_PROTOTYPE:
  *	If defined, this macro indicates that the C compiler can handle
@@ -2687,8 +2687,8 @@
  *	This symbol contains the ~name expanded version of SITEARCH, to be used
  *	in programs that are not prepared to deal with ~ expansion at run-time.
  */
-#define SITEARCH "/pro/lib/perl5/site_perl/5.11.0/i686-linux-64int"		/**/
-#define SITEARCH_EXP "/pro/lib/perl5/site_perl/5.11.0/i686-linux-64int"		/**/
+#define SITEARCH "/pro/lib/perl5/site_perl/5.12.2/i686-linux-64int"		/**/
+#define SITEARCH_EXP "/pro/lib/perl5/site_perl/5.12.2/i686-linux-64int"		/**/
 
 /* SITELIB:
  *	This symbol contains the name of the private library for this package.
@@ -2710,8 +2710,8 @@
  *	removed.  The elements in inc_version_list (inc_version_list.U) can
  *	be tacked onto this variable to generate a list of directories to search.
  */
-#define SITELIB "/pro/lib/perl5/site_perl/5.11.0"		/**/
-#define SITELIB_EXP "/pro/lib/perl5/site_perl/5.11.0"		/**/
+#define SITELIB "/pro/lib/perl5/site_perl/5.12.2"		/**/
+#define SITELIB_EXP "/pro/lib/perl5/site_perl/5.12.2"		/**/
 #define SITELIB_STEM "/pro/lib/perl5/site_perl"		/**/
 
 /* Size_t_size:
@@ -4439,7 +4439,7 @@
  *	script to make sure (one hopes) that it runs with perl and not
  *	some shell.
  */
-#define STARTPERL "#!/pro/bin/perl5.11.0"		/**/
+#define STARTPERL "#!/pro/bin/perl5.12.2"		/**/
 
 /* HAS_STDIO_STREAM_ARRAY:
  *	This symbol, if defined, tells that there is an array
Index: src/gnu/usr.bin/perl/Porting/makerel
diff -u src/gnu/usr.bin/perl/Porting/makerel:1.8 src/gnu/usr.bin/perl/Porting/makerel:1.9
--- Porting/makerel:1.8	Mon Oct 12 18:24:22 2009
+++ Porting/makerel	Fri Sep 24 15:06:44 2010
@@ -1,11 +1,25 @@
 #!/usr/bin/perl -w
 
-# A first attempt at some automated support for making a perl release.
+# A tool to build a perl release tarball
 # Very basic but functional - if you're on a unix system.
 #
+# If you're on Win32 then it should still work, but various Unix command-line
+# tools will need to be available somewhere. An obvious choice is to install
+# Cygwin and ensure its 'bin' folder is on the PATH in the shell where you run
+# this script. The Cygwin 'bin' folder needs to precede the Windows 'system32'
+# folder so that Cygwin's 'find' command is found in preference to the Windows
+# 'find' command. Your Cygwin installation will need to contain at least the
+# 'cpio' command, in addition to the commands installed by default, and it will
+# also be useful to have 'curl' and 'diffstat' installed too for later stages
+# of the release process (namely, Porting\corelist.pl and generating the commit
+# statistics for the perlXYZdelta.pod file respectively). Finally, ensure that
+# the 'awk' and 'shasum' commands are copies of gawk.exe and sha1sum.exe
+# respectively, rather the links to them that only work in a Cygwin bash shell
+# which they are by default.
+#
 # No matter how automated this gets, you'll always need to read
-# and re-read pumpkin.pod checking for things to be done at various
-# stages of the process.
+# and re-read pumpkin.pod and release_managers_guide.pod to
+# check for things to be done at various stages of the process.
 #
 # Tim Bunce, June 1997
 
@@ -16,17 +30,18 @@
 $|=1;
 
 sub usage { die <<EOF; }
-usage: $0 [ -r rootdir ] [-s suffix ] [ -b ]
+usage: $0 [ -r rootdir ] [-s suffix ] [ -b ] [ -n ]
     -r rootdir   directory under which to create the build dir and tarball
                  defaults to '..'
     -s suffix    suffix to append to to the perl-x.y.z dir and tarball name
 		 defaults to the concatenaion of the local_patches entry
 		 in patchlevel.h (or blank, if none)
     -b           make a .bz2 file in addtion to a .gz file
+    -n           do not make any tarballs, just the directory
 EOF
 
 my %opts;
-getopts('br:s:', \%opts) or usage;
+getopts('bnr:s:', \%opts) or usage;
 @ARGV && usage;
 
 $relroot = defined $opts{r} ? $opts{r} : "..";
@@ -101,11 +116,14 @@
 
 chdir "$relroot/$reldir" or die $!;
 
+
+my $SEARCH_ROOTS = 't ext lib dist cpan';
+
 print "Setting file permissions...\n";
 system("find . -type f -print     | xargs chmod 0444");
 system("find . -type d -print     | xargs chmod 0755");
-system("find t ext lib -name '*.t'     -print | xargs chmod +x");
-system("find t ext lib -name 'test.pl' -print | xargs chmod +x");
+system("find $SEARCH_ROOTS -name '*.t'     -print | xargs chmod +x");
+system("find $SEARCH_ROOTS -name 'test.pl' -print | xargs chmod +x");
 my @exe = qw(
     Configure
     configpm
@@ -117,7 +135,6 @@
     opcode.pl
     t/TEST
     *.SH
-    vms/ext/Stdio/test.pl
     vms/ext/filespec.t
     x2p/*.SH
     Porting/findrfuncs
@@ -148,8 +165,8 @@
     overload.h
     perlapi.h
     perlapi.c
-    ext/Devel-PPPort/module2.c
-    ext/Devel-PPPort/module3.c
+    cpan/Devel-PPPort/module2.c
+    cpan/Devel-PPPort/module3.c
     reentr.c
     reentr.h
     regcharclass.h
@@ -168,32 +185,10 @@
 system("chmod +w @writables") == 0
     or die "system: $!";
 
-print "Adding CRs to DOSish files...\n";
-# This list is also in curliff.pl.
-my @crlf = qw(
-    djgpp/configure.bat
-    README.ce
-    README.dos
-    README.symbian
-    README.win32
-    symbian/config.pl
-    symbian/makesis.pl
-    symbian/README
-    symbian/xsbuild.pl
-    win32/Makefile
-    win32/Makefile.ce
-    win32/ce-helpers/compile-all.bat
-    win32/ce-helpers/compile.bat
-    win32/ce-helpers/registry.bat
-    win32/distclean.bat
-    win32/makefile.mk
-);
-system("perl -pi -e 's/\\015*\\012/\\015\\012/' @crlf") == 0
-    or die "system: $!";
-print "\n";
-
 chdir ".." or die $!;
 
+exit if $opts{n};
+
 my $src = (-e $perl) ? $perl : 'perl'; # 'perl' in maint branch
 
 print "Creating and compressing the tar.gz file...\n";
@@ -211,8 +206,9 @@
 system("ls -ld $perl*");
 print "\n";
 
+my $null = $^O eq 'MSWin32' ? 'NUL' : '/dev/null';
 for my $sha (qw(sha1 shasum sha1sum)) {
-    if (`which $sha 2>/dev/null`) {
+    if (`which $sha 2>$null`) {
 	system("$sha $perl*.tar.*");
 	last;
     }
Index: src/gnu/usr.bin/perl/Porting/pumpkin.pod
diff -u src/gnu/usr.bin/perl/Porting/pumpkin.pod:1.10 src/gnu/usr.bin/perl/Porting/pumpkin.pod:1.11
--- Porting/pumpkin.pod:1.10	Mon Oct 12 18:24:22 2009
+++ Porting/pumpkin.pod	Fri Sep 24 15:06:44 2010
@@ -470,7 +470,7 @@
 
 =head2 PPPort
 
-F<ext/Devel-PPPort/PPPort.pm> needs to be synchronized to include all
+F<cpan/Devel-PPPort/PPPort.pm> needs to be synchronized to include all
 new macros added to .h files (normally perl.h and XSUB.h, but others
 as well). Since chances are that when a new macro is added the
 committer will forget to update F<PPPort.pm>, it's the best to diff for
Index: src/gnu/usr.bin/perl/cpan/CGI/lib/CGI/Fast.pm
diff -u src/gnu/usr.bin/perl/cpan/CGI/lib/CGI/Fast.pm:1.1 src/gnu/usr.bin/perl/cpan/CGI/lib/CGI/Fast.pm:1.2
--- cpan/CGI/lib/CGI/Fast.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CGI/lib/CGI/Fast.pm	Fri Sep 24 15:06:44 2010
@@ -181,7 +181,7 @@
 =item FCGI_SOCKET_PATH
 
 The address (TCP/IP) or path (UNIX Domain) of the socket the external FastCGI
-script to which bind an listen for incoming connections from the web server.
+script to which bind can listen for incoming connections from the web server.
 
 =item FCGI_LISTEN_QUEUE
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Backend.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Backend.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Backend.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Backend.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Backend.pm	Fri Sep 24 15:06:44 2010
@@ -36,7 +36,7 @@
 
 =head1 NAME
 
-CPANPLUS::Backend
+CPANPLUS::Backend - programmer's interface to the CPANPLUS module
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Config.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Config.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Config.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Config.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Config.pm	Fri Sep 24 15:06:44 2010
@@ -24,7 +24,7 @@
 
 =head1 NAME
 
-CPANPLUS::Config
+CPANPLUS::Config - defaults and heuristics for CPANPLUS configuration information
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Configure.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Configure.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Configure.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Configure.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Configure.pm	Fri Sep 24 15:06:44 2010
@@ -39,7 +39,7 @@
 
 =head1 NAME
 
-CPANPLUS::Configure
+CPANPLUS::Configure - configuration for CPANPLUS
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Dist.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Dist.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Dist.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Dist.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Dist.pm	Fri Sep 24 15:06:45 2010
@@ -22,7 +22,7 @@
 
 =head1 NAME
 
-CPANPLUS::Dist
+CPANPLUS::Dist - base class for CPANPLUS::Dist::MM and CPANPLUS::Dist::Build
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Error.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Error.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Error.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Error.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Error.pm	Fri Sep 24 15:06:45 2010
@@ -8,7 +8,7 @@
 
 =head1 NAME
 
-CPANPLUS::Error
+CPANPLUS::Error - error handling for CPANPLUS
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/FAQ.pod
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/FAQ.pod:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/FAQ.pod:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/FAQ.pod:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/FAQ.pod	Fri Sep 24 15:06:45 2010
@@ -2,7 +2,7 @@
 
 =head1 NAME
 
-CPANPLUS::FAQ
+CPANPLUS::FAQ - CPANPLUS frequently asked questions
 
 =head1 DESCRIPTION
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Hacking.pod
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Hacking.pod:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Hacking.pod:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Hacking.pod:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Hacking.pod	Fri Sep 24 15:06:45 2010
@@ -2,7 +2,7 @@
 
 =head1 NAME
 
-CPANPLUS::Hacking
+CPANPLUS::Hacking - developing with the CPANPLUS environment
 
 =head1 DESCRIPTION
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Internals.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Internals.pm	Fri Sep 24 15:06:45 2010
@@ -48,7 +48,7 @@
 
 =head1 NAME
 
-CPANPLUS::Internals
+CPANPLUS::Internals - CPANPLUS internals
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Module.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Module.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Module.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Module.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Module.pm	Fri Sep 24 15:06:45 2010
@@ -27,7 +27,7 @@
 
 =head1 NAME
 
-CPANPLUS::Module
+CPANPLUS::Module - create objects from source files
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Selfupdate.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Selfupdate.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Selfupdate.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Selfupdate.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Selfupdate.pm	Fri Sep 24 15:06:45 2010
@@ -12,7 +12,7 @@
 
 =head1 NAME
 
-CPANPLUS::Selfupdate
+CPANPLUS::Selfupdate - update CPANPLUS itself
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Shell.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Shell.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Shell.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Shell.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Shell.pm	Fri Sep 24 15:06:45 2010
@@ -20,7 +20,7 @@
 
 =head1 NAME
 
-CPANPLUS::Shell
+CPANPLUS::Shell - base class for all CPANPLUS shells
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Backend/RV.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Backend/RV.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Backend/RV.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Backend/RV.pm:1.1	Fri Sep 24 14:49:04 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Backend/RV.pm	Fri Sep 24 15:06:45 2010
@@ -19,7 +19,7 @@
 
 =head1 NAME
 
-CPANPLUS::Backend::RV
+CPANPLUS::Backend::RV - return value objects for multi-module calls to CPANPLUS::Backend
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Dist/Autobundle.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Dist/Autobundle.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Dist/Autobundle.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Dist/Autobundle.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Dist/Autobundle.pm	Fri Sep 24 15:06:45 2010
@@ -10,7 +10,7 @@
 
 =head1 NAME
 
-CPANPLUS::Dist::Autobundle
+CPANPLUS::Dist::Autobundle - class for installing installation snapshots
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Dist/MM.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Dist/MM.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Dist/MM.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Dist/MM.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Dist/MM.pm	Fri Sep 24 15:06:45 2010
@@ -23,7 +23,7 @@
 
 =head1 NAME
 
-CPANPLUS::Dist::MM
+CPANPLUS::Dist::MM - distribution class for MakeMaker related modules
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals/Extract.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals/Extract.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals/Extract.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Internals/Extract.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Internals/Extract.pm	Fri Sep 24 15:06:45 2010
@@ -19,7 +19,7 @@
 
 =head1 NAME
 
-CPANPLUS::Internals::Extract
+CPANPLUS::Internals::Extract - extract compressed files for CPANPLUS
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals/Fetch.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals/Fetch.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals/Fetch.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Internals/Fetch.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Internals/Fetch.pm	Fri Sep 24 15:06:45 2010
@@ -19,7 +19,7 @@
 
 =head1 NAME
 
-CPANPLUS::Internals::Fetch
+CPANPLUS::Internals::Fetch - fetch files for CPANPLUS
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals/Report.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals/Report.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals/Report.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Internals/Report.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Internals/Report.pm	Fri Sep 24 15:06:45 2010
@@ -19,7 +19,7 @@
 
 =head1 NAME
 
-CPANPLUS::Internals::Report
+CPANPLUS::Internals::Report -  send test reports to http://testers.cpan.org
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals/Search.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals/Search.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals/Search.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Internals/Search.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Internals/Search.pm	Fri Sep 24 15:06:45 2010
@@ -19,7 +19,7 @@
 
 =head1 NAME
 
-CPANPLUS::Internals::Search
+CPANPLUS::Internals::Search - find CPAN modules
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals/Source.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals/Source.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals/Source.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Internals/Source.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Internals/Source.pm	Fri Sep 24 15:06:45 2010
@@ -74,7 +74,7 @@
 
 =head1 NAME
 
-CPANPLUS::Internals::Source
+CPANPLUS::Internals::Source - updating and parsing of source files for CPANPLUS
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals/Utils.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals/Utils.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals/Utils.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Internals/Utils.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Internals/Utils.pm	Fri Sep 24 15:06:45 2010
@@ -17,7 +17,7 @@
 
 =head1 NAME
 
-CPANPLUS::Internals::Utils
+CPANPLUS::Internals::Utils - convenience functions for CPANPLUS
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals/Source/Memory.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals/Source/Memory.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Internals/Source/Memory.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Internals/Source/Memory.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Internals/Source/Memory.pm	Fri Sep 24 15:06:45 2010
@@ -191,6 +191,8 @@
 
 =pod
 
+=head1 SYNOPSIS
+
 =head2 $cb->__memory_retrieve_source(name => $name, [path => $path, uptodate => BOOL, verbose => BOOL])
 
 This method retrieves a I<storable>d tree identified by C<$name>.
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Module/Author.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Module/Author.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Module/Author.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Module/Author.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Module/Author.pm	Fri Sep 24 15:06:45 2010
@@ -13,7 +13,7 @@
 
 =head1 NAME
 
-CPANPLUS::Module::Author
+CPANPLUS::Module::Author - CPANPLUS module author class
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Module/Checksums.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Module/Checksums.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Module/Checksums.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Module/Checksums.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Module/Checksums.pm	Fri Sep 24 15:06:45 2010
@@ -19,7 +19,7 @@
 
 =head1 NAME
 
-CPANPLUS::Module::Checksums
+CPANPLUS::Module::Checksums - distribution checksum validation
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Module/Fake.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Module/Fake.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Module/Fake.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Module/Fake.pm:1.1	Fri Sep 24 14:49:04 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Module/Fake.pm	Fri Sep 24 15:06:45 2010
@@ -17,7 +17,7 @@
 
 =head1 NAME
 
-CPANPLUS::Module::Fake
+CPANPLUS::Module::Fake - class for creating fake module objects
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Module/Author/Fake.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Module/Author/Fake.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Module/Author/Fake.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Module/Author/Fake.pm:1.1	Fri Sep 24 14:49:04 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Module/Author/Fake.pm	Fri Sep 24 15:06:45 2010
@@ -17,7 +17,7 @@
 
 =head1 NAME
 
-CPANPLUS::Module::Author::Fake
+CPANPLUS::Module::Author::Fake - class for creating fake author objects
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Shell/Default.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Shell/Default.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Shell/Default.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Shell/Default.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Shell/Default.pm	Fri Sep 24 15:06:45 2010
@@ -73,7 +73,7 @@
 
 =head1 NAME
 
-CPANPLUS::Shell::Default
+CPANPLUS::Shell::Default - default CPANPLUS user interface
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/CustomSource.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/CustomSource.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/CustomSource.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/CustomSource.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/CustomSource.pm	Fri Sep 24 15:06:45 2010
@@ -9,7 +9,7 @@
 
 =head1 NAME
 
-CPANPLUS::Shell::Default::Plugins::CustomSource 
+CPANPLUS::Shell::Default::Plugins::CustomSource - plugin support for the CPANPLUS shell
 
 =head1 SYNOPSIS
     
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/Remote.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/Remote.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/Remote.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/Remote.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/Remote.pm	Fri Sep 24 15:06:45 2010
@@ -9,7 +9,7 @@
 
 =head1 NAME
 
-CPANPLUS::Shell::Default::Plugins::Remote
+CPANPLUS::Shell::Default::Plugins::Remote - plugin that allows connections to CPANPLUS::Daemon
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/Source.pm
diff -u src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/Source.pm:1.1 src/gnu/usr.bin/perl/cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/Source.pm:1.2
--- cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/Source.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/CPANPLUS/lib/CPANPLUS/Shell/Default/Plugins/Source.pm	Fri Sep 24 15:06:45 2010
@@ -6,7 +6,7 @@
 
 =head1 NAME
 
-CPANPLUS::Shell::Default::Plugins::Source 
+CPANPLUS::Shell::Default::Plugins::Source - plugin to read an execute CPANPLUS shell commands
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/Compress-Raw-Bzip2/private/MakeUtil.pm
diff -u src/gnu/usr.bin/perl/cpan/Compress-Raw-Bzip2/private/MakeUtil.pm:1.1 src/gnu/usr.bin/perl/cpan/Compress-Raw-Bzip2/private/MakeUtil.pm:1.2
--- cpan/Compress-Raw-Bzip2/private/MakeUtil.pm:1.1	Fri Sep 24 14:49:06 2010
+++ cpan/Compress-Raw-Bzip2/private/MakeUtil.pm	Fri Sep 24 15:06:45 2010
@@ -35,7 +35,8 @@
     my $path = shift;
 
     return undef
-        if $path =~ /(~|\.bak|_bak)$/ ||
+        if $path =~ /^(?:RCS|CVS|SCCS|\.svn|_darcs)$/ ||
+           $path =~ /(~|\.bak|_bak)$/ ||
            $path =~ /\..*\.sw(o|p)$/  ||
            $path =~ /\B\.svn\b/;
 
Index: src/gnu/usr.bin/perl/cpan/Compress-Raw-Zlib/private/MakeUtil.pm
diff -u src/gnu/usr.bin/perl/cpan/Compress-Raw-Zlib/private/MakeUtil.pm:1.1 src/gnu/usr.bin/perl/cpan/Compress-Raw-Zlib/private/MakeUtil.pm:1.2
--- cpan/Compress-Raw-Zlib/private/MakeUtil.pm:1.1	Fri Sep 24 14:49:05 2010
+++ cpan/Compress-Raw-Zlib/private/MakeUtil.pm	Fri Sep 24 15:06:45 2010
@@ -35,7 +35,8 @@
     my $path = shift;
 
     return undef
-        if $path =~ /(~|\.bak|_bak)$/ ||
+        if $path =~ /^(?:RCS|CVS|SCCS|\.svn|_darcs)$/ ||
+           $path =~ /(~|\.bak|_bak)$/ ||
            $path =~ /\..*\.sw(o|p)$/  ||
            $path =~ /\B\.svn\b/;
 
Index: src/gnu/usr.bin/perl/cpan/Digest-MD5/Changes
diff -u src/gnu/usr.bin/perl/cpan/Digest-MD5/Changes:1.1 src/gnu/usr.bin/perl/cpan/Digest-MD5/Changes:1.2
--- cpan/Digest-MD5/Changes:1.1	Fri Sep 24 14:49:04 2010
+++ cpan/Digest-MD5/Changes	Fri Sep 24 15:06:46 2010
@@ -364,7 +364,7 @@
    Avoid LONG and BYTE types in SHA.xs as they was in conflict
    with similar definitions in <winnt.h>.
 
-   Patch by Marko Asplund <aspa@hip.fi> to make the the alignment
+   Patch by Marko Asplund <aspa@hip.fi> to make the alignment
    test program link successfully with sfio-perl.
 
    Fixed a typo in MD5.xs that might have affected 64-bit systems.
Index: src/gnu/usr.bin/perl/cpan/Digest-MD5/MD5.xs
diff -u src/gnu/usr.bin/perl/cpan/Digest-MD5/MD5.xs:1.1 src/gnu/usr.bin/perl/cpan/Digest-MD5/MD5.xs:1.2
--- cpan/Digest-MD5/MD5.xs:1.1	Fri Sep 24 14:49:04 2010
+++ cpan/Digest-MD5/MD5.xs	Fri Sep 24 15:06:46 2010
@@ -39,6 +39,8 @@
 #include "EXTERN.h"
 #include "perl.h"
 #include "XSUB.h"
+#include <sys/types.h>
+#include <md5.h>
 #ifdef __cplusplus
 }
 #endif
@@ -63,403 +65,6 @@
    #define DOWARN PL_dowarn
 #endif
 
-#ifdef SvPVbyte
-   #if PERL_REVISION == 5 && PERL_VERSION < 7
-       /* SvPVbyte does not work in perl-5.6.1, borrowed version for 5.7.3 */
-       #undef SvPVbyte
-       #define SvPVbyte(sv, lp) \
-	  ((SvFLAGS(sv) & (SVf_POK|SVf_UTF8)) == (SVf_POK) \
-     	   ? ((lp = SvCUR(sv)), SvPVX(sv)) : my_sv_2pvbyte(aTHX_ sv, &lp))
-
-       static char *
-       my_sv_2pvbyte(pTHX_ register SV *sv, STRLEN *lp)
-       {
-	   sv_utf8_downgrade(sv,0);
-           return SvPV(sv,*lp);
-       }
-   #endif
-#else
-   #define SvPVbyte SvPV
-#endif
-
-#ifndef dTHX
-   #define pTHX_
-   #define aTHX_
-#endif
-
-/* Perl does not guarantee that U32 is exactly 32 bits.  Some system
- * has no integral type with exactly 32 bits.  For instance, A Cray has
- * short, int and long all at 64 bits so we need to apply this macro
- * to reduce U32 values to 32 bits at appropriate places. If U32
- * really does have 32 bits then this is a no-op.
- */
-#if BYTEORDER > 0x4321 || defined(TRUNCATE_U32)
-  #define TO32(x)    ((x) &  0xFFFFffff)
-  #define TRUNC32(x) ((x) &= 0xFFFFffff)
-#else
-  #define TO32(x)    (x)
-  #define TRUNC32(x) /*nothing*/
-#endif
-
-/* The MD5 algorithm is defined in terms of little endian 32-bit
- * values.  The following macros (and functions) allow us to convert
- * between native integers and such values.
- */
-#undef BYTESWAP
-#ifndef U32_ALIGNMENT_REQUIRED
- #if BYTEORDER == 0x1234      /* 32-bit little endian */
-  #define BYTESWAP(x) (x)     /* no-op */
-
- #elif BYTEORDER == 0x4321    /* 32-bit big endian */
-  #define BYTESWAP(x) 	((((x)&0xFF)<<24)	\
-			|(((x)>>24)&0xFF)	\
-			|(((x)&0x0000FF00)<<8)	\
-			|(((x)&0x00FF0000)>>8)	)
- #endif
-#endif
-
-#ifndef BYTESWAP
-static void u2s(U32 u, U8* s)
-{
-    *s++ = (U8)(u         & 0xFF);
-    *s++ = (U8)((u >>  8) & 0xFF);
-    *s++ = (U8)((u >> 16) & 0xFF);
-    *s   = (U8)((u >> 24) & 0xFF);
-}
-
-#define s2u(s,u) ((u) =  (U32)(*s)            |  \
-                        ((U32)(*(s+1)) << 8)  |  \
-                        ((U32)(*(s+2)) << 16) |  \
-                        ((U32)(*(s+3)) << 24))
-#endif
-
-#define MD5_CTX_SIGNATURE 200003165
-
-/* This stucture keeps the current state of algorithm.
- */
-typedef struct {
-  U32 signature;   /* safer cast in get_md5_ctx() */
-  U32 A, B, C, D;  /* current digest */
-  U32 bytes_low;   /* counts bytes in message */
-  U32 bytes_high;  /* turn it into a 64-bit counter */
-  U8 buffer[128];  /* collect complete 64 byte blocks */
-} MD5_CTX;
-
-
-/* Padding is added at the end of the message in order to fill a
- * complete 64 byte block (- 8 bytes for the message length).  The
- * padding is also the reason the buffer in MD5_CTX have to be
- * 128 bytes.
- */
-static const unsigned char PADDING[64] = {
-  0x80, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
-  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
-  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
-};
-
-/* Constants for MD5Transform routine.
- */
-#define S11 7
-#define S12 12
-#define S13 17
-#define S14 22
-#define S21 5
-#define S22 9
-#define S23 14
-#define S24 20
-#define S31 4
-#define S32 11
-#define S33 16
-#define S34 23
-#define S41 6
-#define S42 10
-#define S43 15
-#define S44 21
-
-/* F, G, H and I are basic MD5 functions.
- */
-#define F(x, y, z) ((((x) & ((y) ^ (z))) ^ (z)))
-#define G(x, y, z) F(z, x, y)
-#define H(x, y, z) ((x) ^ (y) ^ (z))
-#define I(x, y, z) ((y) ^ ((x) | (~z)))
-
-/* ROTATE_LEFT rotates x left n bits.
- */
-#define ROTATE_LEFT(x, n) (((x) << (n) | ((x) >> (32-(n)))))
-
-/* FF, GG, HH, and II transformations for rounds 1, 2, 3, and 4.
- * Rotation is separate from addition to prevent recomputation.
- */
-#define FF(a, b, c, d, s, ac)                    \
- (a) += F ((b), (c), (d)) + (NEXTx) + (U32)(ac); \
- TRUNC32((a));                                   \
- (a) = ROTATE_LEFT ((a), (s));                   \
- (a) += (b);                                     \
- TRUNC32((a));
-
-#define GG(a, b, c, d, x, s, ac)                 \
- (a) += G ((b), (c), (d)) + X[x] + (U32)(ac);    \
- TRUNC32((a));                                   \
- (a) = ROTATE_LEFT ((a), (s));                   \
- (a) += (b);                                     \
- TRUNC32((a));
-
-#define HH(a, b, c, d, x, s, ac)                 \
- (a) += H ((b), (c), (d)) + X[x] + (U32)(ac);    \
- TRUNC32((a));                                   \
- (a) = ROTATE_LEFT ((a), (s));                   \
- (a) += (b);                                     \
- TRUNC32((a));
-
-#define II(a, b, c, d, x, s, ac)                 \
- (a) += I ((b), (c), (d)) + X[x] + (U32)(ac);    \
- TRUNC32((a));                                   \
- (a) = ROTATE_LEFT ((a), (s));                   \
- (a) += (b);                                     \
- TRUNC32((a));
-
-
-static void
-MD5Init(MD5_CTX *ctx)
-{
-  /* Start state */
-  ctx->A = 0x67452301;
-  ctx->B = 0xefcdab89;
-  ctx->C = 0x98badcfe;
-  ctx->D = 0x10325476;
-
-  /* message length */
-  ctx->bytes_low = ctx->bytes_high = 0;
-}
-
-
-static void
-MD5Transform(MD5_CTX* ctx, const U8* buf, STRLEN blocks)
-{
-#ifdef MD5_DEBUG
-    static int tcount = 0;
-#endif
-
-    U32 A = ctx->A;
-    U32 B = ctx->B;
-    U32 C = ctx->C;
-    U32 D = ctx->D;
-
-#ifndef U32_ALIGNMENT_REQUIRED
-    const U32 *x = (U32*)buf;  /* really just type casting */
-#endif
-
-    do {
-	U32 a = A;
-	U32 b = B;
-	U32 c = C;
-	U32 d = D;
-
-#if BYTEORDER == 0x1234 && !defined(U32_ALIGNMENT_REQUIRED)
-	const U32 *X = x;
-        #define NEXTx  (*x++)
-#else
-	U32 X[16];      /* converted values, used in round 2-4 */
-	U32 *uptr = X;
-	U32 tmp;
- #ifdef BYTESWAP
-        #define NEXTx  (tmp=*x++, *uptr++ = BYTESWAP(tmp))
- #else
-        #define NEXTx  (s2u(buf,tmp), buf += 4, *uptr++ = tmp)
- #endif
-#endif
-
-#ifdef MD5_DEBUG
-	if (buf == ctx->buffer)
-	    fprintf(stderr,"%5d: Transform ctx->buffer", ++tcount);
-	else 
-	    fprintf(stderr,"%5d: Transform %p (%d)", ++tcount, buf, blocks);
-
-	{
-	    int i;
-	    fprintf(stderr,"[");
-	    for (i = 0; i < 16; i++) {
-		fprintf(stderr,"%x,", x[i]);
-	    }
-	    fprintf(stderr,"]\n");
-	}
-#endif
-
-	/* Round 1 */
-	FF (a, b, c, d, S11, 0xd76aa478); /* 1 */
-	FF (d, a, b, c, S12, 0xe8c7b756); /* 2 */
-	FF (c, d, a, b, S13, 0x242070db); /* 3 */
-	FF (b, c, d, a, S14, 0xc1bdceee); /* 4 */
-	FF (a, b, c, d, S11, 0xf57c0faf); /* 5 */
-	FF (d, a, b, c, S12, 0x4787c62a); /* 6 */
-	FF (c, d, a, b, S13, 0xa8304613); /* 7 */
-	FF (b, c, d, a, S14, 0xfd469501); /* 8 */
-	FF (a, b, c, d, S11, 0x698098d8); /* 9 */
-	FF (d, a, b, c, S12, 0x8b44f7af); /* 10 */
-	FF (c, d, a, b, S13, 0xffff5bb1); /* 11 */
-	FF (b, c, d, a, S14, 0x895cd7be); /* 12 */
-	FF (a, b, c, d, S11, 0x6b901122); /* 13 */
-	FF (d, a, b, c, S12, 0xfd987193); /* 14 */
-	FF (c, d, a, b, S13, 0xa679438e); /* 15 */
-	FF (b, c, d, a, S14, 0x49b40821); /* 16 */
-
-	/* Round 2 */
-	GG (a, b, c, d,  1, S21, 0xf61e2562); /* 17 */
-	GG (d, a, b, c,  6, S22, 0xc040b340); /* 18 */
-	GG (c, d, a, b, 11, S23, 0x265e5a51); /* 19 */
-	GG (b, c, d, a,  0, S24, 0xe9b6c7aa); /* 20 */
-	GG (a, b, c, d,  5, S21, 0xd62f105d); /* 21 */
-	GG (d, a, b, c, 10, S22,  0x2441453); /* 22 */
-	GG (c, d, a, b, 15, S23, 0xd8a1e681); /* 23 */
-	GG (b, c, d, a,  4, S24, 0xe7d3fbc8); /* 24 */
-	GG (a, b, c, d,  9, S21, 0x21e1cde6); /* 25 */
-	GG (d, a, b, c, 14, S22, 0xc33707d6); /* 26 */
-	GG (c, d, a, b,  3, S23, 0xf4d50d87); /* 27 */
-	GG (b, c, d, a,  8, S24, 0x455a14ed); /* 28 */
-	GG (a, b, c, d, 13, S21, 0xa9e3e905); /* 29 */
-	GG (d, a, b, c,  2, S22, 0xfcefa3f8); /* 30 */
-	GG (c, d, a, b,  7, S23, 0x676f02d9); /* 31 */
-	GG (b, c, d, a, 12, S24, 0x8d2a4c8a); /* 32 */
-
-	/* Round 3 */
-	HH (a, b, c, d,  5, S31, 0xfffa3942); /* 33 */
-	HH (d, a, b, c,  8, S32, 0x8771f681); /* 34 */
-	HH (c, d, a, b, 11, S33, 0x6d9d6122); /* 35 */
-	HH (b, c, d, a, 14, S34, 0xfde5380c); /* 36 */
-	HH (a, b, c, d,  1, S31, 0xa4beea44); /* 37 */
-	HH (d, a, b, c,  4, S32, 0x4bdecfa9); /* 38 */
-	HH (c, d, a, b,  7, S33, 0xf6bb4b60); /* 39 */
-	HH (b, c, d, a, 10, S34, 0xbebfbc70); /* 40 */
-	HH (a, b, c, d, 13, S31, 0x289b7ec6); /* 41 */
-	HH (d, a, b, c,  0, S32, 0xeaa127fa); /* 42 */
-	HH (c, d, a, b,  3, S33, 0xd4ef3085); /* 43 */
-	HH (b, c, d, a,  6, S34,  0x4881d05); /* 44 */
-	HH (a, b, c, d,  9, S31, 0xd9d4d039); /* 45 */
-	HH (d, a, b, c, 12, S32, 0xe6db99e5); /* 46 */
-	HH (c, d, a, b, 15, S33, 0x1fa27cf8); /* 47 */
-	HH (b, c, d, a,  2, S34, 0xc4ac5665); /* 48 */
-
-	/* Round 4 */
-	II (a, b, c, d,  0, S41, 0xf4292244); /* 49 */
-	II (d, a, b, c,  7, S42, 0x432aff97); /* 50 */
-	II (c, d, a, b, 14, S43, 0xab9423a7); /* 51 */
-	II (b, c, d, a,  5, S44, 0xfc93a039); /* 52 */
-	II (a, b, c, d, 12, S41, 0x655b59c3); /* 53 */
-	II (d, a, b, c,  3, S42, 0x8f0ccc92); /* 54 */
-	II (c, d, a, b, 10, S43, 0xffeff47d); /* 55 */
-	II (b, c, d, a,  1, S44, 0x85845dd1); /* 56 */
-	II (a, b, c, d,  8, S41, 0x6fa87e4f); /* 57 */
-	II (d, a, b, c, 15, S42, 0xfe2ce6e0); /* 58 */
-	II (c, d, a, b,  6, S43, 0xa3014314); /* 59 */
-	II (b, c, d, a, 13, S44, 0x4e0811a1); /* 60 */
-	II (a, b, c, d,  4, S41, 0xf7537e82); /* 61 */
-	II (d, a, b, c, 11, S42, 0xbd3af235); /* 62 */
-	II (c, d, a, b,  2, S43, 0x2ad7d2bb); /* 63 */
-	II (b, c, d, a,  9, S44, 0xeb86d391); /* 64 */
-
-	A += a;  TRUNC32(A);
-	B += b;  TRUNC32(B);
-	C += c;  TRUNC32(C);
-	D += d;  TRUNC32(D);
-
-    } while (--blocks);
-    ctx->A = A;
-    ctx->B = B;
-    ctx->C = C;
-    ctx->D = D;
-}
-
-
-#ifdef MD5_DEBUG
-static char*
-ctx_dump(MD5_CTX* ctx)
-{
-    static char buf[1024];
-    sprintf(buf, "{A=%x,B=%x,C=%x,D=%x,%d,%d(%d)}",
-	    ctx->A, ctx->B, ctx->C, ctx->D,
-	    ctx->bytes_low, ctx->bytes_high, (ctx->bytes_low&0x3F));
-    return buf;
-}
-#endif
-
-
-static void
-MD5Update(MD5_CTX* ctx, const U8* buf, STRLEN len)
-{
-    STRLEN blocks;
-    STRLEN fill = ctx->bytes_low & 0x3F;
-
-#ifdef MD5_DEBUG  
-    static int ucount = 0;
-    fprintf(stderr,"%5i: Update(%s, %p, %d)\n", ++ucount, ctx_dump(ctx),
-	                                        buf, len);
-#endif
-
-    ctx->bytes_low += len;
-    if (ctx->bytes_low < len) /* wrap around */
-	ctx->bytes_high++;
-
-    if (fill) {
-	STRLEN missing = 64 - fill;
-	if (len < missing) {
-	    Copy(buf, ctx->buffer + fill, len, U8);
-	    return;
-	}
-	Copy(buf, ctx->buffer + fill, missing, U8);
-	MD5Transform(ctx, ctx->buffer, 1);
-	buf += missing;
-	len -= missing;
-    }
-
-    blocks = len >> 6;
-    if (blocks)
-	MD5Transform(ctx, buf, blocks);
-    if ( (len &= 0x3F)) {
-	Copy(buf + (blocks << 6), ctx->buffer, len, U8);
-    }
-}
-
-
-static void
-MD5Final(U8* digest, MD5_CTX *ctx)
-{
-    STRLEN fill = ctx->bytes_low & 0x3F;
-    STRLEN padlen = (fill < 56 ? 56 : 120) - fill;
-    U32 bits_low, bits_high;
-#ifdef MD5_DEBUG
-    fprintf(stderr,"       Final:  %s\n", ctx_dump(ctx));
-#endif
-    Copy(PADDING, ctx->buffer + fill, padlen, U8);
-    fill += padlen;
-
-    bits_low = ctx->bytes_low << 3;
-    bits_high = (ctx->bytes_high << 3) | (ctx->bytes_low  >> 29);
-#ifdef BYTESWAP
-    *(U32*)(ctx->buffer + fill) = BYTESWAP(bits_low);    fill += 4;
-    *(U32*)(ctx->buffer + fill) = BYTESWAP(bits_high);   fill += 4;
-#else
-    u2s(bits_low,  ctx->buffer + fill);   fill += 4;
-    u2s(bits_high, ctx->buffer + fill);   fill += 4;
-#endif
-
-    MD5Transform(ctx, ctx->buffer, fill >> 6);
-#ifdef MD5_DEBUG
-    fprintf(stderr,"       Result: %s\n", ctx_dump(ctx));
-#endif
-
-#ifdef BYTESWAP
-    *(U32*)digest = BYTESWAP(ctx->A);  digest += 4;
-    *(U32*)digest = BYTESWAP(ctx->B);  digest += 4;
-    *(U32*)digest = BYTESWAP(ctx->C);  digest += 4;
-    *(U32*)digest = BYTESWAP(ctx->D);
-#else
-    u2s(ctx->A, digest);
-    u2s(ctx->B, digest+4);
-    u2s(ctx->C, digest+8);
-    u2s(ctx->D, digest+12);
-#endif
-}
-
 #ifndef INT2PTR
 #define INT2PTR(any,d)	(any)(d)
 #endif
@@ -470,7 +75,7 @@
 	sv = SvRV(sv);
 	if (SvIOK(sv)) {
 	    MD5_CTX* ctx = INT2PTR(MD5_CTX*, SvIV(sv));
-	    if (ctx && ctx->signature == MD5_CTX_SIGNATURE) {
+	    if (ctx) {
 		return ctx;
             }
         }
@@ -570,7 +175,6 @@
 	    STRLEN my_na;
 	    char *sclass = SvPV(xclass, my_na);
 	    New(55, context, 1, MD5_CTX);
-	    context->signature = MD5_CTX_SIGNATURE;
 	    ST(0) = sv_newmortal();
 	    sv_setref_pv(ST(0), sclass, (void*)context);
 	    SvREADONLY_on(SvRV(ST(0)));
@@ -622,7 +226,7 @@
 	InputStream fh
     PREINIT:
 	MD5_CTX* context = get_md5_ctx(aTHX_ self);
-	STRLEN fill = context->bytes_low & 0x3F;
+	STRLEN fill = (context->count >> 3) & (MD5_BLOCK_LENGTH - 1);
 #ifdef USE_HEAP_INSTEAD_OF_STACK
 	unsigned char* buffer;
 #else
Index: src/gnu/usr.bin/perl/cpan/Digest-MD5/t/files.t
diff -u src/gnu/usr.bin/perl/cpan/Digest-MD5/t/files.t:1.1 src/gnu/usr.bin/perl/cpan/Digest-MD5/t/files.t:1.2
--- cpan/Digest-MD5/t/files.t:1.1	Fri Sep 24 14:49:04 2010
+++ cpan/Digest-MD5/t/files.t	Fri Sep 24 15:06:46 2010
@@ -27,7 +27,7 @@
     # This is the output of: 'md5sum README MD5.xs rfc1321.txt'
     $EXPECT = <<EOT;
 c95549c6c5e1e1c078b27042f1dc850f  README
-7aa380c810bc7c1a0bec22cf32bc50d4  MD5.xs
+27e1b94aa63b8636cb95660ec3f78112  MD5.xs
 754b9db19f79dbc4992f7166eb0f37ce  rfc1321.txt
 EOT
 }
Index: src/gnu/usr.bin/perl/cpan/Encode/Encode.pm
diff -u src/gnu/usr.bin/perl/cpan/Encode/Encode.pm:1.1 src/gnu/usr.bin/perl/cpan/Encode/Encode.pm:1.2
--- cpan/Encode/Encode.pm:1.1	Fri Sep 24 14:48:59 2010
+++ cpan/Encode/Encode.pm	Fri Sep 24 15:06:46 2010
@@ -913,7 +913,7 @@
 
 Do you copy?  As of Perl 5.8.7, B<UTF-8> means strict, official UTF-8
 while B<utf8> means liberal, lax, version thereof.  And Encode version
-2.10 or later thus groks the difference between C<UTF-8> and C"utf8".
+2.10 or later thus groks the difference between C<UTF-8> and C<utf8>.
 
   encode("utf8",  "\x{FFFF_FFFF}", 1); # okay
   encode("UTF-8", "\x{FFFF_FFFF}", 1); # croaks
Index: src/gnu/usr.bin/perl/cpan/Encode/lib/Encode/Alias.pm
diff -u src/gnu/usr.bin/perl/cpan/Encode/lib/Encode/Alias.pm:1.1 src/gnu/usr.bin/perl/cpan/Encode/lib/Encode/Alias.pm:1.2
--- cpan/Encode/lib/Encode/Alias.pm:1.1	Fri Sep 24 14:48:59 2010
+++ cpan/Encode/lib/Encode/Alias.pm	Fri Sep 24 15:06:47 2010
@@ -152,6 +152,7 @@
     define_alias( qr/^(?:US-?)ascii$/i       => '"ascii"' );
     define_alias( 'C'                        => 'ascii' );
     define_alias( qr/\b(?:ISO[-_]?)?646(?:[-_]?US)?$/i => '"ascii"' );
+    define_alias( '646'                      => 'ascii' );
 
     # Allow variants of iso-8859-1 etc.
     define_alias( qr/\biso[-_]?(\d+)[-_](\d+)$/i => '"iso-$1-$2"' );
Index: src/gnu/usr.bin/perl/cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_Any.pm
diff -u src/gnu/usr.bin/perl/cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_Any.pm:1.1 src/gnu/usr.bin/perl/cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_Any.pm:1.2
--- cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_Any.pm:1.1	Fri Sep 24 14:48:58 2010
+++ cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_Any.pm	Fri Sep 24 15:06:50 2010
@@ -717,8 +717,9 @@
     my @man_cmds;
     foreach my $section (qw(1 3)) {
         my $pods = $self->{"MAN${section}PODS"};
+	my $s = $section eq '3' ? '3p' : $section;
         push @man_cmds, $self->split_command(<<CMD, %$pods);
-	\$(NOECHO) \$(POD2MAN) --section=$section --perm_rw=\$(PERM_RW)
+	\$(NOECHO) \$(POD2MAN) --section=$s --perm_rw=\$(PERM_RW)
 CMD
     }
 
Index: src/gnu/usr.bin/perl/cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_Unix.pm
diff -u src/gnu/usr.bin/perl/cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_Unix.pm:1.1 src/gnu/usr.bin/perl/cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_Unix.pm:1.2
--- cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_Unix.pm:1.1	Fri Sep 24 14:48:58 2010
+++ cpan/ExtUtils-MakeMaker/lib/ExtUtils/MM_Unix.pm	Fri Sep 24 15:06:50 2010
@@ -289,7 +289,7 @@
     return '' unless $self->needs_linking();
     return $self->{CONST_CCCMD} =
 	q{CCCMD = $(CC) -c $(PASTHRU_INC) $(INC) \\
-	$(CCFLAGS) $(OPTIMIZE) \\
+	$(CCFLAGS) $(OPTIMIZE) $(COPTS) \\
 	$(PERLTYPE) $(MPOLLUTE) $(DEFINE_VERSION) \\
 	$(XS_DEFINE_VERSION)};
 }
Index: src/gnu/usr.bin/perl/cpan/IO-Compress/private/MakeUtil.pm
diff -u src/gnu/usr.bin/perl/cpan/IO-Compress/private/MakeUtil.pm:1.1 src/gnu/usr.bin/perl/cpan/IO-Compress/private/MakeUtil.pm:1.2
--- cpan/IO-Compress/private/MakeUtil.pm:1.1	Fri Sep 24 14:49:04 2010
+++ cpan/IO-Compress/private/MakeUtil.pm	Fri Sep 24 15:06:51 2010
@@ -35,7 +35,8 @@
     my $path = shift;
 
     return undef
-        if $path =~ /(~|\.bak|_bak)$/ ||
+        if $path =~ /^(?:RCS|CVS|SCCS|\.svn|_darcs)$/ ||
+           $path =~ /(~|\.bak|_bak)$/ ||
            $path =~ /\..*\.sw(o|p)$/  ||
            $path =~ /\B\.svn\b/;
 
Index: src/gnu/usr.bin/perl/cpan/Module-Build/lib/Module/Build/ModuleInfo.pm
diff -u src/gnu/usr.bin/perl/cpan/Module-Build/lib/Module/Build/ModuleInfo.pm:1.1 src/gnu/usr.bin/perl/cpan/Module-Build/lib/Module/Build/ModuleInfo.pm:1.2
--- cpan/Module-Build/lib/Module/Build/ModuleInfo.pm:1.1	Fri Sep 24 14:49:00 2010
+++ cpan/Module-Build/lib/Module/Build/ModuleInfo.pm	Fri Sep 24 15:06:53 2010
@@ -395,7 +395,7 @@
 
 =head1 NAME
 
-ModuleInfo - Gather package and POD information from a perl module file
+Module::Build::ModuleInfo - Gather package and POD information from a perl module file
 
 
 =head1 DESCRIPTION
Index: src/gnu/usr.bin/perl/cpan/NEXT/lib/NEXT.pm
diff -u src/gnu/usr.bin/perl/cpan/NEXT/lib/NEXT.pm:1.1 src/gnu/usr.bin/perl/cpan/NEXT/lib/NEXT.pm:1.2
--- cpan/NEXT/lib/NEXT.pm:1.1	Fri Sep 24 14:49:05 2010
+++ cpan/NEXT/lib/NEXT.pm	Fri Sep 24 15:06:54 2010
@@ -190,7 +190,7 @@
 
 =head1 NAME
 
-NEXT.pm - Provide a pseudo-class NEXT (et al) that allows method redispatch
+NEXT - Provide a pseudo-class NEXT (et al) that allows method redispatch
 
 
 =head1 SYNOPSIS
Index: src/gnu/usr.bin/perl/cpan/Pod-Parser/lib/Pod/Checker.pm
diff -u src/gnu/usr.bin/perl/cpan/Pod-Parser/lib/Pod/Checker.pm:1.1 src/gnu/usr.bin/perl/cpan/Pod-Parser/lib/Pod/Checker.pm:1.2
--- cpan/Pod-Parser/lib/Pod/Checker.pm:1.1	Fri Sep 24 14:49:04 2010
+++ cpan/Pod-Parser/lib/Pod/Checker.pm	Fri Sep 24 15:06:54 2010
@@ -18,7 +18,7 @@
 
 =head1 NAME
 
-Pod::Checker, podchecker() - check pod documents for syntax errors
+Pod::Checker, podchecker - check pod documents for syntax errors
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/Pod-Parser/lib/Pod/PlainText.pm
diff -u src/gnu/usr.bin/perl/cpan/Pod-Parser/lib/Pod/PlainText.pm:1.1 src/gnu/usr.bin/perl/cpan/Pod-Parser/lib/Pod/PlainText.pm:1.2
--- cpan/Pod-Parser/lib/Pod/PlainText.pm:1.1	Fri Sep 24 14:49:04 2010
+++ cpan/Pod-Parser/lib/Pod/PlainText.pm	Fri Sep 24 15:06:54 2010
@@ -592,6 +592,11 @@
     }
 }
 
+sub begin_pod {
+    my $self = shift;
+    $$self{EXCLUDE} = 0;
+    $$self{VERBATIM} = 0;
+}
 
 ############################################################################
 # Module return value and documentation
Index: src/gnu/usr.bin/perl/cpan/Pod-Parser/lib/Pod/Select.pm
diff -u src/gnu/usr.bin/perl/cpan/Pod-Parser/lib/Pod/Select.pm:1.1 src/gnu/usr.bin/perl/cpan/Pod-Parser/lib/Pod/Select.pm:1.2
--- cpan/Pod-Parser/lib/Pod/Select.pm:1.1	Fri Sep 24 14:49:04 2010
+++ cpan/Pod-Parser/lib/Pod/Select.pm	Fri Sep 24 15:06:54 2010
@@ -18,7 +18,7 @@
 
 =head1 NAME
 
-Pod::Select, podselect() - extract selected sections of POD from input
+Pod::Select, podselect - extract selected sections of POD from input
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/Pod-Parser/lib/Pod/Usage.pm
diff -u src/gnu/usr.bin/perl/cpan/Pod-Parser/lib/Pod/Usage.pm:1.1 src/gnu/usr.bin/perl/cpan/Pod-Parser/lib/Pod/Usage.pm:1.2
--- cpan/Pod-Parser/lib/Pod/Usage.pm:1.1	Fri Sep 24 14:49:04 2010
+++ cpan/Pod-Parser/lib/Pod/Usage.pm	Fri Sep 24 15:06:54 2010
@@ -16,7 +16,7 @@
 
 =head1 NAME
 
-Pod::Usage, pod2usage() - print a usage message from embedded pod documentation
+Pod::Usage, pod2usage - print a usage message from embedded pod documentation
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/Term-UI/lib/Term/UI/History.pm
diff -u src/gnu/usr.bin/perl/cpan/Term-UI/lib/Term/UI/History.pm:1.1 src/gnu/usr.bin/perl/cpan/Term-UI/lib/Term/UI/History.pm:1.2
--- cpan/Term-UI/lib/Term/UI/History.pm:1.1	Fri Sep 24 14:49:03 2010
+++ cpan/Term-UI/lib/Term/UI/History.pm	Fri Sep 24 15:06:54 2010
@@ -8,7 +8,7 @@
 
 =head1 NAME
 
-Term::UI::History
+Term::UI::History - history functionality for Term::UI
 
 =head1 SYNOPSIS
 
Index: src/gnu/usr.bin/perl/cpan/Test-Harness/lib/TAP/Formatter/Console/ParallelSession.pm
diff -u src/gnu/usr.bin/perl/cpan/Test-Harness/lib/TAP/Formatter/Console/ParallelSession.pm:1.1 src/gnu/usr.bin/perl/cpan/Test-Harness/lib/TAP/Formatter/Console/ParallelSession.pm:1.2
--- cpan/Test-Harness/lib/TAP/Formatter/Console/ParallelSession.pm:1.1	Fri Sep 24 14:49:00 2010
+++ cpan/Test-Harness/lib/TAP/Formatter/Console/ParallelSession.pm	Fri Sep 24 15:06:54 2010
@@ -55,10 +55,6 @@
 
 =head1 SYNOPSIS
 
-=cut
-
-=head1 METHODS
-
 =head2 Class Methods
 
 =head3 C<header>
Index: src/gnu/usr.bin/perl/cpan/Text-Balanced/lib/Text/Balanced.pm
diff -u src/gnu/usr.bin/perl/cpan/Text-Balanced/lib/Text/Balanced.pm:1.1 src/gnu/usr.bin/perl/cpan/Text-Balanced/lib/Text/Balanced.pm:1.2
--- cpan/Text-Balanced/lib/Text/Balanced.pm:1.1	Fri Sep 24 14:49:00 2010
+++ cpan/Text-Balanced/lib/Text/Balanced.pm	Fri Sep 24 15:06:55 2010
@@ -1508,7 +1508,7 @@
 If the string is "PARA", C<extract_tagged> returns only the first paragraph
 after the tag (up to the first line that is either empty or contains
 only whitespace characters).
-If the string is "", the the default behaviour (i.e. failure) is reinstated.
+If the string is "", the default behaviour (i.e. failure) is reinstated.
 
 For example, suppose the start tag "/para" introduces a paragraph, which then
 continues until the next "/endpara" tag or until another "/para" tag is
Index: src/gnu/usr.bin/perl/cpan/libnet/Net/libnetFAQ.pod
diff -u src/gnu/usr.bin/perl/cpan/libnet/Net/libnetFAQ.pod:1.1 src/gnu/usr.bin/perl/cpan/libnet/Net/libnetFAQ.pod:1.2
--- cpan/libnet/Net/libnetFAQ.pod:1.1	Fri Sep 24 14:49:06 2010
+++ cpan/libnet/Net/libnetFAQ.pod	Fri Sep 24 15:06:55 2010
@@ -1,6 +1,6 @@
 =head1 NAME
 
-libnetFAQ - libnet Frequently Asked Questions
+Net::libnetFAQ - libnet Frequently Asked Questions
 
 =head1 DESCRIPTION
 
Index: src/gnu/usr.bin/perl/cpan/podlators/lib/Pod/Man.pm
diff -u src/gnu/usr.bin/perl/cpan/podlators/lib/Pod/Man.pm:1.1 src/gnu/usr.bin/perl/cpan/podlators/lib/Pod/Man.pm:1.2
--- cpan/podlators/lib/Pod/Man.pm:1.1	Fri Sep 24 14:49:00 2010
+++ cpan/podlators/lib/Pod/Man.pm	Fri Sep 24 15:06:55 2010
@@ -825,7 +825,9 @@
                 $cut = $i + 1;
                 $cut++ if ($dirs[$i + 1] && $dirs[$i + 1] eq 'lib');
                 last;
-            }
+            } elsif ($dirs[$i] eq 'lib' && $dirs[$i + 1] && $dirs[0] eq 'ext') {
+                $cut = $i + 1;
+	    }
         }
         if ($cut > 0) {
             splice (@dirs, 0, $cut);
Index: src/gnu/usr.bin/perl/cpan/podlators/lib/Pod/Text.pm
diff -u src/gnu/usr.bin/perl/cpan/podlators/lib/Pod/Text.pm:1.1 src/gnu/usr.bin/perl/cpan/podlators/lib/Pod/Text.pm:1.2
--- cpan/podlators/lib/Pod/Text.pm:1.1	Fri Sep 24 14:49:00 2010
+++ cpan/podlators/lib/Pod/Text.pm	Fri Sep 24 15:06:55 2010
@@ -671,6 +671,12 @@
     $self->parse_from_file (@_);
 }
 
+sub begin_pod {
+    my $self = shift;
+    $$self{EXCLUDE} = 0;
+    $$self{VERBATIM} = 0;
+}
+
 ##############################################################################
 # Module return value and documentation
 ##############################################################################
Index: src/gnu/usr.bin/perl/dist/Pod-Perldoc/lib/Pod/Perldoc.pm
diff -u src/gnu/usr.bin/perl/dist/Pod-Perldoc/lib/Pod/Perldoc.pm:1.1 src/gnu/usr.bin/perl/dist/Pod-Perldoc/lib/Pod/Perldoc.pm:1.2
--- dist/Pod-Perldoc/lib/Pod/Perldoc.pm:1.1	Fri Sep 24 14:48:48 2010
+++ dist/Pod-Perldoc/lib/Pod/Perldoc.pm	Fri Sep 24 15:06:56 2010
@@ -499,7 +499,7 @@
       } else {
         $^W = 0;
         # The average user just has no reason to be seeing
-        #  $^W-suppressable warnings from the the require!
+        #  $^W-suppressible warnings from the require!
       }
 
       eval "require $c";
@@ -655,7 +655,7 @@
 
     $self->options_sanity;
 
-    $self->opt_n("nroff") unless $self->opt_n;
+    $self->opt_n("mandoc") unless $self->opt_n;
     $self->add_formatter_option( '__nroffer' => $self->opt_n );
 
     # Get language from PERLDOC_POD2 environment variable
Index: src/gnu/usr.bin/perl/ext/B/B/Concise.pm
diff -u src/gnu/usr.bin/perl/ext/B/B/Concise.pm:1.8 src/gnu/usr.bin/perl/ext/B/B/Concise.pm:1.9
--- ext/B/B/Concise.pm:1.8	Mon Oct 12 18:24:23 2009
+++ ext/B/B/Concise.pm	Fri Sep 24 15:06:56 2010
@@ -14,7 +14,7 @@
 
 use Exporter (); # use #5
 
-our $VERSION   = "0.76";
+our $VERSION   = "0.78";
 our @ISA       = qw(Exporter);
 our @EXPORT_OK = qw( set_style set_style_standard add_callback
 		     concise_subref concise_cv concise_main
@@ -299,7 +299,7 @@
 	elsif ($o =~ /^-stash=(.*)/) {
 	    my $pkg = $1;
 	    no strict 'refs';
-	    if (!defined %{$pkg.'::'}) {
+	    if (! %{$pkg.'::'}) {
 		eval "require $pkg";
 	    } else {
 		require Config;
@@ -634,6 +634,7 @@
 $priv{"delete"}{64} = "SLICE";
 $priv{"exists"}{64} = "SUB";
 @{$priv{"sort"}}{1,2,4,8,16,32,64} = ("NUM", "INT", "REV", "INPLACE","DESC","QSORT","STABLE");
+$priv{"reverse"}{8} = "INPLACE";
 $priv{"threadsv"}{64} = "SVREFd";
 @{$priv{$_}}{16,32,64,128} = ("INBIN","INCR","OUTBIN","OUTCR")
   for ("open", "backtick");
@@ -1741,14 +1742,14 @@
 C<linenoise>, C<debug>, C<env>, into effect.  It also accepts style
 names previously defined with add_style().
 
-=head2 add_style()
+=head2 add_style ()
 
 This subroutine accepts a new style name and three style arguments as
 above, and creates, registers, and selects the newly named style.  It is
 an error to re-add a style; call set_style_standard() to switch between
 several styles.
 
-=head2 add_callback()
+=head2 add_callback ()
 
 If your newly minted styles refer to any new #variables, you'll need
 to define a callback subroutine that will populate (or modify) those
Index: src/gnu/usr.bin/perl/ext/DynaLoader/Makefile.PL
diff -u src/gnu/usr.bin/perl/ext/DynaLoader/Makefile.PL:1.7 src/gnu/usr.bin/perl/ext/DynaLoader/Makefile.PL:1.8
--- ext/DynaLoader/Makefile.PL:1.7	Tue Oct 13 01:25:48 2009
+++ ext/DynaLoader/Makefile.PL	Fri Sep 24 15:06:56 2010
@@ -1,5 +1,10 @@
+use strict;
 use ExtUtils::MakeMaker;
 
+my $is_mswin    = $^O eq 'MSWin32';
+my $is_netware  = $^O eq 'NetWare';
+my $is_vms      = $^O eq 'VMS';
+
 WriteMakefile(
     NAME => 'DynaLoader',
     LINKTYPE	=> 'static',
@@ -7,20 +12,19 @@
     SKIP	=> [qw(dynamic dynamic_lib dynamic_bs)],
     XSPROTOARG => '-noprototypes', 		# XXX remove later?
     VERSION_FROM => 'DynaLoader_pm.PL',
-    PL_FILES	=> {'DynaLoader_pm.PL'=>'DynaLoader.pm',
-		    'XSLoader_pm.PL'=>'XSLoader.pm'},
-    PM		=> {'DynaLoader.pm' => '$(INST_LIBDIR)/DynaLoader.pm',
-		    'XSLoader.pm' => '$(INST_LIBDIR)/XSLoader.pm'},
+    PL_FILES	=> {'DynaLoader_pm.PL'=>'DynaLoader.pm'},
+    PM		=> {'DynaLoader.pm' => '$(INST_LIBDIR)/DynaLoader.pm'},
     depend      => {'DynaLoader$(OBJ_EXT)' => 'dlutils.c'},
-    clean	=> {FILES => 'DynaLoader.c DynaLoader.xs DynaLoader.pm ' .
-			     'XSLoader.pm'},
+    clean	=> {FILES => 'DynaLoader.c DynaLoader.xs DynaLoader.pm'},
 );
 
 sub MY::postamble {
-	'
-DynaLoader.xs: $(DLSRC)
-	$(RM_F) $@
-	$(CP) $? $@
+    my $test_xs;
+
+    if ($is_mswin || $is_netware || $is_vms) {
+	$test_xs = '';
+    } else {
+	$test_xs = <<'EOT';
 
 # Perform very simple tests just to check for major gaffs.
 # We can\'t do much more for platforms we are not executing on.
@@ -28,15 +32,32 @@
 	for i in dl_*xs; \
 	    do $(PERL) -I$(PERL_ARCHLIB) -I$(PERL_LIB) $(XSUBPP) $(XSUBPPARGS) $$i > /dev/null; \
 	done
-';
+EOT
+    }
+
+    return '
+DynaLoader.xs: $(DLSRC)
+	$(RM_F) $@
+	$(CP) $? $@
+' . $test_xs;
 }
 
 sub MY::static {
-	'
-$(PERL_SRC)/$(OBJECT) : $(FIRST_MAKEFILE) $(OBJECT)
-	#$(RM_RF) $(PERL_SRC)/$(OBJECT)
-	#$(CP) $(OBJECT) $(PERL_SRC)/$(OBJECT)
+    my $object;
+    if ($is_mswin || $is_netware) {
+	$object = '$(PERL_SRC)\\$(OBJECT)';
+    } elsif ($is_vms) {
+	$object = '$(PERL_SRC)$(OBJECT)';
+    } else {
+	$object = '$(PERL_SRC)/$(OBJECT)';
+    }
+
+
+    return "
+$object : \$(FIRST_MAKEFILE) \$(OBJECT)
+	#\$(RM_RF) $object
+	#\$(CP) \$(OBJECT) $object
 
-static :: $(PERL_SRC)/$(OBJECT)
-';
+static :: $object
+";
 }
Index: src/gnu/usr.bin/perl/ext/DynaLoader/dlutils.c
diff -u src/gnu/usr.bin/perl/ext/DynaLoader/dlutils.c:1.8 src/gnu/usr.bin/perl/ext/DynaLoader/dlutils.c:1.9
--- ext/DynaLoader/dlutils.c:1.8	Mon Oct 12 18:24:27 2009
+++ ext/DynaLoader/dlutils.c	Fri Sep 24 15:06:56 2010
@@ -68,7 +68,7 @@
     AV *dl_librefs;
     SV *dl_libref;
 
-    if ((sub = get_cv("DynaLoader::dl_unload_file", 0)) != NULL) {
+    if ((sub = get_cvs("DynaLoader::dl_unload_file", 0)) != NULL) {
         dl_librefs = get_av("DynaLoader::dl_librefs", 0);
         while ((dl_libref = av_pop(dl_librefs)) != &PL_sv_undef) {
            dSP;
Index: src/gnu/usr.bin/perl/ext/File-Glob/bsd_glob.c
diff -u src/gnu/usr.bin/perl/ext/File-Glob/bsd_glob.c:1.2 src/gnu/usr.bin/perl/ext/File-Glob/bsd_glob.c:1.3
--- ext/File-Glob/bsd_glob.c:1.2	Mon Oct 12 18:24:28 2009
+++ ext/File-Glob/bsd_glob.c	Fri Sep 24 15:06:56 2010
@@ -82,11 +82,8 @@
 #ifndef MAXPATHLEN
 #  ifdef PATH_MAX
 #    define	MAXPATHLEN	PATH_MAX
-#    ifdef MACOS_TRADITIONAL
-#      define	MAXPATHLEN	255
-#    else
-#      define	MAXPATHLEN	1024
-#    endif
+#  else
+#    define	MAXPATHLEN	1024
 #  endif
 #endif
 
@@ -95,20 +92,16 @@
 #endif
 
 #ifndef ARG_MAX
-#  ifdef MACOS_TRADITIONAL
-#    define		ARG_MAX		65536	/* Mac OS is actually unlimited */
+#  ifdef _SC_ARG_MAX
+#    define		ARG_MAX		(sysconf(_SC_ARG_MAX))
 #  else
-#    ifdef _SC_ARG_MAX
-#      define		ARG_MAX		(sysconf(_SC_ARG_MAX))
+#    ifdef _POSIX_ARG_MAX
+#      define		ARG_MAX		_POSIX_ARG_MAX
 #    else
-#      ifdef _POSIX_ARG_MAX
-#        define		ARG_MAX		_POSIX_ARG_MAX
+#      ifdef WIN32
+#        define	ARG_MAX		14500	/* from VC's limits.h */
 #      else
-#        ifdef WIN32
-#          define	ARG_MAX		14500	/* from VC's limits.h */
-#        else
-#          define	ARG_MAX		4096	/* from POSIX, be conservative */
-#        endif
+#        define	ARG_MAX		4096	/* from POSIX, be conservative */
 #      endif
 #    endif
 #  endif
@@ -123,11 +116,7 @@
 #define	BG_QUOTE	'\\'
 #define	BG_RANGE	'-'
 #define	BG_RBRACKET	']'
-#ifdef MACOS_TRADITIONAL
-#  define	BG_SEP	':'
-#else
-#  define	BG_SEP	'/'
-#endif
+#define	BG_SEP	'/'
 #ifdef DOSISH
 #define BG_SEP2		'\\'
 #endif
@@ -227,23 +216,6 @@
 
 #endif
 
-#ifdef MACOS_TRADITIONAL
-#include <Files.h>
-#include <Types.h>
-#include <string.h>
-
-#define NO_UPDIR_ERR 1	/* updir resolving failed */
-
-static Boolean g_matchVol; /* global variable */
-static short updir(char *path);
-static short resolve_updirs(char *new_pattern);
-static void remove_trColon(char *path);
-static short glob_mark_Mac(Char *pathbuf, Char *pathend, Char *pathend_last);
-static OSErr GetVolInfo(short volume, Boolean indexed, FSSpec *spec);
-static void name_f_FSSpec(StrFileName volname, FSSpec *spec);
-
-#endif
-
 int
 bsd_glob(const char *pattern, int flags,
 	 int (*errfunc)(const char *, int), glob_t *pglob)
@@ -251,16 +223,7 @@
 	const U8 *patnext;
 	int c;
 	Char *bufnext, *bufend, patbuf[MAXPATHLEN];
-
-#ifdef MACOS_TRADITIONAL
-	char *new_pat, *p, *np;
-	int err;
-	size_t len;
-#endif
-
-#ifndef MACOS_TRADITIONAL
 	patnext = (U8 *) pattern;
-#endif
 	/* TODO: GLOB_APPEND / GLOB_DOOFFS aren't supported yet */
 #if 0
 	if (!(flags & GLOB_APPEND)) {
@@ -300,61 +263,6 @@
 	}
 #endif
 
-#ifdef MACOS_TRADITIONAL
-	/* Check if we need to match a volume name (e.g. '*HD:*') */
-	g_matchVol = false;
-	p = (char *) pattern;
-	if (*p != BG_SEP) {
-	    p++;
-	    while (*p != BG_EOS) {
-		if (*p == BG_SEP) {
-		    g_matchVol = true;
-		    break;
-		}
-		p++;
-	    }
-	}
-
-	/* Transform the pattern:
-	 * (a) Resolve updirs, e.g.
-	 *     '*:t*p::'       -> '*:'
-	 *	   ':a*:tmp::::'   -> '::'
-	 *	   ':base::t*p:::' -> '::'
-	 *     '*HD::'         -> return 0 (error, quit silently)
-	 *
-	 * (b) Remove a single trailing ':', unless it's a "match volume only"
-	 *     pattern like '*HD:'; e.g.
-	 *     '*:tmp:' -> '*:tmp'  but
-	 *     '*HD:'   -> '*HD:'
-	 *     (If we don't do that, even filenames will have a trailing ':' in
-	 *     the result.)
-	 */
-
-	/* We operate on a copy of the pattern */
-	len = strlen(pattern);
-	Newx(new_pat, len + 1, char);
-	if (new_pat == NULL)
-	    return (GLOB_NOSPACE);
-
-	p = (char *) pattern;
-	np = new_pat;
-	while (*np++ = *p++) ;
-
-	/* Resolve updirs ... */
-	err = resolve_updirs(new_pat);
-	if (err) {
-	    Safefree(new_pat);
-	    /* The pattern is incorrect: tried to move
-	       up above the volume root, see above.
-	       We quit silently. */
-	    return 0;
-	}
-	/* remove trailing colon ... */
-	remove_trColon(new_pat);
-	patnext = (U8 *) new_pat;
-
-#endif /* MACOS_TRADITIONAL */
-
 	if (flags & GLOB_QUOTE) {
 		/* Protect the quoted characters. */
 		while (bufnext < bufend && (c = *patnext++) != BG_EOS)
@@ -382,19 +290,10 @@
 			*bufnext++ = c;
 	*bufnext = BG_EOS;
 
-#ifdef MACOS_TRADITIONAL
-	if (flags & GLOB_BRACE)
-	    err = globexp1(patbuf, pglob);
-	else
-	    err = glob0(patbuf, pglob);
-	Safefree(new_pat);
-	return err;
-#else
 	if (flags & GLOB_BRACE)
 	    return globexp1(patbuf, pglob);
 	else
 	    return glob0(patbuf, pglob);
-#endif
 }
 
 /*
@@ -613,12 +512,6 @@
 	Char *bufnext, patbuf[MAXPATHLEN];
 	size_t limit = 0;
 
-#ifdef MACOS_TRADITIONAL
-	if ( (*pattern == BG_TILDE) && (pglob->gl_flags & GLOB_TILDE) ) {
-		return(globextend(pattern, pglob, &limit));
-	}
-#endif
-
 	qpat = globtilde(pattern, patbuf, MAXPATHLEN, pglob);
 	qpatnext = qpat;
 	oldflags = pglob->gl_flags;
@@ -777,17 +670,10 @@
 				  (S_ISLNK(sb.st_mode) &&
 			    (g_stat(pathbuf, &sb, pglob) == 0) &&
 			    S_ISDIR(sb.st_mode)))) {
-#ifdef MACOS_TRADITIONAL
-				short err;
-				err = glob_mark_Mac(pathbuf, pathend, pathend_last);
-				if (err)
-					return (err);
-#else
 				if (pathend+1 > pathend_last)
 					return (1);
 				*pathend++ = BG_SEP;
 				*pathend = BG_EOS;
-#endif
 			}
 			++pglob->gl_matchc;
 #ifdef GLOB_DEBUG
@@ -873,49 +759,6 @@
         }
 #endif
 
-#ifdef MACOS_TRADITIONAL
-	if ((!*pathbuf) && (g_matchVol)) {
-	    FSSpec spec;
-	    short index;
-	    StrFileName vol_name; /* unsigned char[64] on MacOS */
-
-	    err = 0;
-	    nocase = ((pglob->gl_flags & GLOB_NOCASE) != 0);
-
-	    /* Get and match a list of volume names */
-	    for (index = 0; !GetVolInfo(index+1, true, &spec); ++index) {
-		register U8 *sc;
-		register Char *dc;
-
-		name_f_FSSpec(vol_name, &spec);
-
-		/* Initial BG_DOT must be matched literally. */
-		if (*vol_name == BG_DOT && *pattern != BG_DOT)
-		    continue;
-		dc = pathend;
-		sc = (U8 *) vol_name;
-		while (dc < pathend_last && (*dc++ = *sc++) != BG_EOS)
-		    ;
-		if (dc >= pathend_last) {
-		    *dc = BG_EOS;
-		    err = 1;
-		    break;
-		}
-
-		if (!match(pathend, pattern, restpattern, nocase)) {
-		    *pathend = BG_EOS;
-		    continue;
-		}
-		err = glob2(pathbuf, pathbuf_last, --dc, pathend_last,
-		    restpattern, restpattern_last, pglob, limitp);
-		if (err)
-		    break;
-	    }
-	    return(err);
-
-	} else { /* open dir */
-#endif /* MACOS_TRADITIONAL */
-
 	if ((dirp = g_opendir(pathbuf, pglob)) == NULL) {
 		/* TODO: don't call for ENOENT or ENOTDIR? */
 		if (pglob->gl_errfunc) {
@@ -968,10 +811,6 @@
 	else
 		PerlDir_close(dirp);
 	return(err);
-
-#ifdef MACOS_TRADITIONAL
-	}
-#endif
 }
 
 
@@ -1130,11 +969,7 @@
 	char buf[MAXPATHLEN];
 
 	if (!*str) {
-#ifdef MACOS_TRADITIONAL
-		my_strlcpy(buf, ":", sizeof(buf));
-#else
 		my_strlcpy(buf, ".", sizeof(buf));
-#endif
 	} else {
 		if (g_Ctoc(str, buf, sizeof(buf)))
 			return(NULL);
@@ -1212,209 +1047,3 @@
 	(void)printf("\n");
 }
 #endif /* GLOB_DEBUG */
-
-
-#ifdef MACOS_TRADITIONAL
-
-/* Replace the last occurrence of the pattern ":[^:]+::", e.g. ":lib::",
-   with a single ':', if possible. It is not an error, if the pattern
-   doesn't match (we return -1), but if there are two consecutive colons
-   '::', there must be a preceding ':[^:]+'. Hence,  a volume path like
-   "HD::" is considered to be an error (we return 1), that is, it can't
-   be resolved. We return 0 on success.
-*/
-
-static short
-updir(char *path)
-{
-	char *pb, *pe, *lastchar;
-	char *bgn_mark, *end_mark;
-	char *f, *m, *b; /* front, middle, back */
-	size_t len;
-
-	len = strlen(path);
-	lastchar = path + (len-1);
-	b = lastchar;
-	m = lastchar-1;
-	f = lastchar-2;
-
-	/* find a '[^:]::' (e.g. b::) pattern ... */
-	while ( !( (*f != BG_SEP) && (*m == BG_SEP) && (*b == BG_SEP) )
-	        && (f >= path)) {
-		f--;
-		m--;
-		b--;
-	}
-
-	if (f < path) { /* no (more) match */
-		return -1;
-	}
-
-	end_mark = b;
-
-	/* ... and now find its preceding colon ':' */
-	while ((*f != BG_SEP) && (f >= path)) {
-		f--;
-	}
-	if (f < path) {
-		/* No preceding colon found, must be a
-		   volume path. We can't move up the
-		   tree and that's an error */
-		return 1;
-	}
-	bgn_mark = f;
-
-	/* Shrink path, i.e. exclude all characters between
-	   bgn_mark and end_mark */
-
-	pb = bgn_mark;
-	pe = end_mark;
-	while (*pb++ = *pe++) ;
-	return 0;
-}
-
-
-/* Resolve all updirs in pattern. */
-
-static short
-resolve_updirs(char *new_pattern)
-{
-	short err;
-
-	do {
-		err = updir(new_pattern);
-	} while (!err);
-	if (err == 1) {
-		return NO_UPDIR_ERR;
-	}
-	return 0;
-}
-
-
-/* Remove a trailing colon from the path, but only if it's
-   not a volume path (e.g. HD:) and not a path consisting
-   solely of colons. */
-
-static void
-remove_trColon(char *path)
-{
-	char *lastchar, *lc;
-
-	/* if path matches the pattern /:[^:]+:$/, we can
-	   remove the trailing ':' */
-
-	lc = lastchar = path + (strlen(path) - 1);
-	if (*lastchar == BG_SEP) {
-		/* there's a trailing ':', there must be at least
-		   one preceding char != ':' and a preceding ':' */
-		lc--;
-		if ((*lc != BG_SEP) && (lc >= path)) {
-			lc--;
-		} else {
-			return;
-		}
-		while ((*lc != BG_SEP) && (lc >= path)) {
-			lc--;
-		}
-		if (lc >= path) {
-			/* ... there's a preceding ':', we remove
-			   the trailing colon */
-			*lastchar = BG_EOS;
-		}
-	}
-}
-
-
-/* With the GLOB_MARK flag on, we append a colon, if pathbuf
-   is a directory. If the directory name contains no colons,
-   e.g. 'lib', we can't simply append a ':', since this (e.g.
-   'lib:') is not a valid (relative) path on Mac OS. Instead,
-   we add a leading _and_ trailing ':'. */
-
-static short
-glob_mark_Mac(Char *pathbuf, Char *pathend, Char *pathend_last)
-{
-	Char *p, *pe;
-	Boolean is_file = true;
-
-	/* check if pathbuf contains a ':',
-	   i.e. is not a file name */
-	p = pathbuf;
-	while (*p != BG_EOS) {
-		if (*p == BG_SEP) {
-			is_file = false;
-			break;
-		}
-		p++;
-	}
-
-	if (is_file) {
-		if (pathend+2 > pathend_last) {
-			return (1);
-		}
-		/* right shift one char */
-		pe = p = pathend;
-		p--;
-		pathend++;
-		while (p >= pathbuf) {
-			*pe-- = *p--;
-		}
-		/* first char becomes a colon */
-		*pathbuf = BG_SEP;
-		/* append a colon */
-		*pathend++ = BG_SEP;
-		*pathend = BG_EOS;
-
-	} else {
-		if (pathend+1 > pathend_last) {
-			return (1);
-		}
-		*pathend++ = BG_SEP;
-		*pathend = BG_EOS;
-	}
-	return 0;
-}
-
-
-/* Return a FSSpec record for the specified volume
-   (borrowed from MacPerl.xs). */
-
-static OSErr
-GetVolInfo(short volume, Boolean indexed, FSSpec* spec)
-{
-	OSErr		err; /* OSErr: 16-bit integer */
-	HParamBlockRec	pb;
-
-	pb.volumeParam.ioNamePtr	= spec->name;
-	pb.volumeParam.ioVRefNum	= indexed ? 0 : volume;
-	pb.volumeParam.ioVolIndex	= indexed ? volume : 0;
-
-	if (err = PBHGetVInfoSync(&pb))
-		return err;
-
-	spec->vRefNum	= pb.volumeParam.ioVRefNum;
-	spec->parID	= 1;
-
-	return noErr; /* 0 */
-}
-
-/* Extract a C name from a FSSpec. Note that there are
-   no leading or trailing colons. */
-
-static void
-name_f_FSSpec(StrFileName name, FSSpec *spec)
-{
-	unsigned char *nc;
-	const short len = spec->name[0];
-	short i;
-
-	/* FSSpec.name is a Pascal string,
-	   convert it to C ... */
-	nc = name;
-	for (i=1; i<=len; i++) {
-		*nc++ = spec->name[i];
-	}
-	*nc = BG_EOS;
-}
-
-#endif /* MACOS_TRADITIONAL */
Index: src/gnu/usr.bin/perl/ext/GDBM_File/GDBM_File.pm
diff -u src/gnu/usr.bin/perl/ext/GDBM_File/GDBM_File.pm:1.9 src/gnu/usr.bin/perl/ext/GDBM_File/GDBM_File.pm:1.10
--- ext/GDBM_File/GDBM_File.pm:1.9	Mon Oct 12 18:24:29 2009
+++ ext/GDBM_File/GDBM_File.pm	Fri Sep 24 15:06:56 2010
@@ -69,7 +69,7 @@
 );
 
 # This module isn't dual life, so no need for dev version numbers.
-$VERSION = '1.09';
+$VERSION = '1.10';
 
 sub AUTOLOAD {
     my($constname);
Index: src/gnu/usr.bin/perl/ext/GDBM_File/t/gdbm.t
diff -u src/gnu/usr.bin/perl/ext/GDBM_File/t/gdbm.t:1.4 src/gnu/usr.bin/perl/ext/GDBM_File/t/gdbm.t:1.5
--- ext/GDBM_File/t/gdbm.t:1.4	Mon Oct 12 18:24:29 2009
+++ ext/GDBM_File/t/gdbm.t	Fri Sep 24 15:06:56 2010
@@ -3,8 +3,6 @@
 # $RCSfile: dbm.t,v $$Revision: 4.1 $$Date: 92/08/07 18:27:43 $
 
 BEGIN {
-    chdir 't' if -d 't';
-    @INC = '../lib';
     require Config; import Config;
     if ($Config{'extensions'} !~ /\bGDBM_File\b/) {
 	print "1..0 # Skip: GDBM_File was not built\n";
Index: src/gnu/usr.bin/perl/ext/NDBM_File/t/ndbm.t
diff -u src/gnu/usr.bin/perl/ext/NDBM_File/t/ndbm.t:1.4 src/gnu/usr.bin/perl/ext/NDBM_File/t/ndbm.t:1.5
--- ext/NDBM_File/t/ndbm.t:1.4	Mon Oct 12 18:24:33 2009
+++ ext/NDBM_File/t/ndbm.t	Fri Sep 24 15:06:57 2010
@@ -3,8 +3,6 @@
 # $RCSfile: dbm.t,v $$Revision: 4.1 $$Date: 92/08/07 18:27:43 $
 
 BEGIN {
-    chdir 't' if -d 't';
-    @INC = '../lib';
     require Config; import Config;
     if ($Config{'extensions'} !~ /\bNDBM_File\b/) {
 	print "1..0 # Skip: NDBM_File was not built\n";
Index: src/gnu/usr.bin/perl/ext/ODBM_File/t/odbm.t
diff -u src/gnu/usr.bin/perl/ext/ODBM_File/t/odbm.t:1.4 src/gnu/usr.bin/perl/ext/ODBM_File/t/odbm.t:1.5
--- ext/ODBM_File/t/odbm.t:1.4	Mon Oct 12 18:24:33 2009
+++ ext/ODBM_File/t/odbm.t	Fri Sep 24 15:06:57 2010
@@ -3,8 +3,6 @@
 # $RCSfile: dbm.t,v $$Revision: 4.1 $$Date: 92/08/07 18:27:43 $
 
 BEGIN {
-    chdir 't' if -d 't';
-    @INC = '../lib';
     require Config; import Config;
     if ($Config{'extensions'} !~ /\bODBM_File\b/ or $Config{'d_cplusplus'}) {
 	print "1..0 # Skip: ODBM_File was not built\n";
Index: src/gnu/usr.bin/perl/ext/Opcode/Opcode.pm
diff -u src/gnu/usr.bin/perl/ext/Opcode/Opcode.pm:1.7 src/gnu/usr.bin/perl/ext/Opcode/Opcode.pm:1.8
--- ext/Opcode/Opcode.pm:1.7	Mon Sep 29 17:36:05 2008
+++ ext/Opcode/Opcode.pm	Fri Sep 24 15:06:57 2010
@@ -6,7 +6,7 @@
 
 our($VERSION, @ISA, @EXPORT_OK);
 
-$VERSION = "1.11";
+$VERSION = "1.15";
 
 use Carp;
 use Exporter ();
@@ -310,7 +310,8 @@
 
     rv2av aassign aelem aelemfast aslice av2arylen
 
-    rv2hv helem hslice each values keys exists delete
+    rv2hv helem hslice each values keys exists delete aeach akeys avalues
+    boolkeys
 
     preinc i_preinc predec i_predec postinc i_postinc postdec i_postdec
     int hex oct abs pow multiply i_multiply divide i_divide
@@ -332,7 +333,7 @@
 
     cond_expr flip flop andassign orassign dorassign and or dor xor
 
-    warn die lineseq nextstate scope enter leave setstate
+    warn die lineseq nextstate scope enter leave
 
     rv2cv anoncode prototype
 
@@ -556,6 +557,8 @@
     sort -- assorted problems including core dumps
     tied -- can be used to access object implementing a tie
     pack unpack -- can be used to create/use memory pointers
+
+    hintseval -- constant op holding eval hints
 
     entereval -- can be used to hide code from initial compile
 
Index: src/gnu/usr.bin/perl/ext/Opcode/Opcode.xs
diff -u src/gnu/usr.bin/perl/ext/Opcode/Opcode.xs:1.9 src/gnu/usr.bin/perl/ext/Opcode/Opcode.xs:1.10
--- ext/Opcode/Opcode.xs:1.9	Mon Oct 12 18:24:33 2009
+++ ext/Opcode/Opcode.xs	Fri Sep 24 15:06:57 2010
@@ -260,12 +260,12 @@
 
 void
 _safe_pkg_prep(Package)
-    const char *Package
+    SV *Package
 PPCODE:
     HV *hv; 
     ENTER;
    
-    hv = gv_stashpv(Package, GV_ADDWARN); /* should exist already	*/
+    hv = gv_stashsv(Package, GV_ADDWARN); /* should exist already	*/
 
     if (strNE(HvNAME_get(hv),"main")) {
         /* make it think it's in main:: */
@@ -281,7 +281,7 @@
 
 void
 _safe_call_sv(Package, mask, codesv)
-    char *	Package
+    SV *	Package
     SV *	mask
     SV *	codesv
 PPCODE:
@@ -298,7 +298,7 @@
 
     save_hptr(&PL_defstash);		/* save current default stash	*/
     /* the assignment to global defstash changes our sense of 'main'	*/
-    PL_defstash = gv_stashpv(Package, GV_ADDWARN); /* should exist already	*/
+    PL_defstash = gv_stashsv(Package, GV_ADDWARN); /* should exist already	*/
 
     save_hptr(&PL_curstash);
     PL_curstash = PL_defstash;
@@ -306,13 +306,13 @@
     /* defstash must itself contain a main:: so we'll add that now	*/
     /* take care with the ref counts (was cause of long standing bug)	*/
     /* XXX I'm still not sure if this is right, GV_ADDWARN should warn!	*/
-    gv = gv_fetchpv("main::", GV_ADDWARN, SVt_PVHV);
+    gv = gv_fetchpvs("main::", GV_ADDWARN, SVt_PVHV);
     sv_free((SV*)GvHV(gv));
     GvHV(gv) = (HV*)SvREFCNT_inc(PL_defstash);
 
     /* %INC must be clean for use/require in compartment */
     dummy_hv = save_hash(PL_incgv);
-    GvHV(PL_incgv) = (HV*)SvREFCNT_inc(GvHV(gv_HVadd(gv_fetchpv("INC",TRUE,SVt_PVHV))));
+    GvHV(PL_incgv) = (HV*)SvREFCNT_inc(GvHV(gv_HVadd(gv_fetchpvs("INC",GV_ADD,SVt_PVHV))));
 
     /* Invalidate ISA and method caches */
     ++PL_sub_generation;
@@ -371,7 +371,8 @@
 	const U16 bits = bitmap[i];
 	for (j=0; j < 8 && myopcode < PL_maxo; j++, myopcode++) {
 	    if ( bits & (1 << j) )
-		XPUSHs(sv_2mortal(newSVpv(names[myopcode], 0)));
+		XPUSHs(newSVpvn_flags(names[myopcode], strlen(names[myopcode]),
+				      SVs_TEMP));
 	}
     }
     }
@@ -458,7 +459,7 @@
 
     /* copy args to a scratch area since we may push output values onto	*/
     /* the stack faster than we read values off it if masks are used.	*/
-    args = (SV**)SvPVX(sv_2mortal(newSVpvn((char*)&ST(0), items*sizeof(SV*))));
+    args = (SV**)SvPVX(newSVpvn_flags((char*)&ST(0), items*sizeof(SV*), SVs_TEMP));
     for (i = 0; i < items; i++) {
 	const char * const opname = SvPV(args[i], len);
 	SV *bitspec = get_op_bitspec(aTHX_ opname, len, 1);
@@ -466,7 +467,8 @@
 	    const int myopcode = SvIV(bitspec);
 	    if (myopcode < 0 || myopcode >= PL_maxo)
 		croak("panic: opcode %d (%s) out of range",myopcode,opname);
-	    XPUSHs(sv_2mortal(newSVpv(op_desc[myopcode], 0)));
+	    XPUSHs(newSVpvn_flags(op_desc[myopcode], strlen(op_desc[myopcode]),
+				  SVs_TEMP));
 	}
 	else if (SvPOK(bitspec) && SvCUR(bitspec) == (STRLEN)opset_len) {
 	    int b, j;
@@ -476,7 +478,9 @@
 		const U16 bits = bitmap[b];
 		for (j=0; j < 8 && myopcode < PL_maxo; j++, myopcode++)
 		    if (bits & (1 << j))
-			XPUSHs(sv_2mortal(newSVpv(op_desc[myopcode], 0)));
+			XPUSHs(newSVpvn_flags(op_desc[myopcode],
+					      strlen(op_desc[myopcode]),
+					      SVs_TEMP));
 	    }
 	}
 	else
Index: src/gnu/usr.bin/perl/ext/POSIX/POSIX.pm
diff -u src/gnu/usr.bin/perl/ext/POSIX/POSIX.pm:1.12 src/gnu/usr.bin/perl/ext/POSIX/POSIX.pm:1.13
--- ext/POSIX/POSIX.pm:1.12	Mon Oct 12 18:24:33 2009
+++ ext/POSIX/POSIX.pm	Fri Sep 24 15:06:57 2010
@@ -4,7 +4,7 @@
 
 our(@ISA, %EXPORT_TAGS, @EXPORT_OK, @EXPORT, $AUTOLOAD, %SIGRT) = ();
 
-our $VERSION = "1.17";
+our $VERSION = "1.19";
 
 use AutoLoader;
 
Index: src/gnu/usr.bin/perl/ext/POSIX/POSIX.pod
diff -u src/gnu/usr.bin/perl/ext/POSIX/POSIX.pod:1.12 src/gnu/usr.bin/perl/ext/POSIX/POSIX.pod:1.13
--- ext/POSIX/POSIX.pod:1.12	Mon Oct 12 18:24:33 2009
+++ ext/POSIX/POSIX.pod	Fri Sep 24 15:06:57 2010
@@ -703,6 +703,14 @@
 (For returning absolute values of long integers.)
 labs() is C-specific, see L<perlfunc/abs> instead.
 
+=item lchown
+
+This is identical to the C function, except the order of arguments is
+consistent with Perl's builtin C<chown()> with the added restriction
+of only one path, not an list of paths.  Does the same thing as the 
+C<chown()> function but changes the owner of a symbolic link instead 
+of the file the symbolic link points to.
+
 =item ldexp
 
 This is identical to the C function C<ldexp()>
@@ -1095,7 +1103,7 @@
 your operating system. Please consult L<perllocale> for how to find
 out which locales are available in your system.
 
-	$loc = setlocale( LC_ALL, "es_AR.ISO8859-1" );
+	$loc = setlocale( LC_COLLATE, "es_AR.ISO8859-1" );
 
 =item setpgid
 
Index: src/gnu/usr.bin/perl/ext/POSIX/POSIX.xs
diff -u src/gnu/usr.bin/perl/ext/POSIX/POSIX.xs:1.14 src/gnu/usr.bin/perl/ext/POSIX/POSIX.xs:1.15
--- ext/POSIX/POSIX.xs:1.14	Mon Oct 12 18:24:33 2009
+++ ext/POSIX/POSIX.xs	Fri Sep 24 15:06:57 2010
@@ -70,9 +70,6 @@
 #ifdef I_UNISTD
 #include <unistd.h>
 #endif
-#ifdef MACOS_TRADITIONAL
-#undef fdopen
-#endif
 #include <fcntl.h>
 
 #ifdef HAS_TZNAME
@@ -196,7 +193,7 @@
 #else
 
 #  ifndef HAS_MKFIFO
-#    if defined(OS2) || defined(MACOS_TRADITIONAL)
+#    if defined(OS2)
 #      define mkfifo(a,b) not_here("mkfifo")
 #    else	/* !( defined OS2 ) */
 #      ifndef mkfifo
@@ -205,25 +202,143 @@
 #    endif
 #  endif /* !HAS_MKFIFO */
 
-#  ifdef MACOS_TRADITIONAL
-#    define ttyname(a) (char*)not_here("ttyname")
-#    define tzset() not_here("tzset")
-#  else
-#    ifdef I_GRP
-#      include <grp.h>
-#    endif
-#    include <sys/times.h>
-#    ifdef HAS_UNAME
-#      include <sys/utsname.h>
-#    endif
-#    include <sys/wait.h>
+#  ifdef I_GRP
+#    include <grp.h>
+#  endif
+#  include <sys/times.h>
+#  ifdef HAS_UNAME
+#    include <sys/utsname.h>
 #  endif
+#  include <sys/wait.h>
 #  ifdef I_UTIME
 #    include <utime.h>
 #  endif
 #endif /* WIN32 || NETWARE */
 #endif /* __VMS */
 
+#ifdef WIN32
+   /* Perl on Windows assigns WSAGetLastError() return values to errno
+    * (in win32/win32sck.c).  Therefore we need to map these values
+    * back to standard symbolic names, as long as the same name isn't
+    * already defined by errno.h itself.  The Errno.pm module does
+    * a similar mapping.
+    */
+#  ifndef EWOULDBLOCK
+#    define EWOULDBLOCK WSAEWOULDBLOCK
+#  endif
+#  ifndef EINPROGRESS
+#    define EINPROGRESS WSAEINPROGRESS
+#  endif
+#  ifndef EALREADY
+#    define EALREADY WSAEALREADY
+#  endif
+#  ifndef ENOTSOCK
+#    define ENOTSOCK WSAENOTSOCK
+#  endif
+#  ifndef EDESTADDRREQ
+#    define EDESTADDRREQ WSAEDESTADDRREQ
+#  endif
+#  ifndef EMSGSIZE
+#    define EMSGSIZE WSAEMSGSIZE
+#  endif
+#  ifndef EPROTOTYPE
+#    define EPROTOTYPE WSAEPROTOTYPE
+#  endif
+#  ifndef ENOPROTOOPT
+#    define ENOPROTOOPT WSAENOPROTOOPT
+#  endif
+#  ifndef EPROTONOSUPPORT
+#    define EPROTONOSUPPORT WSAEPROTONOSUPPORT
+#  endif
+#  ifndef ESOCKTNOSUPPORT
+#    define ESOCKTNOSUPPORT WSAESOCKTNOSUPPORT
+#  endif
+#  ifndef EOPNOTSUPP
+#    define EOPNOTSUPP WSAEOPNOTSUPP
+#  endif
+#  ifndef EPFNOSUPPORT
+#    define EPFNOSUPPORT WSAEPFNOSUPPORT
+#  endif
+#  ifndef EAFNOSUPPORT
+#    define EAFNOSUPPORT WSAEAFNOSUPPORT
+#  endif
+#  ifndef EADDRINUSE
+#    define EADDRINUSE WSAEADDRINUSE
+#  endif
+#  ifndef EADDRNOTAVAIL
+#    define EADDRNOTAVAIL WSAEADDRNOTAVAIL
+#  endif
+#  ifndef ENETDOWN
+#    define ENETDOWN WSAENETDOWN
+#  endif
+#  ifndef ENETUNREACH
+#    define ENETUNREACH WSAENETUNREACH
+#  endif
+#  ifndef ENETRESET
+#    define ENETRESET WSAENETRESET
+#  endif
+#  ifndef ECONNABORTED
+#    define ECONNABORTED WSAECONNABORTED
+#  endif
+#  ifndef ECONNRESET
+#    define ECONNRESET WSAECONNRESET
+#  endif
+#  ifndef ENOBUFS
+#    define ENOBUFS WSAENOBUFS
+#  endif
+#  ifndef EISCONN
+#    define EISCONN WSAEISCONN
+#  endif
+#  ifndef ENOTCONN
+#    define ENOTCONN WSAENOTCONN
+#  endif
+#  ifndef ESHUTDOWN
+#    define ESHUTDOWN WSAESHUTDOWN
+#  endif
+#  ifndef ETOOMANYREFS
+#    define ETOOMANYREFS WSAETOOMANYREFS
+#  endif
+#  ifndef ETIMEDOUT
+#    define ETIMEDOUT WSAETIMEDOUT
+#  endif
+#  ifndef ECONNREFUSED
+#    define ECONNREFUSED WSAECONNREFUSED
+#  endif
+#  ifndef ELOOP
+#    define ELOOP WSAELOOP
+#  endif
+#  ifndef ENAMETOOLONG
+#    define ENAMETOOLONG WSAENAMETOOLONG
+#  endif
+#  ifndef EHOSTDOWN
+#    define EHOSTDOWN WSAEHOSTDOWN
+#  endif
+#  ifndef EHOSTUNREACH
+#    define EHOSTUNREACH WSAEHOSTUNREACH
+#  endif
+#  ifndef ENOTEMPTY
+#    define ENOTEMPTY WSAENOTEMPTY
+#  endif
+#  ifndef EPROCLIM
+#    define EPROCLIM WSAEPROCLIM
+#  endif
+#  ifndef EUSERS
+#    define EUSERS WSAEUSERS
+#  endif
+#  ifndef EDQUOT
+#    define EDQUOT WSAEDQUOT
+#  endif
+#  ifndef ESTALE
+#    define ESTALE WSAESTALE
+#  endif
+#  ifndef EREMOTE
+#    define EREMOTE WSAEREMOTE
+#  endif
+#  ifndef EDISCON
+#    define EDISCON WSAEDISCON
+#  endif
+#endif
+
 typedef int SysRet;
 typedef long SysRetLong;
 typedef sigset_t* POSIX__SigSet;
@@ -772,8 +887,8 @@
 	POSIX::WSTOPSIG = 4
 	POSIX::WTERMSIG = 5
     CODE:
-#if !(defined(WEXITSTATUS) || defined(WIFEXITED) || defined(WIFSIGNALED) \
-      || defined(WIFSTOPPED) || defined(WSTOPSIG) || defined (WTERMSIG))
+#if !defined(WEXITSTATUS) || !defined(WIFEXITED) || !defined(WIFSIGNALED) \
+      || !defined(WIFSTOPPED) || !defined(WSTOPSIG) || !defined(WTERMSIG)
         RETVAL = 0; /* Silence compilers that notice this, but don't realise
 		       that not_here() can't return.  */
 #endif
@@ -1225,7 +1340,7 @@
 	{
 	    dVAR;
 	    POSIX__SigAction action;
-	    GV *siggv = gv_fetchpv("SIG", TRUE, SVt_PVHV);
+	    GV *siggv = gv_fetchpvs("SIG", GV_ADD, SVt_PVHV);
 	    struct sigaction act;
 	    struct sigaction oact;
 	    sigset_t sset;
@@ -1288,7 +1403,7 @@
                XSRETURN_UNDEF;
 	    ENTER;
 	    /* Restore signal mask no matter how we exit this block. */
-	    osset_sv = newSVpv((char *)(&osset), sizeof(sigset_t));
+	    osset_sv = newSVpvn((char *)(&osset), sizeof(sigset_t));
 	    SAVEFREESV( osset_sv );
 	    SAVEDESTRUCTOR_X(restore_sigmask, osset_sv);
 
@@ -1303,11 +1418,13 @@
 			sv_setsv(*svp, *sigsvp);
 		}
 		else {
-			sv_setpv(*svp, "DEFAULT");
+			sv_setpvs(*svp, "DEFAULT");
 		}
 		RETVAL = sigaction(sig, (struct sigaction *)0, & oact);
-		if(RETVAL == -1)
+		if(RETVAL == -1) {
+                   LEAVE;
                    XSRETURN_UNDEF;
+                }
 		/* Get back the mask. */
 		svp = hv_fetchs(oldaction, "MASK", TRUE);
 		if (sv_isa(*svp, "POSIX::SigSet")) {
@@ -1387,8 +1504,10 @@
 		 * essentially meaningless anyway.
 		 */
 		RETVAL = sigaction(sig, & act, (struct sigaction *)0);
-		if(RETVAL == -1)
+		if(RETVAL == -1) {
+                    LEAVE;
 		    XSRETURN_UNDEF;
+                }
 	    }
 
 	    LEAVE;
@@ -1465,7 +1584,7 @@
 	errno = 0;
 	if ((incr = nice(incr)) != -1 || errno == 0) {
 	    if (incr == 0)
-		XPUSHs(sv_2mortal(newSVpvn("0 but true", 10)));
+		XPUSHs(newSVpvs_flags("0 but true", SVs_TEMP));
 	    else
 		XPUSHs(sv_2mortal(newSViv(incr)));
 	}
@@ -1520,11 +1639,11 @@
 	struct utsname buf;
 	if (uname(&buf) >= 0) {
 	    EXTEND(SP, 5);
-	    PUSHs(sv_2mortal(newSVpv(buf.sysname, 0)));
-	    PUSHs(sv_2mortal(newSVpv(buf.nodename, 0)));
-	    PUSHs(sv_2mortal(newSVpv(buf.release, 0)));
-	    PUSHs(sv_2mortal(newSVpv(buf.version, 0)));
-	    PUSHs(sv_2mortal(newSVpv(buf.machine, 0)));
+	    PUSHs(newSVpvn_flags(buf.sysname, strlen(buf.sysname), SVs_TEMP));
+	    PUSHs(newSVpvn_flags(buf.nodename, strlen(buf.nodename), SVs_TEMP));
+	    PUSHs(newSVpvn_flags(buf.release, strlen(buf.release), SVs_TEMP));
+	    PUSHs(newSVpvn_flags(buf.version, strlen(buf.version), SVs_TEMP));
+	    PUSHs(newSVpvn_flags(buf.machine, strlen(buf.machine), SVs_TEMP));
 	}
 #else
 	uname((char *) 0); /* A stub to call not_here(). */
@@ -1789,7 +1908,7 @@
 #     ST(0) = sv_2mortal(newSVpv(...))
 void
 strftime(fmt, sec, min, hour, mday, mon, year, wday = -1, yday = -1, isdst = -1)
-	char *		fmt
+	SV *		fmt
 	int		sec
 	int		min
 	int		hour
@@ -1801,10 +1920,14 @@
 	int		isdst
     CODE:
 	{
-	    char *buf = my_strftime(fmt, sec, min, hour, mday, mon, year, wday, yday, isdst);
+	    char *buf = my_strftime(SvPV_nolen(fmt), sec, min, hour, mday, mon, year, wday, yday, isdst);
 	    if (buf) {
-		ST(0) = sv_2mortal(newSVpv(buf, 0));
-		Safefree(buf);
+		SV *const sv = sv_newmortal();
+		sv_usepvn_flags(sv, buf, strlen(buf), SV_HAS_TRAILING_NUL);
+		if (SvUTF8(fmt)) {
+		    SvUTF8_on(sv);
+		}
+		ST(0) = sv;
 	    }
 	}
 
@@ -1817,8 +1940,8 @@
 tzname()
     PPCODE:
 	EXTEND(SP,2);
-	PUSHs(sv_2mortal(newSVpvn(tzname[0],strlen(tzname[0]))));
-	PUSHs(sv_2mortal(newSVpvn(tzname[1],strlen(tzname[1]))));
+	PUSHs(newSVpvn_flags(tzname[0], strlen(tzname[0]), SVs_TEMP));
+	PUSHs(newSVpvn_flags(tzname[1], strlen(tzname[1]), SVs_TEMP));
 
 SysRet
 access(filename, mode)
Index: src/gnu/usr.bin/perl/ext/PerlIO-encoding/encoding.xs
diff -u src/gnu/usr.bin/perl/ext/PerlIO-encoding/encoding.xs:1.3 src/gnu/usr.bin/perl/ext/PerlIO-encoding/encoding.xs:1.4
--- ext/PerlIO-encoding/encoding.xs:1.3	Tue Oct 13 16:46:51 2009
+++ ext/PerlIO-encoding/encoding.xs	Fri Sep 24 15:06:57 2010
@@ -108,8 +108,9 @@
 
     if (!SvROK(result) || !SvOBJECT(SvRV(result))) {
 	e->enc = Nullsv;
-	Perl_warner(aTHX_ packWARN(WARN_IO), "Cannot find encoding \"%" SVf "\"",
-		    arg);
+        if (ckWARN_d(WARN_IO))
+            Perl_warner(aTHX_ packWARN(WARN_IO), "Cannot find encoding \"%" SVf "\"",
+                    arg);
 	errno = EINVAL;
 	code = -1;
     }
@@ -120,8 +121,9 @@
 	XPUSHs(result);
 	PUTBACK;
 	if (call_method("renew",G_SCALAR|G_EVAL) != 1 || SvTRUE(ERRSV)) {
-	    Perl_warner(aTHX_ packWARN(WARN_IO), "\"%" SVf "\" does not support renew method",
-			arg);
+            if (ckWARN_d(WARN_IO))
+                Perl_warner(aTHX_ packWARN(WARN_IO), "\"%" SVf "\" does not support renew method",
+                        arg);
 	}
 	else {
 	    SPAGAIN;
@@ -133,7 +135,8 @@
 	XPUSHs(e->enc);
 	PUTBACK;
 	if (call_method("needs_lines",G_SCALAR|G_EVAL) != 1 || SvTRUE(ERRSV)) {
-	    Perl_warner(aTHX_ packWARN(WARN_IO), "\"%" SVf "\" does not support needs_lines",
+            if (ckWARN_d(WARN_IO))
+                Perl_warner(aTHX_ packWARN(WARN_IO), "\"%" SVf "\" does not support needs_lines",
 			arg);
 	}
 	else {
@@ -639,7 +642,7 @@
      */
     PUSHSTACKi(PERLSI_MAGIC);
     SPAGAIN;
-    if (!get_cv(OUR_DEFAULT_FB, 0)) {
+    if (!get_cvs(OUR_DEFAULT_FB, 0)) {
 #if 0
 	/* This would just be an irritant now loading works */
 	Perl_warner(aTHX_ packWARN(WARN_IO), ":encoding without 'use Encode'");
Index: src/gnu/usr.bin/perl/ext/SDBM_File/t/sdbm.t
diff -u src/gnu/usr.bin/perl/ext/SDBM_File/t/sdbm.t:1.4 src/gnu/usr.bin/perl/ext/SDBM_File/t/sdbm.t:1.5
--- ext/SDBM_File/t/sdbm.t:1.4	Mon Oct 12 18:24:34 2009
+++ ext/SDBM_File/t/sdbm.t	Fri Sep 24 15:06:57 2010
@@ -3,8 +3,6 @@
 # $RCSfile: dbm.t,v $$Revision: 4.1 $$Date: 92/08/07 18:27:43 $
 
 BEGIN {
-    chdir 't' if -d 't';
-    @INC = '../lib';
     require Config; import Config;
     if ($Config{'extensions'} !~ /\bSDBM_File\b/) {
 	print "1..0 # Skip: no SDBM_File\n";
@@ -157,7 +155,7 @@
    require Exporter ;
    use SDBM_File;
    @ISA=qw(SDBM_File);
-   @EXPORT = @SDBM_File::EXPORT if defined @SDBM_File::EXPORT ;
+   @EXPORT = @SDBM_File::EXPORT if @SDBM_File::EXPORT ;
 
    sub STORE { 
 	my $self = shift ;
Index: src/gnu/usr.bin/perl/ext/Socket/Socket.pm
diff -u src/gnu/usr.bin/perl/ext/Socket/Socket.pm:1.11 src/gnu/usr.bin/perl/ext/Socket/Socket.pm:1.12
--- ext/Socket/Socket.pm:1.11	Mon Oct 12 18:24:34 2009
+++ ext/Socket/Socket.pm	Fri Sep 24 15:06:57 2010
@@ -1,11 +1,11 @@
 package Socket;
 
 our($VERSION, @ISA, @EXPORT, @EXPORT_OK, %EXPORT_TAGS);
-$VERSION = "1.82";
+$VERSION = "1.87";
 
 =head1 NAME
 
-Socket, sockaddr_in, sockaddr_un, inet_aton, inet_ntoa - load the C socket.h defines and structure manipulators 
+Socket, sockaddr_in, sockaddr_un, inet_aton, inet_ntoa, inet_pton, inet_ntop - load the C socket.h defines and structure manipulators 
 
 =head1 SYNOPSIS
 
@@ -171,6 +171,25 @@
 and returns the pathname.  Will croak if the structure does not
 have AF_UNIX in the right place.
 
+=item inet_pton ADDRESS_FAMILY, HOSTNAME
+
+Takes an address family, either AF_INET or AF_INET6, and a string giving
+the name of a host, and translates that to an opaque string
+(if programming in C, struct in_addr or struct in6_addr depending on the 
+address family passed in).  The host string may be a string hostname, such
+as 'www.perl.org', or an IP address.  If using an IP address, the type of
+IP address must be consistant with the address family passed into the function.
+
+This function is not exported by default.
+
+=item inet_ntop ADDRESS_FAMILY, IP_ADDRESS
+
+Takes an address family, either AF_INET or AF_INET6, and a string 
+(an opaque string as returned by inet_aton() or inet_pton()) and
+translates it to an IPv4 or IPv6 address string.
+
+This function is not exported by default.
+
 =back
 
 =cut
@@ -343,6 +362,9 @@
 );
 
 @EXPORT_OK = qw(CR LF CRLF $CR $LF $CRLF
+
+	       inet_pton
+	       inet_ntop
 
 	       IPPROTO_IP
 	       IPPROTO_IPV6
Index: src/gnu/usr.bin/perl/ext/Socket/Socket.xs
diff -u src/gnu/usr.bin/perl/ext/Socket/Socket.xs:1.11 src/gnu/usr.bin/perl/ext/Socket/Socket.xs:1.12
--- ext/Socket/Socket.xs:1.11	Mon Oct 12 18:24:34 2009
+++ ext/Socket/Socket.xs	Fri Sep 24 15:06:57 2010
@@ -276,7 +276,7 @@
 		((addr.s_addr >> 16) & 0xFF),
 		((addr.s_addr >>  8) & 0xFF),
 		( addr.s_addr        & 0xFF));
-	ST(0) = sv_2mortal(newSVpvn(addr_str, strlen(addr_str)));
+	ST(0) = newSVpvn_flags(addr_str, strlen(addr_str), SVs_TEMP);
 	Safefree(addr_str);
 	}
 
@@ -303,6 +303,7 @@
 	struct sockaddr_un sun_ad; /* fear using sun */
 	STRLEN len;
 	char * pathname_pv;
+	int addr_len;
 
 	Zero( &sun_ad, sizeof sun_ad, char );
 	sun_ad.sun_family = AF_UNIX;
@@ -336,7 +337,17 @@
 	Copy( pathname_pv, sun_ad.sun_path, len, char );
 #  endif
 	if (0) not_here("dummy");
-	ST(0) = sv_2mortal(newSVpvn((char *)&sun_ad, sizeof sun_ad));
+	if (len > 1 && sun_ad.sun_path[0] == '\0') {
+		/* Linux-style abstract-namespace socket.
+		 * The name is not a file name, but an array of arbitrary
+		 * character, starting with \0 and possibly including \0s,
+		 * therefore the length of the structure must denote the
+		 * end of that character array */
+		addr_len = (char *)&(sun_ad.sun_path) - (char *)&sun_ad + len;
+	} else {
+		addr_len = sizeof sun_ad;
+	}
+	ST(0) = newSVpvn_flags((char *)&sun_ad, addr_len, SVs_TEMP);
 #else
 	ST(0) = (SV *) not_here("pack_sockaddr_un");
 #endif
@@ -352,7 +363,7 @@
 	struct sockaddr_un addr;
 	STRLEN sockaddrlen;
 	char * sun_ad = SvPVbyte(sun_sv,sockaddrlen);
-	char * e;
+	int addr_len;
 #   ifndef __linux__
 	/* On Linux sockaddrlen on sockets returned by accept, recvfrom,
 	   getpeername and getsockname is not equal to sizeof(addr). */
@@ -371,13 +382,17 @@
 			addr.sun_family,
 			AF_UNIX);
 	}
-	e = (char*)addr.sun_path;
-	/* On Linux, the name of abstract unix domain sockets begins
-	 * with a '\0', so allow this. */
-	while ((*e || (e == addr.sun_path && e[1] && sockaddrlen > 1))
-		&& e < (char*)addr.sun_path + sizeof addr.sun_path)
-	    ++e;
-	ST(0) = sv_2mortal(newSVpvn(addr.sun_path, e - (char*)addr.sun_path));
+
+	if (addr.sun_path[0] == '\0') {
+		/* Linux-style abstract socket address begins with a nul
+		 * and can contain nuls. */
+		addr_len = (char *)&addr - (char *)&(addr.sun_path) + sockaddrlen;
+	} else {
+		for (addr_len = 0; addr.sun_path[addr_len]
+		     && addr_len < sizeof addr.sun_path; addr_len++);
+	}
+
+	ST(0) = newSVpvn_flags(addr.sun_path, addr_len, SVs_TEMP);
 #else
 	ST(0) = (SV *) not_here("unpack_sockaddr_un");
 #endif
@@ -410,7 +425,7 @@
 	sin.sin_family = AF_INET;
 	sin.sin_port = htons(port);
 	sin.sin_addr.s_addr = htonl(addr.s_addr);
-	ST(0) = sv_2mortal(newSVpvn((char *)&sin, sizeof sin));
+	ST(0) = newSVpvn_flags((char *)&sin, sizeof (sin), SVs_TEMP);
 	}
 
 void
@@ -440,5 +455,57 @@
 
 	EXTEND(SP, 2);
 	PUSHs(sv_2mortal(newSViv((IV) port)));
-	PUSHs(sv_2mortal(newSVpvn((char *)&ip_address, sizeof ip_address)));
+	PUSHs(newSVpvn_flags((char *)&ip_address, sizeof(ip_address), SVs_TEMP));
 	}
+
+void
+inet_ntop(af, ip_address_sv)
+        int     af
+        SV *    ip_address_sv
+        CODE:
+#ifdef HAS_INETNTOP
+	STRLEN addrlen, struct_size;
+	struct in6_addr addr;
+	char str[INET6_ADDRSTRLEN];
+	char *ip_address = SvPV(ip_address_sv, addrlen);
+
+        if(af == AF_INET) {
+            struct_size = sizeof(struct in_addr);
+        } else if(af == AF_INET6) {
+            struct_size = sizeof(struct in6_addr);
+        } else {
+           croak("Bad address family for Socket::inet_ntop, got %d, should be either AF_INET or AF_INET6",
+               af);
+        }
+
+	Copy( ip_address, &addr, sizeof addr, char );
+	inet_ntop(af, &addr, str, INET6_ADDRSTRLEN);
+
+	ST(0) = newSVpvn_flags(str, strlen(str), SVs_TEMP);
+#else
+        ST(0) = (SV *)not_here("inet_ntop");
+#endif
+
+void
+inet_pton(af, host)
+        int           af
+        const char *  host
+        CODE:
+#ifdef HAS_INETPTON
+        int ok;
+        struct in6_addr ip_address;
+        if(af != AF_INET && af != AF_INET6) {
+           croak("Bad address family for %s, got %d, should be either AF_INET or AF_INET6",
+                        "Socket::inet_pton",
+                        af);
+        }
+        ok = (*host != '\0') && inet_pton(af, host, &ip_address);
+
+        ST(0) = sv_newmortal();
+        if (ok) {
+                sv_setpvn( ST(0), (char *)&ip_address,
+                           af == AF_INET6 ? sizeof(ip_address) : sizeof(struct in_addr) );
+        }
+#else
+        ST(0) = (SV *)not_here("inet_pton");
+#endif
Index: src/gnu/usr.bin/perl/ext/re/t/regop.t
diff -u src/gnu/usr.bin/perl/ext/re/t/regop.t:1.2 src/gnu/usr.bin/perl/ext/re/t/regop.t:1.3
--- ext/re/t/regop.t:1.2	Tue Nov  3 14:24:09 2009
+++ ext/re/t/regop.t	Fri Sep 24 15:06:58 2010
@@ -1,8 +1,6 @@
 #!./perl
 
 BEGIN {
-    chdir 't' if -d 't';
-    @INC = '../lib';
     require Config;
     if (($Config::Config{'extensions'} !~ /\bre\b/) ){
 	print "1..0 # Skip -- Perl configured without re module\n";
@@ -11,10 +9,10 @@
 }
 
 use strict;
-BEGIN { require "./test.pl"; }
+BEGIN { require "../../t/test.pl"; }
 our $NUM_SECTS;
 chomp(my @strs= grep { !/^\s*\#/ } <DATA>);
-my $out = runperl(progfile => "../ext/re/t/regop.pl", stderr => 1 );
+my $out = runperl(progfile => "t/regop.pl", stderr => 1 );
 # VMS currently embeds linefeeds in the output.
 $out =~ s/\cJ//g if $^O = 'VMS';
 my @tests = grep { /\S/ } split /(?=Compiling REx)/, $out;
@@ -258,4 +256,4 @@
 Offsets: [12]
 1:1[3] 3:4[0]
 %MATCHED%        
-Freeing REx: "[q]"
\ No newline at end of file
+Freeing REx: "[q]"
Index: src/gnu/usr.bin/perl/hints/aix.sh
diff -u src/gnu/usr.bin/perl/hints/aix.sh:1.12 src/gnu/usr.bin/perl/hints/aix.sh:1.13
--- hints/aix.sh:1.12	Mon Oct 12 18:24:37 2009
+++ hints/aix.sh	Fri Sep 24 15:06:58 2010
@@ -234,6 +234,7 @@
 	d_setgrent_r='undef'
 	d_setpwent_r='undef'
 	d_srand48_r='undef'
+	d_srandom_r='undef'
 	d_strerror_r='undef'
 
 	ccflags="$ccflags -DNEED_PTHREAD_INIT"
@@ -539,10 +540,13 @@
 d_flock='undef'
 
 # remove libgdbm from wanted libraries
-# The libgdbm 1.8.3 from the AIX Toolbox is not working 
-# (the dbm_store() function is defective)
-libswanted=`echo " $libswanted " | sed -e 's/ gdbm / /'`
-i_gdbm='undef'
-i_gdbmndbm='undef'
-
+# The libgdbm < 1.8.3-5 from the AIX Toolbox is not working
+# because two wrong .h are present
+if [ -f "/opt/freeware/include/gdbm/dbm.h" ] ||
+   [ -f "/opt/freeware/include/gdbm/ndbm.h" ]; then
+    echo "GDBM support disabled because your GDBM package contains extraneous headers - see README.aix."
+    libswanted=`echo " $libswanted " | sed -e 's/ gdbm / /'`
+    i_gdbm='undef'
+    i_gdbmndbm='undef'
+fi
 # EOF
Index: src/gnu/usr.bin/perl/hints/bsdos.sh
diff -u src/gnu/usr.bin/perl/hints/bsdos.sh:1.7 src/gnu/usr.bin/perl/hints/bsdos.sh:1.8
--- hints/bsdos.sh:1.7	Mon Oct 12 18:24:37 2009
+++ hints/bsdos.sh	Fri Sep 24 15:06:58 2010
@@ -27,7 +27,7 @@
 esac
 
 # setre?[ug]id() have been replaced by the _POSIX_SAVED_IDS versions.
-# See <A HREF="http://www.bsdi.com/bsdi-man?setuid">http://www.bsdi.com/bsdi-man?setuid</A>(2)
+# See man 2 setuid
 d_setregid='undef'
 d_setreuid='undef'
 d_setrgid='undef'
Index: src/gnu/usr.bin/perl/hints/dgux.sh
diff -u src/gnu/usr.bin/perl/hints/dgux.sh:1.9 src/gnu/usr.bin/perl/hints/dgux.sh:1.10
--- hints/dgux.sh:1.9	Mon Oct 12 18:24:37 2009
+++ hints/dgux.sh	Fri Sep 24 15:06:58 2010
@@ -54,14 +54,14 @@
 #####################################
 
 prefix=/usr/local
-perlpath="$prefix/bin/perl510"
-startperl="#! $prefix/bin/perl510"
-privlib="$prefix/lib/perl510"
+perlpath="$prefix/bin/perl512"
+startperl="#! $prefix/bin/perl512"
+privlib="$prefix/lib/perl512"
 man1dir="$prefix/man/man1"
 man3dir="$prefix/man/man3"
 
-sitearch="$prefix/lib/perl510/$archname"
-sitelib="$prefix/lib/perl510"
+sitearch="$prefix/lib/perl512/$archname"
+sitelib="$prefix/lib/perl512"
 
 #Do not overwrite by default /usr/bin/perl of DG/UX
 installusrbinperl="$undef"
@@ -140,7 +140,7 @@
 # <takis@XFree86.Org>
 #####################################
 
-libperl="libperl510.so"
+libperl="libperl512.so"
 
 # Many functions (eg, gethostent(), killpg(), getpriority(), setruid()
 # dbm_*(), and plenty more) are defined in -ldgc.  Usually you don't
@@ -207,8 +207,8 @@
 	# DG/UX library!
 	libswanted="dbm posix resolv socket nsl dl m rte"
 	archname="ix86-dgux-thread"
-	sitearch="$prefix/lib/perl510/$archname"
-	sitelib="$prefix/lib/perl510"
+	sitearch="$prefix/lib/perl512/$archname"
+	sitelib="$prefix/lib/perl512"
   case "$cc" in
 	*gcc*)
 	   #### Use GCC -2.95.2/3 rev (DG/UX) and -pthread
Index: src/gnu/usr.bin/perl/hints/freebsd.sh
diff -u src/gnu/usr.bin/perl/hints/freebsd.sh:1.10 src/gnu/usr.bin/perl/hints/freebsd.sh:1.11
--- hints/freebsd.sh:1.10	Mon Oct 12 18:24:37 2009
+++ hints/freebsd.sh	Fri Sep 24 15:06:58 2010
@@ -114,7 +114,7 @@
 	lddlflags="-Bshareable $lddlflags"
 	;;
 
-*)
+3*|4*|5*|6*)
         objformat=`/usr/bin/objformat`
         if [ x$objformat = xaout ]; then
             if [ -e /usr/lib/aout ]; then
@@ -130,6 +130,13 @@
         fi
         cccdlflags='-DPIC -fPIC'
         ;;
+*)
+       libpth="/usr/lib /usr/local/lib"
+       glibpth="/usr/lib /usr/local/lib"
+       ldflags="-Wl,-E "
+        lddlflags="-shared "
+        cccdlflags='-DPIC -fPIC'
+       ;;
 esac
 
 case "$osvers" in
Index: src/gnu/usr.bin/perl/hints/hpux.sh
diff -u src/gnu/usr.bin/perl/hints/hpux.sh:1.11 src/gnu/usr.bin/perl/hints/hpux.sh:1.12
--- hints/hpux.sh:1.11	Mon Oct 12 18:24:37 2009
+++ hints/hpux.sh	Fri Sep 24 15:06:58 2010
@@ -233,6 +233,15 @@
 	    exit 1
 	    fi
 
+	if [ $xxOsRev -eq 1100 ]; then
+	    # HP-UX 11.00 uses only 48 bits internally in 64bit mode, not 64
+	    # force min/max to 2**47-1
+	    sGMTIME_max=140737488355327
+	    sGMTIME_min=-62167219200
+	    sLOCALTIME_max=140737488355327
+	    sLOCALTIME_min=-62167219200
+	    fi
+
 	# Set libc and the library paths
 	case "$archname" in
 	    PA-RISC*)
@@ -270,14 +279,18 @@
 					ldflags="$ldflags -mlp64"
 					;;
 				    esac
-				    ;;
+				;;
 			    esac
 			;;
 		    esac
 		;;
 	    *)
-		ccflags="$ccflags +DD64"
-		ldflags="$ldflags +DD64"
+		case "$use64bitall" in
+		    $define|true|[yY]*)
+			ccflags="$ccflags +DD64"
+			ldflags="$ldflags +DD64"
+			;;
+		    esac
 		;;
 	    esac
 
@@ -668,7 +681,6 @@
     d_ctime_r="$undef"
     d_asctime_r="$undef"
     fi
-
 
 # fpclassify () is a macro, the library call is Fpclassify
 # Similarly with the others below.
Index: src/gnu/usr.bin/perl/hints/irix_6.sh
diff -u src/gnu/usr.bin/perl/hints/irix_6.sh:1.10 src/gnu/usr.bin/perl/hints/irix_6.sh:1.11
--- hints/irix_6.sh:1.10	Mon Oct 12 18:24:37 2009
+++ hints/irix_6.sh	Fri Sep 24 15:06:58 2010
@@ -192,7 +192,7 @@
 	case "`uname -s`" in
 	# Without the -mabi=64 gcc in 64-bit IRIX has problems passing
 	# and returning small structures.  This affects inet_*() and semctl().
-	# See http://reality.sgi.com/ariel/freeware/gcc-2.8.1-notes.html
+	# See http://groups.google.com/group/comp.sys.sgi.admin/msg/3ad8353bc4ce3cb0
 	# for more information.  Reported by Lionel Cons <lionel.cons@cern.ch>.
 	IRIX64)	ccflags="$ccflags -mabi=64"
 		ldflags="$ldflags -mabi=64 -L/usr/lib64"
Index: src/gnu/usr.bin/perl/hints/linux.sh
diff -u src/gnu/usr.bin/perl/hints/linux.sh:1.12 src/gnu/usr.bin/perl/hints/linux.sh:1.13
--- hints/linux.sh:1.12	Mon Oct 12 18:24:37 2009
+++ hints/linux.sh	Fri Sep 24 15:06:58 2010
@@ -87,6 +87,11 @@
 # Check if we're about to use Intel's ICC compiler
 case "`${cc:-cc} -V 2>&1`" in
 *"Intel(R) C++ Compiler"*|*"Intel(R) C Compiler"*)
+    # record the version, formats:
+    # icc (ICC) 10.1 20080801
+    # icpc (ICC) 10.1 20080801
+    # followed by a copyright on the second line
+    ccversion=`${cc:-cc} --version | sed -n -e 's/^icp\?c \((ICC) \)\?//p'`
     # This is needed for Configure's prototype checks to work correctly
     # The -mp flag is needed to pass various floating point related tests
     # The -no-gcc flag is needed otherwise, icc pretends (poorly) to be gcc
Index: src/gnu/usr.bin/perl/hints/os2.sh
diff -u src/gnu/usr.bin/perl/hints/os2.sh:1.8 src/gnu/usr.bin/perl/hints/os2.sh:1.9
--- hints/os2.sh:1.8	Wed Apr  7 21:33:04 2004
+++ hints/os2.sh	Fri Sep 24 15:06:58 2010
@@ -456,11 +456,7 @@
 
 cd ./os2/OS2
 
-if ! test -d ../../ext/OS2 ; then
-   mkdir ../../ext/OS2
-fi
-
-cp -rfu * ../../ext/OS2/
+cp -rfu * ../../ext/
 
 # Install tests:
 
Index: src/gnu/usr.bin/perl/hints/qnx.sh
diff -u src/gnu/usr.bin/perl/hints/qnx.sh:1.6 src/gnu/usr.bin/perl/hints/qnx.sh:1.7
--- hints/qnx.sh:1.6	Mon Oct 12 18:24:37 2009
+++ hints/qnx.sh	Fri Sep 24 15:06:58 2010
@@ -55,7 +55,7 @@
 #   they both point to the correct library, that is,
 #   /usr/tcptk/current/usr/lib/socket3r.lib.
 # 
-#   ext/Cwd/Cwd.t will complain if `pwd` and cwd don't give
+#   cpan/Cwd/Cwd.t will complain if `pwd` and cwd don't give
 #   the same results. cwd calls `fullpath -t`, so if you
 #   cd `fullpath -t` before running the test, it will
 #   pass.
Index: src/gnu/usr.bin/perl/lib/Carp.pm
diff -u src/gnu/usr.bin/perl/lib/Carp.pm:1.10 src/gnu/usr.bin/perl/lib/Carp.pm:1.11
--- lib/Carp.pm:1.10	Mon Oct 12 18:24:37 2009
+++ lib/Carp.pm	Fri Sep 24 15:06:58 2010
@@ -1,9 +1,6 @@
 package Carp;
 
-our $VERSION = '1.11';
-# this file is an utra-lightweight stub. The first time a function is
-# called, Carp::Heavy is loaded, and the real short/longmessmess_jmp
-# subs are installed
+our $VERSION = '1.17';
 
 our $MaxEvalLen = 0;
 our $Verbose    = 0;
@@ -17,6 +14,21 @@
 our @EXPORT_OK = qw(cluck verbose longmess shortmess);
 our @EXPORT_FAIL = qw(verbose);	# hook to enable verbose mode
 
+# The members of %Internal are packages that are internal to perl.
+# Carp will not report errors from within these packages if it
+# can.  The members of %CarpInternal are internal to Perl's warning
+# system.  Carp will not report errors from within these packages
+# either, and will not report calls *to* these packages for carp and
+# croak.  They replace $CarpLevel, which is deprecated.    The
+# $Max(EvalLen|(Arg(Len|Nums)) variables are used to specify how the eval
+# text and function arguments should be formatted when printed.
+
+# disable these by default, so they can live w/o require Carp
+$CarpInternal{Carp}++;
+$CarpInternal{warnings}++;
+$Internal{Exporter}++;
+$Internal{'Exporter::Heavy'}++;
+
 # if the caller specifies verbose usage ("perl -MCarp=verbose script.pl")
 # then the following method will be called by the Exporter which knows
 # to do this thanks to @EXPORT_FAIL, above.  $_[1] will contain the word
@@ -24,29 +36,279 @@
 
 sub export_fail { shift; $Verbose = shift if $_[0] eq 'verbose'; @_ }
 
-# fixed hooks for stashes to point to
-sub longmess  { goto &longmess_jmp }
-sub shortmess { goto &shortmess_jmp }
-# these two are replaced when Carp::Heavy is loaded
-sub longmess_jmp  {
-    local($@, $!);
-    eval { require Carp::Heavy };
-    return $@ if $@;
-    goto &longmess_real;
-}
-sub shortmess_jmp  {
-    local($@, $!);
-    eval { require Carp::Heavy };
-    return $@ if $@;
-    goto &shortmess_real;
-}
+sub longmess {
+    # Icky backwards compatibility wrapper. :-(
+    #
+    # The story is that the original implementation hard-coded the
+    # number of call levels to go back, so calls to longmess were off
+    # by one.  Other code began calling longmess and expecting this
+    # behaviour, so the replacement has to emulate that behaviour.
+    my $call_pack = defined &{"CORE::GLOBAL::caller"} ? &{"CORE::GLOBAL::caller"}() : caller();
+    if ($Internal{$call_pack} or $CarpInternal{$call_pack}) {
+      return longmess_heavy(@_);
+    }
+    else {
+      local $CarpLevel = $CarpLevel + 1;
+      return longmess_heavy(@_);
+    }
+};
+
+sub shortmess {
+    # Icky backwards compatibility wrapper. :-(
+    local @CARP_NOT = defined &{"CORE::GLOBAL::caller"} ? &{"CORE::GLOBAL::caller"}() : caller();
+    shortmess_heavy(@_);
+};
 
 sub croak   { die  shortmess @_ }
 sub confess { die  longmess  @_ }
 sub carp    { warn shortmess @_ }
 sub cluck   { warn longmess  @_ }
 
+sub caller_info {
+  my $i = shift(@_) + 1;
+  my %call_info;
+  {
+  package DB;
+  @args = \$i; # A sentinal, which no-one else has the address of
+  @call_info{
+    qw(pack file line sub has_args wantarray evaltext is_require)
+  } = defined &{"CORE::GLOBAL::caller"} ? &{"CORE::GLOBAL::caller"}($i) : caller($i);
+  }
+  
+  unless (defined $call_info{pack}) {
+    return ();
+  }
+
+  my $sub_name = Carp::get_subname(\%call_info);
+  if ($call_info{has_args}) {
+    my @args;
+    if (@DB::args == 1 && ref $DB::args[0] eq ref \$i && $DB::args[0] == \$i) {
+      @DB::args = (); # Don't let anyone see the address of $i
+      @args = "** Incomplete caller override detected; \@DB::args were not set **";
+    } else {
+      @args = map {Carp::format_arg($_)} @DB::args;
+    }
+    if ($MaxArgNums and @args > $MaxArgNums) { # More than we want to show?
+      $#args = $MaxArgNums;
+      push @args, '...';
+    }
+    # Push the args onto the subroutine
+    $sub_name .= '(' . join (', ', @args) . ')';
+  }
+  $call_info{sub_name} = $sub_name;
+  return wantarray() ? %call_info : \%call_info;
+}
+
+# Transform an argument to a function into a string.
+sub format_arg {
+  my $arg = shift;
+  if (ref($arg)) {
+      $arg = defined($overload::VERSION) ? overload::StrVal($arg) : "$arg";
+  }
+  if (defined($arg)) {
+      $arg =~ s/'/\\'/g;
+      $arg = str_len_trim($arg, $MaxArgLen);
+  
+      # Quote it?
+      $arg = "'$arg'" unless $arg =~ /^-?[\d.]+\z/;
+  } else {
+      $arg = 'undef';
+  }
+
+  # The following handling of "control chars" is direct from
+  # the original code - it is broken on Unicode though.
+  # Suggestions?
+  utf8::is_utf8($arg)
+    or $arg =~ s/([[:cntrl:]]|[[:^ascii:]])/sprintf("\\x{%x}",ord($1))/eg;
+  return $arg;
+}
+
+# Takes an inheritance cache and a package and returns
+# an anon hash of known inheritances and anon array of
+# inheritances which consequences have not been figured
+# for.
+sub get_status {
+    my $cache = shift;
+    my $pkg = shift;
+    $cache->{$pkg} ||= [{$pkg => $pkg}, [trusts_directly($pkg)]];
+    return @{$cache->{$pkg}};
+}
+
+# Takes the info from caller() and figures out the name of
+# the sub/require/eval
+sub get_subname {
+  my $info = shift;
+  if (defined($info->{evaltext})) {
+    my $eval = $info->{evaltext};
+    if ($info->{is_require}) {
+      return "require $eval";
+    }
+    else {
+      $eval =~ s/([\\\'])/\\$1/g;
+      return "eval '" . str_len_trim($eval, $MaxEvalLen) . "'";
+    }
+  }
+
+  return ($info->{sub} eq '(eval)') ? 'eval {...}' : $info->{sub};
+}
+
+# Figures out what call (from the point of view of the caller)
+# the long error backtrace should start at.
+sub long_error_loc {
+  my $i;
+  my $lvl = $CarpLevel;
+  {
+    ++$i;
+    my $pkg = defined &{"CORE::GLOBAL::caller"} ? &{"CORE::GLOBAL::caller"}($i) : caller($i);
+    unless(defined($pkg)) {
+      # This *shouldn't* happen.
+      if (%Internal) {
+        local %Internal;
+        $i = long_error_loc();
+        last;
+      }
+      else {
+        # OK, now I am irritated.
+        return 2;
+      }
+    }
+    redo if $CarpInternal{$pkg};
+    redo unless 0 > --$lvl;
+    redo if $Internal{$pkg};
+  }
+  return $i - 1;
+}
+
+
+sub longmess_heavy {
+  return @_ if ref($_[0]); # don't break references as exceptions
+  my $i = long_error_loc();
+  return ret_backtrace($i, @_);
+}
+
+# Returns a full stack backtrace starting from where it is
+# told.
+sub ret_backtrace {
+  my ($i, @error) = @_;
+  my $mess;
+  my $err = join '', @error;
+  $i++;
+
+  my $tid_msg = '';
+  if (defined &threads::tid) {
+    my $tid = threads->tid;
+    $tid_msg = " thread $tid" if $tid;
+  }
+
+  my %i = caller_info($i);
+  $mess = "$err at $i{file} line $i{line}$tid_msg\n";
+
+  while (my %i = caller_info(++$i)) {
+      $mess .= "\t$i{sub_name} called at $i{file} line $i{line}$tid_msg\n";
+  }
+  
+  return $mess;
+}
+
+sub ret_summary {
+  my ($i, @error) = @_;
+  my $err = join '', @error;
+  $i++;
+
+  my $tid_msg = '';
+  if (defined &threads::tid) {
+    my $tid = threads->tid;
+    $tid_msg = " thread $tid" if $tid;
+  }
+
+  my %i = caller_info($i);
+  return "$err at $i{file} line $i{line}$tid_msg\n";
+}
+
+
+sub short_error_loc {
+  # You have to create your (hash)ref out here, rather than defaulting it
+  # inside trusts *on a lexical*, as you want it to persist across calls.
+  # (You can default it on $_[2], but that gets messy)
+  my $cache = {};
+  my $i = 1;
+  my $lvl = $CarpLevel;
+  {
+
+    my $called = defined &{"CORE::GLOBAL::caller"} ? &{"CORE::GLOBAL::caller"}($i) : caller($i);
+    $i++;
+    my $caller = defined &{"CORE::GLOBAL::caller"} ? &{"CORE::GLOBAL::caller"}($i) : caller($i);
+
+    return 0 unless defined($caller); # What happened?
+    redo if $Internal{$caller};
+    redo if $CarpInternal{$caller};
+    redo if $CarpInternal{$called};
+    redo if trusts($called, $caller, $cache);
+    redo if trusts($caller, $called, $cache);
+    redo unless 0 > --$lvl;
+  }
+  return $i - 1;
+}
+
+
+sub shortmess_heavy {
+  return longmess_heavy(@_) if $Verbose;
+  return @_ if ref($_[0]); # don't break references as exceptions
+  my $i = short_error_loc();
+  if ($i) {
+    ret_summary($i, @_);
+  }
+  else {
+    longmess_heavy(@_);
+  }
+}
+
+# If a string is too long, trims it with ...
+sub str_len_trim {
+  my $str = shift;
+  my $max = shift || 0;
+  if (2 < $max and $max < length($str)) {
+    substr($str, $max - 3) = '...';
+  }
+  return $str;
+}
+
+# Takes two packages and an optional cache.  Says whether the
+# first inherits from the second.
+#
+# Recursive versions of this have to work to avoid certain
+# possible endless loops, and when following long chains of
+# inheritance are less efficient.
+sub trusts {
+    my $child = shift;
+    my $parent = shift;
+    my $cache = shift;
+    my ($known, $partial) = get_status($cache, $child);
+    # Figure out consequences until we have an answer
+    while (@$partial and not exists $known->{$parent}) {
+        my $anc = shift @$partial;
+        next if exists $known->{$anc};
+        $known->{$anc}++;
+        my ($anc_knows, $anc_partial) = get_status($cache, $anc);
+        my @found = keys %$anc_knows;
+        @$known{@found} = ();
+        push @$partial, @$anc_partial;
+    }
+    return exists $known->{$parent};
+}
+
+# Takes a package and gives a list of those trusted directly
+sub trusts_directly {
+    my $class = shift;
+    no strict 'refs';
+    no warnings 'once'; 
+    return @{"$class\::CARP_NOT"}
+      ? @{"$class\::CARP_NOT"}
+      : @{"$class\::ISA"};
+}
+
 1;
+
 __END__
 
 =head1 NAME
@@ -175,11 +437,50 @@
 
 =head2 $Carp::Verbose
 
-This variable makes C<carp> and C<cluck> generate stack backtraces
+This variable makes C<carp> and C<croak> generate stack backtraces
 just like C<cluck> and C<confess>.  This is how C<use Carp 'verbose'>
 is implemented internally.
 
 Defaults to C<0>.
+
+=head2 @CARP_NOT
+
+This variable, I<in your package>, says which packages are I<not> to be
+considered as the location of an error. The C<carp()> and C<cluck()>
+functions will skip over callers when reporting where an error occurred.
+
+NB: This variable must be in the package's symbol table, thus:
+
+    # These work
+    our @CARP_NOT; # file scope
+    use vars qw(@CARP_NOT); # package scope
+    @My::Package::CARP_NOT = ... ; # explicit package variable
+
+    # These don't work
+    sub xyz { ... @CARP_NOT = ... } # w/o declarations above
+    my @CARP_NOT; # even at top-level
+
+Example of use:
+
+    package My::Carping::Package;
+    use Carp;
+    our @CARP_NOT;
+    sub bar     { .... or _error('Wrong input') }
+    sub _error  {
+        # temporary control of where'ness, __PACKAGE__ is implicit
+        local @CARP_NOT = qw(My::Friendly::Caller);
+        carp(@_)
+    }
+
+This would make C<Carp> report the error as coming from a caller not
+in C<My::Carping::Package>, nor from C<My::Friendly::Caller>.
+
+Also read the L</DESCRIPTION> section above, about how C<Carp> decides
+where the error is reported from.
+
+Use C<@CARP_NOT>, instead of C<$Carp::CarpLevel>.
+
+Overrides C<Carp>'s use of C<@ISA>.
 
 =head2 %Carp::Internal
 
Index: src/gnu/usr.bin/perl/lib/Env.pm
diff -u src/gnu/usr.bin/perl/lib/Env.pm:1.5 src/gnu/usr.bin/perl/lib/Env.pm:1.6
--- lib/Env.pm:1.5	Sun Oct 27 22:25:25 2002
+++ lib/Env.pm	Fri Sep 24 15:06:58 2010
@@ -1,6 +1,6 @@
 package Env;
 
-our $VERSION = '1.00';
+our $VERSION = '1.01';
 
 =head1 NAME
 
@@ -132,8 +132,7 @@
 
 sub FETCHSIZE {
     my ($self) = @_;
-    my @temp = split($sep, $ENV{$$self});
-    return scalar(@temp);
+    return 1 + scalar(() = $ENV{$$self} =~ /\Q$sep\E/g);
 }
 
 sub STORESIZE {
@@ -161,6 +160,19 @@
     return $value;
 }
 
+sub EXISTS {
+    my ($self, $index) = @_;
+    return $index < $self->FETCHSIZE;
+}
+
+sub DELETE {
+    my ($self, $index) = @_;
+    my @temp = split($sep, $ENV{$$self});
+    my $value = splice(@temp, $index, 1, ());
+    $ENV{$$self} = join($sep, @temp);
+    return $value;
+}
+
 sub PUSH {
     my $self = shift;
     my @temp = split($sep, $ENV{$$self});
@@ -231,5 +243,12 @@
     my ($self, $index) = @_;
     return $ENV{$$self . ';' . $index};
 }
+
+sub EXISTS {
+    my ($self, $index) = @_;
+    return $index < $self->FETCHSIZE;
+}
+
+sub DELETE { }
 
 1;
Index: src/gnu/usr.bin/perl/lib/Exporter.pm
diff -u src/gnu/usr.bin/perl/lib/Exporter.pm:1.9 src/gnu/usr.bin/perl/lib/Exporter.pm:1.10
--- lib/Exporter.pm:1.9	Mon Oct 12 18:24:38 2009
+++ lib/Exporter.pm	Fri Sep 24 15:06:58 2010
@@ -9,11 +9,8 @@
 our $Debug = 0;
 our $ExportLevel = 0;
 our $Verbose ||= 0;
-our $VERSION = '5.63';
+our $VERSION = '5.64_01';
 our (%Cache);
-
-# Carp 1.05+ does this now for us, but we may be running with an old Carp
-$Carp::Internal{Exporter}++;
 
 sub as_heavy {
   require Exporter::Heavy;
Index: src/gnu/usr.bin/perl/lib/UNIVERSAL.pm
diff -u src/gnu/usr.bin/perl/lib/UNIVERSAL.pm:1.6 src/gnu/usr.bin/perl/lib/UNIVERSAL.pm:1.7
--- lib/UNIVERSAL.pm:1.6	Mon Oct 12 18:24:38 2009
+++ lib/UNIVERSAL.pm	Fri Sep 24 15:06:59 2010
@@ -1,6 +1,6 @@
 package UNIVERSAL;
 
-our $VERSION = '1.05';
+our $VERSION = '1.06';
 
 # UNIVERSAL should not contain any extra subs/methods beyond those
 # that it exists to define. The use of Exporter below is a historical
@@ -15,6 +15,12 @@
 # anything unless called on UNIVERSAL.
 sub import {
     return unless $_[0] eq __PACKAGE__;
+    return unless @_ > 1;
+    require warnings;
+    warnings::warnif(
+      'deprecated',
+      'UNIVERSAL->import is deprecated and will be removed in a future perl',
+    );
     goto &Exporter::import;
 }
 
@@ -141,7 +147,7 @@
 C<VAL>.
 
 C<can> cannot know whether an object will be able to provide a method through
-AUTOLOAD (unless the object's class has overriden C<can> appropriately), so a
+AUTOLOAD (unless the object's class has overridden C<can> appropriately), so a
 return value of I<undef> does not necessarily mean the object will not be able
 to handle the method call. To get around this some module authors use a forward
 declaration (see L<perlsub>) for methods they will handle via AUTOLOAD. For
@@ -159,7 +165,9 @@
 C<VERSION> will return the value of the variable C<$VERSION> in the
 package the object is blessed into. If C<REQUIRE> is given then
 it will do a comparison and die if the package version is not
-greater than or equal to C<REQUIRE>.
+greater than or equal to C<REQUIRE>.  Both C<$VERSION> or C<REQUIRE>
+must be "lax" version numbers (as defined by the L<version> module)
+or C<VERSION> will die with an error.
 
 C<VERSION> can be called as either a class (static) method or an object
 method.
@@ -181,7 +189,8 @@
 None by default.
 
 You may request the import of three functions (C<isa>, C<can>, and C<VERSION>),
-however it is usually harmful to do so.  Please don't do this in new code.
+B<but this feature is deprecated and will be removed>.  Please don't do this in
+new code.
 
 For example, previous versions of this documentation suggested using C<isa> as
 a function to determine the type of a reference:
Index: src/gnu/usr.bin/perl/lib/abbrev.pl
diff -u src/gnu/usr.bin/perl/lib/abbrev.pl:1.3 src/gnu/usr.bin/perl/lib/abbrev.pl:1.4
--- lib/abbrev.pl:1.3	Thu Apr  6 17:06:06 2000
+++ lib/abbrev.pl	Fri Sep 24 15:06:59 2010
@@ -7,6 +7,8 @@
 #
 # This library is no longer being maintained, and is included for backward
 # compatibility with Perl 4 programs which may require it.
+# This legacy library is deprecated and will be removed in a future
+# release of perl.
 #
 # In particular, this should not be used as an example of modern Perl
 # programming techniques.
Index: src/gnu/usr.bin/perl/lib/bigfloat.pl
diff -u src/gnu/usr.bin/perl/lib/bigfloat.pl:1.3 src/gnu/usr.bin/perl/lib/bigfloat.pl:1.4
--- lib/bigfloat.pl:1.3	Thu Apr  6 17:06:07 2000
+++ lib/bigfloat.pl	Fri Sep 24 15:06:59 2010
@@ -3,12 +3,14 @@
 #
 # This library is no longer being maintained, and is included for backward
 # compatibility with Perl 4 programs which may require it.
+# This legacy library is deprecated and will be removed in a future
+# release of perl.
 #
 # In particular, this should not be used as an example of modern Perl
 # programming techniques.
 #
 # Suggested alternative: Math::BigFloat
-#
+
 # Arbitrary length float math package
 #
 # by Mark Biggar
Index: src/gnu/usr.bin/perl/lib/bigint.pl
diff -u src/gnu/usr.bin/perl/lib/bigint.pl:1.6 src/gnu/usr.bin/perl/lib/bigint.pl:1.7
--- lib/bigint.pl:1.6	Sun Oct 27 22:25:25 2002
+++ lib/bigint.pl	Fri Sep 24 15:06:59 2010
@@ -5,9 +5,11 @@
 #
 # In particular, this should not be used as an example of modern Perl
 # programming techniques.
+# This legacy library is deprecated and will be removed in a future
+# release of perl.
 #
 # Suggested alternative:  Math::BigInt
-#
+
 # arbitrary size integer math package
 #
 # by Mark Biggar
Index: src/gnu/usr.bin/perl/lib/cacheout.pl
diff -u src/gnu/usr.bin/perl/lib/cacheout.pl:1.3 src/gnu/usr.bin/perl/lib/cacheout.pl:1.4
--- lib/cacheout.pl:1.3	Thu Apr  6 17:06:08 2000
+++ lib/cacheout.pl	Fri Sep 24 15:06:59 2010
@@ -1,6 +1,8 @@
 #
 # This library is no longer being maintained, and is included for backward
 # compatibility with Perl 4 programs which may require it.
+# This legacy library is deprecated and will be removed in a future
+# release of perl.
 #
 # In particular, this should not be used as an example of modern Perl
 # programming techniques.
Index: src/gnu/usr.bin/perl/lib/complete.pl
diff -u src/gnu/usr.bin/perl/lib/complete.pl:1.3 src/gnu/usr.bin/perl/lib/complete.pl:1.4
--- lib/complete.pl:1.3	Thu Apr  6 17:06:09 2000
+++ lib/complete.pl	Fri Sep 24 15:06:59 2010
@@ -2,12 +2,14 @@
 #
 # This library is no longer being maintained, and is included for backward
 # compatibility with Perl 4 programs which may require it.
+# This legacy library is deprecated and will be removed in a future
+# release of perl.
 #
 # In particular, this should not be used as an example of modern Perl
 # programming techniques.
 #
 # Suggested alternative: Term::Complete
-#
+
 ;#      @(#)complete.pl,v1.1            (me@anywhere.EBay.Sun.COM) 09/23/91
 ;#
 ;# Author: Wayne Thompson
Index: src/gnu/usr.bin/perl/lib/ctime.pl
diff -u src/gnu/usr.bin/perl/lib/ctime.pl:1.9 src/gnu/usr.bin/perl/lib/ctime.pl:1.10
--- lib/ctime.pl:1.9	Mon Oct 12 18:24:38 2009
+++ lib/ctime.pl	Fri Sep 24 15:06:59 2010
@@ -2,11 +2,14 @@
 #
 # This library is no longer being maintained, and is included for backward
 # compatibility with Perl 4 programs which may require it.
+# This legacy library is deprecated and will be removed in a future
+# release of perl.
 #
 # In particular, this should not be used as an example of modern Perl
 # programming techniques.
 #
 # Suggested alternative: the POSIX ctime function
+
 ;#
 ;# Waldemar Kebsch, Federal Republic of Germany, November 1988
 ;# kebsch.pad@nixpbe.UUCP
Index: src/gnu/usr.bin/perl/lib/diagnostics.pm
diff -u src/gnu/usr.bin/perl/lib/diagnostics.pm:1.12 src/gnu/usr.bin/perl/lib/diagnostics.pm:1.13
--- lib/diagnostics.pm:1.12	Mon Sep 29 17:36:09 2008
+++ lib/diagnostics.pm	Fri Sep 24 15:06:59 2010
@@ -185,7 +185,7 @@
 use Carp;
 $Carp::Internal{__PACKAGE__.""}++;
 
-our $VERSION = 1.17;
+our $VERSION = '1.19';
 our $DEBUG;
 our $VERBOSE;
 our $PRETTY;
@@ -222,6 +222,7 @@
 
 local $| = 1;
 my $_;
+local $.;
 
 my $standalone;
 my(%HTML_2_Troff, %HTML_2_Latin_1, %HTML_2_ASCII_7);
@@ -377,7 +378,7 @@
 	# strip formatting directives from =item line
 	$header =~ s/[A-Z]<(.*?)>/$1/g;
 
-        my @toks = split( /(%l?[dx]|%c|%(?:\.\d+)?s)/, $header );
+        my @toks = split( /(%l?[dx]|%c|%(?:\.\d+)?[fs])/, $header );
 	if (@toks > 1) {
             my $conlen = 0;
             for my $i (0..$#toks){
@@ -386,7 +387,7 @@
                         $toks[$i] = '.';
                     } elsif( $toks[$i] eq '%d' ){
                         $toks[$i] = '\d+';
-                    } elsif( $toks[$i] eq '%s' ){
+                    } elsif( $toks[$i] =~ '^%(?:s|.*f)$' ){
                         $toks[$i] = $i == $#toks ? '.*' : '.*?';
                     } elsif( $toks[$i] =~ '%.(\d+)s' ){
                         $toks[$i] = ".{$1}";
Index: src/gnu/usr.bin/perl/lib/dotsh.pl
diff -u src/gnu/usr.bin/perl/lib/dotsh.pl:1.4 src/gnu/usr.bin/perl/lib/dotsh.pl:1.5
--- lib/dotsh.pl:1.4	Mon Aug  9 18:09:28 2004
+++ lib/dotsh.pl	Fri Sep 24 15:06:59 2010
@@ -3,11 +3,12 @@
 #
 # This library is no longer being maintained, and is included for backward
 # compatibility with Perl 4 programs which may require it.
+# This legacy library is deprecated and will be removed in a future
+# release of perl.
 #
 # In particular, this should not be used as an example of modern Perl
 # programming techniques.
 #
-#
 #   Author: Charles Collins
 #
 #   Description:
@@ -31,6 +32,7 @@
 #      &dotsh ('/foo/bar');
 #      &dotsh ('/foo/bar arg1 ... argN');
 #
+
 sub dotsh {
    local(@sh) = @_;
    local($tmp,$key,$shell,$command,$args,$vars) = '';
Index: src/gnu/usr.bin/perl/lib/find.pl
diff -u src/gnu/usr.bin/perl/lib/find.pl:1.2 src/gnu/usr.bin/perl/lib/find.pl:1.3
--- lib/find.pl:1.2	Sun Nov 30 07:56:56 1997
+++ lib/find.pl	Fri Sep 24 15:06:59 2010
@@ -1,3 +1,8 @@
+# This library is deprecated and unmaintained. It is included for
+# compatibility with Perl 4 scripts which may use it, but it will be
+# removed in a future version of Perl. Please use the File::Find module
+# instead.
+
 # Usage:
 #	require "find.pl";
 #
@@ -10,11 +15,11 @@
 #		to $dir when the function is called.  The function may
 #		set $prune to prune the tree.
 #
-# This library is primarily for find2perl, which, when fed
+# For example,
 #
-#   find2perl / -name .nfs\* -mtime +7 -exec rm -f {} \; -o -fstype nfs -prune
+#   find / -name .nfs\* -mtime +7 -exec rm -f {} \; -o -fstype nfs -prune
 #
-# spits out something like this
+# corresponds to this
 #
 #	sub wanted {
 #	    /^\.nfs.*$/ &&
Index: src/gnu/usr.bin/perl/lib/finddepth.pl
diff -u src/gnu/usr.bin/perl/lib/finddepth.pl:1.2 src/gnu/usr.bin/perl/lib/finddepth.pl:1.3
--- lib/finddepth.pl:1.2	Sun Nov 30 07:56:57 1997
+++ lib/finddepth.pl	Fri Sep 24 15:06:59 2010
@@ -1,3 +1,8 @@
+# This library is deprecated and unmaintained. It is included for
+# compatibility with Perl 4 scripts which may use it, but it will be
+# removed in a future version of Perl. Please use the File::Find module
+# instead.
+
 # Usage:
 #	require "finddepth.pl";
 #
@@ -10,11 +15,11 @@
 #		to $dir when the function is called.  The function may
 #		set $prune to prune the tree.
 #
-# This library is primarily for find2perl, which, when fed
+# For example,
 #
-#   find2perl / -name .nfs\* -mtime +7 -exec rm -f {} \; -o -fstype nfs -prune
+#   find / -name .nfs\* -mtime +7 -exec rm -f {} \; -o -fstype nfs -prune
 #
-# spits out something like this
+# corresponds to this
 #
 #	sub wanted {
 #	    /^\.nfs.*$/ &&
Index: src/gnu/usr.bin/perl/lib/getcwd.pl
diff -u src/gnu/usr.bin/perl/lib/getcwd.pl:1.3 src/gnu/usr.bin/perl/lib/getcwd.pl:1.4
--- lib/getcwd.pl:1.3	Thu Apr  6 17:06:11 2000
+++ lib/getcwd.pl	Fri Sep 24 15:06:59 2010
@@ -2,12 +2,13 @@
 #
 # This library is no longer being maintained, and is included for backward
 # compatibility with Perl 4 programs which may require it.
-#
+# This legacy library is deprecated and will be removed in a future
+# release of perl.
 # In particular, this should not be used as an example of modern Perl
 # programming techniques.
 #
 # Suggested alternative: Cwd
-#
+
 #
 # Usage: $cwd = &getcwd;
 
Index: src/gnu/usr.bin/perl/lib/getopt.pl
diff -u src/gnu/usr.bin/perl/lib/getopt.pl:1.9 src/gnu/usr.bin/perl/lib/getopt.pl:1.10
--- lib/getopt.pl:1.9	Mon Oct 12 18:24:38 2009
+++ lib/getopt.pl	Fri Sep 24 15:06:59 2010
@@ -2,12 +2,14 @@
 #
 # This library is no longer being maintained, and is included for backward
 # compatibility with Perl 4 programs which may require it.
+# This legacy library is deprecated and will be removed in a future
+# release of perl.
 #
 # In particular, this should not be used as an example of modern Perl
 # programming techniques.
 #
 # Suggested alternatives: Getopt::Long or Getopt::Std
-#
+
 ;# Process single-character switches with switch clustering.  Pass one argument
 ;# which is a string containing all switches that take an argument.  For each
 ;# switch found, sets $opt_x (where x is the switch name) to the value of the
Index: src/gnu/usr.bin/perl/lib/getopts.pl
diff -u src/gnu/usr.bin/perl/lib/getopts.pl:1.5 src/gnu/usr.bin/perl/lib/getopts.pl:1.6
--- lib/getopts.pl:1.5	Tue Mar 28 19:23:05 2006
+++ lib/getopts.pl	Fri Sep 24 15:06:59 2010
@@ -7,7 +7,7 @@
 # programming techniques.
 #
 # Suggested alternatives: Getopt::Long  or  Getopt::Std
-#
+
 ;# Usage:
 ;#      do Getopts('a:bc');  # -a takes arg. -b & -c not. Sets opt_* as a
 ;#                           #  side effect.
Index: src/gnu/usr.bin/perl/lib/importenv.pl
diff -u src/gnu/usr.bin/perl/lib/importenv.pl:1.8 src/gnu/usr.bin/perl/lib/importenv.pl:1.9
--- lib/importenv.pl:1.8	Mon Sep 29 17:36:09 2008
+++ lib/importenv.pl	Fri Sep 24 15:06:59 2010
@@ -1,3 +1,8 @@
+# This library is no longer being maintained, and is included for backward
+# compatibility with Perl 4 programs which may require it.
+# This legacy library is deprecated and will be removed in a future
+# release of perl.
+
 ;# This file, when interpreted, pulls the environment into normal variables.
 ;# Usage:
 ;#	require 'importenv.pl';
Index: src/gnu/usr.bin/perl/lib/look.pl
diff -u src/gnu/usr.bin/perl/lib/look.pl:1.3 src/gnu/usr.bin/perl/lib/look.pl:1.4
--- lib/look.pl:1.3	Thu Apr  6 17:06:14 2000
+++ lib/look.pl	Fri Sep 24 15:06:59 2010
@@ -2,10 +2,12 @@
 #
 # This library is no longer being maintained, and is included for backward
 # compatibility with Perl 4 programs which may require it.
+# This legacy library is deprecated and will be removed in a future
+# release of perl.
 #
 # In particular, this should not be used as an example of modern Perl
 # programming techniques.
-#
+
 ;# Sets file position in FILEHANDLE to be first line greater than or equal
 ;# (stringwise) to $key.  Pass flags for dictionary order and case folding.
 
Index: src/gnu/usr.bin/perl/lib/newgetopt.pl
diff -u src/gnu/usr.bin/perl/lib/newgetopt.pl:1.9 src/gnu/usr.bin/perl/lib/newgetopt.pl:1.10
--- lib/newgetopt.pl:1.9	Mon Oct 12 18:24:38 2009
+++ lib/newgetopt.pl	Fri Sep 24 15:06:59 2010
@@ -3,6 +3,8 @@
 # This library is no longer being maintained, and is included for backward
 # compatibility with Perl 4 programs which may require it.
 # It is now just a wrapper around the Getopt::Long module.
+# This legacy library is deprecated and will be removed in a future
+# release of perl.
 #
 # In particular, this should not be used as an example of modern Perl
 # programming techniques.
Index: src/gnu/usr.bin/perl/lib/open2.pl
diff -u src/gnu/usr.bin/perl/lib/open2.pl:1.2 src/gnu/usr.bin/perl/lib/open2.pl:1.3
--- lib/open2.pl:1.2	Sun Nov 30 07:57:04 1997
+++ lib/open2.pl	Fri Sep 24 15:06:59 2010
@@ -1,3 +1,6 @@
+# This legacy library is deprecated and will be removed in a future
+# release of perl.
+#
 # This is a compatibility interface to IPC::Open2.  New programs should
 # do
 #
Index: src/gnu/usr.bin/perl/lib/open3.pl
diff -u src/gnu/usr.bin/perl/lib/open3.pl:1.2 src/gnu/usr.bin/perl/lib/open3.pl:1.3
--- lib/open3.pl:1.2	Sun Nov 30 07:57:05 1997
+++ lib/open3.pl	Fri Sep 24 15:06:59 2010
@@ -1,3 +1,6 @@
+# This legacy library is deprecated and will be removed in a future
+# release of perl.
+#
 # This is a compatibility interface to IPC::Open3.  New programs should
 # do
 #
Index: src/gnu/usr.bin/perl/lib/overload.pm
diff -u src/gnu/usr.bin/perl/lib/overload.pm:1.11 src/gnu/usr.bin/perl/lib/overload.pm:1.12
--- lib/overload.pm:1.11	Mon Oct 12 18:24:38 2009
+++ lib/overload.pm	Fri Sep 24 15:06:59 2010
@@ -1,6 +1,6 @@
 package overload;
 
-our $VERSION = '1.07';
+our $VERSION = '1.10';
 
 sub nil {}
 
@@ -9,6 +9,7 @@
   my %arg = @_;
   my ($sub, $fb);
   $ {$package . "::OVERLOAD"}{dummy}++; # Register with magic by touching.
+  $fb = ${$package . "::()"}; # preserve old fallback value RT#68196
   *{$package . "::()"} = \&nil; # Make it findable via fetchmethod.
   for (keys %arg) {
     if ($_ eq 'fallback') {
@@ -104,6 +105,10 @@
 sub mycan {				# Real can would leave stubs.
   my ($package, $meth) = @_;
 
+  local $@;
+  local $!;
+  require mro;
+
   my $mro = mro::get_linear_isa($package);
   foreach my $p (@$mro) {
     my $fqmeth = $p . q{::} . $meth;
@@ -130,8 +135,9 @@
 	 unary		  => "neg ! ~",
 	 mutators	  => '++ --',
 	 func		  => "atan2 cos sin exp abs log sqrt int",
-	 conversion	  => 'bool "" 0+',
+	 conversion	  => 'bool "" 0+ qr',
 	 iterators	  => '<>',
+         filetest         => "-X",
 	 dereferencing	  => '${} @{} %{} &{} *{}',
 	 matching	  => '~~',
 	 special	  => 'nomethod fallback =');
@@ -394,15 +400,20 @@
 C<int> is unavailable, it can be autogenerated using the overloading of
 C<0+>.
 
-=item * I<Boolean, string and numeric conversion>
+=item * I<Boolean, string, numeric and regexp conversions>
 
-    'bool', '""', '0+',
+    'bool', '""', '0+', 'qr'
 
-If one or two of these operations are not overloaded, the remaining ones can
-be used instead.  C<bool> is used in the flow control operators
-(like C<while>) and for the ternary C<?:> operation.  These functions can
-return any arbitrary Perl value.  If the corresponding operation for this value
-is overloaded too, that operation will be called again with this value.
+If one or two of these operations are not overloaded, the remaining ones
+can be used instead.  C<bool> is used in the flow control operators
+(like C<while>) and for the ternary C<?:> operation; C<qr> is used for
+the RHS of C<=~> and when an object is interpolated into a regexp.
+
+C<bool>, C<"">, and C<0+> can return any arbitrary Perl value.  If the
+corresponding operation for this value is overloaded too, that operation
+will be called again with this value. C<qr> must return a compiled
+regexp, or a ref to a compiled regexp (such as C<qr//> returns), and any
+further overloading on the return value will be ignored.
 
 As a special case if the overload returns the object itself then it will
 be used directly. An overloaded conversion returning the object is
@@ -421,6 +432,29 @@
 B<BUGS> Even in list context, the iterator is currently called only
 once and with scalar context.
 
+=item * I<File tests>
+
+    "-X"
+
+This overload is used for all the filetest operators (C<-f>, C<-x> and
+so on: see L<perlfunc/-X> for the full list). Even though these are
+unary operators, the method will be called with a second argument which
+is a single letter indicating which test was performed. Note that the
+overload key is the literal string C<"-X">: you can't provide separate
+overloads for the different tests.
+
+Calling an overloaded filetest operator does not affect the stat value
+associated with the special filehandle C<_>. It still refers to the
+result of the last C<stat>, C<lstat> or unoverloaded filetest.
+
+If not overloaded, these operators will fall back to the default
+behaviour even without C<< fallback => 1 >>. This means that if the
+object is a blessed glob or blessed IO ref it will be treated as a
+filehandle, otherwise string overloading will be invoked and the result
+treated as a filename.
+
+This overload was introduced in perl 5.12.
+
 =item * I<Matching>
 
 The key C<"~~"> allows you to override the smart matching logic used by
@@ -489,8 +523,9 @@
  unary		  => 'neg ! ~',
  mutators	  => '++ --',
  func		  => 'atan2 cos sin exp abs log sqrt',
- conversion	  => 'bool "" 0+',
+ conversion	  => 'bool "" 0+ qr',
  iterators	  => '<>',
+ filetest         => '-X',
  dereferencing	  => '${} @{} %{} &{} *{}',
  matching	  => '~~',
  special	  => 'nomethod fallback ='
@@ -663,8 +698,8 @@
 
 =item I<Conversion operations>
 
-String, numeric, and boolean conversion are calculated in terms of one
-another if not all of them are defined.
+String, numeric, boolean and regexp conversions are calculated in terms
+of one another if not all of them are defined.
 
 =item I<Increment and decrement>
 
Index: src/gnu/usr.bin/perl/lib/perl5db.pl
diff -u src/gnu/usr.bin/perl/lib/perl5db.pl:1.14 src/gnu/usr.bin/perl/lib/perl5db.pl:1.15
--- lib/perl5db.pl:1.14	Tue Oct 13 01:25:48 2009
+++ lib/perl5db.pl	Fri Sep 24 15:06:59 2010
@@ -511,7 +511,7 @@
 BEGIN {eval 'use IO::Handle'};	# Needed for flush only? breaks under miniperl
 
 # Debugger for Perl 5.00x; perl5db.pl patch level:
-$VERSION = 1.32;
+$VERSION = '1.33';
 
 $header = "perl5db.pl version $VERSION";
 
@@ -949,6 +949,9 @@
 #   + [perl #57016] debugger: o warn=0 die=0 ignored
 #   + Note, but don't use, PERLDBf_SAVESRC
 #   + Fix #7013: lvalue subs not working inside debugger
+# Changes: 1.32: Jun 03, 2009 Jonathan Leto <jonathan@leto.net>
+#   + Fix bug where a key _< with undefined value was put into the symbol table
+#   +   when the $filename variable is not set
 ########################################################################
 
 =head1 DEBUGGER INITIALIZATION
@@ -1053,8 +1056,9 @@
   )
   if 0;
 
+# without threads, $filename is not defined until DB::DB is called
 foreach my $k (keys (%INC)) {
-	&share(\$main::{'_<'.$filename});
+	&share(\$main::{'_<'.$filename}) if defined $filename;
 };
 
 # Command-line + PERLLIB:
@@ -1846,7 +1850,7 @@
 This gigantic subroutine is the heart of the debugger. Called before every
 statement, its job is to determine if a breakpoint has been reached, and
 stop if so; read commands from the user, parse them, and execute
-them, and hen send execution off to the next statement.
+them, and then send execution off to the next statement.
 
 Note that the order in which the commands are processed is very important;
 some commands earlier in the loop will actually alter the C<$cmd> variable
@@ -4831,30 +4835,21 @@
 sub cmd_i {
     my $cmd  = shift;
     my $line = shift;
-    eval { require Class::ISA };
-    if ($@) {
-        &warn( $@ =~ /locate/
-            ? "Class::ISA module not found - please install\n"
-            : $@ );
-    }
-    else {
-      ISA:
-        foreach my $isa ( split( /\s+/, $line ) ) {
-            $evalarg = $isa;
-            ($isa) = &eval;
-            no strict 'refs';
-            print join(
-                ', ',
-                map {    # snaffled unceremoniously from Class::ISA
-                    "$_"
-                      . (
-                        defined( ${"$_\::VERSION"} )
-                        ? ' ' . ${"$_\::VERSION"}
-                        : undef )
-                  } Class::ISA::self_and_super_path(ref($isa) || $isa)
-            );
-            print "\n";
-        }
+    foreach my $isa ( split( /\s+/, $line ) ) {
+        $evalarg = $isa;
+        ($isa) = &eval;
+        no strict 'refs';
+        print join(
+            ', ',
+            map {
+                "$_"
+                  . (
+                    defined( ${"$_\::VERSION"} )
+                    ? ' ' . ${"$_\::VERSION"}
+                    : undef )
+              } @{mro::get_linear_isa(ref($isa) || $isa)}
+        );
+        print "\n";
     }
 } ## end sub cmd_i
 
@@ -8179,10 +8174,8 @@
     lexwarn
     locale
     lol
-    machten
     macos
     macosx
-    mint
     modinstall
     modlib
     mod
@@ -8197,7 +8190,6 @@
     os2
     os390
     os400
-    othrtut
     packtut
     plan9
     pod
@@ -8613,7 +8605,6 @@
 =cut
 
     if ( $text =~ /^[\$@%]/ ) {    # symbols (in $package + packages in main)
-
 =pod
 
 =over 4
@@ -8637,6 +8628,32 @@
         $prefix = substr $text, 0, 1;
         $text   = substr $text, 1;
 
+        my @out;
+
+=pod
+
+=item *
+
+We look for the lexical scope above DB::DB and auto-complete lexical variables
+if PadWalker could be loaded.
+
+=cut
+
+        if (not $text =~ /::/ and eval "require PadWalker; 1" and not $@ ) {
+            my $level = 1;
+            while (1) {
+                my @info = caller($level);
+                $level++;
+                $level = -1, last
+                  if not @info;
+                last if $info[3] eq 'DB::DB';
+            }
+            if ($level > 0) {
+                my $lexicals = PadWalker::peek_my($level);
+                push @out, grep /^\Q$prefix$text/, keys %$lexicals;
+            }
+        }
+
 =pod
 
 =item *
@@ -8645,7 +8662,7 @@
 
 =cut
 
-        my @out = map "$prefix$_", grep /^\Q$text/,
+        push @out, map "$prefix$_", grep /^\Q$text/,
           ( grep /^_?[a-zA-Z]/, keys %$pack ),
           ( $pack eq '::' ? () : ( grep /::$/, keys %:: ) );
 
Index: src/gnu/usr.bin/perl/lib/pwd.pl
diff -u src/gnu/usr.bin/perl/lib/pwd.pl:1.9 src/gnu/usr.bin/perl/lib/pwd.pl:1.10
--- lib/pwd.pl:1.9	Mon Oct 12 18:24:38 2009
+++ lib/pwd.pl	Fri Sep 24 15:07:01 2010
@@ -3,12 +3,14 @@
 #
 # This library is no longer being maintained, and is included for backward
 # compatibility with Perl 4 programs which may require it.
+# This legacy library is deprecated and will be removed in a future
+# release of perl.
 #
 # In particular, this should not be used as an example of modern Perl
 # programming techniques.
 #
 # Suggested alternative: Cwd
-#
+
 ;# $RCSfile: pwd.pl,v $$Revision: 4.1 $$Date: 92/08/07 18:24:11 $
 ;#
 ;# $Log:	pwd.pl,v $
Index: src/gnu/usr.bin/perl/lib/stat.pl
diff -u src/gnu/usr.bin/perl/lib/stat.pl:1.8 src/gnu/usr.bin/perl/lib/stat.pl:1.9
--- lib/stat.pl:1.8	Mon Sep 29 17:36:10 2008
+++ lib/stat.pl	Fri Sep 24 15:07:01 2010
@@ -1,8 +1,12 @@
+;# This legacy library is deprecated and will be removed in a future
+;# release of perl.
+;#
 ;# Usage:
 ;#	require 'stat.pl';
 ;#	@ary = stat(foo);
 ;#	$st_dev = @ary[$ST_DEV];
 ;#
+
 $ST_DEV =	0 + $[;
 $ST_INO =	1 + $[;
 $ST_MODE =	2 + $[;
Index: src/gnu/usr.bin/perl/lib/termcap.pl
diff -u src/gnu/usr.bin/perl/lib/termcap.pl:1.9 src/gnu/usr.bin/perl/lib/termcap.pl:1.10
--- lib/termcap.pl:1.9	Mon Oct 12 18:24:38 2009
+++ lib/termcap.pl	Fri Sep 24 15:07:01 2010
@@ -2,12 +2,15 @@
 #
 # This library is no longer being maintained, and is included for backward
 # compatibility with Perl 4 programs which may require it.
+# This legacy library is deprecated and will be removed in a future
+# release of perl.
 #
 # In particular, this should not be used as an example of modern Perl
 # programming techniques.
 #
 # Suggested alternative: Term::Cap
 #
+
 ;#
 ;# Usage:
 ;#	require 'ioctl.pl';
Index: src/gnu/usr.bin/perl/lib/timelocal.pl
diff -u src/gnu/usr.bin/perl/lib/timelocal.pl:1.2 src/gnu/usr.bin/perl/lib/timelocal.pl:1.3
--- lib/timelocal.pl:1.2	Sun Nov 30 07:57:12 1997
+++ lib/timelocal.pl	Fri Sep 24 15:07:01 2010
@@ -7,6 +7,8 @@
 ;# This file has been superseded by the Time::Local library module.
 ;# It is implemented as a call to that module for backwards compatibility
 ;# with code written for perl4; new code should use Time::Local directly.
+;# This legacy library is deprecated and will be removed in a future
+;# release of perl.
 
 ;# The current implementation shares with the original the questionable
 ;# behavior of defining the timelocal() and timegm() functions in the
@@ -16,3 +18,4 @@
 use Time::Local;
 
 *timelocal::cheat = \&Time::Local::cheat;
+
Index: src/gnu/usr.bin/perl/lib/ExtUtils/typemap
diff -u src/gnu/usr.bin/perl/lib/ExtUtils/typemap:1.8 src/gnu/usr.bin/perl/lib/ExtUtils/typemap:1.9
--- lib/ExtUtils/typemap:1.8	Mon Sep 29 17:36:11 2008
+++ lib/ExtUtils/typemap	Fri Sep 24 15:07:01 2010
@@ -149,7 +149,7 @@
 			${$ALIAS?\q[GvNAME(CvGV(cv))]:\qq[\"$pname\"]},
 			\"$var\", \"$ntype\")
 T_PTROBJ
-	if (sv_derived_from($arg, \"${ntype}\")) {
+	if (SvROK($arg) && sv_derived_from($arg, \"${ntype}\")) {
 	    IV tmp = SvIV((SV*)SvRV($arg));
 	    $var = INT2PTR($type,tmp);
 	}
Index: src/gnu/usr.bin/perl/lib/File/Basename.pm
diff -u src/gnu/usr.bin/perl/lib/File/Basename.pm:1.11 src/gnu/usr.bin/perl/lib/File/Basename.pm:1.12
--- lib/File/Basename.pm:1.11	Mon Oct 12 18:24:40 2009
+++ lib/File/Basename.pm	Fri Sep 24 15:07:01 2010
@@ -37,13 +37,13 @@
 
 package File::Basename;
 
-# A bit of juggling to insure that C<use re 'taint';> always works, since
 # File::Basename is used during the Perl build, when the re extension may
-# not be available.
+# not be available, but we only actually need it if running under tainting.
 BEGIN {
-  unless (eval { require re; })
-    { eval ' sub re::import { $^H |= 0x00100000; } ' } # HINT_RE_TAINT
-  import re 'taint';
+  if (${^TAINT}) {
+    require re;
+    re->import('taint');
+  }
 }
 
 
@@ -54,7 +54,7 @@
 require Exporter;
 @ISA = qw(Exporter);
 @EXPORT = qw(fileparse fileparse_set_fstype basename dirname);
-$VERSION = "2.77";
+$VERSION = "2.78";
 
 fileparse_set_fstype($^O);
 
Index: src/gnu/usr.bin/perl/lib/File/Copy.pm
diff -u src/gnu/usr.bin/perl/lib/File/Copy.pm:1.12 src/gnu/usr.bin/perl/lib/File/Copy.pm:1.13
--- lib/File/Copy.pm:1.12	Mon Oct 12 18:24:40 2009
+++ lib/File/Copy.pm	Fri Sep 24 15:07:01 2010
@@ -12,10 +12,7 @@
 use warnings;
 use File::Spec;
 use Config;
-# During perl build, we need File::Copy but Fcntl might not be built yet
-# *** not needed for 2.14, only 2.15
-# *** my $Fcntl_loaded = eval q{ use Fcntl qw [O_CREAT O_WRONLY O_TRUNC]; 1 };
-# Similarly Scalar::Util
+# During perl build, we need File::Copy but Scalar::Util might not be built yet
 # And then we need these games to avoid loading overload, as that will
 # confuse miniperl during the bootstrap of perl.
 my $Scalar_Util_loaded = eval q{ require Scalar::Util; require overload; 1 };
@@ -25,7 +22,7 @@
 sub cp;
 sub mv;
 
-$VERSION = '2.14';
+$VERSION = '2.18';
 
 require Exporter;
 @ISA = qw(Exporter);
@@ -51,6 +48,44 @@
 		if $@ && $^W;
 }
 
+# Look up the feature settings on VMS using VMS::Feature when available.
+
+my $use_vms_feature = 0;
+BEGIN {
+    if ($^O eq 'VMS') {
+        if (eval { local $SIG{__DIE__}; require VMS::Feature; }) {
+            $use_vms_feature = 1;
+        }
+    }
+}
+
+# Need to look up the UNIX report mode.  This may become a dynamic mode
+# in the future.
+sub _vms_unix_rpt {
+    my $unix_rpt;
+    if ($use_vms_feature) {
+        $unix_rpt = VMS::Feature::current("filename_unix_report");
+    } else {
+        my $env_unix_rpt = $ENV{'DECC$FILENAME_UNIX_REPORT'} || '';
+        $unix_rpt = $env_unix_rpt =~ /^[ET1]/i;
+    }
+    return $unix_rpt;
+}
+
+# Need to look up the EFS character set mode.  This may become a dynamic
+# mode in the future.
+sub _vms_efs {
+    my $efs;
+    if ($use_vms_feature) {
+        $efs = VMS::Feature::current("efs_charset");
+    } else {
+        my $env_efs = $ENV{'DECC$EFS_CHARSET'} || '';
+        $efs = $env_efs =~ /^[ET1]/i;
+    }
+    return $efs;
+}
+
+
 sub _catname {
     my($from, $to) = @_;
     if (not defined &basename) {
@@ -115,7 +150,7 @@
 	my @fs = stat($from);
 	if (@fs) {
 	    my @ts = stat($to);
-	    if (@ts && $fs[0] == $ts[0] && $fs[1] == $ts[1]) {
+	    if (@ts && $fs[0] == $ts[0] && $fs[1] == $ts[1] && !-p $from) {
 		carp("'$from' and '$to' are identical (not copied)");
                 return 0;
 	    }
@@ -141,14 +176,36 @@
 
             if (! -d $to && ! -d $from) {
 
+                my $vms_efs = _vms_efs();
+                my $unix_rpt = _vms_unix_rpt();
+                my $unix_mode = 0;
+                my $from_unix = 0;
+                $from_unix = 1 if ($from =~ /^\.\.?$/);
+                my $from_vms = 0;
+                $from_vms = 1 if ($from =~ m#[\[<\]]#);
+
+                # Need to know if we are in Unix mode.
+                if ($from_vms == $from_unix) {
+                    $unix_mode = $unix_rpt;
+                } else {
+                    $unix_mode = $from_unix;
+                }
+
                 # VMS has sticky defaults on extensions, which means that
                 # if there is a null extension on the destination file, it
                 # will inherit the extension of the source file
                 # So add a '.' for a null extension.
 
-                $copy_to = VMS::Filespec::vmsify($to);
+                # In unix_rpt mode, the trailing dot should not be added.
+
+                if ($vms_efs) {
+                    $copy_to = $to;
+                } else {
+                    $copy_to = VMS::Filespec::vmsify($to);
+                }
                 my ($vol, $dirs, $file) = File::Spec->splitpath($copy_to);
-                $file = $file . '.' unless ($file =~ /(?<!\^)\./);
+                $file = $file . '.'
+                    unless (($file =~ /(?<!\^)\./) || $unix_rpt);
                 $copy_to = File::Spec->catpath($vol, $dirs, $file);
 
                 # Get rid of the old versions to be like UNIX
@@ -156,7 +213,7 @@
             }
         }
 
-        return syscopy($from, $copy_to);
+        return syscopy($from, $copy_to) || 0;
     }
 
     my $closefrom = 0;
@@ -168,11 +225,9 @@
     if ($from_a_handle) {
        $from_h = $from;
     } else {
-	$from = _protect($from) if $from =~ /^\s/s;
-       $from_h = \do { local *FH };
        open $from_h, "<", $from or goto fail_open1;
        binmode $from_h or die "($!,$^E)";
-	$closefrom = 1;
+       $closefrom = 1;
     }
 
     # Seems most logical to do this here, in case future changes would want to
@@ -187,10 +242,9 @@
     if ($to_a_handle) {
        $to_h = $to;
     } else {
-	$to = _protect($to) if $to =~ /^\s/s;
-       $to_h = \do { local *FH };
-       open $to_h, ">", $to or goto fail_open2;
-       binmode $to_h or die "($!,$^E)";
+	$to_h = \do { local *FH }; # XXX is this line obsolete?
+	open $to_h, ">", $to or goto fail_open2;
+	binmode $to_h or die "($!,$^E)";
 	$closeto = 1;
     }
 
@@ -231,10 +285,50 @@
     return 0;
 }
 
-sub move {
-    croak("Usage: move(FROM, TO) ") unless @_ == 2;
-
+sub cp {
     my($from,$to) = @_;
+    my(@fromstat) = stat $from;
+    my(@tostat) = stat $to;
+    my $perm;
+
+    return 0 unless copy(@_) and @fromstat;
+
+    if (@tostat) {
+        $perm = $tostat[2];
+    } else {
+        $perm = $fromstat[2] & ~(umask || 0);
+	@tostat = stat $to;
+    }
+    # Might be more robust to look for S_I* in Fcntl, but we're
+    # trying to avoid dependence on any XS-containing modules,
+    # since File::Copy is used during the Perl build.
+    $perm &= 07777;
+    if ($perm & 06000) {
+	croak("Unable to check setuid/setgid permissions for $to: $!")
+	    unless @tostat;
+
+	if ($perm & 04000 and                     # setuid
+	    $fromstat[4] != $tostat[4]) {         # owner must match
+	    $perm &= ~06000;
+	}
+
+	if ($perm & 02000 && $> != 0) {           # if not root, setgid
+	    my $ok = $fromstat[5] == $tostat[5];  # group must match
+	    if ($ok) {                            # and we must be in group
+                $ok = grep { $_ == $fromstat[5] } split /\s+/, $)
+	    }
+	    $perm &= ~06000 unless $ok;
+	}
+    }
+    return 0 unless @tostat;
+    return 1 if $perm == ($tostat[2] & 07777);
+    return eval { chmod $perm, $to; } ? 1 : 0;
+}
+
+sub _move {
+    croak("Usage: move(FROM, TO) ") unless @_ == 3;
+
+    my($from,$to,$fallback) = @_;
 
     my($fromsz,$tosz1,$tomt1,$tosz2,$tomt2,$sts,$ossts);
 
@@ -253,14 +347,37 @@
     if (-$^O eq 'VMS' && -e $from) {
 
         if (! -d $to && ! -d $from) {
+
+            my $vms_efs = _vms_efs();
+            my $unix_rpt = _vms_unix_rpt();
+            my $unix_mode = 0;
+            my $from_unix = 0;
+            $from_unix = 1 if ($from =~ /^\.\.?$/);
+            my $from_vms = 0;
+            $from_vms = 1 if ($from =~ m#[\[<\]]#);
+
+            # Need to know if we are in Unix mode.
+            if ($from_vms == $from_unix) {
+                $unix_mode = $unix_rpt;
+            } else {
+                $unix_mode = $from_unix;
+            }
+
             # VMS has sticky defaults on extensions, which means that
             # if there is a null extension on the destination file, it
             # will inherit the extension of the source file
             # So add a '.' for a null extension.
 
-            $rename_to = VMS::Filespec::vmsify($to);
+            # In unix_rpt mode, the trailing dot should not be added.
+
+            if ($vms_efs) {
+                $rename_to = $to;
+            } else {
+                $rename_to = VMS::Filespec::vmsify($to);
+            }
             my ($vol, $dirs, $file) = File::Spec->splitpath($rename_to);
-            $file = $file . '.' unless ($file =~ /(?<!\^)\./);
+            $file = $file . '.'
+                unless (($file =~ /(?<!\^)\./) || $unix_rpt);
             $rename_to = File::Spec->catpath($vol, $dirs, $file);
 
             # Get rid of the old versions to be like UNIX
@@ -284,7 +401,7 @@
         local $@;
         eval {
             local $SIG{__DIE__};
-            copy($from,$to) or die;
+            $fallback->($from,$to) or die;
             my($atime, $mtime) = (stat($from))[8,9];
             utime($atime, $mtime, $to);
             unlink($from)   or die;
@@ -299,15 +416,8 @@
     return 0;
 }
 
-*cp = \&copy;
-*mv = \&move;
-
-
-if ($^O eq 'MacOS') {
-    *_protect = sub { MacPerl::MakeFSSpec($_[0]) };
-} else {
-    *_protect = sub { "./$_[0]" };
-}
+sub move { _move(@_,\&copy); }
+sub mv   { _move(@_,\&cp);   }
 
 # &syscopy is an XSUB under OS/2
 unless (defined &syscopy) {
@@ -389,6 +499,12 @@
 written to (and created if need be).  Trying to copy a file on top
 of itself is a fatal error.
 
+If the destination (second argument) already exists and is a directory,
+and the source (first argument) is not a filehandle, then the source
+file will be copied into the directory specified by the destination,
+using the same base name as the source file.  It's a failure to have a
+filehandle as the source when the destination is a directory.
+
 B<Note that passing in
 files as handles instead of names may lead to loss of information
 on some operating systems; it is recommended that you use file
@@ -403,8 +519,15 @@
 upon the file, but will generally be the whole file (up to 2MB), or
 1k for filehandles that do not reference files (eg. sockets).
 
-You may use the syntax C<use File::Copy "cp"> to get at the
-"cp" alias for this function. The syntax is I<exactly> the same.
+You may use the syntax C<use File::Copy "cp"> to get at the C<cp>
+alias for this function. The syntax is I<exactly> the same.  The
+behavior is nearly the same as well: as of version 2.15, <cp> will
+preserve the source file's permission bits like the shell utility
+C<cp(1)> would do, while C<copy> uses the default permissions for the
+target file (which may depend on the process' C<umask>, file
+ownership, inherited ACLs, etc.).  If an error occurs in setting
+permissions, C<cp> will return 0, regardless of whether the file was
+successfully copied.
 
 =item move
 X<move> X<mv> X<rename>
@@ -420,8 +543,8 @@
 during this copy-and-delete process, you may be left with a (possibly partial)
 copy of the file under the destination name.
 
-You may use the "mv" alias for this function in the same way that
-you may use the "cp" alias for C<copy>.
+You may use the C<mv> alias for this function in the same way that
+you may use the <cp> alias for C<copy>.
 
 =item syscopy
 X<syscopy>
Index: src/gnu/usr.bin/perl/lib/File/Find.pm
diff -u src/gnu/usr.bin/perl/lib/File/Find.pm:1.12 src/gnu/usr.bin/perl/lib/File/Find.pm:1.13
--- lib/File/Find.pm:1.12	Mon Oct 12 18:24:40 2009
+++ lib/File/Find.pm	Fri Sep 24 15:07:01 2010
@@ -3,7 +3,7 @@
 use strict;
 use warnings;
 use warnings::register;
-our $VERSION = '1.14';
+our $VERSION = '1.15';
 require Exporter;
 require Cwd;
 
@@ -217,7 +217,7 @@
 =back
 
 The above variables have all been localized and may be changed without
-effecting data outside of the wanted function.
+affecting data outside of the wanted function.
 
 For example, when examining the file F</some/path/foo.ext> you will have:
 
@@ -448,7 +448,7 @@
     my $abs_name= $cdir . $fn;
 
     if (substr($fn,0,3) eq '../') {
-       1 while $abs_name =~ s!/[^/]*/\.\./!/!;
+       1 while $abs_name =~ s!/[^/]*/\.\./+!/!;
     }
 
     return $abs_name;
Index: src/gnu/usr.bin/perl/lib/File/stat.pm
diff -u src/gnu/usr.bin/perl/lib/File/stat.pm:1.4 src/gnu/usr.bin/perl/lib/File/stat.pm:1.5
--- lib/File/stat.pm:1.4	Mon Oct 12 18:24:40 2009
+++ lib/File/stat.pm	Fri Sep 24 15:07:01 2010
@@ -3,23 +3,170 @@
 
 use strict;
 use warnings;
+use warnings::register;
+use Carp;
+
+BEGIN { *warnif = \&warnings::warnif }
 
 our(@EXPORT, @EXPORT_OK, %EXPORT_TAGS);
 
-our $VERSION = '1.01';
+our $VERSION = '1.02';
 
+my @fields;
 BEGIN { 
     use Exporter   ();
     @EXPORT      = qw(stat lstat);
-    @EXPORT_OK   = qw( $st_dev	   $st_ino    $st_mode 
+    @fields      = qw( $st_dev	   $st_ino    $st_mode 
 		       $st_nlink   $st_uid    $st_gid 
 		       $st_rdev    $st_size 
 		       $st_atime   $st_mtime  $st_ctime 
 		       $st_blksize $st_blocks
 		    );
-    %EXPORT_TAGS = ( FIELDS => [ @EXPORT_OK, @EXPORT ] );
+    @EXPORT_OK   = ( @fields, "stat_cando" );
+    %EXPORT_TAGS = ( FIELDS => [ @fields, @EXPORT ] );
 }
-use vars @EXPORT_OK;
+use vars @fields;
+
+use Fcntl qw(S_IRUSR S_IWUSR S_IXUSR);
+
+BEGIN {
+    # These constants will croak on use if the platform doesn't define
+    # them. It's important to avoid inflicting that on the user.
+    no strict 'refs';
+    for (qw(suid sgid svtx)) {
+        my $val = eval { &{"Fcntl::S_I\U$_"} };
+        *{"_$_"} = defined $val ? sub { $_[0] & $val ? 1 : "" } : sub { "" };
+    }
+    for (qw(SOCK CHR BLK REG DIR FIFO LNK)) {
+        *{"S_IS$_"} = defined eval { &{"Fcntl::S_IF$_"} }
+            ? \&{"Fcntl::S_IS$_"} : sub { "" };
+    }
+}
+
+# from doio.c
+sub _ingroup {
+
+    $^O eq "MacOS"  and return 1;
+    
+    my ($gid, $eff)   = @_;
+
+    # I am assuming that since VMS doesn't have getgroups(2), $) will
+    # always only contain a single entry.
+    $^O eq "VMS"    and return $_[0] == $);
+
+    my ($egid, @supp) = split " ", $);
+    my ($rgid)        = split " ", $(;
+
+    $gid == ($eff ? $egid : $rgid)  and return 1;
+    grep $gid == $_, @supp          and return 1;
+
+    return "";
+}
+
+# VMS uses the Unix version of the routine, even though this is very
+# suboptimal. VMS has a permissions structure that doesn't really fit
+# into struct stat, and unlike on Win32 the normal -X operators respect
+# that, but unfortunately by the time we get here we've already lost the
+# information we need. It looks to me as though if we were to preserve
+# the st_devnam entry of vmsish.h's fake struct stat (which actually
+# holds the filename) it might be possible to do this right, but both
+# getting that value out of the struct (perl's stat doesn't return it)
+# and interpreting it later would require this module to have an XS
+# component (at which point we might as well just call Perl_cando and
+# have done with it).
+    
+if (grep $^O eq $_, qw/os2 MSWin32 dos/) {
+
+    # from doio.c
+    *cando = sub { ($_[0][2] & $_[1]) ? 1 : "" };
+}
+else {
+
+    # from doio.c
+    *cando = sub {
+        my ($s, $mode, $eff) = @_;
+        my $uid = $eff ? $> : $<;
+
+        $^O ne "VMS" and $uid == 0  and return 1;
+
+        my ($stmode, $stuid, $stgid) = @$s[2,4,5];
+
+        # This code basically assumes that the rwx bits of the mode are
+        # the 0777 bits, but so does Perl_cando.
+        if ($stuid == $uid) {
+            $stmode & $mode         and return 1;
+        }
+        elsif (_ingroup($stgid, $eff)) {
+            $stmode & ($mode >> 3)  and return 1;
+        }
+        else {
+            $stmode & ($mode >> 6)  and return 1;
+        }
+        return "";
+    };
+}
+
+# alias for those who don't like objects
+*stat_cando = \&cando;
+
+my %op = (
+    r => sub { cando($_[0], S_IRUSR, 1) },
+    w => sub { cando($_[0], S_IWUSR, 1) },
+    x => sub { cando($_[0], S_IXUSR, 1) },
+    o => sub { $_[0][4] == $>           },
+
+    R => sub { cando($_[0], S_IRUSR, 0) },
+    W => sub { cando($_[0], S_IWUSR, 0) },
+    X => sub { cando($_[0], S_IXUSR, 0) },
+    O => sub { $_[0][4] == $<           },
+
+    e => sub { 1 },
+    z => sub { $_[0][7] == 0    },
+    s => sub { $_[0][7]         },
+
+    f => sub { S_ISREG ($_[0][2]) },
+    d => sub { S_ISDIR ($_[0][2]) },
+    l => sub { S_ISLNK ($_[0][2]) },
+    p => sub { S_ISFIFO($_[0][2]) },
+    S => sub { S_ISSOCK($_[0][2]) },
+    b => sub { S_ISBLK ($_[0][2]) },
+    c => sub { S_ISCHR ($_[0][2]) },
+
+    u => sub { _suid($_[0][2]) },
+    g => sub { _sgid($_[0][2]) },
+    k => sub { _svtx($_[0][2]) },
+
+    M => sub { ($^T - $_[0][9] ) / 86400 },
+    C => sub { ($^T - $_[0][10]) / 86400 },
+    A => sub { ($^T - $_[0][8] ) / 86400 },
+);
+
+use constant HINT_FILETEST_ACCESS => 0x00400000;
+
+# we need fallback=>1 or stringifying breaks
+use overload 
+    fallback => 1,
+    -X => sub {
+        my ($s, $op) = @_;
+
+        if (index "rwxRWX", $op) {
+            (caller 0)[8] & HINT_FILETEST_ACCESS
+                and warnif("File::stat ignores use filetest 'access'");
+
+            $^O eq "VMS" and warnif("File::stat ignores VMS ACLs");
+
+            # It would be nice to have a warning about using -l on a
+            # non-lstat, but that would require an extra member in the
+            # object.
+        }
+
+        if ($op{$op}) {
+            return $op{$op}->($_[0]);
+        }
+        else {
+            croak "-$op is not implemented on a File::stat object";
+        }
+    };
 
 # Class::Struct forbids use of @ISA
 sub import { goto &Exporter::import }
@@ -47,7 +194,7 @@
 sub stat ($) {
     my $arg = shift;
     my $st = populate(CORE::stat $arg);
-    return $st if $st;
+    return $st if defined $st;
 	my $fh;
     {
 		local $!;
@@ -74,6 +221,15 @@
      print "$file is executable with lotsa links\n";
  } 
 
+ if ( -x $st ) {
+     print "$file is executable\n";
+ }
+
+ use Fcntl "S_IRUSR";
+ if ( $st->cando(S_IRUSR, 1) ) {
+     print "My effective uid can read $file\n";
+ }
+
  use File::stat qw(:FIELDS);
  stat($file) or die "No $file: $!";
  if ( ($st_mode & 0111) && ($st_nlink > 1) ) {
@@ -102,6 +258,23 @@
 and
 blocks.  
 
+As of version 1.02 (provided with perl 5.12) the object provides C<"-X">
+overloading, so you can call filetest operators (C<-f>, C<-x>, and so
+on) on it. It also provides a C<< ->cando >> method, called like
+
+ $st->cando( ACCESS, EFFECTIVE )
+
+where I<ACCESS> is one of C<S_IRUSR>, C<S_IWUSR> or C<S_IXUSR> from the
+L<Fcntl|Fcntl> module, and I<EFFECTIVE> indicates whether to use
+effective (true) or real (false) ids. The method interprets the C<mode>,
+C<uid> and C<gid> fields, and returns whether or not the current process
+would be allowed the specified access.
+
+If you don't want to use the objects, you may import the C<< ->cando >>
+method into your namespace as a regular function called C<stat_cando>.
+This takes an arrayref containing the return values of C<stat> or
+C<lstat> as its first argument, and interprets it for you.
+
 You may also import all the structure fields directly into your namespace
 as regular variables using the :FIELDS import tag.  (Note that this still
 overrides your stat() and lstat() functions.)  Access these fields as
@@ -128,6 +301,40 @@
 and undocumented populate() function with CORE::stat():
 
     my $stat_obj = File::stat::populate(CORE::stat(_));
+
+=head1 ERRORS
+
+=over 4
+
+=item -%s is not implemented on a File::stat object
+
+The filetest operators C<-t>, C<-T> and C<-B> are not implemented, as
+they require more information than just a stat buffer.
+
+=back
+
+=head1 WARNINGS
+
+These can all be disabled with
+
+    no warnings "File::stat";
+
+=over 4
+
+=item File::stat ignores use filetest 'access'
+
+You have tried to use one of the C<-rwxRWX> filetests with C<use
+filetest 'access'> in effect. C<File::stat> will ignore the pragma, and
+just use the information in the C<mode> member as usual.
+
+=item File::stat ignores VMS ACLs
+
+VMS systems have a permissions structure that cannot be completely
+represented in a stat buffer, and unlike on other systems the builtin
+filetest operators respect this. The C<File::stat> overloads, however,
+do not, since the information required is not available.
+
+=back
 
 =head1 NOTE
 
Index: src/gnu/usr.bin/perl/lib/Pod/Functions.pm
diff -u src/gnu/usr.bin/perl/lib/Pod/Functions.pm:1.7 src/gnu/usr.bin/perl/lib/Pod/Functions.pm:1.8
--- lib/Pod/Functions.pm:1.7	Tue Mar 28 19:23:07 2006
+++ lib/Pod/Functions.pm	Fri Sep 24 15:07:02 2010
@@ -67,7 +67,7 @@
 
 =cut
 
-our $VERSION = '1.03';
+our $VERSION = '1.04';
 
 require Exporter;
 
@@ -171,7 +171,7 @@
 chmod	File	changes the permissions on a list of files
 chomp	String 	remove a trailing record separator from a string
 chop	String 	remove the last character from a string
-chown	File	change the owership on a list of files
+chown	File	change the ownership on a list of files
 chr	String 	get character this number represents
 chroot	File	make directory new root for path lookups
 close	I/O	close file (or pipe or socket) handle
@@ -248,7 +248,7 @@
 lc	String	return lower-case version of a string
 lcfirst	String	return a string with just the next letter in lower case
 length	String	return the number of bytes in a string
-link	File	create a hard link in the filesytem
+link	File	create a hard link in the filesystem
 listen	Socket	register your socket as a server 
 local	Misc,Namespace	create a temporary value for a global variable (dynamic scoping)
 localtime	Time	convert UNIX time into record or string using local time
@@ -339,7 +339,7 @@
 stat	File	get a file's status information
 study	Regexp	optimize input data for repeated searches
 sub	Flow	declare a subroutine, possibly anonymously
-substr	String	get or alter a portion of a stirng
+substr	String	get or alter a portion of a string
 symlink	File	create a symbolic link to a file
 syscall	I/O,Binary	execute an arbitrary system call
 sysopen	File	open a file, pipe, or descriptor
Index: src/gnu/usr.bin/perl/lib/Pod/Html.pm
diff -u src/gnu/usr.bin/perl/lib/Pod/Html.pm:1.10 src/gnu/usr.bin/perl/lib/Pod/Html.pm:1.11
--- lib/Pod/Html.pm:1.10	Mon Oct 12 18:24:42 2009
+++ lib/Pod/Html.pm	Fri Sep 24 15:07:02 2010
@@ -1575,7 +1575,9 @@
 	# E<x> - convert to character
 	$$rstr =~ s/^([^>]*)>//;
 	my $escape = $1;
-	$escape =~ s/^(\d+|X[\dA-F]+)$/#$1/i;
+	$escape =~ s/^0?x([\dA-F]+)$/#x$1/i
+	or $escape =~ s/^0([0-7]+)$/'#'.oct($1)/ei
+	or $escape =~ s/^(\d+)$/#$1/;
 	$res = "&$escape;";
 
     } elsif( $func eq 'F' ){
Index: src/gnu/usr.bin/perl/lib/Search/Dict.pm
diff -u src/gnu/usr.bin/perl/lib/Search/Dict.pm:1.3 src/gnu/usr.bin/perl/lib/Search/Dict.pm:1.4
--- lib/Search/Dict.pm:1.3	Sun Oct 27 22:25:27 2002
+++ lib/Search/Dict.pm	Fri Sep 24 15:07:02 2010
@@ -35,7 +35,7 @@
 
 If there are only three arguments and the third argument is a hash
 reference, the keys of that hash can have values C<dict>, C<fold>, and
-C<comp> or C<xfrm> (see below), and their correponding values will be
+C<comp> or C<xfrm> (see below), and their corresponding values will be
 used as the parameters.
 
 If a comparison subroutine (comp) is defined, it must return less than zero,
Index: src/gnu/usr.bin/perl/lib/Term/ReadLine.pm
diff -u src/gnu/usr.bin/perl/lib/Term/ReadLine.pm:1.10 src/gnu/usr.bin/perl/lib/Term/ReadLine.pm:1.11
--- lib/Term/ReadLine.pm:1.10	Mon Oct 12 18:24:42 2009
+++ lib/Term/ReadLine.pm	Fri Sep 24 15:07:02 2010
@@ -303,7 +303,7 @@
 
 package Term::ReadLine;		# So late to allow the above code be defined?
 
-our $VERSION = '1.04';
+our $VERSION = '1.05';
 
 my ($which) = exists $ENV{PERL_RL} ? split /\s+/, $ENV{PERL_RL} : undef;
 if ($which) {
@@ -311,6 +311,9 @@
     eval "use Term::ReadLine::Gnu;";
   } elsif ($which =~ /\bperl\b/i) {
     eval "use Term::ReadLine::Perl;";
+  } elsif ($which =~ /^(Stub|TermCap|Tk)$/) {
+    # it is already in memory to avoid false exception as seen in:
+    # PERL_RL=Stub perl -e'$SIG{__DIE__} = sub { print @_ }; require Term::ReadLine'
   } else {
     eval "use Term::ReadLine::$which;";
   }
Index: src/gnu/usr.bin/perl/lib/Tie/Scalar.pm
diff -u src/gnu/usr.bin/perl/lib/Tie/Scalar.pm:1.7 src/gnu/usr.bin/perl/lib/Tie/Scalar.pm:1.8
--- lib/Tie/Scalar.pm:1.7	Mon Oct 12 18:24:46 2009
+++ lib/Tie/Scalar.pm	Fri Sep 24 15:07:02 2010
@@ -1,6 +1,6 @@
 package Tie::Scalar;
 
-our $VERSION = '1.01';
+our $VERSION = '1.02';
 
 =head1 NAME
 
@@ -73,6 +73,18 @@
 
 =back
 
+=head2 Tie::Scalar vs Tie::StdScalar
+
+C<< Tie::Scalar >> provides all the necessary methods, but one should realize
+they do not do anything useful. Calling C<< Tie::Scalar::FETCH >> or 
+C<< Tie::Scalar::STORE >> results in a (trappable) croak. And if you inherit
+from C<< Tie::Scalar >>, you I<must> provide either a C<< new >> or a
+C<< TIESCALAR >> method. 
+
+If you are looking for a class that does everything for you you don't
+define yourself, use the C<< Tie::StdScalar >> class, not the
+C<< Tie::Scalar >> one.
+
 =head1 MORE INFORMATION
 
 The L<perltie> section uses a good example of tying scalars by associating
@@ -92,9 +104,20 @@
 
 sub TIESCALAR {
     my $pkg = shift;
-	if ($pkg->can('new') and $pkg ne __PACKAGE__) {
-	warnings::warnif("WARNING: calling ${pkg}->new since ${pkg}->TIESCALAR is missing");
-	$pkg->new(@_);
+    my $pkg_new = $pkg -> can ('new');
+
+    if ($pkg_new and $pkg ne __PACKAGE__) {
+        my $my_new = __PACKAGE__ -> can ('new');
+        if ($pkg_new == $my_new) {  
+            #
+            # Prevent recursion
+            #
+            croak "$pkg must define either a TIESCALAR() or a new() method";
+        }
+
+	warnings::warnif ("WARNING: calling ${pkg}->new since " .
+                          "${pkg}->TIESCALAR is missing");
+	$pkg -> new (@_);
     }
     else {
 	croak "$pkg doesn't define a TIESCALAR method";
Index: src/gnu/usr.bin/perl/lib/version/Internals.pod
diff -u src/gnu/usr.bin/perl/lib/version/Internals.pod:1.2 src/gnu/usr.bin/perl/lib/version/Internals.pod:1.3
--- lib/version/Internals.pod:1.2	Mon Oct 12 18:24:46 2009
+++ lib/version/Internals.pod	Fri Sep 24 15:07:02 2010
@@ -1,34 +1,34 @@
 =head1 NAME
 
-version::Internal - Perl extension for Version Objects
+version::Internals - Perl extension for Version Objects
 
 =head1 DESCRIPTION
 
 Overloaded version objects for all modern versions of Perl.  This documents
 the internal data representation and underlying code for version.pm.  See
 L<version.pod> for daily usage.  This document is only useful for users
-writing a subclass of version.pm or interested in the gory details.
+interested in the gory details.
 
-=head1 What IS a version
+=head1 WHAT IS A VERSION?
 
 For the purposes of this module, a version "number" is a sequence of
-positive integer values separated by one or more decimal points and 
-optionally a single underscore.  This corresponds to what Perl itself 
-uses for a version, as well as extending the "version as number" that 
+positive integer values separated by one or more decimal points and
+optionally a single underscore.  This corresponds to what Perl itself
+uses for a version, as well as extending the "version as number" that
 is discussed in the various editions of the Camel book.
 
 There are actually two distinct kinds of version objects:
 
 =over 4
 
-=item * Decimal Versions
+=item Decimal Versions
 
 Any version which "looks like a number", see L<Decimal Versions>.  This
 also includes versions with a single decimal point and a single embedded
-underscore, see L<Decimal Alpha Versions>, even though these must be quoted
+underscore, see L<Alpha Versions>, even though these must be quoted
 to preserve the underscore formatting.
 
-=item * Dotted-Decimal Versions
+=item Dotted-Decimal Versions
 
 Also referred to as "Dotted-Integer", these contains more than one decimal
 point and may have an optional embedded underscore, see L<Dotted-Decimal
@@ -39,7 +39,7 @@
 =back
 
 Both of these methods will produce similar version objects, in that
-the default stringification will yield the version L<Normal Form> only 
+the default stringification will yield the version L<Normal Form> only
 if required:
 
   $v  = version->new(1.002);     # 1.002, but compares like 1.2.0
@@ -63,7 +63,7 @@
 will have trailing zeros added to make up the difference, but only for
 purposes of comparison with other version objects.  For example:
 
-                                   # Prints     Equivalent to  
+                                   # Prints     Equivalent to
   $v = version->new(      1.2);    # 1.2        v1.200.0
   $v = version->new(     1.02);    # 1.02       v1.20.0
   $v = version->new(    1.002);    # 1.002      v1.2.0
@@ -71,14 +71,14 @@
   $v = version->new(  1.00203);    # 1.00203    v1.2.30
   $v = version->new( 1.002003);    # 1.002003   v1.2.3
 
-All of the preceding examples are true whether or not the input value is 
-quoted.  The important feature is that the input value contains only a 
-single decimal.  See also L<Alpha Versions> for how to handle 
-
-IMPORTANT NOTE: As shown above, if your Decimal version contains more 
-than 3 significant digits after the decimal place, it will be split on 
-each multiple of 3, so 1.0003 is equivalent to v1.0.300, due to the need 
-to remain compatible with Perl's own 5.005_03 == 5.5.30 interpretation.  
+All of the preceding examples are true whether or not the input value is
+quoted.  The important feature is that the input value contains only a
+single decimal.  See also L<Alpha Versions>.
+
+IMPORTANT NOTE: As shown above, if your Decimal version contains more
+than 3 significant digits after the decimal place, it will be split on
+each multiple of 3, so 1.0003 is equivalent to v1.0.300, due to the need
+to remain compatible with Perl's own 5.005_03 == 5.5.30 interpretation.
 Any trailing zeros are ignored for mathematical comparison purposes.
 
 =head2 Dotted-Decimal Versions
@@ -86,7 +86,7 @@
 These are the newest form of versions, and correspond to Perl's own
 version style beginning with 5.6.0.  Starting with Perl 5.10.0,
 and most likely Perl 6, this is likely to be the preferred form.  This
-method normally requires that the input parameter be quoted, although 
+method normally requires that the input parameter be quoted, although
 Perl's after 5.8.1 can use v-strings as a special form of quoting, but
 this is highly discouraged.
 
@@ -102,42 +102,210 @@
 
 In general, Dotted-Decimal Versions permit the greatest amount of freedom
 to specify a version, whereas Decimal Versions enforce a certain
-uniformity.  See also L<New Operator> for an additional method of
-initializing version objects.
+uniformity.  
 
-Just like L<Decimal Versions>, Dotted-Decimal Versions can be used as 
+Just like L<Decimal Versions>, Dotted-Decimal Versions can be used as
 L<Alpha Versions>.
 
-=head2 Decimal Alpha Versions
+=head2 Alpha Versions
 
-The one time that a Decimal version must be quoted is when a alpha form is
-used with an otherwise Decimal version (i.e. a single decimal point).  This
-is commonly used for CPAN releases, where CPAN or CPANPLUS will ignore alpha
-versions for automatic updating purposes.  Since some developers have used
-only two significant decimal places for their non-alpha releases, the
-version object will automatically take that into account if the initializer
-is quoted.  For example Module::Example was released to CPAN with the
-following sequence of $VERSION's:
-
-  # $VERSION    Stringified
-  0.01          0.01
-  0.02          0.02
-  0.02_01       0.02_01
-  0.02_02       0.02_02
-  0.03          0.03
-  etc.
+For module authors using CPAN, the convention has been to note unstable
+releases with an underscore in the version string. (See L<CPAN>.)  version.pm
+follows this convention and alpha releases will test as being newer than the
+more recent stable release, and less than the next stable release.  Only the
+last element may be separated by an underscore:
+
+  # Declaring
+  use version 0.77; our $VERSION = version->declare("v1.2_3");
+
+  # Parsing
+  $v1 = version->parse("v1.2_3");
+  $v1 = version->parse("1.002_003");
+
+Note that you B<must> quote the version when writing an alpha Decimal version.
+The stringified form of Decimal versions will always be the same string that
+was used to initialize the version object.
+
+=head2 Regular Expressions for Version Parsing
+
+A formalized definition of the legal forms for version strings is
+included in the main F<version.pm> file.  Primitives are included for
+common elements, although they are scoped to the file so they are useful
+for reference purposes only.  There are two publicly accessible scalars
+that can be used in other code (not exported):
 
-The stringified form of Decimal versions will always be the same string
-that was used to initialize the version object.
+=over 4
+
+=item C<$version::LAX>
+
+This regexp covers all of the legal forms allowed under the current
+version string parser.  This is not to say that all of these forms
+are recommended, and some of them can only be used when quoted.
+
+For dotted decimals:
+
+    v1.2
+    1.2345.6
+    v1.23_4
+
+The leading 'v' is optional if two or more decimals appear.  If only
+a single decimal is included, then the leading 'v' is required to
+trigger the dotted-decimal parsing.  A leading zero is permitted,
+though not recommended except when quoted, because of the risk that
+Perl will treat the number as octal.  A trailing underscore plus one
+or more digits denotes an alpha or development release (and must be
+quoted to be parsed properly).
+
+For decimal versions:
+
+    1
+    1.2345
+    1.2345_01
+
+an integer portion, an optional decimal point, and optionally one or
+more digits to the right of the decimal are all required.  A trailing
+underscore is permitted and a leading zero is permitted.  Just like
+the lax dotted-decimal version, quoting the values is required for
+alpha/development forms to be parsed correctly.
+
+=item C<$version::STRICT>
+
+This regexp covers a much more limited set of formats and constitutes
+the best practices for initializing version objects.  Whether you choose
+to employ decimal or dotted-decimal for is a personal preference however.
+
+=over 4
+
+=item v1.234.5
+
+For dotted-decimal versions, a leading 'v' is required, with three or
+more sub-versions of no more than three digits.  A leading 0 (zero)
+before the first sub-version (in the above example, '1') is also
+prohibited.
+
+=item 2.3456
+
+For decimal versions, an integer portion (no leading 0), a decimal point,
+and one or more digits to the right of the decimal are all required.
+
+=back
+
+=back
+
+Both of the provided scalars are already compiled as regular expressions
+and do not contain either anchors or implicit groupings, so they can be
+included in your own regular expressions freely.  For example, consider
+the following code:
+
+	($pkg, $ver) =~ /
+		^[ \t]*
+		use [ \t]+($PKGNAME)
+		(?:[ \t]+($version::STRICT))?
+		[ \t]*;
+	/x;
+
+This would match a line of the form:
+
+	use Foo::Bar::Baz v1.2.3;	# legal only in Perl 5.8.1+
+
+where C<$PKGNAME> is another regular expression that defines the legal
+forms for package names.
+
+=head1 IMPLEMENTATION DETAILS
+
+=head2 Equivalence between Decimal and Dotted-Decimal Versions
+
+When Perl 5.6.0 was released, the decision was made to provide a
+transformation between the old-style decimal versions and new-style
+dotted-decimal versions:
+
+  5.6.0    == 5.006000
+  5.005_04 == 5.5.40
+
+The floating point number is taken and split first on the single decimal
+place, then each group of three digits to the right of the decimal makes up
+the next digit, and so on until the number of significant digits is exhausted,
+B<plus> enough trailing zeros to reach the next multiple of three.
+
+This was the method that version.pm adopted as well.  Some examples may be
+helpful:
+
+                            equivalent
+  decimal    zero-padded    dotted-decimal
+  -------    -----------    --------------
+  1.2        1.200          v1.200.0
+  1.02       1.020          v1.20.0
+  1.002      1.002          v1.2.0
+  1.0023     1.002300       v1.2.300
+  1.00203    1.002030       v1.2.30
+  1.002003   1.002003       v1.2.3
+
+=head2 Quoting Rules
+
+Because of the nature of the Perl parsing and tokenizing routines,
+certain initialization values B<must> be quoted in order to correctly
+parse as the intended version, especially when using the L<declare> or
+L<qv> methods.  While you do not have to quote decimal numbers when
+creating version objects, it is always safe to quote B<all> initial values
+when using version.pm methods, as this will ensure that what you type is
+what is used.
+
+Additionally, if you quote your initializer, then the quoted value that goes
+B<in> will be be exactly what comes B<out> when your $VERSION is printed
+(stringified).  If you do not quote your value, Perl's normal numeric handling
+comes into play and you may not get back what you were expecting.
+
+If you use a mathematic formula that resolves to a floating point number,
+you are dependent on Perl's conversion routines to yield the version you
+expect.  You are pretty safe by dividing by a power of 10, for example,
+but other operations are not likely to be what you intend.  For example:
+
+  $VERSION = version->new((qw$Revision: 1.4)[1]/10);
+  print $VERSION;          # yields 0.14
+  $V2 = version->new(100/9); # Integer overflow in decimal number
+  print $V2;               # yields something like 11.111.111.100
+
+Perl 5.8.1 and beyond are able to automatically quote v-strings but
+that is not possible in earlier versions of Perl.  In other words:
+
+  $version = version->new("v2.5.4");  # legal in all versions of Perl
+  $newvers = version->new(v2.5.4);    # legal only in Perl >= 5.8.1
+
+=head2 What about v-strings?
+
+There are two ways to enter v-strings: a bare number with two or more
+decimal points, or a bare number with one or more decimal points and a
+leading 'v' character (also bare).  For example:
+
+  $vs1 = 1.2.3; # encoded as \1\2\3
+  $vs2 = v1.2;  # encoded as \1\2
+
+However, the use of bare v-strings to initialize version objects is
+B<strongly> discouraged in all circumstances.  Also, bare
+v-strings are not completely supported in any version of Perl prior to
+5.8.1.
+
+If you insist on using bare v-strings with Perl > 5.6.0, be aware of the
+following limitations:
+
+1) For Perl releases 5.6.0 through 5.8.0, the v-string code merely guesses,
+based on some characteristics of v-strings.  You B<must> use a three part
+version, e.g. 1.2.3 or v1.2.3 in order for this heuristic to be successful.
+
+2) For Perl releases 5.8.1 and later, v-strings have changed in the Perl
+core to be magical, which means that the version.pm code can automatically
+determine whether the v-string encoding was used.
 
-=head1 High level design
+3) In all cases, a version created using v-strings will have a stringified
+form that has a leading 'v' character, for the simple reason that sometimes
+it is impossible to tell whether one was present initially.
 
-=head2 version objects
+=head2 Version Object Internals
 
-version.pm provides an overloaded version object that is designed to both 
+version.pm provides an overloaded version object that is designed to both
 encapsulate the author's intended $VERSION assignment as well as make it
 completely natural to use those objects as if they were numbers (e.g. for
-comparisons).  To do this, a version object contains both the original 
+comparisons).  To do this, a version object contains both the original
 representation as typed by the author, as well as a parsed representation
 to ease comparisons.  Version objects employ L<overload> methods to
 simplify code that needs to compare, print, etc the objects.
@@ -222,7 +390,7 @@
 IMPORTANT NOTE: This may mean that code which searches for a specific
 string (to determine whether a given module is available) may need to be
 changed.  It is always better to use the built-in comparison implicit in
-C<use> or C<require>, rather than manually poking at C<class->VERSION>
+C<use> or C<require>, rather than manually poking at C<< class->VERSION >>
 and then doing a comparison yourself.
 
 The replacement UNIVERSAL::VERSION, when used as a function, like this:
@@ -232,7 +400,7 @@
 will also exclusively return the stringified form.  See L<Stringification>
 for more details.
 
-=head1 Usage question
+=head1 USAGE DETAILS
 
 =head2 Using modules that use version.pm
 
@@ -270,8 +438,7 @@
   use Example 1.2.3;
 
 and it will again work (i.e. give the error message as above), even with
-releases of Perl which do not normally support v-strings (see L<What about
-v-strings> below).  This has to do with that fact that C<use> only checks
+releases of Perl which do not normally support v-strings (see L<version/What about v-strings> below).  This has to do with that fact that C<use> only checks
 to see if the second term I<looks like a number> and passes that to the
 replacement L<UNIVERSAL::VERSION>.  This is not true in Perl 5.005_04,
 however, so you are B<strongly encouraged> to always use a Decimal version
@@ -282,21 +449,15 @@
 
 =head2 Object Methods
 
-Overloading has been used with version objects to provide a natural
-interface for their use.  All mathematical operations are forbidden,
-since they don't make any sense for base version objects.  Consequently,
-there is no overloaded numification available.  If you want to use a
-version object in a Decimal context for some reason, see the L<numify>
-object method.
-
 =over 4
 
-=item * New Operator
+=item new()
 
-Like all OO interfaces, the new() operator is used to initialize
-version objects.  One way to increment versions when programming is to
-use the CVS variable $Revision, which is automatically incremented by
-CVS every time the file is committed to the repository.
+Like many OO interfaces, the new() method is used to initialize version
+objects.  If two arguments are passed to C<new()>, the B<second> one will be
+used as if it were prefixed with "v".  This is to support historical use of the
+C<qw> operator with the CVS variable $Revision, which is automatically
+incremented by CVS every time the file is committed to the repository.
 
 In order to facilitate this feature, the following
 code can be employed:
@@ -312,7 +473,7 @@
 string, and it will be quoted to preserve the meaning CVS normally
 carries for versions.  The CVS $Revision$ increments differently from
 Decimal versions (i.e. 1.10 follows 1.9), so it must be handled as if
-it were a L<Dotted-Decimal Version>.
+it were a Dotted-Decimal Version.
 
 A new version object can be created as a copy of an existing version
 object, either as a class method:
@@ -337,7 +498,7 @@
 
 =over 4
 
-=item * qv()
+=item qv()
 
 An alternate way to create a new version object is through the exported
 qv() sub.  This is not strictly like other q? operators (like qq, qw),
@@ -348,7 +509,7 @@
   $v1 = qv(1.2);         # v1.2.0
   $v2 = qv("1.2");       # also v1.2.0
 
-As you can see, either a bare number or a quoted string can usually 
+As you can see, either a bare number or a quoted string can usually
 be used interchangably, except in the case of a trailing zero, which
 must be quoted to be converted properly.  For this reason, it is strongly
 recommended that all initializers to qv() be quoted strings instead of
@@ -364,33 +525,32 @@
   require version;
 
 Both methods will prevent the import() method from firing and exporting the
-C<qv()> sub.  This is true of subclasses of version as well, see
-L<SUBCLASSING> for details.
+C<qv()> sub.
 
 =back
 
 For the subsequent examples, the following three objects will be used:
 
-  $ver   = version->new("1.2.3.4"); # see "Quoting" below
-  $alpha = version->new("1.2.3_4"); # see "Alpha versions" below
-  $nver  = version->new(1.002);     # see "Decimal Versions" above
+  $ver   = version->new("1.2.3.4"); # see "Quoting Rules"
+  $alpha = version->new("1.2.3_4"); # see "Alpha Versions"
+  $nver  = version->new(1.002);     # see "Decimal Versions"
 
 =over 4
 
-=item * Normal Form
+=item Normal Form
 
 For any version object which is initialized with multiple decimal
 places (either quoted or if possible v-string), or initialized using
-the L<qv()> operator, the stringified representation is returned in
+the L<qv>() operator, the stringified representation is returned in
 a normalized or reduced form (no extraneous zeros), and with a leading 'v':
 
   print $ver->normal;         # prints as v1.2.3.4
   print $ver->stringify;      # ditto
   print $ver;                 # ditto
   print $nver->normal;        # prints as v1.2.0
-  print $nver->stringify;     # prints as 1.002, see "Stringification" 
+  print $nver->stringify;     # prints as 1.002, see "Stringification"
 
-In order to preserve the meaning of the processed version, the 
+In order to preserve the meaning of the processed version, the
 normalized representation will always contain at least three sub terms.
 In other words, the following is guaranteed to always be true:
 
@@ -402,10 +562,10 @@
 
 =over 4
 
-=item * Numification
+=item Numification
 
 Although all mathematical operations on version objects are forbidden
-by default, it is possible to retrieve a number which corresponds 
+by default, it is possible to retrieve a number which corresponds
 to the version object through the use of the $obj->numify
 method.  For formatting purposes, when displaying a number which
 corresponds a version object, all sub versions are assumed to have
@@ -421,7 +581,7 @@
 
 =over 4
 
-=item * Stringification
+=item Stringification
 
 The default stringification for version objects returns exactly the same
 string as was used to create it, whether you used C<new()> or C<qv()>,
@@ -438,29 +598,29 @@
   version->new("v1.2")     v1.2
   qv("1.2.3")               1.2.3
   qv("v1.3.5")             v1.3.5
-  qv("1.2")                v1.2   ### exceptional case 
+  qv("1.2")                v1.2   ### exceptional case
 
 See also L<UNIVERSAL::VERSION>, as this also returns the stringified form
 when used as a class method.
 
 IMPORTANT NOTE: There is one exceptional cases shown in the above table
 where the "initializer" is not stringwise equivalent to the stringified
-representation.  If you use the C<qv()> operator on a version without a
+representation.  If you use the C<qv>() operator on a version without a
 leading 'v' B<and> with only a single decimal place, the stringified output
-will have a leading 'v', to preserve the sense.  See the L<qv()> operator
+will have a leading 'v', to preserve the sense.  See the L<qv>() operator
 for more details.
 
 IMPORTANT NOTE 2: Attempting to bypass the normal stringification rules by
-manually applying L<numify()> and L<normal()> will sometimes yield
+manually applying L<numify>() and L<normal>() will sometimes yield
 surprising results:
 
   print version->new(version->new("v1.0")->numify)->normal; # v1.0.0
 
-The reason for this is that the L<numify()> operator will turn "v1.0"
+The reason for this is that the L<numify>() operator will turn "v1.0"
 into the equivalent string "1.000000".  Forcing the outer version object
-to L<normal()> form will display the mathematically equivalent "v1.0.0".
+to L<normal>() form will display the mathematically equivalent "v1.0.0".
 
-As the example in L<new()> shows, you can always create a copy of an
+As the example in L<new>() shows, you can always create a copy of an
 existing version object with the same value by the very compact:
 
   $v2 = $v1->new($v1);
@@ -472,7 +632,7 @@
 
 =over 4
 
-=item * Comparison operators
+=item Comparison operators
 
 Both C<cmp> and C<E<lt>=E<gt>> operators perform the same comparison between
 terms (upgrading to a version object automatically).  Perl automatically
@@ -493,7 +653,7 @@
 
 It is probably best to chose either the Decimal notation or the string
 notation and stick with it, to reduce confusion.  Perl6 version objects
-B<may> only support Decimal comparisons.  See also L<Quoting>.
+B<may> only support Decimal comparisons.  See also L<Quoting Rules>.
 
 WARNING: Comparing version with unequal numbers of decimal points (whether
 explicitly or implicitly initialized), may yield unexpected results at
@@ -509,7 +669,7 @@
 
 =over 4
 
-=item * Logical Operators 
+=item Logical Operators
 
 If you need to test whether a version object
 has been initialized, you can simply test it directly:
@@ -517,7 +677,7 @@
   $vobj = version->new($something);
   if ( $vobj )   # true only if $something was non-blank
 
-You can also test whether a version object is an L<Alpha version>, for
+You can also test whether a version object is an alpha version, for
 example to prevent the use of some feature not present in the main
 release:
 
@@ -526,76 +686,6 @@
   if ( $vobj->is_alpha )       # True
 
 =back
-
-=head2 Quoting
-
-Because of the nature of the Perl parsing and tokenizing routines,
-certain initialization values B<must> be quoted in order to correctly
-parse as the intended version, especially when using the L<qv()> operator.
-In all cases, a floating point number passed to version->new() will be
-identically converted whether or not the value itself is quoted.  This is
-not true for L<qv()>, however, when trailing zeros would be stripped on
-an unquoted input, which would result in a very different version object.
-
-In addition, in order to be compatible with earlier Perl version styles,
-any use of versions of the form 5.006001 will be translated as v5.6.1.  
-In other words, a version with a single decimal point will be parsed as
-implicitly having three digits between subversions, but only for internal
-comparison purposes.
-
-The complicating factor is that in bare numbers (i.e. unquoted), the
-underscore is a legal Decimal character and is automatically stripped
-by the Perl tokenizer before the version code is called.  However, if
-a number containing one or more decimals and an underscore is quoted, i.e.
-not bare, that is considered a L<Alpha Version> and the underscore is
-significant.
-
-If you use a mathematic formula that resolves to a floating point number,
-you are dependent on Perl's conversion routines to yield the version you
-expect.  You are pretty safe by dividing by a power of 10, for example,
-but other operations are not likely to be what you intend.  For example:
-
-  $VERSION = version->new((qw$Revision: 1.4)[1]/10);
-  print $VERSION;          # yields 0.14
-  $V2 = version->new(100/9); # Integer overflow in decimal number
-  print $V2;               # yields something like 11.111.111.100
-
-Perl 5.8.1 and beyond will be able to automatically quote v-strings but
-that is not possible in earlier versions of Perl.  In other words:
-
-  $version = version->new("v2.5.4");  # legal in all versions of Perl
-  $newvers = version->new(v2.5.4);    # legal only in Perl >= 5.8.1
-
-=head1 SUBCLASSING
-
-This module is specifically designed and tested to be easily subclassed.
-In practice, you only need to override the methods you want to change, but
-you have to take some care when overriding new() (since that is where all
-of the parsing takes place).  For example, this is a perfect acceptable
-derived class:
-
-  package myversion;
-  use base version;
-  sub new { 
-      my($self,$n)=@_;
-      my $obj;
-      # perform any special input handling here
-      $obj = $self->SUPER::new($n);
-      # and/or add additional hash elements here
-      return $obj;
-  }
-
-See also L<version::AlphaBeta> on CPAN for an alternate representation of
-version strings.
-
-B<NOTE:> Although the L<qv> operator is not a true class method, but rather a
-function exported into the caller's namespace, a subclass of version will 
-inherit an import() function which will perform the correct magic on behalf
-of the subclass.
-
-=head1 EXPORT
-
-qv - Dotted-Decimal Version initialization operator
 
 =head1 AUTHOR
 
Index: src/gnu/usr.bin/perl/os2/Makefile.SHs
diff -u src/gnu/usr.bin/perl/os2/Makefile.SHs:1.10 src/gnu/usr.bin/perl/os2/Makefile.SHs:1.11
--- os2/Makefile.SHs:1.10	Mon Sep 29 17:36:15 2008
+++ os2/Makefile.SHs	Fri Sep 24 15:07:02 2010
@@ -481,7 +481,7 @@
 done
 
 # We need to special-case OS2/DLL/DLL.a, since the recipe above will
-# try to find it in ext/OS2/DLL
+# try to find it in ext/OS2-DLL
 
 $spitshell >>Makefile <<'!NO!SUBS!'
 lib/auto/OS2/DLL/DLL.a : lib/auto/OS2/REXX/REXX.a
Index: src/gnu/usr.bin/perl/plan9/config.plan9
diff -u src/gnu/usr.bin/perl/plan9/config.plan9:1.11 src/gnu/usr.bin/perl/plan9/config.plan9:1.12
--- plan9/config.plan9:1.11	Mon Oct 12 18:24:46 2009
+++ plan9/config.plan9	Fri Sep 24 15:07:02 2010
@@ -3364,8 +3364,8 @@
  *	This symbol contains the ~name expanded version of PRIVLIB, to be used
  *	in programs that are not prepared to deal with ~ expansion at run-time.
  */
-#define PRIVLIB "/sys/lib/perl/5.10.1"		/**/
-#define PRIVLIB_EXP "/sys/lib/perl/5.10.1"		/**/
+#define PRIVLIB "/sys/lib/perl/5.12.2"		/**/
+#define PRIVLIB_EXP "/sys/lib/perl/5.12.2"		/**/
 
 /* PTRSIZE:
  *	This symbol contains the size of a pointer, so that the C preprocessor
@@ -3492,9 +3492,9 @@
  *	removed.  The elements in inc_version_list (inc_version_list.U) can
  *	be tacked onto this variable to generate a list of directories to search.
  */
-#define SITELIB "/sys/lib/perl/5.10.1/site_perl"		/**/
-#define SITELIB_EXP "/sys/lib/perl/5.10.1/site_perl"		/**/
-#define SITELIB_STEM "/sys/lib/perl/5.10.1/site_perl"		/**/
+#define SITELIB "/sys/lib/perl/5.12.2/site_perl"		/**/
+#define SITELIB_EXP "/sys/lib/perl/5.12.2/site_perl"		/**/
+#define SITELIB_STEM "/sys/lib/perl/5.12.2/site_perl"		/**/
 
 /* Size_t_size:
  *	This symbol holds the size of a Size_t in bytes.
Index: src/gnu/usr.bin/perl/plan9/mkfile
diff -u src/gnu/usr.bin/perl/plan9/mkfile:1.4 src/gnu/usr.bin/perl/plan9/mkfile:1.5
--- plan9/mkfile:1.4	Mon Sep 29 17:36:15 2008
+++ plan9/mkfile	Fri Sep 24 15:07:03 2010
@@ -22,8 +22,8 @@
 
 podnames = perl perlbook perlboot perlbot perldata perldebtut perldiag perldsc perlform perlfunc perlipc perllexwarn perllol perlmod perlmodlib perlmodinstall perlnewmod perlop perlopentut perlpacktut perlpod perlport perlrequick perlretut perlref perlreftut perlrequick perlrun perlsec perlstyle perlsub perlsyn perltie perltoc perltooc perltoot perltrap perlutil perlunifaq perluniintro perlvar
 faqpodnames = perlfaq perlfaq1 perlfaq2 perlfaq3 perlfaq4 perlfaq5 perlfaq6 perlfaq7 perlfaq8 perlfaq9
-advpodnames = perlapi perlapio perlcall perlclib perlcompile perldebguts perldbmfilter perldebug perldelta perldiag perlebcdic perlembed perlfilter perlfork perlguts perlhack perlintern perliol perllocale perlnumber perlobj perlothrtut perlpodspec perlre perlthrtut perltodo perlunicode perlxs perlxs perlxstut
-archpodnames = perlaix perlamiga perlapollo perlbeos perlbs2000 perlce perlcygwin perldgux perldos perlepoc perlfreebsd perlhpux perlhurd perlirix perlmachten perlmacos perlmint perlmpeix perlnetware perlos2 perlos390 perlos400 perlplan9 perlqnx perlsolaris perltru64 perluts perlvmesa perlvms perlvos perlwin32
+advpodnames = perlapi perlapio perlcall perlclib perlcompile perldebguts perldbmfilter perldebug perldelta perldiag perlebcdic perlembed perlfilter perlfork perlguts perlhack perlintern perliol perllocale perlnumber perlobj perlpodspec perlre perlthrtut perltodo perlunicode perlxs perlxs perlxstut
+archpodnames = perlaix perlamiga perlapollo perlbeos perlbs2000 perlce perlcygwin perldgux perldos perlepoc perlfreebsd perlhpux perlhurd perlirix perlmacos perlmpeix perlnetware perlos2 perlos390 perlos400 perlplan9 perlqnx perlsolaris perltru64 perluts perlvmesa perlvms perlvos perlwin32
 histpods = perl5004delta perl5005delta perl561delta perl56delta perl570delta perl571delta perl572delta perl573delta perl58delta perlhist
 
 libpods = ${podnames:%=pod/%.pod}
@@ -35,7 +35,7 @@
 ext_c = ${ext_xs:%.xs=%.c}
 ext_obj = ${ext_xs:%.xs=%.$O}
 
-obj = av.$O deb.$O doio.$O doop.$O dump.$O globals.$O gv.$O hv.$O locale.$O malloc.$O mathoms.$O mg.$O numeric.$O op.$O pad.$O perlapi.$O perlio.$O perly.$O pp.$O pp_ctl.$O pp_hot.$O pp_pack.$O pp_sort.$O pp_sys.$O reentr.$O regcomp.$O regexec.$O run.$O scope.$O sv.$O taint.$O toke.$O universal.$O utf8.$O util.$O xsutils.$O
+obj = av.$O deb.$O doio.$O doop.$O dump.$O globals.$O gv.$O hv.$O locale.$O malloc.$O mathoms.$O mg.$O numeric.$O op.$O pad.$O perlapi.$O perlio.$O perly.$O pp.$O pp_ctl.$O pp_hot.$O pp_pack.$O pp_sort.$O pp_sys.$O reentr.$O regcomp.$O regexec.$O run.$O scope.$O sv.$O taint.$O toke.$O universal.$O utf8.$O util.$O
 
 OBJS = perl.$O plan9.$O $obj
 
Index: src/gnu/usr.bin/perl/pod/buildtoc
diff -u src/gnu/usr.bin/perl/pod/buildtoc:1.12 src/gnu/usr.bin/perl/pod/buildtoc:1.13
--- pod/buildtoc:1.12	Mon Oct 12 18:55:12 2009
+++ pod/buildtoc	Fri Sep 24 15:07:03 2010
@@ -209,7 +209,7 @@
     warn "$0: $i exists but is unknown by perl.pod\n"
 	if !$perlpods{$i} && !exists $sources{$i};
   }
-  my @BuildTargets = grep {defined} @Targets{keys %Build};
+  my @BuildTargets = grep {defined} @Targets{grep $_ ne 'all', keys %Build};
   my %BuildFiles;
   @BuildFiles{@BuildTargets} = @BuildTargets;
   
@@ -737,6 +737,7 @@
 
 my $built;
 while (my ($target, $name) = each %Targets) {
+  print "Working on target $target\n" if $Verbose;
   next unless $Build{$target};
   $built++;
   if ($target eq "toc") {
@@ -747,6 +748,7 @@
   }
   print "Now processing $name\n" if $Verbose;
   open THING, $name or die "Can't open $name: $!";
+  binmode THING;
   my @orig = <THING>;
   my $orig = join '', @orig;
   close THING;
@@ -761,8 +763,9 @@
   }
   rename $name, "$name.old" or die "$0: Can't rename $name to $name.old: $!";
   open THING, ">$name" or die "$0: Can't open $name for writing: $!";
+  binmode THING;
   print THING $new or die "$0: print to $name failed: $!";
-  close THING or die die "$0: close $name failed: $!";
+  close THING or die "$0: close $name failed: $!";
 }
 
 warn "$0: was not instructed to build anything\n" unless $built;
Index: src/gnu/usr.bin/perl/pod/perl.pod
diff -u src/gnu/usr.bin/perl/pod/perl.pod:1.13 src/gnu/usr.bin/perl/pod/perl.pod:1.14
--- pod/perl.pod:1.13	Mon Oct 12 18:24:47 2009
+++ pod/perl.pod	Fri Sep 24 15:07:03 2010
@@ -1,6 +1,6 @@
 =head1 NAME
 
-perl - Practical Extraction and Report Language
+perl - The Perl language interpreter
 
 =head1 SYNOPSIS
 
@@ -10,15 +10,21 @@
 	S<[ B<-pna> ] [ B<-F>I<pattern> ] [ B<-l>[I<octal>] ] [ B<-0>[I<octal/hexadecimal>] ]>
 	S<[ B<-I>I<dir> ] [ B<-m>[B<->]I<module> ] [ B<-M>[B<->]I<'module...'> ] [ B<-f> ]>
 	S<[ B<-C [I<number/list>] >]>
-	S<[ B<-P> ]>
 	S<[ B<-S> ]>
 	S<[ B<-x>[I<dir>] ]>
 	S<[ B<-i>[I<extension>] ]>
 	S<[ [B<-e>|B<-E>] I<'command'> ] [ B<--> ] [ I<programfile> ] [ I<argument> ]...>
 
-If you're new to Perl, you should start with L<perlintro>, which is a 
-general intro for beginners and provides some background to help you
-navigate the rest of Perl's extensive documentation.
+=head1 GETTING HELP
+
+The F<perldoc> program gives you access to all the documentation that comes
+with Perl.  You can get more documentation, tutorials and community support
+online at L<http://www.perl.org/>.
+
+If you're new to Perl, you should start by running C<perldoc perlintro>,
+which is a general intro for beginners and provides some background to help
+you navigate the rest of Perl's extensive documentation.  Run C<perldoc
+perldoc> to learn more things you can do with F<perldoc>.
 
 For ease of access, the Perl manual has been split up into several sections.
 
@@ -92,13 +98,13 @@
     perlnumber		Perl number semantics
 
     perlthrtut		Perl threads tutorial
-      perlothrtut	Old Perl threads tutorial
 
     perlport		Perl portability guide
     perllocale		Perl locale support
     perluniintro	Perl Unicode introduction
     perlunicode 	Perl Unicode support
     perlunifaq		Perl Unicode FAQ
+    perluniprops	Index of Unicode Version 5.2.0 properties in Perl
     perlunitut		Perl Unicode tutorial
     perlebcdic		Considerations for running Perl on EBCDIC platforms
 
@@ -138,6 +144,7 @@
     perlapio		Perl internal IO abstraction interface
 
     perlhack		Perl hackers guide
+    perlpolicy		Perl development policies
     perlrepository	Perl source repository
 
 =head2 Miscellaneous
@@ -150,6 +157,15 @@
 
     perlhist		Perl history records
     perldelta		Perl changes since previous version
+    perl5121delta	Perl changes in version 5.12.1
+    perl5120delta	Perl changes in version 5.12.0
+    perl5115delta	Perl changes in version 5.11.5
+    perl5114delta	Perl changes in version 5.11.4
+    perl5113delta	Perl changes in version 5.11.3
+    perl5112delta	Perl changes in version 5.11.2
+    perl5111delta	Perl changes in version 5.11.1
+    perl5110delta	Perl changes in version 5.11.0
+    perl5101delta	Perl changes in version 5.10.1
     perl5100delta	Perl changes in version 5.10.0
     perl595delta	Perl changes in version 5.9.5
     perl594delta	Perl changes in version 5.9.4
@@ -157,8 +173,8 @@
     perl592delta	Perl changes in version 5.9.2
     perl591delta	Perl changes in version 5.9.1
     perl590delta	Perl changes in version 5.9.0
-    perl588delta	Perl changes in version 5.8.8
     perl589delta	Perl changes in version 5.8.9
+    perl588delta	Perl changes in version 5.8.8
     perl587delta	Perl changes in version 5.8.7
     perl586delta	Perl changes in version 5.8.6
     perl585delta	Perl changes in version 5.8.5
@@ -204,10 +220,8 @@
     perlhurd		Perl notes for Hurd
     perlirix		Perl notes for Irix
     perllinux		Perl notes for Linux
-    perlmachten 	Perl notes for Power MachTen
     perlmacos		Perl notes for Mac OS (Classic)
     perlmacosx		Perl notes for Mac OS X
-    perlmint		Perl notes for MiNT
     perlmpeix		Perl notes for MPE/iX
     perlnetware 	Perl notes for NetWare
     perlopenbsd 	Perl notes for OpenBSD
@@ -227,38 +241,17 @@
     perlwin32		Perl notes for Windows
 
 
-By default, the manpages listed above are installed in the 
-F</usr/local/man/> directory.  
+On a Unix-like system, these documentation files will usually also be
+available as manpages for use with the F<man> program.
 
-Extensive additional documentation for Perl modules is available.  The
-default configuration for perl will place this additional documentation
-in the F</usr/local/lib/perl5/man> directory (or else in the F<man>
-subdirectory of the Perl library directory).  Some of this additional
-documentation is distributed standard with Perl, but you'll also find
-documentation for third-party modules there.
-
-You should be able to view Perl's documentation with your man(1)
-program by including the proper directories in the appropriate start-up
-files, or in the MANPATH environment variable.  To find out where the
-configuration has installed the manpages, type:
-
-    perl -V:man.dir
-
-If the directories have a common stem, such as F</usr/local/man/man1>
-and F</usr/local/man/man3>, you need only to add that stem
-(F</usr/local/man>) to your man(1) configuration files or your MANPATH
-environment variable.  If they do not share a stem, you'll have to add
-both stems.
-
-If that doesn't work for some reason, you can still use the
-supplied F<perldoc> script to view module information.  You might
-also look into getting a replacement man program.
-
-If something strange has gone wrong with your program and you're not
-sure where you should look for help, try the B<-w> switch first.  It
-will often point out exactly where the trouble is.
+In general, if something strange has gone wrong with your program and you're
+not sure where you should look for help, try the B<-w> switch first.  It will
+often point out exactly where the trouble is.
 
 =head1 DESCRIPTION
+
+Perl officially stands for Practical Extraction and Report Language,
+except when it doesn't.
 
 Perl is a language optimized for scanning arbitrary
 text files, extracting information from those text files, and printing
Index: src/gnu/usr.bin/perl/pod/perl58delta.pod
diff -u src/gnu/usr.bin/perl/pod/perl58delta.pod:1.6 src/gnu/usr.bin/perl/pod/perl58delta.pod:1.7
--- pod/perl58delta.pod:1.6	Mon Sep 29 17:36:16 2008
+++ pod/perl58delta.pod	Fri Sep 24 15:07:03 2010
@@ -179,7 +179,7 @@
 
 The list of filenames from glob() (or <...>) is now by default sorted
 alphabetically to be csh-compliant (which is what happened before
-in most UNIX platforms).  (bsd_glob() does still sort platform
+in most Unix platforms).  (bsd_glob() does still sort platform
 natively, ASCII or EBCDIC, unless GLOB_ALPHASORT is specified.) [561]
 
 =head2 Deprecations
@@ -381,7 +381,7 @@
 previous Perls), perlio (re-implementation of stdio buffering in a
 portable manner), crlf (does CRLF <=> "\n" translation as on Win32,
 but available on any platform).  A mmap layer may be available if
-platform supports it (mostly UNIXes).
+platform supports it (mostly Unixes).
 
 Layers to be applied by default may be specified via the 'open' pragma.
 
@@ -532,7 +532,7 @@
 
 This warns you that C<"fred@example.com"> is going to turn into
 C<fred.com> if you don't backslash the C<@>.
-See http://www.plover.com/~mjd/perl/at-error.html for more details
+See http://perl.plover.com/at-error.html for more details
 about the history here.
 
 =head2 Miscellaneous Changes
@@ -1505,7 +1505,7 @@
 =item *
 
 C<perlcc> has been rewritten and its user interface (that is,
-command line) is much more like that of the UNIX C compiler, cc.
+command line) is much more like that of the Unix C compiler, cc.
 (The perlbc tools has been removed.  Use C<perlcc -B> instead.)
 B<Note that perlcc is still considered very experimental and
 unsupported.> [561]
@@ -1531,7 +1531,7 @@
 =item *
 
 C<pod2html> now understands POD written using different line endings
-(PC-like CRLF versus UNIX-like LF versus MacClassic-like CR).
+(PC-like CRLF versus Unix-like LF versus MacClassic-like CR).
 
 =item *
 
@@ -2083,7 +2083,7 @@
 
 =item *
 
-The Amdahl UTS UNIX mainframe platform is now supported. [561]
+The Amdahl UTS Unix mainframe platform is now supported. [561]
 
 =item *
 
Index: src/gnu/usr.bin/perl/pod/perlcall.pod
diff -u src/gnu/usr.bin/perl/pod/perlcall.pod:1.9 src/gnu/usr.bin/perl/pod/perlcall.pod:1.10
--- pod/perlcall.pod:1.9	Mon Oct 12 18:24:47 2009
+++ pod/perlcall.pod	Fri Sep 24 15:07:03 2010
@@ -1889,8 +1889,8 @@
 created and destroyed once, and the sub can be called
 arbitrarily many times in between.
 
-It is usual to pass parameters using global variables -- typically
-$_ for one parameter, or $a and $b for two parameters -- rather
+It is usual to pass parameters using global variables (typically
+$_ for one parameter, or $a and $b for two parameters) rather
 than via @_. (It is possible to use the @_ mechanism if you know
 what you're doing, though there is as yet no supported API for
 it. It's also inherently slower.)
Index: src/gnu/usr.bin/perl/pod/perldata.pod
diff -u src/gnu/usr.bin/perl/pod/perldata.pod:1.11 src/gnu/usr.bin/perl/pod/perldata.pod:1.12
--- pod/perldata.pod:1.11	Mon Oct 12 18:24:47 2009
+++ pod/perldata.pod	Fri Sep 24 15:07:03 2010
@@ -371,11 +371,6 @@
 =head3 Version Strings
 X<version string> X<vstring> X<v-string>
 
-B<Note:> Version Strings (v-strings) have been deprecated.  They will
-be removed in some future release after Perl 5.8.1.  The marginal
-benefits of v-strings were greatly outweighed by the potential for
-Surprise and Confusion.
-
 A literal of the form C<v1.20.300.4000> is parsed as a string composed
 of characters with the specified ordinals.  This form, known as
 v-strings, provides an alternative, more readable way to construct
@@ -638,9 +633,9 @@
 It is often more readable to use the C<< => >> operator between key/value
 pairs.  The C<< => >> operator is mostly just a more visually distinctive
 synonym for a comma, but it also arranges for its left-hand operand to be
-interpreted as a string -- if it's a bareword that would be a legal simple
-identifier (C<< => >> doesn't quote compound identifiers, that contain
-double colons). This makes it nice for initializing hashes:
+interpreted as a string if it's a bareword that would be a legal simple
+identifier. C<< => >> doesn't quote compound identifiers, that contain
+double colons. This makes it nice for initializing hashes:
 
     %map = (
                  red   => 0x00f,
Index: src/gnu/usr.bin/perl/pod/perldebug.pod
diff -u src/gnu/usr.bin/perl/pod/perldebug.pod:1.12 src/gnu/usr.bin/perl/pod/perldebug.pod:1.13
--- pod/perldebug.pod:1.12	Mon Oct 12 18:24:47 2009
+++ pod/perldebug.pod	Fri Sep 24 15:07:03 2010
@@ -1066,9 +1066,9 @@
 Look for these in the F<modules/by-module/Term> directory on CPAN.
 These do not support normal B<vi> command-line editing, however.
 
-A rudimentary command-line completion is also available.
-Unfortunately, the names of lexical variables are not available for
-completion.
+A rudimentary command-line completion is also available, including
+lexical variables in the current scope if the C<PadWalker> module
+is installed.
 
 Without Readline support you may see the symbols "^[[A", "^[[C", "^[[B",
 "^[[D"", "^H", ... when using the arrow keys and/or the backspace key.
@@ -1101,10 +1101,10 @@
 =head2 The Perl Profiler
 X<profile> X<profiling> X<profiler>
 
-If you wish to supply an alternative debugger for Perl to run, just
+If you wish to supply an alternative debugger for Perl to run,
 invoke your script with a colon and a package argument given to the
-B<-d> flag.  The most popular alternative debuggers for Perl is the
-Perl profiler.  Devel::DProf is included with the standard Perl
+B<-d> flag.  Perl's alternative debuggers include the Perl profiler,
+L<Devel::DProf>, which is included with the standard Perl
 distribution.  To profile your Perl program in the file F<mycode.pl>,
 just type:
 
@@ -1114,7 +1114,8 @@
 information to a file called F<tmon.out>.  A tool like B<dprofpp>,
 also supplied with the standard Perl distribution, can be used to
 interpret the information in that profile.  More powerful profilers,
-such as C<Devel::NYTProf> are available from the CPAN.
+such as C<Devel::NYTProf> are available from the CPAN:  see L<perlperf>
+for details.
 
 =head1 Debugging regular expressions
 X<regular expression, debugging>
Index: src/gnu/usr.bin/perl/pod/perldiag.pod
diff -u src/gnu/usr.bin/perl/pod/perldiag.pod:1.13 src/gnu/usr.bin/perl/pod/perldiag.pod:1.14
--- pod/perldiag.pod:1.13	Mon Oct 12 18:24:47 2009
+++ pod/perldiag.pod	Fri Sep 24 15:07:03 2010
@@ -8,7 +8,7 @@
 desperation):
 
     (W) A warning (optional).
-    (D) A deprecation (optional).
+    (D) A deprecation (enabled by default).
     (S) A severe warning (enabled by default).
     (F) A fatal error (trappable).
     (P) An internal error you should never see (trappable).
@@ -115,8 +115,8 @@
 (W misc) The pattern match (C<//>), substitution (C<s///>), and
 transliteration (C<tr///>) operators work on scalar values.  If you apply
 one of them to an array or a hash, it will convert the array or hash to
-a scalar value -- the length of an array, or the population info of a
-hash -- and then work on that scalar value.  This is probably not what
+a scalar value (the length of an array, or the population info of a
+hash) and then work on that scalar value.  This is probably not what
 you meant to do.  See L<perlfunc/grep> and L<perlfunc/map> for
 alternatives.
 
@@ -306,7 +306,21 @@
 used as an lvalue, which is pretty strange.  Perhaps you forgot to
 dereference it first.  See L<perlfunc/substr>.
 
-=item Bad arg length for %s, is %d, should be %s
+=item Attribute "locked" is deprecated
+
+(D deprecated) You have used the attributes pragam to modify the "locked"
+attribute on a code reference. The :locked attribute is obsolete, has had no
+effect since 5005 threads were removed, and will be removed in the next major
+release of Perl 5.
+
+=item Attribute "unique" is deprecated
+
+(D deprecated) You have used the attributes pragam to modify the "unique"
+attribute on an array, hash or scalar reference. The :unique attribute has
+had no effect since Perl 5.8.8, and will be removed in the next major
+release of Perl 5.
+
+=item Bad arg length for %s, is %d, should be %d
 
 (F) You passed a buffer of the wrong size to one of msgctl(), semctl()
 or shmctl().  In C parlance, the correct sizes are, respectively,
@@ -359,6 +373,11 @@
     $var = 'myvar';
     $sym = "mypack::$var";
 
+=item Bad plugin affecting keyword '%s'
+
+(F) An extension using the keyword plugin mechanism violated the
+plugin API.
+
 =item Bad realloc() ignored
 
 (S malloc) An internal routine called realloc() on something that had
@@ -507,6 +526,11 @@
 (P) Perl detected an attempt to copy a value to an internal type that cannot
 be directly assigned not.
 
+=item Cannot find encoding "%s"
+
+(S io) You tried to apply an encoding that did not exist to a filehandle,
+either with open() or binmode().
+
 =item Can only compress unsigned integers in pack
 
 (F) An argument to pack("w",...) was not an integer.  The BER compressed
@@ -651,24 +675,6 @@
 regexp to match something 0 times, just put {0}. The <-- HERE shows in the
 regular expression about where the problem was discovered. See L<perlre>.
 
-=item Can't do setegid!
-
-(P) The setegid() call failed for some reason in the setuid emulator of
-suidperl.
-
-=item Can't do seteuid!
-
-(P) The setuid emulator of suidperl failed for some reason.
-
-=item Can't do setuid
-
-(F) This typically means that ordinary perl tried to exec suidperl to do
-setuid emulation, but couldn't exec it.  It looks for a name of the form
-sperl5.000 in the same directory that the perl executable resides under
-the name perl5.000, typically /usr/local/bin on Unix machines.  If the
-file is there, check the execute permissions.  If it isn't, ask your
-sysadmin why he and/or she removed it.
-
 =item Can't do waitpid with flags
 
 (F) This machine doesn't have either waitpid() or wait4(), so only
@@ -716,9 +722,9 @@
 =item Can't find %s character property "%s"
 
 (F) You used C<\p{}> or C<\P{}> but the character property by that name
-could not be found. Maybe you misspelled the name of the property
-(remember that the names of character properties consist only of
-alphanumeric characters), or maybe you forgot the C<Is> or C<In> prefix?
+could not be found. Maybe you misspelled the name of the property?
+See L<perluniprops/Properties accessible through \p{} and \P{}>
+for a complete list of available properties.
 
 =item Can't find label %s
 
@@ -751,17 +757,24 @@
 =item Can't find Unicode property definition "%s"
 
 (F) You may have tried to use C<\p> which means a Unicode property (for
-example C<\p{Lu}> is all uppercase letters).  If you did mean to use a
-Unicode property, see L<perlunicode> for the list of known properties.
+example C<\p{Lu}> matches all uppercase letters).  If you did mean to use a
+Unicode property, see
+L<perluniprops/Properties accessible through \p{} and \P{}>
+for a complete list of available properties.
 If you didn't mean to use a Unicode property, escape the C<\p>, either
 by C<\\p> (just the C<\p>) or by C<\Q\p> (the rest of the string, until
 possible C<\E>).
 
-=item Can't fork
+=item Can't fork: %s
 
 (F) A fatal error occurred while trying to fork while opening a
 pipeline.
 
+=item Can't fork, trying again in 5 seconds
+
+(W pipe) A fork in a piped open failed with EAGAIN and will be retried
+after five seconds.
+
 =item Can't get filespec - stale stat buffer?
 
 (S) A warning peculiar to VMS.  This arises because of the difference
@@ -829,6 +842,12 @@
 situation typically indicates that the parent program under which Perl
 may be running (e.g. cron) is being very careless.
 
+=item Can't kill a non-numeric process ID
+
+(F) Process identifiers must be (signed) integers.  It is a fatal error to
+attempt to kill() an undefined, empty-string or otherwise non-numeric
+process identifier.
+
 =item Can't "last" outside a loop block
 
 (F) A "last" statement was executed to break out of the current block,
@@ -1031,17 +1050,12 @@
 (P) An error peculiar to VMS.  Perl thought stdin was a pipe, and tried
 to reopen it to accept binary data.  Alas, it failed.
 
-=item Can't resolve method `%s' overloading `%s' in package `%s'
+=item Can't resolve method "%s" overloading "%s" in package "%s"
 
 (F|P) Error resolving overloading specified by a method name (as opposed
 to a subroutine reference): no such method callable via the package. If
 method name is C<???>, this is an internal error.
 
-=item Can't reswap uid and euid
-
-(P) The setreuid() call failed for some reason in the setuid emulator of
-suidperl.
-
 =item Can't return %s from lvalue subroutine
 
 (F) Perl detected an attempt to return illegal lvalues (such as
@@ -1066,11 +1080,6 @@
 (P) For some reason you can't fstat() the script even though you have it
 open already.  Bizarre.
 
-=item Can't swap uid and euid
-
-(P) The setreuid() call failed for some reason in the setuid emulator of
-suidperl.
-
 =item Can't take log of %g
 
 (F) For ordinary real numbers, you can't take the logarithm of a
@@ -1443,6 +1452,14 @@
 long for Perl to handle.  You have to be seriously twisted to write code
 that triggers this error.
 
+=item Deprecated character(s) in \\N{...} starting at '%s'
+
+(D deprecated) Just about anything is legal for the C<...> in C<\N{...}>.
+But starting in 5.12, non-reasonable ones that don't look like names are
+deprecated.  A reasonable name begins with an alphabetic character and
+continues with any combination of alphanumerics, dashes, spaces, parentheses or
+colons.
+
 =item Deprecated use of my() in false conditional
 
 (D deprecated) You used a declaration similar to C<my $x if 0>.
@@ -1627,7 +1644,7 @@
 
 (F) The C<exec> function is not implemented in MacPerl. See L<perlport>.
 
-=item Execution of %s aborted due to compilation errors
+=item Execution of %s aborted due to compilation errors.
 
 (F) The final summary message when a Perl compilation fails.
 
@@ -1835,6 +1852,20 @@
 not finding it.  Chances are you left some needed parentheses out
 earlier in the line, and you really meant a "less than".
 
+=item gmtime(%.0f) too large
+
+(W overflow) You called C<gmtime> with an number that was larger than
+it can reliably handle and C<gmtime> probably returned the wrong
+date. This warning is also triggered with nan (the special
+not-a-number value).
+
+=item gmtime(%.0f) too small
+
+(W overflow) You called C<gmtime> with an number that was smaller than
+it can reliably handle and C<gmtime> probably returned the wrong
+date. This warning is also triggered with nan (the special
+not-a-number value).
+
 =item Got an error from DosAllocMem
 
 (P) An error peculiar to OS/2.  Most probably you're using an obsolete
@@ -1851,7 +1882,7 @@
 supposed to follow something: a template character or a ()-group.
  See L<perlfunc/pack>.
 
-=item %s had compilation errors
+=item %s had compilation errors.
 
 (F) The final summary message when a C<perl -c> fails.
 
@@ -1884,10 +1915,10 @@
 names (like C<$A::B>).  You've exceeded Perl's limits.  Future versions
 of Perl are likely to eliminate these arbitrary limitations.
 
-=item Ignoring %s in character class in regex; marked by <-- HERE in m/%s/
+=item Ignoring zero length \N{} in character class
 
-(W) Named Unicode character escapes (\N{...}) may return multi-char
-or zero length sequences. When such an escape is used in a character class
+(W) Named Unicode character escapes (\N{...}) may return a
+zero length sequence.  When such an escape is used in a character class
 its behaviour is not well defined. Check that the correct escape has
 been used, and the correct charname handler is in scope.
 
@@ -1911,8 +1942,8 @@
 
 =item Illegal character in prototype for %s : %s
 
-(W syntax) An illegal character was found in a prototype declaration.  Legal
-characters in prototypes are $, @, %, *, ;, [, ], &, and \.
+(W illegalproto) An illegal character was found in a prototype declaration.
+Legal characters in prototypes are $, @, %, *, ;, [, ], &, and \.
 
 =item Illegal declaration of anonymous subroutine
 
@@ -1954,7 +1985,7 @@
 (W digit) You may have tried to use an 8 or 9 in an octal number.
 Interpretation of the octal number stopped before the 8 or 9.
 
-=item Illegal switch in PERL5OPT: %s
+=item Illegal switch in PERL5OPT: -%c
 
 (X) The PERL5OPT environment variable may only be used to set the
 following switches: B<-[CDIMUdmtw]>.
@@ -2176,7 +2207,7 @@
 (W unopened) You tried ioctl() on a filehandle that was never opened.
 Check you control flow and number of arguments.
 
-=item IO layers (like "%s") unavailable
+=item IO layers (like '%s') unavailable
 
 (F) Your Perl has not been configured to have PerlIO, and therefore
 you cannot use IO layers.  To have PerlIO Perl must be configured
@@ -2189,7 +2220,7 @@
 
 =item $* is no longer supported
 
-(S deprecated, syntax) The special variable C<$*>, deprecated in older perls, has
+(D deprecated, syntax) The special variable C<$*>, deprecated in older perls, has
 been removed as of 5.9.0 and is no longer supported. In previous versions of perl the use of
 C<$*> enabled or disabled multi-line matching within a string.
 
@@ -2199,7 +2230,7 @@
 
 =item $# is no longer supported
 
-(S deprecated, syntax) The special variable C<$#>, deprecated in older perls, has
+(D deprecated, syntax) The special variable C<$#>, deprecated in older perls, has
 been removed as of 5.9.3 and is no longer supported. You should use the
 printf/sprintf functions instead.
 
@@ -2247,23 +2278,68 @@
 length/code combination tried to obtain more data. This results in
 an undefined value for the length. See L<perlfunc/pack>.
 
+=item Lexing code attempted to stuff non-Latin-1 character into Latin-1 input
+
+(F) An extension is attempting to insert text into the current parse
+(using L<lex_stuff_pvn_flags|perlapi/lex_stuff_pvn_flags> or similar), but
+tried to insert a character that couldn't be part of the current input.
+This is an inherent pitfall of the stuffing mechanism, and one of the
+reasons to avoid it.  Where it is necessary to stuff, stuffing only
+plain ASCII is recommended.
+
+=item Lexing code internal error (%s)
+
+(F) Lexing code supplied by an extension violated the lexer's API in a
+detectable way.
+
 =item listen() on closed socket %s
 
 (W closed) You tried to do a listen on a closed socket.  Did you forget
 to check the return value of your socket() call?  See
 L<perlfunc/listen>.
 
+=item localtime(%.0f) too large
+
+(W overflow) You called C<localtime> with an number that was larger
+than it can reliably handle and C<localtime> probably returned the
+wrong date. This warning is also triggered with nan (the special
+not-a-number value).
+
+=item localtime(%.0f) too small
+
+(W overflow) You called C<localtime> with an number that was smaller
+than it can reliably handle and C<localtime> probably returned the
+wrong date. This warning is also triggered with nan (the special
+not-a-number value).
+
 =item Lookbehind longer than %d not implemented in regex m/%s/
 
 (F) There is currently a limit on the length of string which lookbehind can
 handle. This restriction may be eased in a future release. 
 
+=item Lost precision when %s %f by 1
+
+(W) The value you attempted to increment or decrement by one is too large
+for the underlying floating point representation to store accurately,
+hence the target of C<++> or C<--> is unchanged. Perl issues this warning
+because it has already switched from integers to floating point when values
+are too large for integers, and now even floating point is insufficient.
+You may wish to switch to using L<Math::BigInt> explicitly.
+
 =item lstat() on filehandle %s
 
 (W io) You tried to do an lstat on a filehandle.  What did you mean
 by that?  lstat() makes sense only on filenames.  (Perl did a fstat()
 instead on the filehandle.)
 
+=item lvalue attribute ignored after the subroutine has been defined
+
+(W misc) Making a subroutine an lvalue subroutine after it has been defined
+by declaring the subroutine with a lvalue attribute is not
+possible. To make the the subroutine a lvalue subroutine add the
+lvalue attribute to the definition, or put the the declaration before
+the definition.
+
 =item Lvalue subs returning %s not implemented yet
 
 (F) Due to limitations in the current implementation, array and hash
@@ -2319,9 +2395,13 @@
 
 =item Malformed UTF-16 surrogate
 
-Perl thought it was reading UTF-16 encoded character data but while
+(F) Perl thought it was reading UTF-16 encoded character data but while
 doing it Perl met a malformed Unicode surrogate.
 
+=item Malformed UTF-8 returned by \N
+
+(F) The charnames handler returned malformed UTF-8.
+
 =item Malformed UTF-8 string in pack
 
 (F) You tried to pack something that didn't comply with UTF-8 encoding
@@ -2337,9 +2417,9 @@
 (F) You tried to unpack something that didn't comply with UTF-8 encoding
 rules and perl was unable to guess how to make more progress.
 
-=item Maximal count of pending signals (%s) exceeded
+=item Maximal count of pending signals (%d) exceeded
 
-(F) Perl aborted due to a too important number of signals pending. This
+(F) Perl aborted due to a too high number of signals pending. This
 usually indicates that your operating system tried to deliver signals
 too fast (with a very high priority), starving the perl process from
 resources it would need to reach a point where it can process signals
@@ -2384,15 +2464,23 @@
 (W syntax) An underscore (underbar) in a numeric constant did not
 separate two digits.
 
+=item Missing argument in %s
+
+(W uninitialized) A printf-type format required more arguments than were
+supplied.
+
 =item Missing argument to -%c
 
 (F) The argument to the indicated command line switch must follow
 immediately after the switch, without intervening spaces.
 
-=item Missing %sbrace%s on \N{}
+=item Missing braces on \N{}
 
 (F) Wrong syntax of character name literal C<\N{charname}> within
-double-quotish context.
+double-quotish context.  This can also happen when there is a space (or
+comment) between the C<\N> and the C<{> in a regex with the C</x> modifier.
+This modifier does not change the requirement that the brace immediately follow
+the C<\N>.
 
 =item Missing comma after first argument to %s function
 
@@ -2428,7 +2516,34 @@
 
 =item Missing right brace on %s
 
-(F) Missing right brace in C<\x{...}>, C<\p{...}> or C<\P{...}>.
+(F) Missing right brace in C<\x{...}>, C<\p{...}>, C<\P{...}>, or C<\N{...}>.
+
+=item Missing right brace on \\N{} or unescaped left brace after \\N
+
+(F)
+C<\N> has two meanings.
+
+The traditional one has it followed by a name enclosed
+in braces, meaning the character (or sequence of characters) given by that name.
+Thus C<\N{ASTERISK}> is another way of writing C<*>, valid in both
+double-quoted strings and regular expression patterns.  In patterns, it doesn't
+have the meaning an unescaped C<*> does.
+
+Starting in Perl 5.12.0, C<\N> also can have an additional meaning (only) in
+patterns, namely to match a non-newline character.  (This is short for
+C<[^\n]>, and like C<.> but is not affected by the C</s> regex modifier.)
+
+This can lead to some ambiguities.  When C<\N> is not followed immediately by a
+left brace, Perl assumes the C<[^\n]> meaning.  Also, if
+the braces form a valid quantifier such as C<\N{3}> or C<\N{5,}>, Perl assumes
+that this means to match the given quantity of non-newlines (in these examples,
+3; and 5 or more, respectively).  In all other case, where there is a C<\N{>
+and a matching C<}>, Perl assumes that a character name is desired.
+
+However, if there is no matching C<}>, Perl doesn't know if it was mistakenly
+omitted, or if C<[^\n]{> was desired, and
+raises this error.  If you meant the former, add the right brace; if you meant
+the latter, escape the brace with a backslash, like so: C<\N\{>
 
 =item Missing right curly or square bracket
 
@@ -2482,7 +2597,7 @@
 you omitted the name of the module.  Consult L<perlrun> for full details
 about C<-M> and C<-m>.
 
-=item More than one argument to open
+=item More than one argument to '%s' open
 
 (F) The C<open> function has been asked to open multiple files. This
 can happen if you are trying to open a pipe to a command that takes a
@@ -2515,6 +2630,42 @@
 sense to try to declare one with a package qualifier on the front.  Use
 local() if you want to localize a package variable.
 
+=item \\N in a character class must be a named character: \\N{...}
+
+(F) The new (5.12) meaning of C<\N> as C<[^\n]> is not valid in a bracketed
+character class, for the same reason that C<.> in a character class loses its
+specialness: it matches almost everything, which is probably not what you want.
+
+=item \\N{NAME} must be resolved by the lexer
+
+(F) When compiling a regex pattern, an unresolved named character or sequence
+was encountered.  This can happen in any of several ways that bypass the lexer,
+such as using single-quotish context, or an extra backslash in double quotish:
+
+    $re = '\N{SPACE}';	# Wrong!
+    $re = "\\N{SPACE}";	# Wrong!
+    /$re/;
+
+Instead, use double-quotes with a single backslash:
+
+    $re = "\N{SPACE}";	# ok
+    /$re/;
+
+The lexer can be bypassed as well by creating the pattern from smaller
+components:
+
+    $re = '\N';
+    /${re}{SPACE}/;	# Wrong!
+
+It's not a good idea to split a construct in the middle like this, and it
+doesn't work here.  Instead use the solution above.
+
+Finally, the message also can happen under the C</x> regex modifier when the
+C<\N> is separated by spaces from the C<{>, in which case, remove the spaces.
+
+    /\N {SPACE}/x;	# Wrong!
+    /\N{SPACE}/x;	# ok
+
 =item Name "%s::%s" used only once: possible typo
 
 (W once) Typographical errors often show up as unique variable names.
@@ -2527,6 +2678,12 @@
 the same; if a program uses $c only once but also uses any of the others it
 will not trigger this warning.
 
+=item Invalid hexadecimal number in \\N{U+...}
+
+(F) The character constant represented by C<...> is not a valid hexadecimal
+number.  Either it is empty, or you tried to use a character other than 0 - 9
+or A - F, a - f in a hexadecimal number.
+
 =item Negative '/' count in unpack
 
 (F) The length count obtained from a length/code unpack operation was
@@ -2993,6 +3150,17 @@
 the string being unpacked. The string being unpacked was also invalid
 UTF-8. See L<perlfunc/pack>.
 
+=item Overloaded dereference did not return a reference
+
+(F) An object with an overloaded dereference operator was dereferenced,
+but the overloaded operation did not return a reference. See
+L<overload>.
+
+=item Overloaded qr did not return a REGEXP
+
+(F) An object with a C<qr> overload was used as part of a match, but the
+overloaded operation didn't return a compiled regexp. See L<overload>.
+
 =item %s package attribute may clash with future reserved word: %s
 
 (W reserved) A lowercase attribute name was used that had a
@@ -3209,6 +3377,11 @@
 (P) Something tried to call utf16_to_utf8 with an odd (as opposed
 to even) byte length.
 
+=item panic: utf16_to_utf8_reversed: odd bytelen
+
+(P) Something tried to call utf16_to_utf8_reversed with an odd (as opposed
+to even) byte length.
+
 =item panic: yylex
 
 (P) The lexer got into a bad state while processing a case modifier.
@@ -3253,6 +3426,13 @@
 conversion functions.  This is only a problem when you're using the
 '<' or '>' modifiers in (un)pack templates.  See L<perlfunc/pack>.
 
+=item Perl_pmflag() is deprecated, and will be removed from the XS API
+
+(D deprecated) XS code called the C function C<Perl_pmflag>. This was part of
+Perl's listed public API for extending or embedding the perl interpreter. It has
+now been removed from the public API, and will be removed in a future release,
+hence XS code should be re-written not to use it.
+
 =item Perl %s required--this is only version %s, stopped
 
 (F) The module in question uses features of a version of Perl more
@@ -3290,10 +3470,6 @@
 you run Perl.  How to really fix the problem can be found in
 L<perllocale> section B<LOCALE PROBLEMS>.
 
-=item Permission denied
-
-(F) The setuid emulator in suidperl decided you were up to no good.
-
 =item pid %x not a child
 
 (W exec) A warning peculiar to VMS.  Waitpid() was asked to wait for a
@@ -3304,11 +3480,6 @@
 
 (F) The unpack format P must have an explicit size, not "*".
 
-=item B<-P> not allowed for setuid/setgid script
-
-(F) The script would have to be opened by the C preprocessor by name,
-which provides a race condition that breaks security.
-
 =item POSIX class [:%s:] unknown in regex; marked by <-- HERE in m/%s/
 
 (F) The class in the character class [: :] syntax is unknown.  The <-- HERE
@@ -3420,23 +3591,19 @@
 literal @foo, then write it as \@foo; otherwise find out what happened
 to the array you apparently lost track of.
 
-=item pragma "attrs" is deprecated, use "sub NAME : ATTRS" instead
-
-(D deprecated) You have written something like this:
-
-    sub doit
-    {
-        use attrs qw(locked);
-    }
-
-You should use the new declaration syntax instead.
-
-    sub doit : locked
-    {
-        ...
+=item Possible unintended interpolation of $\ in regex
 
-The C<use attrs> pragma is now obsolete, and is only provided for
-backward-compatibility. See L<perlsub/"Subroutine Attributes">.
+(W ambiguous) You said something like C<m/$\/> in a regex.
+The regex C<m/foo$\s+bar/m> translates to: match the word 'foo', the output
+record separator (see L<perlvar/$\>) and the letter 's' (one time or more)
+followed by the word 'bar'.
+
+If this is what you intended then you can silence the warning by using 
+C<m/${\}/> (for example: C<m/foo${\}s+bar/>).
+
+If instead you intended to match the word 'foo' at the end of the line
+followed by whitespace and the word 'bar' on the next line then you can use
+C<m/$(?)\/> (for example: C<m/foo$(?)\s+bar/>).
 
 =item Precedence problem: open %s should be open(%s)
 
@@ -3475,6 +3642,11 @@
 L<perlipc/"Signals">.  See also "Process terminated by SIGTERM/SIGINT"
 in L<perlos2>.
 
+=item Prototype after '%c' for %s : %s
+
+(W illegalproto) A character follows % or @ in a prototype. This is useless,
+since % and @ gobble the rest of the subroutine arguments.
+
 =item Prototype mismatch: %s vs %s
 
 (S prototype) The subroutine being declared or defined had previously been
@@ -3643,6 +3815,12 @@
 numeric field that will never go blank so that the repetition never
 terminates. You might use ^# instead.  See L<perlform>.
 
+=item Replacement list is longer than search list
+
+(W misc) You have used a replacement list that is longer than the
+search list. So the additional elements in the replacement list
+are meaningless.
+
 =item Reversed %s= operator
 
 (W syntax) You wrote your assignment operator backwards.  The = must
@@ -3653,14 +3831,6 @@
 (W io) The dirhandle you tried to do a rewinddir() on is either closed or not
 really a dirhandle.  Check your control flow.
 
-=item Runaway format
-
-(F) Your format contained the ~~ repeat-until-blank sequence, but it
-produced 200 lines at once, and the 200th line looked exactly like the
-199th line.  Apparently you didn't arrange for the arguments to exhaust
-themselves, either by using ^ instead of @ (for scalar variables), or by
-shifting or popping (for array variables).  See L<perlform>.
-
 =item Scalars leaked: %d
 
 (P) Something went wrong in Perl's internal bookkeeping of scalars:
@@ -3698,11 +3868,6 @@
 not magically convert between scalars and lists for you.  See
 L<perlref>.
 
-=item Script is not setuid/setgid in suidperl
-
-(F) Oddly, the suidperl program was invoked on a script without a setuid
-or setgid bit set.  This doesn't make much sense.
-
 =item Search pattern not terminated
 
 (F) The lexer couldn't find the final delimiter of a // or m{}
@@ -3916,12 +4081,6 @@
 (F) An ancient error message that almost nobody ever runs into anymore.
 But before sort was a keyword, people sometimes used it as a filehandle.
 
-=item Sort subroutine didn't return a numeric value
-
-(F) A sort comparison routine must return a number.  You probably blew
-it by not using C<< <=> >> or C<cmp>, or by not using them correctly.
-See L<perlfunc/sort>.
-
 =item Sort subroutine didn't return single value
 
 (F) A sort comparison subroutine may not return a list value with more
@@ -3954,7 +4113,7 @@
 (W unopened) You tried to use the stat() function on a filehandle that
 was either never opened or has since been closed.
 
-=item Stub found while resolving method "%s" overloading "%s"
+=item Stub found while resolving method "%s" overloading "%s" in package "%s"
 
 (P) Overloading resolution over @ISA tree may be broken by importation
 stubs.  Stubs should never be implicitly created, but explicit calls to
@@ -3996,11 +4155,6 @@
 substr is used in an lvalue context (as the left hand side of an
 assignment or as a subroutine argument for example).
 
-=item suidperl is no longer needed since %s
-
-(F) Your Perl was compiled with B<-D>SETUID_SCRIPTS_ARE_SECURE_NOW, but
-a version of the setuid emulator somehow got run anyway.
-
 =item sv_upgrade from type %d down to type %d
 
 (P) Perl tried to force the upgrade an SV to a type which was actually
@@ -4170,18 +4324,18 @@
 =item "-T" is on the #! line, it must also be used on the command line
 
 (X) The #! line (or local equivalent) in a Perl script contains the
-B<-T> option, but Perl was not invoked with B<-T> in its command line.
+B<-T> option (or the B<-t> option), but Perl was not invoked with B<-T> in its command line.
 This is an error because, by the time Perl discovers a B<-T> in a
 script, it's too late to properly taint everything from the environment.
 So Perl gives up.
 
 If the Perl script is being executed as a command using the #!
 mechanism (or its local equivalent), this error can usually be fixed by
-editing the #! line so that the B<-T> option is a part of Perl's first
-argument: e.g. change C<perl -n -T> to C<perl -T -n>.
+editing the #! line so that the B<-%c> option is a part of Perl's first
+argument: e.g. change C<perl -n -%c> to C<perl -%c -n>.
 
 If the Perl script is being executed as C<perl scriptname>, then the
-B<-T> option must appear on the command line: C<perl -T scriptname>.
+B<-%c> option must appear on the command line: C<perl -%c scriptname>.
 
 =item To%s: illegal mapping '%s'
 
@@ -4346,11 +4500,16 @@
 (F) The unexec() routine failed for some reason.  See your local FSF
 representative, who probably put it there in the first place.
 
-=item Unicode character %s is illegal
+=item Unicode non-character %s is illegal for interchange
 
-(W utf8) Certain Unicode characters have been designated off-limits by
-the Unicode standard and should not be generated.  If you really know
-what you are doing you can turn off this warning by C<no warnings 'utf8';>.
+(W utf8) Certain codepoints, such as U+FFFE and U+FFFF, are defined by the
+Unicode standard to be non-characters. Those are legal codepoints, but are
+reserved for internal use; so, applications shouldn't attempt to exchange
+them.  In some cases, this message is also given if you use a codepoint that
+isn't in Unicode--that is it is above the legal maximum of U+10FFFF.  These
+aren't legal at all in Unicode, so they are illegal for interchange, but can be
+used internally in a Perl program.  If you know what you are doing you can turn
+off this warning by C<no warnings 'utf8';>.
 
 =item Unknown BYTEORDER
 
@@ -4449,29 +4608,31 @@
 somehow, or insert an underbar into it.  You might also declare it as a
 subroutine.
 
-=item Unrecognized character %s in column %d
+=item Unrecognized character %s; marked by <-- HERE after %s near column %d
 
 (F) The Perl parser has no idea what to do with the specified character
-in your Perl script (or eval) at the specified column.  Perhaps you tried 
+in your Perl script (or eval) near the specified column.  Perhaps you tried 
 to run a compressed script, a binary program, or a directory as a Perl program.
 
 =item Unrecognized escape \\%c in character class passed through in regex; marked by <-- HERE in m/%s/
 
 (W regexp) You used a backslash-character combination which is not
 recognized by Perl inside character classes.  The character was
-understood literally.
+understood literally, but this may change in a future version of Perl.
 The <-- HERE shows in the regular expression about where the
 escape was discovered.
 
 =item Unrecognized escape \\%c passed through
 
 (W misc) You used a backslash-character combination which is not
-recognized by Perl.  The character was understood literally.
+recognized by Perl.  The character was understood literally, but this may
+change in a future version of Perl.
 
 =item Unrecognized escape \\%c passed through in regex; marked by <-- HERE in m/%s/
 
 (W regexp) You used a backslash-character combination which is not
-recognized by Perl.  The character was understood literally.
+recognized by Perl.  The character was understood literally, but this may
+change in a future version of Perl.
 The <-- HERE shows in the regular expression about where the
 escape was discovered.
 
@@ -4611,6 +4772,12 @@
 The <-- HERE shows in the regular expression about
 where the problem was discovered. See L<perlre>.
 
+=item Useless use of /d modifier in transliteration operator
+
+(W misc) You have used the /d modifier where the searchlist has the
+same length as the replacelist. See L<perlop> for more information
+about the /d modifier.
+
 =item Useless use of %s in void context
 
 (W void) You did something without a side effect in a context that does
@@ -4677,14 +4844,19 @@
 (F) The "use" keyword is recognized and executed at compile time, and
 returns no useful value.  See L<perlmod>.
 
+=item Use of assignment to $[ is deprecated
+
+(D deprecated) The C<$[> variable (index of the first element in an array)
+is deprecated. See L<perlvar/"$[">.
+
 =item Use of bare << to mean <<"" is deprecated
 
-(D deprecated, W syntax) You are now encouraged to use the explicitly quoted
+(D deprecated) You are now encouraged to use the explicitly quoted
 form if you wish to use an empty line as the terminator of the here-document.
 
 =item Use of comma-less variable list is deprecated
 
-(D deprecated, W syntax) The values you give to a format should be
+(D deprecated) The values you give to a format should be
 separated by commas, not just aligned on a line.
 
 =item Use of chdir('') or chdir(undef) as chdir() deprecated
@@ -4708,6 +4880,14 @@
 use the /g modifier.  Currently, /c is meaningful only when /g is
 used.  (This may change in the future.)
 
+=item Use of := for an empty attribute list is deprecated
+
+(D deprecated) The construction C<my $x := 42> currently
+parses correctly in perl, being equivalent to C<my $x : = 42>
+(applying an empty attribute list to C<$x>). This useless
+construct is now deprecated, so C<:=> can be reclaimed as a new
+operator in the future.
+
 =item Use of freed value in iteration
 
 (F) Perhaps you modified the iterated array within the loop?
@@ -4732,11 +4912,10 @@
 operator.  Since C<split> always tries to match the pattern
 repeatedly, the C</g> has no effect.
 
-=item Use of implicit split to @_ is deprecated
+=item Use of "goto" to jump into a construct is deprecated
 
-(D deprecated, W syntax) It makes a lot of work for the compiler when you
-clobber a subroutine's argument list, so it's better if you assign the results
-of a split() explicitly to an array (or list).
+(D deprecated) Using C<goto> to jump from an outer scope into an inner
+scope is deprecated and should be avoided.
 
 =item Use of inherited AUTOLOAD for non-method %s() is deprecated
 
@@ -4762,6 +4941,15 @@
 you should remove AutoLoader from @ISA and change C<use AutoLoader;> to
 C<use AutoLoader 'AUTOLOAD';>.
 
+=item Use of octal value above 377 is deprecated
+
+(D deprecated, W regexp) There is a constant in the regular expression whose
+value is interpeted by Perl as octal and larger than 377 (255 decimal, 0xFF
+hex).  Perl may take this to mean different things depending on the rest of
+the regular expression.  If you meant such an octal value, convert it to
+hexadecimal and use C<\xHH> or C<\x{HH}> instead.  If you meant to have
+part of it mean a backreference, use C<\g> for that.  See L<perlre>.
+
 =item Use of %s in printf format not supported
 
 (F) You attempted to use a feature of printf that is accessible from
@@ -4842,14 +5030,28 @@
 allow this syntax, but shouldn't have. It is now deprecated, and will be
 removed in a future version.
 
+=item Using just the first character returned by \N{} in character class
+
+(W) A charnames handler may return a sequence of more than one character.
+Currently all but the first one are discarded when used in a regular
+expression pattern bracketed character class.
+
+=item Using just the first characters returned by \N{}
+
+(W) A charnames handler may return a sequence of characters.  There is a finite
+limit as to the number of characters that can be used, which this sequence
+exceeded.  In the message, the characters in the sequence are separated by
+dots, and each is shown by its ordinal in hex.  Anything to the left of the
+C<HERE> was retained; anything to the right was discarded.
+
 =item UTF-16 surrogate %s
 
-(W utf8) You tried to generate half of an UTF-16 surrogate by
+(W utf8) You tried to generate half of a UTF-16 surrogate by
 requesting a Unicode character between the code points 0xD800 and
 0xDFFF (inclusive).  That range is reserved exclusively for the use of
 UTF-16 encoding (by having two 16-bit UCS-2 characters); but Perl
 encodes its characters in UTF-8, so what you got is a very illegal
-character.  If you really know what you are doing you can turn off
+character.  If you really really know what you are doing you can turn off
 this warning by C<no warnings 'utf8';>.
 
 =item Value of %s can be "0"; test with defined()
Index: src/gnu/usr.bin/perl/pod/perldsc.pod
diff -u src/gnu/usr.bin/perl/pod/perldsc.pod:1.8 src/gnu/usr.bin/perl/pod/perldsc.pod:1.9
--- pod/perldsc.pod:1.8	Mon Oct 12 18:24:47 2009
+++ pod/perldsc.pod	Fri Sep 24 15:07:03 2010
@@ -85,8 +85,8 @@
 confusing.  If so, just think of it as the difference between a structure
 and a pointer to a structure.
 
-You can (and should) read more about references in the perlref(1) man
-page.  Briefly, references are rather like pointers that know what they
+You can (and should) read more about references in L<perlref>.
+Briefly, references are rather like pointers that know what they
 point to.  (Objects are also a kind of reference, but we won't be needing
 them right away--if ever.)  This means that when you have something which
 looks to you like an access to a two-or-more-dimensional array and/or hash,
@@ -837,7 +837,7 @@
 
 =head1 SEE ALSO
 
-perlref(1), perllol(1), perldata(1), perlobj(1)
+L<perlref>, L<perllol>, L<perldata>, L<perlobj>
 
 =head1 AUTHOR
 
Index: src/gnu/usr.bin/perl/pod/perlembed.pod
diff -u src/gnu/usr.bin/perl/pod/perlembed.pod:1.11 src/gnu/usr.bin/perl/pod/perlembed.pod:1.12
--- pod/perlembed.pod:1.11	Mon Oct 12 18:24:47 2009
+++ pod/perlembed.pod	Fri Sep 24 15:07:03 2010
@@ -1100,7 +1100,7 @@
 
 =head1 Hiding Perl_
 
-If you completely hide the short forms forms of the Perl public API,
+If you completely hide the short forms of the Perl public API,
 add -DPERL_NO_SHORT_NAMES to the compilation flags.  This means that
 for example instead of writing
 
Index: src/gnu/usr.bin/perl/pod/perlfaq.pod
diff -u src/gnu/usr.bin/perl/pod/perlfaq.pod:1.10 src/gnu/usr.bin/perl/pod/perlfaq.pod:1.11
--- pod/perlfaq.pod:1.10	Mon Oct 12 18:24:47 2009
+++ pod/perlfaq.pod	Fri Sep 24 15:07:03 2010
@@ -23,12 +23,12 @@
 at http://faq.perl.org/ . The perlfaq-workers periodically post extracts
 of the latest perlfaq to comp.lang.perl.misc.
 
-You can view the source tree at
-https://github.com/briandfoy/perlfaq (which is outside of the
-main Perl source tree).  The git repository notes all changes to the FAQ
-and holds the latest version of the working documents and may vary
-significantly from the version distributed with the latest version of
-Perl. Check the repository before sending your corrections.
+You can view the source tree at https://github.com/briandfoy/perlfaq
+(which is outside of the main Perl source tree). The git repository
+notes all changes to the FAQ and holds the latest version of the
+working documents and may vary significantly from the version
+distributed with the latest version of Perl. Check the repository
+before sending your corrections.
 
 =head2 How to contribute to the perlfaq
 
@@ -47,7 +47,7 @@
 request so the main repository can pull your changes. The repository
 is at:
 
-	https://github.com/briandfoy/perlfaq
+       https://github.com/briandfoy/perlfaq
 
 =head2 What will happen if you mail your Perl programming problems to the authors?
 
@@ -66,23 +66,20 @@
 =head1 CREDITS
 
 Tom Christiansen wrote the original perlfaq then expanded it with the
-help of Nat Torkington.  The perlfaq-workers maintain current document
-and the denizens of comp.lang.perl.misc regularly review and update the
+help of Nat Torkington. The perlfaq-workers maintain current document
+and the dezinens of comp.lang.perl.misc regularly review and update the
 FAQ. Several people have contributed answers, corrections, and comments,
 and the perlfaq notes those contributions wherever appropriate.
 
 =head1 AUTHOR AND COPYRIGHT
 
-Copyright (c) 1997-2009 Tom Christiansen, Nathan Torkington, and
-other authors as noted. All rights reserved.
-
 Tom Christainsen wrote the original version of this document.
 brian d foy C<< <bdfoy@cpan.org> >> wrote this version. See the
 individual perlfaq documents for additional copyright information.
 
 This document is available under the same terms as Perl itself. Code
 examples in all the perlfaq documents are in the public domain. Use
-them as you see fit and at your own risk with no warranty from anyone.
+them as you see fit (and at your own risk with no warranty from anyone).
 
 =head1 Table of Contents
 
@@ -467,7 +464,7 @@
 
 =item *
 
-Does Perl have a Year 2000 problem? Is Perl Y2K compliant?
+Does Perl have a Year 2000 or 2038 problem? Is Perl Y2K compliant?
 
 =item *
 
@@ -728,6 +725,10 @@
 
 =item *
 
+How do I delete the last N lines from a file?
+
+=item *
+
 How can I use Perl's C<-i> option from within a program?
 
 =item *
@@ -1102,7 +1103,7 @@
 
 =item *
 
-How can I comment out a large block of perl code?
+How can I comment out a large block of Perl code?
 
 =item *
 
Index: src/gnu/usr.bin/perl/pod/perlfaq1.pod
diff -u src/gnu/usr.bin/perl/pod/perlfaq1.pod:1.11 src/gnu/usr.bin/perl/pod/perlfaq1.pod:1.12
--- pod/perlfaq1.pod:1.11	Mon Oct 12 18:24:47 2009
+++ pod/perlfaq1.pod	Fri Sep 24 15:07:03 2010
@@ -10,7 +10,7 @@
 =head2 What is Perl?
 
 Perl is a high-level programming language with an eclectic heritage
-written by Larry Wall and a cast of thousands.  It derives from the
+written by Larry Wall and a cast of thousands. It derives from the
 ubiquitous C programming language and to a lesser extent from sed,
 awk, the Unix shell, and at least a dozen other tools and languages.
 Perl's process, file, and text manipulation facilities make it
@@ -19,39 +19,39 @@
 graphical programming, networking, and world wide web programming.
 These strengths make it especially popular with system administrators
 and CGI script authors, but mathematicians, geneticists, journalists,
-and even managers also use Perl.  Maybe you should, too.
+and even managers also use Perl. Maybe you should, too.
 
-=head2 Who supports Perl?  Who develops it?  Why is it free?
+=head2 Who supports Perl? Who develops it? Why is it free?
 
 The original culture of the pre-populist Internet and the deeply-held
 beliefs of Perl's author, Larry Wall, gave rise to the free and open
-distribution policy of perl.  Perl is supported by its users.  The
+distribution policy of perl. Perl is supported by its users. The
 core, the standard Perl library, the optional modules, and the
-documentation you're reading now were all written by volunteers.  See
+documentation you're reading now were all written by volunteers. See
 the personal note at the end of the README file in the perl source
-distribution for more details.  See L<perlhist> (new as of 5.005)
+distribution for more details. See L<perlhist> (new as of 5.005)
 for Perl's milestone releases.
 
 In particular, the core development team (known as the Perl Porters)
 are a rag-tag band of highly altruistic individuals committed to
 producing better software for free than you could hope to purchase for
-money.  You may snoop on pending developments via the archives at
+money. You may snoop on pending developments via the archives at
 http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/
 and http://archive.develooper.com/perl5-porters@perl.org/
 or the news gateway nntp://nntp.perl.org/perl.perl5.porters or
 its web interface at http://nntp.perl.org/group/perl.perl5.porters ,
 or read the faq at http://dev.perl.org/perl5/docs/p5p-faq.html ,
 or you can subscribe to the mailing list by sending
-perl5-porters-request@perl.org a subscription request
+perl5-porters-subscribe@perl.org a subscription request
 (an empty message with no subject is fine).
 
 While the GNU project includes Perl in its distributions, there's no
-such thing as "GNU Perl".  Perl is not produced nor maintained by the
-Free Software Foundation.  Perl's licensing terms are also more open
+such thing as "GNU Perl". Perl is not produced nor maintained by the
+Free Software Foundation. Perl's licensing terms are also more open
 than GNU software's tend to be.
 
 You can get commercial support of Perl if you wish, although for most
-users the informal support will more than suffice.  See the answer to
+users the informal support will more than suffice. See the answer to
 "Where can I buy a commercial version of perl?" for more information.
 
 =head2 Which version of Perl should I use?
@@ -101,22 +101,22 @@
 
 =item *
 
-No one is actively supporting Perl 4.  Five years ago it was a dead
-camel carcass (according to this document).  Now it's barely a skeleton
+No one is actively supporting Perl 4. Five years ago it was a dead
+camel carcass (according to this document). Now it's barely a skeleton
 as its whitewashed bones have fractured or eroded.
 
 =item *
 
 There is no Perl 6 release scheduled, but it will be available when
-it's ready.  Stay tuned, but don't worry that you'll have to change
+it's ready. Stay tuned, but don't worry that you'll have to change
 major versions of Perl; no one is going to take Perl 5 away from you.
 
 =item *
 
 There are really two tracks of perl development: a maintenance version
-and an experimental version.  The maintenance versions are stable, and
+and an experimental version. The maintenance versions are stable, and
 have an even number as the minor release (i.e. perl5.10.x, where 10 is the
-minor release).  The experimental versions may include features that
+minor release). The experimental versions may include features that
 don't make it into the stable versions, and have an odd number as the
 minor release (i.e. perl5.9.x, where 9 is the minor release).
 
@@ -131,21 +131,21 @@
 future.
 
 The number after perl (i.e. the 5 after Perl 5) is the major release
-of the perl interpreter as well as the version of the language.  Each
+of the perl interpreter as well as the version of the language. Each
 major version has significant differences that earlier versions cannot
 support.
 
 The current major release of Perl is Perl 5, and was released in 1994.
 It can run scripts from the previous major release, Perl 4 (March 1991),
 but has significant differences. It introduced the concept of references,
-complex data structures, and modules.  The Perl 5 interpreter was a
+complex data structures, and modules. The Perl 5 interpreter was a
 complete re-write of the previous perl sources.
 
 Perl 6 is the next major version of Perl, but it's still in development
-in both its syntax and design.  The work started in 2002 and is still
-ongoing.  Many of the most interesting features have shown up in the
+in both its syntax and design. The work started in 2002 and is still
+ongoing. Many of the most interesting features have shown up in the
 latest versions of Perl 5, and some Perl 5 modules allow you to use some
-Perl 6 syntax in your programs.  You can learn more about Perl 6 at
+Perl 6 syntax in your programs. You can learn more about Perl 6 at
 http://dev.perl.org/perl6/ .
 
 See L<perlhist> for a history of Perl revisions.
@@ -162,7 +162,7 @@
 Instead of using the current Perl internals, Ponie aimed to create a
 new one that would provide a translation path from Perl 5 to Perl 6
 (or anything else that targets Parrot, actually). You would have been
-able  to just keep using Perl 5 with Parrot, the virtual machine which
+able to just keep using Perl 5 with Parrot, the virtual machine which
 will compile and run Perl 6 bytecode.
 
 =head2 What is Perl 6?
@@ -174,7 +174,7 @@
 of Perl and its implementation, but was ultimately abandoned.
 
 If you want to learn more about Perl 6, or have a desire to help in
-the crusade to make Perl a better place then peruse the Perl 6 developers
+the crusade to make Perl a better place then read the Perl 6 developers
 page at http://dev.perl.org/perl6/ and get involved.
 
 Perl 6 is not scheduled for release yet, and Perl 5 will still be supported
@@ -187,51 +187,51 @@
 =head2 How stable is Perl?
 
 Production releases, which incorporate bug fixes and new functionality,
-are widely tested before release.  Since the 5.000 release, we have
+are widely tested before release. Since the 5.000 release, we have
 averaged only about one production release per year.
 
 Larry and the Perl development team occasionally make changes to the
 internal core of the language, but all possible efforts are made toward
-backward compatibility.  While not quite all Perl 4 scripts run flawlessly
+backward compatibility. While not quite all Perl 4 scripts run flawlessly
 under Perl 5, an update to perl should nearly never invalidate a program
 written for an earlier version of perl (barring accidental bug fixes
 and the rare new keyword).
 
 =head2 Is Perl difficult to learn?
 
-No, Perl is easy to start learning--and easy to keep learning.  It looks
+No, Perl is easy to start learning--and easy to keep learning. It looks
 like most programming languages you're likely to have experience
 with, so if you've ever written a C program, an awk script, a shell
 script, or even a BASIC program, you're already partway there.
 
-Most tasks only require a small subset of the Perl language.  One of
+Most tasks only require a small subset of the Perl language. One of
 the guiding mottos for Perl development is "there's more than one way
-to do it" (TMTOWTDI, sometimes pronounced "tim toady").  Perl's
+to do it" (TMTOWTDI, sometimes pronounced "tim toady"). Perl's
 learning curve is therefore shallow (easy to learn) and long (there's
 a whole lot you can do if you really want).
 
 Finally, because Perl is frequently (but not always, and certainly not by
 definition) an interpreted language, you can write your programs and test
 them without an intermediate compilation step, allowing you to experiment
-and test/debug quickly and easily.  This ease of experimentation flattens
+and test/debug quickly and easily. This ease of experimentation flattens
 the learning curve even more.
 
 Things that make Perl easier to learn: Unix experience, almost any kind
 of programming experience, an understanding of regular expressions, and
-the ability to understand other people's code.  If there's something you
+the ability to understand other people's code. If there's something you
 need to do, then it's probably already been done, and a working example is
-usually available for free.  Don't forget Perl modules, either.
+usually available for free. Don't forget Perl modules, either.
 They're discussed in Part 3 of this FAQ, along with CPAN, which is
 discussed in Part 2.
 
 =head2 How does Perl compare with other languages like Java, Python, REXX, Scheme, or Tcl?
 
-Favorably in some areas, unfavorably in others.  Precisely which areas
+Favorably in some areas, unfavorably in others. Precisely which areas
 are good and bad is often a personal choice, so asking this question
 on Usenet runs a strong risk of starting an unproductive Holy War.
 
 Probably the best thing to do is try to write equivalent code to do a
-set of tasks.  These languages have their own newsgroups in which you
+set of tasks. These languages have their own newsgroups in which you
 can learn about (but hopefully not argue about) them.
 
 Some comparison documents can be found at http://www.perl.com/doc/FMTEYEWTK/versus/
@@ -243,21 +243,21 @@
 task, from one-line file-processing tasks to large, elaborate systems.
 For many people, Perl serves as a great replacement for shell scripting.
 For others, it serves as a convenient, high-level replacement for most of
-what they'd program in low-level languages like C or C++.  It's ultimately
+what they'd program in low-level languages like C or C++. It's ultimately
 up to you (and possibly your management) which tasks you'll use Perl
 for and which you won't.
 
 If you have a library that provides an API, you can make any component
 of it available as just another Perl function or variable using a Perl
 extension written in C or C++ and dynamically linked into your main
-perl interpreter.  You can also go the other direction, and write your
+perl interpreter. You can also go the other direction, and write your
 main program in C or C++, and then link in some Perl code on the fly,
-to create a powerful application.  See L<perlembed>.
+to create a powerful application. See L<perlembed>.
 
 That said, there will always be small, focused, special-purpose
 languages dedicated to a specific problem domain that are simply more
-convenient for certain kinds of problems.  Perl tries to be all things
-to all people, but nothing special to anyone.  Examples of specialized
+convenient for certain kinds of problems. Perl tries to be all things
+to all people, but nothing special to anyone. Examples of specialized
 languages that come to mind include prolog and matlab.
 
 =head2 When shouldn't I program in Perl?
@@ -272,19 +272,19 @@
 For various reasons, Perl is probably not well-suited for real-time
 embedded systems, low-level operating systems development work like
 device drivers or context-switching code, complex multi-threaded
-shared-memory applications, or extremely large applications.  You'll
+shared-memory applications, or extremely large applications. You'll
 notice that perl is not itself written in Perl.
 
 Perl remains fundamentally a dynamically typed language, not
-a statically typed one.  You certainly won't be chastised if you don't
-trust nuclear-plant or brain-surgery monitoring code to it.  And Larry
+a statically typed one. You certainly won't be chastised if you don't
+trust nuclear-plant or brain-surgery monitoring code to it. And Larry
 will sleep easier, too--Wall Street programs not withstanding. :-)
 
 =head2 What's the difference between "perl" and "Perl"?
 
-One bit.  Oh, you weren't talking ASCII? :-) Larry now uses "Perl" to
+One bit. Oh, you weren't talking ASCII? :-) Larry now uses "Perl" to
 signify the language proper and "perl" the implementation of it, i.e.
-the current interpreter.  Hence Tom's quip that "Nothing but perl can
+the current interpreter. Hence Tom's quip that "Nothing but perl can
 parse Perl."
 
 Before the first edition of I<Programming perl>, people commonly
@@ -295,26 +295,26 @@
 second edition became I<Programming Perl>, using the capitalized
 version of the name to refer to the language.
 
-You may or may not choose to follow this usage.  For example,
+You may or may not choose to follow this usage. For example,
 parallelism means "awk and perl" and "Python and Perl" look good, while
-"awk and Perl" and "Python and perl" do not.  But never write "PERL",
+"awk and Perl" and "Python and perl" do not. But never write "PERL",
 because perl is not an acronym, apocryphal folklore and post-facto
 expansions notwithstanding.
 
 =head2 Is it a Perl program or a Perl script?
 
-Larry doesn't really care.  He says (half in jest) that "a script is
-what you give the actors.  A program is what you give the audience."
+Larry doesn't really care. He says (half in jest) that "a script is
+what you give the actors. A program is what you give the audience."
 
 Originally, a script was a canned sequence of normally interactive
-commands--that is, a chat script.  Something like a UUCP or PPP chat
+commands--that is, a chat script. Something like a UUCP or PPP chat
 script or an expect script fits the bill nicely, as do configuration
 scripts run by a program at its start up, such F<.cshrc> or F<.ircrc>,
-for example.  Chat scripts were just drivers for existing programs,
+for example. Chat scripts were just drivers for existing programs,
 not stand-alone programs in their own right.
 
 A computer scientist will correctly explain that all programs are
-interpreted and that the only question is at what level.  But if you
+interpreted and that the only question is at what level. But if you
 ask this question of someone who isn't a computer scientist, they might
 tell you that a I<program> has been compiled to physical machine code
 once and can then be run multiple times, whereas a I<script> must be
@@ -323,7 +323,7 @@
 Now that "script" and "scripting" are terms that have been seized by
 unscrupulous or unknowing marketeers for their own nefarious purposes,
 they have begun to take on strange and often pejorative meanings,
-like "non serious" or "not real programming".  Consequently, some Perl
+like "non serious" or "not real programming". Consequently, some Perl
 programmers prefer to avoid them altogether.
 
 =head2 What is a JAPH?
@@ -395,24 +395,16 @@
 
 =back
 
-=head1 REVISION
-
-Revision: $Revision$
-
-Date: $Date$
-
-See L<perlfaq> for source control details and availability.
-
 =head1 AUTHOR AND COPYRIGHT
 
-Copyright (c) 1997-2009 Tom Christiansen, Nathan Torkington, and
+Copyright (c) 1997-2010 Tom Christiansen, Nathan Torkington, and
 other authors as noted. All rights reserved.
 
 This documentation is free; you can redistribute it and/or modify it
 under the same terms as Perl itself.
 
 Irrespective of its distribution, all code examples here are in the public
-domain.  You are permitted and encouraged to use this code and any
+domain. You are permitted and encouraged to use this code and any
 derivatives thereof in your own programs for fun or for profit as you
-see fit.  A simple comment in the code giving credit to the FAQ would
+see fit. A simple comment in the code giving credit to the FAQ would
 be courteous but is not required.
Index: src/gnu/usr.bin/perl/pod/perlfaq2.pod
diff -u src/gnu/usr.bin/perl/pod/perlfaq2.pod:1.11 src/gnu/usr.bin/perl/pod/perlfaq2.pod:1.12
--- pod/perlfaq2.pod:1.11	Mon Oct 12 18:24:47 2009
+++ pod/perlfaq2.pod	Fri Sep 24 15:07:03 2010
@@ -44,7 +44,7 @@
 Strawberry Perl: Windows, Perl 5.8.8 and 5.10.0
 
 	http://www.strawberryperl.com
-	
+
 IndigoPerl: Windows
 
 	http://indigostar.com/
@@ -54,7 +54,7 @@
 Since you don't have a C compiler, you're doomed and your vendor
 should be sacrificed to the Sun gods.  But that doesn't help you.
 
-What you need to do is get a binary version of gcc for your system
+What you need to do is get a binary version of C<gcc> for your system
 first.  Consult the Usenet FAQs for your operating system for
 information on where to get such a binary version.
 
@@ -77,13 +77,13 @@
 approaches are doomed to failure.
 
 One simple way to check that things are in the right place is to print out
-the hard-coded @INC that perl looks through for libraries:
+the hard-coded C<@INC> that perl looks through for libraries:
 
     % perl -le 'print for @INC'
 
 If this command lists any paths that don't exist on your system, then you
 may need to move the appropriate libraries to these locations, or create
-symbolic links, aliases, or shortcuts appropriately.  @INC is also printed as
+symbolic links, aliases, or shortcuts appropriately.  C<@INC> is also printed as
 part of the output of
 
     % perl -V
@@ -95,7 +95,7 @@
 
 Read the F<INSTALL> file, which is part of the source distribution.
 It describes in detail how to cope with most idiosyncrasies that the
-Configure script can't work around for any given system or
+C<Configure> script can't work around for any given system or
 architecture.
 
 =head2 What modules and extensions are available for Perl?  What is CPAN?  What does CPAN/src/... mean?
@@ -116,16 +116,16 @@
 to the most frequently asked questions about CPAN including how to
 become a mirror.
 
-CPAN/path/... is a naming convention for files available on CPAN
+C<CPAN/path/...> is a naming convention for files available on CPAN
 sites.  CPAN indicates the base directory of a CPAN mirror, and the
 rest of the path is the path from that directory to the file. For
 instance, if you're using ftp://ftp.funet.fi/pub/languages/perl/CPAN
-as your CPAN site, the file CPAN/misc/japh is downloadable as
+as your CPAN site, the file C<CPAN/misc/japh> is downloadable as
 ftp://ftp.funet.fi/pub/languages/perl/CPAN/misc/japh .
 
 Considering that, as of 2006, there are over ten thousand existing
 modules in the archive, one probably exists to do nearly anything you
-can think of. Current categories under CPAN/modules/by-category/
+can think of. Current categories under C<CPAN/modules/by-category/>
 include Perl core modules; development support; operating system
 interfaces; networking, devices, and interprocess communication; data
 type utilities; database interfaces; user interfaces; interfaces to
@@ -151,13 +151,13 @@
 If you have Perl installed locally, you probably have the documentation
 installed as well: type C<man perl> if you're on a system resembling Unix.
 This will lead you to other important man pages, including how to set your
-$MANPATH.  If you're not on a Unix system, access to the documentation
+C<$MANPATH>.  If you're not on a Unix system, access to the documentation
 will be different; for example, documentation might only be in HTML format.  All
 proper perl installations have fully-accessible documentation.
 
 You might also try C<perldoc perl> in case your system doesn't
-have a proper man command, or it's been misinstalled.  If that doesn't
-work, try looking in /usr/local/lib/perl5/pod for documentation.
+have a proper C<man> command, or it's been misinstalled.  If that doesn't
+work, try looking in C</usr/local/lib/perl5/pod> for documentation.
 
 If all else fails, consult http://perldoc.perl.org/ which has the
 complete documentation in HTML and PDF format.
@@ -217,7 +217,7 @@
 see their FAQ ( http://www.faqs.org/faqs/alt-sources-intro/ ) for details.
 
 If you're just looking for software, first use Google
-( http://www.google.com ), Google's usenet search interface
+( http://www.google.com ), Google's Usenet search interface
 ( http://groups.google.com ),  and CPAN Search ( http://search.cpan.org ).
 This is faster and more productive than just posting a request.
 
@@ -323,7 +323,7 @@
 
 	Writing Perl Modules for CPAN
 	by Sam Tregar
-	ISBN 1-59059-018-X [1st edition Aug 2002]
+	ISBN 1-59059-018-X [1st edition August 2002]
 	http://apress.com/book/bookDisplay.html?bID=14
 
 	The Perl Cookbook
@@ -370,13 +370,13 @@
 	http://www.awlonline.com/
 
 	Object Oriented Perl
-	Damian Conway
+	by Damian Conway
 	    with foreword by Randal L. Schwartz
 	ISBN 1-884777-79-1 [1st edition August 1999]
 	http://www.manning.com/conway/
 
 	Data Munging with Perl
-	Dave Cross
+	by Dave Cross
 	ISBN 1-930110-00-6 [1st edition 2001]
 	http://www.manning.com/cross
 
@@ -409,11 +409,14 @@
 another language). There's also I<$foo Magazin>, a german magazine
 dedicated to Perl, at ( http://www.foo-magazin.de ).
 
+The I<Perl-Zeitung> is a German-speaking magazine for Perl beginners
+(see http://perl-zeitung.at.tf ).
+
 Magazines that frequently carry quality articles on Perl include I<The
 Perl Review> ( http://www.theperlreview.com ), I<Unix Review> (
 http://www.unixreview.com/ ), I<Linux Magazine> (
 http://www.linuxmagazine.com/ ), and Usenix's newsletter/magazine to
-its members, I<login:> ( http://www.usenix.org/ )
+its members, I<login:> ( http://www.usenix.org/ ).
 
 The Perl columns of Randal L. Schwartz are available on the web at
 http://www.stonehenge.com/merlyn/WebTechniques/ ,
@@ -425,15 +428,15 @@
 studies, announcements, contests, and much more.  I<TPJ> has columns
 on web development, databases, Win32 Perl, graphical programming,
 regular expressions, and networking, and sponsors the Obfuscated Perl
-Contest and the Perl Poetry Contests.  Beginning in November 2002, TPJ
+Contest and the Perl Poetry Contests.  Beginning in November 2002, I<TPJ>
 moved to a reader-supported monthly e-zine format in which subscribers
-can download issues as PDF documents. In 2006, TPJ merged with Dr.
-Dobbs Journal (online edition). To read old TPJ articles, see
+can download issues as PDF documents. In 2006, I<TPJ> merged with Dr.
+Dobbs Journal (online edition). To read old I<TPJ> articles, see
 http://www.ddj.com/ .
 
 =head2 What mailing lists are there for Perl?
 
-Most of the major modules (Tk, CGI, libwww-perl) have their own
+Most of the major modules (C<Tk>, C<CGI>, C<libwww-perl>) have their own
 mailing lists.  Consult the documentation that came with the module for
 subscription information.
 
@@ -491,6 +494,9 @@
 use the C<Module::CoreList> module. It has the information about
 the modules (with their versions) included with each release of Perl.
 
+If C<Module::CoreList> is not installed on your system, check out
+http://perlpunks.de/corelist .
+
 Every CPAN module has a bug tracker set up in RT, http://rt.cpan.org .
 You can submit bugs to RT either through its web interface or by
 email. To email a bug report, send it to
@@ -529,17 +535,9 @@
 a replicated worldwide repository of Perl software, see
 the I<What is CPAN?> question earlier in this document.
 
-=head1 REVISION
-
-Revision: $Revision$
-
-Date: $Date$
-
-See L<perlfaq> for source control details and availability.
-
 =head1 AUTHOR AND COPYRIGHT
 
-Copyright (c) 1997-2009 Tom Christiansen, Nathan Torkington, and
+Copyright (c) 1997-2010 Tom Christiansen, Nathan Torkington, and
 other authors as noted. All rights reserved.
 
 This documentation is free; you can redistribute it and/or modify it
Index: src/gnu/usr.bin/perl/pod/perlfaq3.pod
diff -u src/gnu/usr.bin/perl/pod/perlfaq3.pod:1.11 src/gnu/usr.bin/perl/pod/perlfaq3.pod:1.12
--- pod/perlfaq3.pod:1.11	Mon Oct 12 18:24:47 2009
+++ pod/perlfaq3.pod	Fri Sep 24 15:07:03 2010
@@ -31,7 +31,7 @@
 =head2 How can I use Perl interactively?
 
 The typical approach uses the Perl debugger, described in the
-perldebug(1) manpage, on an "empty" program, like this:
+C<perldebug(1)> manpage, on an "empty" program, like this:
 
     perl -de 42
 
@@ -42,21 +42,21 @@
 
 =head2 Is there a Perl shell?
 
-The psh (Perl sh) is currently at version 1.8. The Perl Shell is a shell
+The C<psh> (Perl sh) is currently at version 1.8. The Perl Shell is a shell
 that combines the interactive nature of a Unix shell with the power of
 Perl. The goal is a full featured shell that behaves as expected for
 normal shell activity and uses Perl syntax and functionality for
-control-flow statements and other things. You can get psh at
+control-flow statements and other things. You can get C<psh> at
 http://sourceforge.net/projects/psh/ .
 
-Zoidberg is a similar project and provides a shell written in perl,
+C<Zoidberg> is a similar project and provides a shell written in perl,
 configured in perl and operated in perl. It is intended as a login shell
 and development environment. It can be found at
 http://pardus-larus.student.utwente.nl/~pardus/projects/zoidberg/
 or your local CPAN mirror.
 
-The Shell.pm module (distributed with Perl) makes Perl try commands
-which aren't part of the Perl language as shell commands.  perlsh from
+The C<Shell.pm> module (distributed with Perl) makes Perl try commands
+which aren't part of the Perl language as shell commands.  C<perlsh> from
 the source distribution is simplistic and uninteresting, but may still
 be what you want.
 
@@ -67,14 +67,14 @@
 	$ cpan -l
 
 You can also use C<cpan>'s C<-a> switch to create an autobundle file
-that C<CPAN.pm> understands and cna use to re-install every module:
+that C<CPAN.pm> understands and can use to re-install every module:
 
 	$ cpan -a
 
-Inside a Perl program, you can use the ExtUtils::Installed module to
+Inside a Perl program, you can use the C<ExtUtils::Installed> module to
 show all installed distributions, although it can take awhile to do
 its magic.  The standard library which comes with Perl just shows up
-as "Perl" (although you can get those with Module::CoreList).
+as "Perl" (although you can get those with C<Module::CoreList>).
 
 	use ExtUtils::Installed;
 
@@ -82,7 +82,7 @@
 	my @modules = $inst->modules();
 
 If you want a list of all of the Perl module filenames, you
-can use File::Find::Rule.
+can use C<File::Find::Rule>:
 
 	use File::Find::Rule;
 
@@ -94,7 +94,7 @@
 		;
 
 If you do not have that module, you can do the same thing
-with File::Find which is part of the standard library.
+with C<File::Find> which is part of the standard library:
 
 	use File::Find;
 	my @files;
@@ -117,12 +117,12 @@
 available, you can check for its documentation.  If you can
 read the documentation the module is most likely installed.
 If you cannot read the documentation, the module might not
-have any (in rare cases).
+have any (in rare cases):
 
 	$ perldoc Module::Name
 
 You can also try to include the module in a one-liner to see if
-perl finds it.
+perl finds it:
 
 	$ perl -MModule::Name -e1
 
@@ -153,11 +153,11 @@
 Perl comes with an interactive debugger, which you can start with the
 C<-d> switch. It's fully explained in L<perldebug>.
 
-If you'd like a graphical user interface and you have Tk, you can use
+If you'd like a graphical user interface and you have C<Tk>, you can use
 C<ptkdb>. It's on CPAN and available for free.
 
 If you need something much more sophisticated and controllable, Leon
-Brocard's Devel::ebug (which you can call with the -D switch as -Debug)
+Brocard's C<Devel::ebug> (which you can call with the C<-D> switch as C<-Debug>)
 gives you the programmatic hooks into everything you need to write your
 own (without too much pain and suffering).
 
@@ -182,7 +182,7 @@
 	dprofpp
 
 You can also do the profiling and reporting in one step with the C<-p>
-switch to <dprofpp>:
+switch to C<dprofpp>:
 
 	dprofpp -p program.pl
 
@@ -224,18 +224,18 @@
 
 =head2 How do I cross-reference my Perl programs?
 
-The B::Xref module can be used to generate cross-reference reports
+The C<B::Xref> module can be used to generate cross-reference reports
 for Perl programs.
 
     perl -MO=Xref[,OPTIONS] scriptname.plx
 
 =head2 Is there a pretty-printer (formatter) for Perl?
 
-Perltidy is a Perl script which indents and reformats Perl scripts
+C<Perltidy> is a Perl script which indents and reformats Perl scripts
 to make them easier to read by trying to follow the rules of the
 L<perlstyle>. If you write Perl scripts, or spend much time reading
 them, you will probably find it useful.  It is available at
-http://perltidy.sourceforge.net
+http://perltidy.sourceforge.net .
 
 Of course, if you simply follow the guidelines in L<perlstyle>,
 you shouldn't need to reformat.  The habit of formatting your code
@@ -275,7 +275,7 @@
 
 Perl programs are just plain text, so any editor will do.
 
-If you're on Unix, you already have an IDE--Unix itself.  The UNIX
+If you're on Unix, you already have an IDE--Unix itself.  The Unix
 philosophy is the philosophy of several small tools that each do one
 thing and do it well.  It's like a carpenter's toolbox.
 
@@ -307,6 +307,10 @@
 and Solaris), multi-language IDE has Perl support, including a regular expression
 debugger and remote debugging.
 
+=item Notepad++
+
+http://notepad-plus.sourceforge.net/
+
 =item Open Perl IDE
 
 http://open-perl-ide.sourceforge.net/
@@ -326,9 +330,8 @@
 
 http://padre.perlide.org/
 
-Padre is cross-platform IDE for Perl written in Perl using the the wxWidgets
-to provide a native look and feel. It's open source under the Artistic
-License.
+Padre is cross-platform IDE for Perl written in Perl using wxWidgets to provide
+a native look and feel. It's open source under the Artistic License.
 
 =item PerlBuilder
 
@@ -364,7 +367,7 @@
 perhaps the best available Perl editing mode in any editor.
 
 If you are using Windows, you can use any editor that lets you work
-with plain text, such as NotePad or WordPad.  Word processors, such as
+with plain text, such as NotePad or WordPad. Word processors, such as
 Microsoft Word or WordPerfect, typically do not work since they insert
 all sorts of behind-the-scenes information, although some allow you to
 save files as "Text Only". You can also download text editors designed
@@ -372,7 +375,7 @@
 http://www.textpad.com/ ) and UltraEdit ( http://www.ultraedit.com/ ),
 among others.
 
-If you are using MacOS, the same concerns apply.  MacPerl (for Classic
+If you are using MacOS, the same concerns apply. MacPerl (for Classic
 environments) comes with a simple editor. Popular external editors are
 BBEdit ( http://www.bbedit.com/ ) or Alpha (
 http://www.his.com/~jguyer/Alpha/Alpha8.html ). MacOS X users can use
@@ -422,7 +425,7 @@
 
 nvi ( http://www.bostic.com/vi/ , available from CPAN in src/misc/) is
 yet another vi clone, unfortunately not available for Windows, but in
-UNIX platforms you might be interested in trying it out, firstly because
+Unix platforms you might be interested in trying it out, firstly because
 strictly speaking it is not a vi clone, it is the real vi, or the new
 incarnation of it, and secondly because you can embed Perl inside it
 to use Perl as the scripting language.  nvi is not alone in this,
@@ -486,7 +489,7 @@
 research purposes), Cygwin is covered by the GNU General Public
 License (but that shouldn't matter for Perl use).  The Cygwin, MKS,
 and U/WIN all contain (in addition to the shells) a comprehensive set
-of standard UNIX toolkit utilities.
+of standard Unix toolkit utilities.
 
 If you're transferring text files between Unix and Windows using FTP
 be sure to transfer them in ASCII mode so the ends of lines are
@@ -515,7 +518,6 @@
 are text editors for Mac OS that have a Perl sensitivity mode
 ( http://web.barebones.com/ ).
 
-
 =back
 
 =head2 Where can I get Perl macros for vi?
@@ -526,21 +528,20 @@
 the current version of vi out of Berkeley, which incidentally can be built
 with an embedded Perl interpreter--see http://www.cpan.org/src/misc/ .
 
-=head2 Where can I get perl-mode for emacs?
+=head2 Where can I get perl-mode or cperl-mode for emacs?
+X<emacs>
 
 Since Emacs version 19 patchlevel 22 or so, there have been both a
 perl-mode.el and support for the Perl debugger built in.  These should
 come with the standard Emacs 19 distribution.
 
-In the Perl source directory, you'll find a directory called "emacs",
-which contains a cperl-mode that color-codes keywords, provides
-context-sensitive help, and other nifty things.
-
 Note that the perl-mode of emacs will have fits with C<"main'foo">
 (single quote), and mess up the indentation and highlighting.  You
 are probably using C<"main::foo"> in new Perl code anyway, so this
 shouldn't be an issue.
 
+For CPerlMode, see http://www.emacswiki.org/cgi-bin/wiki/CPerlMode
+
 =head2 How can I use curses with Perl?
 
 The Curses module from CPAN provides a dynamically loadable object
@@ -734,21 +735,21 @@
 
 Ditto for stringifying large arrays:
 
-        {
-                local $, = "\n";
-                print @big_array;
-        }
+	{
+	local $, = "\n";
+	print @big_array;
+	}
 
 is much more memory-efficient than either
 
-        print join "\n", @big_array;
+	print join "\n", @big_array;
 
 or
 
-        {
-                local $" = "\n";
-                print "@big_array";
-        }
+	{
+	local $" = "\n";
+	print "@big_array";
+	}
 
 
 =item * Pass by reference
@@ -910,7 +911,7 @@
 
 Perl2Exe ( http://www.indigostar.com/perl2exe.htm ) is a command line
 program for converting perl scripts to executable files.  It targets both
-Windows and unix platforms.
+Windows and Unix platforms.
 
 =head2 How can I get C<#!perl> to work on [MS-DOS,NT,...]?
 
@@ -1078,20 +1079,12 @@
 
 The C<ExtUtils::MakeMaker> module, better known simply as "MakeMaker",
 turns a Perl script, typically called C<Makefile.PL>, into a Makefile.
-The unix tool C<make> uses this file to manage dependencies and actions
+The Unix tool C<make> uses this file to manage dependencies and actions
 to process and install a Perl distribution.
 
-=head1 REVISION
-
-Revision: $Revision$
-
-Date: $Date$
-
-See L<perlfaq> for source control details and availability.
-
 =head1 AUTHOR AND COPYRIGHT
 
-Copyright (c) 1997-2009 Tom Christiansen, Nathan Torkington, and
+Copyright (c) 1997-2010 Tom Christiansen, Nathan Torkington, and
 other authors as noted. All rights reserved.
 
 This documentation is free; you can redistribute it and/or modify it
Index: src/gnu/usr.bin/perl/pod/perlfaq4.pod
diff -u src/gnu/usr.bin/perl/pod/perlfaq4.pod:1.11 src/gnu/usr.bin/perl/pod/perlfaq4.pod:1.12
--- pod/perlfaq4.pod:1.11	Mon Oct 12 18:24:47 2009
+++ pod/perlfaq4.pod	Fri Sep 24 15:07:03 2010
@@ -11,6 +11,10 @@
 
 =head2 Why am I getting long decimals (eg, 19.9499999999999) instead of the numbers I should be getting (eg, 19.95)?
 
+For the long explanation, see David Goldberg's "What Every Computer
+Scientist Should Know About Floating-Point Arithmetic"
+(http://docs.sun.com/source/806-3568/ncg_goldberg.html).
+
 Internally, your computer represents floating-point numbers in binary.
 Digital (as in powers of two) computers cannot store all numbers
 exactly.  Some real numbers lose precision in the process.  This is a
@@ -21,7 +25,7 @@
 conversions.
 
 To limit the number of decimal places in your numbers, you can use the
-printf or sprintf function.  See the L<"Floating Point
+C<printf> or C<sprintf> function.  See the L<"Floating Point
 Arithmetic"|perlop> for more details.
 
 	printf "%.2f", 10/3;
@@ -62,7 +66,7 @@
 	print $string + 44; # prints 688, certainly not octal!
 
 This problem usually involves one of the Perl built-ins that has the
-same name a unix command that uses octal numbers as arguments on the
+same name a Unix command that uses octal numbers as arguments on the
 command line. In this example, C<chmod> on the command line knows that
 its first argument is octal because that's what it does:
 
@@ -297,8 +301,8 @@
 
 =head2 How do I multiply matrices?
 
-Use the Math::Matrix or Math::MatrixReal modules (available from CPAN)
-or the PDL extension (also available from CPAN).
+Use the C<Math::Matrix> or C<Math::MatrixReal> modules (available from CPAN)
+or the C<PDL> extension (also available from CPAN).
 
 =head2 How do I perform an operation on a series of integers?
 
@@ -342,7 +346,7 @@
 
 =head2 How can I output Roman numerals?
 
-Get the http://www.cpan.org/modules/by-module/Roman module.
+Get the L<http://www.cpan.org/modules/by-module/Roman> module.
 
 =head2 Why aren't my random numbers random?
 
@@ -358,7 +362,7 @@
 Computers are good at being predictable and bad at being random
 (despite appearances caused by bugs in your programs :-).  see the
 F<random> article in the "Far More Than You Ever Wanted To Know"
-collection in http://www.cpan.org/misc/olddoc/FMTEYEWTK.tgz , courtesy
+collection in L<http://www.cpan.org/misc/olddoc/FMTEYEWTK.tgz>, courtesy
 of Tom Phoenix, talks more about this.  John von Neumann said, "Anyone
 who attempts to generate random numbers by deterministic means is, of
 course, living in a state of sin."
@@ -368,7 +372,7 @@
 CPAN.  It uses the imperfections in your system's timer to generate
 random numbers, but this takes quite a while.  If you want a better
 pseudorandom generator than comes with your operating system, look at
-"Numerical Recipes in C" at http://www.nr.com/ .
+"Numerical Recipes in C" at L<http://www.nr.com/>.
 
 =head2 How do I get a random number between X and Y?
 
@@ -401,8 +405,8 @@
 
 =head2 How do I find the day or week of the year?
 
-The localtime function returns the day of the year.  Without an
-argument localtime uses the current time.
+The C<localtime> function returns the day of the year.  Without an
+argument C<localtime> uses the current time.
 
 	$day_of_year = (localtime)[7];
 
@@ -414,7 +418,7 @@
 	my $week_of_year = strftime "%W", localtime;
 
 To get the day of year for any date, use C<POSIX>'s C<mktime> to get
-a time in epoch seconds for the argument to localtime.
+a time in epoch seconds for the argument to C<localtime>.
 
 	use POSIX qw/mktime strftime/;
 	my $week_of_year = strftime "%W",
@@ -533,35 +537,30 @@
 noon. Since you don't care about the time, the one hour difference
 doesn't matter and you end up with the previous date.
 
-=head2 Does Perl have a Year 2000 problem? Is Perl Y2K compliant?
+=head2 Does Perl have a Year 2000 or 2038 problem? Is Perl Y2K compliant?
+
+(contributed by brian d foy)
+
+Perl itself never had a Y2K problem, although that never stopped people
+from creating Y2K problems on their own. See the documentation for
+C<localtime> for its proper use.
+
+Starting with Perl 5.11, C<localtime> and C<gmtime> can handle dates past
+03:14:08 January 19, 2038, when a 32-bit based time would overflow. You
+still might get a warning on a 32-bit C<perl>:
+
+	% perl5.11.2 -E 'say scalar localtime( 0x9FFF_FFFFFFFF )'
+	Integer overflow in hexadecimal number at -e line 1.
+	Wed Nov  1 19:42:39 5576711
+
+On a 64-bit C<perl>, you can get even larger dates for those really long
+running projects:
 
-Short answer: No, Perl does not have a Year 2000 problem.  Yes, Perl is
-Y2K compliant (whatever that means). The programmers you've hired to
-use it, however, probably are not.
-
-Long answer: The question belies a true understanding of the issue.
-Perl is just as Y2K compliant as your pencil--no more, and no less.
-Can you use your pencil to write a non-Y2K-compliant memo?  Of course
-you can.  Is that the pencil's fault?  Of course it isn't.
-
-The date and time functions supplied with Perl (gmtime and localtime)
-supply adequate information to determine the year well beyond 2000
-(2038 is when trouble strikes for 32-bit machines).  The year returned
-by these functions when used in a list context is the year minus 1900.
-For years between 1910 and 1999 this I<happens> to be a 2-digit decimal
-number. To avoid the year 2000 problem simply do not treat the year as
-a 2-digit number.  It isn't.
-
-When gmtime() and localtime() are used in scalar context they return
-a timestamp string that contains a fully-expanded year.  For example,
-C<$timestamp = gmtime(1005613200)> sets $timestamp to "Tue Nov 13 01:00:00
-2001".  There's no year 2000 problem here.
-
-That doesn't mean that Perl can't be used to create non-Y2K compliant
-programs.  It can.  But so can your pencil.  It's the fault of the user,
-not the language.  At the risk of inflaming the NRA: "Perl doesn't
-break Y2K, people do."  See http://www.perl.org/about/y2k.html for
-a longer exposition.
+	% perl5.11.2 -E 'say scalar gmtime( 0x9FFF_FFFFFFFF )'
+	Thu Nov  2 00:42:39 5576711
+
+You're still out of luck if you need to keep tracking of decaying protons
+though.
 
 =head1 Data: Strings
 
@@ -809,15 +808,6 @@
 
 	$count = () = $string =~ /-\d+/g;
 
-=head2 Does Perl have a Year 2038 problem?
-
-No, all of Perl's built in date and time functions and modules will
-work to about 2 billion years before and after 1970.
-
-Many systems cannot count time past the year 2038.  Older versions of
-Perl were dependent on the system to do date calculation and thus
-shared their 2038 bug.
-
 =head2 How do I capitalize all the words on one line?
 X<Text::Autoformat> X<capitalize> X<case, title> X<case, sentence>
 
@@ -992,7 +982,7 @@
 
 (contributed by brian d foy)
 
-If you know where the columns that contain the data, you can
+If you know the columns that contain the data, you can
 use C<substr> to extract a single column.
 
 	my $column = substr( $line, $start_column, $length );
@@ -1015,7 +1005,7 @@
 C<Text::CSV_PP>.
 
 If you want to break apart an entire line of fixed columns, you can use
-C<unpack> with the A (ASCII) format. by using a number after the format
+C<unpack> with the A (ASCII) format. By using a number after the format
 specifier, you can denote the column width. See the C<pack> and C<unpack>
 entries in L<perlfunc> for more details.
 
@@ -1211,43 +1201,115 @@
 
 =head2 What is the difference between a list and an array?
 
-An array has a changeable length.  A list does not.  An array is
-something you can push or pop, while a list is a set of values.  Some
-people make the distinction that a list is a value while an array is a
-variable. Subroutines are passed and return lists, you put things into
-list context, you initialize arrays with lists, and you C<foreach()>
-across a list.  C<@> variables are arrays, anonymous arrays are
-arrays, arrays in scalar context behave like the number of elements in
-them, subroutines access their arguments through the array C<@_>, and
-C<push>/C<pop>/C<shift> only work on arrays.
-
-As a side note, there's no such thing as a list in scalar context.
-When you say
-
-	$scalar = (2, 5, 7, 9);
-
-you're using the comma operator in scalar context, so it uses the scalar
-comma operator.  There never was a list there at all! This causes the
-last value to be returned: 9.
+(contributed by brian d foy)
 
-=head2 What is the difference between $array[1] and @array[1]?
+A list is a fixed collection of scalars. An array is a variable that
+holds a variable collection of scalars. An array can supply its collection
+for list operations, so list operations also work on arrays:
+
+	# slices
+	( 'dog', 'cat', 'bird' )[2,3];
+	@animals[2,3];
+
+	# iteration
+	foreach ( qw( dog cat bird ) ) { ... }
+	foreach ( @animals ) { ... }
+
+	my @three = grep { length == 3 } qw( dog cat bird );
+	my @three = grep { length == 3 } @animals;
+
+	# supply an argument list
+	wash_animals( qw( dog cat bird ) );
+	wash_animals( @animals );
+
+Array operations, which change the scalars, reaaranges them, or adds
+or subtracts some scalars, only work on arrays. These can't work on a
+list, which is fixed. Array operations include C<shift>, C<unshift>,
+C<push>, C<pop>, and C<splice>.
+
+An array can also change its length:
+
+	$#animals = 1;  # truncate to two elements
+	$#animals = 10000; # pre-extend to 10,001 elements
+
+You can change an array element, but you can't change a list element:
 
-The former is a scalar value; the latter an array slice, making
-it a list with one (scalar) value.  You should use $ when you want a
-scalar value (most of the time) and @ when you want a list with one
-scalar value in it (very, very rarely; nearly never, in fact).
+	$animals[0] = 'Rottweiler';
+	qw( dog cat bird )[0] = 'Rottweiler'; # syntax error!
 
-Sometimes it doesn't make a difference, but sometimes it does.
-For example, compare:
+	foreach ( @animals ) {
+		s/^d/fr/;  # works fine
+		}
+
+	foreach ( qw( dog cat bird ) ) {
+		s/^d/fr/;  # Error! Modification of read only value!
+		}
+
+However, if the list element is itself a variable, it appears that you
+can change a list element. However, the list element is the variable, not
+the data. You're not changing the list element, but something the list
+element refers to. The list element itself doesn't change: it's still
+the same variable.
+
+You also have to be careful about context. You can assign an array to
+a scalar to get the number of elements in the array. This only works
+for arrays, though:
 
-	$good[0] = `some program that outputs several lines`;
+	my $count = @animals;  # only works with arrays
 
-with
+If you try to do the same thing with what you think is a list, you
+get a quite different result. Although it looks like you have a list
+on the righthand side, Perl actually sees a bunch of scalars separated
+by a comma:
 
-	@bad[0]  = `same program that outputs several lines`;
+	my $scalar = ( 'dog', 'cat', 'bird' );  # $scalar gets bird
 
-The C<use warnings> pragma and the B<-w> flag will warn you about these
-matters.
+Since you're assigning to a scalar, the righthand side is in scalar
+context. The comma operator (yes, it's an operator!) in scalar
+context evaluates its lefthand side, throws away the result, and
+evaluates it's righthand side and returns the result. In effect,
+that list-lookalike assigns to C<$scalar> it's rightmost value. Many
+people mess this up becuase they choose a list-lookalike whose
+last element is also the count they expect:
+
+	my $scalar = ( 1, 2, 3 );  # $scalar gets 3, accidentally
+
+=head2 What is the difference between $array[1] and @array[1]?
+
+(contributed by brian d foy)
+
+The difference is the sigil, that special character in front of the
+array name. The C<$> sigil means "exactly one item", while the C<@>
+sigil means "zero or more items". The C<$> gets you a single scalar,
+while the C<@> gets you a list.
+
+The confusion arises because people incorrectly assume that the sigil
+denotes the variable type.
+
+The C<$array[1]> is a single-element access to the array. It's going
+to return the item in index 1 (or undef if there is no item there).
+If you intend to get exactly one element from the array, this is the
+form you should use.
+
+The C<@array[1]> is an array slice, although it has only one index.
+You can pull out multiple elements simultaneously by specifying
+additional indices as a list, like C<@array[1,4,3,0]>.
+
+Using a slice on the lefthand side of the assignment supplies list
+context to the righthand side. This can lead to unexpected results.
+For instance, if you want to read a single line from a filehandle,
+assigning to a scalar value is fine:
+
+	$array[1] = <STDIN>;
+
+However, in list context, the line input operator returns all of the
+lines as a list. The first line goes into C<@array[1]> and the rest
+of the lines mysteriously disappear:
+
+	@array[1] = <STDIN>;  # most likely not what you want
+
+Either the C<use warnings> pragma or the B<-w> flag will warn you when
+you use an array slice with a single index.
 
 =head2 How can I remove duplicate elements from a list or array?
 
@@ -1554,7 +1616,7 @@
 
 (contributed by brian d foy)
 
-If you want to cycle through an array endlessy, you can increment the
+If you want to cycle through an array endlessly, you can increment the
 index modulo the number of elements in the array:
 
 	my @array = qw( a b c );
@@ -2075,9 +2137,9 @@
 have many entries you have in a hash:
 
 	my $key_count = keys %hash; # must be scalar context!
-	
+
 If you want to find out how many entries have a defined value, that's
-a bit different. You have to check each value. A C<grep> is handy: 
+a bit different. You have to check each value. A C<grep> is handy:
 
 	my $defined_value_count = grep { defined } values %hash;
 
@@ -2086,7 +2148,7 @@
 you just test for that instead:
 
 	my $vowel_count = grep { /[aeiou]/ } keys %hash;
-	
+
 The C<grep> in scalar context returns the count. If you want the list
 of matching items, just use it in list context instead:
 
@@ -2165,7 +2227,7 @@
 will return true.  This corresponds to (C<$key>, C<undef>)
 being in the hash.
 
-Pictures help...  here's the C<%hash> table:
+Pictures help...  Here's the C<%hash> table:
 
 	  keys  values
 	+------+------+
@@ -2511,17 +2573,9 @@
 
 See L<http://search.cpan.org/dist/PGPLOT> for the code.
 
-=head1 REVISION
-
-Revision: $Revision$
-
-Date: $Date$
-
-See L<perlfaq> for source control details and availability.
-
 =head1 AUTHOR AND COPYRIGHT
 
-Copyright (c) 1997-2009 Tom Christiansen, Nathan Torkington, and
+Copyright (c) 1997-2010 Tom Christiansen, Nathan Torkington, and
 other authors as noted. All rights reserved.
 
 This documentation is free; you can redistribute it and/or modify it
Index: src/gnu/usr.bin/perl/pod/perlfaq5.pod
diff -u src/gnu/usr.bin/perl/pod/perlfaq5.pod:1.11 src/gnu/usr.bin/perl/pod/perlfaq5.pod:1.12
--- pod/perlfaq5.pod:1.11	Mon Oct 12 18:24:47 2009
+++ pod/perlfaq5.pod	Fri Sep 24 15:07:03 2010
@@ -196,7 +196,7 @@
 		}
 
 If, for some odd reason, you really want to see the whole file at once
-rather than processing line by line, you can slurp it in (as long as
+rather than processing line-by-line, you can slurp it in (as long as
 you can fit the whole thing in memory!):
 
 	open my $in,  '<',  $file      or die "Can't read old file: $!"
@@ -261,27 +261,117 @@
 =head2 How do I count the number of lines in a file?
 X<file, counting lines> X<lines> X<line>
 
-One fairly efficient way is to count newlines in the file. The
-following program uses a feature of tr///, as documented in L<perlop>.
-If your text file doesn't end with a newline, then it's not really a
-proper text file, so this may report one fewer line than you expect.
-
-	$lines = 0;
-	open(FILE, $filename) or die "Can't open `$filename': $!";
-	while (sysread FILE, $buffer, 4096) {
-		$lines += ($buffer =~ tr/\n//);
+(contributed by brian d foy)
+
+Conceptually, the easiest way to count the lines in a file is to
+simply read them and count them:
+
+	my $count = 0;
+	while( <$fh> ) { $count++; }
+
+You don't really have to count them yourself, though, since Perl
+already does that with the C<$.> variable, which is the current line
+number from the last filehandle read:
+
+	1 while( <$fh> );
+	my $count = $.;
+
+If you want to use C<$.>, you can reduce it to a simple one-liner,
+like one of these:
+
+	% perl -lne '} print $.; {'    file
+
+	% perl -lne 'END { print $. }' file
+
+Those can be rather inefficient though. If they aren't fast enough for
+you, you might just read chunks of data and count the number of
+newlines:
+
+	my $lines = 0;
+	open my($fh), '<:raw', $filename or die "Can't open $filename: $!";
+	while( sysread $fh, $buffer, 4096 ) {
+		$lines += ( $buffer =~ tr/\n// );
+		}
+	close FILE;
+
+However, that doesn't work if the line ending isn't a newline. You
+might change that C<tr///> to a C<s///> so you can count the number of
+times the input record separator, C<$/>, shows up:
+
+	my $lines = 0;
+	open my($fh), '<:raw', $filename or die "Can't open $filename: $!";
+	while( sysread $fh, $buffer, 4096 ) {
+		$lines += ( $buffer =~ s|$/||g; );
 		}
 	close FILE;
 
-This assumes no funny games with newline translations.
+If you don't mind shelling out, the C<wc> command is usually the
+fastest, even with the extra interprocess overhead. Ensure that you
+have an untainted filename though:
+
+	#!perl -T
+
+	$ENV{PATH} = undef;
+
+	my $lines;
+	if( $filename =~ /^([0-9a-z_.]+)\z/ ) {
+		$lines = `/usr/bin/wc -l $1`
+		chomp $lines;
+		}
+
+=head2 How do I delete the last N lines from a file?
+X<lines> X<file>
+
+(contributed by brian d foy)
+
+The easiest conceptual solution is to count the lines in the
+file then start at the beginning and print the number of lines
+(minus the last N) to a new file.
+
+Most often, the real question is how you can delete the last N lines
+without making more than one pass over the file, or how to do it
+without a lot of copying. The easy concept is the hard reality when
+you might have millions of lines in your file.
+
+One trick is to use C<File::ReadBackwards>, which starts at the end of
+the file. That module provides an object that wraps the real filehandle
+to make it easy for you to move around the file. Once you get to the
+spot you need, you can get the actual filehandle and work with it as
+normal. In this case, you get the file position at the end of the last
+line you want to keep and truncate the file to that point:
+
+	use File::ReadBackwards;
+
+	my $filename = 'test.txt';
+	my $Lines_to_truncate = 2;
+
+	my $bw = File::ReadBackwards->new( $filename )
+		or die "Could not read backwards in [$filename]: $!";
+
+	my $lines_from_end = 0;
+	until( $bw->eof or $lines_from_end == $Lines_to_truncate )
+		{
+		print "Got: ", $bw->readline;
+		$lines_from_end++;
+		}
+
+	truncate( $filename, $bw->tell );
+
+The C<File::ReadBackwards> module also has the advantage of setting
+the input record separator to a regular expression.
+
+You can also use the C<Tie::File> module which lets you access
+the lines through a tied array. You can use normal array operations
+to modify your file, including setting the last index and using
+C<splice>.
 
 =head2 How can I use Perl's C<-i> option from within a program?
 X<-i> X<in-place>
 
 C<-i> sets the value of Perl's C<$^I> variable, which in turn affects
-the behavior of C<< <> >>; see L<perlrun> for more details.  By
+the behavior of C<< <> >>; see L<perlrun> for more details. By
 modifying the appropriate variables directly, you can get the same
-behavior within a larger program.  For example:
+behavior within a larger program. For example:
 
 	# ...
 	{
@@ -323,7 +413,7 @@
 X<file, temporary>
 
 If you don't need to know the name of the file, you can use C<open()>
-with C<undef> in place of the file name.  In Perl 5.8 or later, the
+with C<undef> in place of the file name. In Perl 5.8 or later, the
 C<open()> function creates an anonymous temporary file:
 
 	open my $tmp, '+>', undef or die $!;
@@ -332,24 +422,24 @@
 
 	use File::Temp qw/ tempfile tempdir /;
 
-	$dir = tempdir( CLEANUP => 1 );
+	my $dir = tempdir( CLEANUP => 1 );
 	($fh, $filename) = tempfile( DIR => $dir );
 
 	# or if you don't need to know the filename
 
-	$fh = tempfile( DIR => $dir );
+	my $fh = tempfile( DIR => $dir );
 
-The File::Temp has been a standard module since Perl 5.6.1.  If you
+The File::Temp has been a standard module since Perl 5.6.1. If you
 don't have a modern enough Perl installed, use the C<new_tmpfile>
 class method from the IO::File module to get a filehandle opened for
-reading and writing.  Use it if you don't need to know the file's name:
+reading and writing. Use it if you don't need to know the file's name:
 
 	use IO::File;
-	$fh = IO::File->new_tmpfile()
-	or die "Unable to make new temporary file: $!";
+	my $fh = IO::File->new_tmpfile()
+		or die "Unable to make new temporary file: $!";
 
 If you're committed to creating a temporary file by hand, use the
-process ID and/or the current time-value.  If you need to have many
+process ID and/or the current time-value. If you need to have many
 temporary files in one process, use a counter:
 
 	BEGIN {
@@ -363,11 +453,11 @@
 		until( defined(fileno(FH)) || $count++ > 100 ) {
 			$base_name =~ s/-(\d+)$/"-" . (1 + $1)/e;
 			# O_EXCL is required for security reasons.
-			sysopen FH, $base_name, O_WRONLY|O_EXCL|O_CREAT;
+			sysopen my($fh), $base_name, O_WRONLY|O_EXCL|O_CREAT;
 			}
 
-		if( defined fileno(FH) ) {
-			return (*FH, $base_name);
+		if( defined fileno($fh) ) {
+			return ($fh, $base_name);
 			}
 		else {
 			return ();
@@ -380,8 +470,8 @@
 X<fixed-length> X<file, fixed-length records>
 
 The most efficient way is using L<pack()|perlfunc/"pack"> and
-L<unpack()|perlfunc/"unpack">.  This is faster than using
-L<substr()|perlfunc/"substr"> when taking many, many strings.  It is
+L<unpack()|perlfunc/"unpack">. This is faster than using
+L<substr()|perlfunc/"substr"> when taking many, many strings. It is
 slower for just a few.
 
 Here is a sample chunk of code to break up and put back together again
@@ -453,7 +543,7 @@
 X<filehandle, indirect>
 
 An indirect filehandle is using something other than a symbol
-in a place that a filehandle is expected.  Here are ways
+in a place that a filehandle is expected. Here are ways
 to get indirect filehandles:
 
 	$fh =   SOME_FH;       # bareword is strict-subs hostile
@@ -467,18 +557,18 @@
 and use it as though it were a normal filehandle.
 
 	use IO::Handle;                     # 5.004 or higher
-	$fh = IO::Handle->new();
+	my $fh = IO::Handle->new();
 
-Then use any of those as you would a normal filehandle.  Anywhere that
+Then use any of those as you would a normal filehandle. Anywhere that
 Perl is expecting a filehandle, an indirect filehandle may be used
 instead. An indirect filehandle is just a scalar variable that contains
-a filehandle.  Functions like C<print>, C<open>, C<seek>, or
+a filehandle. Functions like C<print>, C<open>, C<seek>, or
 the C<< <FH> >> diamond operator will accept either a named filehandle
 or a scalar variable containing one:
 
 	($ifh, $ofh, $efh) = (*STDIN, *STDOUT, *STDERR);
 	print $ofh "Type it: ";
-	$got = <$ifh>
+	my $got = <$ifh>
 	print $efh "What was that: $got";
 
 If you're passing a filehandle to a function, you can write
@@ -504,15 +594,15 @@
 	accept_fh($handle);
 
 In the examples above, we assigned the filehandle to a scalar variable
-before using it.  That is because only simple scalar variables, not
+before using it. That is because only simple scalar variables, not
 expressions or subscripts of hashes or arrays, can be used with
-built-ins like C<print>, C<printf>, or the diamond operator.  Using
+built-ins like C<print>, C<printf>, or the diamond operator. Using
 something other than a simple scalar variable as a filehandle is
 illegal and won't even compile:
 
-	@fd = (*STDIN, *STDOUT, *STDERR);
+	my @fd = (*STDIN, *STDOUT, *STDERR);
 	print $fd[1] "Type it: ";                           # WRONG
-	$got = <$fd[0]>                                     # WRONG
+	my $got = <$fd[0]>                                  # WRONG
 	print $fd[2] "What was that: $got";                 # WRONG
 
 With C<print> and C<printf>, you get around this by using a block and
@@ -523,26 +613,26 @@
 	# Pity the poor deadbeef.
 
 That block is a proper block like any other, so you can put more
-complicated code there.  This sends the message out to one of two places:
+complicated code there. This sends the message out to one of two places:
 
-	$ok = -x "/bin/cat";
+	my $ok = -x "/bin/cat";
 	print { $ok ? $fd[1] : $fd[2] } "cat stat $ok\n";
 	print { $fd[ 1+ ($ok || 0) ]  } "cat stat $ok\n";
 
 This approach of treating C<print> and C<printf> like object methods
-calls doesn't work for the diamond operator.  That's because it's a
-real operator, not just a function with a comma-less argument.  Assuming
+calls doesn't work for the diamond operator. That's because it's a
+real operator, not just a function with a comma-less argument. Assuming
 you've been storing typeglobs in your structure as we did above, you
 can use the built-in function named C<readline> to read a record just
-as C<< <> >> does.  Given the initialization shown above for @fd, this
-would work, but only because readline() requires a typeglob.  It doesn't
+as C<< <> >> does. Given the initialization shown above for @fd, this
+would work, but only because readline() requires a typeglob. It doesn't
 work with objects or strings, which might be a bug we haven't fixed yet.
 
 	$got = readline($fd[0]);
 
 Let it be noted that the flakiness of indirect filehandles is not
 related to whether they're strings, typeglobs, objects, or anything else.
-It's the syntax of the fundamental operators.  Playing the object
+It's the syntax of the fundamental operators. Playing the object
 game doesn't help you at all here.
 
 =head2 How can I set up a footer format to be used with write()?
@@ -616,7 +706,7 @@
 
 Use the E<lt>E<gt> (C<glob()>) operator, documented in L<perlfunc>.
 Versions of Perl older than 5.6 require that you have a shell
-installed that groks tildes.  Later versions of Perl have this feature
+installed that groks tildes. Later versions of Perl have this feature
 built in. The C<File::KGlob> module (available from CPAN) gives more
 portable glob functionality.
 
@@ -640,73 +730,73 @@
 Because you're using something like this, which truncates the file and
 I<then> gives you read-write access:
 
-	open(FH, "+> /path/name");		# WRONG (almost always)
+	open my $fh, '+>', '/path/name'; # WRONG (almost always)
 
-Whoops.  You should instead use this, which will fail if the file
+Whoops. You should instead use this, which will fail if the file
 doesn't exist.
 
-	open(FH, "+< /path/name");  	# open for update
+	open my $fh, '+<', '/path/name'; # open for update
 
-Using ">" always clobbers or creates.  Using "<" never does
-either.  The "+" doesn't change this.
+Using ">" always clobbers or creates. Using "<" never does
+either. The "+" doesn't change this.
 
-Here are examples of many kinds of file opens.  Those using sysopen()
+Here are examples of many kinds of file opens. Those using sysopen()
 all assume
 
 	use Fcntl;
 
 To open file for reading:
 
-	open(FH, "< $path")                                 || die $!;
-	sysopen(FH, $path, O_RDONLY)                        || die $!;
+	open my $fh, '<', $path                                 or die $!;
+	sysopen my $fh, $path, O_RDONLY                         or die $!;
 
 To open file for writing, create new file if needed or else truncate old file:
 
-	open(FH, "> $path") || die $!;
-	sysopen(FH, $path, O_WRONLY|O_TRUNC|O_CREAT)        || die $!;
-	sysopen(FH, $path, O_WRONLY|O_TRUNC|O_CREAT, 0666)  || die $!;
+	open my $fh, '>', $path                                 or die $!;
+	sysopen my $fh, $path, O_WRONLY|O_TRUNC|O_CREAT         or die $!;
+	sysopen my $fh, $path, O_WRONLY|O_TRUNC|O_CREAT, 0666   or die $!;
 
 To open file for writing, create new file, file must not exist:
 
-	sysopen(FH, $path, O_WRONLY|O_EXCL|O_CREAT)         || die $!;
-	sysopen(FH, $path, O_WRONLY|O_EXCL|O_CREAT, 0666)   || die $!;
+	sysopen my $fh, $path, O_WRONLY|O_EXCL|O_CREAT          or die $!;
+	sysopen my $fh, $path, O_WRONLY|O_EXCL|O_CREAT, 0666    or die $!;
 
 To open file for appending, create if necessary:
 
-	open(FH, ">> $path") || die $!;
-	sysopen(FH, $path, O_WRONLY|O_APPEND|O_CREAT)       || die $!;
-	sysopen(FH, $path, O_WRONLY|O_APPEND|O_CREAT, 0666) || die $!;
+	open my $fh, '>>' $path                                 or die $!;
+	sysopen my $fh, $path, O_WRONLY|O_APPEND|O_CREAT        or die $!;
+	sysopen my $fh, $path, O_WRONLY|O_APPEND|O_CREAT, 0666  or die $!;
 
 To open file for appending, file must exist:
 
-	sysopen(FH, $path, O_WRONLY|O_APPEND)               || die $!;
+	sysopen my $fh, $path, O_WRONLY|O_APPEND                or die $!;
 
 To open file for update, file must exist:
 
-	open(FH, "+< $path")                                || die $!;
-	sysopen(FH, $path, O_RDWR)                          || die $!;
+	open my $fh, '+<', $path                                or die $!;
+	sysopen my $fh, $path, O_RDWR                           or die $!;
 
 To open file for update, create file if necessary:
 
-	sysopen(FH, $path, O_RDWR|O_CREAT)                  || die $!;
-	sysopen(FH, $path, O_RDWR|O_CREAT, 0666)            || die $!;
+	sysopen my $fh, $path, O_RDWR|O_CREAT                   or die $!;
+	sysopen my $fh, $path, O_RDWR|O_CREAT, 0666             or die $!;
 
 To open file for update, file must not exist:
 
-	sysopen(FH, $path, O_RDWR|O_EXCL|O_CREAT)           || die $!;
-	sysopen(FH, $path, O_RDWR|O_EXCL|O_CREAT, 0666)     || die $!;
+	sysopen my $fh, $path, O_RDWR|O_EXCL|O_CREAT            or die $!;
+	sysopen my $fh, $path, O_RDWR|O_EXCL|O_CREAT, 0666      or die $!;
 
 To open a file without blocking, creating if necessary:
 
-	sysopen(FH, "/foo/somefile", O_WRONLY|O_NDELAY|O_CREAT)
+	sysopen my $fh, '/foo/somefile', O_WRONLY|O_NDELAY|O_CREAT
 	    or die "can't open /foo/somefile: $!":
 
 Be warned that neither creation nor deletion of files is guaranteed to
-be an atomic operation over NFS.  That is, two processes might both
-successfully create or unlink the same file!  Therefore O_EXCL
+be an atomic operation over NFS. That is, two processes might both
+successfully create or unlink the same file! Therefore O_EXCL
 isn't as exclusive as you might wish.
 
-See also the new L<perlopentut> if you have it (new for 5.6).
+See also the new L<perlopentut>.
 
 =head2 Why do I sometimes get an "Argument list too long" when I use E<lt>*E<gt>?
 X<argument list too long>
@@ -715,7 +805,7 @@
 In Perl versions earlier than v5.6.0, the internal glob() operator forks
 csh(1) to do the actual glob expansion, but
 csh can't handle more than 127 items and so gives the error message
-C<Argument list too long>.  People who installed tcsh as csh won't
+C<Argument list too long>. People who installed tcsh as csh won't
 have this problem, but their users may be surprised by it.
 
 To get around this, either upgrade to Perl v5.6.0 or later, do the glob
@@ -725,10 +815,11 @@
 =head2 Is there a leak/bug in glob()?
 X<glob>
 
-Due to the current implementation on some operating systems, when you
-use the glob() function or its angle-bracket alias in a scalar
-context, you may cause a memory leak and/or unpredictable behavior.  It's
-best therefore to use glob() only in list context.
+(contributed by brian d foy)
+
+Starting with Perl 5.6.0, C<glob> is implemented internally rather
+than relying on an external resource. As such, memory issues with
+C<glob> aren't a problem in modern perls.
 
 =head2 How can I open a file with a leading ">" or trailing blanks?
 X<filename, special characters>
@@ -744,25 +835,23 @@
 should use the three argument form of open() which does not treat any
 characters in the filename as special.
 
-	open FILE, "<", "  file  ";  # filename is "   file   "
-	open FILE, ">", ">file";     # filename is ">file"
+	open my $fh, "<", "  file  ";  # filename is "   file   "
+	open my $fh, ">", ">file";     # filename is ">file"
 
 =head2 How can I reliably rename a file?
-X<rename> X<mv> X<move> X<file, rename> X<ren>
+X<rename> X<mv> X<move> X<file, rename>
 
 If your operating system supports a proper mv(1) utility or its
 functional equivalent, this works:
 
 	rename($old, $new) or system("mv", $old, $new);
 
-It may be more portable to use the File::Copy module instead.
+It may be more portable to use the C<File::Copy> module instead.
 You just copy to the new file to the new name (checking return
-values), then delete the old one.  This isn't really the same
-semantically as a rename(), which preserves meta-information like
+values), then delete the old one. This isn't really the same
+semantically as a C<rename()>, which preserves meta-information like
 permissions, timestamps, inode info, etc.
 
-Newer versions of File::Copy export a move() function.
-
 =head2 How can I lock a file?
 X<lock> X<file, lock> X<flock>
 
@@ -788,18 +877,18 @@
 
 Some versions of flock() can't lock files over a network (e.g. on NFS file
 systems), so you'd need to force the use of fcntl(2) when you build Perl.
-But even this is dubious at best.  See the flock entry of L<perlfunc>
+But even this is dubious at best. See the flock entry of L<perlfunc>
 and the F<INSTALL> file in the source distribution for information on
 building Perl to do this.
 
 Two potentially non-obvious but traditional flock semantics are that
 it waits indefinitely until the lock is granted, and that its locks are
-I<merely advisory>.  Such discretionary locks are more flexible, but
-offer fewer guarantees.  This means that files locked with flock() may
-be modified by programs that do not also use flock().  Cars that stop
+I<merely advisory>. Such discretionary locks are more flexible, but
+offer fewer guarantees. This means that files locked with flock() may
+be modified by programs that do not also use flock(). Cars that stop
 for red lights get on well with each other, but not with cars that don't
-stop for red lights.  See the perlport manpage, your port's specific
-documentation, or your system-specific local manpages for details.  It's
+stop for red lights. See the perlport manpage, your port's specific
+documentation, or your system-specific local manpages for details. It's
 best to assume traditional behavior if you're writing portable programs.
 (If you're not, you should as always feel perfectly free to write
 for your own system's idiosyncrasies (sometimes called "features").
@@ -816,14 +905,14 @@
 
 A common bit of code B<NOT TO USE> is this:
 
-	sleep(3) while -e "file.lock";	# PLEASE DO NOT USE
-	open(LCK, "> file.lock");		# THIS BROKEN CODE
+	sleep(3) while -e 'file.lock';	# PLEASE DO NOT USE
+	open my $lock, '>', 'file.lock'; # THIS BROKEN CODE
 
 This is a classic race condition: you take two steps to do something
-which must be done in one.  That's why computer hardware provides an
-atomic test-and-set instruction.   In theory, this "ought" to work:
+which must be done in one. That's why computer hardware provides an
+atomic test-and-set instruction. In theory, this "ought" to work:
 
-	sysopen(FH, "file.lock", O_WRONLY|O_EXCL|O_CREAT)
+	sysopen my $fh, "file.lock", O_WRONLY|O_EXCL|O_CREAT
 		or die "can't open  file.lock: $!";
 
 except that lamentably, file creation (and deletion) is not atomic
@@ -831,32 +920,32 @@
 Various schemes involving link() have been suggested, but
 these tend to involve busy-wait, which is also less than desirable.
 
-=head2 I still don't get locking.  I just want to increment the number in the file.  How can I do this?
+=head2 I still don't get locking. I just want to increment the number in the file. How can I do this?
 X<counter> X<file, counter>
 
 Didn't anyone ever tell you web-page hit counters were useless?
 They don't count number of hits, they're a waste of time, and they serve
-only to stroke the writer's vanity.  It's better to pick a random number;
+only to stroke the writer's vanity. It's better to pick a random number;
 they're more realistic.
 
 Anyway, this is what you can do if you can't help yourself.
 
 	use Fcntl qw(:DEFAULT :flock);
-	sysopen(FH, "numfile", O_RDWR|O_CREAT) 	 or die "can't open numfile: $!";
-	flock(FH, LOCK_EX) 				 or die "can't flock numfile: $!";
-	$num = <FH> || 0;
-	seek(FH, 0, 0) 				 or die "can't rewind numfile: $!";
-	truncate(FH, 0) 				 or die "can't truncate numfile: $!";
-	(print FH $num+1, "\n")			 or die "can't write numfile: $!";
-	close FH 					 or die "can't close numfile: $!";
+	sysopen my $fh, "numfile", O_RDWR|O_CREAT or die "can't open numfile: $!";
+	flock $fh, LOCK_EX                        or die "can't flock numfile: $!";
+	my $num = <$fh> || 0;
+	seek $fh, 0, 0                            or die "can't rewind numfile: $!";
+	truncate $fh, 0                           or die "can't truncate numfile: $!";
+	(print $fh $num+1, "\n")                  or die "can't write numfile: $!";
+	close $fh                                 or die "can't close numfile: $!";
 
 Here's a much better web-page hit counter:
 
 	$hits = int( (time() - 850_000_000) / rand(1_000) );
 
-If the count doesn't impress your friends, then the code might.  :-)
+If the count doesn't impress your friends, then the code might. :-)
 
-=head2 All I want to do is append a small amount of text to the end of a file.  Do I still have to use locking?
+=head2 All I want to do is append a small amount of text to the end of a file. Do I still have to use locking?
 X<append> X<file, append>
 
 If you are on a system that correctly implements C<flock> and you use
@@ -900,13 +989,13 @@
 
 	$RECSIZE = 220; # size of record, in bytes
 	$recno   = 37;  # which record to update
-	open(FH, "+<somewhere") || die "can't update somewhere: $!";
-	seek(FH, $recno * $RECSIZE, 0);
-	read(FH, $record, $RECSIZE) == $RECSIZE || die "can't read record $recno: $!";
+	open my $fh, '+<', 'somewhere' or die "can't update somewhere: $!";
+	seek $fh, $recno * $RECSIZE, 0;
+	read $fh, $record, $RECSIZE == $RECSIZE or die "can't read record $recno: $!";
 	# munge the record
-	seek(FH, -$RECSIZE, 1);
-	print FH $record;
-	close FH;
+	seek $fh, -$RECSIZE, 1;
+	print $fh $record;
+	close $fh;
 
 Locking and error checking are left as an exercise for the reader.
 Don't forget them or you'll be quite sorry.
@@ -914,21 +1003,19 @@
 =head2 How do I get a file's timestamp in perl?
 X<timestamp> X<file, timestamp>
 
-If you want to retrieve the time at which the file was last
-read, written, or had its meta-data (owner, etc) changed,
-you use the B<-A>, B<-M>, or B<-C> file test operations as
-documented in L<perlfunc>.  These retrieve the age of the
-file (measured against the start-time of your program) in
-days as a floating point number. Some platforms may not have
-all of these times.  See L<perlport> for details. To
-retrieve the "raw" time in seconds since the epoch, you
-would call the stat function, then use localtime(),
-gmtime(), or POSIX::strftime() to convert this into
-human-readable form.
+If you want to retrieve the time at which the file was last read,
+written, or had its meta-data (owner, etc) changed, you use the B<-A>,
+B<-M>, or B<-C> file test operations as documented in L<perlfunc>.
+These retrieve the age of the file (measured against the start-time of
+your program) in days as a floating point number. Some platforms may
+not have all of these times. See L<perlport> for details. To retrieve
+the "raw" time in seconds since the epoch, you would call the stat
+function, then use C<localtime()>, C<gmtime()>, or
+C<POSIX::strftime()> to convert this into human-readable form.
 
 Here's an example:
 
-	$write_secs = (stat($file))[9];
+	my $write_secs = (stat($file))[9];
 	printf "file %s updated at %s\n", $file,
 	scalar localtime($write_secs);
 
@@ -938,11 +1025,11 @@
 	# error checking left as an exercise for reader.
 	use File::stat;
 	use Time::localtime;
-	$date_string = ctime(stat($file)->mtime);
+	my $date_string = ctime(stat($file)->mtime);
 	print "file $file updated at $date_string\n";
 
 The POSIX::strftime() approach has the benefit of being,
-in theory, independent of the current locale.  See L<perllocale>
+in theory, independent of the current locale. See L<perllocale>
 for details.
 
 =head2 How do I set a file's timestamp in perl?
@@ -956,8 +1043,8 @@
 	if (@ARGV < 2) {
 		die "usage: cptimes timestamp_file other_files ...\n";
 		}
-	$timestamp = shift;
-	($atime, $mtime) = (stat($timestamp))[8,9];
+	my $timestamp = shift;
+	my($atime, $mtime) = (stat($timestamp))[8,9];
 	utime $atime, $mtime, @ARGV;
 
 Error checking is, as usual, left as an exercise for the reader.
@@ -966,9 +1053,9 @@
 effect as touch(1) on files that I<already exist>.
 
 Certain file systems have a limited ability to store the times
-on a file at the expected level of precision.  For example, the
+on a file at the expected level of precision. For example, the
 FAT and HPFS filesystem are unable to create dates on files with
-a finer granularity than two seconds.  This is a limitation of
+a finer granularity than two seconds. This is a limitation of
 the filesystems, not of utime().
 
 =head2 How do I print to more than one file at once?
@@ -980,37 +1067,50 @@
 If you only have to do this once, you can print individually
 to each filehandle.
 
-	for $fh (FH1, FH2, FH3) { print $fh "whatever\n" }
+	for my $fh (FH1, FH2, FH3) { print $fh "whatever\n" }
 
 =head2 How can I read in an entire file all at once?
 X<slurp> X<file, slurping>
 
-You can use the File::Slurp module to do it in one step.
+Are you sure you want to read the entire file and store it in memory?
+If you mmap the file, you can virtually load the entire file into a
+string without actually storing it in memory:
+
+	use File::Map qw(map_file);
+
+	map_file my $string, $filename;
+
+Once mapped, you can treat C<$string> as you would any other string.
+Since you don't actually load the data, mmap-ing is very fast and does
+not increase your memory footprint.
+
+If you really want to load the entire file, you can use the
+C<File::Slurp> module to do it in one step.
 
 	use File::Slurp;
 
-	$all_of_it = read_file($filename); # entire file in scalar
-	@all_lines = read_file($filename); # one line per element
+	my $all_of_it = read_file($filename); # entire file in scalar
+	my @all_lines = read_file($filename); # one line per element
 
 The customary Perl approach for processing all the lines in a file is to
 do so one line at a time:
 
-	open (INPUT, $file) 	|| die "can't open $file: $!";
-	while (<INPUT>) {
+	open my $input, '<', $file or die "can't open $file: $!";
+	while (<$input>) {
 		chomp;
 		# do something with $_
 		}
-	close(INPUT)	    	|| die "can't close $file: $!";
+	close $input or die "can't close $file: $!";
 
 This is tremendously more efficient than reading the entire file into
 memory as an array of lines and then processing it one element at a time,
-which is often--if not almost always--the wrong approach.  Whenever
+which is often--if not almost always--the wrong approach. Whenever
 you see someone do this:
 
-	@lines = <INPUT>;
+	my @lines = <INPUT>;
 
-you should think long and hard about why you need everything loaded at
-once.  It's just not a scalable solution.  You might also find it more
+You should think long and hard about why you need everything loaded at
+once. It's just not a scalable solution. You might also find it more
 fun to use the standard Tie::File module, or the DB_File module's
 $DB_RECNO bindings, which allow you to tie an array to a file so that
 accessing an element the array actually accesses the corresponding
@@ -1019,19 +1119,19 @@
 You can read the entire filehandle contents into a scalar.
 
 	{
-	local(*INPUT, $/);
-	open (INPUT, $file) 	|| die "can't open $file: $!";
-	$var = <INPUT>;
+	local $/;
+	open my $fh, '<', $file or die "can't open $file: $!";
+	$var = <$fh>;
 	}
 
 That temporarily undefs your record separator, and will automatically
-close the file at block exit.  If the file is already open, just use this:
+close the file at block exit. If the file is already open, just use this:
 
-	$var = do { local $/; <INPUT> };
+	$var = do { local $/; <$fh> };
 
 For ordinary files you can also use the read function.
 
-	read( INPUT, $var, -s INPUT );
+	read( $fh, $var, -s $fh );
 
 The third argument tests the byte size of the data on the INPUT filehandle
 and reads that many bytes into the buffer $var.
@@ -1039,19 +1139,19 @@
 =head2 How can I read in a file by paragraphs?
 X<file, reading by paragraphs>
 
-Use the C<$/> variable (see L<perlvar> for details).  You can either
+Use the C<$/> variable (see L<perlvar> for details). You can either
 set it to C<""> to eliminate empty paragraphs (C<"abc\n\n\n\ndef">,
 for instance, gets treated as two paragraphs and not three), or
 C<"\n\n"> to accept empty paragraphs.
 
-Note that a blank line must have no blanks in it.  Thus
+Note that a blank line must have no blanks in it. Thus
 S<C<"fred\n \nstuff\n\n">> is one paragraph, but C<"fred\n\nstuff\n\n"> is two.
 
 =head2 How can I read a single character from a file?  From the keyboard?
 X<getc> X<file, reading one character at a time>
 
 You can use the builtin C<getc()> function for most filehandles, but
-it won't (easily) work on a terminal device.  For STDIN, either use
+it won't (easily) work on a terminal device. For STDIN, either use
 the Term::ReadKey module from CPAN or use the sample code in
 L<perlfunc/getc>.
 
@@ -1063,9 +1163,8 @@
 	use strict;
 	$| = 1;
 	for (1..4) {
-		my $got;
 		print "gimme: ";
-		$got = getone();
+		my $got = getone();
 		print "--> $got\n";
 		}
     exit;
@@ -1075,7 +1174,7 @@
 
 	my ($term, $oterm, $echo, $noecho, $fd_stdin);
 
-	$fd_stdin = fileno(STDIN);
+	my $fd_stdin = fileno(STDIN);
 
 	$term     = POSIX::Termios->new();
 	$term->getattr($fd_stdin);
@@ -1108,14 +1207,14 @@
 
 	END { cooked() }
 
-The Term::ReadKey module from CPAN may be easier to use.  Recent versions
+The Term::ReadKey module from CPAN may be easier to use. Recent versions
 include also support for non-portable systems as well.
 
 	use Term::ReadKey;
-	open(TTY, "</dev/tty");
+	open my $tty, '<', '/dev/tty';
 	print "Gimme a char: ";
 	ReadMode "raw";
-	$key = ReadKey 0, *TTY;
+	my $key = ReadKey 0, $tty;
 	ReadMode "normal";
 	printf "\nYou said %s, char number %03d\n",
 		$key, ord $key;
@@ -1123,13 +1222,13 @@
 =head2 How can I tell whether there's a character waiting on a filehandle?
 
 The very first thing you should do is look into getting the Term::ReadKey
-extension from CPAN.  As we mentioned earlier, it now even has limited
+extension from CPAN. As we mentioned earlier, it now even has limited
 support for non-portable (read: not open systems, closed, proprietary,
-not POSIX, not Unix, etc) systems.
+not POSIX, not Unix, etc.) systems.
 
 You should also check out the Frequently Asked Questions list in
 comp.unix.* for things like this: the answer is essentially the same.
-It's very system dependent.  Here's one solution that works on BSD
+It's very system dependent. Here's one solution that works on BSD
 systems:
 
 	sub key_ready {
@@ -1139,9 +1238,9 @@
 		}
 
 If you want to find out how many characters are waiting, there's
-also the FIONREAD ioctl call to be looked at.  The I<h2ph> tool that
+also the FIONREAD ioctl call to be looked at. The I<h2ph> tool that
 comes with Perl tries to convert C include files to Perl code, which
-can be C<require>d.  FIONREAD ends up defined as a function in the
+can be C<require>d. FIONREAD ends up defined as a function in the
 I<sys/ioctl.ph> file:
 
 	require 'sys/ioctl.ph';
@@ -1211,19 +1310,19 @@
 X<dup>
 
 If you check L<perlfunc/open>, you'll see that several of the ways
-to call open() should do the trick.  For example:
+to call open() should do the trick. For example:
 
-	open(LOG, ">>/foo/logfile");
-	open(STDERR, ">&LOG");
+	open my $log, '>>', '/foo/logfile';
+	open STDERR, '>&LOG';
 
 Or even with a literal numeric descriptor:
 
-   $fd = $ENV{MHCONTEXTFD};
-   open(MHCONTEXT, "<&=$fd");	# like fdopen(3S)
+	my $fd = $ENV{MHCONTEXTFD};
+	open $mhcontext, "<&=$fd";  # like fdopen(3S)
 
 Note that "<&STDIN" makes a copy, but "<&=STDIN" make
-an alias.  That means if you close an aliased handle, all
-aliases become inaccessible.  This is not true with
+an alias. That means if you close an aliased handle, all
+aliases become inaccessible. This is not true with
 a copied one.
 
 Error checking, as always, has been left as an exercise for the reader.
@@ -1241,11 +1340,11 @@
 
 This should rarely be necessary, as the Perl C<close()> function is to be
 used for things that Perl opened itself, even if it was a dup of a
-numeric descriptor as with C<MHCONTEXT> above.  But if you really have
+numeric descriptor as with C<MHCONTEXT> above. But if you really have
 to, you may be able to do this:
 
 	require 'sys/syscall.ph';
-	$rc = syscall(&SYS_close, $fd + 0);  # must force numeric
+	my $rc = syscall(&SYS_close, $fd + 0);  # must force numeric
 	die "can't sysclose $fd: $!" unless $rc == -1;
 
 Or, just use the fdopen(3S) feature of C<open()>:
@@ -1260,8 +1359,8 @@
 
 Whoops!  You just put a tab and a formfeed into that filename!
 Remember that within double quoted strings ("like\this"), the
-backslash is an escape character.  The full list of these is in
-L<perlop/Quote and Quote-like Operators>.  Unsurprisingly, you don't
+backslash is an escape character. The full list of these is in
+L<perlop/Quote and Quote-like Operators>. Unsurprisingly, you don't
 have a file called "c:(tab)emp(formfeed)oo" or
 "c:(tab)emp(formfeed)oo.exe" on your legacy DOS filesystem.
 
@@ -1269,16 +1368,16 @@
 Since all DOS and Windows versions since something like MS-DOS 2.0 or so
 have treated C</> and C<\> the same in a path, you might as well use the
 one that doesn't clash with Perl--or the POSIX shell, ANSI C and C++,
-awk, Tcl, Java, or Python, just to mention a few.  POSIX paths
+awk, Tcl, Java, or Python, just to mention a few. POSIX paths
 are more portable, too.
 
 =head2 Why doesn't glob("*.*") get all the files?
 X<glob>
 
 Because even on non-Unix ports, Perl's glob function follows standard
-Unix globbing semantics.  You'll need C<glob("*")> to get all (non-hidden)
-files.  This makes glob() portable even to legacy systems.  Your
-port may include proprietary globbing functions as well.  Check its
+Unix globbing semantics. You'll need C<glob("*")> to get all (non-hidden)
+files. This makes glob() portable even to legacy systems. Your
+port may include proprietary globbing functions as well. Check its
 documentation for details.
 
 =head2 Why does Perl let me delete read-only files?  Why does C<-i> clobber protected files?  Isn't this a bug in Perl?
@@ -1287,12 +1386,12 @@
 F<file-dir-perms> article in the "Far More Than You Ever Wanted To
 Know" collection in http://www.cpan.org/misc/olddoc/FMTEYEWTK.tgz .
 
-The executive summary: learn how your filesystem works.  The
+The executive summary: learn how your filesystem works. The
 permissions on a file say what can happen to the data in that file.
 The permissions on a directory say what can happen to the list of
-files in that directory.  If you delete a file, you're removing its
+files in that directory. If you delete a file, you're removing its
 name from the directory (so the operation depends on the permissions
-of the directory, not of the file).  If you try to write to the file,
+of the directory, not of the file). If you try to write to the file,
 the permissions of the file govern whether you're allowed to.
 
 =head2 How do I select a random line from a file?
@@ -1307,7 +1406,7 @@
 	rand($.) < 1 && ($line = $_) while <>;
 
 This has a significant advantage in space over reading the whole file
-in.  You can find a proof of this method in I<The Art of Computer
+in. You can find a proof of this method in I<The Art of Computer
 Programming>, Volume 2, Section 3.4.2, by Donald E. Knuth.
 
 You can use the C<File::Random> module which provides a function
@@ -1317,7 +1416,7 @@
 	my $line = random_line($filename);
 
 Another way is to use the C<Tie::File> module, which treats the entire
-file as an array.  Simply access a random array element.
+file as an array. Simply access a random array element.
 
 =head2 Why do I get weird spaces when I print an array of lines?
 
@@ -1408,21 +1507,20 @@
 
 (contributed by brian d foy)
 
-If you have an empty directory, you can use Perl's built-in C<rmdir>. If
-the directory is not empty (so, no files or subdirectories), you either
-have to empty it yourself (a lot of work) or use a module to help you.
+If you have an empty directory, you can use Perl's built-in C<rmdir>.
+If the directory is not empty (so, no files or subdirectories), you
+either have to empty it yourself (a lot of work) or use a module to
+help you.
 
-The C<File::Path> module, which comes with Perl, has a C<rmtree> which
-can take care of all of the hard work for you:
+The C<File::Path> module, which comes with Perl, has a C<remove_tree>
+which can take care of all of the hard work for you:
 
-	use File::Path qw(rmtree);
+	use File::Path qw(remove_tree);
 
-	rmtree( \@directories, 0, 0 );
+	remove_tree( @directories );
 
-The first argument to C<rmtree> is either a string representing a directory path
-or an array reference. The second argument controls progress messages, and the
-third argument controls the handling of files you don't have permissions to
-delete. See the C<File::Path> module for the details.
+The C<File::Path> module also has a legacy interface to the older
+C<rmtree> subroutine.
 
 =head2 How do I copy an entire directory?
 
@@ -1431,24 +1529,17 @@
 To do the equivalent of C<cp -R> (i.e. copy an entire directory tree
 recursively) in portable Perl, you'll either need to write something yourself
 or find a good CPAN module such as  L<File::Copy::Recursive>.
-=head1 REVISION
-
-Revision: $Revision$
-
-Date: $Date$
-
-See L<perlfaq> for source control details and availability.
 
 =head1 AUTHOR AND COPYRIGHT
 
-Copyright (c) 1997-2009 Tom Christiansen, Nathan Torkington, and
+Copyright (c) 1997-2010 Tom Christiansen, Nathan Torkington, and
 other authors as noted. All rights reserved.
 
 This documentation is free; you can redistribute it and/or modify it
 under the same terms as Perl itself.
 
 Irrespective of its distribution, all code examples here are in the public
-domain.  You are permitted and encouraged to use this code and any
+domain. You are permitted and encouraged to use this code and any
 derivatives thereof in your own programs for fun or for profit as you
-see fit.  A simple comment in the code giving credit to the FAQ would
+see fit. A simple comment in the code giving credit to the FAQ would
 be courteous but is not required.
Index: src/gnu/usr.bin/perl/pod/perlfaq6.pod
diff -u src/gnu/usr.bin/perl/pod/perlfaq6.pod:1.10 src/gnu/usr.bin/perl/pod/perlfaq6.pod:1.11
--- pod/perlfaq6.pod:1.10	Mon Oct 12 18:24:47 2009
+++ pod/perlfaq6.pod	Fri Sep 24 15:07:03 2010
@@ -33,9 +33,9 @@
 =item Comments Inside the Regex
 
 The C</x> modifier causes whitespace to be ignored in a regex pattern
-(except in a character class), and also allows you to use normal
-comments there, too.  As you can imagine, whitespace and comments help
-a lot.
+(except in a character class and a few other places), and also allows you to
+use normal comments there, too.  As you can imagine, whitespace and comments
+help a lot.
 
 C</x> lets you turn this:
 
@@ -169,7 +169,7 @@
 pattern that matches your input, someone throws you a curveball.
 
 If you'd like to do it the hard way, scratching and clawing your way
-toward a right answer but constantly being disappointed, beseiged by
+toward a right answer but constantly being disappointed, besieged by
 bug reports, and weary from the inordinate amount of time you have to
 spend reinventing a triangular wheel, then there are several things
 you can try before you give up in frustration:
@@ -528,7 +528,7 @@
 Perl 5.10) regular expression features. These are covered in L<perlre>
 and this example is a modified version of one in that documentation.
 
-First, adding the new possesive C<+> to any quantifier finds the
+First, adding the new possessive C<+> to any quantifier finds the
 longest match and does not backtrack. That's important since you want
 to handle any angle brackets through the recursion, not backtracking.
 The group C<< [^<>]++ >> finds one or more non-angle brackets without
@@ -713,7 +713,7 @@
 ( contributed by brian d foy )
 
 Avoid asking Perl to compile a regular expression every time
-you want to match it.  In this example, perl must recompile
+you want to match it. In this example, perl must recompile
 the regular expression for every iteration of the C<foreach>
 loop since it has no way to know what $pattern will be.
 
@@ -735,7 +735,7 @@
 regular expression, but doesn't apply it.  When you use the
 pre-compiled version of the regex, perl does less work. In
 this example, I inserted a C<map> to turn each pattern into
-its pre-compiled form.  The rest of the script is the same,
+its pre-compiled form. The rest of the script is the same,
 but faster.
 
 	@patterns = map { qr/\b$_\b/i } qw( foo bar baz );
@@ -753,7 +753,7 @@
 		}
 
 In some cases, you may be able to make several patterns into
-a single regular expression.  Beware of situations that require
+a single regular expression. Beware of situations that require
 backtracking though.
 
 	$regex = join '|', qw( foo bar baz );
@@ -1128,17 +1128,9 @@
 		warn $@;
 		}
 
-=head1 REVISION
-
-Revision: $Revision$
-
-Date: $Date$
-
-See L<perlfaq> for source control details and availability.
-
 =head1 AUTHOR AND COPYRIGHT
 
-Copyright (c) 1997-2009 Tom Christiansen, Nathan Torkington, and
+Copyright (c) 1997-2010 Tom Christiansen, Nathan Torkington, and
 other authors as noted. All rights reserved.
 
 This documentation is free; you can redistribute it and/or modify it
Index: src/gnu/usr.bin/perl/pod/perlfaq7.pod
diff -u src/gnu/usr.bin/perl/pod/perlfaq7.pod:1.10 src/gnu/usr.bin/perl/pod/perlfaq7.pod:1.11
--- pod/perlfaq7.pod:1.10	Mon Oct 12 18:24:47 2009
+++ pod/perlfaq7.pod	Fri Sep 24 15:07:03 2010
@@ -202,9 +202,6 @@
 
 (contributed by brian d foy)
 
-The full answer to this can be found at
-http://cpan.org/modules/04pause.html#takeover
-
 The easiest way to take over a module is to have the current
 module maintainer either make you a co-maintainer or transfer
 the module to you.
@@ -378,12 +375,9 @@
 
 =head2 How can I pass/return a {Function, FileHandle, Array, Hash, Method, Regex}?
 
-With the exception of regexes, you need to pass references to these
-objects.  See L<perlsub/"Pass by Reference"> for this particular
-question, and L<perlref> for information on references.
-
-See "Passing Regexes", later in L<perlfaq7>, for information on
-passing regular expressions.
+You need to pass references to these objects.  See L<perlsub/"Pass by
+Reference"> for this particular question, and L<perlref> for
+information on references.
 
 =over 4
 
@@ -423,12 +417,9 @@
 
 =item Passing Regexes
 
-To pass regexes around, you'll need to be using a release of Perl
-sufficiently recent as to support the C<qr//> construct, pass around
-strings and use an exception-trapping eval, or else be very, very clever.
-
-Here's an example of how to pass in a string to be regex compared
-using C<qr//>:
+Here's an example of how to pass in a string and a regular expression
+for it to match against. You construct the pattern with the C<qr//>
+operator:
 
 	sub compare($$) {
 		my ($val1, $regex) = @_;
@@ -437,37 +428,6 @@
 	}
 	$match = compare("old McDonald", qr/d.*D/i);
 
-Notice how C<qr//> allows flags at the end.  That pattern was compiled
-at compile time, although it was executed later.  The nifty C<qr//>
-notation wasn't introduced until the 5.005 release.  Before that, you
-had to approach this problem much less intuitively.  For example, here
-it is again if you don't have C<qr//>:
-
-	sub compare($$) {
-		my ($val1, $regex) = @_;
-		my $retval = eval { $val1 =~ /$regex/ };
-	die if $@;
-	return $retval;
-	}
-
-	$match = compare("old McDonald", q/($?i)d.*D/);
-
-Make sure you never say something like this:
-
-	return eval "\$val =~ /$regex/";   # WRONG
-
-or someone can sneak shell escapes into the regex due to the double
-interpolation of the eval and the double-quoted string.  For example:
-
-	$pattern_of_evil = 'danger ${ system("rm -rf * &") } danger';
-
-	eval "\$string =~ /$pattern_of_evil/";
-
-Those preferring to be very, very clever might see the O'Reilly book,
-I<Mastering Regular Expressions>, by Jeffrey Friedl.  Page 273's
-Build_MatchMany_Function() is particularly interesting.  A complete
-citation of this book is given in L<perlfaq2>.
-
 =item Passing Methods
 
 To pass an object method into a subroutine, you can do this:
@@ -688,9 +648,9 @@
 (contributed by brian d foy)
 
 Calling a subroutine as C<&foo> with no trailing parentheses ignores
-the prototype of C<foo> and passes it the current value of the argumet
+the prototype of C<foo> and passes it the current value of the argument
 list, C<@_>. Here's an example; the C<bar> subroutine calls C<&foo>,
-which prints what its arguments list:
+which prints its arguments list:
 
 	sub bar { &foo }
 
@@ -861,6 +821,21 @@
 	my $current_package = __PACKAGE__;
 	print "I am in package $current_package\n";
 
+If you want to find the package calling your code, perhaps to give better
+diagnostics as C<Carp> does, use the C<caller> built-in:
+
+	sub foo {
+		my @args = ...;
+		my( $package, $filename, $line ) = caller;
+
+		print "I was called from package $package\n";
+		);
+
+By default, your program starts in package C<main>, so you should
+always be in some package unless someone uses the C<package> built-in
+with no namespace. See the C<package> entry in L<perlfunc> for the
+details of empty packages.
+
 This is different from finding out the package an object is blessed
 into, which might not be the current package. For that, use C<blessed>
 from C<Scalar::Util>, part of the Standard Library since Perl 5.8:
@@ -873,20 +848,13 @@
 
 	my $is_right_class = eval { $object->isa( $package ) }; # true or false
 
-If you want to find the package calling your code, perhaps to give better
-diagnostics as C<Carp> does, use the C<caller> built-in:
-
-	sub foo {
-		my @args = ...;
-		my( $package, $filename, $line ) = caller;
+And, with Perl 5.10 and later, you don't have to check for an
+inheritance to see if the object can handle a role. For that, you can
+use C<DOES>, which comes from C<UNIVERSAL>:
 
-		print "I was called from package $package\n";
-		);
+	my $class_does_it = eval { $object->DOES( $role ) }; # true or false
 
-By default, your program starts in package C<main>, so you should
-always be in some package unless someone uses the C<package> built-in
-with no namespace. See the C<package> entry in L<perlfunc> for the
-details of empty packges.
+You can safely replace C<isa> with C<DOES> (although the converse is not true).
 
 =head2 How can I comment out a large block of Perl code?
 
@@ -908,10 +876,10 @@
 
 	=cut
 
-The quick-and-dirty method only works well when you don't plan to 
+The quick-and-dirty method only works well when you don't plan to
 leave the commented code in the source. If a Pod parser comes along,
 you're multiline comment is going to show up in the Pod translation.
-A better way hides it from Pod parsers as well. 
+A better way hides it from Pod parsers as well.
 
 The C<=begin> directive can mark a section for a particular purpose.
 If the Pod parser doesn't want to handle it, it just ignores it. Label
@@ -1088,17 +1056,9 @@
 your PATH, which might also mean that the location of perl is not
 where you expect it so you need to adjust your shebang line.
 
-=head1 REVISION
-
-Revision: $Revision$
-
-Date: $Date$
-
-See L<perlfaq> for source control details and availability.
-
 =head1 AUTHOR AND COPYRIGHT
 
-Copyright (c) 1997-2009 Tom Christiansen, Nathan Torkington, and
+Copyright (c) 1997-2010 Tom Christiansen, Nathan Torkington, and
 other authors as noted. All rights reserved.
 
 This documentation is free; you can redistribute it and/or modify it
Index: src/gnu/usr.bin/perl/pod/perlfaq8.pod
diff -u src/gnu/usr.bin/perl/pod/perlfaq8.pod:1.11 src/gnu/usr.bin/perl/pod/perlfaq8.pod:1.12
--- pod/perlfaq8.pod:1.11	Mon Oct 12 18:24:47 2009
+++ pod/perlfaq8.pod	Fri Sep 24 15:07:04 2010
@@ -15,9 +15,9 @@
 
 =head2 How do I find out which operating system I'm running under?
 
-The $^O variable ($OSNAME if you use English) contains an indication of
-the name of the operating system (not its release number) that your perl
-binary was built for.
+The C<$^O> variable (C<$OSNAME> if you use C<English>) contains an
+indication of the name of the operating system (not its release
+number) that your perl binary was built for.
 
 =head2 How come exec() doesn't return?
 X<exec> X<system> X<fork> X<open> X<pipe>
@@ -66,7 +66,7 @@
 In general, you don't, because you don't know whether
 the recipient has a color-aware display device.  If you
 know that they have an ANSI terminal that understands
-color, you can use the Term::ANSIColor module from CPAN:
+color, you can use the C<Term::ANSIColor> module from CPAN:
 
 	use Term::ANSIColor;
 	print color("red"), "Stop!\n", color("reset");
@@ -92,7 +92,7 @@
 	sysread(TTY, $key, 1);	# probably this does
 	system "stty -cbreak </dev/tty >/dev/tty 2>&1";
 
-The Term::ReadKey module from CPAN offers an easy-to-use interface that
+The C<Term::ReadKey> module from CPAN offers an easy-to-use interface that
 should be more efficient than shelling out to B<stty> for each key.
 It even includes limited support for Windows.
 
@@ -103,13 +103,13 @@
 
 However, using the code requires that you have a working C compiler
 and can use it to build and install a CPAN module.  Here's a solution
-using the standard POSIX module, which is already on your systems
+using the standard C<POSIX> module, which is already on your system
 (assuming your system supports POSIX).
 
 	use HotKey;
 	$key = readkey();
 
-And here's the HotKey module, which hides the somewhat mystifying calls
+And here's the C<HotKey> module, which hides the somewhat mystifying calls
 to manipulate the POSIX termios structures.
 
 	# HotKey.pm
@@ -157,7 +157,7 @@
 =head2 How do I check whether input is ready on the keyboard?
 
 The easiest way to do this is to read a key in nonblocking mode with the
-Term::ReadKey module from CPAN, passing it an argument of -1 to indicate
+C<Term::ReadKey> module from CPAN, passing it an argument of -1 to indicate
 not to block:
 
 	use Term::ReadKey;
@@ -220,7 +220,7 @@
 
 =head2 How do I get the screen size?
 
-If you have Term::ReadKey module installed from CPAN,
+If you have C<Term::ReadKey> module installed from CPAN,
 you can use it to fetch the width and height in characters
 and in pixels:
 
@@ -248,11 +248,11 @@
 
 There's an example of this in L<perlfunc/crypt>).  First, you put the
 terminal into "no echo" mode, then just read the password normally.
-You may do this with an old-style ioctl() function, POSIX terminal
+You may do this with an old-style C<ioctl()> function, POSIX terminal
 control (see L<POSIX> or its documentation the Camel Book), or a call
 to the B<stty> program, with varying degrees of portability.
 
-You can also do this for most systems using the Term::ReadKey module
+You can also do this for most systems using the C<Term::ReadKey> module
 from CPAN, which is easier to use and in theory more portable.
 
 	use Term::ReadKey;
@@ -281,8 +281,8 @@
 If you expect to use both read and write operations on the device,
 you'll have to open it for update (see L<perlfunc/"open"> for
 details).  You may wish to open it without running the risk of
-blocking by using sysopen() and C<O_RDWR|O_NDELAY|O_NOCTTY> from the
-Fcntl module (part of the standard perl distribution).  See
+blocking by using C<sysopen()> and C<O_RDWR|O_NDELAY|O_NOCTTY> from the
+C<Fcntl> module (part of the standard perl distribution).  See
 L<perlfunc/"sysopen"> for more on this approach.
 
 =item end of line
@@ -305,8 +305,8 @@
 
 =item flushing output
 
-If you expect characters to get to your device when you print() them,
-you'll want to autoflush that filehandle.  You can use select()
+If you expect characters to get to your device when you C<print()> them,
+you'll want to autoflush that filehandle.  You can use C<select()>
 and the C<$|> variable to control autoflushing (see L<perlvar/$E<verbar>>
 and L<perlfunc/select>, or L<perlfaq5>, "How do I flush/unbuffer an
 output filehandle?  Why must I do this?"):
@@ -320,7 +320,7 @@
 	select((select(DEV), $| = 1)[0]);
 
 Or if you don't mind pulling in a few thousand lines
-of code just because you're afraid of a little $| variable:
+of code just because you're afraid of a little C<$|> variable:
 
 	use IO::Handle;
 	DEV->autoflush(1);
@@ -331,19 +331,20 @@
 
 =item non-blocking input
 
-If you are doing a blocking read() or sysread(), you'll have to
+If you are doing a blocking C<read()> or C<sysread()>, you'll have to
 arrange for an alarm handler to provide a timeout (see
 L<perlfunc/alarm>).  If you have a non-blocking open, you'll likely
 have a non-blocking read, which means you may have to use a 4-arg
-select() to determine whether I/O is ready on that device (see
+C<select()> to determine whether I/O is ready on that device (see
 L<perlfunc/"select">.
 
 =back
 
-While trying to read from his caller-id box, the notorious Jamie Zawinski
-C<< <jwz@netscape.com> >>, after much gnashing of teeth and fighting with sysread,
-sysopen, POSIX's tcgetattr business, and various other functions that
-go bump in the night, finally came up with this:
+While trying to read from his caller-id box, the notorious Jamie
+Zawinski C<< <jwz@netscape.com> >>, after much gnashing of teeth and
+fighting with C<sysread>, C<sysopen>, POSIX's C<tcgetattr> business,
+and various other functions that go bump in the night, finally came up
+with this:
 
 	sub open_modem {
 		use IPC::Open2;
@@ -384,12 +385,13 @@
 tasks. Process management depends on your particular operating system,
 and many of the techniques are in L<perlipc>.
 
-Several CPAN modules may be able to help, including IPC::Open2 or
-IPC::Open3, IPC::Run, Parallel::Jobs, Parallel::ForkManager, POE,
-Proc::Background, and Win32::Process. There are many other modules you
-might use, so check those namespaces for other options too.
+Several CPAN modules may be able to help, including C<IPC::Open2> or
+C<IPC::Open3>, C<IPC::Run>, C<Parallel::Jobs>,
+C<Parallel::ForkManager>, C<POE>, C<Proc::Background>, and
+C<Win32::Process>. There are many other modules you might use, so
+check those namespaces for other options too.
 
-If you are on a unix-like system, you might be able to get away with a
+If you are on a Unix-like system, you might be able to get away with a
 system call where you put an C<&> on the end of the command:
 
 	system("cmd &")
@@ -424,8 +426,8 @@
 
 	$SIG{CHLD} = 'IGNORE';
 
-You can also use a double fork. You immediately wait() for your
-first child, and the init daemon will wait() for your grandchild once
+You can also use a double fork. You immediately C<wait()> for your
+first child, and the init daemon will C<wait()> for your grandchild once
 it exits.
 
 	unless ($pid = fork) {
@@ -450,8 +452,8 @@
 Signals are documented in L<perlipc/"Signals"> and the
 section on "Signals" in the Camel.
 
-You can set the values of the %SIG hash to be the functions you want
-to handle the signal.  After perl catches the signal, it looks in %SIG
+You can set the values of the C<%SIG> hash to be the functions you want
+to handle the signal.  After perl catches the signal, it looks in C<%SIG>
 for a key with the same name as the signal, then calls the subroutine
 value for that key.
 
@@ -469,24 +471,24 @@
 
 Perl versions before 5.8 had in its C source code signal handlers which
 would catch the signal and possibly run a Perl function that you had set
-in %SIG.  This violated the rules of signal handling at that level
-causing perl to dump core. Since version 5.8.0, perl looks at %SIG
-*after* the signal has been caught, rather than while it is being caught.
+in C<%SIG>.  This violated the rules of signal handling at that level
+causing perl to dump core. Since version 5.8.0, perl looks at C<%SIG>
+B<after> the signal has been caught, rather than while it is being caught.
 Previous versions of this answer were incorrect.
 
 =head2 How do I modify the shadow password file on a Unix system?
 
 If perl was installed correctly and your shadow library was written
-properly, the getpw*() functions described in L<perlfunc> should in
+properly, the C<getpw*()> functions described in L<perlfunc> should in
 theory provide (read-only) access to entries in the shadow password
 file.  To change the file, make a new shadow password file (the format
 varies from system to system--see L<passwd> for specifics) and use
-pwd_mkdb(8) to install it (see L<pwd_mkdb> for more details).
+C<pwd_mkdb(8)> to install it (see L<pwd_mkdb> for more details).
 
 =head2 How do I set the time and date?
 
 Assuming you're running under sufficient permissions, you should be
-able to set the system-wide date and time by running the date(1)
+able to set the system-wide date and time by running the C<date(1)>
 program.  (There is no way to set the time and date on a per-process
 basis.)  This mechanism will work for Unix, MS-DOS, Windows, and NT;
 the VMS equivalent is C<set time>.
@@ -494,7 +496,7 @@
 However, if all you want to do is change your time zone, you can
 probably get away with setting an environment variable:
 
-	$ENV{TZ} = "MST7MDT";		   # unixish
+	$ENV{TZ} = "MST7MDT";		   # Unixish
 	$ENV{'SYS$TIMEZONE_DIFFERENTIAL'}="-5" # vms
 	system "trn comp.lang.perl.misc";
 
@@ -521,33 +523,33 @@
 
 =head2 How can I do an atexit() or setjmp()/longjmp()? (Exception handling)
 
-Release 5 of Perl added the END block, which can be used to simulate
-atexit().  Each package's END block is called when the program or
-thread ends (see L<perlmod> manpage for more details).
+You can use the C<END> block to simulate C<atexit()>. Each package's
+C<END> block is called when the program or thread ends See L<perlmod>
+manpage for more details about C<END> blocks.
 
-For example, you can use this to make sure your filter program
-managed to finish its output without filling up the disk:
+For example, you can use this to make sure your filter program managed
+to finish its output without filling up the disk:
 
 	END {
 		close(STDOUT) || die "stdout close failed: $!";
 	}
 
-The END block isn't called when untrapped signals kill the program,
-though, so if you use END blocks you should also use
+The C<END> block isn't called when untrapped signals kill the program,
+though, so if you use C<END> blocks you should also use
 
 	use sigtrap qw(die normal-signals);
 
-Perl's exception-handling mechanism is its eval() operator.  You can
-use eval() as setjmp and die() as longjmp.  For details of this, see
-the section on signals, especially the time-out handler for a blocking
-flock() in L<perlipc/"Signals"> or the section on "Signals" in
-the Camel Book.
+Perl's exception-handling mechanism is its C<eval()> operator.  You
+can use C<eval()> as C<setjmp> and C<die()> as C<longjmp>. For
+details of this, see the section on signals, especially the time-out
+handler for a blocking C<flock()> in L<perlipc/"Signals"> or the
+section on "Signals" in I<Programming Perl>.
 
-If exception handling is all you're interested in, try the
-exceptions.pl library (part of the standard perl distribution).
+If exception handling is all you're interested in, use one of the 
+many CPAN modules that handle exceptions, such as C<Try::Tiny>.
 
-If you want the atexit() syntax (and an rmexit() as well), try the
-AtExit module available from CPAN.
+If you want the C<atexit()> syntax (and an C<rmexit()> as well), try the
+C<AtExit> module available from CPAN.
 
 =head2 Why doesn't my sockets program work under System V (Solaris)?  What does the error message "Protocol not supported" mean?
 
@@ -564,24 +566,24 @@
 In most cases, you write an external module to do it--see the answer
 to "Where can I learn about linking C with Perl? [h2xs, xsubpp]".
 However, if the function is a system call, and your system supports
-syscall(), you can use the syscall function (documented in
+C<syscall()>, you can use the C<syscall> function (documented in
 L<perlfunc>).
 
 Remember to check the modules that came with your distribution, and
 CPAN as well--someone may already have written a module to do it. On
-Windows, try Win32::API.  On Macs, try Mac::Carbon.  If no module
+Windows, try C<Win32::API>.  On Macs, try C<Mac::Carbon>.  If no module
 has an interface to the C function, you can inline a bit of C in your
-Perl source with Inline::C.
+Perl source with C<Inline::C>.
 
 =head2 Where do I get the include files to do ioctl() or syscall()?
 
-Historically, these would be generated by the h2ph tool, part of the
-standard perl distribution.  This program converts cpp(1) directives
+Historically, these would be generated by the C<h2ph> tool, part of the
+standard perl distribution.  This program converts C<cpp(1)> directives
 in C header files to files containing subroutine definitions, like
-&SYS_getitimer, which you can use as arguments to your functions.
+C<&SYS_getitimer>, which you can use as arguments to your functions.
 It doesn't work perfectly, but it usually gets most of the job done.
 Simple files like F<errno.h>, F<syscall.h>, and F<socket.h> were fine,
-but the hard ones like F<ioctl.h> nearly always need to hand-edited.
+but the hard ones like F<ioctl.h> nearly always need to be hand-edited.
 Here's how to install the *.ph files:
 
 	1.  become super-user
@@ -589,12 +591,12 @@
 	3.  h2ph *.h */*.h
 
 If your system supports dynamic loading, for reasons of portability and
-sanity you probably ought to use h2xs (also part of the standard perl
+sanity you probably ought to use C<h2xs> (also part of the standard perl
 distribution).  This tool converts C header files to Perl extensions.
-See L<perlxstut> for how to get started with h2xs.
+See L<perlxstut> for how to get started with C<h2xs>.
 
 If your system doesn't support dynamic loading, you still probably
-ought to use h2xs.  See L<perlxstut> and L<ExtUtils::MakeMaker> for
+ought to use C<h2xs>.  See L<perlxstut> and L<ExtUtils::MakeMaker> for
 more information (in brief, just use B<make perl> instead of a plain
 B<make> to rebuild perl with a new static extension).
 
@@ -606,20 +608,20 @@
 
 =head2 How can I open a pipe both to and from a command?
 
-The IPC::Open2 module (part of the standard perl distribution) is an
-easy-to-use approach that internally uses pipe(), fork(), and exec() to do
-the job.  Make sure you read the deadlock warnings in its documentation,
-though (see L<IPC::Open2>).  See
+The C<IPC::Open2> module (part of the standard perl distribution) is
+an easy-to-use approach that internally uses C<pipe()>, C<fork()>, and
+C<exec()> to do the job.  Make sure you read the deadlock warnings in
+its documentation, though (see L<IPC::Open2>).  See
 L<perlipc/"Bidirectional Communication with Another Process"> and
 L<perlipc/"Bidirectional Communication with Yourself">
 
-You may also use the IPC::Open3 module (part of the standard perl
+You may also use the C<IPC::Open3> module (part of the standard perl
 distribution), but be warned that it has a different order of
-arguments from IPC::Open2 (see L<IPC::Open3>).
+arguments from C<IPC::Open2> (see L<IPC::Open3>).
 
 =head2 Why can't I get the output of a command with system()?
 
-You're confusing the purpose of system() and backticks (``).  system()
+You're confusing the purpose of C<system()> and backticks (``).  C<system()>
 runs a command and returns exit status information (as a 16 bit value:
 the low 7 bits are the signal the process died from, if any, and
 the high 8 bits are the actual exit value).  Backticks (``) run a
@@ -636,11 +638,11 @@
 	$output = `$cmd`;		# using backticks (``)
 	open (PIPE, "cmd |");	# using open()
 
-With system(), both STDOUT and STDERR will go the same place as the
-script's STDOUT and STDERR, unless the system() command redirects them.
-Backticks and open() read B<only> the STDOUT of your command.
+With C<system()>, both STDOUT and STDERR will go the same place as the
+script's STDOUT and STDERR, unless the C<system()> command redirects them.
+Backticks and C<open()> read B<only> the STDOUT of your command.
 
-You can also use the open3() function from IPC::Open3.  Benjamin
+You can also use the C<open3()> function from C<IPC::Open3>.  Benjamin
 Goldberg provides some sample code:
 
 To capture a program's STDOUT, but discard its STDERR:
@@ -686,7 +688,7 @@
 	while( <CATCHOUT> ) {}
 	while( <CATCHERR> ) {}
 
-But there's no real need for *both* to be tempfiles... the following
+But there's no real need for B<both> to be tempfiles... the following
 should work just as well, without deadlocking:
 
 	use IPC::Open3;
@@ -725,13 +727,13 @@
 	open(STDERR, ">&STDOUT");
 	$alloutput = `cmd args`;  # stderr still escapes
 
-This fails because the open() makes STDERR go to where STDOUT was
-going at the time of the open().  The backticks then make STDOUT go to
+This fails because the C<open()> makes STDERR go to where STDOUT was
+going at the time of the C<open()>.  The backticks then make STDOUT go to
 a string, but don't change STDERR (which still goes to the old
 STDOUT).
 
-Note that you I<must> use Bourne shell (sh(1)) redirection syntax in
-backticks, not csh(1)!  Details on why Perl's system() and backtick
+Note that you I<must> use Bourne shell (C<sh(1)>) redirection syntax in
+backticks, not C<csh(1)>!  Details on why Perl's C<system()> and backtick
 and pipe opens all use the Bourne shell are in the
 F<versus/csh.whynot> article in the "Far More Than You Ever Wanted To
 Know" collection in http://www.cpan.org/misc/olddoc/FMTEYEWTK.tgz .  To
@@ -778,17 +780,17 @@
 
 =head2 Why doesn't open() return an error when a pipe open fails?
 
-If the second argument to a piped open() contains shell
-metacharacters, perl fork()s, then exec()s a shell to decode the
+If the second argument to a piped C<open()> contains shell
+metacharacters, perl C<fork()>s, then C<exec()>s a shell to decode the
 metacharacters and eventually run the desired program.  If the program
 couldn't be run, it's the shell that gets the message, not Perl. All
 your Perl program can find out is whether the shell itself could be
 successfully started.  You can still capture the shell's STDERR and
 check it for error messages.  See L<"How can I capture STDERR from an
 external command?"> elsewhere in this document, or use the
-IPC::Open3 module.
+C<IPC::Open3> module.
 
-If there are no shell metacharacters in the argument of open(), Perl
+If there are no shell metacharacters in the argument of C<open()>, Perl
 runs the command directly, without using the shell, and can correctly
 report whether the command started.
 
@@ -863,10 +865,11 @@
 
 =head2 Why can't my script read from STDIN after I gave it EOF (^D on Unix, ^Z on MS-DOS)?
 
-Some stdio's set error and eof flags that need clearing.  The
-POSIX module defines clearerr() that you can use.  That is the
-technically correct way to do it.  Here are some less reliable
-workarounds:
+This happens only if your perl is compiled to use stdio instead of
+perlio, which is the default. Some (maybe all?) stdios set error and
+eof flags that you may need to clear. The C<POSIX> module defines
+C<clearerr()> that you can use.  That is the technically correct way to
+do it.  Here are some less reliable workarounds:
 
 =over 4
 
@@ -905,10 +908,11 @@
 
 =head2 Can I use perl to run a telnet or ftp session?
 
-Try the Net::FTP, TCP::Client, and Net::Telnet modules (available from
-CPAN).  http://www.cpan.org/scripts/netstuff/telnet.emul.shar
-will also help for emulating the telnet protocol, but Net::Telnet is
-quite probably easier to use..
+Try the C<Net::FTP>, C<TCP::Client>, and C<Net::Telnet> modules
+(available from CPAN).
+http://www.cpan.org/scripts/netstuff/telnet.emul.shar will also help
+for emulating the telnet protocol, but C<Net::Telnet> is quite
+probably easier to use.
 
 If all you want to do is pretend to be telnet but don't need
 the initial telnet handshaking, then the standard dual-process
@@ -929,11 +933,11 @@
 
 =head2 How can I write expect in Perl?
 
-Once upon a time, there was a library called chat2.pl (part of the
+Once upon a time, there was a library called L<chat2.pl> (part of the
 standard perl distribution), which never really got finished.  If you
 find it somewhere, I<don't use it>.  These days, your best bet is to
 look at the Expect module available from CPAN, which also requires two
-other modules from CPAN, IO::Pty and IO::Stty.
+other modules from CPAN, C<IO::Pty> and C<IO::Stty>.
 
 =head2 Is there a way to hide perl's command line from programs such as "ps"?
 
@@ -960,7 +964,7 @@
 different process from the shell it was started from.  Changes to a
 process are not reflected in its parent--only in any children
 created after the change.  There is shell magic that may allow you to
-fake it by eval()ing the script's output in your shell; check out the
+fake it by C<eval()>ing the script's output in your shell; check out the
 comp.unix.questions FAQ for details.
 
 =back
@@ -983,7 +987,7 @@
 =item *
 
 Open /dev/tty and use the TIOCNOTTY ioctl on it.  See L<tty>
-for details.  Or better yet, you can just use the POSIX::setsid()
+for details.  Or better yet, you can just use the C<POSIX::setsid()>
 function, so you don't have to worry about process groups.
 
 =item *
@@ -1003,45 +1007,58 @@
 
 =back
 
-The Proc::Daemon module, available from CPAN, provides a function to
+The C<Proc::Daemon> module, available from CPAN, provides a function to
 perform these actions for you.
 
 =head2 How do I find out if I'm running interactively or not?
 
-Good question. Sometimes C<-t STDIN> and C<-t STDOUT> can give clues,
-sometimes not.
+(contributed by brian d foy)
 
-	if (-t STDIN && -t STDOUT) {
-		print "Now what? ";
-		}
+This is a difficult question to answer, and the best answer is
+only a guess.
 
-On POSIX systems, you can test whether your own process group matches
-the current process group of your controlling terminal as follows:
+What do you really want to know? If you merely want to know if one of
+your filehandles is connected to a terminal, you can try the C<-t>
+file test:
 
-	use POSIX qw/getpgrp tcgetpgrp/;
+	if( -t STDOUT ) {
+		print "I'm connected to a terminal!\n";
+		}
 
-	# Some POSIX systems, such as Linux, can be
-	# without a /dev/tty at boot time.
-	if (!open(TTY, "/dev/tty")) {
-		print "no tty\n";
-	} else {
-		$tpgrp = tcgetpgrp(fileno(*TTY));
-		$pgrp = getpgrp();
-		if ($tpgrp == $pgrp) {
-			print "foreground\n";
-		} else {
-			print "background\n";
+However, you might be out of luck if you expect that means there is a
+real person on the other side. With the C<Expect> module, another
+program can pretend to be a person. The program might even come close
+to passing the Turing test.
+
+The C<IO::Interactive> module does the best it can to give you an
+answer. Its C<is_interactive> function returns an output filehandle;
+that filehandle points to standard output if the module thinks the
+session is interactive. Otherwise, the filehandle is a null handle
+that simply discards the output:
+
+	use IO::Interactive;
+
+	print { is_interactive } "I might go to standard output!\n";
+
+This still doesn't guarantee that a real person is answering your
+prompts or reading your output.
+
+If you want to know how to handle automated testing for your
+distribution, you can check the environment. The CPAN
+Testers, for instance, set the value of C<AUTOMATED_TESTING>:
+
+	unless( $ENV{AUTOMATED_TESTING} ) {
+		print "Hello interactive tester!\n";
 		}
-	}
 
 =head2 How do I timeout a slow event?
 
-Use the alarm() function, probably in conjunction with a signal
+Use the C<alarm()> function, probably in conjunction with a signal
 handler, as documented in L<perlipc/"Signals"> and the section on
 "Signals" in the Camel.  You may instead use the more flexible
-Sys::AlarmCall module available from CPAN.
+C<Sys::AlarmCall> module available from CPAN.
 
-The alarm() function is not implemented on all versions of Windows.
+The C<alarm()> function is not implemented on all versions of Windows.
 Check the documentation for your specific version of Perl.
 
 =head2 How do I set CPU limits?
@@ -1066,25 +1083,25 @@
 
 =head2 How do I avoid zombies on a Unix system?
 
-Use the reaper code from L<perlipc/"Signals"> to call wait() when a
+Use the reaper code from L<perlipc/"Signals"> to call C<wait()> when a
 SIGCHLD is received, or else use the double-fork technique described
 in L<perlfaq8/"How do I start a process in the background?">.
 
 =head2 How do I use an SQL database?
 
-The DBI module provides an abstract interface to most database
+The C<DBI> module provides an abstract interface to most database
 servers and types, including Oracle, DB2, Sybase, mysql, Postgresql,
 ODBC, and flat files.  The DBI module accesses each database type
 through a database driver, or DBD.  You can see a complete list of
 available drivers on CPAN: http://www.cpan.org/modules/by-module/DBD/ .
 You can read more about DBI on http://dbi.perl.org .
 
-Other modules provide more specific access: Win32::ODBC, Alzabo, iodbc,
-and others found on CPAN Search: http://search.cpan.org .
+Other modules provide more specific access: C<Win32::ODBC>, C<Alzabo>,
+C<iodbc>, and others found on CPAN Search: http://search.cpan.org .
 
 =head2 How do I make a system() exit on control-C?
 
-You can't.  You need to imitate the system() call (see L<perlipc> for
+You can't.  You need to imitate the C<system()> call (see L<perlipc> for
 sample code) and then have a signal handler for the INT signal that
 passes the signal on to the subprocess.  Or you can check for it:
 
@@ -1095,8 +1112,8 @@
 
 If you're lucky enough to be using a system that supports
 non-blocking reads (most Unixish systems do), you need only to use the
-O_NDELAY or O_NONBLOCK flag from the Fcntl module in conjunction with
-sysopen():
+C<O_NDELAY> or C<O_NONBLOCK> flag from the C<Fcntl> module in conjunction with
+C<sysopen()>:
 
 	use Fcntl;
 	sysopen(FH, "/foo/somefile", O_WRONLY|O_NDELAY|O_CREAT, 0644)
@@ -1121,7 +1138,7 @@
 	print "Hello World\n";
 
 I get an error when I run this from my shell (which happens to be
-bash).  That may look like perl forgot it has a print() function,
+bash).  That may look like perl forgot it has a C<print()> function,
 but my shebang line is not the path to perl, so the shell runs the
 script, and I get the error.
 
@@ -1142,7 +1159,7 @@
 	$x / 0;
 	__END__
 
-The perl message comes out with "Perl" in front.  The BEGIN block
+The perl message comes out with "Perl" in front.  The C<BEGIN> block
 works at compile time so all of the compilation errors and warnings
 get the "Perl:" prefix too.
 
@@ -1158,7 +1175,7 @@
 
 You could also just know all the perl errors, and although there are
 some people who may know all of them, you probably don't.  However, they
-all should be in the perldiag manpage. If you don't find the error in
+all should be in the L<perldiag> manpage. If you don't find the error in
 there, it probably isn't a perl error.
 
 Looking up every message is not the easiest way, so let perl to do it
@@ -1172,50 +1189,44 @@
 
 =head2 How do I install a module from CPAN?
 
-The easiest way is to have a module also named CPAN do it for you.
-This module comes with perl version 5.004 and later.
-
-	$ perl -MCPAN -e shell
-
-	cpan shell -- CPAN exploration and modules installation (v1.59_54)
-	ReadLine support enabled
-
-	cpan> install Some::Module
-
-To manually install the CPAN module, or any well-behaved CPAN module
-for that matter, follow these steps:
+(contributed by brian d foy)
 
-=over 4
+The easiest way is to have a module also named CPAN do it for you by using
+the C<cpan> command the comes with Perl. You can give it a list of modules
+to install:
 
-=item 1
+	$ cpan IO::Interactive Getopt::Whatever
 
-Unpack the source into a temporary area.
+If you prefer C<CPANPLUS>, it's just as easy:
 
-=item 2
+	$ cpanp i IO::Interactive Getopt::Whatever
 
-	perl Makefile.PL
+If you want to install a distribution from the current directory, you can
+tell C<CPAN.pm> to install C<.> (the full stop):
 
-=item 3
+	$ cpan .
 
-	make
+See the documentation for either of those commands to see what else
+you can do.
 
-=item 4
+If you want to try to install a distribution by yourself, resolving
+all dependencies on your own, you follow one of two possible build
+paths.
 
-	make test
+For distributions that use I<Makefile.PL>:
 
-=item 5
+	$ perl Makefile.PL
+	$ make test install
 
-	make install
+For distributions that use I<Build.PL>:
 
-=back
+	$ perl Build.PL
+	$ ./Build test
+	$ ./Build install
 
-If your version of perl is compiled without dynamic loading, then you
-just need to replace step 3 (B<make>) with B<make perl> and you will
-get a new F<perl> binary with your extension linked in.
-
-See L<ExtUtils::MakeMaker> for more details on building extensions.
-See also the next question, "What's the difference between require
-and use?".
+Some distributions may need to link to libraries or other third-party
+code and their build and installation sequences may be more complicated.
+Check any I<README> or I<INSTALL> files that you may find.
 
 =head2 What's the difference between require and use?
 
@@ -1252,15 +1263,24 @@
 
 =head2 How do I keep my own module/library directory?
 
-When you build modules, tell Perl where to install the modules.
+When you build modules, tell Perl where to install the modules. 
+
+If you want to install modules for your own use, the easiest way might
+be C<local::lib>, which you can download from CPAN. It sets various
+installation settings for you, and uses those same settings within
+your programs.
+
+If you want more flexibility, you need to configure your CPAN client
+for your particular situation.
 
 For C<Makefile.PL>-based distributions, use the INSTALL_BASE option
 when generating Makefiles:
 
 	perl Makefile.PL INSTALL_BASE=/mydir/perl
 
-You can set this in your CPAN.pm configuration so modules automatically install
-in your private library directory when you use the CPAN.pm shell:
+You can set this in your C<CPAN.pm> configuration so modules
+automatically install in your private library directory when you use
+the CPAN.pm shell:
 
 	% cpan
 	cpan> o conf makepl_arg INSTALL_BASE=/mydir/perl
@@ -1270,24 +1290,24 @@
 
 	perl Build.PL --install_base /mydir/perl
 
-You can configure CPAN.pm to automatically use this option too:
+You can configure C<CPAN.pm> to automatically use this option too:
 
 	% cpan
-	cpan> o conf mbuild_arg --install_base /mydir/perl
+	cpan> o conf mbuild_arg "--install_base /mydir/perl"
 	cpan> o conf commit
 
 INSTALL_BASE tells these tools to put your modules into
 F</mydir/perl/lib/perl5>.  See L<How do I add a directory to my
 include path (@INC) at runtime?> for details on how to run your newly
-installed moudles.
+installed modules.
 
 There is one caveat with INSTALL_BASE, though, since it acts
 differently than the PREFIX and LIB settings that older versions of
-ExtUtils::MakeMaker advocated. INSTALL_BASE does not support
+C<ExtUtils::MakeMaker> advocated. INSTALL_BASE does not support
 installing modules for multiple versions of Perl or different
 architectures under the same directory. You should consider if you
 really want that , and if you do, use the older PREFIX and LIB
-settings. See the ExtUtils::Makemaker documentation for more details.
+settings. See the C<ExtUtils::Makemaker> documentation for more details.
 
 =head2 How do I add the directory my program lives in to the module/library search path?
 
@@ -1329,6 +1349,14 @@
 you can then use to construct the right library path:
 
 	use FindBin qw($Bin);
+	
+You can also use C<local::lib> to do much of the same thing. Install
+modules using C<local::lib>'s settings then use the module in your 
+program:
+
+	 use local::lib; # sets up a local lib at ~/perl5
+
+See the C<local::lib> documentation for more details.
 
 =head2 How do I add a directory to my include path (@INC) at runtime?
 
@@ -1337,47 +1365,45 @@
 
 =over 4
 
-=item the PERLLIB environment variable
+=item the C<PERLLIB> environment variable
 
 	$ export PERLLIB=/path/to/my/dir
 	$ perl program.pl
 
-=item the PERL5LIB environment variable
+=item the C<PERL5LIB> environment variable
 
 	$ export PERL5LIB=/path/to/my/dir
 	$ perl program.pl
 
-=item the perl -Idir command line flag
+=item the C<perl -Idir> command line flag
 
 	$ perl -I/path/to/my/dir program.pl
 
-=item the use lib pragma:
+=item the C<lib> pragma:
 
 	use lib "$ENV{HOME}/myown_perllib";
 
+=item the C<local::lib> module:
+
+	use local::lib;
+	
+	use local::lib "~/myown_perllib";
+	
 =back
 
 The last is particularly useful because it knows about machine
-dependent architectures.  The lib.pm pragmatic module was first
+dependent architectures.  The C<lib.pm> pragmatic module was first
 included with the 5.002 release of Perl.
 
 =head2 What is socket.ph and where do I get it?
 
 It's a Perl 4 style file defining values for system networking
-constants.  Sometimes it is built using h2ph when Perl is installed,
+constants.  Sometimes it is built using C<h2ph> when Perl is installed,
 but other times it is not.  Modern programs C<use Socket;> instead.
 
-=head1 REVISION
-
-Revision: $Revision$
-
-Date: $Date$
-
-See L<perlfaq> for source control details and availability.
-
 =head1 AUTHOR AND COPYRIGHT
 
-Copyright (c) 1997-2009 Tom Christiansen, Nathan Torkington, and
+Copyright (c) 1997-2010 Tom Christiansen, Nathan Torkington, and
 other authors as noted. All rights reserved.
 
 This documentation is free; you can redistribute it and/or modify it
Index: src/gnu/usr.bin/perl/pod/perlfaq9.pod
diff -u src/gnu/usr.bin/perl/pod/perlfaq9.pod:1.10 src/gnu/usr.bin/perl/pod/perlfaq9.pod:1.11
--- pod/perlfaq9.pod:1.10	Mon Oct 12 18:24:47 2009
+++ pod/perlfaq9.pod	Fri Sep 24 15:07:04 2010
@@ -22,7 +22,7 @@
 Other relevant documentation listed in: http://www.perl.org/CGI_MetaFAQ.html
 
 These Perl FAQs very selectively cover some CGI issues. However, Perl
-programmers are strongly advised to use the CGI.pm module, to take care
+programmers are strongly advised to use the C<CGI.pm> module, to take care
 of the details for them.
 
 The similarity between CGI response headers (defined in the CGI
@@ -41,9 +41,9 @@
 to be terminated with carriage-return and line-feed, i.e ASCII \015\012
 written in binary mode.
 
-Using CGI.pm gives excellent platform independence, including EBCDIC
-systems. CGI.pm selects an appropriate newline representation
-($CGI::CRLF) and sets binmode as appropriate.
+Using C<CGI.pm> gives excellent platform independence, including EBCDIC
+systems. C<CGI.pm> selects an appropriate newline representation
+(C<$CGI::CRLF>) and sets binmode as appropriate.
 
 =head2 My CGI script runs from the command line but not the browser.  (500 Server Error)
 
@@ -67,8 +67,8 @@
 
 =head2 How can I get better error messages from a CGI program?
 
-Use the CGI::Carp module.  It replaces C<warn> and C<die>, plus the
-normal Carp modules C<carp>, C<croak>, and C<confess> functions with
+Use the C<CGI::Carp> module.  It replaces C<warn> and C<die>, plus the
+normal C<Carp> modules C<carp>, C<croak>, and C<confess> functions with
 more verbose and safer versions.  It still sends them to the normal
 server error log.
 
@@ -76,8 +76,8 @@
 	warn "This is a complaint";
 	die "But this one is serious";
 
-The following use of CGI::Carp also redirects errors to a file of your choice,
-placed in a BEGIN block to catch compile-time warnings as well:
+The following use of C<CGI::Carp> also redirects errors to a file of your choice,
+placed in a C<BEGIN> block to catch compile-time warnings as well:
 
 	BEGIN {
 		use CGI::Carp qw(carpout);
@@ -100,9 +100,9 @@
 
 =head2 How do I remove HTML from a string?
 
-The most correct way (albeit not the fastest) is to use HTML::Parser
+The most correct way (albeit not the fastest) is to use C<HTML::Parser>
 from CPAN.  Another mostly correct
-way is to use HTML::FormatText which not only removes HTML but also
+way is to use C<HTML::FormatText> which not only removes HTML but also
 attempts to do a little simple formatting of the resulting plain text.
 
 Many folks attempt a simple-minded regular expression approach, like
@@ -154,7 +154,7 @@
 C<HTML::SimpleLinkExtor> as an example for something specifically
 suited to your needs.
 
-You can use URI::Find to extract URLs from an arbitrary text document.
+You can use C<URI::Find> to extract URLs from an arbitrary text document.
 
 Less complete solutions involving regular expressions can save
 you a lot of processing time if you know that the input is simple.  One
@@ -176,20 +176,20 @@
 forms.  You allow the web surfer to specify a file to send to your web
 server.  To you it looks like a download, and to the user it looks
 like an upload.  No matter what you call it, you do it with what's
-known as B<multipart/form-data> encoding.  The CGI.pm module (which
+known as B<multipart/form-data> encoding.  The C<CGI.pm> module (which
 comes with Perl as part of the Standard Library) supports this in the
-start_multipart_form() method, which isn't the same as the startform()
+C<start_multipart_form()> method, which isn't the same as the C<startform()>
 method.
 
-See the section in the CGI.pm documentation on file uploads for code
+See the section in the C<CGI.pm> documentation on file uploads for code
 examples and details.
 
 =head2 How do I make an HTML pop-up menu with Perl?
 
 (contributed by brian d foy)
 
-The CGI.pm module (which comes with Perl) has functions to create
-the HTML form widgets. See the CGI.pm documentation for more
+The C<CGI.pm> module (which comes with Perl) has functions to create
+the HTML form widgets. See the C<CGI.pm> documentation for more
 examples.
 
 	use CGI qw/:standard/;
@@ -278,9 +278,9 @@
 
 	my $original = "Colon : Hash # Percent %";
 
-	my $escaped = uri_escape( $original )
+	my $escaped = uri_escape( $original );
 
-	print "$string\n"; # 'Colon%20%3A%20Hash%20%23%20Percent%20%25%20'
+	print "$escaped\n"; # 'Colon%20%3A%20Hash%20%23%20Percent%20%25'
 
 To decode the string, use the C<uri_unescape> function:
 
@@ -307,7 +307,7 @@
 the server without any HTTP redirection. The CGI specifications do not
 allow relative URLs in either case.
 
-Use of CGI.pm is strongly recommended.  This example shows redirection
+Use of C<CGI.pm> is strongly recommended.  This example shows redirection
 with a complete URL. This redirection is handled by the web browser.
 
 	use CGI qw/:standard/;
@@ -338,10 +338,10 @@
 
 =head2 How do I edit my .htpasswd and .htgroup files with Perl?
 
-The HTTPD::UserAdmin and HTTPD::GroupAdmin modules provide a
+The C<HTTPD::UserAdmin> and C<HTTPD::GroupAdmin> modules provide a
 consistent OO interface to these files, regardless of how they're
 stored.  Databases may be text, dbm, Berkeley DB or any database with
-a DBI compatible driver.  HTTPD::UserAdmin supports files used by the
+a DBI compatible driver.  C<HTTPD::UserAdmin> supports files used by the
 "Basic" and "Digest" authentication schemes.  Here's an example:
 
 	use HTTPD::UserAdmin ();
@@ -367,20 +367,20 @@
 
 That solution doesn't do well if, for example, you're trying to
 maintain all the Received lines.  A more complete approach is to use
-the Mail::Header module from CPAN (part of the MailTools package).
+the C<Mail::Header> module from CPAN (part of the C<MailTools> package).
 
 =head2 How do I decode a CGI form?
 
 (contributed by brian d foy)
 
-Use the CGI.pm module that comes with Perl.  It's quick,
+Use the C<CGI.pm> module that comes with Perl.  It's quick,
 it's easy, and it actually does quite a bit of work to
 ensure things happen correctly.  It handles GET, POST, and
 HEAD requests, multipart forms, multivalued fields, query
 string and message body combinations, and many other things
 you probably don't want to think about.
 
-It doesn't get much easier: the CGI module automatically
+It doesn't get much easier: the C<CGI.pm> module automatically
 parses the input and makes each value available through the
 C<param()> function.
 
@@ -390,7 +390,7 @@
 
 	my @items = param( 'item' ); # multiple values, same field name
 
-If you want an object-oriented approach, CGI.pm can do that too.
+If you want an object-oriented approach, C<CGI.pm> can do that too.
 
 	use CGI;
 
@@ -400,13 +400,13 @@
 
 	my @items = $cgi->param( 'item' );
 
-You might also try CGI::Minimal which is a lightweight version
+You might also try C<CGI::Minimal> which is a lightweight version
 of the same thing.  Other CGI::* modules on CPAN might work better
 for you, too.
 
 Many people try to write their own decoder (or copy one from
 another program) and then run into one of the many "gotchas"
-of the task.  It's much easier and less hassle to use CGI.pm.
+of the task.  It's much easier and less hassle to use C<CGI.pm>.
 
 =head2 How do I check a valid mail address?
 
@@ -464,18 +464,18 @@
 
 =head2 How do I decode a MIME/BASE64 string?
 
-The MIME-Base64 package (available from CPAN) handles this as well as
+The C<MIME-Base64> package (available from CPAN) handles this as well as
 the MIME/QP encoding.  Decoding BASE64 becomes as simple as:
 
 	use MIME::Base64;
 	$decoded = decode_base64($encoded);
 
-The MIME-Tools package (available from CPAN) supports extraction with
+The C<MIME-Tools> package (available from CPAN) supports extraction with
 decoding of BASE64 encoded attachments and content directly from email
 messages.
 
 If the string to decode is short (less than 84 bytes long)
-a more direct approach is to use the unpack() function's "u"
+a more direct approach is to use the C<unpack()> function's "u"
 format after minor transliterations:
 
 	tr#A-Za-z0-9+/##cd;                   # remove non-base64 chars
@@ -485,8 +485,8 @@
 
 =head2 How do I return the user's mail address?
 
-On systems that support getpwuid, the $< variable, and the
-Sys::Hostname module (which is part of the standard perl distribution),
+On systems that support getpwuid, the C<< $< >> variable, and the
+C<Sys::Hostname> module (which is part of the standard perl distribution),
 you can probably try using something like this:
 
 	use Sys::Hostname;
@@ -497,8 +497,8 @@
 users' mail addresses when this matters.  Furthermore, not all systems
 on which Perl runs are so forthcoming with this information as is Unix.
 
-The Mail::Util module from CPAN (part of the MailTools package) provides a
-mailaddress() function that tries to guess the mail address of the user.
+The C<Mail::Util> module from CPAN (part of the C<MailTools> package) provides a
+C<mailaddress()> function that tries to guess the mail address of the user.
 It makes a more intelligent guess than the code above, using information
 given when the module was installed, but it could still be incorrect.
 Again, the best way is often just to ask the user.
@@ -519,19 +519,19 @@
 	EOF
 	close(SENDMAIL)     or warn "sendmail didn't close nicely";
 
-The B<-oi> option prevents sendmail from interpreting a line consisting
+The B<-oi> option prevents C<sendmail> from interpreting a line consisting
 of a single dot as "end of message".  The B<-t> option says to use the
 headers to decide who to send the message to, and B<-odq> says to put
 the message into the queue.  This last option means your message won't
 be immediately delivered, so leave it out if you want immediate
 delivery.
 
-Alternate, less convenient approaches include calling mail (sometimes
-called mailx) directly or simply opening up port 25 have having an
+Alternate, less convenient approaches include calling C<mail> (sometimes
+called C<mailx>) directly or simply opening up port 25 have having an
 intimate conversation between just you and the remote SMTP daemon,
-probably sendmail.
+probably C<sendmail>.
 
-Or you might be able use the CPAN module Mail::Mailer:
+Or you might be able use the CPAN module C<Mail::Mailer>:
 
 	use Mail::Mailer;
 
@@ -544,14 +544,14 @@
 	print $mailer $body;
 	$mailer->close();
 
-The Mail::Internet module uses Net::SMTP which is less Unix-centric than
-Mail::Mailer, but less reliable.  Avoid raw SMTP commands.  There
-are many reasons to use a mail transport agent like sendmail.  These
+The C<Mail::Internet> module uses C<Net::SMTP> which is less Unix-centric than
+C<Mail::Mailer>, but less reliable.  Avoid raw SMTP commands.  There
+are many reasons to use a mail transport agent like C<sendmail>.  These
 include queuing, MX records, and security.
 
 =head2 How do I use MIME to make an attachment to a mail message?
 
-This answer is extracted directly from the MIME::Lite documentation.
+This answer is extracted directly from the C<MIME::Lite> documentation.
 Create a multipart message (i.e., one with attachments).
 
 	use MIME::Lite;
@@ -576,7 +576,7 @@
 
 	$text = $msg->as_string;
 
-MIME::Lite also includes a method for sending these things.
+C<MIME::Lite> also includes a method for sending these things.
 
 	$msg->send;
 
@@ -585,9 +585,9 @@
 
 =head2 How do I read mail?
 
-While you could use the Mail::Folder module from CPAN (part of the
-MailFolder package) or the Mail::Internet module from CPAN (part
-of the MailTools package), often a module is overkill.  Here's a
+While you could use the C<Mail::Folder> module from CPAN (part of the
+C<MailFolder> package) or the C<Mail::Internet> module from CPAN (part
+of the C<MailTools> package), often a module is overkill.  Here's a
 mail sorter.
 
 	#!/usr/bin/perl
@@ -621,7 +621,7 @@
 
 (contributed by brian d foy)
 
-The Net::Domain module, which is part of the standard distribution starting
+The C<Net::Domain> module, which is part of the standard distribution starting
 in perl5.7.3, can get you the fully qualified domain name (FQDN), the host
 name, or the domain name.
 
@@ -639,7 +639,7 @@
 To get the IP address, you can use the C<gethostbyname> built-in function
 to turn the name into a number. To turn that number into the dotted octet
 form (a.b.c.d) that most people expect, use the C<inet_ntoa> function
-from the <Socket> module, which also comes with perl.
+from the C<Socket> module, which also comes with perl.
 
 	use Socket;
 
@@ -649,7 +649,7 @@
 
 =head2 How do I fetch a news article or the active newsgroups?
 
-Use the Net::NNTP or News::NNTPClient modules, both available from CPAN.
+Use the C<Net::NNTP> or C<News::NNTPClient> modules, both available from CPAN.
 This can make tasks like fetching the newsgroup list as simple as
 
 	perl -MNews::NNTPClient
@@ -657,7 +657,7 @@
 
 =head2 How do I fetch/put an FTP file?
 
-LWP::Simple (available from CPAN) can fetch but not put.  Net::FTP (also
+C<LWP::Simple> (available from CPAN) can fetch but not put.  C<Net::FTP> (also
 available from CPAN) is more complex but can put as well as fetch.
 
 =head2 How can I do RPC in Perl?
@@ -667,17 +667,9 @@
 Use one of the RPC modules you can find on CPAN (
 http://search.cpan.org/search?query=RPC&mode=all ).
 
-=head1 REVISION
-
-Revision: $Revision$
-
-Date: $Date$
-
-See L<perlfaq> for source control details and availability.
-
 =head1 AUTHOR AND COPYRIGHT
 
-Copyright (c) 1997-2009 Tom Christiansen, Nathan Torkington, and
+Copyright (c) 1997-2010 Tom Christiansen, Nathan Torkington, and
 other authors as noted. All rights reserved.
 
 This documentation is free; you can redistribute it and/or modify it
Index: src/gnu/usr.bin/perl/pod/perlfunc.pod
diff -u src/gnu/usr.bin/perl/pod/perlfunc.pod:1.14 src/gnu/usr.bin/perl/pod/perlfunc.pod:1.15
--- pod/perlfunc.pod:1.14	Mon Oct 12 18:24:47 2009
+++ pod/perlfunc.pod	Fri Sep 24 15:07:04 2010
@@ -14,34 +14,34 @@
 a unary operator, but merely separates the arguments of a list
 operator.  A unary operator generally provides a scalar context to its
 argument, while a list operator may provide either scalar or list
-contexts for its arguments.  If it does both, the scalar arguments will
-be first, and the list argument will follow.  (Note that there can ever
-be only one such list argument.)  For instance, splice() has three scalar
+contexts for its arguments.  If it does both, scalar arguments 
+come first and list argument follow, and there can only ever
+be one such list argument.  For instance, splice() has three scalar
 arguments followed by a list, whereas gethostbyname() has four scalar
 arguments.
 
 In the syntax descriptions that follow, list operators that expect a
-list (and provide list context for the elements of the list) are shown
+list (and provide list context for elements of the list) are shown
 with LIST as an argument.  Such a list may consist of any combination
 of scalar arguments or list values; the list values will be included
 in the list as if each individual element were interpolated at that
 point in the list, forming a longer single-dimensional list value.
-Commas should separate elements of the LIST.
+Commas should separate literal elements of the LIST.
 
 Any function in the list below may be used either with or without
 parentheses around its arguments.  (The syntax descriptions omit the
-parentheses.)  If you use the parentheses, the simple (but occasionally
-surprising) rule is this: It I<looks> like a function, therefore it I<is> a
+parentheses.)  If you use parentheses, the simple but occasionally 
+surprising rule is this: It I<looks> like a function, therefore it I<is> a
 function, and precedence doesn't matter.  Otherwise it's a list
-operator or unary operator, and precedence does matter.  And whitespace
-between the function and left parenthesis doesn't count--so you need to
-be careful sometimes:
-
-    print 1+2+4;	# Prints 7.
-    print(1+2) + 4;	# Prints 3.
-    print (1+2)+4;	# Also prints 3!
-    print +(1+2)+4;	# Prints 7.
-    print ((1+2)+4);	# Prints 7.
+operator or unary operator, and precedence does matter.  Whitespace
+between the function and left parenthesis doesn't count, so sometimes
+you need to be careful:
+
+    print 1+2+4;      # Prints 7.
+    print(1+2) + 4;   # Prints 3.
+    print (1+2)+4;    # Also prints 3!
+    print +(1+2)+4;   # Prints 7.
+    print ((1+2)+4);  # Prints 7.
 
 If you run Perl with the B<-w> switch it can warn you about this.  For
 example, the third line above produces:
@@ -57,12 +57,12 @@
 For functions that can be used in either a scalar or list context,
 nonabortive failure is generally indicated in a scalar context by
 returning the undefined value, and in a list context by returning the
-null list.
+empty list.
 
 Remember the following important rule: There is B<no rule> that relates
 the behavior of an expression in list context to its behavior in scalar
 context, or vice versa.  It might do two totally different things.
-Each operator and function decides which sort of value it would be most
+Each operator and function decides which sort of value would be most
 appropriate to return in scalar context.  Some operators return the
 length of the list that would have been returned in list context.  Some
 operators return the first value in the list.  Some operators return the
@@ -78,7 +78,7 @@
 there, not the list construction version of the comma.  That means it
 was never a list to start with.
 
-In general, functions in Perl that serve as wrappers for system calls
+In general, functions in Perl that serve as wrappers for system calls ("syscalls")
 of the same name (like chown(2), fork(2), closedir(2), etc.) all return
 true when they succeed and C<undef> otherwise, as is usually mentioned
 in the descriptions below.  This is different from the C interfaces,
@@ -86,6 +86,14 @@
 C<waitpid>, and C<syscall>.  System calls also set the special C<$!>
 variable on failure.  Other functions do not, except accidentally.
 
+Extension modules can also hook into the Perl parser to define new
+kinds of keyword-headed expression.  These may look like functions, but
+may also look completely different.  The syntax following the keyword
+is defined entirely by the extension.  If you are an implementor, see
+L<perlapi/PL_keyword_plugin> for the mechanism.  If you are using such
+a module, see the module's documentation for details of the syntax that
+it defines.
+
 =head2 Perl Functions by Category
 X<function>
 
@@ -160,7 +168,7 @@
 
 C<break>, C<continue>, C<given>, C<when>, C<default>
 
-(These are only available if you enable the "switch" feature.
+(These are available only if you enable the C<"switch"> feature.
 See L<feature> and L<perlsyn/"Switch statements">.)
 
 =item Keywords related to scoping
@@ -168,7 +176,7 @@
 C<caller>, C<import>, C<local>, C<my>, C<our>, C<state>, C<package>,
 C<use>
 
-(C<state> is only available if the "state" feature is enabled. See
+(C<state> is available only if the C<"state"> feature is enabled. See
 L<feature>.)
 
 =item Miscellaneous functions
@@ -183,7 +191,7 @@
 C<pipe>, C<qx//>, C<setpgrp>, C<setpriority>, C<sleep>, C<system>,
 C<times>, C<wait>, C<waitpid>
 
-=item Keywords related to perl modules
+=item Keywords related to Perl modules
 X<module>
 
 C<do>, C<import>, C<no>, C<package>, C<require>, C<use>
@@ -237,7 +245,7 @@
 C<readline>, C<readpipe>, C<ref>, C<sub>*, C<sysopen>, C<tie>, C<tied>, C<uc>,
 C<ucfirst>, C<untie>, C<use>, C<when>
 
-* - C<sub> was a keyword in perl4, but in perl5 it is an
+* C<sub> was a keyword in Perl 4, but in Perl 5 it is an
 operator, which can be used in expressions.
 
 =item Functions obsoleted in perl5
@@ -278,7 +286,7 @@
 
 =head2 Alphabetical Listing of Perl Functions
 
-=over 8
+=over 
 
 =item -X FILEHANDLE
 X<-r>X<-w>X<-x>X<-o>X<-R>X<-W>X<-X>X<-O>X<-e>X<-z>X<-s>X<-f>X<-d>X<-l>X<-p>
@@ -299,46 +307,46 @@
 names, precedence is the same as any other named unary operator.  The
 operator may be any of:
 
-    -r	File is readable by effective uid/gid.
-    -w	File is writable by effective uid/gid.
-    -x	File is executable by effective uid/gid.
-    -o	File is owned by effective uid.
-
-    -R	File is readable by real uid/gid.
-    -W	File is writable by real uid/gid.
-    -X	File is executable by real uid/gid.
-    -O	File is owned by real uid.
-
-    -e	File exists.
-    -z	File has zero size (is empty).
-    -s	File has nonzero size (returns size in bytes).
-
-    -f	File is a plain file.
-    -d	File is a directory.
-    -l	File is a symbolic link.
-    -p	File is a named pipe (FIFO), or Filehandle is a pipe.
-    -S	File is a socket.
-    -b	File is a block special file.
-    -c	File is a character special file.
-    -t	Filehandle is opened to a tty.
-
-    -u	File has setuid bit set.
-    -g	File has setgid bit set.
-    -k	File has sticky bit set.
-
-    -T	File is an ASCII text file (heuristic guess).
-    -B	File is a "binary" file (opposite of -T).
-
-    -M	Script start time minus file modification time, in days.
-    -A	Same for access time.
-    -C	Same for inode change time (Unix, may differ for other platforms)
+    -r  File is readable by effective uid/gid.
+    -w  File is writable by effective uid/gid.
+    -x  File is executable by effective uid/gid.
+    -o  File is owned by effective uid.
+
+    -R  File is readable by real uid/gid.
+    -W  File is writable by real uid/gid.
+    -X  File is executable by real uid/gid.
+    -O  File is owned by real uid.
+
+    -e  File exists.
+    -z  File has zero size (is empty).
+    -s  File has nonzero size (returns size in bytes).
+
+    -f  File is a plain file.
+    -d  File is a directory.
+    -l  File is a symbolic link.
+    -p  File is a named pipe (FIFO), or Filehandle is a pipe.
+    -S  File is a socket.
+    -b  File is a block special file.
+    -c  File is a character special file.
+    -t  Filehandle is opened to a tty.
+
+    -u  File has setuid bit set.
+    -g  File has setgid bit set.
+    -k  File has sticky bit set.
+
+    -T  File is an ASCII text file (heuristic guess).
+    -B  File is a "binary" file (opposite of -T).
+
+    -M  Script start time minus file modification time, in days.
+    -A  Same for access time.
+    -C  Same for inode change time (Unix, may differ for other platforms)
 
 Example:
 
     while (<>) {
-	chomp;
-	next unless -f $_;	# ignore specials
-	#...
+        chomp;
+        next unless -f $_;  # ignore specials
+        #...
     }
 
 The interpretation of the file permission operators C<-r>, C<-R>,
@@ -360,8 +368,8 @@
 If you are using ACLs, there is a pragma called C<filetest> that may
 produce more accurate results than the bare stat() mode bits.
 When under the C<use filetest 'access'> the above-mentioned filetests
-will test whether the permission can (not) be granted using the
-access() family of system calls.  Also note that the C<-x> and C<-X> may
+test whether the permission can (not) be granted using the
+access(2) family of system calls.  Also note that the C<-x> and C<-X> may
 under this pragma return true even if there are no execute permission
 bits set (nor any extra execute permission ACLs).  This strangeness is
 due to the underlying system calls' definitions. Note also that, due to
@@ -371,16 +379,16 @@
 information.
 
 Note that C<-s/a/b/> does not do a negated substitution.  Saying
-C<-exp($foo)> still works as expected, however--only single letters
+C<-exp($foo)> still works as expected, however: only single letters
 following a minus are interpreted as file tests.
 
 The C<-T> and C<-B> switches work as follows.  The first block or so of the
 file is examined for odd characters such as strange control codes or
 characters with the high bit set.  If too many strange characters (>30%)
 are found, it's a C<-B> file; otherwise it's a C<-T> file.  Also, any file
-containing null in the first block is considered a binary file.  If C<-T>
+containing a zero byte in the first block is considered a binary file.  If C<-T>
 or C<-B> is used on a filehandle, the current IO buffer is examined
-rather than the first block.  Both C<-T> and C<-B> return true on a null
+rather than the first block.  Both C<-T> and C<-B> return true on an empty
 file, or a file at EOF when testing a filehandle.  Because you have to
 read a file to do the C<-T> test, on most occasions you want to use a C<-f>
 against the file first, as in C<next unless -f $file && -T $file>.
@@ -389,7 +397,7 @@
 the special filehandle consisting of a solitary underline, then the stat
 structure of the previous file test (or stat operator) is used, saving
 a system call.  (This doesn't work with C<-t>, and you need to remember
-that lstat() and C<-l> will leave values in the stat structure for the
+that lstat() and C<-l> leave values in the stat structure for the
 symbolic link, not the real file.)  (Also, if the stat buffer was filled by
 an C<lstat> call, C<-T> and C<-B> will reset it with the results of C<stat _>).
 Example:
@@ -408,7 +416,7 @@
 
 As of Perl 5.9.1, as a form of purely syntactic sugar, you can stack file
 test operators, in a way that C<-f -w -x $file> is equivalent to
-C<-x $file && -w _ && -f _>. (This is only syntax fancy: if you use
+C<-x $file && -w _ && -f _>. (This is only fancy fancy: if you use
 the return value of C<-f $file> as an argument to another filetest
 operator, no special magic will happen.)
 
@@ -423,7 +431,7 @@
 =item accept NEWSOCKET,GENERICSOCKET
 X<accept>
 
-Accepts an incoming socket connect, just as the accept(2) system call
+Accepts an incoming socket connect, just as accept(2) 
 does.  Returns the packed address if it succeeded, false otherwise.
 See the example in L<perlipc/"Sockets: Client/Server Communication">.
 
@@ -457,8 +465,8 @@
 might be able to use the C<syscall> interface to access setitimer(2) if
 your system supports it. See L<perlfaq8> for details.
 
-It is usually a mistake to intermix C<alarm> and C<sleep> calls.
-(C<sleep> may be internally implemented in your system with C<alarm>)
+It is usually a mistake to intermix C<alarm> and C<sleep> calls, because
+C<sleep> may be internally implemented on your system with C<alarm>.
 
 If you want to use C<alarm> to time out a system call you need to use an
 C<eval>/C<die> pair.  You can't rely on the alarm causing the system call to
@@ -467,17 +475,17 @@
 modulo the caveats given in L<perlipc/"Signals">.
 
     eval {
-	local $SIG{ALRM} = sub { die "alarm\n" }; # NB: \n required
-	alarm $timeout;
-	$nread = sysread SOCKET, $buffer, $size;
-	alarm 0;
+        local $SIG{ALRM} = sub { die "alarm\n" }; # NB: \n required
+        alarm $timeout;
+        $nread = sysread SOCKET, $buffer, $size;
+        alarm 0;
     };
     if ($@) {
-	die unless $@ eq "alarm\n";   # propagate unexpected errors
-    	# timed out
+        die unless $@ eq "alarm\n";   # propagate unexpected errors
+        # timed out
     }
     else {
-    	# didn't
+        # didn't
     }
 
 For more information see L<perlipc>.
@@ -498,7 +506,7 @@
 =item bind SOCKET,NAME
 X<bind>
 
-Binds a network address to a socket, just as the bind system call
+Binds a network address to a socket, just as bind(2)
 does.  Returns true if it succeeded, false otherwise.  NAME should be a
 packed address of the appropriate type for the socket.  See the examples in
 L<perlipc/"Sockets: Client/Server Communication">.
@@ -524,19 +532,19 @@
 like for example images.
 
 If LAYER is present it is a single string, but may contain multiple
-directives. The directives alter the behaviour of the file handle.
+directives. The directives alter the behaviour of the filehandle.
 When LAYER is present using binmode on a text file makes sense.
 
 If LAYER is omitted or specified as C<:raw> the filehandle is made
 suitable for passing binary data. This includes turning off possible CRLF
 translation and marking it as bytes (as opposed to Unicode characters).
 Note that, despite what may be implied in I<"Programming Perl"> (the
-Camel) or elsewhere, C<:raw> is I<not> simply the inverse of C<:crlf>
--- other layers which would affect the binary nature of the stream are
-I<also> disabled. See L<PerlIO>, L<perlrun> and the discussion about the
+Camel, 3rd edition) or elsewhere, C<:raw> is I<not> simply the inverse of C<:crlf>.
+Other layers that would affect the binary nature of the stream are
+I<also> disabled. See L<PerlIO>, L<perlrun>, and the discussion about the
 PERLIO environment variable.
 
-The C<:bytes>, C<:crlf>, and C<:utf8>, and any other directives of the
+The C<:bytes>, C<:crlf>, C<:utf8>, and any other directives of the
 form C<:...>, are called I/O I<layers>.  The C<open> pragma can be used to
 establish default I/O layers.  See L<open>.
 
@@ -553,14 +561,14 @@
 UTF-8. More details can be found in L<PerlIO::encoding>.
 
 In general, binmode() should be called after open() but before any I/O
-is done on the filehandle.  Calling binmode() will normally flush any
+is done on the filehandle.  Calling binmode() normally flushes any
 pending buffered output data (and perhaps pending input data) on the
 handle.  An exception to this is the C<:encoding> layer that
 changes the default character encoding of the handle, see L<open>.
 The C<:encoding> layer sometimes needs to be called in
 mid-stream, and it doesn't flush the stream.  The C<:encoding>
 also implicitly pushes on top of itself the C<:utf8> layer because
-internally Perl will operate on UTF-8 encoded Unicode characters.
+internally Perl operates on UTF8-encoded Unicode characters.
 
 The operating system, device drivers, C libraries, and Perl run-time
 system all work together to let the programmer treat a single
@@ -587,7 +595,7 @@
 data contains C<\cZ>, the I/O subsystem will regard it as the end of
 the file, unless you use binmode().
 
-binmode() is not only important for readline() and print() operations,
+binmode() is important not only for readline() and print() operations,
 but also when using read(), seek(), sysread(), syswrite() and tell()
 (see L<perlport> for more details).  See the C<$/> and C<$\> variables
 in L<perlvar> for how to manually set your input and output
@@ -618,7 +626,7 @@
 
 Break out of a C<given()> block.
 
-This keyword is enabled by the "switch" feature: see L<feature>
+This keyword is enabled by the C<"switch"> feature: see L<feature>
 for more information.
 
 =item caller EXPR
@@ -627,8 +635,8 @@
 =item caller
 
 Returns the context of the current subroutine call.  In scalar context,
-returns the caller's package name if there is a caller, that is, if
-we're in a subroutine or C<eval> or C<require>, and the undefined value
+returns the caller's package name if there I<is> a caller (that is, if
+we're in a subroutine or C<eval> or C<require>) and the undefined value
 otherwise.  In list context, returns
 
     # 0         1          2
@@ -669,10 +677,24 @@
 
 Be aware that the optimizer might have optimized call frames away before
 C<caller> had a chance to get the information.  That means that C<caller(N)>
-might not return information about the call frame you expect it do, for
+might not return information about the call frame you expect it to, for
 C<< N > 1 >>.  In particular, C<@DB::args> might have information from the
 previous time C<caller> was called.
 
+Also be aware that setting C<@DB::args> is I<best effort>, intended for
+debugging or generating backtraces, and should not be relied upon. In
+particular, as C<@_> contains aliases to the caller's arguments, Perl does
+not take a copy of C<@_>, so C<@DB::args> will contain modifications the
+subroutine makes to C<@_> or its contents, not the original values at call
+time. C<@DB::args>, like C<@_>, does not hold explicit references to its
+elements, so under certain cases its elements may have become freed and
+reallocated for other variables or temporary values. Finally, a side effect
+of the current implementation means that the effects of C<shift @_> can
+I<normally> be undone (but not C<pop @_> or other splicing, and not if a
+reference to C<@_> has been taken, and subject to the caveat about reallocated
+elements), so C<@DB::args> is actually a hybrid of the current state and
+initial state of C<@_>. Buyer beware.
+
 =item chdir EXPR
 X<chdir>
 X<cd>
@@ -688,12 +710,12 @@
 changes to the directory specified by C<$ENV{HOME}>, if set; if not,
 changes to the directory specified by C<$ENV{LOGDIR}>. (Under VMS, the
 variable C<$ENV{SYS$LOGIN}> is also checked, and used if it is set.) If
-neither is set, C<chdir> does nothing. It returns true upon success,
+neither is set, C<chdir> does nothing. It returns true on success,
 false otherwise. See the example under C<die>.
 
-On systems that support fchdir, you might pass a file handle or
-directory handle as argument.  On systems that don't support fchdir,
-passing handles produces a fatal error at run time.
+On systems that support fchdir(2), you may pass a filehandle or
+directory handle as argument.  On systems that don't support fchdir(2),
+passing handles raises an exception.
 
 =item chmod LIST
 X<chmod> X<permission> X<mode>
@@ -701,33 +723,31 @@
 Changes the permissions of a list of files.  The first element of the
 list must be the numerical mode, which should probably be an octal
 number, and which definitely should I<not> be a string of octal digits:
-C<0644> is okay, C<'0644'> is not.  Returns the number of files
+C<0644> is okay, but C<"0644"> is not.  Returns the number of files
 successfully changed.  See also L</oct>, if all you have is a string.
 
-    $cnt = chmod 0755, 'foo', 'bar';
+    $cnt = chmod 0755, "foo", "bar";
     chmod 0755, @executables;
-    $mode = '0644'; chmod $mode, 'foo';      # !!! sets mode to
+    $mode = "0644"; chmod $mode, "foo";      # !!! sets mode to
                                              # --w----r-T
-    $mode = '0644'; chmod oct($mode), 'foo'; # this is better
-    $mode = 0644;   chmod $mode, 'foo';      # this is best
+    $mode = "0644"; chmod oct($mode), "foo"; # this is better
+    $mode = 0644;   chmod $mode, "foo";      # this is best
 
-On systems that support fchmod, you might pass file handles among the
-files.  On systems that don't support fchmod, passing file handles
-produces a fatal error at run time.   The file handles must be passed
-as globs or references to be recognized.  Barewords are considered
-file names.
+On systems that support fchmod(2), you may pass filehandles among the
+files.  On systems that don't support fchmod(2), passing filehandles raises
+an exception.  Filehandles must be passed as globs or glob references to be
+recognized; barewords are considered filenames.
 
     open(my $fh, "<", "foo");
     my $perm = (stat $fh)[2] & 07777;
     chmod($perm | 0600, $fh);
 
-You can also import the symbolic C<S_I*> constants from the Fcntl
+You can also import the symbolic C<S_I*> constants from the C<Fcntl>
 module:
 
-    use Fcntl ':mode';
-
+    use Fcntl qw( :mode );
     chmod S_IRWXU|S_IRGRP|S_IXGRP|S_IROTH|S_IXOTH, @executables;
-    # This is identical to the chmod 0755 of the above example.
+    # Identical to the chmod 0755 of the example above.
 
 =item chomp VARIABLE
 X<chomp> X<INPUT_RECORD_SEPARATOR> X<$/> X<newline> X<eol>
@@ -749,9 +769,9 @@
 If VARIABLE is omitted, it chomps C<$_>.  Example:
 
     while (<>) {
-	chomp;	# avoid \n on last field
-	@array = split(/:/);
-	# ...
+        chomp;  # avoid \n on last field
+        @array = split(/:/);
+        # ...
     }
 
 If VARIABLE is a hash, it chomps the hash's values, but not its keys.
@@ -805,11 +825,10 @@
     $cnt = chown $uid, $gid, 'foo', 'bar';
     chown $uid, $gid, @filenames;
 
-On systems that support fchown, you might pass file handles among the
-files.  On systems that don't support fchown, passing file handles
-produces a fatal error at run time.  The file handles must be passed
-as globs or references to be recognized.  Barewords are considered
-file names.
+On systems that support fchown(2), you may pass filehandles among the
+files.  On systems that don't support fchown(2), passing filehandles raises
+an exception.  Filehandles must be passed as globs or glob references to be
+recognized; barewords are considered filenames.
 
 Here's an example that looks up nonnumeric uids in the passwd file:
 
@@ -819,9 +838,9 @@
     chomp($pattern = <STDIN>);
 
     ($login,$pass,$uid,$gid) = getpwnam($user)
-	or die "$user not in passwd file";
+        or die "$user not in passwd file";
 
-    @ary = glob($pattern);	# expand filenames
+    @ary = glob($pattern);  # expand filenames
     chown $uid, $gid, @ary;
 
 On most systems, you are not allowed to change the ownership of the
@@ -843,7 +862,7 @@
 chr(0x263a) is a Unicode smiley face.  
 
 Negative values give the Unicode replacement character (chr(0xfffd)),
-except under the L<bytes> pragma, where low eight bits of the value
+except under the L<bytes> pragma, where the low eight bits of the value
 (truncated to an integer) are used.
 
 If NUMBER is omitted, uses C<$_>.
@@ -872,40 +891,39 @@
 
 =item close
 
-Closes the file or pipe associated with the file handle, flushes the IO
+Closes the file or pipe associated with the filehandle, flushes the IO
 buffers, and closes the system file descriptor.  Returns true if those
 operations have succeeded and if no error was reported by any PerlIO
 layer.  Closes the currently selected filehandle if the argument is
 omitted.
 
 You don't have to close FILEHANDLE if you are immediately going to do
-another C<open> on it, because C<open> will close it for you.  (See
+another C<open> on it, because C<open> closes it for you.  (See
 C<open>.)  However, an explicit C<close> on an input file resets the line
 counter (C<$.>), while the implicit close done by C<open> does not.
 
-If the file handle came from a piped open, C<close> will additionally
-return false if one of the other system calls involved fails, or if the
-program exits with non-zero status.  (If the only problem was that the
-program exited non-zero, C<$!> will be set to C<0>.)  Closing a pipe
-also waits for the process executing on the pipe to complete, in case you
-want to look at the output of the pipe afterwards, and
-implicitly puts the exit status value of that command into C<$?> and
-C<${^CHILD_ERROR_NATIVE}>.
-
-Prematurely closing the read end of a pipe (i.e. before the process
-writing to it at the other end has closed it) will result in a
-SIGPIPE being delivered to the writer.  If the other end can't
-handle that, be sure to read all the data before closing the pipe.
+If the filehandle came from a piped open, C<close> returns false if one of
+the other syscalls involved fails or if its program exits with non-zero
+status.  If the only problem was that the program exited non-zero, C<$!>
+will be set to C<0>.  Closing a pipe also waits for the process executing
+on the pipe to exit--in case you wish to look at the output of the pipe
+afterwards--and implicitly puts the exit status value of that command into
+C<$?> and C<${^CHILD_ERROR_NATIVE}>.
+
+Closing the read end of a pipe before the process writing to it at the
+other end is done writing results in the writer receiving a SIGPIPE.  If
+the other end can't handle that, be sure to read all the data before
+closing the pipe.
 
 Example:
 
     open(OUTPUT, '|sort >foo')  # pipe to sort
         or die "Can't start sort: $!";
-    #...			# print stuff to output
-    close OUTPUT		# wait for sort to finish
+    #...                        # print stuff to output
+    close OUTPUT                # wait for sort to finish
         or warn $! ? "Error closing sort pipe: $!"
                    : "Exit status $? from sort";
-    open(INPUT, 'foo')		# get sort's results
+    open(INPUT, 'foo')          # get sort's results
         or die "Can't open 'foo' for input: $!";
 
 FILEHANDLE may be an expression whose value can be used as an indirect
@@ -920,8 +938,8 @@
 =item connect SOCKET,NAME
 X<connect>
 
-Attempts to connect to a remote socket, just as the connect system call
-does.  Returns true if it succeeded, false otherwise.  NAME should be a
+Attempts to connect to a remote socket, just like connect(2).
+Returns true if it succeeded, false otherwise.  NAME should be a
 packed address of the appropriate type for the socket.  See the examples in
 L<perlipc/"Sockets: Client/Server Communication">.
 
@@ -939,27 +957,27 @@
 statement).
 
 C<last>, C<next>, or C<redo> may appear within a C<continue>
-block.  C<last> and C<redo> will behave as if they had been executed within
+block; C<last> and C<redo> behave as if they had been executed within
 the main block.  So will C<next>, but since it will execute a C<continue>
 block, it may be more entertaining.
 
     while (EXPR) {
-	### redo always comes here
-	do_something;
+        ### redo always comes here
+        do_something;
     } continue {
-	### next always comes here
-	do_something_else;
-	# then back the top to re-check EXPR
+        ### next always comes here
+        do_something_else;
+        # then back the top to re-check EXPR
     }
     ### last always comes here
 
-Omitting the C<continue> section is semantically equivalent to using an
-empty one, logically enough.  In that case, C<next> goes directly back
+Omitting the C<continue> section is equivalent to using an
+empty one, logically enough, so C<next> goes directly back
 to check the condition at the top of the loop.
 
-If the "switch" feature is enabled, C<continue> is also a
-function that will break out of the current C<when> or C<default>
-block, and fall through to the next case. See L<feature> and
+If the C<"switch"> feature is enabled, C<continue> is also a
+function that exits the current C<when> (or C<default>) block and
+falls through to the next one.  See L<feature> and
 L<perlsyn/"Switch statements"> for more information.
 
 
@@ -1014,7 +1032,7 @@
 the salt, followed by 11 bytes from the set C<[./0-9A-Za-z]>, and only
 the first eight bytes of PLAINTEXT mattered. But alternative
 hashing schemes (like MD5), higher level security schemes (like C2),
-and implementations on non-UNIX platforms may produce different
+and implementations on non-Unix platforms may produce different
 strings.
 
 When choosing a new salt create a random two character string whose
@@ -1036,9 +1054,9 @@
     system "stty echo";
 
     if (crypt($word, $pwd) ne $pwd) {
-	die "Sorry...\n";
+        die "Sorry...\n";
     } else {
-	print "ok\n";
+        print "ok\n";
     }
 
 Of course, typing in your own password to whoever asks you
@@ -1073,15 +1091,15 @@
 is the name of the database (without the F<.dir> or F<.pag> extension if
 any).  If the database does not exist, it is created with protection
 specified by MASK (as modified by the C<umask>).  If your system supports
-only the older DBM functions, you may perform only one C<dbmopen> in your
+only the older DBM functions, you may make only one C<dbmopen> call in your
 program.  In older versions of Perl, if your system had neither DBM nor
 ndbm, calling C<dbmopen> produced a fatal error; it now falls back to
 sdbm(3).
 
 If you don't have write access to the DBM file, you can only read hash
 variables, not set them.  If you want to test whether you can write,
-either use file tests or try setting a dummy hash entry inside an C<eval>,
-which will trap the error.
+either use file tests or try setting a dummy hash entry inside an C<eval> 
+to trap the error.
 
 Note that functions such as C<keys> and C<values> may return huge lists
 when used on large DBM files.  You may prefer to use the C<each>
@@ -1090,7 +1108,7 @@
     # print out history file offsets
     dbmopen(%HIST,'/usr/lib/news/history',0666);
     while (($key,$val) = each %HIST) {
-	print $key, ' = ', unpack('L',$val), "\n";
+        print $key, ' = ', unpack('L',$val), "\n";
     }
     dbmclose(%HIST);
 
@@ -1103,7 +1121,7 @@
 
     use DB_File;
     dbmopen(%NS_Hist, "$ENV{HOME}/.netscape/history.db")
-	or die "Can't open netscape history file: $!";
+        or die "Can't open netscape history file: $!";
 
 =item defined EXPR
 X<defined> X<undef> X<undefined>
@@ -1111,7 +1129,7 @@
 =item defined
 
 Returns a Boolean value telling whether EXPR has a value other than
-the undefined value C<undef>.  If EXPR is not present, C<$_> will be
+the undefined value C<undef>.  If EXPR is not present, C<$_> is
 checked.
 
 Many operations return C<undef> to indicate failure, end of file,
@@ -1126,9 +1144,9 @@
 
 You may also use C<defined(&func)> to check whether subroutine C<&func>
 has ever been defined.  The return value is unaffected by any forward
-declarations of C<&func>.  Note that a subroutine which is not defined
+declarations of C<&func>.  A subroutine that is not defined
 may still be callable: its package may have an C<AUTOLOAD> method that
-makes it spring into existence the first time that it is called -- see
+makes it spring into existence the first time that it is called; see
 L<perlsub>.
 
 Use of C<defined> on aggregates (hashes and arrays) is deprecated.  It
@@ -1148,7 +1166,7 @@
     print if defined $switch{'D'};
     print "$val\n" while defined($val = pop(@ary));
     die "Can't readlink $sym: $!"
-	unless defined($value = readlink $sym);
+        unless defined($value = readlink $sym);
     sub foo { defined &$bar ? &$bar(@_) : die "No bar"; }
     $debugging = 0 unless defined $debugging;
 
@@ -1158,12 +1176,12 @@
 
     "ab" =~ /a(.*)b/;
 
-The pattern match succeeds, and C<$1> is defined, despite the fact that it
+The pattern match succeeds and C<$1> is defined, although it
 matched "nothing".  It didn't really fail to match anything.  Rather, it
 matched something that happened to be zero characters long.  This is all
 very above-board and honest.  When a function returns an undefined value,
 it's an admission that it couldn't give you an honest answer.  So you
-should use C<defined> only when you're questioning the integrity of what
+should use C<defined> only when questioning the integrity of what
 you're trying to do.  At other times, a simple comparison to C<0> or C<""> is
 what you want.
 
@@ -1172,41 +1190,49 @@
 =item delete EXPR
 X<delete>
 
-Given an expression that specifies a hash element, array element, hash slice,
-or array slice, deletes the specified element(s) from the hash or array.
-In the case of an array, if the array elements happen to be at the end,
-the size of the array will shrink to the highest element that tests
-true for exists() (or 0 if no such element exists).
-
-Returns a list with the same number of elements as the number of elements
-for which deletion was attempted.  Each element of that list consists of
-either the value of the element deleted, or the undefined value.  In scalar
-context, this means that you get the value of the last element deleted (or
-the undefined value if that element did not exist).
+Given an expression that specifies an element or slice of a hash, C<delete>
+deletes the specified elements from that hash so that exists() on that element
+no longer returns true.  Setting a hash element to the undefined value does
+not remove its key, but deleting it does; see L</exists>.
+
+It returns the value or values deleted in list context, or the last such
+element in scalar context.  The return list's length always matches that of
+the argument list: deleting non-existent elements returns the undefined value
+in their corresponding positions.
+
+delete() may also be used on arrays and array slices, but its behavior is less
+straightforward.  Although exists() will return false for deleted entries,
+deleting array elements never changes indices of existing values; use shift()
+or splice() for that.  However, if all deleted elements fall at the end of an
+array, the array's size shrinks to the position of the highest element that
+still tests true for exists(), or to 0 if none do.
+
+B<Be aware> that calling delete on array values is deprecated and likely to
+be removed in a future version of Perl.
+
+Deleting from C<%ENV> modifies the environment.  Deleting from a hash tied to
+a DBM file deletes the entry from the DBM file.  Deleting from a C<tied> hash
+or array may not necessarily return anything; it depends on the implementation
+of the C<tied> package's DELETE method, which may do whatever it pleases.
+
+The C<delete local EXPR> construct localizes the deletion to the current
+block at run time.  Until the block exits, elements locally deleted
+temporarily no longer exist.  See L<perlsub/"Localized deletion of elements
+of composite types">.
 
     %hash = (foo => 11, bar => 22, baz => 33);
     $scalar = delete $hash{foo};             # $scalar is 11
     $scalar = delete @hash{qw(foo bar)};     # $scalar is 22
     @array  = delete @hash{qw(foo bar baz)}; # @array  is (undef,undef,33)
 
-Deleting from C<%ENV> modifies the environment.  Deleting from
-a hash tied to a DBM file deletes the entry from the DBM file.  Deleting
-from a C<tie>d hash or array may not necessarily return anything.
-
-Deleting an array element effectively returns that position of the array
-to its initial, uninitialized state.  Subsequently testing for the same
-element with exists() will return false.  Also, deleting array elements
-in the middle of an array will not shift the index of the elements
-after them down.  Use splice() for that.  See L</exists>.
-
 The following (inefficiently) deletes all the values of %HASH and @ARRAY:
 
     foreach $key (keys %HASH) {
-	delete $HASH{$key};
+        delete $HASH{$key};
     }
 
     foreach $index (0 .. $#ARRAY) {
-	delete $ARRAY[$index];
+        delete $ARRAY[$index];
     }
 
 And so do these:
@@ -1215,18 +1241,18 @@
 
     delete @ARRAY[0 .. $#ARRAY];
 
-But both of these are slower than just assigning the empty list
-or undefining %HASH or @ARRAY:
+But both are slower than assigning the empty list
+or undefining %HASH or @ARRAY, which is the customary 
+way to empty out an aggregate:
 
-    %HASH = ();		# completely empty %HASH
-    undef %HASH;	# forget %HASH ever existed
+    %HASH = ();     # completely empty %HASH
+    undef %HASH;    # forget %HASH ever existed
 
-    @ARRAY = ();	# completely empty @ARRAY
-    undef @ARRAY;	# forget @ARRAY ever existed
+    @ARRAY = ();    # completely empty @ARRAY
+    undef @ARRAY;   # forget @ARRAY ever existed
 
-Note that the EXPR can be arbitrarily complicated as long as the final
-operation is a hash element, array element,  hash slice, or array slice
-lookup:
+The EXPR can be arbitrarily complicated provided its
+final operation is an element or slice of an aggregate:
 
     delete $ref->[$x][$y]{$key};
     delete @{$ref->[$x][$y]}{$key1, $key2, @morekeys};
@@ -1237,13 +1263,11 @@
 =item die LIST
 X<die> X<throw> X<exception> X<raise> X<$@> X<abort>
 
-Outside an C<eval>, prints the value of LIST to C<STDERR> and
-exits with the current value of C<$!> (errno).  If C<$!> is C<0>,
-exits with the value of C<<< ($? >> 8) >>> (backtick `command`
-status).  If C<<< ($? >> 8) >>> is C<0>, exits with C<255>.  Inside
-an C<eval(),> the error message is stuffed into C<$@> and the
-C<eval> is terminated with the undefined value.  This makes
-C<die> the way to raise an exception.
+C<die> raises an exception. Inside an C<eval> the error message is stuffed
+into C<$@> and the C<eval> is terminated with the undefined value.
+If the exception is outside of all enclosing C<eval>s, then the uncaught
+exception prints LIST to C<STDERR> and exits with a non-zero value. If you
+need to exit the process with a specific exit code, see L<exit>.
 
 Equivalent examples:
 
@@ -1269,35 +1293,45 @@
     /etc/games is no good at canasta line 123.
     /etc/games is no good, stopped at canasta line 123.
 
-See also exit(), warn(), and the Carp module.
-
-If LIST is empty and C<$@> already contains a value (typically from a
+If the output is empty and C<$@> already contains a value (typically from a
 previous eval) that value is reused after appending C<"\t...propagated">.
 This is useful for propagating exceptions:
 
     eval { ... };
     die unless $@ =~ /Expected exception/;
 
-If LIST is empty and C<$@> contains an object reference that has a
+If the output is empty and C<$@> contains an object reference that has a
 C<PROPAGATE> method, that method will be called with additional file
 and line number parameters.  The return value replaces the value in
-C<$@>.  i.e. as if C<< $@ = eval { $@->PROPAGATE(__FILE__, __LINE__) }; >>
+C<$@>.  i.e., as if C<< $@ = eval { $@->PROPAGATE(__FILE__, __LINE__) }; >>
 were called.
 
 If C<$@> is empty then the string C<"Died"> is used.
 
-die() can also be called with a reference argument.  If this happens to be
-trapped within an eval(), $@ contains the reference.  This behavior permits
-a more elaborate exception handling implementation using objects that
-maintain arbitrary state about the nature of the exception.  Such a scheme
-is sometimes preferable to matching particular string values of $@ using
-regular expressions.  Because $@ is a global variable, and eval() may be
-used within object implementations, care must be taken that analyzing the
-error object doesn't replace the reference in the global variable.  The
-easiest solution is to make a local copy of the reference before doing
-other manipulations.  Here's an example:
+If an uncaught exception results in interpreter exit, the exit code is
+determined from the values of C<$!> and C<$?> with this pseudocode:
+
+    exit $! if $!;              # errno
+    exit $? >> 8 if $? >> 8;    # child exit status
+    exit 255;                   # last resort
+
+The intent is to squeeze as much possible information about the likely cause
+into the limited space of the system exit code. However, as C<$!> is the value
+of C's C<errno>, which can be set by any system call, this means that the value
+of the exit code used by C<die> can be non-predictable, so should not be relied
+upon, other than to be non-zero.
+
+You can also call C<die> with a reference argument, and if this is trapped
+within an C<eval>, C<$@> contains that reference.  This permits more
+elaborate exception handling using objects that maintain arbitrary state
+about the exception.  Such a scheme is sometimes preferable to matching
+particular string values of C<$@> with regular expressions.  Because C<$@> 
+is a global variable and C<eval> may be used within object implementations,
+be careful that analyzing the error object doesn't replace the reference in
+the global variable.  It's easiest to make a local copy of the reference
+before any manipulations.  Here's an example:
 
-    use Scalar::Util 'blessed';
+    use Scalar::Util "blessed";
 
     eval { ... ; die Some::Module::Exception->new( FOO => "bar" ) };
     if (my $ev_err = $@) {
@@ -1309,27 +1343,29 @@
         }
     }
 
-Because perl will stringify uncaught exception messages before displaying
-them, you may want to overload stringification operations on such custom
+Because Perl stringifies uncaught exception messages before display,
+you'll probably want to overload stringification operations on
 exception objects.  See L<overload> for details about that.
 
 You can arrange for a callback to be run just before the C<die>
 does its deed, by setting the C<$SIG{__DIE__}> hook.  The associated
-handler will be called with the error text and can change the error
+handler is called with the error text and can change the error
 message, if it sees fit, by calling C<die> again.  See
 L<perlvar/$SIG{expr}> for details on setting C<%SIG> entries, and
 L<"eval BLOCK"> for some examples.  Although this feature was 
 to be run only right before your program was to exit, this is not
-currently the case--the C<$SIG{__DIE__}> hook is currently called
+currently so: the C<$SIG{__DIE__}> hook is currently called
 even inside eval()ed blocks/strings!  If one wants the hook to do
 nothing in such situations, put
 
-	die @_ if $^S;
+    die @_ if $^S;
 
 as the first line of the handler (see L<perlvar/$^S>).  Because
 this promotes strange action at a distance, this counterintuitive
 behavior may be fixed in a future release.
 
+See also exit(), warn(), and the Carp module.
+
 =item do BLOCK
 X<do> X<block>
 
@@ -1374,7 +1410,7 @@
 successfully compiled, C<do> returns the value of the last expression
 evaluated.
 
-Note that inclusion of library modules is better done with the
+Inclusion of library modules is better done with the
 C<use> and C<require> operators, which also do automatic error checking
 and raise an exception if there's a problem.
 
@@ -1384,12 +1420,12 @@
     # read in config files: system first, then user
     for $file ("/share/prog/defaults.rc",
                "$ENV{HOME}/.someprogrc")
-   {
-	unless ($return = do $file) {
-	    warn "couldn't parse $file: $@" if $@;
-	    warn "couldn't do $file: $!"    unless defined $return;
-	    warn "couldn't run $file"       unless $return;
-	}
+    {
+        unless ($return = do $file) {
+            warn "couldn't parse $file: $@" if $@;
+            warn "couldn't do $file: $!"    unless defined $return;
+            warn "couldn't run $file"       unless $return;
+        }
     }
 
 =item dump LABEL
@@ -1409,7 +1445,7 @@
 
 B<WARNING>: Any files opened at the time of the dump will I<not>
 be open any more when the program is reincarnated, with possible
-resulting confusion on the part of Perl.
+resulting confusion by Perl.
 
 This function is now largely obsolete, mostly because it's very hard to
 convert a core file into an executable. That's why you should now invoke
@@ -1419,39 +1455,43 @@
 =item each HASH
 X<each> X<hash, iterator>
 
-When called in list context, returns a 2-element list consisting of the
-key and value for the next element of a hash, so that you can iterate over
-it.  When called in scalar context, returns only the key for the next
-element in the hash.
+=item each ARRAY
+X<array, iterator>
+
+When called in list context, returns a 2-element list consisting of the key
+and value for the next element of a hash, or the index and value for the
+next element of an array, so that you can iterate over it.  When called in
+scalar context, returns only the key (not the value) in a hash, or the index
+in an array.
 
-Entries are returned in an apparently random order.  The actual random
-order is subject to change in future versions of perl, but it is
+Hash entries are returned in an apparently random order.  The actual random
+order is subject to change in future versions of Perl, but it is
 guaranteed to be in the same order as either the C<keys> or C<values>
 function would produce on the same (unmodified) hash.  Since Perl
 5.8.2 the ordering can be different even between different runs of Perl
 for security reasons (see L<perlsec/"Algorithmic Complexity Attacks">).
 
-When the hash is entirely read, a null array is returned in list context
-(which when assigned produces a false (C<0>) value), and C<undef> in
-scalar context.  The next call to C<each> after that will start iterating
-again.  There is a single iterator for each hash, shared by all C<each>,
-C<keys>, and C<values> function calls in the program; it can be reset by
-reading all the elements from the hash, or by evaluating C<keys HASH> or
-C<values HASH>.  If you add or delete elements of a hash while you're
-iterating over it, you may get entries skipped or duplicated, so
-don't.  Exception: It is always safe to delete the item most recently
-returned by C<each()>, which means that the following code will work:
+After C<each> has returned all entries from the hash or array, the next
+call to C<each> returns the empty list in list context and C<undef> in
+scalar context.  The next call following that one restarts iteration.  Each
+hash or array has its own internal iterator, accessed by C<each>, C<keys>,
+and C<values>.  The iterator is implicitly reset when C<each> has reached
+the end as just described; it can be explicitly reset by calling C<keys> or
+C<values> on the hash or array.  If you add or delete a hash's elements
+while iterating over it, entries may be skipped or duplicated--so don't do
+that.  Exception: It is always safe to delete the item most recently
+returned by C<each()>, so the following code works properly:
 
         while (($key, $value) = each %hash) {
           print $key, "\n";
           delete $hash{$key};   # This is safe
         }
 
-The following prints out your environment like the printenv(1) program,
-only in a different order:
+This prints out your environment like the printenv(1) program,
+but in a different order:
 
     while (($key,$value) = each %ENV) {
-	print "$key=$value\n";
+        print "$key=$value\n";
     }
 
 See also C<keys>, C<values> and C<sort>.
@@ -1468,13 +1508,13 @@
 Returns 1 if the next read on FILEHANDLE will return end of file, or if
 FILEHANDLE is not open.  FILEHANDLE may be an expression whose value
 gives the real filehandle.  (Note that this function actually
-reads a character and then C<ungetc>s it, so isn't very useful in an
+reads a character and then C<ungetc>s it, so isn't useful in an
 interactive context.)  Do not read from a terminal file (or call
 C<eof(FILEHANDLE)> on it) after end-of-file is reached.  File types such
 as terminals may lose the end-of-file condition if you do.
 
 An C<eof> without an argument uses the last file read.  Using C<eof()>
-with empty parentheses is very different.  It refers to the pseudo file
+with empty parentheses is different.  It refers to the pseudo file
 formed from the files listed on the command line and accessed via the
 C<< <> >> operator.  Since C<< <> >> isn't explicitly opened,
 as a normal filehandle is, an C<eof()> before C<< <> >> has been
@@ -1485,24 +1525,24 @@
 see L<perlop/"I/O Operators">.
 
 In a C<< while (<>) >> loop, C<eof> or C<eof(ARGV)> can be used to
-detect the end of each file, C<eof()> will only detect the end of the
+detect the end of each file, C<eof()> will detect the end of only the
 last file.  Examples:
 
     # reset line numbering on each input file
     while (<>) {
-	next if /^\s*#/;	# skip comments
-	print "$.\t$_";
+        next if /^\s*#/;  # skip comments
+        print "$.\t$_";
     } continue {
-	close ARGV  if eof;	# Not eof()!
+        close ARGV if eof;  # Not eof()!
     }
 
     # insert dashes just before last line of last file
     while (<>) {
-	if (eof()) {		# check for end of last file
-	    print "--------------\n";
-	}
-	print;
-	last if eof();          # needed if we're reading from a terminal
+        if (eof()) {  # check for end of last file
+            print "--------------\n";
+        }
+        print;
+        last if eof();          # needed if we're reading from a terminal
     }
 
 Practical hint: you almost never need to use C<eof> in Perl, because the
@@ -1546,8 +1586,8 @@
 If there is a syntax error or runtime error, or a C<die> statement is
 executed, C<eval> returns an undefined value in scalar context
 or an empty list in list context, and C<$@> is set to the
-error message.  If there was no error, C<$@> is guaranteed to be a null
-string.  Beware that using C<eval> neither silences perl from printing
+error message.  If there was no error, C<$@> is guaranteed to be the empty
+string.  Beware that using C<eval> neither silences Perl from printing
 warnings to STDERR, nor does it stuff the text of warning messages into C<$@>.
 To do either of those, you have to use the C<$SIG{__WARN__}> facility, or
 turn off warnings inside the BLOCK or EXPR using S<C<no warnings 'all'>>.
@@ -1574,18 +1614,18 @@
     eval '$answer = $a / $b'; warn $@ if $@;
 
     # a compile-time error
-    eval { $answer = };			# WRONG
+    eval { $answer = }; # WRONG
 
     # a run-time error
-    eval '$answer =';	# sets $@
+    eval '$answer =';   # sets $@
 
 Using the C<eval{}> form as an exception trap in libraries does have some
 issues.  Due to the current arguably broken state of C<__DIE__> hooks, you
 may wish not to trigger any C<__DIE__> hooks that user code may have installed.
 You can use the C<local $SIG{__DIE__}> construct for this purpose,
-as shown in this example:
+as this example shows:
 
-    # a very private exception trap for divide-by-zero
+    # a private exception trap for divide-by-zero
     eval { local $SIG{'__DIE__'}; $answer = $a / $b; };
     warn $@ if $@;
 
@@ -1606,14 +1646,14 @@
 With an C<eval>, you should be especially careful to remember what's
 being looked at when:
 
-    eval $x;		# CASE 1
-    eval "$x";		# CASE 2
+    eval $x;        # CASE 1
+    eval "$x";      # CASE 2
 
-    eval '$x';		# CASE 3
-    eval { $x };	# CASE 4
+    eval '$x';      # CASE 3
+    eval { $x };    # CASE 4
 
-    eval "\$$x++";	# CASE 5
-    $$x++;		# CASE 6
+    eval "\$$x++";  # CASE 5
+    $$x++;          # CASE 6
 
 Cases 1 and 2 above behave identically: they run the code contained in
 the variable $x.  (Although case 2 has misleading double quotes making
@@ -1645,24 +1685,24 @@
 C<eval BLOCK> does I<not> count as a loop, so the loop control statements
 C<next>, C<last>, or C<redo> cannot be used to leave or restart the block.
 
-Note that as a very special case, an C<eval ''> executed within the C<DB>
-package doesn't see the usual surrounding lexical scope, but rather the
-scope of the first non-DB piece of code that called it. You don't normally
-need to worry about this unless you are writing a Perl debugger.
+An C<eval ''> executed within the C<DB> package doesn't see the usual
+surrounding lexical scope, but rather the scope of the first non-DB piece
+of code that called it. You don't normally need to worry about this unless
+you are writing a Perl debugger.
 
 =item exec LIST
 X<exec> X<execute>
 
 =item exec PROGRAM LIST
 
-The C<exec> function executes a system command I<and never returns>--
+The C<exec> function executes a system command I<and never returns>;
 use C<system> instead of C<exec> if you want it to return.  It fails and
 returns false only if the command does not exist I<and> it is executed
 directly instead of via your system's command shell (see below).
 
 Since it's a common mistake to use C<exec> instead of C<system>, Perl
-warns you if there is a following statement which isn't C<die>, C<warn>,
-or C<exit> (if C<-w> is set  -  but you always do that).   If you
+warns you if there is a following statement that isn't C<die>, C<warn>,
+or C<exit> (if C<-w> is set--but you always do that, right?).   If you
 I<really> want to follow an C<exec> with some other statement, you
 can use one of these styles to avoid the warning:
 
@@ -1690,14 +1730,14 @@
 the list.)  Example:
 
     $shell = '/bin/csh';
-    exec $shell '-sh';		# pretend it's a login shell
+    exec $shell '-sh';    # pretend it's a login shell
 
 or, more directly,
 
-    exec {'/bin/csh'} '-sh';	# pretend it's a login shell
+    exec {'/bin/csh'} '-sh';  # pretend it's a login shell
 
-When the arguments get executed via the system shell, results will
-be subject to its quirks and capabilities.  See L<perlop/"`STRING`">
+When the arguments get executed via the system shell, results are
+subject to its quirks and capabilities.  See L<perlop/"`STRING`">
 for details.
 
 Using an indirect object with C<exec> or C<system> is also more
@@ -1713,32 +1753,37 @@
     exec { $args[0] } @args;  # safe even with one-arg list
 
 The first version, the one without the indirect object, ran the I<echo>
-program, passing it C<"surprise"> an argument.  The second version
-didn't--it tried to run a program literally called I<"echo surprise">,
-didn't find it, and set C<$?> to a non-zero value indicating failure.
+program, passing it C<"surprise"> an argument.  The second version didn't;
+it tried to run a program named I<"echo surprise">, didn't find it, and set
+C<$?> to a non-zero value indicating failure.
 
-Beginning with v5.6.0, Perl will attempt to flush all files opened for
+Beginning with v5.6.0, Perl attempts to flush all files opened for
 output before the exec, but this may not be supported on some platforms
 (see L<perlport>).  To be safe, you may need to set C<$|> ($AUTOFLUSH
 in English) or call the C<autoflush()> method of C<IO::Handle> on any
-open handles in order to avoid lost output.
+open handles to avoid lost output.
 
-Note that C<exec> will not call your C<END> blocks, nor will it call
-any C<DESTROY> methods in your objects.
+Note that C<exec> will not call your C<END> blocks, nor will it invoke
+C<DESTROY> methods on your objects.
 
 =item exists EXPR
 X<exists> X<autovivification>
 
-Given an expression that specifies a hash element or array element,
-returns true if the specified element in the hash or array has ever
-been initialized, even if the corresponding value is undefined.
+Given an expression that specifies an element of a hash, returns true if the
+specified element in the hash has ever been initialized, even if the
+corresponding value is undefined.
 
-    print "Exists\n" 	if exists $hash{$key};
-    print "Defined\n" 	if defined $hash{$key};
+    print "Exists\n"    if exists $hash{$key};
+    print "Defined\n"   if defined $hash{$key};
     print "True\n"      if $hash{$key};
 
-    print "Exists\n" 	if exists $array[$index];
-    print "Defined\n" 	if defined $array[$index];
+exists may also be called on array elements, but its behavior is much less
+obvious, and is strongly tied to the use of L</delete> on arrays.  B<Be aware>
+that calling exists on array values is deprecated and likely to be removed in
+a future version of Perl.
+
+    print "Exists\n"    if exists $array[$index];
+    print "Defined\n"   if defined $array[$index];
     print "True\n"      if $array[$index];
 
 A hash or array element can be true only if it's defined, and defined if
@@ -1747,34 +1792,34 @@
 Given an expression that specifies the name of a subroutine,
 returns true if the specified subroutine has ever been declared, even
 if it is undefined.  Mentioning a subroutine name for exists or defined
-does not count as declaring it.  Note that a subroutine which does not
+does not count as declaring it.  Note that a subroutine that does not
 exist may still be callable: its package may have an C<AUTOLOAD>
 method that makes it spring into existence the first time that it is
-called -- see L<perlsub>.
+called; see L<perlsub>.
 
-    print "Exists\n" 	if exists &subroutine;
-    print "Defined\n" 	if defined &subroutine;
+    print "Exists\n"  if exists &subroutine;
+    print "Defined\n" if defined &subroutine;
 
 Note that the EXPR can be arbitrarily complicated as long as the final
 operation is a hash or array key lookup or subroutine name:
 
-    if (exists $ref->{A}->{B}->{$key}) 	{ }
-    if (exists $hash{A}{B}{$key}) 	{ }
+    if (exists $ref->{A}->{B}->{$key})  { }
+    if (exists $hash{A}{B}{$key})       { }
 
-    if (exists $ref->{A}->{B}->[$ix]) 	{ }
-    if (exists $hash{A}{B}[$ix]) 	{ }
+    if (exists $ref->{A}->{B}->[$ix])   { }
+    if (exists $hash{A}{B}[$ix])        { }
 
     if (exists &{$ref->{A}{B}{$key}})   { }
 
-Although the deepest nested array or hash will not spring into existence
-just because its existence was tested, any intervening ones will.
+Although the mostly deeply nested array or hash will not spring into
+existence just because its existence was tested, any intervening ones will.
 Thus C<< $ref->{"A"} >> and C<< $ref->{"A"}->{"B"} >> will spring
 into existence due to the existence test for the $key element above.
-This happens anywhere the arrow operator is used, including even:
+This happens anywhere the arrow operator is used, including even here:
 
     undef $ref;
-    if (exists $ref->{"Some key"})	{ }
-    print $ref; 	    # prints HASH(0x80d3d5c)
+    if (exists $ref->{"Some key"})    { }
+    print $ref;  # prints HASH(0x80d3d5c)
 
 This surprising autovivification in what does not at first--or even
 second--glance appear to be an lvalue context may be fixed in a future
@@ -1783,8 +1828,8 @@
 Use of a subroutine call, rather than a subroutine name, as an argument
 to exists() is an error.
 
-    exists &sub;	# OK
-    exists &sub();	# Error
+    exists &sub;    # OK
+    exists &sub();  # Error
 
 =item exit EXPR
 X<exit> X<terminate> X<abort>
@@ -1830,12 +1875,12 @@
     use Fcntl;
 
 first to get the correct constant definitions.  Argument processing and
-value return works just like C<ioctl> below.
+value returned work just like C<ioctl> below.
 For example:
 
     use Fcntl;
     fcntl($filehandle, F_GETFL, $packed_return_buffer)
-	or die "can't fcntl F_GETFL: $!";
+        or die "can't fcntl F_GETFL: $!";
 
 You don't have to check for C<defined> on the return from C<fcntl>.
 Like C<ioctl>, it maps a C<0> return from the system call into
@@ -1843,7 +1888,7 @@
 in numeric context.  It is also exempt from the normal B<-w> warnings
 on improper numeric conversions.
 
-Note that C<fcntl> will produce a fatal error if used on a machine that
+Note that C<fcntl> raises an exception if used on a machine that
 doesn't implement fcntl(2).  See the Fcntl module or your fcntl(2)
 manpage to learn what functions are available on your system.
 
@@ -1872,7 +1917,7 @@
 same underlying descriptor:
 
     if (fileno(THIS) == fileno(THAT)) {
-	print "THIS and THAT are dups\n";
+        print "THIS and THAT are dups\n";
     }
 
 (Filehandles connected to memory objects via new features of C<open> may
@@ -1886,7 +1931,7 @@
 for success, false on failure.  Produces a fatal error if used on a
 machine that doesn't implement flock(2), fcntl(2) locking, or lockf(3).
 C<flock> is Perl's portable file locking interface, although it locks
-only entire files, not records.
+entire files only, not records.
 
 Two potentially non-obvious but traditional C<flock> semantics are
 that it waits indefinitely until the lock is granted, and that its locks
@@ -1906,8 +1951,8 @@
 either individually, or as a group using the ':flock' tag.  LOCK_SH
 requests a shared lock, LOCK_EX requests an exclusive lock, and LOCK_UN
 releases a previously requested lock.  If LOCK_NB is bitwise-or'ed with
-LOCK_SH or LOCK_EX then C<flock> will return immediately rather than blocking
-waiting for the lock (check the return status to see if you got it).
+LOCK_SH or LOCK_EX then C<flock> returns immediately rather than blocking
+waiting for the lock; check the return status to see if you got it.
 
 To avoid the possibility of miscoordination, Perl now flushes FILEHANDLE
 before locking or unlocking it.
@@ -1927,35 +1972,35 @@
 that.  If you like you can force Perl to ignore your system's flock(2)
 function, and so provide its own fcntl(2)-based emulation, by passing
 the switch C<-Ud_flock> to the F<Configure> program when you configure
-perl.
+Perl.
 
 Here's a mailbox appender for BSD systems.
 
     use Fcntl qw(:flock SEEK_END); # import LOCK_* and SEEK_END constants
 
     sub lock {
-	my ($fh) = @_;
-	flock($fh, LOCK_EX) or die "Cannot lock mailbox - $!\n";
+        my ($fh) = @_;
+        flock($fh, LOCK_EX) or die "Cannot lock mailbox - $!\n";
 
-	# and, in case someone appended while we were waiting...
-	seek($fh, 0, SEEK_END) or die "Cannot seek - $!\n";
+        # and, in case someone appended while we were waiting...
+        seek($fh, 0, SEEK_END) or die "Cannot seek - $!\n";
     }
 
     sub unlock {
-	my ($fh) = @_;
-	flock($fh, LOCK_UN) or die "Cannot unlock mailbox - $!\n";
+        my ($fh) = @_;
+        flock($fh, LOCK_UN) or die "Cannot unlock mailbox - $!\n";
     }
 
     open(my $mbox, ">>", "/usr/spool/mail/$ENV{'USER'}")
-	    or die "Can't open mailbox: $!";
+        or die "Can't open mailbox: $!";
 
     lock($mbox);
     print $mbox $msg,"\n\n";
     unlock($mbox);
 
-On systems that support a real flock(), locks are inherited across fork()
-calls, whereas those that must resort to the more capricious fcntl()
-function lose the locks, making it harder to write servers.
+On systems that support a real flock(2), locks are inherited across fork()
+calls, whereas those that must resort to the more capricious fcntl(2)
+function lose their locks, making it seriously harder to write servers.
 
 See also L<DB_File> for other flock() examples.
 
@@ -1971,11 +2016,11 @@
 example, using copy-on-write technology on data pages), making it the
 dominant paradigm for multitasking over the last few decades.
 
-Beginning with v5.6.0, Perl will attempt to flush all files opened for
+Beginning with v5.6.0, Perl attempts to flush all files opened for
 output before forking the child process, but this may not be supported
 on some platforms (see L<perlport>).  To be safe, you may need to set
 C<$|> ($AUTOFLUSH in English) or call the C<autoflush()> method of
-C<IO::Handle> on any open handles in order to avoid duplicate output.
+C<IO::Handle> on any open handles to avoid duplicate output.
 
 If you C<fork> without ever waiting on your children, you will
 accumulate zombies.  On some systems, you can avoid this by setting
@@ -1995,8 +2040,8 @@
 example:
 
     format Something =
-	Test: @<<<<<<<< @||||| @>>>>>
-	      $str,     $%,    '$' . int($num)
+        Test: @<<<<<<<< @||||| @>>>>>
+              $str,     $%,    '$' . int($num)
     .
 
     $str = "widget";
@@ -2018,9 +2063,9 @@
 and then set C<$^A> back to C<"">.  Note that a format typically
 does one C<formline> per line of form, but the C<formline> function itself
 doesn't care how many newlines are embedded in the PICTURE.  This means
-that the C<~> and C<~~> tokens will treat the entire PICTURE as a single line.
+that the C<~> and C<~~> tokens treat the entire PICTURE as a single line.
 You may therefore need to use multiple formlines to implement a single
-record format, just like the format compiler.
+record format, just like the C<format> compiler.
 
 Be careful if you put double quotes around the picture, because an C<@>
 character may be taken to mean the beginning of an array name.
@@ -2032,26 +2077,26 @@
 =item getc
 
 Returns the next character from the input file attached to FILEHANDLE,
-or the undefined value at end of file, or if there was an error (in
+or the undefined value at end of file or if there was an error (in
 the latter case C<$!> is set).  If FILEHANDLE is omitted, reads from
 STDIN.  This is not particularly efficient.  However, it cannot be
 used by itself to fetch single characters without waiting for the user
 to hit enter.  For that, try something more like:
 
     if ($BSD_STYLE) {
-	system "stty cbreak </dev/tty >/dev/tty 2>&1";
+        system "stty cbreak </dev/tty >/dev/tty 2>&1";
     }
     else {
-	system "stty", '-icanon', 'eol', "\001";
+        system "stty", '-icanon', 'eol', "\001";
     }
 
     $key = getc(STDIN);
 
     if ($BSD_STYLE) {
-	system "stty -cbreak </dev/tty >/dev/tty 2>&1";
+        system "stty -cbreak </dev/tty >/dev/tty 2>&1";
     }
     else {
-	system "stty", 'icanon', 'eol', '^@'; # ASCII null
+        system 'stty', 'icanon', 'eol', '^@'; # ASCII NUL
     }
     print "\n";
 
@@ -2067,8 +2112,8 @@
 X<getlogin> X<login>
 
 This implements the C library function of the same name, which on most
-systems returns the current login from F</etc/utmp>, if any.  If null,
-use C<getpwuid>.
+systems returns the current login from F</etc/utmp>, if any.  If it
+returns the empty string, use C<getpwuid>.
 
     $login = getlogin || getpwuid($<) || "Kilroy";
 
@@ -2103,7 +2148,7 @@
 
 Note for Linux users: on Linux, the C functions C<getpid()> and
 C<getppid()> return different values from different threads. In order to
-be portable, this behavior is not reflected by the perl-level function
+be portable, this behavior is not reflected by the Perl-level function
 C<getppid()>, that returns a consistent value across threads. If you want
 to call the underlying C<getppid()>, you may use the CPAN module
 C<Linux::Pid>.
@@ -2181,8 +2226,8 @@
 
 =item endservent
 
-These routines perform the same functions as their counterparts in the
-system library.  In list context, the return values from the
+These routines are the same as their counterparts in the
+system C library.  In list context, the return values from the
 various get routines are as follows:
 
     ($name,$passwd,$uid,$gid,
@@ -2193,7 +2238,7 @@
     ($name,$aliases,$proto) = getproto*
     ($name,$aliases,$port,$proto) = getserv*
 
-(If the entry doesn't exist you get a null list.)
+(If the entry doesn't exist you get an empty list.)
 
 The exact meaning of the $gcos field varies but it usually contains
 the real name of the user (as opposed to the login name) and other
@@ -2216,7 +2261,7 @@
     #etc.
 
 In I<getpw*()> the fields $quota, $comment, and $expire are special
-cases in the sense that in many systems they are unsupported.  If the
+in that they are unsupported on many systems.  If the
 $quota is unsupported, it is an empty scalar.  If it is supported, it
 usually encodes the disk quota.  If the $comment field is unsupported,
 it is an empty scalar.  If it is supported it usually encodes some
@@ -2230,7 +2275,7 @@
 $quota and $comment fields mean and whether you have the $expire field
 by using the C<Config> module and the values C<d_pwquota>, C<d_pwage>,
 C<d_pwchange>, C<d_pwcomment>, and C<d_pwexpire>.  Shadow password
-files are only supported if your vendor has implemented them in the
+files are supported only if your vendor has implemented them in the
 intuitive fashion that calling the regular C library routines gets the
 shadow versions if you're running under privilege or if there exists
 the shadow(3) functions as found in System V (this includes Solaris
@@ -2242,9 +2287,9 @@
 
 For the I<gethost*()> functions, if the C<h_errno> variable is supported in
 C, it will be returned to you via C<$?> if the function call fails.  The
-C<@addrs> value returned by a successful call is a list of the raw
-addresses returned by the corresponding system library call.  In the
-Internet domain, each address is four bytes long and you can unpack it
+C<@addrs> value returned by a successful call is a list of raw
+addresses returned by the corresponding library call.  In the
+Internet domain, each address is four bytes long; you can unpack it
 by saying something like:
 
     ($a,$b,$c,$d) = unpack('W4',$addr[0]);
@@ -2310,24 +2355,24 @@
 protocol number of the appropriate protocol controlling the option
 should be supplied. For example, to indicate that an option is to be
 interpreted by the TCP protocol, LEVEL should be set to the protocol
-number of TCP, which you can get using getprotobyname.
+number of TCP, which you can get using C<getprotobyname>.
 
-The call returns a packed string representing the requested socket option,
-or C<undef> if there is an error (the error reason will be in $!). What
-exactly is in the packed string depends in the LEVEL and OPTNAME, consult
-your system documentation for details. A very common case however is that
-the option is an integer, in which case the result will be a packed
-integer which you can decode using unpack with the C<i> (or C<I>) format.
+The function returns a packed string representing the requested socket
+option, or C<undef> on error, with the reason for the error placed in
+C<$!>). Just what is in the packed string depends on LEVEL and OPTNAME;
+consult getsockopt(2) for details.  A common case is that the option is an
+integer, in which case the result is a packed integer, which you can decode
+using C<unpack> with the C<i> (or C<I>) format.
 
-An example testing if Nagle's algorithm is turned on on a socket:
+An example to test whether Nagle's algorithm is turned on on a socket:
 
     use Socket qw(:all);
 
     defined(my $tcp = getprotobyname("tcp"))
-	or die "Could not determine the protocol number for tcp";
+        or die "Could not determine the protocol number for tcp";
     # my $tcp = IPPROTO_TCP; # Alternative
     my $packed = getsockopt($socket, $tcp, TCP_NODELAY)
-	or die "Could not query TCP_NODELAY socket option: $!";
+        or die "getsockopt TCP_NODELAY: $!";
     my $nodelay = unpack("I", $packed);
     print "Nagle's algorithm is turned ", $nodelay ? "off\n" : "on\n";
 
@@ -2345,10 +2390,17 @@
 EXPR is omitted, C<$_> is used.  The C<< <*.c> >> operator is discussed in
 more detail in L<perlop/"I/O Operators">.
 
-Note that C<glob> will split its arguments on whitespace, treating
-each segment as separate pattern.  As such, C<glob('*.c *.h')> would
-match all files with a F<.c> or F<.h> extension.  The expression
-C<glob('.* *')> would match all files in the current working directory.
+Note that C<glob> splits its arguments on whitespace and treats
+each segment as separate pattern.  As such, C<glob("*.c *.h")> 
+matches all files with a F<.c> or F<.h> extension.  The expression
+C<glob(".* *")> matchs all files in the current working directory.
+
+If non-empty braces are the only wildcard characters used in the
+C<glob>, no filenames are matched, but potentially many strings
+are returned.  For example, this produces nine strings, one for
+each pairing of fruits and colors:
+
+    @many =  glob "{apple,tomato,cherry}={green,yellow,red}";
 
 Beginning with v5.6.0, this operator is implemented using the standard
 C<File::Glob> extension.  See L<File::Glob> for details, including
@@ -2375,18 +2427,15 @@
 
 =item goto &NAME
 
-The C<goto-LABEL> form finds the statement labeled with LABEL and resumes
-execution there.  It may not be used to go into any construct that
-requires initialization, such as a subroutine or a C<foreach> loop.  It
-also can't be used to go into a construct that is optimized away,
-or to get out of a block or subroutine given to C<sort>.
-It can be used to go almost anywhere else within the dynamic scope,
-including out of subroutines, but it's usually better to use some other
-construct such as C<last> or C<die>.  The author of Perl has never felt the
-need to use this form of C<goto> (in Perl, that is--C is another matter).
-(The difference being that C does not offer named loops combined with
-loop control.  Perl does, and this replaces most structured uses of C<goto>
-in other languages.)
+The C<goto-LABEL> form finds the statement labeled with LABEL and
+resumes execution there. It can't be used to get out of a block or
+subroutine given to C<sort>.  It can be used to go almost anywhere
+else within the dynamic scope, including out of subroutines, but it's
+usually better to use some other construct such as C<last> or C<die>.
+The author of Perl has never felt the need to use this form of C<goto>
+(in Perl, that is; C is another matter).  (The difference is that C
+does not offer named loops combined with loop control.  Perl does, and
+this replaces most structured uses of C<goto> in other languages.)
 
 The C<goto-EXPR> form expects a label name, whose scope will be resolved
 dynamically.  This allows for computed C<goto>s per FORTRAN, but isn't
@@ -2394,6 +2443,12 @@
 
     goto ("FOO", "BAR", "GLARCH")[$i];
 
+Use of C<goto-LABEL> or C<goto-EXPR> to jump into a construct is
+deprecated and will issue a warning.  Even then, it may not be used to
+go into any construct that requires initialization, such as a
+subroutine or a C<foreach> loop.  It also can't be used to go into a
+construct that is optimized away.
+
 The C<goto-&NAME> form is quite different from the other forms of
 C<goto>.  In fact, it isn't a goto in the normal sense at all, and
 doesn't have the stigma associated with other gotos.  Instead, it
@@ -2440,7 +2495,7 @@
 
 If C<$_> is lexical in the scope where the C<grep> appears (because it has
 been declared with C<my $_>) then, in addition to being locally aliased to
-the list elements, C<$_> keeps being lexical inside the block; i.e. it
+the list elements, C<$_> keeps being lexical inside the block; i.e., it
 can't be seen from the outside, avoiding any potential side-effects.
 
 See also L</map> for a list composed of the results of the BLOCK or EXPR.
@@ -2492,7 +2547,7 @@
 
 Returns the integer portion of EXPR.  If EXPR is omitted, uses C<$_>.
 You should not use this function for rounding: one because it truncates
-towards C<0>, and two because machine representations of floating point
+towards C<0>, and two because machine representations of floating-point
 numbers can sometimes produce counterintuitive results.  For example,
 C<int(-6.725/0.025)> produces -268 rather than the correct -269; that's
 because it's really more like -268.99999999999994315658 instead.  Usually,
@@ -2504,14 +2559,14 @@
 
 Implements the ioctl(2) function.  You'll probably first have to say
 
-    require "sys/ioctl.ph";	# probably in $Config{archlib}/sys/ioctl.ph
+    require "sys/ioctl.ph";  # probably in $Config{archlib}/sys/ioctl.ph
 
 to get the correct function definitions.  If F<sys/ioctl.ph> doesn't
 exist or doesn't have the correct definitions you'll have to roll your
 own, based on your C header files such as F<< <sys/ioctl.h> >>.
 (There is a Perl script called B<h2ph> that comes with the Perl kit that
 may help you in this, but it's nontrivial.)  SCALAR will be read and/or
-written depending on the FUNCTION--a pointer to the string value of SCALAR
+written depending on the FUNCTION; a C pointer to the string value of SCALAR
 will be passed as the third argument of the actual C<ioctl> call.  (If SCALAR
 has no string value but does have a numeric value, that value will be
 passed rather than a pointer to the string value.  To guarantee this to be
@@ -2521,10 +2576,10 @@
 
 The return value of C<ioctl> (and C<fcntl>) is as follows:
 
-	if OS returns:		then Perl returns:
-	    -1	  		  undefined value
-	     0	 		string "0 but true"
-	anything else		    that number
+    if OS returns:      then Perl returns:
+        -1               undefined value
+         0              string "0 but true"
+    anything else           that number
 
 Thus Perl returns true on success and false on failure, yet you can
 still easily determine the actual value returned by the operating
@@ -2550,18 +2605,20 @@
 =item keys HASH
 X<keys> X<key>
 
-Returns a list consisting of all the keys of the named hash.
-(In scalar context, returns the number of keys.)
+=item keys ARRAY
 
-The keys are returned in an apparently random order.  The actual
-random order is subject to change in future versions of perl, but it
+Returns a list consisting of all the keys of the named hash, or the indices
+of an array. (In scalar context, returns the number of keys or indices.)
+
+The keys of a hash are returned in an apparently random order.  The actual
+random order is subject to change in future versions of Perl, but it
 is guaranteed to be the same order as either the C<values> or C<each>
 function produces (given that the hash has not been modified).  Since
 Perl 5.8.1 the ordering is different even between different runs of
 Perl for security reasons (see L<perlsec/"Algorithmic Complexity
 Attacks">).
 
-As a side effect, calling keys() resets the HASH's internal iterator
+As a side effect, calling keys() resets the HASH or ARRAY's internal iterator
 (see L</each>).  In particular, calling keys() in void context resets
 the iterator with no other overhead.
 
@@ -2570,13 +2627,13 @@
     @keys = keys %ENV;
     @values = values %ENV;
     while (@keys) {
-	print pop(@keys), '=', pop(@values), "\n";
+        print pop(@keys), '=', pop(@values), "\n";
     }
 
 or how about sorted by key:
 
     foreach $key (sort(keys %ENV)) {
-	print $key, '=', $ENV{$key}, "\n";
+        print $key, '=', $ENV{$key}, "\n";
     }
 
 The returned values are copies of the original keys in the hash, so
@@ -2586,10 +2643,10 @@
 Here's a descending numeric sort of a hash by its values:
 
     foreach $key (sort { $hash{$b} <=> $hash{$a} } keys %hash) {
-	printf "%4d %s\n", $hash{$key}, $key;
+        printf "%4d %s\n", $hash{$key}, $key;
     }
 
-As an lvalue C<keys> allows you to increase the number of hash buckets
+Used as an lvalue, C<keys> allows you to increase the number of hash buckets
 allocated for the given hash.  This can gain you a measure of efficiency if
 you know the hash is going to get big.  (This is similar to pre-extending
 an array by assigning a larger number to $#array.)  If you say
@@ -2602,7 +2659,8 @@
 %hash> if you want to free the storage while C<%hash> is still in scope.
 You can't shrink the number of buckets allocated for the hash using
 C<keys> in this way (but you needn't worry about doing this by accident,
-as trying has no effect).
+as trying has no effect). C<keys @array> in an lvalue context is a syntax
+error.
 
 See also C<each>, C<values> and C<sort>.
 
@@ -2616,18 +2674,20 @@
     $cnt = kill 1, $child1, $child2;
     kill 9, @goners;
 
-If SIGNAL is zero, no signal is sent to the process, but the kill(2)
-system call will check whether it's possible to send a signal to it (that
+If SIGNAL is zero, no signal is sent to the process, but C<kill>
+checks whether it's I<possible> to send a signal to it (that
 means, to be brief, that the process is owned by the same user, or we are
-the super-user).  This is a useful way to check that a child process is
+the super-user).  This is useful to check that a child process is still
 alive (even if only as a zombie) and hasn't changed its UID.  See
 L<perlport> for notes on the portability of this construct.
 
-Unlike in the shell, if SIGNAL is negative, it kills
-process groups instead of processes.  (On System V, a negative I<PROCESS>
-number will also kill process groups, but that's not portable.)  That
-means you usually want to use positive not negative signals.  You may also
-use a signal name in quotes.
+Unlike in the shell, if SIGNAL is negative, it kills process groups instead
+of processes. That means you usually want to use positive not negative signals.
+You may also use a signal name in quotes.
+
+The behavior of kill when a I<PROCESS> number is zero or negative depends on
+the operating system.  For example, on POSIX-conforming systems, zero will
+signal the current process group and -1 will signal all processes.
 
 See L<perlipc/"Signals"> for more details.
 
@@ -2642,11 +2702,11 @@
 C<continue> block, if any, is not executed:
 
     LINE: while (<STDIN>) {
-	last LINE if /^$/;	# exit when done with header
-	#...
+        last LINE if /^$/;  # exit when done with header
+        #...
     }
 
-C<last> cannot be used to exit a block which returns a value such as
+C<last> cannot be used to exit a block that returns a value such as
 C<eval {}>, C<sub {}> or C<do {}>, and should not be used to exit
 a grep() or map() operation.
 
@@ -2663,12 +2723,61 @@
 =item lc
 
 Returns a lowercased version of EXPR.  This is the internal function
-implementing the C<\L> escape in double-quoted strings.  Respects
-current LC_CTYPE locale if C<use locale> in force.  See L<perllocale>
-and L<perlunicode> for more details about locale and Unicode support.
+implementing the C<\L> escape in double-quoted strings.
 
 If EXPR is omitted, uses C<$_>.
 
+What gets returned depends on several factors:
+
+=over
+
+=item If C<use bytes> is in effect:
+
+=over
+
+=item On EBCDIC platforms
+
+The results are what the C language system call C<tolower()> returns.
+
+=item On ASCII platforms
+
+The results follow ASCII semantics.  Only characters C<A-Z> change, to C<a-z>
+respectively.
+
+=back
+
+=item Otherwise, If EXPR has the UTF8 flag set
+
+If the current package has a subroutine named C<ToLower>, it will be used to
+change the case (See L<perlunicode/User-Defined Case Mappings>.)
+Otherwise Unicode semantics are used for the case change.
+
+=item Otherwise, if C<use locale> is in effect
+
+Respects current LC_CTYPE locale.  See L<perllocale>.
+
+=item Otherwise, if C<use feature 'unicode_strings'> is in effect:
+
+Unicode semantics are used for the case change.  Any subroutine named
+C<ToLower> will not be used.
+
+=item Otherwise:
+
+=over
+
+=item On EBCDIC platforms
+
+The results are what the C language system call C<tolower()> returns.
+
+=item On ASCII platforms
+
+ASCII semantics are used for the case change.  The lowercase of any character
+outside the ASCII range is the character itself.
+
+=back
+
+=back
+
 =item lcfirst EXPR
 X<lcfirst> X<lowercase>
 
@@ -2676,29 +2785,29 @@
 
 Returns the value of EXPR with the first character lowercased.  This
 is the internal function implementing the C<\l> escape in
-double-quoted strings.  Respects current LC_CTYPE locale if C<use
-locale> in force.  See L<perllocale> and L<perlunicode> for more
-details about locale and Unicode support.
+double-quoted strings.
 
 If EXPR is omitted, uses C<$_>.
 
+This function behaves the same way under various pragma, such as in a locale,
+as L</lc> does.
+
 =item length EXPR
 X<length> X<size>
 
 =item length
 
 Returns the length in I<characters> of the value of EXPR.  If EXPR is
-omitted, returns length of C<$_>.  Note that this cannot be used on
-an entire array or hash to find out how many elements these have.
-For that, use C<scalar @array> and C<scalar keys %hash> respectively.
-
-Note the I<characters>: if the EXPR is in Unicode, you will get the
-number of characters, not the number of bytes.  To get the length
-of the internal string in bytes, use C<bytes::length(EXPR)>, see
-L<bytes>.  Note that the internal encoding is variable, and the number
-of bytes usually meaningless.  To get the number of bytes that the
-string would have when encoded as UTF-8, use
-C<length(Encoding::encode_utf8(EXPR))>.
+omitted, returns length of C<$_>.  If EXPR is undefined, returns C<undef>.
+
+This function cannot be used on an entire array or hash to find out how
+many elements these have.  For that, use C<scalar @array> and C<scalar keys
+%hash>, respectively.
+
+Like all Perl character operations, length() normally deals in logical
+characters, not physical bytes.  For how many bytes a string encoded as
+UTF-8 would take up, use C<length(Encode::encode_utf8(EXPR))> (you'll have
+to C<use Encode> first).  See L<Encode> and L<perlunicode>.
 
 =item link OLDFILE,NEWFILE
 X<link>
@@ -2709,7 +2818,7 @@
 =item listen SOCKET,QUEUESIZE
 X<listen>
 
-Does the same thing that the listen system call does.  Returns true if
+Does the same thing that the listen(2) system call does.  Returns true if
 it succeeded, false otherwise.  See the example in
 L<perlipc/"Sockets: Client/Server Communication">.
 
@@ -2725,6 +2834,10 @@
 be placed in parentheses.  See L<perlsub/"Temporary Values via local()">
 for details, including issues with tied arrays and hashes.
 
+The C<delete local EXPR> construct can also be used to localize the deletion
+of array/hash elements to the current block.
+See L<perlsub/"Localized deletion of elements of composite types">.
+
 =item localtime EXPR
 X<localtime> X<ctime>
 
@@ -2752,7 +2865,7 @@
 
 C<$year> is the number of years since 1900, not just the last two digits
 of the year.  That is, C<$year> is C<123> in year 2023.  The proper way
-to get a complete 4-digit year is simply:
+to get a 4-digit year is simply:
 
     $year += 1900;
 
@@ -2812,8 +2925,8 @@
 
 lock() is a "weak keyword" : this means that if you've defined a function
 by this name (before any calls to it), that function will be called
-instead. (However, if you've said C<use threads>, lock() is always a
-keyword.) See L<threads>.
+instead.  If you are not under C<use threads::shared> this does nothing.
+See L<threads::shared>.
 
 =item log EXPR
 X<log> X<logarithm> X<e> X<ln> X<base>
@@ -2826,8 +2939,8 @@
 divided by the natural log of N.  For example:
 
     sub log10 {
-	my $n = shift;
-	return log($n)/log(10);
+        my $n = shift;
+        return log($n)/log(10);
     }
 
 See also L</exp> for the inverse operation.
@@ -2871,7 +2984,7 @@
 
     %hash = ();
     foreach (@array) {
-	$hash{get_a_key_for($_)} = $_;
+        $hash{get_a_key_for($_)} = $_;
     }
 
 Note that C<$_> is an alias to the list value, so it can be used to
@@ -2887,27 +3000,27 @@
 can't be seen from the outside, avoiding any potential side-effects.
 
 C<{> starts both hash references and blocks, so C<map { ...> could be either
-the start of map BLOCK LIST or map EXPR, LIST. Because perl doesn't look
-ahead for the closing C<}> it has to take a guess at which its dealing with
-based what it finds just after the C<{>. Usually it gets it right, but if it
+the start of map BLOCK LIST or map EXPR, LIST. Because Perl doesn't look
+ahead for the closing C<}> it has to take a guess at which it's dealing with
+based on what it finds just after the C<{>. Usually it gets it right, but if it
 doesn't it won't realize something is wrong until it gets to the C<}> and
 encounters the missing (or unexpected) comma. The syntax error will be
-reported close to the C<}> but you'll need to change something near the C<{>
-such as using a unary C<+> to give perl some help:
+reported close to the C<}>, but you'll need to change something near the C<{>
+such as using a unary C<+> to give Perl some help:
 
-    %hash = map {  "\L$_", 1  } @array  # perl guesses EXPR.  wrong
-    %hash = map { +"\L$_", 1  } @array  # perl guesses BLOCK. right
-    %hash = map { ("\L$_", 1) } @array  # this also works
-    %hash = map {  lc($_), 1  } @array  # as does this.
-    %hash = map +( lc($_), 1 ), @array  # this is EXPR and works!
+    %hash = map {  "\L$_" => 1  } @array  # perl guesses EXPR.  wrong
+    %hash = map { +"\L$_" => 1  } @array  # perl guesses BLOCK. right
+    %hash = map { ("\L$_" => 1) } @array  # this also works
+    %hash = map {  lc($_) => 1  } @array  # as does this.
+    %hash = map +( lc($_) => 1 ), @array  # this is EXPR and works!
 
-    %hash = map  ( lc($_), 1 ), @array  # evaluates to (1, @array)
+    %hash = map  ( lc($_), 1 ),   @array  # evaluates to (1, @array)
 
 or to force an anon hash constructor use C<+{>:
 
-   @hashes = map +{ lc($_), 1 }, @array # EXPR, so needs , at end
+   @hashes = map +{ lc($_) => 1 }, @array # EXPR, so needs comma at end
 
-and you get list of anonymous hashes each with only 1 entry.
+to get a list of anonymous hashes each with only one entry apiece.
 
 =item mkdir FILENAME,MASK
 X<mkdir> X<md> X<directory, create>
@@ -2934,7 +3047,7 @@
 this right, so Perl automatically removes all trailing slashes to keep
 everyone happy.
 
-In order to recursively create a directory structure look at
+To recursively create a directory structure, look at
 the C<mkpath> function of the L<File::Path> module.
 
 =item msgctl ID,CMD,ARG
@@ -3009,12 +3122,12 @@
 the next iteration of the loop:
 
     LINE: while (<STDIN>) {
-	next LINE if /^#/;	# discard comments
-	#...
+        next LINE if /^#/;  # discard comments
+        #...
     }
 
 Note that if there were a C<continue> block on the above, it would get
-executed even on discarded lines.  If the LABEL is omitted, the command
+executed even on discarded lines.  If LABEL is omitted, the command
 refers to the innermost enclosing loop.
 
 C<next> cannot be used to exit a block which returns a value such as
@@ -3027,14 +3140,15 @@
 See also L</continue> for an illustration of how C<last>, C<next>, and
 C<redo> work.
 
-=item no Module VERSION LIST
-X<no>
+=item no MODULE VERSION LIST
+X<no declarations>
+X<unimporting>
 
-=item no Module VERSION
+=item no MODULE VERSION
 
-=item no Module LIST
+=item no MODULE LIST
 
-=item no Module
+=item no MODULE
 
 =item no VERSION
 
@@ -3049,21 +3163,25 @@
 value.  (If EXPR happens to start off with C<0x>, interprets it as a
 hex string.  If EXPR starts off with C<0b>, it is interpreted as a
 binary string.  Leading whitespace is ignored in all three cases.)
-The following will handle decimal, binary, octal, and hex in the standard
-Perl or C notation:
+The following will handle decimal, binary, octal, and hex in standard
+Perl notation:
 
     $val = oct($val) if $val =~ /^0/;
 
 If EXPR is omitted, uses C<$_>.   To go the other way (produce a number
 in octal), use sprintf() or printf():
 
-    $perms = (stat("filename"))[2] & 07777;
-    $oct_perms = sprintf "%lo", $perms;
+    $dec_perms = (stat("filename"))[2] & 07777;
+    $oct_perm_str = sprintf "%o", $perms;
 
 The oct() function is commonly used when a string such as C<644> needs
-to be converted into a file mode, for example. (Although perl will
-automatically convert strings into numbers as needed, this automatic
-conversion assumes base 10.)
+to be converted into a file mode, for example.  Although Perl 
+automatically converts strings into numbers as needed, this automatic
+conversion assumes base 10.
+
+Leading white space is ignored without warning, as too are any trailing 
+non-digits, such as a decimal point (C<oct> only handles non-negative
+integers, not negative integers or floating point).
 
 =item open FILEHANDLE,EXPR
 X<open> X<pipe> X<file, open> X<fopen>
@@ -3102,31 +3220,31 @@
 using C<my>, specify EXPR in your call to open.)
 
 If three or more arguments are specified then the mode of opening and
-the file name are separate. If MODE is C<< '<' >> or nothing, the file
+the filename are separate. If MODE is C<< '<' >> or nothing, the file
 is opened for input.  If MODE is C<< '>' >>, the file is truncated and
 opened for output, being created if necessary.  If MODE is C<<< '>>' >>>,
 the file is opened for appending, again being created if necessary.
 
 You can put a C<'+'> in front of the C<< '>' >> or C<< '<' >> to
 indicate that you want both read and write access to the file; thus
-C<< '+<' >> is almost always preferred for read/write updates--the C<<
-'+>' >> mode would clobber the file first.  You can't usually use
+C<< '+<' >> is almost always preferred for read/write updates--the 
+C<< '+>' >> mode would clobber the file first.  You can't usually use
 either read-write mode for updating textfiles, since they have
 variable length records.  See the B<-i> switch in L<perlrun> for a
 better approach.  The file is created with permissions of C<0666>
-modified by the process' C<umask> value.
+modified by the process's C<umask> value.
 
 These various prefixes correspond to the fopen(3) modes of C<'r'>,
 C<'r+'>, C<'w'>, C<'w+'>, C<'a'>, and C<'a+'>.
 
-In the 2-arguments (and 1-argument) form of the call the mode and
-filename should be concatenated (in this order), possibly separated by
-spaces.  It is possible to omit the mode in these forms if the mode is
+In the two-argument (and one-argument) form of the call, the mode and
+filename should be concatenated (in that order), possibly separated by
+spaces.  You may omit the mode in these forms when that mode is
 C<< '<' >>.
 
 If the filename begins with C<'|'>, the filename is interpreted as a
 command to which output is to be piped, and if the filename ends with a
-C<'|'>, the filename is interpreted as a command which pipes output to
+C<'|'>, the filename is interpreted as a command that pipes output to
 us.  See L<perlipc/"Using open() for IPC">
 for more examples of this.  (You are not allowed to C<open> to a command
 that pipes both in I<and> out, but see L<IPC::Open2>, L<IPC::Open3>,
@@ -3135,37 +3253,38 @@
 
 For three or more arguments if MODE is C<'|-'>, the filename is
 interpreted as a command to which output is to be piped, and if MODE
-is C<'-|'>, the filename is interpreted as a command which pipes
-output to us.  In the 2-arguments (and 1-argument) form one should
+is C<'-|'>, the filename is interpreted as a command that pipes
+output to us.  In the two-argument (and one-argument) form, one should
 replace dash (C<'-'>) with the command.
 See L<perlipc/"Using open() for IPC"> for more examples of this.
 (You are not allowed to C<open> to a command that pipes both in I<and>
 out, but see L<IPC::Open2>, L<IPC::Open3>, and
 L<perlipc/"Bidirectional Communication"> for alternatives.)
 
-In the three-or-more argument form of pipe opens, if LIST is specified
+In the form of pipe opens taking three or more arguments, if LIST is specified
 (extra arguments after the command name) then LIST becomes arguments
 to the command invoked if the platform supports it.  The meaning of
 C<open> with more than three arguments for non-pipe modes is not yet
-specified. Experimental "layers" may give extra LIST arguments
+defined, but experimental "layers" may give extra LIST arguments
 meaning.
 
-In the 2-arguments (and 1-argument) form opening C<'-'> opens STDIN
-and opening C<< '>-' >> opens STDOUT.
+In the two-argument (and one-argument) form, opening C<< '<-' >> 
+or C<'-'> opens STDIN and opening C<< '>-' >> opens STDOUT.
 
-You may use the three-argument form of open to specify IO "layers"
-(sometimes also referred to as "disciplines") to be applied to the handle
+You may use the three-argument form of open to specify I/O layers
+(sometimes referred to as "disciplines") to apply to the handle
 that affect how the input and output are processed (see L<open> and
-L<PerlIO> for more details). For example
+L<PerlIO> for more details). For example:
 
-  open(my $fh, "<:encoding(UTF-8)", "file")
+  open(my $fh, "<:encoding(UTF-8)", "filename")
+    || die "can't open UTF-8 encoded filename: $!";
 
-will open the UTF-8 encoded file containing Unicode characters,
+opens the UTF-8 encoded file containing Unicode characters;
 see L<perluniintro>. Note that if layers are specified in the
-three-arg form then default layers stored in ${^OPEN} (see L<perlvar>;
+three-argument form, then default layers stored in ${^OPEN} (see L<perlvar>;
 usually set by the B<open> pragma or the switch B<-CioD>) are ignored.
 
-Open returns nonzero upon success, the undefined value otherwise.  If
+Open returns nonzero on success, the undefined value otherwise.  If
 the C<open> involved a pipe, the return value happens to be the pid of
 the subprocess.
 
@@ -3173,17 +3292,16 @@
 files and binary files, then you should check out L</binmode> for tips
 for dealing with this.  The key distinction between systems that need
 C<binmode> and those that don't is their text file formats.  Systems
-like Unix, Mac OS, and Plan 9, which delimit lines with a single
-character, and which encode that character in C as C<"\n">, do not
+like Unix, Mac OS, and Plan 9, that end lines with a single
+character and encode that character in C as C<"\n"> do not
 need C<binmode>.  The rest need it.
 
-When opening a file, it's usually a bad idea to continue normal execution
-if the request failed, so C<open> is frequently used in connection with
+When opening a file, it's seldom a good idea to continue 
+if the request failed, so C<open> is frequently used with
 C<die>.  Even if C<die> won't do what you want (say, in a CGI script,
-where you want to make a nicely formatted error message (but there are
-modules that can help with that problem)) you should always check
-the return value from opening a file.  The infrequent exception is when
-working with an unopened filehandle is actually what you want to do.
+where you want to format a suitable error message (but there are
+modules that can help with that problem)) always check
+the return value from opening a file.  
 
 As a special case the 3-arg form with a read/write mode and the third
 argument being C<undef>:
@@ -3195,69 +3313,68 @@
 to the temporary file first.  You will need to seek() to do the
 reading.
 
-Since v5.8.0, perl has built using PerlIO by default.  Unless you've
-changed this (i.e. Configure -Uuseperlio), you can open file handles to
-"in memory" files held in Perl scalars via:
+Since v5.8.0, Perl has built using PerlIO by default.  Unless you've
+changed this (i.e., Configure -Uuseperlio), you can open filehandles 
+directly to Perl scalars via:
 
     open($fh, '>', \$variable) || ..
 
-Though if you try to re-open C<STDOUT> or C<STDERR> as an "in memory"
-file, you have to close it first:
+To (re)open C<STDOUT> or C<STDERR> as an in-memory file, close it first:
 
     close STDOUT;
     open STDOUT, '>', \$variable or die "Can't open STDOUT: $!";
 
-Examples:
+General examples:
 
     $ARTICLE = 100;
     open ARTICLE or die "Can't find article $ARTICLE: $!\n";
     while (<ARTICLE>) {...
 
-    open(LOG, '>>/usr/spool/news/twitlog');	# (log is reserved)
+    open(LOG, '>>/usr/spool/news/twitlog');  # (log is reserved)
     # if the open fails, output is discarded
 
-    open(my $dbase, '+<', 'dbase.mine')		# open for update
-	or die "Can't open 'dbase.mine' for update: $!";
+    open(my $dbase, '+<', 'dbase.mine')      # open for update
+        or die "Can't open 'dbase.mine' for update: $!";
 
-    open(my $dbase, '+<dbase.mine')			# ditto
-	or die "Can't open 'dbase.mine' for update: $!";
+    open(my $dbase, '+<dbase.mine')          # ditto
+        or die "Can't open 'dbase.mine' for update: $!";
 
-    open(ARTICLE, '-|', "caesar <$article")     # decrypt article
-	or die "Can't start caesar: $!";
+    open(ARTICLE, '-|', "caesar <$article")  # decrypt article
+        or die "Can't start caesar: $!";
 
-    open(ARTICLE, "caesar <$article |")		# ditto
-	or die "Can't start caesar: $!";
+    open(ARTICLE, "caesar <$article |")      # ditto
+        or die "Can't start caesar: $!";
 
-    open(EXTRACT, "|sort >Tmp$$")		# $$ is our process id
-	or die "Can't start sort: $!";
+    open(EXTRACT, "|sort >Tmp$$")            # $$ is our process id
+        or die "Can't start sort: $!";
 
-    # in memory files
+    # in-memory files
     open(MEMORY,'>', \$var)
-	or die "Can't open memory file: $!";
-    print MEMORY "foo!\n";			# output will end up in $var
+        or die "Can't open memory file: $!";
+    print MEMORY "foo!\n";                   # output will appear in $var
 
     # process argument list of files along with any includes
 
     foreach $file (@ARGV) {
-	process($file, 'fh00');
+        process($file, 'fh00');
     }
 
     sub process {
-	my($filename, $input) = @_;
-	$input++;		# this is a string increment
-	unless (open($input, $filename)) {
-	    print STDERR "Can't open $filename: $!\n";
-	    return;
-	}
-
-	local $_;
-	while (<$input>) {		# note use of indirection
-	    if (/^#include "(.*)"/) {
-		process($1, $input);
-		next;
-	    }
-	    #...		# whatever
-	}
+        my($filename, $input) = @_;
+        $input++;    # this is a string increment
+        unless (open($input, $filename)) {
+            print STDERR "Can't open $filename: $!\n";
+            return;
+        }
+
+        local $_;
+        while (<$input>) {    # note use of indirection
+            if (/^#include "(.*)"/) {
+                process($1, $input);
+                next;
+            }
+            #...          # whatever
+        }
     }
 
 See L<perliol> for detailed info on PerlIO.
@@ -3282,11 +3399,11 @@
     open STDOUT, '>', "foo.out" or die "Can't redirect STDOUT: $!";
     open STDERR, ">&STDOUT"     or die "Can't dup STDOUT: $!";
 
-    select STDERR; $| = 1;	# make unbuffered
-    select STDOUT; $| = 1;	# make unbuffered
+    select STDERR; $| = 1;  # make unbuffered
+    select STDOUT; $| = 1;  # make unbuffered
 
-    print STDOUT "stdout 1\n";	# this works for
-    print STDERR "stderr 1\n"; 	# subprocesses too
+    print STDOUT "stdout 1\n";  # this works for
+    print STDERR "stderr 1\n";  # subprocesses too
 
     open STDOUT, ">&", $oldout or die "Can't dup \$oldout: $!";
     open STDERR, ">&OLDERR"    or die "Can't dup OLDERR: $!";
@@ -3325,7 +3442,7 @@
 
 Note that if you are using Perls older than 5.8.0, Perl will be using
 the standard C libraries' fdopen() to implement the "=" functionality.
-On many UNIX systems fdopen() fails when file descriptors exceed a
+On many Unix systems fdopen() fails when file descriptors exceed a
 certain value, typically 255.  For Perls 5.8.0 and later, PerlIO is
 most often the default.
 
@@ -3338,13 +3455,14 @@
 there is an implicit fork done, and the return value of open is the pid
 of the child within the parent process, and C<0> within the child
 process.  (Use C<defined($pid)> to determine whether the open was successful.)
-The filehandle behaves normally for the parent, but i/o to that
+The filehandle behaves normally for the parent, but I/O to that
 filehandle is piped from/to the STDOUT/STDIN of the child process.
-In the child process the filehandle isn't opened--i/o happens from/to
-the new STDOUT or STDIN.  Typically this is used like the normal
+In the child process, the filehandle isn't opened--I/O happens from/to
+the new STDOUT/STDIN.  Typically this is used like the normal
 piped open when you want to exercise more control over just how the
-pipe command gets executed, such as when you are running setuid, and
-don't want to have to scan shell commands for metacharacters.
+pipe command gets executed, such as when running setuid and
+you don't want to have to scan shell commands for metacharacters.
+
 The following triples are more or less equivalent:
 
     open(FOO, "|tr '[a-z]' '[A-Z]'");
@@ -3360,7 +3478,7 @@
 The last example in each block shows the pipe as "list form", which is
 not yet supported on all platforms.  A good rule of thumb is that if
 your platform has true C<fork()> (in other words, if your platform is
-UNIX) you can use the list form.
+Unix) you can use the list form.
 
 See L<perlipc/"Safe Pipe Opens"> for more examples of this.
 
@@ -3403,7 +3521,7 @@
     open IN, $ARGV[0];
 
 will allow the user to specify an argument of the form C<"rsh cat file |">,
-but will not work on a filename which happens to have a trailing space, while
+but will not work on a filename that happens to have a trailing space, while
 
     open IN, '<', $ARGV[0];
 
@@ -3417,7 +3535,7 @@
 
     use IO::Handle;
     sysopen(HANDLE, $path, O_RDWR|O_CREAT|O_EXCL)
-	or die "sysopen $path: $!";
+        or die "sysopen $path: $!";
     $oldfh = select(HANDLE); $| = 1; select($oldfh);
     print HANDLE "stuff $$\n";
     seek(HANDLE, 0, 0);
@@ -3431,14 +3549,14 @@
     use IO::File;
     #...
     sub read_myfile_munged {
-	my $ALL = shift;
-	my $handle = IO::File->new;
-	open($handle, "myfile") or die "myfile: $!";
-	$first = <$handle>
-	    or return ();     # Automatically closed here.
-	mung $first or die "mung failed";	# Or here.
-	return $first, <$handle> if $ALL;	# Or here.
-	$first;					# Or here.
+        my $ALL = shift;
+        my $handle = IO::File->new;
+        open($handle, "myfile") or die "myfile: $!";
+        $first = <$handle>
+            or return ();     # Automatically closed here.
+        mung $first or die "mung failed";  # Or here.
+        return $first, <$handle> if $ALL;  # Or here.
+        $first;          # Or here.
     }
 
 See L</seek> for some details about mixing reading and writing.
@@ -3503,11 +3621,11 @@
 behavior holds:
 
     package Foo;
-    our $bar;		# declares $Foo::bar for rest of lexical scope
+    our $bar;      # declares $Foo::bar for rest of lexical scope
     $bar = 20;
 
     package Bar;
-    print $bar;		# prints 20, as it refers to $Foo::bar
+    print $bar;    # prints 20, as it refers to $Foo::bar
 
 Multiple C<our> declarations with the same name in the same lexical
 scope are allowed if they are in different packages.  If they happen
@@ -3519,15 +3637,15 @@
 
     use warnings;
     package Foo;
-    our $bar;		# declares $Foo::bar for rest of lexical scope
+    our $bar;      # declares $Foo::bar for rest of lexical scope
     $bar = 20;
 
     package Bar;
-    our $bar = 30;	# declares $Bar::bar for rest of lexical scope
-    print $bar;		# prints 30
+    our $bar = 30; # declares $Bar::bar for rest of lexical scope
+    print $bar;    # prints 30
 
-    our $bar;		# emits warning but has no other effect
-    print $bar;		# still prints 30
+    our $bar;      # emits warning but has no other effect
+    print $bar;    # still prints 30
 
 An C<our> declaration may also have a list of attributes associated
 with it.
@@ -3546,81 +3664,82 @@
 given by the TEMPLATE.  The resulting string is the concatenation of
 the converted values.  Typically, each converted value looks
 like its machine-level representation.  For example, on 32-bit machines
-an integer may be represented by a sequence of 4 bytes that will be 
-converted to a sequence of 4 characters.
+an integer may be represented by a sequence of 4 bytes, which  will in
+Perl be presented as a string that's 4 characters long. 
+
+See L<perlpacktut> for an introduction to this function.
 
 The TEMPLATE is a sequence of characters that give the order and type
 of values, as follows:
 
-    a	A string with arbitrary binary data, will be null padded.
-    A	A text (ASCII) string, will be space padded.
-    Z	A null terminated (ASCIZ) string, will be null padded.
-
-    b	A bit string (ascending bit order inside each byte, like vec()).
-    B	A bit string (descending bit order inside each byte).
-    h	A hex string (low nybble first).
-    H	A hex string (high nybble first).
-
-    c	A signed char (8-bit) value.
-    C	An unsigned char (octet) value.
-    W   An unsigned char value (can be greater than 255).
-
-    s	A signed short (16-bit) value.
-    S	An unsigned short value.
-
-    l	A signed long (32-bit) value.
-    L	An unsigned long value.
-
-    q	A signed quad (64-bit) value.
-    Q	An unsigned quad value.
-	  (Quads are available only if your system supports 64-bit
-	   integer values _and_ if Perl has been compiled to support those.
-           Causes a fatal error otherwise.)
-
-    i	A signed integer value.
-    I	A unsigned integer value.
-	  (This 'integer' is _at_least_ 32 bits wide.  Its exact
+    a  A string with arbitrary binary data, will be null padded.
+    A  A text (ASCII) string, will be space padded.
+    Z  A null-terminated (ASCIZ) string, will be null padded.
+
+    b  A bit string (ascending bit order inside each byte, like vec()).
+    B  A bit string (descending bit order inside each byte).
+    h  A hex string (low nybble first).
+    H  A hex string (high nybble first).
+
+    c  A signed char (8-bit) value.
+    C  An unsigned char (octet) value.
+    W  An unsigned char value (can be greater than 255).
+
+    s  A signed short (16-bit) value.
+    S  An unsigned short value.
+
+    l  A signed long (32-bit) value.
+    L  An unsigned long value.
+
+    q  A signed quad (64-bit) value.
+    Q  An unsigned quad value.
+      (Quads are available only if your system supports 64-bit
+       integer values _and_ if Perl has been compiled to support those.
+           Raises an exception otherwise.)
+
+    i  A signed integer value.
+    I  A unsigned integer value.
+      (This 'integer' is _at_least_ 32 bits wide.  Its exact
            size depends on what a local C compiler calls 'int'.)
 
-    n	An unsigned short (16-bit) in "network" (big-endian) order.
-    N	An unsigned long (32-bit) in "network" (big-endian) order.
-    v	An unsigned short (16-bit) in "VAX" (little-endian) order.
-    V	An unsigned long (32-bit) in "VAX" (little-endian) order.
+    n  An unsigned short (16-bit) in "network" (big-endian) order.
+    N  An unsigned long (32-bit) in "network" (big-endian) order.
+    v  An unsigned short (16-bit) in "VAX" (little-endian) order.
+    V  An unsigned long (32-bit) in "VAX" (little-endian) order.
 
     j   A Perl internal signed integer value (IV).
     J   A Perl internal unsigned integer value (UV).
 
-    f	A single-precision float in the native format.
-    d	A double-precision float in the native format.
+    f  A single-precision float in native format.
+    d  A double-precision float in native format.
 
-    F	A Perl internal floating point value (NV) in the native format
-    D	A long double-precision float in the native format.
-	  (Long doubles are available only if your system supports long
-	   double values _and_ if Perl has been compiled to support those.
-           Causes a fatal error otherwise.)
+    F  A Perl internal floating-point value (NV) in native format
+    D  A float of long-double precision in native format.
+      (Long doubles are available only if your system supports long
+       double values _and_ if Perl has been compiled to support those.
+           Raises an exception otherwise.)
 
-    p	A pointer to a null-terminated string.
-    P	A pointer to a structure (fixed-length string).
+    p  A pointer to a null-terminated string.
+    P  A pointer to a structure (fixed-length string).
 
-    u	A uuencoded string.
-    U	A Unicode character number.  Encodes to a character in character mode
+    u  A uuencoded string.
+    U  A Unicode character number.  Encodes to a character in character mode
         and UTF-8 (or UTF-EBCDIC in EBCDIC platforms) in byte mode.
 
-    w	A BER compressed integer (not an ASN.1 BER, see perlpacktut for
-	details).  Its bytes represent an unsigned integer in base 128,
-	most significant digit first, with as few digits as possible.  Bit
-	eight (the high bit) is set on each byte except the last.
-
-    x	A null byte.
-    X	Back up a byte.
-    @	Null fill or truncate to absolute position, counted from the
-        start of the innermost ()-group.
-    .   Null fill or truncate to absolute position specified by value.
-    (	Start of a ()-group.
-
-One or more of the modifiers below may optionally follow some letters in the
-TEMPLATE (the second column lists the letters for which the modifier is
-valid):
+    w  A BER compressed integer (not an ASN.1 BER, see perlpacktut for
+       details).  Its bytes represent an unsigned integer in base 128,
+       most significant digit first, with as few digits as possible.  Bit
+       eight (the high bit) is set on each byte except the last.
+
+    x  A null byte (a.k.a ASCII NUL, "\000", chr(0))
+    X  Back up a byte.
+    @  Null-fill or truncate to absolute position, counted from the
+       start of the innermost ()-group.
+    .  Null-fill or truncate to absolute position specified by the value.
+    (  Start of a ()-group.
+
+One or more modifiers below may optionally follow certain letters in the
+TEMPLATE (the second column lists letters for which the modifier is valid):
 
     !   sSlLiI     Forces native (short, long, int) sizes instead
                    of fixed (16-/32-bit) sizes.
@@ -3639,48 +3758,78 @@
     <   sSiIlLqQ   Force little-endian byte-order on the type.
         jJfFdDpP   (The "little end" touches the construct.)
 
-The C<E<gt>> and C<E<lt>> modifiers can also be used on C<()>-groups,
-in which case they force a certain byte-order on all components of
-that group, including subgroups.
+The C<< > >> and C<< < >> modifiers can also be used on C<()> groups 
+to force a particular byte-order on all components in that group, 
+including all its subgroups.
 
 The following rules apply:
 
-=over 8
+=over 
 
 =item *
 
-Each letter may optionally be followed by a number giving a repeat
-count.  With all types except C<a>, C<A>, C<Z>, C<b>, C<B>, C<h>,
-C<H>, C<@>, C<.>, C<x>, C<X> and C<P> the pack function will gobble up
-that many values from the LIST.  A C<*> for the repeat count means to
-use however many items are left, except for C<@>, C<x>, C<X>, where it
-is equivalent to C<0>, for <.> where it means relative to string start
-and C<u>, where it is equivalent to 1 (or 45, which is the same).
-A numeric repeat count may optionally be enclosed in brackets, as in
-C<pack 'C[80]', @arr>.
-
-One can replace the numeric repeat count by a template enclosed in brackets;
-then the packed length of this template in bytes is used as a count.
-For example, C<x[L]> skips a long (it skips the number of bytes in a long);
-the template C<$t X[$t] $t> unpack()s twice what $t unpacks.
-If the template in brackets contains alignment commands (such as C<x![d]>),
-its packed length is calculated as if the start of the template has the maximal
-possible alignment.
-
-When used with C<Z>, C<*> results in the addition of a trailing null
-byte (so the packed result will be one longer than the byte C<length>
-of the item).
+Each letter may optionally be followed by a number indicating the repeat
+count.  A numeric repeat count may optionally be enclosed in brackets, as
+in C<pack("C[80]", @arr)>.  The repeat count gobbles that many values from
+the LIST when used with all format types other than C<a>, C<A>, C<Z>, C<b>,
+C<B>, C<h>, C<H>, C<@>, C<.>, C<x>, C<X>, and C<P>, where it means
+something else, dscribed below.  Supplying a C<*> for the repeat count
+instead of a number means to use however many items are left, except for:
+
+=over 
+
+=item * 
+
+C<@>, C<x>, and C<X>, where it is equivalent to C<0>.
+
+=item * 
+
+<.>, where it means relative to the start of the string.
+
+=item * 
+
+C<u>, where it is equivalent to 1 (or 45, which here is equivalent).
+
+=back 
+
+One can replace a numeric repeat count with a template letter enclosed in
+brackets to use the packed byte length of the bracketed template for the
+repeat count.
+
+For example, the template C<x[L]> skips as many bytes as in a packed long,
+and the template C<"$t X[$t] $t"> unpacks twice whatever $t (when
+variable-expanded) unpacks.  If the template in brackets contains alignment
+commands (such as C<x![d]>), its packed length is calculated as if the
+start of the template had the maximal possible alignment.
+
+When used with C<Z>, a C<*> as the repeat count is guaranteed to add a
+trailing null byte, so the resulting string is always one byte longer than
+the byte length of the item itself.
 
 When used with C<@>, the repeat count represents an offset from the start
-of the innermost () group.
+of the innermost C<()> group.
+
+When used with C<.>, the repeat count determines the starting position to
+calculate the value offset as follows:
 
-When used with C<.>, the repeat count is used to determine the starting
-position from where the value offset is calculated. If the repeat count
-is 0, it's relative to the current position. If the repeat count is C<*>,
-the offset is relative to the start of the packed string. And if its an
-integer C<n> the offset is relative to the start of the n-th innermost
-() group (or the start of the string if C<n> is bigger then the group
-level).
+=over 
+
+=item *
+
+If the repeat count is C<0>, it's relative to the current position.
+
+=item *
+
+If the repeat count is C<*>, the offset is relative to the start of the
+packed string.
+
+=item *
+
+And if it's an integer I<n>, the offset is relative to the start of the
+I<n>th innermost C<()> group, or to the start of the string if I<n> is
+bigger then the group level.
+
+=back
 
 The repeat count for C<u> is interpreted as the maximal number of bytes
 to encode per line of output, with 0, 1 and 2 replaced by 45. The repeat 
@@ -3689,139 +3838,155 @@
 =item *
 
 The C<a>, C<A>, and C<Z> types gobble just one value, but pack it as a
-string of length count, padding with nulls or spaces as necessary.  When
+string of length count, padding with nulls or spaces as needed.  When
 unpacking, C<A> strips trailing whitespace and nulls, C<Z> strips everything
-after the first null, and C<a> returns data verbatim.
+after the first null, and C<a> returns data without any sort of trimming.
 
-If the value-to-pack is too long, it is truncated.  If too long and an
-explicit count is provided, C<Z> packs only C<$count-1> bytes, followed
-by a null byte.  Thus C<Z> always packs a trailing null (except when the
-count is 0).
+If the value to pack is too long, the result is truncated.  If it's too
+long and an explicit count is provided, C<Z> packs only C<$count-1> bytes,
+followed by a null byte.  Thus C<Z> always packs a trailing null, except
+for when the count is 0.
 
 =item *
 
-Likewise, the C<b> and C<B> fields pack a string that many bits long.
-Each character of the input field of pack() generates 1 bit of the result.
+Likewise, the C<b> and C<B> formats pack a string that's that many bits long.
+Each such format generates 1 bit of the result.
+
 Each result bit is based on the least-significant bit of the corresponding
 input character, i.e., on C<ord($char)%2>.  In particular, characters C<"0">
-and C<"1"> generate bits 0 and 1, as do characters C<"\0"> and C<"\1">.
+and C<"1"> generate bits 0 and 1, as do characters C<"\000"> and C<"\001">.
 
-Starting from the beginning of the input string of pack(), each 8-tuple
-of characters is converted to 1 character of output.  With format C<b>
+Starting from the beginning of the input string, each 8-tuple
+of characters is converted to 1 character of output.  With format C<b>,
 the first character of the 8-tuple determines the least-significant bit of a
-character, and with format C<B> it determines the most-significant bit of
+character; with format C<B>, it determines the most-significant bit of
 a character.
 
-If the length of the input string is not exactly divisible by 8, the
+If the length of the input string is not evenly divisible by 8, the
 remainder is packed as if the input string were padded by null characters
-at the end.  Similarly, during unpack()ing the "extra" bits are ignored.
+at the end.  Similarly during unpacking, "extra" bits are ignored.
+
+If the input string is longer than needed, remaining characters are ignored.
 
-If the input string of pack() is longer than needed, extra characters are 
-ignored. A C<*> for the repeat count of pack() means to use all the 
-characters of the input field.  On unpack()ing the bits are converted to a 
-string of C<"0">s and C<"1">s.
+A C<*> for the repeat count uses all characters of the input field.  
+On unpacking, bits are converted to a string of C<"0">s and C<"1">s.
 
 =item *
 
-The C<h> and C<H> fields pack a string that many nybbles (4-bit groups,
-representable as hexadecimal digits, 0-9a-f) long.
+The C<h> and C<H> formats pack a string that many nybbles (4-bit groups,
+representable as hexadecimal digits, C<"0".."9"> C<"a".."f">) long.
 
-Each character of the input field of pack() generates 4 bits of the result.
-For non-alphabetical characters the result is based on the 4 least-significant
+For each such format, pack() generates 4 bits of the result.
+With non-alphabetical characters, the result is based on the 4 least-significant
 bits of the input character, i.e., on C<ord($char)%16>.  In particular,
 characters C<"0"> and C<"1"> generate nybbles 0 and 1, as do bytes
-C<"\0"> and C<"\1">.  For characters C<"a".."f"> and C<"A".."F"> the result
+C<"\0"> and C<"\1">.  For characters C<"a".."f"> and C<"A".."F">, the result
 is compatible with the usual hexadecimal digits, so that C<"a"> and
-C<"A"> both generate the nybble C<0xa==10>.  The result for characters
-C<"g".."z"> and C<"G".."Z"> is not well-defined.
+C<"A"> both generate the nybble C<0xa==10>.  Do not use any characters
+but these with this format.
 
-Starting from the beginning of the input string of pack(), each pair
-of characters is converted to 1 character of output.  With format C<h> the
+Starting from the beginning of the template to pack(), each pair
+of characters is converted to 1 character of output.  With format C<h>, the
 first character of the pair determines the least-significant nybble of the
-output character, and with format C<H> it determines the most-significant
+output character; with format C<H>, it determines the most-significant
 nybble.
 
-If the length of the input string is not even, it behaves as if padded
-by a null character at the end.  Similarly, during unpack()ing the "extra"
-nybbles are ignored.
-
-If the input string of pack() is longer than needed, extra characters are
-ignored.
-A C<*> for the repeat count of pack() means to use all the characters of
-the input field.  On unpack()ing the nybbles are converted to a string
-of hexadecimal digits.
+If the length of the input string is not even, it behaves as if padded by
+a null character at the end.  Similarly, "extra" nybbles are ignored during
+unpacking.
+
+If the input string is longer than needed, extra characters are ignored.
+
+A C<*> for the repeat count uses all characters of the input field.  For
+unpack(), nybbles are converted to a string of hexadecimal digits.
 
 =item *
 
-The C<p> type packs a pointer to a null-terminated string.  You are
-responsible for ensuring the string is not a temporary value (which can
-potentially get deallocated before you get around to using the packed result).
-The C<P> type packs a pointer to a structure of the size indicated by the
-length.  A NULL pointer is created if the corresponding value for C<p> or
-C<P> is C<undef>, similarly for unpack().
+The C<p> format packs a pointer to a null-terminated string.  You are
+responsible for ensuring that the string is not a temporary value, as that
+could potentially get deallocated before you got around to using the packed
+result.  The C<P> format packs a pointer to a structure of the size indicated
+by the length.  A null pointer is created if the corresponding value for
+C<p> or C<P> is C<undef>; similarly with unpack(), where a null pointer
+unpacks into C<undef>.
 
-If your system has a strange pointer size (i.e. a pointer is neither as
-big as an int nor as big as a long), it may not be possible to pack or
+If your system has a strange pointer size--meaning a pointer is neither as
+big as an int nor as big as a long--it may not be possible to pack or
 unpack pointers in big- or little-endian byte order.  Attempting to do
-so will result in a fatal error.
+so raises an exception.
 
 =item *
 
 The C</> template character allows packing and unpacking of a sequence of
-items where the packed structure contains a packed item count followed by 
-the packed items themselves.
-
-For C<pack> you write I<length-item>C</>I<sequence-item> and the
-I<length-item> describes how the length value is packed. The ones likely
-to be of most use are integer-packing ones like C<n> (for Java strings),
-C<w> (for ASN.1 or SNMP) and C<N> (for Sun XDR).
-
-For C<pack>, the I<sequence-item> may have a repeat count, in which case
-the minimum of that and the number of available items is used as argument
-for the I<length-item>. If it has no repeat count or uses a '*', the number
+items where the packed structure contains a packed item count followed by
+the packed items themselves.  This is useful when the structure you're
+unpacking has encoded the sizes or repeat counts for some of its fields
+within the structure itself as separate fields.
+
+For C<pack>, you write I<length-item>C</>I<sequence-item>, and the
+I<length-item> describes how the length value is packed. Formats likely
+to be of most use are integer-packing ones like C<n> for Java strings,
+C<w> for ASN.1 or SNMP, and C<N> for Sun XDR.
+
+For C<pack>, I<sequence-item> may have a repeat count, in which case
+the minimum of that and the number of available items is used as the argument
+for I<length-item>. If it has no repeat count or uses a '*', the number
 of available items is used.
 
-For C<unpack> an internal stack of integer arguments unpacked so far is
+For C<unpack>, an internal stack of integer arguments unpacked so far is
 used. You write C</>I<sequence-item> and the repeat count is obtained by
 popping off the last element from the stack. The I<sequence-item> must not
 have a repeat count.
 
-If the I<sequence-item> refers to a string type (C<"A">, C<"a"> or C<"Z">),
-the I<length-item> is a string length, not a number of strings. If there is
-an explicit repeat count for pack, the packed string will be adjusted to that
-given length.
-
-    unpack 'W/a', "\04Gurusamy";            gives ('Guru')
-    unpack 'a3/A A*', '007 Bond  J ';       gives (' Bond', 'J')
-    unpack 'a3 x2 /A A*', '007: Bond, J.';  gives ('Bond, J', '.')
-    pack 'n/a* w/a','hello,','world';       gives "\000\006hello,\005world"
-    pack 'a/W2', ord('a') .. ord('z');      gives '2ab'
+If I<sequence-item> refers to a string type (C<"A">, C<"a">, or C<"Z">),
+the I<length-item> is the string length, not the number of strings.  With
+an explicit repeat count for pack, the packed string is adjusted to that
+length.  For example:
+
+    unpack("W/a", "\04Gurusamy")            gives ("Guru")
+    unpack("a3/A A*", "007 Bond  J ")       gives (" Bond", "J")
+    unpack("a3 x2 /A A*", "007: Bond, J.")  gives ("Bond, J", ".")
+
+    pack("n/a* w/a","hello,","world")       gives "\000\006hello,\005world"
+    pack("a/W2", ord("a") .. ord("z"))      gives "2ab"
 
 The I<length-item> is not returned explicitly from C<unpack>.
 
-Adding a count to the I<length-item> letter is unlikely to do anything
-useful, unless that letter is C<A>, C<a> or C<Z>.  Packing with a
-I<length-item> of C<a> or C<Z> may introduce C<"\000"> characters,
-which Perl does not regard as legal in numeric strings.
+Supplying a count to the I<length-item> format letter is only useful with
+C<A>, C<a>, or C<Z>.  Packing with a I<length-item> of C<a> or C<Z> may
+introduce C<"\000"> characters, which Perl does not regard as legal in
+numeric strings.
 
 =item *
 
 The integer types C<s>, C<S>, C<l>, and C<L> may be
-followed by a C<!> modifier to signify native shorts or
-longs--as you can see from above for example a bare C<l> does mean
-exactly 32 bits, the native C<long> (as seen by the local C compiler)
-may be larger.  This is an issue mainly in 64-bit platforms.  You can
-see whether using C<!> makes any difference by
+followed by a C<!> modifier to specify native shorts or
+longs.  As shown in the example above, a bare C<l> means
+exactly 32 bits, although the native C<long> as seen by the local C compiler
+may be larger.  This is mainly an issue on 64-bit platforms.  You can
+see whether using C<!> makes any difference this way:
+
+    printf "format s is %d, s! is %d\n", 
+	length pack("s"), length pack("s!");
+
+    printf "format l is %d, l! is %d\n", 
+	length pack("l"), length pack("l!");
 
-	print length(pack("s")), " ", length(pack("s!")), "\n";
-	print length(pack("l")), " ", length(pack("l!")), "\n";
 
-C<i!> and C<I!> also work but only because of completeness;
+C<i!> and C<I!> are also allowed, but only for completeness' sake:
 they are identical to C<i> and C<I>.
 
 The actual sizes (in bytes) of native shorts, ints, longs, and long
-longs on the platform where Perl was built are also available via
-L<Config>:
+longs on the platform where Perl was built are also available from
+the command line:
+
+    $ perl -V:{short,int,long{,long}}size
+    shortsize='2';
+    intsize='4';
+    longsize='4';
+    longlongsize='8';
+
+or programmatically via the C<Config> module:
 
        use Config;
        print $Config{shortsize},    "\n";
@@ -3829,165 +3994,188 @@
        print $Config{longsize},     "\n";
        print $Config{longlongsize}, "\n";
 
-(The C<$Config{longlongsize}> will be undefined if your system does
-not support long longs.)
+C<$Config{longlongsize}> is undefined on systems without 
+long long support.
 
 =item *
 
-The integer formats C<s>, C<S>, C<i>, C<I>, C<l>, C<L>, C<j>, and C<J>
-are inherently non-portable between processors and operating systems
-because they obey the native byteorder and endianness.  For example a
-4-byte integer 0x12345678 (305419896 decimal) would be ordered natively
-(arranged in and handled by the CPU registers) into bytes as
-
- 	0x12 0x34 0x56 0x78	# big-endian
- 	0x78 0x56 0x34 0x12	# little-endian
-
-Basically, the Intel and VAX CPUs are little-endian, while everybody
-else, for example Motorola m68k/88k, PPC, Sparc, HP PA, Power, and
-Cray are big-endian.  Alpha and MIPS can be either: Digital/Compaq
-used/uses them in little-endian mode; SGI/Cray uses them in big-endian
-mode.
-
-The names `big-endian' and `little-endian' are comic references to
-the classic "Gulliver's Travels" (via the paper "On Holy Wars and a
-Plea for Peace" by Danny Cohen, USC/ISI IEN 137, April 1, 1980) and
-the egg-eating habits of the Lilliputians.
+The integer formats C<s>, C<S>, C<i>, C<I>, C<l>, C<L>, C<j>, and C<J> are
+inherently non-portable between processors and operating systems because
+they obey native byteorder and endianness.  For example, a 4-byte integer
+0x12345678 (305419896 decimal) would be ordered natively (arranged in and
+handled by the CPU registers) into bytes as
+
+    0x12 0x34 0x56 0x78  # big-endian
+    0x78 0x56 0x34 0x12  # little-endian
+
+Basically, Intel and VAX CPUs are little-endian, while everybody else,
+including Motorola m68k/88k, PPC, Sparc, HP PA, Power, and Cray, are
+big-endian.  Alpha and MIPS can be either: Digital/Compaq used/uses them in
+little-endian mode, but SGI/Cray uses them in big-endian mode.
+
+The names I<big-endian> and I<little-endian> are comic references to the
+egg-eating habits of the little-endian Lilliputians and the big-endian
+Blefuscudians from the classic Jonathan Swift satire, I<Gulliver's Travels>.
+This entered computer lingo via the paper "On Holy Wars and a Plea for
+Peace" by Danny Cohen, USC/ISI IEN 137, April 1, 1980.
 
 Some systems may have even weirder byte orders such as
 
- 	0x56 0x78 0x12 0x34
- 	0x34 0x12 0x78 0x56
+   0x56 0x78 0x12 0x34
+   0x34 0x12 0x78 0x56
 
-You can see your system's preference with
+You can determine your system endianness with this incantation:
 
- 	print join(" ", map { sprintf "%#02x", $_ }
-                            unpack("W*",pack("L",0x12345678))), "\n";
+   printf("%#02x ", $_) for unpack("W*", pack L=>0x12345678); 
 
 The byteorder on the platform where Perl was built is also available
 via L<Config>:
 
-	use Config;
-	print $Config{byteorder}, "\n";
+    use Config;
+    print "$Config{byteorder}\n";
 
-Byteorders C<'1234'> and C<'12345678'> are little-endian, C<'4321'>
-and C<'87654321'> are big-endian.
+or from the command line:
 
-If you want portable packed integers you can either use the formats
-C<n>, C<N>, C<v>, and C<V>, or you can use the C<E<gt>> and C<E<lt>>
-modifiers.  These modifiers are only available as of perl 5.9.2.
-See also L<perlport>.
+    $ perl -V:byteorder
+
+Byteorders C<"1234"> and C<"12345678"> are little-endian; C<"4321">
+and C<"87654321"> are big-endian.
+
+For portably packed integers, either use the formats C<n>, C<N>, C<v>, 
+and C<V> or else use the C<< > >> and C<< < >> modifiers described
+immediately below.  See also L<perlport>.
 
 =item *
 
-All integer and floating point formats as well as C<p> and C<P> and
-C<()>-groups may be followed by the C<E<gt>> or C<E<lt>> modifiers
-to force big- or little- endian byte-order, respectively.
-This is especially useful, since C<n>, C<N>, C<v> and C<V> don't cover
-signed integers, 64-bit integers and floating point values.  However,
-there are some things to keep in mind.
-
-Exchanging signed integers between different platforms only works
-if all platforms store them in the same format.  Most platforms store
-signed integers in two's complement, so usually this is not an issue.
+Starting with Perl 5.9.2, integer and floating-point formats, along with
+the C<p> and C<P> formats and C<()> groups, may all be followed by the 
+C<< > >> or C<< < >> endianness modifiers to respectively enforce big-
+or little-endian byte-order.  These modifiers are especially useful 
+given how C<n>, C<N>, C<v> and C<V> don't cover signed integers, 
+64-bit integers, or floating-point values.
+
+Here are some concerns to keep in mind when using endianness modifier:
+
+=over
+
+=item * 
+
+Exchanging signed integers between different platforms works only 
+when all platforms store them in the same format.  Most platforms store
+signed integers in two's-complement notation, so usually this is not an issue.
+
+=item * 
 
-The C<E<gt>> or C<E<lt>> modifiers can only be used on floating point
+The C<< > >> or C<< < >> modifiers can only be used on floating-point
 formats on big- or little-endian machines.  Otherwise, attempting to
-do so will result in a fatal error.
+use them raises an exception.
 
-Forcing big- or little-endian byte-order on floating point values for
-data exchange can only work if all platforms are using the same
-binary representation (e.g. IEEE floating point format).  Even if all
-platforms are using IEEE, there may be subtle differences.  Being able
-to use C<E<gt>> or C<E<lt>> on floating point values can be very useful,
-but also very dangerous if you don't know exactly what you're doing.
-It is definitely not a general way to portably store floating point
-values.
-
-When using C<E<gt>> or C<E<lt>> on an C<()>-group, this will affect
-all types inside the group that accept the byte-order modifiers,
-including all subgroups.  It will silently be ignored for all other
+=item * 
+
+Forcing big- or little-endian byte-order on floating-point values for
+data exchange can work only if all platforms use the same
+binary representation such as IEEE floating-point.  Even if all
+platforms are using IEEE, there may still be subtle differences.  Being able
+to use C<< > >> or C<< < >> on floating-point values can be useful,
+but also dangerous if you don't know exactly what you're doing.
+It is not a general way to portably store floating-point values.
+
+=item * 
+
+When using C<< > >> or C<< < >> on a C<()> group, this affects
+all types inside the group that accept byte-order modifiers,
+including all subgroups.  It is silently ignored for all other
 types.  You are not allowed to override the byte-order within a group
 that already has a byte-order modifier suffix.
 
+=back
+
 =item *
 
-Real numbers (floats and doubles) are in the native machine format only;
-due to the multiplicity of floating formats around, and the lack of a
-standard "network" representation, no facility for interchange has been
-made.  This means that packed floating point data written on one machine
-may not be readable on another - even if both use IEEE floating point
-arithmetic (as the endian-ness of the memory representation is not part
+Real numbers (floats and doubles) are in native machine format only.
+Due to the multiplicity of floating-point formats and the lack of a
+standard "network" representation for them, no facility for interchange has been
+made.  This means that packed floating-point data written on one machine
+may not be readable on another, even if both use IEEE floating-point
+arithmetic (because the endianness of the memory representation is not part
 of the IEEE spec).  See also L<perlport>.
 
-If you know exactly what you're doing, you can use the C<E<gt>> or C<E<lt>>
-modifiers to force big- or little-endian byte-order on floating point values.
+If you know I<exactly> what you're doing, you can use the C<< > >> or C<< < >>
+modifiers to force big- or little-endian byte-order on floating-point values.
 
-Note that Perl uses doubles (or long doubles, if configured) internally for
-all numeric calculation, and converting from double into float and thence back
-to double again will lose precision (i.e., C<unpack("f", pack("f", $foo)>)
-will not in general equal $foo).
+Because Perl uses doubles (or long doubles, if configured) internally for
+all numeric calculation, converting from double into float and thence 
+to double again loses precision, so C<unpack("f", pack("f", $foo)>)
+will not in general equal $foo.
 
 =item *
 
-Pack and unpack can operate in two modes, character mode (C<C0> mode) where
-the packed string is processed per character and UTF-8 mode (C<U0> mode)
+Pack and unpack can operate in two modes: character mode (C<C0> mode) where
+the packed string is processed per character, and UTF-8 mode (C<U0> mode)
 where the packed string is processed in its UTF-8-encoded Unicode form on
-a byte by byte basis. Character mode is the default unless the format string 
-starts with an C<U>. You can switch mode at any moment with an explicit 
-C<C0> or C<U0> in the format. A mode is in effect until the next mode switch 
-or until the end of the ()-group in which it was entered.
+a byte-by-byte basis. Character mode is the default unless the format string 
+starts with C<U>. You can always switch mode mid-format with an explicit 
+C<C0> or C<U0> in the format.  This mode remains in effect until the next 
+mode change, or until the end of the C<()> group it (directly) applies to.
 
 =item *
 
-You must yourself do any alignment or padding by inserting for example
-enough C<'x'>es while packing.  There is no way to pack() and unpack()
-could know where the characters are going to or coming from.  Therefore
-C<pack> (and C<unpack>) handle their output and input as flat
-sequences of characters.
+You must yourself do any alignment or padding by inserting, for example,
+enough C<"x">es while packing.  There is no way for pack() and unpack()
+to know where characters are going to or coming from, so they 
+handle their output and input as flat sequences of characters.
 
 =item *
 
-A ()-group is a sub-TEMPLATE enclosed in parentheses.  A group may
-take a repeat count, both as postfix, and for unpack() also via the C</>
-template character. Within each repetition of a group, positioning with
-C<@> starts again at 0. Therefore, the result of
+A C<()> group is a sub-TEMPLATE enclosed in parentheses.  A group may
+take a repeat count either as postfix, or for unpack(), also via the C</>
+template character.  Within each repetition of a group, positioning with
+C<@> starts over at 0. Therefore, the result of
 
-    pack( '@1A((@2A)@3A)', 'a', 'b', 'c' )
+    pack("@1A((@2A)@3A)", qw[X Y Z])
 
-is the string "\0a\0\0bc".
+is the string C<"\0X\0\0YZ">.
 
 =item *
 
-C<x> and C<X> accept C<!> modifier.  In this case they act as
-alignment commands: they jump forward/back to the closest position
-aligned at a multiple of C<count> characters. For example, to pack() or
-unpack() C's C<struct {char c; double d; char cc[2]}> one may need to
-use the template C<W x![d] d W[2]>; this assumes that doubles must be
-aligned on the double's size.
+C<x> and C<X> accept the C<!> modifier to act as alignment commands: they
+jump forward or back to the closest position aligned at a multiple of C<count>
+characters. For example, to pack() or unpack() a C structure like
 
-For alignment commands C<count> of 0 is equivalent to C<count> of 1;
-both result in no-ops.
+    struct {
+	char   c;    /* one signed, 8-bit character */
+	double d; 
+	char   cc[2];
+    }
+
+one may need to use the template C<c x![d] d c[2]>.  This assumes that
+doubles must be aligned to the size of double.
+
+For alignment commands, a C<count> of 0 is equivalent to a C<count> of 1;
+both are no-ops.
 
 =item *
 
-C<n>, C<N>, C<v> and C<V> accept the C<!> modifier. In this case they
-will represent signed 16-/32-bit integers in big-/little-endian order.
-This is only portable if all platforms sharing the packed data use the
-same binary representation for signed integers (e.g. all platforms are
-using two's complement representation).
+C<n>, C<N>, C<v> and C<V> accept the C<!> modifier to
+represent signed 16-/32-bit integers in big-/little-endian order.
+This is portable only when all platforms sharing packed data use the
+same binary representation for signed integers; for example, when all
+platforms use two's-complement representation.
 
 =item *
 
-A comment in a TEMPLATE starts with C<#> and goes to the end of line.
-White space may be used to separate pack codes from each other, but
-modifiers and a repeat count must follow immediately.
+Comments can be embedded in a TEMPLATE using C<#> through the end of line.
+White space can separate pack codes from each other, but modifiers and
+repeat counts must follow immediately.  Breaking complex templates into
+individual line-by-line components, suitably annotated, can do as much to
+improve legibility and maintainability of pack/unpack formats as C</x> can
+for complicated pattern matches.
 
 =item *
 
-If TEMPLATE requires more arguments to pack() than actually given, pack()
+If TEMPLATE requires more arguments that pack() is given, pack()
 assumes additional C<""> arguments.  If TEMPLATE requires fewer arguments
-to pack() than actually given, extra arguments are ignored.
+than given, extra arguments are ignored.
 
 =back
 
@@ -4010,10 +4198,10 @@
     $foo = pack("ccxxcc",65,66,67,68);
     # foo eq "AB\0\0CD"
 
-    # note: the above examples featuring "W" and "c" are true
+    # NOTE: The examples above featuring "W" and "c" are true
     # only on ASCII and ASCII-derived systems such as ISO Latin 1
-    # and UTF-8.  In EBCDIC the first example would be
-    # $foo = pack("WWWW",193,194,195,196);
+    # and UTF-8.  On EBCDIC systems, the first example would be
+    #      $foo = pack("WWWW",193,194,195,196);
 
     $foo = pack("s2",1,2);
     # "\1\0\2\0" on little-endian
@@ -4039,7 +4227,7 @@
     # "@utmp1" eq "@utmp2"
 
     sub bintodec {
-	unpack("N", pack("B32", substr("0" x 32 . shift, -32)));
+        unpack("N", pack("B32", substr("0" x 32 . shift, -32)));
     }
 
     $foo = pack('sx2l', 12, 34);
@@ -4061,26 +4249,34 @@
 
 The same template may generally also be used in unpack().
 
-=item package NAMESPACE
-X<package> X<module> X<namespace>
+=item package NAMESPACE VERSION
+X<package> X<module> X<namespace> X<version>
 
-=item package
+=item package NAMESPACE
 
 Declares the compilation unit as being in the given namespace.  The scope
 of the package declaration is from the declaration itself through the end
 of the enclosing block, file, or eval (the same as the C<my> operator).
 All further unqualified dynamic identifiers will be in this namespace.
-A package statement affects only dynamic variables--including those
-you've used C<local> on--but I<not> lexical variables, which are created
-with C<my>.  Typically it would be the first declaration in a file to
-be included by the C<require> or C<use> operator.  You can switch into a
-package in more than one place; it merely influences which symbol table
-is used by the compiler for the rest of that block.  You can refer to
-variables and filehandles in other packages by prefixing the identifier
-with the package name and a double colon:  C<$Package::Variable>.
-If the package name is null, the C<main> package as assumed.  That is,
-C<$::sail> is equivalent to C<$main::sail> (as well as to C<$main'sail>,
-still seen in older code).
+A package statement affects dynamic variables only, including those
+you've used C<local> on, but I<not> lexical variables, which are created
+with C<my> (or C<our> (or C<state>)).  Typically it would be the first 
+declaration in a file included by C<require> or C<use>.  You can switch into a
+package in more than one place, since this only determines which default 
+symbol table the compiler uses for the rest of that block.  You can refer to
+identifiers in other packages than the current one by prefixing the identifier
+with the package name and a double colon, as in C<$SomePack::var>
+or C<ThatPack::INPUT_HANDLE>.  If package name is omitted, the C<main>
+package as assumed.  That is, C<$::sail> is equivalent to
+C<$main::sail> (as well as to C<$main'sail>, still seen in ancient
+code, mostly from Perl 4).
+
+If VERSION is provided, C<package> sets the C<$VERSION> variable in the given
+namespace to a L<version> object with the VERSION provided.  VERSION must be a
+"strict" style version number as defined by the L<version> module: a positive
+decimal number (integer or decimal-fraction) without exponentiation or else a
+dotted-decimal v-string with a leading 'v' character and at least three
+components.  You should set C<$VERSION> only once per package.
 
 See L<perlmod/"Packages"> for more information about packages, modules,
 and classes.  See L<perlsub> for other scoping issues.
@@ -4097,9 +4293,9 @@
 See L<IPC::Open2>, L<IPC::Open3>, and L<perlipc/"Bidirectional Communication">
 for examples of such things.
 
-On systems that support a close-on-exec flag on files, the flag will be set
-for the newly opened file descriptors as determined by the value of $^F.
-See L<perlvar/$^F>.
+On systems that support a close-on-exec flag on files, that flag is set
+on all newly opened file descriptors whose C<fileno>s are I<higher> than 
+the current value of $^F (by default 2 for C<STDERR>).  See L<perlvar/$^F>.
 
 =item pop ARRAY
 X<pop> X<stack>
@@ -4109,10 +4305,9 @@
 Pops and returns the last value of the array, shortening the array by
 one element.
 
-If there are no elements in the array, returns the undefined value
-(although this may happen at other times as well).  If ARRAY is
-omitted, pops the C<@ARGV> array in the main program, and the C<@_>
-array in subroutines, just like C<shift>.
+Returns the undefined value if the array is empty, although this may also
+happen at other times.  If ARRAY is omitted, pops the C<@ARGV> array in the
+main program, but the C<@_> array in subroutines, just like C<shift>.
 
 =item pos SCALAR
 X<pos> X<match, position>
@@ -4123,7 +4318,7 @@
 in question (C<$_> is used when the variable is not specified).  Note that
 0 is a valid match offset.  C<undef> indicates that the search position
 is reset (usually due to match failure, but can also be because no match has
-yet been performed on the scalar). C<pos> directly accesses the location used
+yet been run on the scalar). C<pos> directly accesses the location used
 by the regexp engine to store the offset, so assigning to C<pos> will change
 that offset, and so will also influence the C<\G> zero-width assertion in
 regular expressions. Because a failed C<m//gc> match doesn't reset the offset,
@@ -4138,15 +4333,15 @@
 =item print
 
 Prints a string or a list of strings.  Returns true if successful.
-FILEHANDLE may be a scalar variable name, in which case the variable
-contains the name of or a reference to the filehandle, thus introducing
+FILEHANDLE may be a scalar variable containing
+the name of or a reference to the filehandle, thus introducing
 one level of indirection.  (NOTE: If FILEHANDLE is a variable and
 the next token is a term, it may be misinterpreted as an operator
 unless you interpose a C<+> or put parentheses around the arguments.)
-If FILEHANDLE is omitted, prints by default to standard output (or
-to the last selected output channel--see L</select>).  If LIST is
-also omitted, prints C<$_> to the currently selected output channel.
-To set the default output channel to something other than STDOUT
+If FILEHANDLE is omitted, prints to standard output by default, or
+to the last selected output channel; see L</select>.  If LIST is
+also omitted, prints C<$_> to the currently selected output handle.
+To set the default output handle to something other than STDOUT
 use the select operation.  The current value of C<$,> (if any) is
 printed between each LIST item.  The current value of C<$\> (if
 any) is printed after the entire LIST has been printed.  Because
@@ -4155,8 +4350,8 @@
 its expressions evaluated in list context.  Also be careful not to
 follow the print keyword with a left parenthesis unless you want
 the corresponding right parenthesis to terminate the arguments to
-the print--interpose a C<+> or put parentheses around all the
-arguments.
+the print; put parentheses around all the arguments 
+(or interpose a C<+>, but that doesn't look as good).
 
 Note that if you're storing FILEHANDLEs in an array, or if you're using
 any other expression more complex than a scalar variable to retrieve it,
@@ -4165,6 +4360,9 @@
     print { $files[$i] } "stuff\n";
     print { $OK ? STDOUT : STDERR } "stuff\n";
 
+Printing to a closed pipe or socket will generate a SIGPIPE signal.  See
+L<perlipc> for more on signal handling.
+
 =item printf FILEHANDLE FORMAT, LIST
 X<printf>
 
@@ -4175,7 +4373,7 @@
 of the list will be interpreted as the C<printf> format. See C<sprintf>
 for an explanation of the format argument.  If C<use locale> is in effect,
 and POSIX::setlocale() has been called, the character used for the decimal
-separator in formatted floating point numbers is affected by the LC_NUMERIC
+separator in formatted floating-point numbers is affected by the LC_NUMERIC
 locale.  See L<perllocale> and L<POSIX>.
 
 Don't fall into the trap of using a C<printf> when a simple
@@ -4190,7 +4388,7 @@
 the function whose prototype you want to retrieve.
 
 If FUNCTION is a string starting with C<CORE::>, the rest is taken as a
-name for Perl builtin.  If the builtin is not I<overridable> (such as
+name for a Perl builtin.  If the builtin is not I<overridable> (such as
 C<qw//>) or if its arguments cannot be adequately expressed by a prototype
 (such as C<system>), prototype() returns C<undef>, because the builtin
 does not really behave like a Perl function.  Otherwise, the string
@@ -4204,7 +4402,7 @@
 LIST.  Has the same effect as
 
     for $value (LIST) {
-	$ARRAY[++$#ARRAY] = $value;
+        $ARRAY[++$#ARRAY] = $value;
     }
 
 but is more efficient.  Returns the number of elements in the array following
@@ -4238,6 +4436,32 @@
 
 If EXPR is omitted, uses C<$_>.
 
+quotemeta (and C<\Q> ... C<\E>) are useful when interpolating strings into
+regular expressions, because by default an interpolated variable will be
+considered a mini-regular expression. For example:
+
+    my $sentence = 'The quick brown fox jumped over the lazy dog';
+    my $substring = 'quick.*?fox';
+    $sentence =~ s{$substring}{big bad wolf};
+
+Will cause C<$sentence> to become C<'The big bad wolf jumped over...'>.
+
+On the other hand:
+
+    my $sentence = 'The quick brown fox jumped over the lazy dog';
+    my $substring = 'quick.*?fox';
+    $sentence =~ s{\Q$substring\E}{big bad wolf};
+
+Or:
+
+    my $sentence = 'The quick brown fox jumped over the lazy dog';
+    my $substring = 'quick.*?fox';
+    my $quoted_substring = quotemeta($substring);
+    $sentence =~ s{$quoted_substring}{big bad wolf};
+
+Will both leave the sentence as is. Normally, when accepting string input from
+the user, quotemeta() or C<\Q> must be used.
+
 =item rand EXPR
 X<rand> X<random>
 
@@ -4246,8 +4470,8 @@
 Returns a random fractional number greater than or equal to C<0> and less
 than the value of EXPR.  (EXPR should be positive.)  If EXPR is
 omitted, the value C<1> is used.  Currently EXPR with the value C<0> is
-also special-cased as C<1> - this has not been documented before perl 5.8.0
-and is subject to change in future versions of perl.  Automatically calls
+also special-cased as C<1> (this was undocumented before Perl 5.8.0
+and is subject to change in future versions of Perl).  Automatically calls
 C<srand> unless C<srand> has already been called.  See also C<srand>.
 
 Apply C<int()> to the value returned by C<rand()> if you want random
@@ -4280,8 +4504,8 @@
 results in the string being padded to the required size with C<"\0">
 bytes before the result of the read is appended.
 
-The call is actually implemented in terms of either Perl's or system's
-fread() call.  To get a true read(2) system call, see C<sysread>.
+The call is implemented in terms of either Perl's or your system's native
+fread(3) library function.  To get a true read(2) system call, see C<sysread>.
 
 Note the I<characters>: depending on the status of the filehandle,
 either (8-bit) bytes or characters are read.  By default all
@@ -4296,8 +4520,8 @@
 
 Returns the next directory entry for a directory opened by C<opendir>.
 If used in list context, returns all the rest of the entries in the
-directory.  If there are no more entries, returns an undefined value in
-scalar context or a null list in list context.
+directory.  If there are no more entries, returns the undefined value in
+scalar context and the empty list in list context.
 
 If you're planning to filetest the return values out of a C<readdir>, you'd
 better prepend the directory in question.  Otherwise, because we didn't
@@ -4307,6 +4531,15 @@
     @dots = grep { /^\./ && -f "$some_dir/$_" } readdir($dh);
     closedir $dh;
 
+As of Perl 5.11.2 you can use a bare C<readdir> in a C<while> loop,
+which will set C<$_> on every iteration.
+
+    opendir(my $dh, $some_dir) || die;
+    while(readdir $dh) {
+        print "$some_dir/$_\n";
+    }
+    closedir $dh;
+
 =item readline EXPR
 
 =item readline
@@ -4314,14 +4547,14 @@
 
 Reads from the filehandle whose typeglob is contained in EXPR (or from
 *ARGV if EXPR is not provided).  In scalar context, each call reads and
-returns the next line, until end-of-file is reached, whereupon the
-subsequent call returns undef.  In list context, reads until end-of-file
+returns the next line until end-of-file is reached, whereupon the
+subsequent call returns C<undef>.  In list context, reads until end-of-file
 is reached and returns a list of lines.  Note that the notion of "line"
-used here is however you may have defined it with C<$/> or
+used here is whatever you may have defined with C<$/> or
 C<$INPUT_RECORD_SEPARATOR>).  See L<perlvar/"$/">.
 
-When C<$/> is set to C<undef>, when readline() is in scalar
-context (i.e. file slurp mode), and when an empty file is read, it
+When C<$/> is set to C<undef>, when C<readline> is in scalar
+context (i.e., file slurp mode), and when an empty file is read, it
 returns C<''> the first time, followed by C<undef> subsequently.
 
 This is the internal function implementing the C<< <EXPR> >>
@@ -4329,21 +4562,31 @@
 operator is discussed in more detail in L<perlop/"I/O Operators">.
 
     $line = <STDIN>;
-    $line = readline(*STDIN);		# same thing
-
-If readline encounters an operating system error, C<$!> will be set with the
-corresponding error message.  It can be helpful to check C<$!> when you are
-reading from filehandles you don't trust, such as a tty or a socket.  The
-following example uses the operator form of C<readline>, and takes the necessary
-steps to ensure that C<readline> was successful.
+    $line = readline(*STDIN);    # same thing
 
-    for (;;) {
-        undef $!;
-        unless (defined( $line = <> )) {
-            last if eof;
-            die $! if $!;
+If C<readline> encounters an operating system error, C<$!> will be set
+with the corresponding error message.  It can be helpful to check
+C<$!> when you are reading from filehandles you don't trust, such as a
+tty or a socket.  The following example uses the operator form of
+C<readline> and dies if the result is not defined.
+
+    while ( ! eof($fh) ) {
+        defined( $_ = <$fh> ) or die "readline failed: $!";
+        ...
+    }
+
+Note that you have can't handle C<readline> errors that way with the
+C<ARGV> filehandle. In that case, you have to open each element of
+C<@ARGV> yourself since C<eof> handles C<ARGV> differently.
+
+    foreach my $arg (@ARGV) {
+        open(my $fh, $arg) or warn "Can't open $arg: $!";
+
+        while ( ! eof($fh) ) {
+            defined( $_ = <$fh> )
+                or die "readline failed for $arg: $!";
+            ...
         }
-        # ...
     }
 
 =item readlink EXPR
@@ -4352,7 +4595,7 @@
 =item readlink
 
 Returns the value of a symbolic link, if symbolic links are
-implemented.  If not, gives a fatal error.  If there is some system
+implemented.  If not, raises an exception.  If there is a system
 error, returns the undefined value and sets C<$!> (errno).  If EXPR is
 omitted, uses C<$_>.
 
@@ -4405,21 +4648,21 @@
     # a simpleminded Pascal comment stripper
     # (warning: assumes no { or } in strings)
     LINE: while (<STDIN>) {
-	while (s|({.*}.*){.*}|$1 |) {}
-	s|{.*}| |;
-	if (s|{.*| |) {
-	    $front = $_;
-	    while (<STDIN>) {
-		if (/}/) {	# end of comment?
-		    s|^|$front\{|;
-		    redo LINE;
-		}
-	    }
-	}
-	print;
+        while (s|({.*}.*){.*}|$1 |) {}
+        s|{.*}| |;
+        if (s|{.*| |) {
+            $front = $_;
+            while (<STDIN>) {
+                if (/}/) {  # end of comment?
+                    s|^|$front\{|;
+                    redo LINE;
+                }
+            }
+        }
+        print;
     }
 
-C<redo> cannot be used to retry a block which returns a value such as
+C<redo> cannot be used to retry a block that returns a value such as
 C<eval {}>, C<sub {}> or C<do {}>, and should not be used to exit
 a grep() or map() operation.
 
@@ -4457,10 +4700,10 @@
 name is returned instead.  You can think of C<ref> as a C<typeof> operator.
 
     if (ref($r) eq "HASH") {
-	print "r is a reference to a hash.\n";
+        print "r is a reference to a hash.\n";
     }
     unless (ref($r)) {
-	print "r is not a reference at all.\n";
+        print "r is not a reference at all.\n";
     }
 
 The return value C<LVALUE> indicates a reference to an lvalue that is not
@@ -4501,7 +4744,7 @@
 
 VERSION may be either a numeric argument such as 5.006, which will be
 compared to C<$]>, or a literal of the form v5.6.1, which will be compared
-to C<$^V> (aka $PERL_VERSION).  A fatal error is produced at run time if
+to C<$^V> (aka $PERL_VERSION).  An exception is raised if
 VERSION is greater than the version of the current Perl interpreter.
 Compare with L</use>, which can do a similar check at compile time.
 
@@ -4510,9 +4753,9 @@
 versions of Perl that do not support this syntax.  The equivalent numeric
 version should be used instead.
 
-    require v5.6.1;	# run time version check
-    require 5.6.1;	# ditto
-    require 5.006_001;	# ditto; preferred for backwards compatibility
+    require v5.6.1;     # run time version check
+    require 5.6.1;      # ditto
+    require 5.006_001;  # ditto; preferred for backwards compatibility
 
 Otherwise, C<require> demands that a library file be included if it
 hasn't already been included.  The file is included via the do-FILE
@@ -4565,7 +4808,7 @@
 
 In other words, if you try this:
 
-        require Foo::Bar;    # a splendid bareword
+        require Foo::Bar;     # a splendid bareword
 
 The require function will actually look for the "F<Foo/Bar.pm>" file in the
 directories specified in the C<@INC> array.
@@ -4573,32 +4816,32 @@
 But if you try this:
 
         $class = 'Foo::Bar';
-        require $class;	     # $class is not a bareword
+        require $class;       # $class is not a bareword
     #or
-        require "Foo::Bar";  # not a bareword because of the ""
+        require "Foo::Bar";   # not a bareword because of the ""
 
 The require function will look for the "F<Foo::Bar>" file in the @INC array and
 will complain about not finding "F<Foo::Bar>" there.  In this case you can do:
 
         eval "require $class";
 
-Now that you understand how C<require> looks for files in the case of a
+Now that you understand how C<require> looks for files with a
 bareword argument, there is a little extra functionality going on behind
 the scenes.  Before C<require> looks for a "F<.pm>" extension, it will
 first look for a similar filename with a "F<.pmc>" extension. If this file
 is found, it will be loaded in place of any file ending in a "F<.pm>"
 extension.
 
-You can also insert hooks into the import facility, by putting directly
-Perl code into the @INC array.  There are three forms of hooks: subroutine
+You can also insert hooks into the import facility, by putting Perl code
+directly into the @INC array.  There are three forms of hooks: subroutine
 references, array references and blessed objects.
 
 Subroutine references are the simplest case.  When the inclusion system
 walks through @INC and encounters a subroutine, this subroutine gets
-called with two parameters, the first being a reference to itself, and the
-second the name of the file to be included (e.g. "F<Foo/Bar.pm>").  The
-subroutine should return nothing, or a list of up to three values in the
-following order:
+called with two parameters, the first a reference to itself, and the
+second the name of the file to be included (e.g., "F<Foo/Bar.pm>").  The
+subroutine should return either nothing or else a list of up to three 
+values in the following order:
 
 =over
 
@@ -4611,7 +4854,7 @@
 A reference to a subroutine. If there is no filehandle (previous item),
 then this subroutine is expected to generate one line of source code per
 call, writing the line into C<$_> and returning 1, then returning 0 at
-"end of file". If there is a filehandle, then the subroutine will be
+end of file.  If there is a filehandle, then the subroutine will be
 called to act as a simple source filter, with the line as read in C<$_>.
 Again, return 1 for each valid line, and 0 after all lines have been
 returned.
@@ -4624,32 +4867,32 @@
 =back
 
 If an empty list, C<undef>, or nothing that matches the first 3 values above
-is returned then C<require> will look at the remaining elements of @INC.
-Note that this file handle must be a real file handle (strictly a typeglob,
-or reference to a typeglob, blessed or unblessed) - tied file handles will be
+is returned, then C<require> looks at the remaining elements of @INC.
+Note that this filehandle must be a real filehandle (strictly a typeglob
+or reference to a typeglob, blessed or unblessed); tied filehandles will be
 ignored and return value processing will stop there.
 
 If the hook is an array reference, its first element must be a subroutine
 reference.  This subroutine is called as above, but the first parameter is
-the array reference.  This enables to pass indirectly some arguments to
+the array reference.  This lets you indirectly pass arguments to
 the subroutine.
 
 In other words, you can write:
 
     push @INC, \&my_sub;
     sub my_sub {
-	my ($coderef, $filename) = @_;	# $coderef is \&my_sub
-	...
+        my ($coderef, $filename) = @_;  # $coderef is \&my_sub
+        ...
     }
 
 or:
 
     push @INC, [ \&my_sub, $x, $y, ... ];
     sub my_sub {
-	my ($arrayref, $filename) = @_;
-	# Retrieve $x, $y, ...
-	my @parameters = @$arrayref[1..$#$arrayref];
-	...
+        my ($arrayref, $filename) = @_;
+        # Retrieve $x, $y, ...
+        my @parameters = @$arrayref[1..$#$arrayref];
+        ...
     }
 
 If the hook is an object, it must provide an INC method that will be
@@ -4661,14 +4904,14 @@
     package Foo;
     sub new { ... }
     sub Foo::INC {
-	my ($self, $filename) = @_;
-	...
+        my ($self, $filename) = @_;
+        ...
     }
 
     # In the main program
     push @INC, Foo->new(...);
 
-Note that these hooks are also permitted to set the %INC entry
+These hooks are also permitted to set the %INC entry
 corresponding to the files they have loaded. See L<perlvar/%INC>.
 
 For a yet-more-powerful import facility, see L</use> and L<perlmod>.
@@ -4683,17 +4926,17 @@
 expression is interpreted as a list of single characters (hyphens
 allowed for ranges).  All variables and arrays beginning with one of
 those letters are reset to their pristine state.  If the expression is
-omitted, one-match searches (C<?pattern?>) are reset to match again.  Resets
-only variables or searches in the current package.  Always returns
+omitted, one-match searches (C<?pattern?>) are reset to match again.  
+Only resets variables or searches in the current package.  Always returns
 1.  Examples:
 
-    reset 'X';		# reset all X variables
-    reset 'a-z';	# reset lower case variables
-    reset;		# just reset ?one-time? searches
+    reset 'X';      # reset all X variables
+    reset 'a-z';    # reset lower case variables
+    reset;          # just reset ?one-time? searches
 
 Resetting C<"A-Z"> is not recommended because you'll wipe out your
 C<@ARGV> and C<@INC> arrays and your C<%ENV> hash.  Resets only package
-variables--lexical variables are unaffected, but they clean themselves
+variables; lexical variables are unaffected, but they clean themselves
 up on scope exit anyway, so you'll probably want to use them instead.
 See L</my>.
 
@@ -4707,10 +4950,10 @@
 context, depending on how the return value will be used, and the context
 may vary from one execution to the next (see C<wantarray>).  If no EXPR
 is given, returns an empty list in list context, the undefined value in
-scalar context, and (of course) nothing at all in a void context.
+scalar context, and (of course) nothing at all in void context.
 
-(Note that in the absence of an explicit C<return>, a subroutine, eval,
-or do FILE will automatically return the value of the last expression
+(In the absence of an explicit C<return>, a subroutine, eval,
+or do FILE automatically returns the value of the last expression
 evaluated.)
 
 =item reverse LIST
@@ -4731,13 +4974,17 @@
     print reverse;                              # No output, list context
     print scalar reverse;                       # Hello, world
 
+Note that reversing an array to itself (as in C<@a = reverse @a>) will
+preserve non-existent elements whenever possible, i.e., for non magical
+arrays or tied arrays with C<EXISTS> and C<DELETE> methods.
+
 This operator is also handy for inverting a hash, although there are some
 caveats.  If a value is duplicated in the original hash, only one of those
 can be represented as a key in the inverted hash.  Also, this has to
 unwind one hash and build a whole new one, which may take some time
 on a large hash, such as from a DBM file.
 
-    %by_name = reverse %by_address;	# Invert the hash
+    %by_name = reverse %by_address;  # Invert the hash
 
 =item rewinddir DIRHANDLE
 X<rewinddir>
@@ -4763,7 +5010,7 @@
 empty.  If it succeeds it returns true, otherwise it returns false and
 sets C<$!> (errno).  If FILENAME is omitted, uses C<$_>.
 
-To remove a directory tree recursively (C<rm -rf> on unix) look at
+To remove a directory tree recursively (C<rm -rf> on Unix) look at
 the C<rmtree> function of the L<File::Path> module.
 
 =item s///
@@ -4781,7 +5028,7 @@
 C<say LIST> is simply an abbreviation for C<{ local $\ = "\n"; print
 LIST }>.
 
-This keyword is only available when the "say" feature is
+This keyword is available only when the "say" feature is
 enabled: see L<feature>.
 
 =item scalar EXPR
@@ -4798,19 +5045,19 @@
 the construction C<@{[ (some expression) ]}>, but usually a simple
 C<(some expression)> suffices.
 
-Because C<scalar> is unary operator, if you accidentally use for EXPR a
+Because C<scalar> is a unary operator, if you accidentally use for EXPR a
 parenthesized list, this behaves as a scalar comma expression, evaluating
 all but the last element in void context and returning the final element
 evaluated in scalar context.  This is seldom what you want.
 
 The following single statement:
 
-	print uc(scalar(&foo,$bar)),$baz;
+    print uc(scalar(&foo,$bar)),$baz;
 
 is the moral equivalent of these two:
 
-	&foo;
-	print(uc($bar),$baz);
+    &foo;
+    print(uc($bar),$baz);
 
 See L<perlop> for more details on unary operators and the comma operator.
 
@@ -4824,7 +5071,7 @@
 POSITION, and C<2> to set it to EOF plus POSITION (typically
 negative).  For WHENCE you may use the constants C<SEEK_SET>,
 C<SEEK_CUR>, and C<SEEK_END> (start of the file, current position, end
-of the file) from the Fcntl module.  Returns C<1> upon success, C<0>
+of the file) from the Fcntl module.  Returns C<1> on success, C<0>
 otherwise.
 
 Note the I<in bytes>: even if the filehandle has been set to
@@ -4832,8 +5079,8 @@
 layer), tell() will return byte offsets, not character offsets
 (because implementing that would render seek() and tell() rather slow).
 
-If you want to position file for C<sysread> or C<syswrite>, don't use
-C<seek>--buffering makes its effect on the file's system position
+If you want to position the file for C<sysread> or C<syswrite>, don't use
+C<seek>, because buffering makes its effect on the file's read-write position
 unpredictable and non-portable.  Use C<sysseek> instead.
 
 Due to the rules and rigors of ANSI C, on some systems you have to do a
@@ -4844,21 +5091,21 @@
     seek(TEST,0,1);
 
 This is also useful for applications emulating C<tail -f>.  Once you hit
-EOF on your read, and then sleep for a while, you might have to stick in a
-seek() to reset things.  The C<seek> doesn't change the current position,
+EOF on your read and then sleep for a while, you (probably) have to stick in a
+dummy seek() to reset things.  The C<seek> doesn't change the position,
 but it I<does> clear the end-of-file condition on the handle, so that the
-next C<< <FILE> >> makes Perl try again to read something.  We hope.
+next C<< <FILE> >> makes Perl try again to read something.  (We hope.)
 
-If that doesn't work (some IO implementations are particularly
-cantankerous), then you may need something more like this:
+If that doesn't work (some I/O implementations are particularly
+cantankerous), you might need something like this:
 
     for (;;) {
-	for ($curpos = tell(FILE); $_ = <FILE>;
+        for ($curpos = tell(FILE); $_ = <FILE>;
              $curpos = tell(FILE)) {
-	    # search for some stuff and put it into files
-	}
-	sleep($for_a_while);
-	seek(FILE, $curpos, 0);
+            # search for some stuff and put it into files
+        }
+        sleep($for_a_while);
+        seek(FILE, $curpos, 0);
     }
 
 =item seekdir DIRHANDLE,POS
@@ -4901,7 +5148,7 @@
 =item select RBITS,WBITS,EBITS,TIMEOUT
 X<select>
 
-This calls the select(2) system call with the bit masks specified, which
+This calls the select(2) syscall with the bit masks specified, which
 can be constructed using C<fileno> and C<vec>, along these lines:
 
     $rin = $win = $ein = '';
@@ -4909,16 +5156,16 @@
     vec($win,fileno(STDOUT),1) = 1;
     $ein = $rin | $win;
 
-If you want to select on many filehandles you might wish to write a
-subroutine:
+If you want to select on many filehandles, you may wish to write a
+subroutine like this:
 
     sub fhbits {
-	my(@fhlist) = split(' ',$_[0]);
-	my($bits);
-	for (@fhlist) {
-	    vec($bits,fileno($_),1) = 1;
-	}
-	$bits;
+        my(@fhlist) = split(' ',$_[0]);
+        my($bits);
+        for (@fhlist) {
+            vec($bits,fileno($_),1) = 1;
+        }
+        $bits;
     }
     $rin = fhbits('STDIN TTY SOCK');
 
@@ -4947,13 +5194,13 @@
 is implementation-dependent.  See also L<perlport> for notes on the
 portability of C<select>.
 
-On error, C<select> behaves like the select(2) system call : it returns
+On error, C<select> behaves like select(2): it returns
 -1 and sets C<$!>.
 
-Note: on some Unixes, the select(2) system call may report a socket file
-descriptor as "ready for reading", when actually no data is available,
-thus a subsequent read blocks. It can be avoided using always the
-O_NONBLOCK flag on the socket. See select(2) and fcntl(2) for further
+On some Unixes, select(2) may report a socket file
+descriptor as "ready for reading" when no data is available, and
+thus a subsequent read blocks. This can be avoided if you always use 
+O_NONBLOCK on the socket. See select(2) and fcntl(2) for further
 details.
 
 B<WARNING>: One should not attempt to mix buffered I/O (like C<read>
@@ -4963,7 +5210,7 @@
 =item semctl ID,SEMNUM,CMD,ARG
 X<semctl>
 
-Calls the System V IPC function C<semctl>.  You'll probably have to say
+Calls the System V IPC function semctl(2).  You'll probably have to say
 
     use IPC::SysV;
 
@@ -4979,7 +5226,7 @@
 =item semget KEY,NSEMS,FLAGS
 X<semget>
 
-Calls the System V IPC function semget.  Returns the semaphore id, or
+Calls the System V IPC function semget(2).  Returns the semaphore id, or
 the undefined value if there is an error.  See also
 L<perlipc/"SysV IPC">, C<IPC::SysV>, C<IPC::SysV::Semaphore>
 documentation.
@@ -4987,7 +5234,7 @@
 =item semop KEY,OPSTRING
 X<semop>
 
-Calls the System V IPC function semop to perform semaphore operations
+Calls the System V IPC function semop(2) for semaphore operations
 such as signalling and waiting.  OPSTRING must be a packed array of
 semop structures.  Each semop structure can be generated with
 C<pack("s!3", $semnum, $semop, $semflag)>.  The length of OPSTRING 
@@ -5007,13 +5254,12 @@
 
 =item send SOCKET,MSG,FLAGS
 
-Sends a message on a socket.  Attempts to send the scalar MSG to the
-SOCKET filehandle.  Takes the same flags as the system call of the
-same name.  On unconnected sockets you must specify a destination to
-send TO, in which case it does a C C<sendto>.  Returns the number of
-characters sent, or the undefined value if there is an error.  The C
-system call sendmsg(2) is currently unimplemented.  See
-L<perlipc/"UDP: Message Passing"> for examples.
+Sends a message on a socket.  Attempts to send the scalar MSG to the SOCKET
+filehandle.  Takes the same flags as the system call of the same name.  On
+unconnected sockets, you must specify a destination to I<send to>, in which
+case it does a sendto(2) syscall.  Returns the number of characters sent,
+or the undefined value on error.  The sendmsg(2) syscall is currently
+unimplemented.  See L<perlipc/"UDP: Message Passing"> for examples.
 
 Note the I<characters>: depending on the status of the socket, either
 (8-bit) bytes or characters are sent.  By default all sockets operate
@@ -5027,7 +5273,7 @@
 X<setpgrp> X<group>
 
 Sets the current process group for the specified PID, C<0> for the current
-process.  Will produce a fatal error if used on a machine that doesn't
+process.  Raises an exception when used on a machine that doesn't
 implement POSIX setpgid(2) or BSD setpgrp(2).  If the arguments are omitted,
 it defaults to C<0,0>.  Note that the BSD 4.2 version of C<setpgrp> does not
 accept any arguments, so only C<setpgrp(0,0)> is portable.  See also
@@ -5037,7 +5283,7 @@
 X<setpriority> X<priority> X<nice> X<renice>
 
 Sets the current priority for a process, a process group, or a user.
-(See setpriority(2).)  Will produce a fatal error if used on a machine
+(See setpriority(2).)  Raises an exception when used on a machine
 that doesn't implement setpriority(2).
 
 =item setsockopt SOCKET,LEVEL,OPTNAME,OPTVAL
@@ -5049,7 +5295,7 @@
 getprotobyname.  OPTVAL might either be a packed string or an integer.
 An integer OPTVAL is shorthand for pack("i", OPTVAL).
 
-An example disabling the Nagle's algorithm for a socket:
+An example disabling Nagle's algorithm on a socket:
 
     use Socket qw(IPPROTO_TCP TCP_NODELAY);
     setsockopt($socket, IPPROTO_TCP, TCP_NODELAY, 1);
@@ -5063,7 +5309,7 @@
 array by 1 and moving everything down.  If there are no elements in the
 array, returns the undefined value.  If ARRAY is omitted, shifts the
 C<@_> array within the lexical scope of subroutines and formats, and the
-C<@ARGV> array outside of a subroutine and also within the lexical scopes
+C<@ARGV> array outside a subroutine and also within the lexical scopes
 established by the C<eval STRING>, C<BEGIN {}>, C<INIT {}>, C<CHECK {}>,
 C<UNITCHECK {}> and C<END {}> constructs.
 
@@ -5110,7 +5356,7 @@
 X<shutdown>
 
 Shuts down a socket connection in the manner indicated by HOW, which
-has the same interpretation as in the system call of the same name.
+has the same interpretation as in the syscall of the same name.
 
     shutdown(SOCKET, 0);    # I/we have stopped reading data
     shutdown(SOCKET, 1);    # I/we have stopped writing data
@@ -5122,7 +5368,7 @@
 disables the file descriptor in any forked copies in other
 processes.
 
-Returns C<1> for success. In the case of error, returns C<undef> if
+Returns C<1> for success; on error, returns C<undef> if
 the first argument is not a valid filehandle, or returns C<0> and sets
 C<$!> for any other failure.
 
@@ -5144,8 +5390,8 @@
 
 =item sleep
 
-Causes the script to sleep for EXPR seconds, or forever if no EXPR.
-Returns the number of seconds actually slept.  
+Causes the script to sleep for (integer) EXPR seconds, or forever if no 
+argument is given.  Returns the integer number of seconds actually slept.  
 
 May be interrupted if the process receives a signal such as C<SIGALRM>.
 
@@ -5178,7 +5424,7 @@
 
 Opens a socket of the specified kind and attaches it to filehandle
 SOCKET.  DOMAIN, TYPE, and PROTOCOL are specified the same as for
-the system call of the same name.  You should C<use Socket> first
+the syscall of the same name.  You should C<use Socket> first
 to get the proper definitions imported.  See the examples in
 L<perlipc/"Sockets: Client/Server Communication">.
 
@@ -5191,8 +5437,8 @@
 
 Creates an unnamed pair of sockets in the specified domain, of the
 specified type.  DOMAIN, TYPE, and PROTOCOL are specified the same as
-for the system call of the same name.  If unimplemented, yields a fatal
-error.  Returns true if successful.
+for the syscall of the same name.  If unimplemented, raises an exception.
+Returns true if successful.
 
 On systems that support a close-on-exec flag on files, the flag will
 be set for the newly opened file descriptors, as determined by the value
@@ -5223,8 +5469,8 @@
 If SUBNAME or BLOCK is omitted, C<sort>s in standard string comparison
 order.  If SUBNAME is specified, it gives the name of a subroutine
 that returns an integer less than, equal to, or greater than C<0>,
-depending on how the elements of the list are to be ordered.  (The C<<
-<=> >> and C<cmp> operators are extremely useful in such routines.)
+depending on how the elements of the list are to be ordered.  (The 
+C<< <=> >> and C<cmp> operators are extremely useful in such routines.)
 SUBNAME may be a scalar variable name (unsubscripted), in which case
 the value provides the name of (or a reference to) the actual
 subroutine to use.  In place of a SUBNAME, you can provide a BLOCK as
@@ -5271,87 +5517,87 @@
 
     # sort lexically
     @articles = sort @files;
-
+    
     # same thing, but with explicit sort routine
     @articles = sort {$a cmp $b} @files;
-
+    
     # now case-insensitively
     @articles = sort {uc($a) cmp uc($b)} @files;
-
+    
     # same thing in reversed order
     @articles = sort {$b cmp $a} @files;
-
+    
     # sort numerically ascending
     @articles = sort {$a <=> $b} @files;
-
+    
     # sort numerically descending
     @articles = sort {$b <=> $a} @files;
-
+    
     # this sorts the %age hash by value instead of key
     # using an in-line function
     @eldest = sort { $age{$b} <=> $age{$a} } keys %age;
-
+    
     # sort using explicit subroutine name
     sub byage {
-	$age{$a} <=> $age{$b};	# presuming numeric
+    $age{$a} <=> $age{$b};  # presuming numeric
     }
     @sortedclass = sort byage @class;
-
+    
     sub backwards { $b cmp $a }
     @harry  = qw(dog cat x Cain Abel);
     @george = qw(gone chased yz Punished Axed);
     print sort @harry;
-	    # prints AbelCaincatdogx
+        # prints AbelCaincatdogx
     print sort backwards @harry;
-	    # prints xdogcatCainAbel
+        # prints xdogcatCainAbel
     print sort @george, 'to', @harry;
-	    # prints AbelAxedCainPunishedcatchaseddoggonetoxyz
+        # prints AbelAxedCainPunishedcatchaseddoggonetoxyz
 
     # inefficiently sort by descending numeric compare using
     # the first integer after the first = sign, or the
     # whole record case-insensitively otherwise
 
-    @new = sort {
-	($b =~ /=(\d+)/)[0] <=> ($a =~ /=(\d+)/)[0]
-			    ||
-	            uc($a)  cmp  uc($b)
+    my @new = sort {
+        ($b =~ /=(\d+)/)[0] <=> ($a =~ /=(\d+)/)[0]
+            ||
+        uc($a)  cmp  uc($b)
     } @old;
 
     # same thing, but much more efficiently;
     # we'll build auxiliary indices instead
     # for speed
-    @nums = @caps = ();
+    my @nums = @caps = ();
     for (@old) {
-	push @nums, /=(\d+)/;
-	push @caps, uc($_);
+        push @nums, ( /=(\d+)/ ? $1 : undef );
+        push @caps, uc($_);
     }
 
-    @new = @old[ sort {
-			$nums[$b] <=> $nums[$a]
-				 ||
-			$caps[$a] cmp $caps[$b]
-		       } 0..$#old
-	       ];
+    my @new = @old[ sort {
+        $nums[$b] <=> $nums[$a]
+            ||
+        $caps[$a] cmp $caps[$b]
+        } 0..$#old
+    ];
 
     # same thing, but without any temps
     @new = map { $_->[0] }
            sort { $b->[1] <=> $a->[1]
-                           ||
-                  $a->[2] cmp $b->[2]
-           } map { [$_, /=(\d+)/, uc($_)] } @old;
+               ||
+           $a->[2] cmp $b->[2]
+    } map { [$_, /=(\d+)/, uc($_)] } @old;
 
     # using a prototype allows you to use any comparison subroutine
     # as a sort subroutine (including other package's subroutines)
     package other;
-    sub backwards ($$) { $_[1] cmp $_[0]; }	# $a and $b are not set here
-
+    sub backwards ($$) { $_[1] cmp $_[0]; }  # $a and $b are not set here
+    
     package main;
     @new = sort other::backwards @old;
-
+    
     # guarantee stability, regardless of algorithm
     use sort 'stable';
     @new = sort { substr($a, 3, 5) cmp substr($b, 3, 5) } @old;
-
+    
     # force use of mergesort (not portable outside Perl 5.8)
     use sort '_mergesort';  # note discouraging _
     @new = sort { substr($a, 3, 5) cmp substr($b, 3, 5) } @old;
@@ -5390,11 +5636,11 @@
 well-defined.
 
 Because C<< <=> >> returns C<undef> when either operand is C<NaN>
-(not-a-number), and because C<sort> will trigger a fatal error unless the
+(not-a-number), and because C<sort> raises an exception unless the
 result of a comparison is defined, when sorting with a comparison function
 like C<< $a <=> $b >>, be careful about lists that might contain a C<NaN>.
-The following example takes advantage of the fact that C<NaN != NaN> to
-eliminate any C<NaN>s from the input.
+The following example takes advantage that C<NaN != NaN> to
+eliminate any C<NaN>s from the input list.
 
     @result = sort { $a <=> $b } grep { $_ == $_ } @input;
 
@@ -5417,27 +5663,27 @@
 If LENGTH is negative, removes the elements from OFFSET onward
 except for -LENGTH elements at the end of the array.
 If both OFFSET and LENGTH are omitted, removes everything. If OFFSET is
-past the end of the array, perl issues a warning, and splices at the
+past the end of the array, Perl issues a warning, and splices at the
 end of the array.
 
 The following equivalences hold (assuming C<< $[ == 0 and $#a >= $i >> )
 
-    push(@a,$x,$y)	splice(@a,@a,0,$x,$y)
-    pop(@a)		splice(@a,-1)
-    shift(@a)		splice(@a,0,1)
-    unshift(@a,$x,$y)	splice(@a,0,0,$x,$y)
-    $a[$i] = $y		splice(@a,$i,1,$y)
+    push(@a,$x,$y)      splice(@a,@a,0,$x,$y)
+    pop(@a)             splice(@a,-1)
+    shift(@a)           splice(@a,0,1)
+    unshift(@a,$x,$y)   splice(@a,0,0,$x,$y)
+    $a[$i] = $y         splice(@a,$i,1,$y)
 
 Example, assuming array lengths are passed before arrays:
 
-    sub aeq {	# compare two list values
-	my(@a) = splice(@_,0,shift);
-	my(@b) = splice(@_,0,shift);
-	return 0 unless @a == @b;	# same len?
-	while (@a) {
-	    return 0 if pop(@a) ne pop(@b);
-	}
-	return 1;
+    sub aeq {  # compare two list values
+        my(@a) = splice(@_,0,shift);
+        my(@b) = splice(@_,0,shift);
+        return 0 unless @a == @b;  # same len?
+        while (@a) {
+            return 0 if pop(@a) ne pop(@b);
+        }
+        return 1;
     }
     if (&aeq($len,@foo[1..$len],0+@bar,@bar)) { ... }
 
@@ -5454,10 +5700,7 @@
 default, empty leading fields are preserved, and empty trailing ones are
 deleted.  (If all fields are empty, they are considered to be trailing.)
 
-In scalar context, returns the number of fields found. In scalar and void
-context it splits into the C<@_> array.  Use of split in scalar and void
-context is deprecated, however, because it clobbers your subroutine
-arguments.
+In scalar context, returns the number of fields found.
 
 If EXPR is omitted, splits the C<$_> string.  If PATTERN is also omitted,
 splits on whitespace (after skipping any leading whitespace).  Anything
@@ -5474,19 +5717,19 @@
 empty string always returns the empty list, regardless of the LIMIT
 specified.
 
-A pattern matching the null string (not to be confused with
-a null pattern C<//>, which is just one member of the set of patterns
-matching a null string) will split the value of EXPR into separate
-characters at each point it matches that way.  For example:
+A pattern matching the empty string (not to be confused with
+an empty pattern C<//>, which is just one member of the set of patterns
+matching the epmty string), splits EXPR into individual
+characters.  For example:
 
     print join(':', split(/ */, 'hi there')), "\n";
 
 produces the output 'h:i:t:h:e:r:e'.
 
-As a special case for C<split>, using the empty pattern C<//> specifically
-matches only the null string, and is not be confused with the regular use
-of C<//> to mean "the last successful pattern match".  So, for C<split>,
-the following:
+As a special case for C<split>, the empty pattern C<//> specifically
+matches the empty string; this is not be confused with the normal use
+of an empty pattern to mean the last successful match.  So to split
+a string into individual characters, the following:
 
     print join(':', split(//, 'hi there')), "\n";
 
@@ -5541,7 +5784,7 @@
 As a special case, specifying a PATTERN of space (S<C<' '>>) will split on
 white space just as C<split> with no arguments does.  Thus, S<C<split(' ')>> can
 be used to emulate B<awk>'s default behavior, whereas S<C<split(/ /)>>
-will give you as many null initial fields as there are leading spaces.
+will give you as many initial null fields (empty string) as there are leading spaces.
 A C<split> on C</\s+/> is like a S<C<split(' ')>> except that any leading
 whitespace produces a null first field.  A C<split> with no arguments
 really does a S<C<split(' ', $_)>> internally.
@@ -5556,7 +5799,7 @@
         chomp;
         ($login, $passwd, $uid, $gid,
          $gcos, $home, $shell) = split(/:/);
-	#...
+        #...
     }
 
 As with regular pattern matching, any capturing parentheses that are not
@@ -5581,11 +5824,11 @@
         # Round number to 3 digits after decimal point
         $rounded = sprintf("%.3f", $number);
 
-Perl does its own C<sprintf> formatting--it emulates the C
-function C<sprintf>, but it doesn't use it (except for floating-point
-numbers, and even then only the standard modifiers are allowed).  As a
-result, any non-standard extensions in your local C<sprintf> are not
-available from Perl.
+Perl does its own C<sprintf> formatting: it emulates the C
+function sprintf(3), but doesn't use it except for floating-point
+numbers, and even then only standard modifiers are allowed.  
+Non-standard extensions in your local sprintf(3) are 
+therefore unavailable from Perl.
 
 Unlike C<printf>, C<sprintf> does not do what you probably mean when you
 pass it an array as your first argument. The array is given scalar context,
@@ -5595,36 +5838,36 @@
 
 Perl's C<sprintf> permits the following universally-known conversions:
 
-   %%	a percent sign
-   %c	a character with the given number
-   %s	a string
-   %d	a signed integer, in decimal
-   %u	an unsigned integer, in decimal
-   %o	an unsigned integer, in octal
-   %x	an unsigned integer, in hexadecimal
-   %e	a floating-point number, in scientific notation
-   %f	a floating-point number, in fixed decimal notation
-   %g	a floating-point number, in %e or %f notation
+   %%    a percent sign
+   %c    a character with the given number
+   %s    a string
+   %d    a signed integer, in decimal
+   %u    an unsigned integer, in decimal
+   %o    an unsigned integer, in octal
+   %x    an unsigned integer, in hexadecimal
+   %e    a floating-point number, in scientific notation
+   %f    a floating-point number, in fixed decimal notation
+   %g    a floating-point number, in %e or %f notation
 
 In addition, Perl permits the following widely-supported conversions:
 
-   %X	like %x, but using upper-case letters
-   %E	like %e, but using an upper-case "E"
-   %G	like %g, but with an upper-case "E" (if applicable)
-   %b	an unsigned integer, in binary
-   %B	like %b, but using an upper-case "B" with the # flag
-   %p	a pointer (outputs the Perl value's address in hexadecimal)
-   %n	special: *stores* the number of characters output so far
+   %X    like %x, but using upper-case letters
+   %E    like %e, but using an upper-case "E"
+   %G    like %g, but with an upper-case "E" (if applicable)
+   %b    an unsigned integer, in binary
+   %B    like %b, but using an upper-case "B" with the # flag
+   %p    a pointer (outputs the Perl value's address in hexadecimal)
+   %n    special: *stores* the number of characters output so far
         into the next variable in the parameter list
 
 Finally, for backward (and we do mean "backward") compatibility, Perl
 permits these unnecessary but widely-supported conversions:
 
-   %i	a synonym for %d
-   %D	a synonym for %ld
-   %U	a synonym for %lu
-   %O	a synonym for %lo
-   %F	a synonym for %f
+   %i    a synonym for %d
+   %D    a synonym for %ld
+   %U    a synonym for %lu
+   %O    a synonym for %lo
+   %F    a synonym for %f
 
 Note that the number of exponent digits in the scientific notation produced
 by C<%e>, C<%E>, C<%g> and C<%G> for numbers with the modulus of the
@@ -5632,7 +5875,7 @@
 (zero-padded as necessary).  In other words, 1.23 times ten to the
 99th may be either "1.23e99" or "1.23e099".
 
-Between the C<%> and the format letter, you may specify a number of
+Between the C<%> and the format letter, you may specify several
 additional attributes controlling the interpretation of the format.
 In order, these are:
 
@@ -5642,7 +5885,7 @@
 
 An explicit format parameter index, such as C<2$>. By default sprintf
 will format the next unused argument in the list, but this allows you
-to take the arguments out of order, e.g.:
+to take the arguments out of order:
 
   printf '%2$d %1$d', 12, 34;      # prints "34 12"
   printf '%3$d %d %1$d', 1, 2, 3;  # prints "3 1 1"
@@ -5687,7 +5930,7 @@
 
 =item vector flag
 
-This flag tells perl to interpret the supplied string as a vector of
+This flag tells Perl to interpret the supplied string as a vector of
 integers, one for each character in the string. Perl applies the format to
 each integer in turn, then joins the resulting strings with a separator (a
 dot C<.> by default). This can be useful for displaying ordinal values of
@@ -5703,7 +5946,7 @@
   printf "bits are %0*v8b\n", " ", $bits;   # random bitstring
 
 You can also explicitly specify the argument number to use for
-the join string using e.g. C<*2$v>:
+the join string using something like C<*2$v>; for example:
 
   printf '%*4$vX %*4$vX %*4$vX', @addr[1..3], ":";   # 3 IPv6 addresses
 
@@ -5712,7 +5955,7 @@
 Arguments are usually formatted to be only as wide as required to
 display the given value. You can override the width by putting
 a number here, or get the width from the next argument (with C<*>)
-or from a specified argument (with e.g. C<*2$>):
+or from a specified argument (e.g., with C<*2$>):
 
   printf '<%s>', "a";       # prints "<a>"
   printf '<%6s>', "a";      # prints "<     a>"
@@ -5728,8 +5971,9 @@
 
 You can specify a precision (for numeric conversions) or a maximum
 width (for string conversions) by specifying a C<.> followed by a number.
-For floating point formats, with the exception of 'g' and 'G', this specifies
-the number of decimal places to show (the default being 6), e.g.:
+For floating-point formats except 'g' and 'G', this specifies
+how many places right of the decimal point to show (the default being 6).
+For example:
 
   # these examples are subject to system-specific variation
   printf '<%f>', 1;    # prints "<1.000000>"
@@ -5738,10 +5982,11 @@
   printf '<%e>', 10;   # prints "<1.000000e+01>"
   printf '<%.1e>', 10; # prints "<1.0e+01>"
 
-For 'g' and 'G', this specifies the maximum number of digits to show,
-including prior to the decimal point as well as after it, e.g.:
+For "g" and "G", this specifies the maximum number of digits to show,
+including thoe prior to the decimal point and those after it; for 
+example:
 
-  # these examples are subject to system-specific variation
+  # These examples are subject to system-specific variation.
   printf '<%g>', 1;        # prints "<1>"
   printf '<%.10g>', 1;     # prints "<1>"
   printf '<%g>', 100;      # prints "<100>"
@@ -5769,7 +6014,7 @@
   printf '<%#10.6x>', 1;   # prints "<  0x000001>"
 
 For string conversions, specifying a precision truncates the string
-to fit in the specified width:
+to fit the specified width:
 
   printf '<%.5s>', "truncated";   # prints "<trunc>"
   printf '<%10.5s>', "truncated"; # prints "<     trunc>"
@@ -5779,8 +6024,8 @@
   printf '<%.6x>', 1;       # prints "<000001>"
   printf '<%.*x>', 6, 1;    # prints "<000001>"
 
-If a precision obtained through C<*> is negative, it has the same
-effect as no precision.
+If a precision obtained through C<*> is negative, it counts
+as having no precision at all.
 
   printf '<%.*s>',  7, "string";   # prints "<string>"
   printf '<%.*s>',  3, "string";   # prints "<str>"
@@ -5792,10 +6037,10 @@
   printf '<%.*d>', -1, 0;   # prints "<0>"
 
 You cannot currently get the precision from a specified number,
-but it is intended that this will be possible in the future using
-e.g. C<.*2$>:
+but it is intended that this will be possible in the future, for
+example using C<.*2$>:
 
-  printf '<%.*2$x>', 1, 6;   # INVALID, but in future will print "<000001>"
+  printf "<%.*2$x>", 1, 6;   # INVALID, but in future will print "<000001>"
 
 =item size
 
@@ -5811,78 +6056,79 @@
    q, L or ll  interpret integer as C type "long long", "unsigned long long".
                or "quads" (typically 64-bit integers)
 
-The last will produce errors if Perl does not understand "quads" in your
-installation. (This requires that either the platform natively supports quads
-or Perl was specifically compiled to support quads.) You can find out
+The last will raise an exception if Perl does not understand "quads" in your
+installation. (This requires either that the platform natively support quads,
+or that Perl were specifically compiled to support quads.) You can find out
 whether your Perl supports quads via L<Config>:
 
-	use Config;
-	($Config{use64bitint} eq 'define' || $Config{longsize} >= 8) &&
-		print "quads\n";
-
-For floating point conversions (C<e f g E F G>), numbers are usually assumed
-to be the default floating point size on your platform (double or long double),
-but you can force 'long double' with C<q>, C<L>, or C<ll> if your
+    use Config;
+    if ($Config{use64bitint} eq "define" || $Config{longsize} >= 8) {
+        print "Nice quads!\n";
+    }
+
+For floating-point conversions (C<e f g E F G>), numbers are usually assumed
+to be the default floating-point size on your platform (double or long double),
+but you can force "long double" with C<q>, C<L>, or C<ll> if your
 platform supports them. You can find out whether your Perl supports long
 doubles via L<Config>:
 
-	use Config;
-	$Config{d_longdbl} eq 'define' && print "long doubles\n";
+    use Config;
+    print "long doubles\n" if $Config{d_longdbl} eq "define";
 
-You can find out whether Perl considers 'long double' to be the default
-floating point size to use on your platform via L<Config>:
+You can find out whether Perl considers "long double" to be the default
+floating-point size to use on your platform via L<Config>:
 
-        use Config;
-        ($Config{uselongdouble} eq 'define') &&
-                print "long doubles by default\n";
+    use Config;
+    if ($Config{uselongdouble} eq "define") {
+	print "long doubles by default\n";
+    }
 
-It can also be the case that long doubles and doubles are the same thing:
+It can also be that long doubles and doubles are the same thing:
 
         use Config;
         ($Config{doublesize} == $Config{longdblsize}) &&
                 print "doubles are long doubles\n";
 
-The size specifier C<V> has no effect for Perl code, but it is supported
-for compatibility with XS code; it means 'use the standard size for
-a Perl integer (or floating-point number)', which is already the
-default for Perl code.
+The size specifier C<V> has no effect for Perl code, but is supported for
+compatibility with XS code.  It means "use the standard size for a Perl
+integer or floating-point number", which is the default.
 
 =item order of arguments
 
-Normally, sprintf takes the next unused argument as the value to
+Normally, sprintf() takes the next unused argument as the value to
 format for each format specification. If the format specification
 uses C<*> to require additional arguments, these are consumed from
-the argument list in the order in which they appear in the format
-specification I<before> the value to format. Where an argument is
-specified using an explicit index, this does not affect the normal
-order for the arguments (even when the explicitly specified index
-would have been the next argument in any case).
+the argument list in the order they appear in the format
+specification I<before> the value to format.  Where an argument is
+specified by an explicit index, this does not affect the normal
+order for the arguments, even when the explicitly specified index
+would have been the next argument.
 
 So:
 
-  printf '<%*.*s>', $a, $b, $c;
+    printf "<%*.*s>", $a, $b, $c;
 
-would use C<$a> for the width, C<$b> for the precision and C<$c>
-as the value to format, while:
+uses C<$a> for the width, C<$b> for the precision, and C<$c>
+as the value to format; while:
 
-  printf '<%*1$.*s>', $a, $b;
+  printf "<%*1$.*s>", $a, $b;
 
-would use C<$a> for the width and the precision, and C<$b> as the
+would use C<$a> for the width and precision, and C<$b> as the
 value to format.
 
-Here are some more examples - beware that when using an explicit
-index, the C<$> may need to be escaped:
+Here are some more examples; be aware that when using an explicit
+index, the C<$> may need escaping:
 
-  printf "%2\$d %d\n",    12, 34;		# will print "34 12\n"
-  printf "%2\$d %d %d\n", 12, 34;		# will print "34 12 34\n"
-  printf "%3\$d %d %d\n", 12, 34, 56;		# will print "56 12 34\n"
-  printf "%2\$*3\$d %d\n", 12, 34, 3;		# will print " 34 12\n"
+  printf "%2\$d %d\n",    12, 34;        # will print "34 12\n"
+  printf "%2\$d %d %d\n", 12, 34;        # will print "34 12 34\n"
+  printf "%3\$d %d %d\n", 12, 34, 56;    # will print "56 12 34\n"
+  printf "%2\$*3\$d %d\n", 12, 34, 3;    # will print " 34 12\n"
 
 =back
 
-If C<use locale> is in effect, and POSIX::setlocale() has been called,
-the character used for the decimal separator in formatted floating
-point numbers is affected by the LC_NUMERIC locale.  See L<perllocale>
+If C<use locale> is in effect and POSIX::setlocale() has been called,
+the character used for the decimal separator in formatted floating-point
+numbers is affected by the LC_NUMERIC locale.  See L<perllocale>
 and L<POSIX>.
 
 =item sqrt EXPR
@@ -5890,12 +6136,12 @@
 
 =item sqrt
 
-Return the square root of EXPR.  If EXPR is omitted, returns square
-root of C<$_>.  Only works on non-negative operands, unless you've
-loaded the standard Math::Complex module.
+Return the positive square root of EXPR.  If EXPR is omitted, uses
+C<$_>.  Works only for non-negative operands unless you've
+loaded the C<Math::Complex> module.
 
     use Math::Complex;
-    print sqrt(-2);    # prints 1.4142135623731i
+    print sqrt(-4);    # prints 2i
 
 =item srand EXPR
 X<srand> X<seed> X<randseed>
@@ -5909,23 +6155,25 @@
 program.
 
 If srand() is not called explicitly, it is called implicitly at the
-first use of the C<rand> operator.  However, this was not the case in
+first use of the C<rand> operator.  However, this was not true of
 versions of Perl before 5.004, so if your script will run under older
 Perl versions, it should call C<srand>.
 
 Most programs won't even call srand() at all, except those that
 need a cryptographically-strong starting point rather than the
 generally acceptable default, which is based on time of day,
-process ID, and memory allocation, or the F</dev/urandom> device,
-if available.
+process ID, and memory allocation, or the F</dev/urandom> device
+if available. You may also want to call srand() after a fork() to
+avoid child processes sharing the same seed value as the parent (and
+consequently each other).
 
 You can call srand($seed) with the same $seed to reproduce the
 I<same> sequence from rand(), but this is usually reserved for
 generating predictable results for testing or debugging.
 Otherwise, don't call srand() more than once in your program.
 
-Do B<not> call srand() (i.e. without an argument) more than once in
-a script.  The internal state of the random number generator should
+Do B<not> call srand() (i.e., without an argument) more than once per
+process.  The internal state of the random number generator should
 contain more entropy than can be provided by any seed, so calling
 srand() again actually I<loses> randomness.
 
@@ -5946,8 +6194,8 @@
 
     srand (time ^ $$ ^ unpack "%L*", `ps axww | gzip -f`);
 
-If you're particularly concerned with this, see the C<Math::TrulyRandom>
-module in CPAN.
+If you're particularly concerned with this, search the CPAN for
+random number generator modules instead of rolling out your own.
 
 Frequently called programs (like CGI scripts) that simply use
 
@@ -5970,7 +6218,7 @@
 
 Returns a 13-element list giving the status info for a file, either
 the file opened via FILEHANDLE or DIRHANDLE, or named by EXPR.  If EXPR is 
-omitted, it stats C<$_>.  Returns a null list if the stat fails.  Typically
+omitted, it stats C<$_>.  Returns the empty list if C<stat> fails.  Typically
 used as follows:
 
     ($dev,$ino,$mode,$nlink,$uid,$gid,$rdev,$size,
@@ -6005,7 +6253,7 @@
 last C<stat>, C<lstat>, or filetest are returned.  Example:
 
     if (-x $file && (($d) = stat(_)) && $d < 0) {
-	print "$file is executable NFS file\n";
+        print "$file is executable NFS file\n";
     }
 
 (This works on machines only for which the device number is negative
@@ -6027,8 +6275,8 @@
     use File::stat;
     $sb = stat($filename);
     printf "File is %s, size is %s, perm %04o, mtime %s\n",
-	$filename, $sb->size, $sb->mode & 07777,
-	scalar localtime $sb->mtime;
+           $filename, $sb->size, $sb->mode & 07777,
+           scalar localtime $sb->mtime;
 
 You can import symbolic mode constants (C<S_IF*>) and functions
 (C<S_IS*>) from the Fcntl module:
@@ -6047,7 +6295,7 @@
     $is_directory  =  S_ISDIR($mode);
 
 You could write the last two using the C<-u> and C<-d> operators.
-The commonly available C<S_IF*> constants are
+Commonly available C<S_IF*> constants are:
 
     # Permissions: read, write, execute, for user, group, others.
 
@@ -6070,11 +6318,11 @@
 
 and the C<S_IF*> functions are
 
-    S_IMODE($mode)	the part of $mode containing the permission bits
-			and the setuid/setgid/sticky bits
+    S_IMODE($mode)    the part of $mode containing the permission bits
+            and the setuid/setgid/sticky bits
 
-    S_IFMT($mode)	the part of $mode containing the file type
-			which can be bit-anded with e.g. S_IFREG
+    S_IFMT($mode)    the part of $mode containing the file type
+            which can be bit-anded with (for example) S_IFREG
                         or with the following functions
 
     # The operators -f, -d, -l, -b, -c, -p, and -S.
@@ -6106,8 +6354,8 @@
 lexical variables that are reinitialized each time their enclosing block
 is entered.
 
-C<state> variables are only enabled when the C<feature 'state'> pragma is
-in effect.  See L<feature>.
+C<state> variables are enabled only when the C<use feature "state"> pragma 
+is in effect.  See L<feature>.
 
 =item study SCALAR
 X<study>
@@ -6118,11 +6366,11 @@
 doing many pattern matches on the string before it is next modified.
 This may or may not save time, depending on the nature and number of
 patterns you are searching on, and on the distribution of character
-frequencies in the string to be searched--you probably want to compare
+frequencies in the string to be searched; you probably want to compare
 run times with and without it to see which runs faster.  Those loops
 that scan for many short constant strings (including the constant
 parts of more complex patterns) will benefit most.  You may have only
-one C<study> active at a time--if you study a different scalar the first
+one C<study> active at a time: if you study a different scalar the first
 is "unstudied".  (The way C<study> works is this: a linked list of every
 character in the string to be searched is made, so we know, for
 example, where all the C<'k'> characters are.  From each search string,
@@ -6134,15 +6382,15 @@
 before any line containing a certain pattern:
 
     while (<>) {
-	study;
-	print ".IX foo\n" 	if /\bfoo\b/;
-	print ".IX bar\n" 	if /\bbar\b/;
-	print ".IX blurfl\n" 	if /\bblurfl\b/;
-	# ...
-	print;
+        study;
+        print ".IX foo\n"    if /\bfoo\b/;
+        print ".IX bar\n"    if /\bbar\b/;
+        print ".IX blurfl\n" if /\bblurfl\b/;
+        # ...
+        print;
     }
 
-In searching for C</\bfoo\b/>, only those locations in C<$_> that contain C<f>
+In searching for C</\bfoo\b/>, only locations in C<$_> that contain C<f>
 will be looked at, because C<f> is rarer than C<o>.  In general, this is
 a big win except in pathological cases.  The only question is whether
 it saves you more time than it took to build the linked list in the
@@ -6151,22 +6399,22 @@
 Note that if you have to look for strings that you don't know till
 runtime, you can build an entire loop as a string and C<eval> that to
 avoid recompiling all your patterns all the time.  Together with
-undefining C<$/> to input entire files as one record, this can be very
+undefining C<$/> to input entire files as one record, this can be quite
 fast, often faster than specialized programs like fgrep(1).  The following
 scans a list of files (C<@files>) for a list of words (C<@words>), and prints
 out the names of those files that contain a match:
 
     $search = 'while (<>) { study;';
     foreach $word (@words) {
-	$search .= "++\$seen{\$ARGV} if /\\b$word\\b/;\n";
+        $search .= "++\$seen{\$ARGV} if /\\b$word\\b/;\n";
     }
     $search .= "}";
     @ARGV = @files;
     undef $/;
-    eval $search;		# this screams
-    $/ = "\n";		# put back to normal input delimiter
+    eval $search;        # this screams
+    $/ = "\n";        # put back to normal input delimiter
     foreach $file (sort keys(%seen)) {
-	print $file, "\n";
+        print $file, "\n";
     }
 
 =item sub NAME BLOCK
@@ -6202,30 +6450,30 @@
 many characters off the end of the string.
 
     my $s = "The black cat climbed the green tree";
-    my $color  = substr $s, 4, 5;	# black
-    my $middle = substr $s, 4, -11;	# black cat climbed the
-    my $end    = substr $s, 14;		# climbed the green tree
-    my $tail   = substr $s, -4;		# tree
-    my $z      = substr $s, -4, 2;	# tr
+    my $color  = substr $s, 4, 5;      # black
+    my $middle = substr $s, 4, -11;    # black cat climbed the
+    my $end    = substr $s, 14;        # climbed the green tree
+    my $tail   = substr $s, -4;        # tree
+    my $z      = substr $s, -4, 2;     # tr
 
 You can use the substr() function as an lvalue, in which case EXPR
 must itself be an lvalue.  If you assign something shorter than LENGTH,
 the string will shrink, and if you assign something longer than LENGTH,
 the string will grow to accommodate it.  To keep the string the same
-length you may need to pad or chop your value using C<sprintf>.
+length, you may need to pad or chop your value using C<sprintf>.
 
 If OFFSET and LENGTH specify a substring that is partly outside the
 string, only the part within the string is returned.  If the substring
 is beyond either end of the string, substr() returns the undefined
 value and produces a warning.  When used as an lvalue, specifying a
-substring that is entirely outside the string is a fatal error.
+substring that is entirely outside the string raises an exception.
 Here's an example showing the behavior for boundary cases:
 
     my $name = 'fred';
-    substr($name, 4) = 'dy';		# $name is now 'freddy'
-    my $null = substr $name, 6, 2;	# returns '' (no warning)
-    my $oops = substr $name, 7;		# returns undef, with warning
-    substr($name, 7) = 'gap';		# fatal error
+    substr($name, 4) = 'dy';         # $name is now 'freddy'
+    my $null = substr $name, 6, 2;   # returns "" (no warning)
+    my $oops = substr $name, 7;      # returns undef, with warning
+    substr($name, 7) = 'gap';        # raises an exception
 
 An alternative to using substr() as an lvalue is to specify the
 replacement string as the 4th argument.  This allows you to replace
@@ -6233,7 +6481,7 @@
 just as you can with splice().
 
     my $s = "The black cat climbed the green tree";
-    my $z = substr $s, 14, 7, "jumped from";	# climbed
+    my $z = substr $s, 14, 7, "jumped from";    # climbed
     # $s is now "The black cat jumped from the green tree"
 
 Note that the lvalue returned by the 3-arg version of substr() acts as
@@ -6242,10 +6490,10 @@
 
     $x = '1234';
     for (substr($x,1,2)) {
-        $_ = 'a';   print $x,"\n";	# prints 1a4
-        $_ = 'xyz'; print $x,"\n";	# prints 1xyz4
+        $_ = 'a';   print $x,"\n";    # prints 1a4
+        $_ = 'xyz'; print $x,"\n";    # prints 1xyz4
         $x = '56789';
-        $_ = 'pq';  print $x,"\n";	# prints 5pq9
+        $_ = 'pq';  print $x,"\n";    # prints 5pq9
     }
 
 Prior to Perl version 5.9.1, the result of using an lvalue multiple times was
@@ -6256,7 +6504,7 @@
 
 Creates a new filename symbolically linked to the old filename.
 Returns C<1> for success, C<0> otherwise.  On systems that don't support
-symbolic links, produces a fatal error at run time.  To check for that,
+symbolic links, raises an exception.  To check for that,
 use eval:
 
     $symlink_exists = eval { symlink("",""); 1 };
@@ -6266,7 +6514,7 @@
 
 Calls the system call specified as the first element of the list,
 passing the remaining elements as arguments to the system call.  If
-unimplemented, produces a fatal error.  The arguments are interpreted
+unimplemented, raises an exception.  The arguments are interpreted
 as follows: if a given argument is numeric, the argument is passed as
 an int.  If not, the pointer to the string value is passed.  You are
 responsible to make sure a string is pre-extended long enough to
@@ -6278,12 +6526,12 @@
 numeric context, you may need to add C<0> to them to force them to look
 like numbers.  This emulates the C<syswrite> function (or vice versa):
 
-    require 'syscall.ph';		# may need to run h2ph
+    require 'syscall.ph';        # may need to run h2ph
     $s = "hi there\n";
     syscall(&SYS_write, fileno(STDOUT), $s, length $s);
 
-Note that Perl supports passing of up to only 14 arguments to your system call,
-which in practice should usually suffice.
+Note that Perl supports passing of up to only 14 arguments to your syscall,
+which in practice should (usually) suffice.
 
 Syscall returns whatever value returned by the system call it calls.
 If the system call fails, C<syscall> returns C<-1> and sets C<$!> (errno).
@@ -6319,7 +6567,7 @@
 X<O_RDONLY> X<O_RDWR> X<O_WRONLY>
 
 For historical reasons, some values work on almost every system
-supported by perl: zero means read-only, one means write-only, and two
+supported by Perl: 0 means read-only, 1 means write-only, and 2
 means read/write.  We know that these values do I<not> work under
 OS/390 & VM/ESA Unix and on the Macintosh; you probably don't want to
 use them in new code.
@@ -6352,7 +6600,7 @@
 on this.
 
 Note that C<sysopen> depends on the fdopen() C library function.
-On many UNIX systems, fdopen() is known to fail when file descriptors
+On many Unix systems, fdopen() is known to fail when file descriptors
 exceed a certain value, typically 255. If you need more file
 descriptors than that, consider rebuilding Perl to use the C<sfio>
 library, or perhaps using the POSIX::open() function.
@@ -6365,7 +6613,7 @@
 =item sysread FILEHANDLE,SCALAR,LENGTH
 
 Attempts to read LENGTH bytes of data into variable SCALAR from the
-specified FILEHANDLE, using the system call read(2).  It bypasses
+specified FILEHANDLE, using the read(2).  It bypasses
 buffered IO, so mixing this with other kinds of reads, C<print>,
 C<write>, C<seek>, C<tell>, or C<eof> can cause confusion because the
 perlio or stdio layers usually buffers data.  Returns the number of
@@ -6382,7 +6630,7 @@
 bytes before the result of the read is appended.
 
 There is no syseof() function, which is ok, since eof() doesn't work
-very well on device files (like ttys) anyway.  Use sysread() and check
+well on device files (like ttys) anyway.  Use sysread() and check
 for a return value for 0 to decide whether you're done.
 
 Note that if the filehandle has been marked as C<:utf8> Unicode
@@ -6394,7 +6642,7 @@
 =item sysseek FILEHANDLE,POSITION,WHENCE
 X<sysseek> X<lseek>
 
-Sets FILEHANDLE's system position in bytes using the system call
+Sets FILEHANDLE's system position in bytes using 
 lseek(2).  FILEHANDLE may be an expression whose value gives the name
 of the filehandle.  The values for WHENCE are C<0> to set the new
 position to POSITION, C<1> to set the it to the current position plus
@@ -6404,7 +6652,7 @@
 Note the I<in bytes>: even if the filehandle has been set to operate
 on characters (for example by using the C<:encoding(utf8)> I/O layer),
 tell() will return byte offsets, not character offsets (because
-implementing that would render sysseek() very slow).
+implementing that would render sysseek() unacceptably slow).
 
 sysseek() bypasses normal buffered IO, so mixing this with reads (other
 than C<sysread>, for example C<< <> >> or read()) C<print>, C<write>,
@@ -6415,8 +6663,8 @@
 from the Fcntl module.  Use of the constants is also more portable
 than relying on 0, 1, and 2.  For example to define a "systell" function:
 
-	use Fcntl 'SEEK_CUR';
-	sub systell { sysseek($_[0], 0, SEEK_CUR) }
+    use Fcntl 'SEEK_CUR';
+    sub systell { sysseek($_[0], 0, SEEK_CUR) }
 
 Returns the new position, or the undefined value on failure.  A position
 of zero is returned as the string C<"0 but true">; thus C<sysseek> returns
@@ -6430,7 +6678,7 @@
 
 Does exactly the same thing as C<exec LIST>, except that a fork is
 done first, and the parent process waits for the child process to
-complete.  Note that argument processing varies depending on the
+exit.  Note that argument processing varies depending on the
 number of arguments.  If there is more than one argument in LIST,
 or if LIST is an array with more than one value, starts the program
 given by the first element of the list with arguments given by the
@@ -6469,29 +6717,32 @@
 
     @args = ("command", "arg1", "arg2");
     system(@args) == 0
-	 or die "system @args failed: $?"
+        or die "system @args failed: $?"
 
 If you'd like to manually inspect C<system>'s failure, you can check all
 possible failure modes by inspecting C<$?> like this:
 
     if ($? == -1) {
-	print "failed to execute: $!\n";
+        print "failed to execute: $!\n";
     }
     elsif ($? & 127) {
-	printf "child died with signal %d, %s coredump\n",
-	    ($? & 127),  ($? & 128) ? 'with' : 'without';
+        printf "child died with signal %d, %s coredump\n",
+            ($? & 127),  ($? & 128) ? 'with' : 'without';
     }
     else {
-	printf "child exited with value %d\n", $? >> 8;
+        printf "child exited with value %d\n", $? >> 8;
     }
 
-Alternatively you might inspect the value of C<${^CHILD_ERROR_NATIVE}>
-with the W*() calls of the POSIX extension.
+Alternatively, you may inspect the value of C<${^CHILD_ERROR_NATIVE}>
+with the C<W*()> calls from the POSIX module.
 
-When the arguments get executed via the system shell, results
-and return codes will be subject to its quirks and capabilities.
+When C<system>'s arguments are executed indirectly by the shell, 
+results and return codes are subject to its quirks.
 See L<perlop/"`STRING`"> and L</exec> for details.
 
+Since C<system> does a C<fork> and C<wait> it may affect a C<SIGCHLD>
+handler. See L<perlipc> for details.
+
 =item syswrite FILEHANDLE,SCALAR,LENGTH,OFFSET
 X<syswrite>
 
@@ -6500,24 +6751,24 @@
 =item syswrite FILEHANDLE,SCALAR
 
 Attempts to write LENGTH bytes of data from variable SCALAR to the
-specified FILEHANDLE, using the system call write(2).  If LENGTH is
+specified FILEHANDLE, using write(2).  If LENGTH is
 not specified, writes whole SCALAR.  It bypasses buffered IO, so
 mixing this with reads (other than C<sysread())>, C<print>, C<write>,
 C<seek>, C<tell>, or C<eof> may cause confusion because the perlio and
 stdio layers usually buffers data.  Returns the number of bytes
 actually written, or C<undef> if there was an error (in this case the
 errno variable C<$!> is also set).  If the LENGTH is greater than the
-available data in the SCALAR after the OFFSET, only as much data as is
+data available in the SCALAR after the OFFSET, only as much data as is
 available will be written.
 
 An OFFSET may be specified to write the data from some part of the
 string other than the beginning.  A negative OFFSET specifies writing
 that many characters counting backwards from the end of the string.
-In the case the SCALAR is empty you can use OFFSET but only zero offset.
+If SCALAR is of length zero, you can only use an OFFSET of 0.
 
-Note that if the filehandle has been marked as C<:utf8>, Unicode
-characters are written instead of bytes (the LENGTH, OFFSET, and the
-return value of syswrite() are in UTF-8 encoded Unicode characters).
+B<Warning>: If the filehandle is marked C<:utf8>, Unicode characters
+encoded in UTF-8 are written instead of bytes, and the LENGTH, OFFSET, and
+return value of syswrite() are in (UTF-8 encoded Unicode) characters.
 The C<:encoding(...)> layer implicitly introduces the C<:utf8> layer.
 See L</binmode>, L</open>, and the C<open> pragma, L<open>.
 
@@ -6542,7 +6793,7 @@
 
 There is no C<systell> function.  Use C<sysseek(FH, 0, 1)> for that.
 
-Do not use tell() (or other buffered I/O operations) on a file handle
+Do not use tell() (or other buffered I/O operations) on a filehandle
 that has been manipulated by sysread(), syswrite() or sysseek().
 Those functions ignore the buffering, while tell() does not.
 
@@ -6575,7 +6826,7 @@
     use NDBM_File;
     tie(%HIST, 'NDBM_File', '/usr/lib/news/history', 1, 0);
     while (($key,$val) = each %HIST) {
-	print $key, ' = ', unpack('L',$val), "\n";
+        print $key, ' = ', unpack('L',$val), "\n";
     }
     untie(%HIST);
 
@@ -6610,7 +6861,7 @@
     DESTROY this
     UNTIE this
 
-A class implementing a file handle should have the following methods:
+A class implementing a filehandle should have the following methods:
 
     TIEHANDLE classname, LIST
     READ this, scalar, length, offset
@@ -6640,8 +6891,8 @@
 Not all methods indicated above need be implemented.  See L<perltie>,
 L<Tie::Hash>, L<Tie::Array>, L<Tie::Scalar>, and L<Tie::Handle>.
 
-Unlike C<dbmopen>, the C<tie> function will not use or require a module
-for you--you need to do that explicitly yourself.  See L<DB_File>
+Unlike C<dbmopen>, the C<tie> function will not C<use> or C<require> a module
+for you; you need to do that explicitly yourself.  See L<DB_File>
 or the F<Config> module for interesting C<tie> implementations.
 
 For further details see L<perltie>, L<"tied VARIABLE">.
@@ -6683,7 +6934,7 @@
 
 In scalar context, C<times> returns C<$user>.
 
-Note that times for children are included only after they terminate.
+Children's times are only included for terminated children.
 
 =item tr///
 
@@ -6696,7 +6947,7 @@
 =item truncate EXPR,LENGTH
 
 Truncates the file opened on FILEHANDLE, or named by EXPR, to the
-specified length.  Produces a fatal error if truncate isn't implemented
+specified length.  Raises an exception if truncate isn't implemented
 on your system.  Returns true if successful, the undefined value
 otherwise.
 
@@ -6712,14 +6963,15 @@
 =item uc
 
 Returns an uppercased version of EXPR.  This is the internal function
-implementing the C<\U> escape in double-quoted strings.  Respects
-current LC_CTYPE locale if C<use locale> in force.  See L<perllocale>
-and L<perlunicode> for more details about locale and Unicode support.
+implementing the C<\U> escape in double-quoted strings.
 It does not attempt to do titlecase mapping on initial letters.  See
-C<ucfirst> for that.
+L</ucfirst> for that.
 
 If EXPR is omitted, uses C<$_>.
 
+This function behaves the same way under various pragma, such as in a locale,
+as L</lc> does.
+
 =item ucfirst EXPR
 X<ucfirst> X<uppercase>
 
@@ -6727,12 +6979,13 @@
 
 Returns the value of EXPR with the first character in uppercase
 (titlecase in Unicode).  This is the internal function implementing
-the C<\u> escape in double-quoted strings.  Respects current LC_CTYPE
-locale if C<use locale> in force.  See L<perllocale> and L<perlunicode>
-for more details about locale and Unicode support.
+the C<\u> escape in double-quoted strings.
 
 If EXPR is omitted, uses C<$_>.
 
+This function behaves the same way under various pragma, such as in a locale,
+as L</lc> does.
+
 =item umask EXPR
 X<umask>
 
@@ -6764,8 +7017,8 @@
 so on.
 
 If umask(2) is not implemented on your system and you are trying to
-restrict access for I<yourself> (i.e., (EXPR & 0700) > 0), produces a
-fatal error at run time.  If umask(2) is not implemented and you are
+restrict access for I<yourself> (i.e., C<< (EXPR & 0700) > 0 >>), 
+raises an exception.  If umask(2) is not implemented and you are
 not trying to restrict access for yourself, returns C<undef>.
 
 Remember that a umask is a number, usually given in octal; it is I<not> a
@@ -6778,12 +7031,12 @@
 
 Undefines the value of EXPR, which must be an lvalue.  Use only on a
 scalar value, an array (using C<@>), a hash (using C<%>), a subroutine
-(using C<&>), or a typeglob (using C<*>).  (Saying C<undef $hash{$key}>
+(using C<&>), or a typeglob (using C<*>).  Saying C<undef $hash{$key}>
 will probably not do what you expect on most predefined variables or
-DBM list values, so don't do that; see L<delete>.)  Always returns the
+DBM list values, so don't do that; see L<delete>.  Always returns the
 undefined value.  You can omit the EXPR, in which case nothing is
 undefined, but you still get an undefined value that you could, for
-instance, return from a subroutine, assign to a variable or pass as a
+instance, return from a subroutine, assign to a variable, or pass as a
 parameter.  Examples:
 
     undef $foo;
@@ -6803,20 +7056,29 @@
 
 =item unlink
 
-Deletes a list of files.  Returns the number of files successfully
-deleted.
+Deletes a list of files. On success, it returns the number of files
+it successfully deleted. On failure, it returns false and sets C<$!>
+(errno):
 
-    $cnt = unlink 'a', 'b', 'c';
+    my $unlinked = unlink 'a', 'b', 'c';
     unlink @goners;
-    unlink <*.bak>;
+    unlink glob "*.bak";
 
-Note: C<unlink> will not attempt to delete directories unless you are superuser
-and the B<-U> flag is supplied to Perl.  Even if these conditions are
-met, be warned that unlinking a directory can inflict damage on your
-filesystem.  Finally, using C<unlink> on directories is not supported on 
-many operating systems.  Use C<rmdir> instead.
+On error, C<unlink> will not tell you which files it could not remove.
+If you want to know which files you could not remove, try them one
+at a time:
+
+     foreach my $file ( @goners ) {
+         unlink $file or warn "Could not unlink $file: $!";
+     }
+
+Note: C<unlink> will not attempt to delete directories unless you are
+superuser and the B<-U> flag is supplied to Perl. Even if these
+conditions are met, be warned that unlinking a directory can inflict
+damage on your filesystem.  Finally, using C<unlink> on directories is
+not supported on many operating systems.  Use C<rmdir> instead.
 
-If LIST is omitted, uses C<$_>.
+If LIST is omitted, C<unlink> uses C<$_>.
 
 =item unpack TEMPLATE,EXPR
 X<unpack>
@@ -6828,6 +7090,7 @@
 (In scalar context, it returns merely the first value produced.)
 
 If EXPR is omitted, unpacks the C<$_> string.
+See L<perlpacktut> for an introduction to this function.
 
 The string is broken into chunks described by the TEMPLATE.  Each chunk
 is converted separately to a value.  Typically, either the string is a result
@@ -6838,8 +7101,8 @@
 Here's a subroutine that does substring:
 
     sub substr {
-	my($what,$where,$howmuch) = @_;
-	unpack("x$where a$howmuch", $what);
+        my($what,$where,$howmuch) = @_;
+        unpack("x$where a$howmuch", $what);
     }
 
 and then there's
@@ -6857,8 +7120,8 @@
 computes the same number as the System V sum program:
 
     $checksum = do {
-	local $/;  # slurp!
-	unpack("%32W*",<>) % 65535;
+        local $/;  # slurp!
+        unpack("%32W*",<>) % 65535;
     };
 
 The following efficiently counts the number of set bits in a bit vector:
@@ -6872,10 +7135,10 @@
 
 If there are more pack codes or if the repeat count of a field or a group
 is larger than what the remainder of the input string allows, the result
-is not well defined: in some cases, the repeat count is decreased, or
-C<unpack()> will produce null strings or zeroes, or terminate with an
-error. If the input string is longer than one described by the TEMPLATE,
-the rest is ignored.
+is not well defined: the repeat count may be decreased, or
+C<unpack()> may produce empty strings or zeros, or it may raise an exception.
+If the input string is longer than one described by the TEMPLATE,
+the remainder of that input string is ignored.
 
 See L</pack> for more examples and notes.
 
@@ -6917,35 +7180,38 @@
 
 except that Module I<must> be a bareword.
 
-In the peculiar C<use VERSION> form, VERSION may be either a numeric
-argument such as 5.006, which will be compared to C<$]>, or a literal of
-the form v5.6.1, which will be compared to C<$^V> (aka $PERL_VERSION).  A
-fatal error is produced if VERSION is greater than the version of the
+In the peculiar C<use VERSION> form, VERSION may be either a positive
+decimal fraction such as 5.006, which will be compared to C<$]>, or a v-string
+of the form v5.6.1, which will be compared to C<$^V> (aka $PERL_VERSION).  An
+exception is raised if VERSION is greater than the version of the
 current Perl interpreter; Perl will not attempt to parse the rest of the
 file.  Compare with L</require>, which can do a similar check at run time.
 Symmetrically, C<no VERSION> allows you to specify that you want a version
-of perl older than the specified one.
+of Perl older than the specified one.
 
 Specifying VERSION as a literal of the form v5.6.1 should generally be
 avoided, because it leads to misleading error messages under earlier
 versions of Perl (that is, prior to 5.6.0) that do not support this
 syntax.  The equivalent numeric version should be used instead.
 
-    use v5.6.1;		# compile time version check
-    use 5.6.1;		# ditto
-    use 5.006_001;	# ditto; preferred for backwards compatibility
+    use v5.6.1;     # compile time version check
+    use 5.6.1;      # ditto
+    use 5.006_001;  # ditto; preferred for backwards compatibility
 
 This is often useful if you need to check the current Perl version before
 C<use>ing library modules that won't work with older versions of Perl.
 (We try not to do this more than we have to.)
 
-Also, if the specified perl version is greater than or equal to 5.9.5,
+Also, if the specified Perl version is greater than or equal to 5.9.5,
 C<use VERSION> will also load the C<feature> pragma and enable all
 features available in the requested version.  See L<feature>.
+Similarly, if the specified Perl version is greater than or equal to
+5.11.0, strictures are enabled lexically as with C<use strict> (except
+that the F<strict.pm> file is not actually loaded).
 
 The C<BEGIN> forces the C<require> and C<import> to happen at compile time.  The
 C<require> makes sure the module is loaded into memory if it hasn't been
-yet.  The C<import> is not a builtin--it's just an ordinary static method
+yet.  The C<import> is not a builtin; it's just an ordinary static method
 call into the C<Module> package to tell the module to import the list of
 features back into the current package.  The module can implement its
 C<import> method any way it likes, though most modules just choose to
@@ -6990,17 +7256,31 @@
 which import symbols into the current package (which are effective
 through the end of the file).
 
+Because C<use> takes effect at compile time, it doesn't respect the
+ordinary flow control of the code being compiled.  In particular, putting
+a C<use> inside the false branch of a conditional doesn't prevent it
+from being processed.  If a module or pragma only needs to be loaded 
+conditionally, this can be done using the L<if> pragma:
+
+    use if $] < 5.008, "utf8";
+    use if WANT_WARNINGS, warnings => qw(all);
+
 There's a corresponding C<no> command that unimports meanings imported
 by C<use>, i.e., it calls C<unimport Module LIST> instead of C<import>.
-It behaves exactly as C<import> does with respect to VERSION, an
-omitted LIST, empty LIST, or no unimport method being found.
+It behaves just as C<import> does with VERSION, an omitted or empty LIST, 
+or no unimport method being found.
 
     no integer;
     no strict 'refs';
     no warnings;
 
+Care should be taken when using the C<no VERSION> form of C<no>.  It is
+I<only> meant to be used to assert that the running perl is of a earlier
+version than its argument and I<not> to undo the feature-enabling side effects
+of C<use VERSION>.
+
 See L<perlmodlib> for a list of standard modules and pragmas.  See L<perlrun>
-for the C<-M> and C<-m> command-line options to perl that give C<use>
+for the C<-M> and C<-m> command-line options to Perl that give C<use>
 functionality from the command-line.
 
 =item utime LIST
@@ -7018,14 +7298,17 @@
     $atime = $mtime = time;
     utime $atime, $mtime, @ARGV;
 
-Since perl 5.7.2, if the first two elements of the list are C<undef>, then
-the utime(2) function in the C library will be called with a null second
+Since Perl 5.7.2, if the first two elements of the list are C<undef>, 
+the utime(2) syscall from your C library is called with a null second
 argument. On most systems, this will set the file's access and
-modification times to the current time (i.e. equivalent to the example
-above) and will even work on other users' files where you have write
+modification times to the current time (i.e., equivalent to the example
+above) and will work even on files you don't own provided you have write
 permission:
 
-    utime undef, undef, @ARGV;
+    for $file (@ARGV) {
+	utime(undef, undef, $file) 
+	    || warn "couldn't touch $file: $!";
+    } 
 
 Under NFS this will use the time of the NFS server, not the time of
 the local machine.  If there is a time synchronization problem, the
@@ -7033,38 +7316,45 @@
 touch(1) command will in fact normally use this form instead of the
 one shown in the first example.
 
-Note that only passing one of the first two elements as C<undef> will
-be equivalent of passing it as 0 and will not have the same effect as
-described when they are both C<undef>.  This case will also trigger an
+Passing only one of the first two elements as C<undef> is
+equivalent to passing a 0 and will not have the effect 
+described when both are C<undef>.  This also triggers an
 uninitialized warning.
 
-On systems that support futimes, you might pass file handles among the
-files.  On systems that don't support futimes, passing file handles
-produces a fatal error at run time.  The file handles must be passed
-as globs or references to be recognized.  Barewords are considered
-file names.
+On systems that support futimes(2), you may pass filehandles among the
+files.  On systems that don't support futimes(2), passing filehandles raises
+an exception.  Filehandles must be passed as globs or glob references to be
+recognized; barewords are considered filenames.
 
 =item values HASH
 X<values>
 
-Returns a list consisting of all the values of the named hash.
-(In a scalar context, returns the number of values.)
+=item values ARRAY
+
+Returns a list consisting of all the values of the named hash, or the values
+of an array. (In a scalar context, returns the number of values.)
 
 The values are returned in an apparently random order.  The actual
-random order is subject to change in future versions of perl, but it
+random order is subject to change in future versions of Perl, but it
 is guaranteed to be the same order as either the C<keys> or C<each>
 function would produce on the same (unmodified) hash.  Since Perl
 5.8.1 the ordering is different even between different runs of Perl
 for security reasons (see L<perlsec/"Algorithmic Complexity Attacks">).
 
-As a side effect, calling values() resets the HASH's internal iterator,
+As a side effect, calling values() resets the HASH or ARRAY's internal
+iterator,
 see L</each>. (In particular, calling values() in void context resets
-the iterator with no other overhead.)
+the iterator with no other overhead. Apart from resetting the iterator,
+C<values @array> in list context is the same as plain C<@array>.
+We recommend that you use void context C<keys @array> for this, but reasoned
+that it taking C<values @array> out would require more documentation than
+leaving it in.)
+
 
 Note that the values are not copied, which means modifying them will
 modify the contents of the hash:
 
-    for (values %hash) 	    { s/foo/bar/g }   # modifies %hash values
+    for (values %hash)      { s/foo/bar/g }   # modifies %hash values
     for (@hash{keys %hash}) { s/foo/bar/g }   # same
 
 See also C<keys>, C<each>, and C<sort>.
@@ -7101,7 +7391,7 @@
 If the selected element is outside the string, the value 0 is returned.
 If an element off the end of the string is written to, Perl will first
 extend the string with sufficiently many zero bytes.   It is an error
-to try to write off the beginning of the string (i.e. negative OFFSET).
+to try to write off the beginning of the string (i.e., negative OFFSET).
 
 If the string happens to be encoded as UTF-8 internally (and thus has
 the UTF8 flag set), this is ignored by C<vec>, and it operates on the
@@ -7118,22 +7408,22 @@
 in the same way on big-endian or little-endian machines.
 
     my $foo = '';
-    vec($foo,  0, 32) = 0x5065726C;	# 'Perl'
+    vec($foo,  0, 32) = 0x5065726C; # 'Perl'
 
     # $foo eq "Perl" eq "\x50\x65\x72\x6C", 32 bits
-    print vec($foo, 0, 8);		# prints 80 == 0x50 == ord('P')
+    print vec($foo, 0, 8);  # prints 80 == 0x50 == ord('P')
 
-    vec($foo,  2, 16) = 0x5065;		# 'PerlPe'
-    vec($foo,  3, 16) = 0x726C;		# 'PerlPerl'
-    vec($foo,  8,  8) = 0x50;		# 'PerlPerlP'
-    vec($foo,  9,  8) = 0x65;		# 'PerlPerlPe'
-    vec($foo, 20,  4) = 2;		# 'PerlPerlPe'   . "\x02"
-    vec($foo, 21,  4) = 7;		# 'PerlPerlPer'
-                                        # 'r' is "\x72"
-    vec($foo, 45,  2) = 3;		# 'PerlPerlPer'  . "\x0c"
-    vec($foo, 93,  1) = 1;		# 'PerlPerlPer'  . "\x2c"
-    vec($foo, 94,  1) = 1;		# 'PerlPerlPerl'
-                                        # 'l' is "\x6c"
+    vec($foo,  2, 16) = 0x5065; # 'PerlPe'
+    vec($foo,  3, 16) = 0x726C; # 'PerlPerl'
+    vec($foo,  8,  8) = 0x50;   # 'PerlPerlP'
+    vec($foo,  9,  8) = 0x65;   # 'PerlPerlPe'
+    vec($foo, 20,  4) = 2;      # 'PerlPerlPe'   . "\x02"
+    vec($foo, 21,  4) = 7;      # 'PerlPerlPer'
+                                   # 'r' is "\x72"
+    vec($foo, 45,  2) = 3;      # 'PerlPerlPer'  . "\x0c"
+    vec($foo, 93,  1) = 1;      # 'PerlPerlPer'  . "\x2c"
+    vec($foo, 94,  1) = 1;      # 'PerlPerlPerl'
+                                   # 'l' is "\x6c"
 
 To transform a bit vector into a string or list of 0's and 1's, use these:
 
@@ -7172,8 +7462,8 @@
     .
     __END__
 
-Regardless of the machine architecture on which it is run, the above
-example should print the following table:
+Regardless of the machine architecture on which it runs, the 
+example above should print the following table:
 
                                       0         1         2         3
                        unpack("V",$_) 01234567890123456789012345678901
@@ -7310,13 +7600,16 @@
 =item wait
 X<wait>
 
-Behaves like the wait(2) system call on your system: it waits for a child
+Behaves like wait(2) on your system: it waits for a child
 process to terminate and returns the pid of the deceased process, or
 C<-1> if there are no child processes.  The status is returned in C<$?>
 and C<${^CHILD_ERROR_NATIVE}>.
 Note that a return value of C<-1> could mean that child processes are
 being automatically reaped, as described in L<perlipc>.
 
+If you use wait in your handler for $SIG{CHLD} it may accidently wait for the
+child created by qx() or system(). See L<perlipc> for details.
+
 =item waitpid PID,FLAGS
 X<waitpid>
 
@@ -7328,12 +7621,12 @@
     use POSIX ":sys_wait_h";
     #...
     do {
-	$kid = waitpid(-1, WNOHANG);
+        $kid = waitpid(-1, WNOHANG);
     } while $kid > 0;
 
 then you can do a non-blocking wait for all pending zombie processes.
 Non-blocking wait is available on machines supporting either the
-waitpid(2) or wait4(2) system calls.  However, waiting for a particular
+waitpid(2) or wait4(2) syscalls.  However, waiting for a particular
 pid with FLAGS of C<0> is implemented everywhere.  (Perl emulates the
 system call by remembering the status values of processes that have
 exited but have not been harvested by the Perl script yet.)
@@ -7350,7 +7643,7 @@
 looking for a scalar.  Returns the undefined value if the context is
 looking for no value (void context).
 
-    return unless defined wantarray;	# don't bother doing more
+    return unless defined wantarray; # don't bother doing more
     my @a = complex_calculation();
     return wantarray ? @a : "@a";
 
@@ -7367,7 +7660,7 @@
 not end in a newline, it appends the same file/line number text as C<die>
 does.
 
-If LIST is empty and C<$@> already contains a value (typically from a
+If the output is empty and C<$@> already contains a value (typically from a
 previous eval) that value is used after appending C<"\t...caught">
 to C<$@>.  This is useful for staying almost, but not entirely similar to
 C<die>.
@@ -7377,7 +7670,7 @@
 No message is printed if there is a C<$SIG{__WARN__}> handler
 installed.  It is the handler's responsibility to deal with the message
 as it sees fit (like, for instance, converting it into a C<die>).  Most
-handlers must therefore make arrangements to actually display the
+handlers must therefore arrange to actually display the
 warnings that they are not prepared to deal with, by calling C<warn>
 again in the handler.  Note that this is quite safe and will not
 produce an endless loop, since C<__WARN__> hooks are not called from
Index: src/gnu/usr.bin/perl/pod/perlguts.pod
diff -u src/gnu/usr.bin/perl/pod/perlguts.pod:1.13 src/gnu/usr.bin/perl/pod/perlguts.pod:1.14
--- pod/perlguts.pod:1.13	Mon Oct 12 18:24:47 2009
+++ pod/perlguts.pod	Fri Sep 24 15:07:04 2010
@@ -278,7 +278,7 @@
 C<AvARRAY> points to the first element in the array that is visible from
 Perl, C<AvALLOC> points to the real start of the C array. These are
 usually the same, but a C<shift> operation can be carried out by
-increasing C<AvARRAY> by one and decreasing C<AvFILL> and C<AvLEN>.
+increasing C<AvARRAY> by one and decreasing C<AvFILL> and C<AvMAX>.
 Again, the location of the real start of the C array only comes into
 play when freeing the array. See C<av_shift> in F<av.c>.
 
@@ -786,7 +786,7 @@
 If you are not sure then doing an C<SvREFCNT_inc> and C<sv_2mortal>, or
 making a C<sv_mortalcopy> is safer.
 
-The mortal routines are not just for SVs -- AVs and HVs can be
+The mortal routines are not just for SVs; AVs and HVs can be
 made mortal by passing their address (type-casted to C<SV*>) to the
 C<sv_2mortal> or C<sv_mortalcopy> routines.
 
@@ -979,7 +979,7 @@
     int  (*svt_clear)(SV* sv, MAGIC* mg);
     int  (*svt_free)(SV* sv, MAGIC* mg);
 
-    int  (*svt_copy)(SV *sv, MAGIC* mg, SV *nsv, const char *name, int namlen);
+    int  (*svt_copy)(SV *sv, MAGIC* mg, SV *nsv, const char *name, I32 namlen);
     int  (*svt_dup)(MAGIC *mg, CLONE_PARAMS *param);
     int  (*svt_local)(SV *nsv, MAGIC *mg);
 
@@ -1038,7 +1038,7 @@
     e  PERL_MAGIC_envelem        vtbl_envelem    %ENV hash element
     f  PERL_MAGIC_fm             vtbl_fm         Formline ('compiled' format)
     g  PERL_MAGIC_regex_global   vtbl_mglob      m//g target / study()ed string
-    H  PERL_MAGIC_hints          vtbl_sig        %^H hash
+    H  PERL_MAGIC_hints          vtbl_hints      %^H hash
     h  PERL_MAGIC_hintselem      vtbl_hintselem  %^H hash element
     I  PERL_MAGIC_isa            vtbl_isa        @ISA array
     i  PERL_MAGIC_isaelem        vtbl_isaelem    @ISA array element
@@ -1624,11 +1624,10 @@
 =head2 Scratchpads
 
 The question remains on when the SVs which are I<target>s for opcodes
-are created. The answer is that they are created when the current unit --
-a subroutine or a file (for opcodes for statements outside of
-subroutines) -- is compiled. During this time a special anonymous Perl
-array is created, which is called a scratchpad for the current
-unit.
+are created. The answer is that they are created when the current
+unit--a subroutine or a file (for opcodes for statements outside of
+subroutines)--is compiled. During this time a special anonymous Perl
+array is created, which is called a scratchpad for the current unit.
 
 A scratchpad keeps SVs which are lexicals for the current unit and are
 targets for opcodes. One can deduce that an SV lives on a scratchpad
@@ -1895,7 +1894,7 @@
 state. With multiplicity-enabled perls, PERL_IMPLICIT_CONTEXT is also
 normally defined, and enables the support for passing in a "hidden" first
 argument that represents all three data structures. MULTIPLICITY makes
-mutli-threaded perls possible (with the ithreads threading model, related
+multi-threaded perls possible (with the ithreads threading model, related
 to the macro USE_ITHREADS.)
 
 Two other "encapsulation" macros are the PERL_GLOBAL_STRUCT and
@@ -2182,9 +2181,13 @@
 Similarly, all global variables begin with C<PL_>. (By convention,
 static functions start with C<S_>.)
 
-Inside the Perl core, you can get at the functions either with or
-without the C<Perl_> prefix, thanks to a bunch of defines that live in
-F<embed.h>. This header file is generated automatically from
+Inside the Perl core (C<PERL_CORE> defined), you can get at the functions
+either with or without the C<Perl_> prefix, thanks to a bunch of defines
+that live in F<embed.h>. Note that extension code should I<not> set
+C<PERL_CORE>; this exposes the full perl internals, and is likely to cause
+breakage of the XS in each new perl release.
+
+The file F<embed.h> is generated automatically from
 F<embed.pl> and F<embed.fnc>. F<embed.pl> also creates the prototyping
 header files for the internal functions, generates the documentation
 and a lot of other bits and pieces. It's important that when you add
@@ -2512,7 +2515,8 @@
 slightly differently. A flag in the SV, C<SVf_UTF8>, indicates that the
 string is internally encoded as UTF-8. Without it, the byte value is the
 codepoint number and vice versa (in other words, the string is encoded
-as iso-8859-1). You can check and manipulate this flag with the
+as iso-8859-1, but C<use feature 'unicode_strings'> is needed to get iso-8859-1
+semantics). You can check and manipulate this flag with the
 following macros:
 
     SvUTF8(sv)
@@ -2652,8 +2656,7 @@
 need to enter a name and description for your op at the appropriate
 place in the C<PL_custom_op_names> and C<PL_custom_op_descs> hashes.
 
-Forthcoming versions of C<B::Generate> (version 1.0 and above) should
-directly support the creation of custom ops by name.
+C<B::Generate> directly supports the creation of custom ops by name.
 
 =head1 AUTHORS
 
@@ -2668,4 +2671,4 @@
 
 =head1 SEE ALSO
 
-perlapi(1), perlintern(1), perlxs(1), perlembed(1)
+L<perlapi>, L<perlintern>, L<perlxs>, L<perlembed>
Index: src/gnu/usr.bin/perl/pod/perlhist.pod
diff -u src/gnu/usr.bin/perl/pod/perlhist.pod:1.12 src/gnu/usr.bin/perl/pod/perlhist.pod:1.13
--- pod/perlhist.pod:1.12	Mon Oct 12 18:24:47 2009
+++ pod/perlhist.pod	Fri Sep 24 15:07:04 2010
@@ -26,7 +26,7 @@
 Ing-Simmons, Chip Salzenberg, Tim Bunce, Malcolm Beattie, Gurusamy
 Sarathy, Graham Barr, Jarkko Hietaniemi, Hugo van der Sanden,
 Michael Schwern, Rafael Garcia-Suarez, Nicholas Clark, Richard Clamp,
-Leon Brocard, Dave Mitchell.
+Leon Brocard, Dave Mitchell, Jesse Vincent, Ricardo Signes, Steve Hay.
 
 =head2 PUMPKIN?
 
@@ -307,7 +307,8 @@
           5.004_74      1998-Jul-14     5.005 beta candidate.
           5.004_75      1998-Jul-15     5.005 beta1.
           5.004_76      1998-Jul-21     5.005 beta2.
-          5.005         1998-Jul-22     Oneperl.
+
+ Sarathy  5.005         1998-Jul-22     Oneperl.
 
  Sarathy  5.005_01      1998-Jul-27     The 5.005 maintenance track.
           5.005_02-T1   1998-Aug-02
@@ -345,7 +346,8 @@
           5.6.0-RC1     2000-Mar-09     Release candidate 1.
           5.6.0-RC2     2000-Mar-14     Release candidate 2.
           5.6.0-RC3     2000-Mar-21     Release candidate 3.
-          5.6.0         2000-Mar-22
+
+ Sarathy  5.6.0         2000-Mar-22
 
  Sarathy  5.6.1-TRIAL1  2000-Dec-18     The 5.6 maintenance track.
           5.6.1-TRIAL2  2001-Jan-31
@@ -362,8 +364,10 @@
           5.8.0-RC1     2002-Jun-01
           5.8.0-RC2     2002-Jun-21
           5.8.0-RC3     2002-Jul-13
-          5.8.0         2002-Jul-18
-          5.8.1-RC1     2003-Jul-10
+
+ Jarkko   5.8.0         2002-Jul-18
+
+ Jarkko   5.8.1-RC1     2003-Jul-10     The 5.8 maintenance track
           5.8.1-RC2     2003-Jul-11
           5.8.1-RC3     2003-Jul-30
           5.8.1-RC4     2003-Aug-01
@@ -390,7 +394,7 @@
           5.8.9-RC2     2008-Dec-06
           5.8.9         2008-Dec-14
 
- Hugo     5.9.0         2003-Oct-27
+ Hugo     5.9.0         2003-Oct-27     The 5.9 development track
  Rafael   5.9.1         2004-Mar-16
           5.9.2         2005-Apr-01
           5.9.3         2006-Jan-28
@@ -398,11 +402,25 @@
           5.9.5         2007-Jul-07
           5.10.0-RC1    2007-Nov-17
           5.10.0-RC2    2007-Nov-25
-          5.10.0        2007-Dec-18
- David    5.10.1-RC1    2009-Aug-06
+
+ Rafael   5.10.0        2007-Dec-18
+
+ David    5.10.1-RC1    2009-Aug-06     The 5.10 maintenance track
           5.10.1-RC2    2009-Aug-18
           5.10.1        2009-Aug-22
 
+ Jesse    5.11.0        2009-Oct-02     The 5.11 development track
+          5.11.1        2009-Oct-20
+ Leon     5.11.2        2009-Nov-20
+ Jesse    5.11.3        2009-Dec-20
+ Ricardo  5.11.4        2010-Jan-20
+ Steve    5.11.5        2010-Feb-20
+ Jesse    5.12.0-RC1    2010-Mar-29
+
+ Jesse    5.12.0        2010-Apr-12
+ Jesse    5.12.1        2010-May-16
+ Jesse    5.12.2        2010-Sep-06
+
 =head2 SELECTED RELEASE SIZES
 
 For example the notation "core: 212  29" in the release 1.000 means that
@@ -412,68 +430,71 @@
  release        core       lib         ext        t         doc
  ======================================================================
 
- 1.000           212  29      -   -      -   -     38   51     62   3
- 1.014           219  29      -   -      -   -     39   52     68   4
- 2.000           309  31      2   3      -   -     55   57     92   4
- 2.001           312  31      2   3      -   -     55   57     94   4
- 3.000           508  36     24  11      -   -     79   73    156   5
- 3.044           645  37     61  20      -   -     90   74    190   6
- 4.000           635  37     59  20      -   -     91   75    198   4
- 4.019           680  37     85  29      -   -     98   76    199   4
- 4.036           709  37     89  30      -   -     98   76    208   5
- 5.000alpha2     785  50    114  32      -   -    112   86    209   5
- 5.000alpha3     801  50    117  33      -   -    121   87    209   5
- 5.000alpha9    1022  56    149  43    116  29    125   90    217   6
- 5.000a12h       978  49    140  49    205  46    152   97    228   9
- 5.000b3h       1035  53    232  70    216  38    162   94    218  21
- 5.000          1038  53    250  76    216  38    154   92    536  62
- 5.001m         1071  54    388  82    240  38    159   95    544  29
- 5.002          1121  54    661 101    287  43    155   94    847  35
- 5.003          1129  54    680 102    291  43    166  100    853  35
- 5.003_07       1231  60    748 106    396  53    213  137    976  39
- 5.004          1351  60   1230 136    408  51    355  161   1587  55
- 5.004_01       1356  60   1258 138    410  51    358  161   1587  55
- 5.004_04       1375  60   1294 139    413  51    394  162   1629  55
- 5.004_05       1463  60   1435 150    394  50    445  175   1855  59
- 5.004_51       1401  61   1260 140    413  53    358  162   1594  56
- 5.004_53       1422  62   1295 141    438  70    394  162   1637  56
- 5.004_56       1501  66   1301 140    447  74    408  165   1648  57
- 5.004_59       1555  72   1317 142    448  74    424  171   1678  58
- 5.004_62       1602  77   1327 144    629  92    428  173   1674  58
- 5.004_65       1626  77   1358 146    615  92    446  179   1698  60
- 5.004_68       1856  74   1382 152    619  92    463  187   1784  60
- 5.004_70       1863  75   1456 154    675  92    494  194   1809  60
- 5.004_73       1874  76   1467 152    762 102    506  196   1883  61
- 5.004_75       1877  76   1467 152    770 103    508  196   1896  62
- 5.005          1896  76   1469 152    795 103    509  197   1945  63
- 5.005_03       1936  77   1541 153    813 104    551  201   2176  72       
- 5.005_50       1969  78   1842 301    795 103    514  198   1948  63
- 5.005_53       1999  79   1885 303    806 104    602  224   2002  67
- 5.005_56       2086  79   1970 307    866 113    672  238   2221  75
- 5.6.0          2820  79   2626 364   1096 129    863  280   2840  93
- 5.6.1          2946  78   2921 430   1171 132   1024  304   3330 102
- 5.6.2          2947  78   3143 451   1247 127   1303  387   3406 102
- 5.7.0          2977  80   2801 425   1250 132    975  307   3206 100
- 5.7.1          3351  84   3442 455   1944 167   1334  357   3698 124
- 5.7.2          3491  87   4858 618   3290 298   1598  449   3910 139
- 5.7.3          3299  85   4295 537   2196 300   2176  626   4171 120
- 5.8.0          3489  87   4533 585   2437 331   2588  726   4368 125
- 5.8.1          3674  90   5104 623   2604 353   2983  836   4625 134
- 5.8.2          3633  90   5111 623   2623 357   3019  848   4634 135
- 5.8.3          3625  90   5141 624   2660 363   3083  869   4669 136
- 5.8.4          3653  90   5170 634   2684 368   3148  885   4689 137
- 5.8.5          3664  90   4260 303   2707 369   3208  898   4689 138
- 5.8.6          3690  90   4271 303   3141 396   3411  925   4709 139
- 5.8.7          3788  90   4322 307   3297 401   3485  964   4744 141
- 5.8.8          3895  90   4357 314   3409 431   3622 1017   4979 144
- 5.8.9          4132  93   5508 330   3826 529   4364 1234   5348 152
- 5.9.0          3657  90   4951 626   2603 354   3011  841   4609 135
- 5.9.1          3580  90   5196 634   2665 367   3186  889   4725 138
- 5.9.2          3863  90   4654 312   3283 403   3551  973   4800 142
- 5.9.3          4096  91   5318 381   4806 597   4272 1214   5139 147
- 5.9.4          4393  94   5718 415   4578 642   4646 1310   5335 153
- 5.9.5          4681  96   6849 479   4827 671   5155 1490   5572 159
- 5.10.0         4710  97   7050 486   4899 673   5275 1503   5673 160
+ 1.000           212  29      -   -      -    -     38   51     62   3
+ 1.014           219  29      -   -      -    -     39   52     68   4
+ 2.000           309  31      2   3      -    -     55   57     92   4
+ 2.001           312  31      2   3      -    -     55   57     94   4
+ 3.000           508  36     24  11      -    -     79   73    156   5
+ 3.044           645  37     61  20      -    -     90   74    190   6
+ 4.000           635  37     59  20      -    -     91   75    198   4
+ 4.019           680  37     85  29      -    -     98   76    199   4
+ 4.036           709  37     89  30      -    -     98   76    208   5
+ 5.000alpha2     785  50    114  32      -    -    112   86    209   5
+ 5.000alpha3     801  50    117  33      -    -    121   87    209   5
+ 5.000alpha9    1022  56    149  43    116   29    125   90    217   6
+ 5.000a12h       978  49    140  49    205   46    152   97    228   9
+ 5.000b3h       1035  53    232  70    216   38    162   94    218  21
+ 5.000          1038  53    250  76    216   38    154   92    536  62
+ 5.001m         1071  54    388  82    240   38    159   95    544  29
+ 5.002          1121  54    661 101    287   43    155   94    847  35
+ 5.003          1129  54    680 102    291   43    166  100    853  35
+ 5.003_07       1231  60    748 106    396   53    213  137    976  39
+ 5.004          1351  60   1230 136    408   51    355  161   1587  55
+ 5.004_01       1356  60   1258 138    410   51    358  161   1587  55
+ 5.004_04       1375  60   1294 139    413   51    394  162   1629  55
+ 5.004_05       1463  60   1435 150    394   50    445  175   1855  59
+ 5.004_51       1401  61   1260 140    413   53    358  162   1594  56
+ 5.004_53       1422  62   1295 141    438   70    394  162   1637  56
+ 5.004_56       1501  66   1301 140    447   74    408  165   1648  57
+ 5.004_59       1555  72   1317 142    448   74    424  171   1678  58
+ 5.004_62       1602  77   1327 144    629   92    428  173   1674  58
+ 5.004_65       1626  77   1358 146    615   92    446  179   1698  60
+ 5.004_68       1856  74   1382 152    619   92    463  187   1784  60
+ 5.004_70       1863  75   1456 154    675   92    494  194   1809  60
+ 5.004_73       1874  76   1467 152    762  102    506  196   1883  61
+ 5.004_75       1877  76   1467 152    770  103    508  196   1896  62
+ 5.005          1896  76   1469 152    795  103    509  197   1945  63
+ 5.005_03       1936  77   1541 153    813  104    551  201   2176  72
+ 5.005_50       1969  78   1842 301    795  103    514  198   1948  63
+ 5.005_53       1999  79   1885 303    806  104    602  224   2002  67
+ 5.005_56       2086  79   1970 307    866  113    672  238   2221  75
+ 5.6.0          2820  79   2626 364   1096  129    863  280   2840  93
+ 5.6.1          2946  78   2921 430   1171  132   1024  304   3330 102
+ 5.6.2          2947  78   3143 451   1247  127   1303  387   3406 102
+ 5.7.0          2977  80   2801 425   1250  132    975  307   3206 100
+ 5.7.1          3351  84   3442 455   1944  167   1334  357   3698 124
+ 5.7.2          3491  87   4858 618   3290  298   1598  449   3910 139
+ 5.7.3          3299  85   4295 537   2196  300   2176  626   4171 120
+ 5.8.0          3489  87   4533 585   2437  331   2588  726   4368 125
+ 5.8.1          3674  90   5104 623   2604  353   2983  836   4625 134
+ 5.8.2          3633  90   5111 623   2623  357   3019  848   4634 135
+ 5.8.3          3625  90   5141 624   2660  363   3083  869   4669 136
+ 5.8.4          3653  90   5170 634   2684  368   3148  885   4689 137
+ 5.8.5          3664  90   4260 303   2707  369   3208  898   4689 138
+ 5.8.6          3690  90   4271 303   3141  396   3411  925   4709 139
+ 5.8.7          3788  90   4322 307   3297  401   3485  964   4744 141
+ 5.8.8          3895  90   4357 314   3409  431   3622 1017   4979 144
+ 5.8.9          4132  93   5508 330   3826  529   4364 1234   5348 152
+ 5.9.0          3657  90   4951 626   2603  354   3011  841   4609 135
+ 5.9.1          3580  90   5196 634   2665  367   3186  889   4725 138
+ 5.9.2          3863  90   4654 312   3283  403   3551  973   4800 142
+ 5.9.3          4096  91   5318 381   4806  597   4272 1214   5139 147
+ 5.9.4          4393  94   5718 415   4578  642   4646 1310   5335 153
+ 5.9.5          4681  96   6849 479   4827  671   5155 1490   5572 159
+ 5.10.0         4710  97   7050 486   4899  673   5275 1503   5673 160
+ 5.10.1         4858  98   7440 519   6195  921   6147 1751   5151 163
+ 5.12.0         4999 100   1146 121  15227 2176   6400 1843   5342 168
+ 5.12.1         5000 100   1146 121  15283 2178   6407 1846   5354 169
 
 The "core"..."doc" mean the following files from the Perl source code
 distribution.  The glob notation ** means recursively, (.) means
@@ -481,7 +502,8 @@
 
  core   *.[hcy]
  lib    lib/**/*.p[ml]
- ext    ext/**/*.{[hcyt],xs,pm}
+ ext    ext/**/*.{[hcyt],xs,pm} (for -5.10.1) or
+        {dist,ext,cpan}/**/*.{[hcyt],xs,pm} (for 5.12.0-)
  t      t/**/*(.) (for 1-5.005_56) or **/*.t (for 5.6.0-5.7.3)
  doc    {README*,INSTALL,*[_.]man{,.?},pod/**/*.pod}
 
@@ -718,33 +740,33 @@
 
  ======================================================================
 
-                  5.9.5     5.10.0
+                  5.9.5     5.10.0     5.10.1     5.12.0     5.12.1
 
- apollo          8    3     8    3
- beos            8    4     8    4
- Configure     518    1   518    1
- Cross         122   15   122   15
- djgpp          21    7    21    7
- emacs         329    4   406    4
- epoc           34    8    35    8
- h2pl           24   15    24   15
- hints         377   98   381   98
- mad           182    8   182    8
- mint           11    9    11    9
- mpeix          49    6    49    6
- NetWare       489   61   489   61
- os2           552   70   552   70
- plan9         324   17   324   17
- Porting       627   40   632   40
- qnx             5    3     5    4
- symbian       300   54   300   54
- utils         260   26   264   27
- uts            12    3    12    3
- vmesa          25    4    25    4
- vms           690   32   722   32
- vos            19    8    19    8
- win32        1482   68  1485   68
- x2p           349   19   349   19
+ apollo          8    3     8    3     0    3     0    3     0    3
+ beos            8    4     8    4     4    4     4    4     4    4
+ Configure     518    1   518    1   533    1   536    1   536    1
+ Cross         122   15   122   15   119   15   118   15   118   15
+ djgpp          21    7    21    7    17    7    17    7    17    7
+ emacs         329    4   406    4   402    4   402    4   402    4
+ epoc           34    8    35    8    31    8    31    8    31    8
+ h2pl           24   15    24   15    12   15    12   15    12   15
+ hints         377   98   381   98   385  100   368   97   368   97
+ mad           182    8   182    8   174    8   174    8   174    8
+ mint           11    9    11    9     3    9     -    -     -    -
+ mpeix          49    6    49    6    45    6    45    6    45    6
+ NetWare       489   61   489   61   465   61   466   61   466   61
+ os2           552   70   552   70   507   70   507   70   507   70
+ plan9         324   17   324   17   316   17   316   17   316   17
+ Porting       627   40   632   40   933   53   749   54   749   54
+ qnx             5    3     5    4     1    4     1    4     1    4
+ symbian       300   54   300   54   290   54   288   54   288   54
+ utils         260   26   264   27   268   27   269   27   269   27
+ uts            12    3    12    3     8    3     8    3     8    3
+ vmesa          25    4    25    4    21    4    21    4    21    4
+ vms           690   32   722   32   693   30   645   18   645   18
+ vos            19    8    19    8    16    8    16    8    16    8
+ win32        1482   68  1485   68  1497   70  1841   73  1841   73
+ x2p           349   19   349   19   345   19   345   19   345   19
 
 =head2 SELECTED PATCH SIZES
 
@@ -852,7 +874,7 @@
 
 Thanks to the collective memory of the Perlfolk.  In addition to the
 Keepers of the Pumpkin also Alan Champion, Mark Dominus, 
-Andreas Knig, John Macdonald, Matthias Neeracher, Jeff Okamoto,
+Andreas Knig, John Macdonald, Matthias Neeracher, Jeff Okamoto,
 Michael Peppler, Randal Schwartz, and Paul D. Smith sent corrections
 and additions. Abigail added file and patch size data for the 5.6.0 - 5.10
 era.
Index: src/gnu/usr.bin/perl/pod/perlipc.pod
diff -u src/gnu/usr.bin/perl/pod/perlipc.pod:1.12 src/gnu/usr.bin/perl/pod/perlipc.pod:1.13
--- pod/perlipc.pod:1.12	Mon Oct 12 18:24:47 2009
+++ pod/perlipc.pod	Fri Sep 24 15:07:04 2010
@@ -150,7 +150,43 @@
     $SIG{CHLD} = \&REAPER;
     # do something that forks...
 
-Signal handling is also used for timeouts in Unix,   While safely
+Note: qx(), system() and some modules for calling external commands do a
+fork() and wait() for the result. Thus, your signal handler (REAPER in the
+example) will be called. Since wait() was already called by system() or qx()
+the wait() in the signal handler will not see any more zombies and therefore
+block.
+
+The best way to prevent this issue is to use waitpid, as in the following
+example:
+
+    use POSIX ":sys_wait_h"; # for nonblocking read
+
+    my %children;
+
+    $SIG{CHLD} = sub {
+        # don't change $! and $? outside handler
+        local ($!,$?);
+        my $pid = waitpid(-1, WNOHANG);
+        return if $pid == -1;
+        return unless defined $children{$pid};
+        delete $children{$pid};
+        cleanup_child($pid, $?);
+    };
+
+    while (1) {
+        my $pid = fork();
+        if ($pid == 0) {
+            # ...
+            exit 0;
+        } else {
+        $children{$pid}=1;
+            # ...
+            system($command);
+            # ...
+       }
+    }
+
+Signal handling is also used for timeouts in Unix.  While safely
 protected within an C<eval{}> block, you set a signal handler to trap
 alarm signals and then schedule to have one delivered to you in some
 number of seconds.  Then try your blocking operation, clearing the alarm
@@ -316,8 +352,8 @@
 convenience", and to do anything you wanted in your signal handler,
 and be prepared to clean up core dumps now and again.
 
-In Perl 5.7.3 and later to avoid these problems signals are
-"deferred"-- that is when the signal is delivered to the process by
+Perl 5.7.3 and later avoid these problems by "deferring" signals.
+That is, when the signal is delivered to the process by
 the system (to the C code that implements Perl) a flag is set, and the
 handler returns immediately. Then at strategic "safe" points in the
 Perl interpreter (e.g. when it is about to execute a new opcode) the
@@ -718,7 +754,7 @@
 never exit.  A single process closing a pipe is not enough to close it;
 the last process with the pipe open must close it for it to read EOF.
 
-There are some features built-in to unix to help prevent this most of
+Certain built-in Unix features help prevent this most of
 the time.  For instance, filehandles have a 'close on exec' flag (set
 I<en masse> with Perl using the C<$^F> L<perlvar>), so that any
 filehandles which you didn't explicitly route to the STDIN, STDOUT or
@@ -1129,7 +1165,7 @@
 	my $hisiaddr = inet_aton($host)     || die "unknown host";
 	my $hispaddr = sockaddr_in($port, $hisiaddr);
 	socket(SOCKET, PF_INET, SOCK_STREAM, $proto)   || die "socket: $!";
-	connect(SOCKET, $hispaddr)          || die "bind: $!";
+	connect(SOCKET, $hispaddr)          || die "connect: $!";
 	my $rtime = '    ';
 	read(SOCKET, $rtime, 4);
 	close(SOCKET);
@@ -1661,7 +1697,7 @@
     use IPC::SysV qw(IPC_PRIVATE IPC_RMID S_IRUSR S_IWUSR);
 
     $size = 2000;
-    $id = shmget(IPC_PRIVATE, $size, S_IRUSR|S_IWUSR) || die "$!";
+    $id = shmget(IPC_PRIVATE, $size, S_IRUSR|S_IWUSR) // die "$!";
     print "shm key $id\n";
 
     $message = "Message #1";
@@ -1683,7 +1719,7 @@
     use IPC::SysV qw(IPC_CREAT);
 
     $IPC_KEY = 1234;
-    $id = semget($IPC_KEY, 10, 0666 | IPC_CREAT ) || die "$!";
+    $id = semget($IPC_KEY, 10, 0666 | IPC_CREAT ) // die "$!";
     print "shm key $id\n";
 
 Put this code in a separate file to be run in more than one process.
Index: src/gnu/usr.bin/perl/pod/perllocale.pod
diff -u src/gnu/usr.bin/perl/pod/perllocale.pod:1.7 src/gnu/usr.bin/perl/pod/perllocale.pod:1.8
--- pod/perllocale.pod:1.7	Mon Sep 29 17:36:16 2008
+++ pod/perllocale.pod	Fri Sep 24 15:07:04 2010
@@ -434,7 +434,7 @@
 =head2 I18N::Langinfo
 
 Another interface for querying locale-dependent information is the
-I18N::Langinfo::langinfo() function, available at least in UNIX-like
+I18N::Langinfo::langinfo() function, available at least in Unix-like
 systems and VMS.
 
 The following example will import the langinfo() function itself and
@@ -861,7 +861,7 @@
 
 B<NOTE>: C<LANGUAGE> is a GNU extension, it affects you only if you
 are using the GNU libc.  This is the case if you are using e.g. Linux.
-If you are using "commercial" UNIXes you are most probably I<not>
+If you are using "commercial" Unixes you are most probably I<not>
 using GNU libc and you can ignore C<LANGUAGE>.
 
 However, in the case you are using C<LANGUAGE>: it affects the
@@ -977,8 +977,11 @@
 
 =head2 Freely available locale definitions
 
-There is a large collection of locale definitions at
-ftp://dkuug.dk/i18n/WG15-collection .  You should be aware that it is
+There is a large collection of locale definitions at:
+
+  http://std.dkuug.dk/i18n/WG15-collection/locales/
+
+You should be aware that it is
 unsupported, and is not claimed to be fit for any purpose.  If your
 system allows installation of arbitrary locales, you may find the
 definitions useful as they are, or as a basis for the development of
Index: src/gnu/usr.bin/perl/pod/perllol.pod
diff -u src/gnu/usr.bin/perl/pod/perllol.pod:1.7 src/gnu/usr.bin/perl/pod/perllol.pod:1.8
--- pod/perllol.pod:1.7	Mon Oct 12 18:24:47 2009
+++ pod/perllol.pod	Fri Sep 24 15:07:04 2010
@@ -294,7 +294,7 @@
 
 =head1 SEE ALSO
 
-perldata(1), perlref(1), perldsc(1)
+L<perldata>, L<perlref>, L<perldsc>
 
 =head1 AUTHOR
 
Index: src/gnu/usr.bin/perl/pod/perlmod.pod
diff -u src/gnu/usr.bin/perl/pod/perlmod.pod:1.12 src/gnu/usr.bin/perl/pod/perlmod.pod:1.13
--- pod/perlmod.pod:1.12	Mon Oct 12 18:24:47 2009
+++ pod/perlmod.pod	Fri Sep 24 15:07:04 2010
@@ -134,7 +134,7 @@
     }
 
 Would print '1', because C<$foo> holds a reference to the I<original>
-C<$bar> -- the one that was stuffed away by C<local()> and which will be
+C<$bar>. The one that was stuffed away by C<local()> and which will be
 restored when the block ends. Because variables are accessed through the
 typeglob, you can use C<*foo = *bar> to create an alias which can be
 localized. (But be aware that this means you can't have a separate
@@ -267,7 +267,7 @@
 A C<BEGIN> code block is executed as soon as possible, that is, the moment
 it is completely defined, even before the rest of the containing file (or
 string) is parsed.  You may have multiple C<BEGIN> blocks within a file (or
-eval'ed string) -- they will execute in order of definition.  Because a C<BEGIN>
+eval'ed string); they will execute in order of definition.  Because a C<BEGIN>
 code block executes immediately, it can pull in definitions of subroutines
 and such from other files in time to be visible to the rest of the compile
 and run time.  Once a C<BEGIN> has run, it is immediately undefined and any
Index: src/gnu/usr.bin/perl/pod/perlmodinstall.pod
diff -u src/gnu/usr.bin/perl/pod/perlmodinstall.pod:1.6 src/gnu/usr.bin/perl/pod/perlmodinstall.pod:1.7
--- pod/perlmodinstall.pod:1.6	Tue Oct 13 01:25:48 2009
+++ pod/perlmodinstall.pod	Fri Sep 24 15:07:04 2010
@@ -49,7 +49,7 @@
 might have come with your module!
 
 Also note that these instructions are tailored for installing the
-module into your system's repository of Perl modules -- but you can
+module into your system's repository of Perl modules, but you can
 install modules into any directory you wish.  For instance, where I
 say C<perl Makefile.PL>, you can substitute C<perl Makefile.PL
 PREFIX=/my/perl_directory> to install the modules into
@@ -110,7 +110,7 @@
 in your Perl 5 library directory.  Often, you'll need to be root.
 
 That's all you need to do on Unix systems with dynamic linking.
-Most Unix systems have dynamic linking -- if yours doesn't, or if for
+Most Unix systems have dynamic linking. If yours doesn't, or if for
 another reason you have a statically-linked perl, B<and> the
 module requires compilation, you'll need to build a new Perl binary
 that includes the module.  Again, you'll probably need to be root.
@@ -145,7 +145,7 @@
 Does the module require compilation (i.e. does it have files that end
 in .xs, .c, .h, .y, .cc, .cxx, or .C)?  If it does, life is now
 officially tough for you, because you have to compile the module
-yourself -- no easy feat on Windows.  You'll need a compiler such as
+yourself (no easy feat on Windows).  You'll need a compiler such as
 Visual C++.  Alternatively, you can download a pre-built PPM package
 from ActiveState.
 http://aspn.activestate.com/ASPN/Downloads/ActivePerl/PPM/
@@ -179,9 +179,7 @@
 B<untarzipme> droplet, which will decompress and unpack for you.
 
 B<Or>, you can either use the shareware B<StuffIt Expander> program
-( http://www.aladdinsys.com/expander/ )
-in combination with B<DropStuff with Expander Enhancer>
-( http://www.aladdinsys.com/dropstuff/ )
+( http://my.smithmicro.com/mac/stuffit/ )
 or the freeware B<MacGzip> program (
 http://persephone.cps.unizar.es/general/gente/spd/gzip/gzip.html ).
 
@@ -200,14 +198,6 @@
 must be compiled, and you cannot install it "out of the box."
 (See L<"PORTABILITY">.)
 
-If a module does not work on MacPerl but should, or needs to be
-compiled, see if the module exists already as a port on the
-MacPerl Module Porters site ( http://pudge.net/mmp/ ).
-For more information on doing XS with MacPerl yourself, see
-Arved Sandstrom's XS tutorial ( http://macperl.com/depts/Tutorials/ ),
-and then consider uploading your binary to the CPAN and
-registering it on the MMP site.
-
 D. INSTALL
 
 If you are using cpan-mac, just drop the folder on the
@@ -251,7 +241,7 @@
 
    A. DECOMPRESS
 
-djtarx ( ftp://ftp.simtel.net/pub/simtelnet/gnu/djgpp/v2/ )
+djtarx ( ftp://ftp.delorie.com/pub/djgpp/current/v2/ )
 will both uncompress and unpack.
 
    B. UNPACK
@@ -306,8 +296,7 @@
 
 Executables for gzip, zip, and VMStar:
 
-    http://www.openvms.digital.com/freeware/
-    http://www.crinoid.com/utils/
+    http://www.hp.com/go/openvms/freeware/
 
 and their source code:
 
Index: src/gnu/usr.bin/perl/pod/perlobj.pod
diff -u src/gnu/usr.bin/perl/pod/perlobj.pod:1.11 src/gnu/usr.bin/perl/pod/perlobj.pod:1.12
--- pod/perlobj.pod:1.11	Mon Oct 12 18:24:47 2009
+++ pod/perlobj.pod	Fri Sep 24 15:07:04 2010
@@ -350,8 +350,8 @@
 call compiled as a method, or vice versa.  This can introduce subtle bugs
 that are hard to detect.
 
-For example, a call to a method C<new> in indirect notation -- as C++
-programmers are wont to make -- can be miscompiled into a subroutine
+For example, a call to a method C<new> in indirect notation (as C++
+programmers are wont to make) can be miscompiled into a subroutine
 call if there's already a C<new> function in scope.  You'd end up
 calling the current package's C<new> as a subroutine, rather than the
 desired class's method.  The compiler tries to cheat by remembering
@@ -459,6 +459,15 @@
 object destruction, or for ensuring that destructors in the base classes
 of your choosing get called.  Explicitly calling DESTROY is also possible,
 but is usually never needed.
+
+DESTROY is subject to AUTOLOAD lookup, just like any other method. Hence, if
+your class has an AUTOLOAD method, but does not need any DESTROY actions,
+you probably want to provide a DESTROY method anyway, to prevent an
+expensive call to AUTOLOAD each time an object is freed. As this technique
+makes empty DESTROY methods common, the implementation is optimised so that
+a DESTROY method that is an empty or constant subroutine, and hence could
+have no side effects anyway, is not actually called.
+X<AUTOLOAD> X<DESTROY>
 
 Do not confuse the previous discussion with how objects I<CONTAINED> in the current
 one are destroyed.  Such objects will be freed and destroyed automatically
Index: src/gnu/usr.bin/perl/pod/perlop.pod
diff -u src/gnu/usr.bin/perl/pod/perlop.pod:1.15 src/gnu/usr.bin/perl/pod/perlop.pod:1.16
--- pod/perlop.pod:1.15	Tue Oct 13 01:25:48 2009
+++ pod/perlop.pod	Fri Sep 24 15:07:04 2010
@@ -556,33 +556,33 @@
 	# code
     }
 
-The range operator also works on strings, using the magical auto-increment,
-see below.
+The range operator also works on strings, using the magical
+auto-increment, see below.
 
 In scalar context, ".." returns a boolean value.  The operator is
-bistable, like a flip-flop, and emulates the line-range (comma) operator
-of B<sed>, B<awk>, and various editors.  Each ".." operator maintains its
-own boolean state.  It is false as long as its left operand is false.
+bistable, like a flip-flop, and emulates the line-range (comma)
+operator of B<sed>, B<awk>, and various editors. Each ".." operator
+maintains its own boolean state, even across calls to a subroutine
+that contains it. It is false as long as its left operand is false.
 Once the left operand is true, the range operator stays true until the
 right operand is true, I<AFTER> which the range operator becomes false
-again.  It doesn't become false till the next time the range operator is
-evaluated.  It can test the right operand and become false on the same
-evaluation it became true (as in B<awk>), but it still returns true once.
-If you don't want it to test the right operand till the next
-evaluation, as in B<sed>, just use three dots ("...") instead of
+again.  It doesn't become false till the next time the range operator
+is evaluated.  It can test the right operand and become false on the
+same evaluation it became true (as in B<awk>), but it still returns
+true once. If you don't want it to test the right operand until the
+next evaluation, as in B<sed>, just use three dots ("...") instead of
 two.  In all other regards, "..." behaves just like ".." does.
 
 The right operand is not evaluated while the operator is in the
 "false" state, and the left operand is not evaluated while the
 operator is in the "true" state.  The precedence is a little lower
 than || and &&.  The value returned is either the empty string for
-false, or a sequence number (beginning with 1) for true.  The
-sequence number is reset for each range encountered.  The final
-sequence number in a range has the string "E0" appended to it, which
-doesn't affect its numeric value, but gives you something to search
-for if you want to exclude the endpoint.  You can exclude the
-beginning point by waiting for the sequence number to be greater
-than 1.
+false, or a sequence number (beginning with 1) for true.  The sequence
+number is reset for each range encountered.  The final sequence number
+in a range has the string "E0" appended to it, which doesn't affect
+its numeric value, but gives you something to search for if you want
+to exclude the endpoint.  You can exclude the beginning point by
+waiting for the sequence number to be greater than 1.
 
 If either operand of scalar ".." is a constant expression,
 that operand is considered true if it is equal (C<==>) to the current
@@ -813,6 +813,67 @@
         %hash = ( $key => $value );
         login( $username => $password );
 
+=head2 Yada Yada Operator
+X<...> X<... operator> X<yada yada operator>
+
+The yada yada operator (noted C<...>) is a placeholder for code. Perl
+parses it without error, but when you try to execute a yada yada, it
+throws an exception with the text C<Unimplemented>:
+
+	sub unimplemented { ... }
+	
+	eval { unimplemented() };
+	if( $@ eq 'Unimplemented' ) {
+	  print "I found the yada yada!\n";
+	  }
+
+You can only use the yada yada to stand in for a complete statement.
+These examples of the yada yada work:
+
+	{ ... }
+	
+	sub foo { ... }
+	
+	...;
+	
+	eval { ... };
+	
+	sub foo {
+			my( $self ) = shift;
+			
+			...;
+			}
+			
+	do { my $n; ...; print 'Hurrah!' };
+
+The yada yada cannot stand in for an expression that is part of a
+larger statement since the C<...> is also the three-dot version of the
+range operator (see L<Range Operators>). These examples of the yada
+yada are still syntax errors:
+
+	print ...;
+	
+	open my($fh), '>', '/dev/passwd' or ...;
+	
+	if( $condition && ... ) { print "Hello\n" };
+
+There are some cases where Perl can't immediately tell the difference
+between an expression and a statement. For instance, the syntax for a
+block and an anonymous hash reference constructor look the same unless
+there's something in the braces that give Perl a hint. The yada yada
+is a syntax error if Perl doesn't guess that the C<{ ... }> is a
+block. In that case, it doesn't think the C<...> is the yada yada
+because it's expecting an expression instead of a statement:
+
+	my @transformed = map { ... } @input;  # syntax error
+
+You can use a C<;> inside your block to denote that the C<{ ... }> is
+a block and not a hash reference constructor. Now the yada yada works:
+
+	my @transformed = map {; ... } @input; # ; disambiguates
+
+	my @transformed = map { ...; } @input; # ; disambiguates
+
 =head2 List Operators (Rightward)
 X<operator, list, rightward> X<list operator>
 
@@ -965,6 +1026,7 @@
     \x{263a}	wide hex char	(example: SMILEY)
     \c[		control char    (example: ESC)
     \N{name}	named Unicode character
+    \N{U+263D}	Unicode character (example: FIRST QUARTER MOON)
 
 The character following C<\c> is mapped to some other character by
 converting letters to upper case and then (on ASCII systems) by inverting
@@ -974,10 +1036,15 @@
 '@', the letters, '[', '\', ']', '^', '_' and '?' will work, resulting
 in 0x00 through 0x1F and 0x7F.
 
-B<NOTE>: Unlike C and other languages, Perl has no \v escape sequence for
-the vertical tab (VT - ASCII 11), but you may use C<\ck> or C<\x0b>.
+C<\N{U+I<wide hex char>}> means the Unicode character whose Unicode ordinal
+number is I<wide hex char>.
+For documentation of C<\N{name}>, see L<charnames>.
+
+B<NOTE>: Unlike C and other languages, Perl has no C<\v> escape sequence for
+the vertical tab (VT - ASCII 11), but you may use C<\ck> or C<\x0b>.  (C<\v>
+does have meaning in regular expression patterns in Perl, see L<perlre>.)
 
-The following escape sequences are available in constructs that interpolate
+The following escape sequences are available in constructs that interpolate,
 but not in transliterations.
 X<\l> X<\u> X<\L> X<\U> X<\E> X<\Q>
 
@@ -992,8 +1059,7 @@
 C<\u> and C<\U> is taken from the current locale.  See L<perllocale>.
 If Unicode (for example, C<\N{}> or wide hex characters of 0x100 or
 beyond) is being used, the case map used by C<\l>, C<\L>, C<\u> and
-C<\U> is as defined by Unicode.  For documentation of C<\N{name}>,
-see L<charnames>.
+C<\U> is as defined by Unicode.
 
 All systems use the virtual C<"\n"> to represent a line terminator,
 called a "newline".  There is no such thing as an unvarying, physical
@@ -1139,11 +1205,13 @@
     c	Do not reset search position on a failed match when /g is in effect.
 
 If "/" is the delimiter then the initial C<m> is optional.  With the C<m>
-you can use any pair of non-alphanumeric, non-whitespace characters
+you can use any pair of non-whitespace characters
 as delimiters.  This is particularly useful for matching path names
 that contain "/", to avoid LTS (leaning toothpick syndrome).  If "?" is
 the delimiter, then the match-only-once rule of C<?PATTERN?> applies.
 If "'" is the delimiter, no interpolation is performed on the PATTERN.
+When using a character valid in an identifier, whitespace is required
+after the C<m>.
 
 PATTERN may contain variables, which will be interpolated (and the
 pattern recompiled) every time the pattern search is evaluated, except
@@ -1271,7 +1339,7 @@
 
 Notice that the final match matched C<q> instead of C<p>, which a match
 without the C<\G> anchor would have done. Also note that the final match
-did not update C<pos> -- C<pos> is only updated on a C</g> match. If the
+did not update C<pos>. C<pos> is only updated on a C</g> match. If the
 final match did indeed match C<p>, it's a good bet that you're running an
 older (pre-5.6.0) Perl.
 
@@ -1281,7 +1349,7 @@
 regexp tries to match where the previous one leaves off.
 
  $_ = <<'EOL';
-      $url = URI::URL->new( "http://www/" );   die if $url eq "xXx";
+      $url = URI::URL->new( "http://example.com/" ); die if $url eq "xXx";
  EOL
  LOOP:
     {
@@ -1353,13 +1421,13 @@
     e	Evaluate the right side as an expression.
     ee  Evaluate the right side as a string then eval the result
 
-Any non-alphanumeric, non-whitespace delimiter may replace the
-slashes.  If single quotes are used, no interpretation is done on the
-replacement string (the C</e> modifier overrides this, however).  Unlike
-Perl 4, Perl 5 treats backticks as normal delimiters; the replacement
-text is not evaluated as a command.  If the
-PATTERN is delimited by bracketing quotes, the REPLACEMENT has its own
-pair of quotes, which may or may not be bracketing quotes, e.g.,
+Any non-whitespace delimiter may replace the slashes.  Add space after
+the C<s> when using a character allowed in identifiers.  If single quotes
+are used, no interpretation is done on the replacement string (the C</e>
+modifier overrides this, however).  Unlike Perl 4, Perl 5 treats backticks
+as normal delimiters; the replacement text is not evaluated as a command.
+If the PATTERN is delimited by bracketing quotes, the REPLACEMENT has
+its own pair of quotes, which may or may not be bracketing quotes, e.g.,
 C<s(foo)(bar)> or C<< s<foo>/bar/ >>.  A C</e> will cause the
 replacement portion to be treated as a full-fledged Perl expression
 and evaluated right then and there.  It is, however, syntax checked at
@@ -1791,7 +1859,7 @@
 warning B<Can't find string terminator "END" anywhere before EOF...>.
 
 Additionally, the quoting rules for the end of string identifier are not
-related to Perl's quoting rules -- C<q()>, C<qq()>, and the like are not
+related to Perl's quoting rules. C<q()>, C<qq()>, and the like are not
 supported in place of C<''> and C<"">, and the only interpolation is for
 backslashing the quoting character:
 
@@ -2006,6 +2074,11 @@
 Processing of C<\Q>, C<\U>, C<\u>, C<\L>, C<\l>, C<\E>,
 and interpolation happens (almost) as with C<qq//> constructs.
 
+Processing of C<\N{...}> is also done here, and compiled into an intermediate
+form for the regex compiler.  (This is because, as mentioned below, the regex
+compilation may be done at execution time, and C<\N{...}> is a compile-time
+construct.)
+
 However any other combinations of C<\> followed by a character
 are not substituted but only skipped, in order to parse them
 as regular expressions at the following step.
@@ -2055,7 +2128,7 @@
 X<regexp, parse>
 
 Previous steps were performed during the compilation of Perl code,
-but this one happens at run time--although it may be optimized to
+but this one happens at run time, although it may be optimized to
 be calculated at compile time if appropriate.  After preprocessing
 described above, and possibly after evaluation if concatenation,
 joining, casing translation, or metaquoting are involved, the
@@ -2168,8 +2241,8 @@
     while (($_ = <STDIN>) ne '0') { ... }
     while (<STDIN>) { last unless $_; ... }
 
-In other boolean contexts, C<< <I<filehandle>> >> without an
-explicit C<defined> test or comparison elicit a warning if the
+In other boolean contexts, C<< <filehandle> >> without an
+explicit C<defined> test or comparison elicits a warning if the
 C<use warnings> pragma or the B<-w>
 command-line switch (the C<$^W> variable) is in effect.
 
@@ -2214,7 +2287,7 @@
 except that it isn't so cumbersome to say, and will actually work.
 It really does shift the @ARGV array and put the current filename
 into the $ARGV variable.  It also uses filehandle I<ARGV>
-internally--<> is just a synonym for <ARGV>, which
+internally. <> is just a synonym for <ARGV>, which
 is magical.  (The pseudo code above doesn't work because it treats
 <ARGV> as non-magical.)
 
@@ -2448,8 +2521,8 @@
     printf "%.20g\n", 123456789123456789;
     #        produces 123456789123456784
 
-Testing for exact equality of floating-point equality or inequality is
-not a good idea.  Here's a (relatively expensive) work-around to compare
+Testing for exact floating-point equality or inequality is not a
+good idea.  Here's a (relatively expensive) work-around to compare
 whether two floating-point numbers are equal to a particular number of
 decimal places.  See Knuth, volume II, for a more robust treatment of
 this topic.
Index: src/gnu/usr.bin/perl/pod/perlpod.pod
diff -u src/gnu/usr.bin/perl/pod/perlpod.pod:1.10 src/gnu/usr.bin/perl/pod/perlpod.pod:1.11
--- pod/perlpod.pod:1.10	Mon Oct 12 18:24:47 2009
+++ pod/perlpod.pod	Fri Sep 24 15:07:04 2010
@@ -155,7 +155,7 @@
 And perhaps most importantly, keep the items consistent: either use
 "=item *" for all of them, to produce bullets; or use "=item 1.",
 "=item 2.", etc., to produce numbered lists; or use "=item foo",
-"=item bar", etc. -- namely, things that look nothing like bullets or
+"=item bar", etc.--namely, things that look nothing like bullets or
 numbers.
 
 If you start with bullets or numbers, stick with them, as
@@ -383,7 +383,7 @@
 
 Link to a Perl manual page (e.g., C<LE<lt>Net::PingE<gt>>).  Note
 that C<name> should not contain spaces.  This syntax
-is also occasionally used for references to UNIX man pages, as in
+is also occasionally used for references to Unix man pages, as in
 C<LE<lt>crontab(5)E<gt>>.
 
 =item *
@@ -395,7 +395,7 @@
 
 =item *
 
-C<LE<lt>/"sec"E<gt>> or C<LE<lt>/secE<gt>> or C<LE<lt>"sec"E<gt>>
+C<LE<lt>/"sec"E<gt>> or C<LE<lt>/secE<gt>>
 
 Link to a section in this manual page.  E.g.,
 C<LE<lt>/"Object Methods"E<gt>>
@@ -446,10 +446,10 @@
 
 C<LE<lt>scheme:...E<gt>>
 
-Links to an absolute URL.  For example,
-C<LE<lt>http://www.perl.org/E<gt>>.  But note
-that there is no corresponding C<LE<lt>text|scheme:...E<gt>> syntax, for
-various reasons.
+C<LE<lt>text|scheme:...E<gt>>
+
+Links to an absolute URL.  For example, C<LE<lt>http://www.perl.org/E<gt>> or
+C<LE<lt>The Perl Home Page|http://www.perl.org/E<gt>>.
 
 =back
 
@@ -557,9 +557,8 @@
 This will produce: "C<$a E<lt>=E<gt> $b>"
 
 A more readable, and perhaps more "plain" way is to use an alternate
-set of delimiters that doesn't require a single ">" to be escaped.  With
-the Pod formatters that are standard starting with perl5.5.660, doubled
-angle brackets ("<<" and ">>") may be used I<if and only if there is
+set of delimiters that doesn't require a single ">" to be escaped.
+Doubled angle brackets ("<<" and ">>") may be used I<if and only if there is
 whitespace right after the opening delimiter and whitespace right
 before the closing delimiter!>  For example, the following will
 do the trick:
@@ -582,6 +581,12 @@
 
     C<$a E<lt>=E<gt> $b>
 
+The multiple-bracket form does not affect the interpretation of the contents of
+the formatting code, only how it must end.  That means that the examples above
+are also exactly the same as this:
+
+    C<< $a E<lt>=E<gt> $b >>
+
 As a further example, this means that if you wanted to put these bits of
 code in C<C> (code) style:
 
@@ -708,8 +713,8 @@
 Older translators might add wording around an LE<lt>E<gt> link, so that
 C<LE<lt>Foo::BarE<gt>> may become "the Foo::Bar manpage", for example.
 So you shouldn't write things like C<the LE<lt>fooE<gt>
-documentation>, if you want the translated document to read sensibly
--- instead write C<the LE<lt>Foo::Bar|Foo::BarE<gt> documentation> or
+documentation>, if you want the translated document to read sensibly.
+Instead, write C<the LE<lt>Foo::Bar|Foo::BarE<gt> documentation> or
 C<LE<lt>the Foo::Bar documentation|Foo::BarE<gt>>, to control how the
 link comes out.
 
Index: src/gnu/usr.bin/perl/pod/perlre.pod
diff -u src/gnu/usr.bin/perl/pod/perlre.pod:1.14 src/gnu/usr.bin/perl/pod/perlre.pod:1.15
--- pod/perlre.pod:1.14	Tue Oct 13 01:25:48 2009
+++ pod/perlre.pod	Fri Sep 24 15:07:04 2010
@@ -41,7 +41,7 @@
 Treat string as single line.  That is, change "." to match any character
 whatsoever, even a newline, which normally it would not match.
 
-Used together, as /ms, they let the "." match any character whatsoever,
+Used together, as C</ms>, they let the "." match any character whatsoever,
 while still allowing "^" and "$" to match, respectively, just after
 and just before newlines within the string.
 
@@ -62,7 +62,7 @@
 =item p
 X</p> X<regex, preserve> X<regexp, preserve>
 
-Preserve the string matched such that ${^PREMATCH}, {$^MATCH}, and
+Preserve the string matched such that ${^PREMATCH}, ${^MATCH}, and
 ${^POSTMATCH} are available for use after matching.
 
 =item g and c
@@ -82,20 +82,30 @@
 the C<(?...)> construct.  See below.
 
 The C</x> modifier itself needs a little more explanation.  It tells
-the regular expression parser to ignore whitespace that is neither
+the regular expression parser to ignore most whitespace that is neither
 backslashed nor within a character class.  You can use this to break up
 your regular expression into (slightly) more readable parts.  The C<#>
 character is also treated as a metacharacter introducing a comment,
 just as in ordinary Perl code.  This also means that if you want real
 whitespace or C<#> characters in the pattern (outside a character
 class, where they are unaffected by C</x>), then you'll either have to
-escape them (using backslashes or C<\Q...\E>) or encode them using octal
-or hex escapes.  Taken together, these features go a long way towards
+escape them (using backslashes or C<\Q...\E>) or encode them using octal,
+hex, or C<\N{}> escapes.  Taken together, these features go a long way towards
 making Perl's regular expressions more readable.  Note that you have to
 be careful not to include the pattern delimiter in the comment--perl has
 no way of knowing you did not intend to close the pattern early.  See
 the C-comment deletion code in L<perlop>.  Also note that anything inside
-a C<\Q...\E> stays unaffected by C</x>.
+a C<\Q...\E> stays unaffected by C</x>.  And note that C</x> doesn't affect
+whether space interpretation within a single multi-character construct.  For
+example in C<\x{...}>, regardless of the C</x> modifier, there can be no
+spaces.  Same for a L<quantifier|Quantifiers> such as C<{3}> or
+C<{5,}>.  Similarly, C<(?:...)> can't have a space between the C<?> and C<:>,
+but can between the C<(> and C<?>.  Within any delimiters for such a
+construct, allowed spaces are not affected by C</x>, and depend on the
+construct.  For example, C<\x{...}> can't have spaces because hexadecimal
+numbers don't have spaces in them.  But, Unicode properties can have spaces, so
+in C<\p{...}>  there can be spaces that follow the Unicode rules, for which see
+L<perluniprops.pod/Properties accessible through \p{} and \P{}>.
 X</x>
 
 =head2 Regular Expressions
@@ -156,7 +166,7 @@
 as a regular character.  In particular, the lower bound
 is not optional.)  The "*" quantifier is equivalent to C<{0,}>, the "+"
 quantifier to C<{1,}>, and the "?" quantifier to C<{0,1}>.  n and m are limited
-to integral values less than a preset limit defined when perl is built.
+to non-negative integral values less than a preset limit defined when perl is built.
 This is usually 32766 on the most common platforms.  The actual limit can
 be seen in the error message generated by code such as this:
 
@@ -213,7 +223,7 @@
 Because patterns are processed as double quoted strings, the following
 also work:
 X<\t> X<\r> X<\f> X<\e> X<\a> X<\l> X<\u> X<\L> X<\U> X<\E> X<\Q>
-X<\0> X<\c> X<\N> X<\x>
+X<\0> X<\c> X<\N{}> X<\x>
 
     \t		tab                   (HT, TAB)
     \n		newline               (LF, NL)
@@ -226,6 +236,7 @@
     \x{263a}	long hex char         (example: Unicode SMILEY)
     \cK		control char          (example: VT)
     \N{name}	named Unicode character
+    \N{U+263D}	Unicode character     (example: FIRST QUARTER MOON)
     \l		lowercase next char (think vi)
     \u		uppercase next char (think vi)
     \L		lowercase till \E (think vi)
@@ -245,9 +256,7 @@
 =head3 Character Classes and other Special Escapes
 
 In addition, Perl defines the following:
-X<\w> X<\W> X<\s> X<\S> X<\d> X<\D> X<\X> X<\p> X<\P> X<\C>
-X<\g> X<\k> X<\N> X<\K> X<\v> X<\V> X<\h> X<\H>
-X<word> X<whitespace> X<character class> X<backreference>
+X<\g> X<\k> X<\K> X<backreference>
 
     \w	     Match a "word" character (alphanumeric plus "_")
     \W	     Match a non-"word" character
@@ -257,8 +266,7 @@
     \D	     Match a non-digit character
     \pP	     Match P, named property.  Use \p{Prop} for longer names.
     \PP	     Match non-P
-    \X	     Match eXtended Unicode "combining character sequence",
-             equivalent to (?>\PM\pM*)
+    \X	     Match Unicode "eXtended grapheme cluster"
     \C	     Match a single C char (octet) even under Unicode.
 	     NOTE: breaks up characters into their UTF-8 bytes,
 	     so you may end up with malformed pieces of UTF-8.
@@ -271,35 +279,22 @@
     \g{name} Named backreference
     \k<name> Named backreference
     \K       Keep the stuff left of the \K, don't include it in $&
+    \N       Any character but \n (experimental)
     \v       Vertical whitespace
     \V       Not vertical whitespace
     \h       Horizontal whitespace
     \H       Not horizontal whitespace
     \R       Linebreak
 
-A C<\w> matches a single alphanumeric character (an alphabetic
-character, or a decimal digit) or C<_>, not a whole word.  Use C<\w+>
-to match a string of Perl-identifier characters (which isn't the same
-as matching an English word).  If C<use locale> is in effect, the list
-of alphabetic characters generated by C<\w> is taken from the current
-locale.  See L<perllocale>.  You may use C<\w>, C<\W>, C<\s>, C<\S>,
-C<\d>, and C<\D> within character classes, but they aren't usable
-as either end of a range. If any of them precedes or follows a "-",
-the "-" is understood literally. If Unicode is in effect, C<\s> matches
-also "\x{85}", "\x{2028}", and "\x{2029}". See L<perlunicode> for more
-details about C<\pP>, C<\PP>, C<\X> and the possibility of defining
-your own C<\p> and C<\P> properties, and L<perluniintro> about Unicode
-in general.
-X<\w> X<\W> X<word>
-
-C<\R> will atomically match a linebreak, including the network line-ending
-"\x0D\x0A".  Specifically, X<\R> is exactly equivalent to
-
-  (?>\x0D\x0A?|[\x0A-\x0C\x85\x{2028}\x{2029}])
-
-B<Note:> C<\R> has no special meaning inside of a character class;
-use C<\v> instead (vertical whitespace).
-X<\R>
+See L<perlrecharclass/Backslashed sequences> for details on
+C<\w>, C<\W>, C<\s>, C<\S>, C<\d>, C<\D>, C<\p>, C<\P>, C<\N>, C<\v>, C<\V>,
+C<\h>, and C<\H>.
+See L<perlrebackslash/Misc> for details on C<\R> and C<\X>.
+
+Note that C<\N> has two meanings.  When of the form C<\N{NAME}>, it matches the
+character whose name is C<NAME>; and similarly when of the form
+C<\N{U+I<wide hex char>}>, it matches the character whose Unicode ordinal is
+I<wide hex char>.  Otherwise it matches any character but C<\n>.
 
 The POSIX character class syntax
 X<character class>
@@ -315,172 +310,33 @@
     # this is not, and will generate a warning:
     $string =~ /[:alpha:]/;
 
-The available classes and their backslash equivalents (if available) are
-as follows:
-X<character class>
-X<alpha> X<alnum> X<ascii> X<blank> X<cntrl> X<digit> X<graph>
-X<lower> X<print> X<punct> X<space> X<upper> X<word> X<xdigit>
-
-    alpha
-    alnum
-    ascii
-    blank		[1]
-    cntrl
-    digit       \d
-    graph
-    lower
-    print
-    punct
-    space       \s	[2]
-    upper
-    word        \w	[3]
-    xdigit
-
-=over
-
-=item [1]
-
-A GNU extension equivalent to C<[ \t]>, "all horizontal whitespace".
-
-=item [2]
-
-Not exactly equivalent to C<\s> since the C<[[:space:]]> includes
-also the (very rare) "vertical tabulator", "\cK" or chr(11) in ASCII.
-
-=item [3]
-
-A Perl extension, see above.
-
-=back
-
-For example use C<[:upper:]> to match all the uppercase characters.
-Note that the C<[]> are part of the C<[::]> construct, not part of the
-whole character class.  For example:
-
-    [01[:alpha:]%]
-
-matches zero, one, any alphabetic character, and the percent sign.
-
-The following equivalences to Unicode \p{} constructs and equivalent
-backslash character classes (if available), will hold:
-X<character class> X<\p> X<\p{}>
-
-    [[:...:]]	\p{...}		backslash
-
-    alpha       IsAlpha
-    alnum       IsAlnum
-    ascii       IsASCII
-    blank
-    cntrl       IsCntrl
-    digit       IsDigit        \d
-    graph       IsGraph
-    lower       IsLower
-    print       IsPrint		(but see [2] below)
-    punct       IsPunct		(but see [3] below)
-    space       IsSpace
-                IsSpacePerl    \s
-    upper       IsUpper
-    word        IsWord         \w
-    xdigit      IsXDigit
-
-For example C<[[:lower:]]> and C<\p{IsLower}> are equivalent.
-
-However, the equivalence between C<[[:xxxxx:]]> and C<\p{IsXxxxx}>
-is not exact.
-
-=over 4
-
-=item [1]
-
-If the C<utf8> pragma is not used but the C<locale> pragma is, the
-classes correlate with the usual isalpha(3) interface (except for
-"word" and "blank").
-
-But if the C<locale> or C<encoding> pragmas are not used and
-the string is not C<utf8>, then C<[[:xxxxx:]]> (and C<\w>, etc.)
-will not match characters 0x80-0xff; whereas C<\p{IsXxxxx}> will
-force the string to C<utf8> and can match these characters
-(as Unicode).
-
-=item [2]
-
-C<\p{IsPrint}> matches characters 0x09-0x0d but C<[[:print:]]> does not.
-
-=item [3]
-
-C<[[:punct::]]> matches the following but C<\p{IsPunct}> does not,
-because they are classed as symbols (not punctuation) in Unicode.
-
-=over 4
-
-=item C<$>
-
-Currency symbol
-
-=item C<+> C<< < >> C<=> C<< > >> C<|> C<~>
-
-Mathematical symbols
-
-=item C<^> C<`>
-
-Modifier symbols (accents)
-
-=back
-
-=back
-
-The other named classes are:
-
-=over 4
-
-=item cntrl
-X<cntrl>
-
-Any control character.  Usually characters that don't produce output as
-such but instead control the terminal somehow: for example newline and
-backspace are control characters.  All characters with ord() less than
-32 are usually classified as control characters (assuming ASCII,
-the ISO Latin character sets, and Unicode), as is the character with
-the ord() value of 127 (C<DEL>).
-
-=item graph
-X<graph>
-
-Any alphanumeric or punctuation (special) character.
+The following Posix-style character classes are available:
 
-=item print
-X<print>
-
-Any alphanumeric or punctuation (special) character or the space character.
-
-=item punct
-X<punct>
-
-Any punctuation (special) character.
-
-=item xdigit
-X<xdigit>
-
-Any hexadecimal digit.  Though this may feel silly ([0-9A-Fa-f] would
-work just fine) it is included for completeness.
-
-=back
+ [[:alpha:]]  Any alphabetical character.
+ [[:alnum:]]  Any alphanumerical character.
+ [[:ascii:]]  Any character in the ASCII character set.
+ [[:blank:]]  A GNU extension, equal to a space or a horizontal tab
+ [[:cntrl:]]  Any control character.
+ [[:digit:]]  Any decimal digit, equivalent to "\d".
+ [[:graph:]]  Any printable character, excluding a space.
+ [[:lower:]]  Any lowercase character.
+ [[:print:]]  Any printable character, including a space.
+ [[:punct:]]  Any graphical character excluding "word" characters.
+ [[:space:]]  Any whitespace character. "\s" plus vertical tab ("\cK").
+ [[:upper:]]  Any uppercase character.
+ [[:word:]]   A Perl extension, equivalent to "\w".
+ [[:xdigit:]] Any hexadecimal digit.
 
 You can negate the [::] character classes by prefixing the class name
-with a '^'. This is a Perl extension.  For example:
-X<character class, negation>
-
-    POSIX         traditional  Unicode
+with a '^'. This is a Perl extension.
 
-    [[:^digit:]]    \D         \P{IsDigit}
-    [[:^space:]]    \S         \P{IsSpace}
-    [[:^word:]]	    \W         \P{IsWord}
-
-Perl respects the POSIX standard in that POSIX character classes are
-only supported within a character class.  The POSIX character classes
+The POSIX character classes
 [.cc.] and [=cc=] are recognized but B<not> supported and trying to
 use them will cause an error.
 
+Details on POSIX character classes are in
+L<perlrecharclass/Posix Character Classes>.
+
 =head3 Assertions
 
 Perl defines the following zero-width assertions:
@@ -558,6 +414,9 @@
 backreference only if at least 11 left parentheses have opened
 before it.  And so on.  \1 through \9 are always interpreted as
 backreferences.
+If the bracketing group did not match, the associated backreference won't
+match either. (This can happen if the bracketing group is optional, or
+in a different branch of an alternation.)
 
 X<\g{1}> X<\g{-1}> X<\g{name}> X<relative backreference> X<named backreference>
 In order to provide a safer and easier way to construct patterns using
@@ -744,6 +603,10 @@
 repetition of the previous word, assuming the C</x> modifier, and no C</i>
 modifier outside this group.
 
+These modifiers do not carry over into named subpatterns called in the
+enclosing group. In other words, a pattern such as C<((?i)(&NAME))> does not
+change the case-sensitivity of the "NAME" pattern.
+
 Note that the C<p> modifier is special in that it can only be enabled,
 not disabled, and that its presence anywhere in a pattern has a global
 effect. Thus C<(?-p)> and C<(?-p:...)> are meaningless and will warn
@@ -801,8 +664,24 @@
     / ( a )  (?| x ( y ) z | (p (q) r) | (t) u (v) ) ( z ) /x
     # 1            2         2  3        2     3     4  
 
-Note: as of Perl 5.10.0, branch resets interfere with the contents of
-the C<%+> hash, that holds named captures. Consider using C<%-> instead.
+Be careful when using the branch reset pattern in combination with 
+named captures. Named captures are implemented as being aliases to 
+numbered buffers holding the captures, and that interferes with the
+implementation of the branch reset pattern. If you are using named
+captures in a branch reset pattern, it's best to use the same names,
+in the same order, in each of the alternations:
+
+   /(?|  (?<a> x ) (?<b> y )
+      |  (?<a> z ) (?<b> w )) /x
+
+Not doing so may lead to surprises:
+
+  "12" =~ /(?| (?<a> \d+ ) | (?<b> \D+))/x;
+  say $+ {a};   # Prints '12'
+  say $+ {b};   # *Also* prints '12'.
+
+The problem here is that both the buffer named C<< a >> and the buffer
+named C<< b >> are aliases for the buffer belonging to C<< $1 >>.
 
 =item Look-Around Assertions
 X<look-around assertion> X<lookaround assertion> X<look-around> X<lookaround>
@@ -983,13 +862,6 @@
 value of C<$^R> is restored if the assertion is backtracked; compare
 L<"Backtracking">.
 
-Due to an unfortunate implementation issue, the Perl code contained in these
-blocks is treated as a compile time closure that can have seemingly bizarre
-consequences when used with lexically scoped variables inside of subroutines
-or loops.  There are various workarounds for this, including simply using
-global variables instead.  If you are using this construct and strange results
-occur then check for the use of lexically scoped variables.
-
 For reasons of security, this construct is forbidden if the regular
 expression involves run-time interpolation of variables, unless the
 perilous C<use re 'eval'> pragma has been used (see L<re>), or the
@@ -1011,9 +883,15 @@
 Better yet, use the carefully constrained evaluation within a Safe
 compartment.  See L<perlsec> for details about both these mechanisms.
 
-Because Perl's regex engine is currently not re-entrant, interpolated
-code may not invoke the regex engine either directly with C<m//> or C<s///>),
-or indirectly with functions such as C<split>.
+B<WARNING>: Use of lexical (C<my>) variables in these blocks is
+broken. The result is unpredictable and will make perl unstable. The
+workaround is to use global (C<our>) variables.
+
+B<WARNING>: Because Perl's regex engine is currently not re-entrant,
+interpolated code may not invoke the regex engine either directly with
+C<m//> or C<s///>), or indirectly with functions such as
+C<split>. Invoking the regex engine in these blocks will make perl
+unstable.
 
 =item C<(??{ code })>
 X<(??{})>
@@ -1055,6 +933,12 @@
 See also C<(?PARNO)> for a different, more efficient way to accomplish
 the same task.
 
+For reasons of security, this construct is forbidden if the regular
+expression involves run-time interpolation of variables, unless the
+perilous C<use re 'eval'> pragma has been used (see L<re>), or the
+variables contain results of C<qr//> operator (see
+L<perlop/"qr/STRING/imosx">).
+
 Because perl's regex engine is not currently re-entrant, delayed
 code may not invoke the regex engine either directly with C<m//> or C<s///>),
 or indirectly with functions such as C<split>.
@@ -1364,7 +1248,7 @@
 forbidden.
 
 Any pattern containing a special backtracking verb that allows an argument
-has the special behaviour that when executed it sets the current packages'
+has the special behaviour that when executed it sets the current package's
 C<$REGERROR> and C<$REGMARK> variables. When doing so the following
 rules apply:
 
@@ -1485,8 +1369,7 @@
 when a certain part of the pattern has been successfully matched. This
 mark may be given a name. A later C<(*SKIP)> pattern will then skip
 forward to that point if backtracked into on failure. Any number of
-C<(*MARK)> patterns are allowed, and the NAME portion is optional and may
-be duplicated.
+C<(*MARK)> patterns are allowed, and the NAME portion may be duplicated.
 
 In addition to interacting with the C<(*SKIP)> pattern, C<(*MARK:NAME)>
 can be used to "label" a pattern branch, so that after matching, the
@@ -2169,6 +2052,17 @@
 =back
 
 =head1 BUGS
+
+There are numerous problems with case insensitive matching of characters
+outside the ASCII range, especially with those whose folds are multiple
+characters, such as ligatures like C<LATIN SMALL LIGATURE FF>.
+
+In a bracketed character class with case insensitive matching, ranges only work
+for ASCII characters.  For example,
+C<m/[\N{CYRILLIC CAPITAL LETTER A}-\N{CYRILLIC CAPITAL LETTER YA}]/i>
+doesn't match all the Russian upper and lower case letters.
+
+Many regular expression constructs don't work on EBCDIC platforms.
 
 This document varies from difficult to understand to completely
 and utterly opaque.  The wandering prose riddled with jargon is
Index: src/gnu/usr.bin/perl/pod/perlrun.pod
diff -u src/gnu/usr.bin/perl/pod/perlrun.pod:1.13 src/gnu/usr.bin/perl/pod/perlrun.pod:1.14
--- pod/perlrun.pod:1.13	Mon Oct 12 18:24:47 2009
+++ pod/perlrun.pod	Fri Sep 24 15:07:04 2010
@@ -10,7 +10,6 @@
 	S<[ B<-pna> ] [ B<-F>I<pattern> ] [ B<-l>[I<octal>] ] [ B<-0>[I<octal/hexadecimal>] ]>
 	S<[ B<-I>I<dir> ] [ B<-m>[B<->]I<module> ] [ B<-M>[B<->]I<'module...'> ] [ B<-f> ]>
 	S<[ B<-C [I<number/list>] >]>
-	S<[ B<-P> ]>
 	S<[ B<-S> ]>
 	S<[ B<-x>[I<dir>] ]>
 	S<[ B<-i>[I<extension>] ]>
@@ -140,13 +139,6 @@
 this means you can no longer tell the difference between an executable
 Perl program and a Perl library file.
 
-=item Macintosh
-
-Under "Classic" MacOS, a perl program will have the appropriate Creator and
-Type, so that double-clicking them will invoke the MacPerl application.
-Under Mac OS X, clickable apps can be made from any C<#!> script using Wil
-Sanchez' DropScript utility: http://www.wsanchez.net/software/ .
-
 =item VMS
 
 Put
@@ -182,10 +174,6 @@
     # MS-DOS, etc.
     perl -e "print \"Hello world\n\""
 
-    # Macintosh
-    print "Hello world\n"
-     (then Run "Myscript" or Shift-Command-R)
-
     # VMS
     perl -e "print ""Hello world\n"""
 
@@ -199,11 +187,6 @@
 when nobody was looking, but just try to find documentation for its
 quoting rules.
 
-Under the Macintosh, it depends which environment you are using.  The MacPerl
-shell, or MPW, is much like Unix shells in its support for several
-quoting variants, except that it makes free use of the Macintosh's non-ASCII
-characters as control characters.
-
 There is no general solution to all of this.  It's just a mess.
 
 =head2 Location of Perl
@@ -252,11 +235,13 @@
     find . -name '*.orig' -print0 | perl -n0e unlink
 
 The special value 00 will cause Perl to slurp files in paragraph mode.
-The value 0777 will cause Perl to slurp files whole because there is no
-legal byte with that value.
+Any value 0400 or above will cause Perl to slurp files whole, but by convention
+the value 0777 is the one normally used for this purpose.
 
-If you want to specify any Unicode character, use the hexadecimal
-format: C<-0xHHH...>, where the C<H> are valid hexadecimal digits.
+You can also specify the separator character using hexadecimal notation:
+C<-0xHHH...>, where the C<H> are valid hexadecimal digits.  Unlike the octal
+form, this one may be used to specify any Unicode character, even those beyond
+0xFF.
 (This means that you cannot use the C<-x> with a directory name that
 consists of hexadecimal digits.)
 
@@ -333,7 +318,7 @@
 disable all the above Unicode features.
 
 The read-only magic variable C<${^UNICODE}> reflects the numeric value
-of this setting.  This is variable is set during Perl startup and is
+of this setting.  This variable is set during Perl startup and is
 thereafter read-only.  If you want runtime effects, use the three-arg
 open() (see L<perlfunc/open>), the two-arg binmode() (see L<perlfunc/binmode>),
 and the C<open> pragma (see L<open>).
@@ -401,7 +386,7 @@
         8  t  Trace execution
        16  o  Method and overloading resolution
        32  c  String/numeric conversions
-       64  P  Print profiling info, preprocessor command for -P, source file input state
+       64  P  Print profiling info, source file input state
       128  m  Memory and SV allocation
       256  f  Format processing
       512  r  Regular expression parsing and execution
@@ -411,7 +396,6 @@
      8192  H  Hash dump -- usurps values()
     16384  X  Scratchpad allocation
     32768  D  Cleaning up
-    65536  S  Thread synchronization
    131072  T  Tokenising
    262144  R  Include reference counts of dumped variables (eg when using -Ds)
    524288  J  Do not s,t,P-debug (Jump over) opcodes within package DB
@@ -419,6 +403,8 @@
   2097152  C  Copy On Write
   4194304  A  Consistency checks on internal structures
   8388608  q  quiet - currently only suppresses the "EXECUTING" message
+ 16777216  M  trace smart match resolution
+ 33554432  B  dump suBroutine definitions, including special Blocks like BEGIN
 
 All these flags require B<-DDEBUGGING> when you compile the Perl
 executable (but see L<Devel::Peek>, L<re> which may change this).
@@ -456,7 +442,7 @@
 optional features (in the main compilation unit). See L<feature>.
 
 =item B<-f>
-X<-f>
+X<-f> X<sitecustomize> X<sitecustomize.pl>
 
 Disable executing F<$Config{sitelib}/sitecustomize.pl> at startup.
 
@@ -466,6 +452,28 @@
 It can for instance be used to add entries to the @INC array to make perl
 find modules in non-standard locations.
 
+Perl actually inserts the following code:
+
+    BEGIN {
+        do { local $!; -f "$Config{sitelib}/sitecustomize.pl"; }
+            && do "$Config{sitelib}/sitecustomize.pl";
+    }
+
+Since it is an actual C<do> (not a C<require>), F<sitecustomize.pl>
+doesn't need to return a true value. The code is run in package C<main>,
+in its own lexical scope. However, if the script dies, C<$@> will not
+be set.
+
+The value of C<$Config{sitelib}> is also determined in C code and not
+read from C<Config.pm>, which is not loaded.
+
+The code is executed B<very> early. For example, any changes made to
+C<@INC> will show up in the output of `perl -V`. Of course, C<END>
+blocks will be likewise executed very late.
+
+To determine at runtime if this capability has been compiled in your
+perl, you can check the value of C<$Config{usesitecustomize}>.
+
 =item B<-F>I<pattern>
 X<-F>
 
@@ -582,7 +590,7 @@
     $ perl -pi~ -e 's/foo/bar/' file1 file2 file3...
 
 Note that because B<-i> renames or deletes the original file before
-creating a new file of the same name, UNIX-style soft and hard links will
+creating a new file of the same name, Unix-style soft and hard links will
 not be preserved.
 
 Finally, the B<-i> switch does not impede execution when no
@@ -594,9 +602,7 @@
 X<-I> X<@INC>
 
 Directories specified by B<-I> are prepended to the search path for
-modules (C<@INC>), and also tells the C preprocessor where to search for
-include files.  The C preprocessor is invoked with B<-P>; by default it
-searches /usr/include and /usr/lib/perl.
+modules (C<@INC>).
 
 =item B<-l>[I<octnum>]
 X<-l> X<$/> X<$\>
@@ -705,73 +711,6 @@
 C<BEGIN> and C<END> blocks may be used to capture control before or after
 the implicit loop, just as in B<awk>.
 
-=item B<-P>
-X<-P>
-
-B<NOTE: Use of -P is strongly discouraged because of its inherent
-problems, including poor portability. It is deprecated and will be
-removed in a future version of Perl.>
-
-This option causes your program to be run through the C preprocessor before
-compilation by Perl.  Because both comments and B<cpp> directives begin
-with the # character, you should avoid starting comments with any words
-recognized by the C preprocessor such as C<"if">, C<"else">, or C<"define">.
-
-If you're considering using C<-P>, you might also want to look at the
-Filter::cpp module from CPAN.
-
-The problems of -P include, but are not limited to:
-
-=over 10
-
-=item *
-
-The C<#!> line is stripped, so any switches there don't apply.
-
-=item *
-
-A C<-P> on a C<#!> line doesn't work.
-
-=item *
-
-B<All> lines that begin with (whitespace and) a C<#> but
-do not look like cpp commands, are stripped, including anything
-inside Perl strings, regular expressions, and here-docs .
-
-=item *
-
-In some platforms the C preprocessor knows too much: it knows about
-the C++ -style until-end-of-line comments starting with C<"//">.
-This will cause problems with common Perl constructs like
-
-    s/foo//;
-
-because after -P this will became illegal code
-
-    s/foo
-
-The workaround is to use some other quoting separator than C<"/">,
-like for example C<"!">:
-
-    s!foo!!;
-
-
-
-=item *
-
-It requires not only a working C preprocessor but also a working
-F<sed>.  If not on UNIX, you are probably out of luck on this.
-
-=item *
-
-Script line numbers are not preserved.
-
-=item *
-
-The C<-x> does not work with C<-P>.
-
-=back
-
 =item B<-s>
 X<-s>
 
@@ -1031,7 +970,7 @@
 being done at interpreter startup time.)
 
 If PERL5LIB is not defined, PERLLIB is used.  Directories are separated
-(like in PATH) by a colon on unixish platforms and by a semicolon on
+(like in PATH) by a colon on Unixish platforms and by a semicolon on
 Windows (the proper path separator being given by the command C<perl
 -V:path_sep>).
 
@@ -1045,7 +984,7 @@
 X<PERL5OPT>
 
 Command-line options (switches).  Switches in this variable are taken
-as if they were on every Perl command line.  Only the B<-[CDIMUdmtw]>
+as if they were on every Perl command line.  Only the B<-[CDIMUdmtwW]>
 switches are allowed.  When running taint checks (because the program
 was running setuid or setgid, or the B<-T> switch was used), this
 variable is ignored.  If PERL5OPT begins with B<-T>, tainting will be
@@ -1063,7 +1002,7 @@
 environment variable) treats the colon as a separator.
 
 An unset or empty PERLIO is equivalent to the default set of layers for
-your platform, for example C<:unix:perlio> on UNIX-like systems
+your platform, for example C<:unix:perlio> on Unix-like systems
 and C<:unix:crlf> on Windows and other DOS-like systems.
 
 The list becomes the default for I<all> perl's IO. Consequently only built-in
@@ -1157,7 +1096,7 @@
 
 On all platforms the default set of layers should give acceptable results.
 
-For UNIX platforms that will equivalent of "unix perlio" or "stdio".
+For Unix platforms that will equivalent of "unix perlio" or "stdio".
 Configure is setup to prefer "stdio" implementation if system's library
 provides for fast access to the buffer, otherwise it uses the "unix perlio"
 implementation.
@@ -1182,7 +1121,7 @@
 
 If set to the name of a file or device then certain operations of PerlIO
 sub-system will be logged to that file (opened as append). Typical uses
-are UNIX:
+are Unix:
 
    PERLIO_DEBUG=/dev/tty perl script ...
 
@@ -1330,6 +1269,21 @@
 B<Do not disclose the hash seed> to people who don't need to know it.
 See also hash_seed() of L<Hash::Util>.
 
+=item PERL_MEM_LOG
+X<PERL_MEM_LOG>
+
+If your perl was configured with C<-Accflags=-DPERL_MEM_LOG>, setting
+the environment variable C<PERL_MEM_LOG> enables logging debug
+messages. The value has the form C<< <number>[m][s][t] >>, where
+C<number> is the filedescriptor number you want to write to (2 is
+default), and the combination of letters specifies that you want
+information about (m)emory and/or (s)v, optionally with
+(t)imestamps. For example C<PERL_MEM_LOG=1mst> will log all
+information to stdout. You can write to other opened filedescriptors
+too, in a variety of ways;
+
+  bash$ 3>foo3 PERL_MEM_LOG=3m perl ...
+
 =item PERL_ROOT (specific to the VMS port)
 X<PERL_ROOT>
 
@@ -1351,7 +1305,7 @@
 X<PERL_UNICODE>
 
 Equivalent to the B<-C> command-line switch.  Note that this is not
-a boolean variable-- setting this to C<"1"> is not the right way to
+a boolean variable. Setting this to C<"1"> is not the right way to
 "enable Unicode" (whatever that would mean).  You can use C<"0"> to
 "disable Unicode", though (or alternatively unset PERL_UNICODE in
 your shell before starting Perl).  See the description of the C<-C>
Index: src/gnu/usr.bin/perl/pod/perlsec.pod
diff -u src/gnu/usr.bin/perl/pod/perlsec.pod:1.12 src/gnu/usr.bin/perl/pod/perlsec.pod:1.13
--- pod/perlsec.pod:1.12	Mon Oct 12 18:24:47 2009
+++ pod/perlsec.pod	Fri Sep 24 15:07:04 2010
@@ -346,10 +346,15 @@
 This is quite different, however, from not even trusting the writer of the
 code not to try to do something evil.  That's the kind of trust needed
 when someone hands you a program you've never seen before and says, "Here,
-run this."  For that kind of safety, check out the Safe module,
-included standard in the Perl distribution.  This module allows the
+run this."  For that kind of safety, you might want to check out the Safe
+module, included standard in the Perl distribution.  This module allows the
 programmer to set up special compartments in which all system operations
-are trapped and namespace access is carefully controlled.
+are trapped and namespace access is carefully controlled.  Safe should
+not be considered bullet-proof, though: it will not prevent the foreign
+code to set up infinite loops, allocate gigabytes of memory, or even
+abusing perl bugs to make the host interpreter crash or behave in
+unpredictable ways. In any case it's better avoided completely if you're
+really concerned about security.
 
 =head2 Security Bugs
 
@@ -364,17 +369,9 @@
 Fortunately, sometimes this kernel "feature" can be disabled.
 Unfortunately, there are two ways to disable it.  The system can simply
 outlaw scripts with any set-id bit set, which doesn't help much.
-Alternately, it can simply ignore the set-id bits on scripts.  If the
-latter is true, Perl can emulate the setuid and setgid mechanism when it
-notices the otherwise useless setuid/gid bits on Perl scripts.  It does
-this via a special executable called F<suidperl> that is automatically
-invoked for you if it's needed.
-
-B<The use of suidperl is considered deprecated>, and will be removed
-in Perl 5.12.0.  It is I<strongly> recommended that all code uses
-the simplier and more secure C-wrappers described below.
+Alternately, it can simply ignore the set-id bits on scripts.
 
-If the kernel set-id script feature isn't disabled, Perl will
+However, if the kernel set-id script feature isn't disabled, Perl will
 complain loudly that your set-id script is insecure.  You'll need to
 either disable the kernel set-id script feature, or put a C wrapper around
 the script.  A C wrapper is just a compiled program that does nothing
@@ -402,10 +399,6 @@
 program that builds Perl tries to figure this out for itself, so you
 should never have to specify this yourself.  Most modern releases of
 SysVr4 and BSD 4.4 use this approach to avoid the kernel race condition.
-
-Prior to release 5.6.1 of Perl, bugs in the code of F<suidperl> could
-introduce a security hole.  The use of F<suidperl> is considered
-deprecated, and will be removed in Perl 5.12.0.
 
 =head2 Protecting Your Programs
 
Index: src/gnu/usr.bin/perl/pod/perlsub.pod
diff -u src/gnu/usr.bin/perl/pod/perlsub.pod:1.13 src/gnu/usr.bin/perl/pod/perlsub.pod:1.14
--- pod/perlsub.pod:1.13	Mon Oct 12 18:24:47 2009
+++ pod/perlsub.pod	Fri Sep 24 15:07:04 2010
@@ -535,6 +535,7 @@
     local @oof = @bar;		# make @oof dynamic, and init it
 
     local $hash{key} = "val";	# sets a local value for this hash entry
+    delete local $hash{key};    # delete this entry for the current block
     local ($cond ? $v1 : $v2);	# several types of lvalues support
 				# localization
 
@@ -691,6 +692,55 @@
 
 The behavior of local() on non-existent members of composite
 types is subject to change in future.
+
+=head3 Localized deletion of elements of composite types
+X<delete> X<local, composite type element> X<local, array element> X<local, hash element>
+
+You can use the C<delete local $array[$idx]> and C<delete local $hash{key}>
+constructs to delete a composite type entry for the current block and restore
+it when it ends. They return the array/hash value before the localization,
+which means that they are respectively equivalent to
+
+    do {
+        my $val = $array[$idx];
+        local  $array[$idx];
+        delete $array[$idx];
+        $val
+    }
+
+and
+
+    do {
+        my $val = $hash{key};
+        local  $hash{key};
+        delete $hash{key};
+        $val
+    }
+
+except that for those the C<local> is scoped to the C<do> block. Slices are
+also accepted.
+
+    my %hash = (
+     a => [ 7, 8, 9 ],
+     b => 1,
+    )
+
+    {
+     my $a = delete local $hash{a};
+     # $a is [ 7, 8, 9 ]
+     # %hash is (b => 1)
+
+     {
+      my @nums = delete local @$a[0, 2]
+      # @nums is (7, 9)
+      # $a is [ undef, 8 ]
+
+      $a[0] = 999; # will be erased when the scope ends
+     }
+     # $a is back to [ 7, 8, 9 ]
+
+    }
+    # %hash is back to its original state
 
 =head2 Lvalue subroutines
 X<lvalue> X<subroutine, lvalue>
Index: src/gnu/usr.bin/perl/pod/perlsyn.pod
diff -u src/gnu/usr.bin/perl/pod/perlsyn.pod:1.10 src/gnu/usr.bin/perl/pod/perlsyn.pod:1.11
--- pod/perlsyn.pod:1.10	Mon Oct 12 18:24:47 2009
+++ pod/perlsyn.pod	Fri Sep 24 15:07:04 2010
@@ -117,7 +117,7 @@
 
 =head2 Statement Modifiers
 X<statement modifier> X<modifier> X<if> X<unless> X<while>
-X<until> X<foreach> X<for>
+X<until> X<when> X<foreach> X<for>
 
 Any simple statement may optionally be followed by a I<SINGLE> modifier,
 just before the terminating semicolon (or block ending).  The possible
@@ -127,6 +127,8 @@
     unless EXPR
     while EXPR
     until EXPR
+    when EXPR
+    for LIST
     foreach LIST
 
 The C<EXPR> following the modifier is referred to as the "condition".
@@ -139,6 +141,22 @@
     print "Basset hounds got long ears" if length $ear >= 10;
     go_outside() and play() unless $is_raining;
 
+C<when> executes the statement I<when> C<$_> smart matches C<EXPR>, and
+then either C<break>s out if it's enclosed in a C<given> scope or skips
+to the C<next> element when it lies directly inside a C<for> loop.
+See also L</"Switch statements">.
+
+    given ($something) {
+        $abc    = 1 when /^abc/;
+        $just_a = 1 when /^a/;
+        $other  = 1;
+    }
+
+    for (@names) {
+	admin($_)   when [ qw/Alice Bob/ ];
+	regular($_) when [ qw/Chris David Ellen/ ];
+    }
+
 The C<foreach> modifier is an iterator: it executes the statement once
 for each item in the LIST (with C<$_> aliased to each item in turn).
 
@@ -210,6 +228,9 @@
     if (EXPR) BLOCK
     if (EXPR) BLOCK else BLOCK
     if (EXPR) BLOCK elsif (EXPR) BLOCK ... else BLOCK
+    unless (EXPR) BLOCK
+    unless (EXPR) BLOCK else BLOCK
+    unless (EXPR) BLOCK elsif (EXPR) BLOCK ... else BLOCK
     LABEL while (EXPR) BLOCK
     LABEL while (EXPR) BLOCK continue BLOCK
     LABEL until (EXPR) BLOCK
@@ -234,7 +255,11 @@
 The C<if> statement is straightforward.  Because BLOCKs are always
 bounded by curly brackets, there is never any ambiguity about which
 C<if> an C<else> goes with.  If you use C<unless> in place of C<if>,
-the sense of the test is reversed.
+the sense of the test is reversed. Like C<if>, C<unless> can be followed
+by C<else>. C<unless> can even be followed by one or more C<elsif>
+statements, though you may want to think twice before using that particular
+language construct, as everyone reading your code will have to think at least
+twice before they can understand what's going on.
 
 The C<while> statement executes the block as long as the expression is
 L<true|/"Truth and Falsehood">.
@@ -254,6 +279,14 @@
 increment a loop variable, even when the loop has been continued via
 the C<next> statement.
 
+Extension modules can also hook into the Perl parser to define new
+kinds of compound statement.  These are introduced by a keyword which
+the extension recognises, and the syntax following the keyword is
+defined entirely by the extension.  If you are an implementor, see
+L<perlapi/PL_keyword_plugin> for the mechanism.  If you are using such
+a module, see the module's documentation for details of the syntax that
+it defines.
+
 =head2 Loop Control
 X<loop control> X<loop, control> X<next> X<last> X<redo> X<continue>
 
@@ -653,7 +686,7 @@
     }
     print "\@array contains $count copies of 'foo'\n";
 
-On exit from the C<when> block, there is an implicit C<next>.
+At the end of all C<when> blocks, there is an implicit C<next>.
 You can override that with an explicit C<last> if you're only
 interested in the first match.
 
@@ -686,12 +719,12 @@
     Any     CodeRef   scalar sub truth          $b->($a)
 
     Hash    Hash      hash keys identical (every key is found in both hashes)
-    Array   Hash      hash slice existence     grep { exists $b->{$_} } @$a
+    Array   Hash      hash keys intersection   grep { exists $b->{$_} } @$a
     Regex   Hash      hash key grep            grep /$a/, keys %$b
     undef   Hash      always false (undef can't be a key)
     Any     Hash      hash entry existence     exists $b->{$a}
 
-    Hash    Array     hash slice existence     grep { exists $a->{$_} } @$b
+    Hash    Array     hash keys intersection   grep { exists $a->{$_} } @$b
     Array   Array     arrays are comparable[2]
     Regex   Array     array grep               grep /$a/, @$b
     undef   Array     array contains undef     grep !defined, @$b
@@ -739,7 +772,8 @@
 The Perl 5 smart match and C<given>/C<when> constructs are not
 absolutely identical to their Perl 6 analogues. The most visible
 difference is that, in Perl 5, parentheses are required around
-the argument to C<given()> and C<when()>. Parentheses in Perl 6
+the argument to C<given()> and C<when()> (except when this last
+one is used as a statement modifier). Parentheses in Perl 6
 are always optional in a control construct such as C<if()>,
 C<while()>, or C<when()>; they can't be made optional in Perl
 5 without a great deal of potential confusion, because Perl 5
Index: src/gnu/usr.bin/perl/pod/perlthrtut.pod
diff -u src/gnu/usr.bin/perl/pod/perlthrtut.pod:1.8 src/gnu/usr.bin/perl/pod/perlthrtut.pod:1.9
--- pod/perlthrtut.pod:1.8	Mon Oct 12 18:24:47 2009
+++ pod/perlthrtut.pod	Fri Sep 24 15:07:04 2010
@@ -109,7 +109,7 @@
 disappointed or confused.  Possibly both.
 
 This is not to say that Perl threads are completely different from
-everything that's ever come before -- they're not.  Perl's threading
+everything that's ever come before. They're not.  Perl's threading
 model owes a lot to other thread models, especially POSIX.  Just as
 Perl is not C, though, Perl threads are not POSIX threads.  So if you
 find yourself looking for mutexes, or thread priorities, it's time to
@@ -161,7 +161,7 @@
 
 =head2 Basic Thread Support
 
-Thread support is a Perl compile-time option -- it's something that's
+Thread support is a Perl compile-time option. It's something that's
 turned on or off when Perl is built at your site, rather than when
 your programs are compiled. If your Perl wasn't compiled with thread
 support enabled, then any attempt to use threads will fail.
@@ -275,7 +275,7 @@
 
 NOTE: In the example above, the thread returns a list, thus necessitating
 that the thread creation call be made in list context (i.e., C<my ($thr)>).
-See L<threads/"$thr->join()"> and L<threads/"THREAD CONTEXT"> for more
+See L<< threads/"$thr->join()" >> and L<threads/"THREAD CONTEXT"> for more
 details on thread context and return values.
 
 =head2 Ignoring A Thread
@@ -366,7 +366,7 @@
 is that by default, no data is shared. When a new Perl thread is created,
 all the data associated with the current thread is copied to the new
 thread, and is subsequently private to that new thread!
-This is similar in feel to what happens when a UNIX process forks,
+This is similar in feel to what happens when a Unix process forks,
 except that in this case, the data is just copied to a different part of
 memory within the same process rather than a real fork taking place.
 
@@ -739,7 +739,7 @@
 establishing quotas.  Say, for example, that you have a number of
 threads that can do I/O at once.  You don't want all the threads
 reading or writing at once though, since that can potentially swamp
-your I/O channels, or deplete your process' quota of filehandles.  You
+your I/O channels, or deplete your process's quota of filehandles.  You
 can use a semaphore initialized to the number of concurrent I/O
 requests (or open files) that you want at any one time, and have your
 threads quietly block and unblock themselves.
@@ -1003,7 +1003,7 @@
 thread creation can be quite expensive, both in terms of memory usage and
 time spent in creation. The ideal way to reduce these costs is to have a
 relatively short number of long-lived threads, all created fairly early
-on -- before the base thread has accumulated too much data. Of course, this
+on (before the base thread has accumulated too much data). Of course, this
 may not always be possible, so compromises have to be made. However, after
 a thread has been created, its performance and extra memory usage should
 be little different than ordinary code.
@@ -1030,7 +1030,7 @@
 
 Thinking of mixing C<fork()> and threads?  Please lie down and wait
 until the feeling passes.  Be aware that the semantics of C<fork()> vary
-between platforms.  For example, some UNIX systems copy all the current
+between platforms.  For example, some Unix systems copy all the current
 threads into the child process, while others only copy the thread that
 called C<fork()>. You have been warned!
 
@@ -1049,9 +1049,8 @@
 of Perl.  Calls often suffering from not being thread-safe include:
 C<localtime()>, C<gmtime()>,  functions fetching user, group and
 network information (such as C<getgrent()>, C<gethostent()>,
-C<getnetent()> and so on), C<readdir()>,
-C<rand()>, and C<srand()> -- in general, calls that depend on some global
-external state.
+C<getnetent()> and so on), C<readdir()>, C<rand()>, and C<srand()>. In
+general, calls that depend on some global external state.
 
 If the system Perl is compiled in has thread-safe variants of such
 calls, they will be used.  Beyond that, Perl is at the mercy of
@@ -1093,14 +1092,14 @@
 
 =head1 Bibliography
 
-Here's a short bibliography courtesy of Jrgen Christoffel:
+Here's a short bibliography courtesy of Jrgen Christoffel:
 
 =head2 Introductory Texts
 
 Birrell, Andrew D. An Introduction to Programming with
 Threads. Digital Equipment Corporation, 1989, DEC-SRC Research Report
 #35 online as
-http://gatekeeper.dec.com/pub/DEC/SRC/research-reports/abstracts/src-rr-035.html
+ftp://ftp.dec.com/pub/DEC/SRC/research-reports/SRC-035.pdf
 (highly recommended)
 
 Robbins, Kay. A., and Steven Robbins. Practical Unix Programming: A
@@ -1150,7 +1149,7 @@
 =head1 Acknowledgements
 
 Thanks (in no particular order) to Chaim Frenkel, Steve Fink, Gurusamy
-Sarathy, Ilya Zakharevich, Benjamin Sugars, Jrgen Christoffel, Joshua
+Sarathy, Ilya Zakharevich, Benjamin Sugars, Jrgen Christoffel, Joshua
 Pritikin, and Alan Burlison, for their help in reality-checking and
 polishing this article.  Big thanks to Tom Christiansen for his rewrite
 of the prime number generator.
@@ -1161,7 +1160,7 @@
 
 Slightly modified by Arthur Bergman to fit the new thread model/module.
 
-Reworked slightly by Jrg Walter E<lt>jwalt@cpan.org<gt> to be more concise
+Reworked slightly by Jrg Walter E<lt>jwalt@cpan.org<gt> to be more concise
 about thread-safety of Perl code.
 
 Rearranged slightly by Elizabeth Mattijsen E<lt>liz@dijkmat.nl<gt> to put
Index: src/gnu/usr.bin/perl/pod/perltie.pod
diff -u src/gnu/usr.bin/perl/pod/perltie.pod:1.13 src/gnu/usr.bin/perl/pod/perltie.pod:1.14
--- pod/perltie.pod:1.13	Mon Oct 12 18:24:47 2009
+++ pod/perltie.pod	Fri Sep 24 15:07:04 2010
@@ -134,8 +134,8 @@
 
 This method will be triggered every time the tied variable is set
 (assigned).  Beyond its self reference, it also expects one (and only one)
-argument--the new value the user is trying to assign. Don't worry about
-returning a value from STORE -- the semantic of assignment returning the
+argument: the new value the user is trying to assign. Don't worry about
+returning a value from STORE; the semantic of assignment returning the
 assigned value is implemented with FETCH.
 
     sub STORE {
@@ -952,6 +952,19 @@
 
     sub GETC { print "Don't GETC, Get Perl"; return "a"; }
 
+=item EOF this
+X<EOF>
+
+This method will be called when the C<eof> function is called.
+
+Starting with Perl 5.12, an additional integer parameter will be passed.  It
+will be zero if C<eof> is called without parameter; C<1> if C<eof> is given
+a filehandle as a parameter, e.g. C<eof(FH)>; and C<2> in the very special
+case that the tied filehandle is C<ARGV> and C<eof> is called with an empty
+parameter list, e.g. C<eof()>.
+
+    sub EOF { not length $stringbuf }
+
 =item CLOSE this
 X<CLOSE>
 
@@ -1065,7 +1078,7 @@
 So far so good.  Those of you who have been paying attention will have
 spotted that the tied object hasn't been used so far.  So lets add an
 extra method to the Remember class to allow comments to be included in
-the file -- say, something like this:
+the file; say, something like this:
 
     sub comment {
         my $self = shift;
Index: src/gnu/usr.bin/perl/pod/perltoot.pod
diff -u src/gnu/usr.bin/perl/pod/perltoot.pod:1.9 src/gnu/usr.bin/perl/pod/perltoot.pod:1.10
--- pod/perltoot.pod:1.9	Mon Sep 29 17:36:18 2008
+++ pod/perltoot.pod	Fri Sep 24 15:07:04 2010
@@ -797,7 +797,7 @@
 but the reference to this is stored on the object itself and all other
 methods access package data via that reference, so we should be ok.
 
-What do we mean by the Person::new() function -- isn't that actually
+What do we mean by the Person::new() function? Isn't that actually
 a method?  Well, in principle, yes.  A method is just a function that
 expects as its first argument a class name (package) or object
 (blessed reference).   Person::new() is the function that both the
Index: src/gnu/usr.bin/perl/pod/perlvar.pod
diff -u src/gnu/usr.bin/perl/pod/perlvar.pod:1.11 src/gnu/usr.bin/perl/pod/perlvar.pod:1.12
--- pod/perlvar.pod:1.11	Mon Oct 12 18:24:48 2009
+++ pod/perlvar.pod	Fri Sep 24 15:07:04 2010
@@ -214,11 +214,11 @@
 
 =over 8
 
-=item $<I<digits>>
+=item $<I<digits>> ($1, $2, ...)
 X<$1> X<$2> X<$3>
 
 Contains the subpattern from the corresponding set of capturing
-parentheses from the last pattern match, not counting patterns
+parentheses from the last successful pattern match, not counting patterns
 matched in nested blocks that have been exited already.  (Mnemonic:
 like \digits.)  These variables are all read-only and dynamically
 scoped to the current BLOCK.
@@ -1037,8 +1037,8 @@
 
 As of release 5 of Perl, assignment to C<$[> is treated as a compiler
 directive, and cannot influence the behavior of any other file.
-(That's why you can only assign compile-time constants to it.)
-Its use is highly discouraged.
+(That's why you can only assign compile-time constants to it.)  Its
+use is deprecated, and by default will trigger a warning.
 
 Note that, unlike other compile-time directives (such as L<strict>),
 assignment to C<$[> can be seen from outer lexical scopes in the same file.
@@ -1190,9 +1190,11 @@
 X<$^O> X<$OSNAME>
 
 The name of the operating system under which this copy of Perl was
-built, as determined during the configuration process.  The value
-is identical to C<$Config{'osname'}>.  See also L<Config> and the 
-B<-V> command-line switch documented in L<perlrun>.
+built, as determined during the configuration process. For examples
+see L<perlport/PLATFORMS>.
+
+The value is identical to C<$Config{'osname'}>.  See also L<Config>
+and the B<-V> command-line switch documented in L<perlrun>.
 
 In Windows platforms, $^O is not very helpful: since it is always
 C<MSWin32>, it doesn't tell the difference between
@@ -1321,7 +1323,7 @@
 
 =item ${^UTF8LOCALE}
 
-This variable indicates whether an UTF-8 locale was detected by perl at
+This variable indicates whether a UTF-8 locale was detected by perl at
 startup. This information is used by perl when it's in
 adjust-utf8ness-to-locale mode (as when run with the C<-CL> command-line
 switch); see L<perlrun> for more info on this.
@@ -1368,6 +1370,7 @@
 See the documentation of C<warnings> for more details.
 
 =item ${^WIN32_SLOPPY_STAT}
+X<sitecustomize> X<sitecustomize.pl>
 
 If this variable is set to a true value, then stat() on Windows will
 not try to open the file. This means that the link count cannot be
@@ -1377,7 +1380,8 @@
 
 This variable could be set in the F<sitecustomize.pl> file to
 configure the local Perl installation to use "sloppy" stat() by
-default.  See L<perlrun> for more information about site
+default.  See the documentation for B<-f> in
+L<perlrun|perlrun/"Command Switches"> for more information about site
 customization.
 
 =item $EXECUTABLE_NAME
@@ -1617,6 +1621,45 @@
 
 See L<perlfunc/die>, L<perlfunc/warn>, L<perlfunc/eval>, and
 L<warnings> for additional information.
+
+=back
+
+=head2 Names that are no longer special
+
+These variables had special meaning in prior versions of Perl but now
+have no effect and will cause warnings if used.  They are included
+here for historical reference.
+
+=over 8
+
+=item $#
+X<$#>
+
+C<$#> used to be a variable that could be used to format printed numbers.
+After a deprecation cycle, its magic was removed in Perl 5.10 and using it
+now triggers a warning: C<$# is no longer supported>.
+
+C<$#> is also used as sigil, which, when prepended on the name of an
+array, gives the index of the last element in that array.
+
+    my @array        = ("a", "b", "c");
+    my $last_index   = $#array;   # $last_index is 2
+
+    for my $i (0 .. $#array) {
+        print "The value of index $i is $array[$i]\n";
+    }
+
+Also see L<perldata>.
+
+=item $*
+X<$*>
+
+C<$*> used to be a variable that enabled multiline matching.
+After a deprecation cycle, its magic was removed in Perl 5.10.
+Using it now triggers a warning: C<$* is no longer supported>.
+Use the C</s> and C</m> regexp modifiers instead.
+
+Also see L<perlre>.
 
 =back
 
Index: src/gnu/usr.bin/perl/pod/perlxs.pod
diff -u src/gnu/usr.bin/perl/pod/perlxs.pod:1.11 src/gnu/usr.bin/perl/pod/perlxs.pod:1.12
--- pod/perlxs.pod:1.11	Mon Oct 12 18:24:48 2009
+++ pod/perlxs.pod	Fri Sep 24 15:07:04 2010
@@ -1945,7 +1945,7 @@
 
 =item typedef my_cxt_t
 
-This struct typedef I<must> always be called C<my_cxt_t> -- the other
+This struct typedef I<must> always be called C<my_cxt_t>. The other
 C<CXT*> macros assume the existence of the C<my_cxt_t> typedef name.
 
 Declare a typedef named C<my_cxt_t> that is a structure that contains
@@ -1964,7 +1964,7 @@
 
 The MY_CXT_INIT macro initialises storage for the C<my_cxt_t> struct.
 
-It I<must> be called exactly once -- typically in a BOOT: section. If you
+It I<must> be called exactly once, typically in a BOOT: section. If you
 are maintaining multiple interpreters, it should be called once in each
 interpreter instance, except for interpreters cloned from existing ones.
 (But see C<MY_CXT_CLONE> below.)
Index: src/gnu/usr.bin/perl/pod/perlxstut.pod
diff -u src/gnu/usr.bin/perl/pod/perlxstut.pod:1.13 src/gnu/usr.bin/perl/pod/perlxstut.pod:1.14
--- pod/perlxstut.pod:1.13	Tue Oct 13 01:25:48 2009
+++ pod/perlxstut.pod	Fri Sep 24 15:07:04 2010
@@ -865,7 +865,7 @@
 next to the variable name and away from the variable type), and place a
 "*" near the variable type, but away from the variable name (as in the
 call to foo above).  By doing so, it is easy to understand exactly what
-will be passed to the C function -- it will be whatever is in the "last
+will be passed to the C function; it will be whatever is in the "last
 column".
 
 You should take great pains to try to pass the function the type of variable
Index: src/gnu/usr.bin/perl/pod/pod2man.PL
diff -u src/gnu/usr.bin/perl/pod/pod2man.PL:1.10 src/gnu/usr.bin/perl/pod/pod2man.PL:1.11
--- pod/pod2man.PL:1.10	Mon Oct 12 18:24:48 2009
+++ pod/pod2man.PL	Fri Sep 24 15:07:05 2010
@@ -351,7 +351,8 @@
 Manual page indexers are often extremely picky about the format of this
 section, so don't put anything in it except this line.  A single dash, and
 only a single dash, should separate the list of programs or functions from
-the description.  Functions should not be qualified with C<()> or the like.
+the description.  Do not use any markup such as CE<lt>E<gt> or
+BE<lt>E<gt>.  Functions should not be qualified with C<()> or the like.
 The description should ideally fit on a single line, even if a man program
 replaces the dash with a few tabs.
 
Index: src/gnu/usr.bin/perl/pod/roffitall
diff -u src/gnu/usr.bin/perl/pod/roffitall:1.6 src/gnu/usr.bin/perl/pod/roffitall:1.7
--- pod/roffitall:1.6	Sun Oct 27 22:25:34 2002
+++ pod/roffitall	Fri Sep 24 15:07:05 2010
@@ -118,7 +118,6 @@
     $mandir/splain.1	\
     $mandir/xsubpp.1	\
 			\
-    $libdir/attrs.3	\
     $libdir/autouse.3	\
     $libdir/base.3	\
     $libdir/blib.3	\
Index: src/gnu/usr.bin/perl/qnx/ar
diff -u src/gnu/usr.bin/perl/qnx/ar:1.1 src/gnu/usr.bin/perl/qnx/ar:1.2
--- qnx/ar:1.1	Sun Nov 30 07:59:45 1997
+++ qnx/ar	Fri Sep 24 15:07:05 2010
@@ -12,8 +12,7 @@
 #This is a crude cover, but it has proved sufficient for many
 #ports. Rather than attempt to implement subtleties of the
 #ar syntax, I simply create a new library under all
-#circumstances. A much more thorough cover is available from
-#http://www.fdma.com/pub/qnx/porting/ar
+#circumstances.
 #
 #Note that Watcom 10.6 supports ar directly, so this
 #cover is not necessary.
Index: src/gnu/usr.bin/perl/t/TEST
diff -u src/gnu/usr.bin/perl/t/TEST:1.12 src/gnu/usr.bin/perl/t/TEST:1.13
--- t/TEST:1.12	Mon Oct 12 18:24:48 2009
+++ t/TEST	Fri Sep 24 15:07:05 2010
@@ -5,26 +5,125 @@
 # probably obsolete on the avoidance side, though still currrent
 # on the peculiarity side.)
 
+# t/TEST and t/harness need to share code. The logical way to do this would be
+# to have the common code in a file both require or use. However, t/TEST needs
+# to still work, to generate test results, even if require isn't working, so
+# we cannot do that. t/harness has no such restriction, so it is quite
+# acceptable to have it require t/TEST.
+
+# In which case, we need to stop t/TEST actually running tests, as all
+# t/harness needs are its subroutines.
+
+
+# directories with special sets of test switches
+my %dir_to_switch =
+    (base => '',
+     comp => '',
+     run => '',
+     '../ext/File-Glob/t' => '-I.. -MTestInit', # FIXME - tests assume t/
+     );
+
+# "not absolute" is the the default, as it saves some fakery within TestInit
+# which can peturb tests, and takes CPU. Working with the upstream author of
+# any of these, to figure out how to remove them from this list, considered
+# "a good thing".
+my %abs = (
+	   '../cpan/Archive-Extract' => 1,
+	   '../cpan/Archive-Tar' => 1,
+	   '../cpan/AutoLoader' => 1,
+	   '../cpan/CPAN' => 1,
+	   '../cpan/Class-ISA' => 1,
+	   '../cpan/Cwd' => 1,
+	   '../cpan/Devel-PPPort' => 1,
+	   '../cpan/Encode' => 1,
+	   '../cpan/ExtUtils-Command' => 1,
+	   '../cpan/ExtUtils-Constant' => 1,
+	   '../cpan/ExtUtils-MakeMaker' => 1,
+	   '../cpan/ExtUtils-Manifest' => 1,
+	   '../cpan/ExtUtils-ParseXS' => 1,
+	   '../cpan/File-Fetch' => 1,
+	   '../cpan/IPC-Cmd' => 1,
+	   '../cpan/IPC-SysV' => 1,
+	   '../cpan/Locale-Codes' => 1,
+	   '../cpan/Log-Message' => 1,
+	   '../cpan/Math-BigInt' => 1,
+	   '../cpan/Math-BigRat' => 1,
+	   '../cpan/Math-Complex' => 1,
+	   '../cpan/Module-Build' => 1,
+	   '../cpan/Module-Load' => 1,
+	   '../cpan/Module-Load-Conditional' => 1,
+	   '../cpan/Object-Accessor' => 1,
+	   '../cpan/Package-Constants' => 1,
+	   '../cpan/Parse-CPAN-Meta' => 1,
+	   '../cpan/Pod-Simple' => 1,
+	   '../cpan/Term-UI' => 1,
+	   '../cpan/Test-Simple' => 1,
+	   '../cpan/Tie-File' => 1,
+	   '../cpan/bignum' => 1,
+	   '../cpan/podlators' => 1,
+	   '../dist/ExtUtils-Install' => 1,
+	  );
+	      
+my %temp_no_core =
+    ('../cpan/B-Debug' => 1,
+     '../cpan/Compress-Raw-Bzip2' => 1,
+     '../cpan/Compress-Raw-Zlib' => 1,
+     '../cpan/Devel-PPPort' => 1,
+     '../cpan/Getopt-Long' => 1,
+     '../cpan/IO-Compress' => 1,
+     '../cpan/Math-BigInt' => 1,
+     '../cpan/Math-BigRat' => 1,
+     '../cpan/MIME-Base64' => 1,
+     '../cpan/NEXT' => 1,
+     '../cpan/parent' => 1,
+     '../cpan/Parse-CPAN-Meta' => 1,
+     '../cpan/Pod-Simple' => 1,
+     '../cpan/podlators' => 1,
+     '../cpan/Test-Simple' => 1,
+     '../cpan/Tie-RefHash' => 1,
+     '../cpan/Time-HiRes' => 1,
+     '../cpan/Unicode-Collate' => 1,
+     '../cpan/Unicode-Normalize' => 1,
+    );
+
+if ($::do_nothing) {
+    return 1;
+}
+
+# Location to put the Valgrind log.
+my $Valgrind_Log = 'current.valgrind';
+
 $| = 1;
 
 # for testing TEST only
-#BEGIN { require '../lib/strict.pm'; strict->import() };
-#BEGIN { require '../lib/warnings.pm'; warnings->import() };
+#BEGIN { require '../lib/strict.pm'; "strict"->import() };
+#BEGIN { require '../lib/warnings.pm'; "warnings"->import() };
 
-# Let tests know they're running in the perl core.  Useful for modules
-# which live dual lives on CPAN.
-$ENV{PERL_CORE} = 1;
-delete $ENV{PERL5LIB};
+# delete env vars that may influence the results
+# but allow override via *_TEST env var if wanted
+# (e.g. PERL5OPT_TEST=-d:NYTProf)
+for my $envname (qw(PERL5LIB PERLLIB PERL5OPT)) {
+    my $override = $ENV{"${envname}_TEST"};
+    if (defined $override) {
+	warn "$0: $envname=$override\n";
+	$ENV{$envname} = $override;
+    }
+    else {
+	delete $ENV{$envname};
+    }
+}
 
 # remove empty elements due to insertion of empty symbols via "''p1'" syntax
 @ARGV = grep($_,@ARGV) if $^O eq 'VMS';
 our $show_elapsed_time = $ENV{HARNESS_TIMER} || 0;
 
-# Cheesy version of Getopt::Std.  Maybe we should replace it with that.
+# Cheesy version of Getopt::Std.  We can't replace it with that, because we
+# can't rely on require working.
 {
     my @argv = ();
     foreach my $idx (0..$#ARGV) {
 	push( @argv, $ARGV[$idx] ), next unless $ARGV[$idx] =~ /^-(\S+)$/;
+	$::benchmark = 1 if $1 eq 'benchmark';
 	$::core    = 1 if $1 eq 'core';
 	$::verbose = 1 if $1 eq 'v';
 	$::torture = 1 if $1 eq 'torture';
@@ -41,6 +140,9 @@
 }
 
 chdir 't' if -f 't/TEST';
+if (-f 'TEST' && -f 'harness' && -d '../lib') {
+    @INC = '../lib';
+}
 
 die "You need to run \"make test\" first to set things up.\n"
   unless -e 'perl' or -e 'perl.exe' or -e 'perl.pm';
@@ -65,26 +167,196 @@
 
 $ENV{EMXSHELL} = 'sh';        # For OS/2
 
-# Roll your own File::Find!
-use TestInit;
-use File::Spec;
 if ($show_elapsed_time) { require Time::HiRes }
-my $curdir = File::Spec->curdir;
-my $updir  = File::Spec->updir;
 
+my %skip = (
+	    '.' => 1,
+	    '..' => 1,
+	    'CVS' => 1,
+	    'RCS' => 1,
+	    'SCCS' => 1,
+	    '.svn' => 1,
+	   );
+
+# Roll your own File::Find!
 sub _find_tests {
     my($dir) = @_;
     opendir DIR, $dir or die "Trouble opening $dir: $!";
     foreach my $f (sort { $a cmp $b } readdir DIR) {
-	next if $f eq $curdir or $f eq $updir or
-	    $f =~ /^(?:CVS|RCS|SCCS|\.svn)$/;
+	next if $skip{$f};
+
+	my $fullpath = "$dir/$f";
+
+	if (-d $fullpath) {
+	    _find_tests($fullpath);
+	} elsif ($f =~ /\.t$/) {
+	    push @ARGV, $fullpath;
+	}
+    }
+}
+
+
+# Scan the text of the test program to find switches and special options
+# we might need to apply.
+sub _scan_test {
+    my($test, $type) = @_;
+
+    open(my $script, "<", $test) or die "Can't read $test.\n";
+    my $first_line = <$script>;
+
+    $first_line =~ tr/\0//d if $::with_utf16;
+
+    my $switch = "";
+    if ($first_line =~ /#!.*\bperl.*\s-\w*([tT])/) {
+        $switch = "-$1";
+    } else {
+        if ($::taintwarn) {
+            # not all tests are expected to pass with this option
+            $switch = '-t';
+        } else {
+            $switch = '';
+        }
+    }
+
+    my $file_opts = "";
+    if ($type eq 'deparse') {
+        # Look for #line directives which change the filename
+        while (<$script>) {
+            $file_opts = $file_opts . ",-f$3$4"
+              if /^#\s*line\s+(\d+)\s+((\w+)|"([^"]+)")/;
+        }
+    }
+
+    close $script;
+
+    my $perl = './perl';
+    my $lib  = '../lib';
+    my $run_dir;
+    my $return_dir;
+
+    $test =~ /^(.+)\/[^\/]+/;
+    my $dir = $1;
+    my $testswitch = $dir_to_switch{$dir};
+    if (!defined $testswitch) {
+	if ($test =~ s!^(\.\./(cpan|dist|ext)/[^/]+)/t!t!) {
+	    $run_dir = $1;
+	    $return_dir = '../../t';
+	    $lib = '../../lib';
+	    $perl = '../../t/perl';
+	    $testswitch = "-I../.. -MTestInit=U2T";
+	    if ($2 eq 'cpan' || $2 eq 'dist') {
+		if($abs{$run_dir}) {
+		    $testswitch = $testswitch . ',A';
+		}
+		if ($temp_no_core{$run_dir}) {
+		    $testswitch = $testswitch . ',NC';
+		}
+	    }
+	} else {
+	    $testswitch = '-I.. -MTestInit';  # -T will remove . from @INC
+	}
+    }
+
+    my $utf8 = ($::with_utf8 || $::with_utf16) ? "-I$lib -Mutf8" : '';
+
+    my %options = (
+	perl => $perl,
+	lib => $lib,
+	test => $test,
+	run_dir => $run_dir,
+	return_dir => $return_dir,
+	testswitch => $testswitch,
+	utf8 => $utf8,
+	file => $file_opts,
+	switch => $switch,
+    );
 
-	my $fullpath = File::Spec->catfile($dir, $f);
+    return \%options;
+}
+
+sub _cmd {
+    my($options, $type) = @_;
+
+    my $test = $options->{test};
+
+    my $cmd;
+    if ($type eq 'deparse') {
+        my $perl = "$options->{perl} $options->{testswitch}";
+        my $lib = $options->{lib};
+
+        $cmd = (
+          "$perl $options->{switch} -I$lib -MO=-qq,Deparse,-sv1.,".
+          "-l$::deparse_opts$options->{file} ".
+          "$test > $test.dp ".
+          "&& $perl $options->{switch} -I$lib $test.dp"
+        );
+    }
+    elsif ($type eq 'perl') {
+        my $perl = $options->{perl};
+        my $redir = $^O eq 'VMS' ? '2>&1' : '';
+
+        if ($ENV{PERL_VALGRIND}) {
+            my $valgrind = $ENV{VALGRIND} // 'valgrind';
+            my $vg_opts = $ENV{VG_OPTS}
+              //  "--suppressions=perl.supp --leak-check=yes "
+                . "--leak-resolution=high --show-reachable=yes "
+                  . "--num-callers=50";
+            $perl = "$valgrind --log-fd=3 $vg_opts $perl";
+            $redir = "3>$Valgrind_Log";
+        }
+
+        my $args = "$options->{testswitch} $options->{switch} $options->{utf8}";
+        $cmd = $perl . _quote_args($args) . " $test $redir";
+    }
+
+    return $cmd;
+}
+
+sub _before_fork {
+    my ($options) = @_;
 
-	_find_tests($fullpath) if -d $fullpath;
-	$fullpath = VMS::Filespec::unixify($fullpath) if $^O eq 'VMS';
-	push @ARGV, $fullpath if $f =~ /\.t$/;
+    if ($options->{run_dir}) {
+	my $run_dir = $options->{run_dir};
+	chdir $run_dir or die "Can't chdir to '$run_dir': $!";
     }
+
+    return;
+}
+
+sub _after_fork {
+    my ($options) = @_;
+
+    if ($options->{return_dir}) {
+	my $return_dir = $options->{return_dir};
+	chdir $return_dir
+	   or die "Can't chdir from '$options->{run_dir}' to '$return_dir': $!";
+    }
+
+    return;
+}
+
+sub _run_test {
+    my ($test, $type) = @_;
+
+    my $options = _scan_test($test, $type);
+    # $test might have changed if we're in ext/Foo, so don't use it anymore
+    # from now on. Use $options->{test} instead.
+
+    _before_fork($options);
+
+    my $cmd = _cmd($options, $type);
+
+    open(my $results, "$cmd |") or print "can't run '$cmd': $!.\n";
+
+    _after_fork($options);
+
+    # Our environment may force us to use UTF-8, but we can't be sure that
+    # anything we're reading from will be generating (well formed) UTF-8
+    # This may not be the best way - possibly we should unset ${^OPEN} up
+    # top?
+    binmode $results;
+
+    return $results;
 }
 
 sub _quote_args {
@@ -95,58 +367,34 @@
        # In VMS protect with doublequotes because otherwise
        # DCL will lowercase -- unless already doublequoted.
        $_ = q(").$_.q(") if ($^O eq 'VMS') && !/^\"/ && length($_) > 0;
-       $argstring .= ' ' . $_;
+       $argstring = $argstring . ' ' . $_;
     }
     return $argstring;
 }
 
 sub _populate_hash {
+    return unless defined $_[0];
     return map {$_, 1} split /\s+/, $_[0];
 }
 
-unless (@ARGV) {
-    foreach my $dir (qw(base comp cmd run io op uni mro)) {
-	_find_tests($dir);
-    }
-    _find_tests("lib") unless $::core;
-    # Config.pm may be broken for make minitest. And this is only a refinement
-    # for skipping tests on non-default builds, so it is allowed to fail.
-    # What we want to to is make a list of extensions which we did not build.
-    my $configsh = File::Spec->catfile($updir, "config.sh");
+sub _tests_from_manifest {
+    my ($extensions, $known_extensions) = @_;
     my %skip;
-    if (-f $configsh) {
-	my (%extensions, %known_extensions);
-	open FH, $configsh or die "Can't open $configsh: $!";
-	while (<FH>) {
-	    if (/^extensions=['"](.*)['"]$/) {
-		# Deliberate string interpolation to avoid triggering possible
-		# $1 resetting bugs.
-		%extensions = _populate_hash ("$1");
-	    }
-	    elsif (/^known_extensions=['"](.*)['"]$/) {
-		%known_extensions = _populate_hash ($1);
-	    }
-	}
-	if (%extensions) {
-	    if (%known_extensions) {
-		foreach (keys %known_extensions) {
-		    $skip{$_}++ unless $extensions{$_};
-		}
-	    } else {
-		warn "No known_extensions line found in $configsh";
-	    }
-	} else {
-	    warn "No extensions line found in $configsh";
-	}
+    my %extensions = _populate_hash($extensions);
+    my %known_extensions = _populate_hash($known_extensions);
+
+    foreach (keys %known_extensions) {
+	$skip{$_} = 1 unless $extensions{$_};
     }
-    my $mani = File::Spec->catfile($updir, "MANIFEST");
+
+    my @results;
+    my $mani = '../MANIFEST';
     if (open(MANI, $mani)) {
-	while (<MANI>) { # similar code in t/harness
-	    if (m!^(ext/(\S+)/+(?:[^/\s]+\.t|test\.pl)|lib/\S+?(?:\.t|test\.pl))\s!) {
+	while (<MANI>) {
+	    if (m!^((?:cpan|dist|ext)/(\S+)/+(?:[^/\s]+\.t|test\.pl)|lib/\S+?(?:\.t|test\.pl))\s!) {
 		my $t = $1;
 		my $extension = $2;
-		if (!$::core || $t =~ m!^lib/[a-z]!)
-		{
+		if (!$::core || $t =~ m!^lib/[a-z]!) {
 		    if (defined $extension) {
 			$extension =~ s!/t$!!;
 			# XXX Do I want to warn that I'm skipping these?
@@ -155,8 +403,8 @@
 			$flat_extension =~ s!-!/!g;
 			next if $skip{$flat_extension}; # Foo/Bar may live in Foo-Bar
 		    }
-		    my $path = File::Spec->catfile($updir, $t);
-		    push @ARGV, $path;
+		    my $path = "../$t";
+		    push @results, $path;
 		    $::path_to_name{$path} = $t;
 		}
 	    }
@@ -165,10 +413,50 @@
     } else {
 	warn "$0: cannot open $mani: $!\n";
     }
+    return @results;
+}
+
+unless (@ARGV) {
+    # base first, as TEST bails out if that can't run
+    # then comp, to validate that require works
+    # then run, to validate that -M works
+    # then we know we can -MTestInit for everything else, making life simpler
+    foreach my $dir (qw(base comp run cmd io re op uni mro)) {
+	_find_tests($dir);
+    }
+    _find_tests("lib") unless $::core;
+    # Config.pm may be broken for make minitest. And this is only a refinement
+    # for skipping tests on non-default builds, so it is allowed to fail.
+    # What we want to to is make a list of extensions which we did not build.
+    my $configsh = '../config.sh';
+    my ($extensions, $known_extensions);
+    if (-f $configsh) {
+	open FH, $configsh or die "Can't open $configsh: $!";
+	while (<FH>) {
+	    if (/^extensions=['"](.*)['"]$/) {
+		$extensions = $1;
+	    }
+	    elsif (/^known_extensions=['"](.*)['"]$/) {
+		$known_extensions = $1;
+	    }
+	}
+	if (!defined $known_extensions) {
+	    warn "No known_extensions line found in $configsh";
+	}
+	if (!defined $extensions) {
+	    warn "No extensions line found in $configsh";
+	}
+    }
+    # The "complex" constructions of list return from a subroutine, and push of
+    # a list, might fail if perl is really hosed, but they aren't needed for
+    # make minitest, and the building of extensions will likely also fail if
+    # something is that badly wrong.
+    push @ARGV, _tests_from_manifest($extensions, $known_extensions);
     unless ($::core) {
-	_find_tests('pod');
 	_find_tests('x2p');
+	_find_tests('porting');
 	_find_tests('japh') if $::torture;
+	_find_tests('t/benchmark') if $::benchmark or $ENV{PERL_BENCHMARK};
     }
 }
 
@@ -218,8 +506,7 @@
 
     foreach my $t (@tests) {
       unless (exists $::path_to_name{$t}) {
-	my $tname = File::Spec->catfile('t',$t);
-	$tname = VMS::Filespec::unixify($tname) if $^O eq 'VMS';
+	my $tname = "t/$t";
 	$::path_to_name{$t} = $tname;
       }
     }
@@ -232,7 +519,6 @@
     # + 3 : we want three dots between the test name and the "ok"
     my $dotdotdot = $maxlen + 3 ;
     my $valgrind = 0;
-    my $valgrind_log = 'current.valgrind';
     my $total_files = @tests;
     my $good_files = 0;
     my $tested_files  = 0;
@@ -263,71 +549,7 @@
 	    $te = '';
 	}
 
-	# XXX DAPM %OVER not defined anywhere
-	# $test = $OVER{$test} if exists $OVER{$test};
-
-	open(SCRIPT,"<",$test) or die "Can't run $test.\n";
-	$_ = <SCRIPT>;
-	close(SCRIPT) unless ($type eq 'deparse');
-	if ($::with_utf16) {
-	    $_ =~ tr/\0//d;
-	}
-	my $switch;
-	if (/#!.*\bperl.*\s-\w*([tT])/) {
-	    $switch = qq{"-$1"};
-	}
-	else {
-	    if ($::taintwarn) {
-		# not all tests are expected to pass with this option
-		$switch = '"-t"';
-	    }
-	    else {
-		$switch = '';
-	    }
-	}
-
-	my $file_opts = "";
-	if ($type eq 'deparse') {
-	    # Look for #line directives which change the filename
-	    while (<SCRIPT>) {
-		$file_opts .= ",-f$3$4"
-			if /^#\s*line\s+(\d+)\s+((\w+)|"([^"]+)")/;
-	    }
-	    close(SCRIPT);
-	}
-
-	my $utf8 = $::with_utf8 ? '-I../lib -Mutf8' : '';
-	my $testswitch = '-I. -MTestInit'; # -T will strict . from @INC
-	if ($type eq 'deparse') {
-	    my $deparse_cmd =
-		"./perl $testswitch $switch -I../lib -MO=-qq,Deparse,-sv1.,".
-		"-l$::deparse_opts$file_opts ".
-		"$test > $test.dp ".
-		"&& ./perl $testswitch $switch -I../lib $test.dp |";
-	    open(RESULTS, $deparse_cmd)
-		or print "can't deparse '$deparse_cmd': $!.\n";
-	}
-	elsif ($type eq 'perl') {
-	    my $perl = $ENV{PERL} || './perl';
-	    my $redir = $^O eq 'VMS' ? '2>&1' : '';
-	    if ($ENV{PERL_VALGRIND}) {
-		my $valgrind = $ENV{VALGRIND} // 'valgrind';
-		my $vg_opts = $ENV{VG_OPTS}
-		    //  "--suppressions=perl.supp --leak-check=yes "
-			. "--leak-resolution=high --show-reachable=yes "
-			. "--num-callers=50"; 
-		$perl = "$valgrind --log-fd=3 $vg_opts $perl";
-		$redir = "3>$valgrind_log";
-	    }
-	    my $run = "$perl" . _quote_args("$testswitch $switch $utf8")
-			      . " $test $redir|";
-	    open(RESULTS,$run) or print "can't run '$run': $!.\n";
-	}
-	# Our environment may force us to use UTF-8, but we can't be sure that
-	# anything we're reading from will be generating (well formed) UTF-8
-	# This may not be the best way - possibly we should unset ${^OPEN} up
-	# top?
-	binmode RESULTS;
+	my $results = _run_test($test, $type);
 
 	my $failure;
 	my $next = 0;
@@ -336,7 +558,7 @@
 	my $trailing_leader = 0;
 	my $max;
 	my %todo;
-	while (<RESULTS>) {
+	while (<$results>) {
 	    next if /^\s*$/; # skip blank lines
 	    if (/^1..$/ && ($^O eq 'VMS')) {
 		# VMS pipe bug inserts blank lines.
@@ -362,8 +584,8 @@
 		    }
 		    $max = $1;
 		    %todo = map { $_ => 1 } split / /, $3 if $3;
-		    $totmax += $max;
-		    $tested_files++;
+		    $totmax = $totmax + $max;
+		    $tested_files = $tested_files + 1;
 		    if ($seen_ok) {
 			# 1..n appears at end of file
 			$trailing_leader = 1;
@@ -385,7 +607,7 @@
 			    }
 			}
 			$seen_ok = 1;
-			$next++;
+			$next = $next + 1;
 			my($not, $num, $extra, $istodo) = ($1, $2, $3, 0);
 			$num = $next unless $num;
 
@@ -393,7 +615,7 @@
 
 			    # SKIP is essentially the same as TODO for t/TEST
 			    # this still conforms to TAP:
-			    # http://search.cpan.org/dist/TAP/TAP.pod
+			    # http://search.cpan.org/dist/TAP/TAP.pm
 			    $extra and $istodo = $extra =~ /#\s*(?:TODO|SKIP)\b/;
 			    $istodo = 1 if $todo{$num};
 
@@ -413,14 +635,14 @@
 		    else {
 			# module tests are allowed extra output,
 			# because Test::Harness allows it
-			next if $test =~ /^\W*(ext|lib)\b/;
+			next if $test =~ /^\W*(cpan|dist|ext|lib)\b/;
 			$failure = "FAILED--unexpected output at test $next";
 			last;
 		    }
 		}
 	    }
 	}
-	close RESULTS;
+	close $results;
 
 	if (not defined $failure) {
 	    $failure = 'FAILED--no leader found' unless $seen_leader;
@@ -428,17 +650,17 @@
 
 	if ($ENV{PERL_VALGRIND}) {
 	    my @valgrind;
-	    if (-e $valgrind_log) {
-		if (open(V, $valgrind_log)) {
+	    if (-e $Valgrind_Log) {
+		if (open(V, $Valgrind_Log)) {
 		    @valgrind = <V>;
 		    close V;
 		} else {
-		    warn "$0: Failed to open '$valgrind_log': $!\n";
+		    warn "$0: Failed to open '$Valgrind_Log': $!\n";
 		}
 	    }
 	    if ($ENV{VG_OPTS} =~ /cachegrind/) {
-		if (rename $valgrind_log, "$test.valgrind") {
-		    $valgrind++;
+		if (rename $Valgrind_Log, "$test.valgrind") {
+		    $valgrind = $valgrind + 1;
 		} else {
 		    warn "$0: Failed to create '$test.valgrind': $!\n";
 		}
@@ -449,19 +671,19 @@
 		for my $i (0..$#valgrind) {
 		    local $_ = $valgrind[$i];
 		    if (/^==\d+== ERROR SUMMARY: (\d+) errors? /) {
-			$errors += $1;   # there may be multiple error summaries
+			$errors = $errors + $1;   # there may be multiple error summaries
 		    } elsif (/^==\d+== LEAK SUMMARY:/) {
 			for my $off (1 .. 4) {
 			    if ($valgrind[$i+$off] =~
 				/(?:lost|reachable):\s+\d+ bytes in (\d+) blocks/) {
-				$leaks += $1;
+				$leaks = $leaks + $1;
 			    }
 			}
 		    }
 		}
 		if ($errors or $leaks) {
-		    if (rename $valgrind_log, "$test.valgrind") {
-			$valgrind++;
+		    if (rename $Valgrind_Log, "$test.valgrind") {
+			$valgrind = $valgrind + 1;
 		    } else {
 			warn "$0: Failed to create '$test.valgrind': $!\n";
 		    }
@@ -469,9 +691,9 @@
 	    } else {
 		warn "No valgrind output?\n";
 	    }
-	    if (-e $valgrind_log) {
-		unlink $valgrind_log
-		    or warn "$0: Failed to unlink '$valgrind_log': $!\n";
+	    if (-e $Valgrind_Log) {
+		unlink $Valgrind_Log
+		    or warn "$0: Failed to unlink '$Valgrind_Log': $!\n";
 	    }
 	}
 	if ($type eq 'deparse') {
@@ -497,11 +719,11 @@
 
 	if (defined $failure) {
 	    print "${te}$failure\n";
-	    $::bad_files++;
+	    $::bad_files = $::bad_files + 1;
 	    if ($test =~ /^base/) {
 		die "Failed a basic test ($test) -- cannot continue.\n";
 	    }
-	    ++$failed_tests{$test};
+	    $failed_tests{$test} = 1;
 	}
 	else {
 	    if ($max) {
@@ -513,11 +735,11 @@
 		    $elapsed = "";
 		}
 		print "${te}ok$elapsed\n";
-		$good_files++;
+		$good_files = $good_files + 1;
 	    }
 	    else {
 		print "${te}skipped\n";
-		$tested_files -= 1;
+		$tested_files = $tested_files - 1;
 	    }
 	}
     } # while tests
Index: src/gnu/usr.bin/perl/t/harness
diff -u src/gnu/usr.bin/perl/t/harness:1.10 src/gnu/usr.bin/perl/t/harness:1.11
--- t/harness:1.10	Mon Oct 12 18:24:48 2009
+++ t/harness	Fri Sep 24 15:07:05 2010
@@ -7,15 +7,17 @@
     chdir 't' if -d 't';
     @INC = '../lib';              # pick up only this build's lib
 }
-delete $ENV{PERL5LIB};
 
 my $torture; # torture testing?
 
-use Test::Harness;
+use TAP::Harness 3.13;
 use strict;
 
-$Test::Harness::switches = "";    # Too much noise otherwise
-$Test::Harness::Verbose++ while @ARGV && $ARGV[0] eq '-v' && shift;
+$::do_nothing = $::do_nothing = 1;
+require './TEST';
+
+my $Verbose = 0;
+$Verbose++ while @ARGV && $ARGV[0] eq '-v' && shift;
 
 if ($ARGV[0] && $ARGV[0] eq '-torture') {
     shift;
@@ -51,23 +53,6 @@
 # [.VMS]TEST.COM calls harness with empty arguments, so clean-up @ARGV
 @ARGV = grep $_ && length( $_ ) => @ARGV;
 
-sub _populate_hash {
-    return map {$_, 1} split /\s+/, $_[0];
-}
-
-# Generate T::H schedule rules that run the contents of each directory
-# sequentially.
-sub _seq_dir_rules {
-    my @tests = @_;
-    my %dir;
-    for (@tests) {
-        s{[^/]+$}{\*};
-        $dir{$_}++;
-    }
-
-    return { par => [ map { { seq => $_ } } sort keys %dir ] };
-}
-
 sub _extract_tests;
 sub _extract_tests {
     # This can probably be done more tersely with a map, but I doubt that it
@@ -101,17 +86,14 @@
 }
 
 my $jobs = $ENV{TEST_JOBS};
-my ($fork, $rules, $state);
+my ($rules, $state, $color);
 if ($ENV{HARNESS_OPTIONS}) {
     for my $opt ( split /:/, $ENV{HARNESS_OPTIONS} ) {
         if ( $opt =~ /^j(\d*)$/ ) {
             $jobs ||= $1 || 9;
         }
-        elsif ( $opt eq 'f' ) {
-            $fork = 1;
-        }
         elsif ( $opt eq 'c' ) {
-#            $args->{color} = 1;
+            $color = 1;
         }
         else {
             die "Unknown HARNESS_OPTIONS item: $opt\n";
@@ -145,9 +127,10 @@
     unless (@tests) {
 	my @seq = <base/*.t>;
 
-	my @next = qw(comp cmd run io op uni mro lib);
+	my @next = qw(comp run cmd io re op uni mro lib porting);
 	push @next, 'japh' if $torture;
 	push @next, 'win32' if $^O eq 'MSWin32';
+	push @next, 'benchmark' if $ENV{PERL_BENCHMARK};
 	# Hopefully TAP::Parser::Scheduler will support this syntax soon.
 	# my $next = { par => '{' . join (',', @next) . '}/*.t' };
 	my $next = { par => [
@@ -175,46 +158,38 @@
 
 	my @last;
 	use Config;
-	my %skip;
-	{
-	    my %extensions = _populate_hash $Config{'extensions'};
-	    my %known_extensions = _populate_hash $Config{'known_extensions'};
-	    foreach (keys %known_extensions) {
-		$skip{$_}++ unless $extensions{$_};
+	push @last,  sort { lc $a cmp lc $b }
+	    _tests_from_manifest($Config{extensions}, $Config{known_extensions});
+	push @last, <x2p/*.t>;
+
+	my %times;
+	if ($state) {
+	    # Where known, collate the elapsed times by test name
+	    foreach ($state->results->tests()) {
+		$times{$_->name} = $_->elapsed();
 	    }
 	}
-	use File::Spec;
-	my $updir = File::Spec->updir;
-	my $mani  = File::Spec->catfile(File::Spec->updir, "MANIFEST");
-	if (open(MANI, $mani)) {
-	    my @manitests = ();
-	    while (<MANI>) { # similar code in t/TEST
-		if (m!^(ext/(\S+)/+(?:[^/\s]+\.t|test\.pl)|lib/\S+?(?:\.t|test\.pl))\s!) {
-		    my ($test, $extension) = ($1, $2);
-		    if (defined $extension) {
-			$extension =~ s!/t$!!;
-			# XXX Do I want to warn that I'm skipping these?
-			next if $skip{$extension};
-			my $flat_extension = $extension;
-			$flat_extension =~ s!-!/!g;
-			next if $skip{$flat_extension}; # Foo/Bar may live in Foo-Bar
-		    }
-		    push @manitests, File::Spec->catfile($updir, $test);
-		}
-	    }
-	    close MANI;
-	    # Sort the list of test files read from MANIFEST into a sensible
-	    # order instead of using the order in which they are listed there
-	    push @last, sort { lc $a cmp lc $b } @manitests;
-	} else {
-	    warn "$0: cannot open $mani: $!\n";
+
+	my %dir;
+	my %total_time;
+
+	for (@last) {
+	    if ($^O eq 'MSWin32') {
+		s,\\,/,g; # canonicalize path
+	    };
+	    m!(.*[/])! or die "'$_'";
+	    push @{$dir{$1}}, $_;
+	    $total_time{$1} += $times{$_} || 0;
 	}
-	push @last, <pod/*.t>;
-	push @last, <x2p/*.t>;
 
 	push @tests, @last;
 
-	push @seq, _seq_dir_rules @last;
+	# Generate T::H schedule rules that run the contents of each directory
+	# sequentially.
+	push @seq, { par => [ map { { seq => "$_*" } } sort {
+	    # Directories, ordered by total time descending then name ascending
+	    $total_time{$b} <=> $total_time{$a} || $a cmp $b
+	} keys %dir ] };
 
 	$rules = { seq => \@seq };
     }
@@ -225,32 +200,61 @@
 @tests=grep /$re/, @tests 
     if $re;
 
-if ($jobs) {
-    eval 'use TAP::Harness 3.13; 1' or die $@;
+my %options;
 
-    # Test::Harness parses $ENV{HARNESS_OPTIONS}, TAP::Harness does not
-    local $ENV{HARNESS_OPTIONS};
-    my $h = TAP::Harness->new({ jobs => $jobs, rules => $rules, ($fork ? (fork => $fork) : ())});
-    if ($state) {
-	$h->callback(
-		     after_test => sub {
-			 $state->observe_test(@_);
-		     }
-		    );
-	$h->callback(
-		     after_runtests => sub {
-			 $state->commit(@_);
-		     }
-		    );
-    }
+my $type = 'perl';
+
+# Load TAP::Parser now as otherwise it could be required in the short time span
+# in which the harness process chdirs into ext/Dist
+require TAP::Parser;
+
+my $h = TAP::Harness->new({
+    rules       => $rules,
+    color       => $color,
+    jobs        => $jobs,
+    verbosity   => $Verbose,
+    exec        => sub {
+	my ($harness, $test) = @_;
+
+	my $options = $options{$test};
+	if (!defined $options) {
+	    $options = $options{$test} = _scan_test($test, $type);
+	}
+
+	return [ split ' ', _cmd($options, $type) ];
+    },
+});
+
+if ($state) {
     $h->callback(
-		 parser_args => sub {
-		     my ( $args, $test ) = @_;
-		     push @{ $args->{switches} }, '-I../lib';
+		 after_test => sub {
+		     $state->observe_test(@_);
 		 }
-		);
-    $h->runtests(@tests);
-} else {
-    Test::Harness::runtests @tests;
+		 );
+    $h->callback(
+		 after_runtests => sub {
+		     $state->commit(@_);
+		 }
+		 );
 }
-exit(0);
+
+$h->callback(
+	     parser_args => sub {
+		 my ($args, $job) = @_;
+		 my $test = $job->[0];
+		 _before_fork($options{$test});
+		 push @{ $args->{switches} }, "-I../../lib";
+	     }
+	     );
+
+$h->callback(
+	     made_parser => sub {
+		 my ($parser, $job) = @_;
+		 my $test = $job->[0];
+		 my $options = delete $options{$test};
+		 _after_fork($options);
+	     }
+	     );
+
+my $agg = $h->runtests(@tests);
+exit $agg->has_errors ? 1 : 0;
Index: src/gnu/usr.bin/perl/t/base/lex.t
diff -u src/gnu/usr.bin/perl/t/base/lex.t:1.9 src/gnu/usr.bin/perl/t/base/lex.t:1.10
--- t/base/lex.t:1.9	Mon Oct 12 18:30:27 2009
+++ t/base/lex.t	Fri Sep 24 15:07:05 2010
@@ -69,10 +69,11 @@
 print q<ok 17
 >;
 
-print <<;   # Yow!
-ok 18
-
-# previous line intentionally left blank.
+print "ok 18 - was the test for the deprecated use of bare << to mean <<\"\"\n";
+#print <<;   # Yow!
+#ok 18
+#
+## previous line intentionally left blank.
 
 print <<E1 eq "foo\n\n" ? "ok 19\n" : "not ok 19\n";
 @{[ <<E2 ]}
@@ -265,7 +266,7 @@
 foo::::::bar;
 
 eval "\$x =\xE2foo";
-if ($@ =~ /Unrecognized character \\xE2 in column 5/) { print "ok $test\n"; } else { print "not ok $test\n"; }
+if ($@ =~ /Unrecognized character \\xE2; marked by <-- HERE after \$x =<-- HERE near column 5/) { print "ok $test\n"; } else { print "not ok $test\n"; }
 $test++;
 
 # Is "[~" scanned correctly?
Index: src/gnu/usr.bin/perl/t/base/term.t
diff -u src/gnu/usr.bin/perl/t/base/term.t:1.8 src/gnu/usr.bin/perl/t/base/term.t:1.9
--- t/base/term.t:1.8	Mon Sep 29 17:36:18 2008
+++ t/base/term.t	Fri Sep 24 15:07:05 2010
@@ -38,11 +38,7 @@
 
 # check <> pseudoliteral
 
-if ($^O eq 'MacOS') {
-	open(try,"Dev:Null") || (die "Can't open /dev/null.");
-} else {
-	open(try, "/dev/null") || open(try,"nla0:") || (die "Can't open /dev/null.");
-}
+open(try, "/dev/null") || open(try,"nla0:") || (die "Can't open /dev/null.");
 
 if (<try> eq '') {
     print "ok 6\n";
Index: src/gnu/usr.bin/perl/t/cmd/switch.t
diff -u src/gnu/usr.bin/perl/t/cmd/switch.t:1.8 src/gnu/usr.bin/perl/t/cmd/switch.t:1.9
--- t/cmd/switch.t:1.8	Mon Sep 29 17:36:18 2008
+++ t/cmd/switch.t	Fri Sep 24 15:07:05 2010
@@ -17,12 +17,12 @@
     }
 }
 
-print do foo1(0) == 20 ? "ok 1\n" : "not ok 1\n";
-print do foo1(1) == 1 ? "ok 2\n" : "not ok 2\n";
-print do foo1(2) == 2 ? "ok 3\n" : "not ok 3\n";
-print do foo1(3) == 3 ? "ok 4\n" : "not ok 4\n";
-print do foo1(4) == 4 ? "ok 5\n" : "not ok 5\n";
-print do foo1(5) == 20 ? "ok 6\n" : "not ok 6\n";
+print foo1(0) == 20 ? "ok 1\n" : "not ok 1\n";
+print foo1(1) == 1 ? "ok 2\n" : "not ok 2\n";
+print foo1(2) == 2 ? "ok 3\n" : "not ok 3\n";
+print foo1(3) == 3 ? "ok 4\n" : "not ok 4\n";
+print foo1(4) == 4 ? "ok 5\n" : "not ok 5\n";
+print foo1(5) == 20 ? "ok 6\n" : "not ok 6\n";
 
 sub foo2 {
     $_ = shift(@_);
@@ -38,12 +38,12 @@
     return $_;
 }
 
-print do foo2(0) == 20 ? "ok 7\n" : "not ok 7\n";
-print do foo2(1) == 1 ? "ok 8\n" : "not ok 8\n";
-print do foo2(2) == 2 ? "ok 9\n" : "not ok 9\n";
-print do foo2(3) == 3 ? "ok 10\n" : "not ok 10\n";
-print do foo2(4) == 4 ? "ok 11\n" : "not ok 11\n";
-print do foo2(5) == 20 ? "ok 12\n" : "not ok 12\n";
+print foo2(0) == 20 ? "ok 7\n" : "not ok 7\n";
+print foo2(1) == 1 ? "ok 8\n" : "not ok 8\n";
+print foo2(2) == 2 ? "ok 9\n" : "not ok 9\n";
+print foo2(3) == 3 ? "ok 10\n" : "not ok 10\n";
+print foo2(4) == 4 ? "ok 11\n" : "not ok 11\n";
+print foo2(5) == 20 ? "ok 12\n" : "not ok 12\n";
 
 sub foo3 {
     $_ = shift(@_);
@@ -65,9 +65,9 @@
     return 40;
 }
 
-print do foo3(0) == 20 ? "ok 13\n" : "not ok 13\n";
-print do foo3(1) == 1 ? "ok 14\n" : "not ok 14\n";
-print do foo3(2) == 2 ? "ok 15\n" : "not ok 15\n";
-print do foo3(3) == 3 ? "ok 16\n" : "not ok 16\n";
-print do foo3(4) == 4 ? "ok 17\n" : "not ok 17\n";
-print do foo3(5) == 20 ? "ok 18\n" : "not ok 18\n";
+print foo3(0) == 20 ? "ok 13\n" : "not ok 13\n";
+print foo3(1) == 1 ? "ok 14\n" : "not ok 14\n";
+print foo3(2) == 2 ? "ok 15\n" : "not ok 15\n";
+print foo3(3) == 3 ? "ok 16\n" : "not ok 16\n";
+print foo3(4) == 4 ? "ok 17\n" : "not ok 17\n";
+print foo3(5) == 20 ? "ok 18\n" : "not ok 18\n";
Index: src/gnu/usr.bin/perl/t/comp/colon.t
diff -u src/gnu/usr.bin/perl/t/comp/colon.t:1.3 src/gnu/usr.bin/perl/t/comp/colon.t:1.4
--- t/comp/colon.t:1.3	Thu May 24 18:36:05 2001
+++ t/comp/colon.t	Fri Sep 24 15:07:05 2010
@@ -4,15 +4,12 @@
 # Ensure that syntax using colons (:) is parsed correctly.
 # The tests are done on the following tokens (by default):
 # ABC LABEL XYZZY m q qq qw qx s tr y AUTOLOAD and alarm 
-#	-- Robin Barker <rmb@cise.npl.co.uk>
+#	-- Robin Barker 
 #
 
-BEGIN {
-    chdir 't' if -d 't';
-    @INC = '../lib';
-}
-
-use strict;
+# Uncomment this for testing, but don't leave it in for "production", as
+# we've not yet verified that use works.
+# use strict;
 
 $_ = '';	# to avoid undef warning on m// etc.
 
Index: src/gnu/usr.bin/perl/t/comp/decl.t
diff -u src/gnu/usr.bin/perl/t/comp/decl.t:1.8 src/gnu/usr.bin/perl/t/comp/decl.t:1.9
--- t/comp/decl.t:1.8	Mon Sep 29 17:36:18 2008
+++ t/comp/decl.t	Fri Sep 24 15:07:05 2010
@@ -11,8 +11,8 @@
 
 print "1..7\n";
 
-do one();
-do two();
+one();
+two();
 
 sub two {
     print "ok 2\n";
@@ -26,10 +26,10 @@
     sub three {
 	print "ok 3\n";
     }
-    do three();
+    three();
 }
 
-do four();
+four();
 $~ = 'one';
 write;
 $~ = 'two';
Index: src/gnu/usr.bin/perl/t/comp/multiline.t
diff -u src/gnu/usr.bin/perl/t/comp/multiline.t:1.8 src/gnu/usr.bin/perl/t/comp/multiline.t:1.9
--- t/comp/multiline.t:1.8	Mon Oct 12 18:30:27 2009
+++ t/comp/multiline.t	Fri Sep 24 15:07:05 2010
@@ -1,14 +1,51 @@
 #!./perl
 
-BEGIN {
-    chdir 't';
-    @INC = '../lib';
-    require './test.pl';
+print "1..6\n";
+my $test = 0;
+
+sub failed {
+    my ($got, $expected, $name) = @_;
+
+    print "not ok $test - $name\n";
+    my @caller = caller(1);
+    print "# Failed test at $caller[1] line $caller[2]\n";
+    if (defined $got) {
+	print "# Got '$got'\n";
+    } else {
+	print "# Got undef\n";
+    }
+    print "# Expected $expected\n";
+    return;
+}
+
+sub like {
+    my ($got, $pattern, $name) = @_;
+    $test = $test + 1;
+    if (defined $got && $got =~ $pattern) {
+	print "ok $test - $name\n";
+	# Principle of least surprise - maintain the expected interface, even
+	# though we aren't using it here (yet).
+	return 1;
+    }
+    failed($got, $pattern, $name);
 }
 
-plan(tests => 6);
+sub is {
+    my ($got, $expect, $name) = @_;
+    $test = $test + 1;
+    if (defined $got && $got eq $expect) {
+	print "ok $test - $name\n";
+	return 1;
+    }
+    failed($got, "'$expect'", $name);
+}
+
+my $filename = "multiline$$";
+
+END {
+    1 while unlink $filename;
+}
 
-my $filename = tempfile();
 open(TRY,'>',$filename) || (die "Can't open $filename: $!");
 
 $x = 'now is the time
@@ -44,7 +81,6 @@
 
 $out = (($^O eq 'MSWin32') || $^O eq 'NetWare') ? `type $filename`
     : ($^O eq 'VMS') ? `type $filename.;0`   # otherwise .LIS is assumed
-    : ($^O eq 'MacOS') ? `catenate $filename`
     : `cat $filename`;
 
 like($out, qr/.*\n.*\n.*\n$/);
Index: src/gnu/usr.bin/perl/t/comp/package.t
diff -u src/gnu/usr.bin/perl/t/comp/package.t:1.5 src/gnu/usr.bin/perl/t/comp/package.t:1.6
--- t/comp/package.t:1.5	Mon Sep 29 17:36:18 2008
+++ t/comp/package.t	Fri Sep 24 15:07:05 2010
@@ -71,3 +71,4 @@
 
 print       __PACKAGE__  eq 'bug32562' ? "ok 13\n" : "not ok 13\n";
 print eval '__PACKAGE__' eq 'bug32562' ? "ok 14\n" : "not ok 14\n";
+
Index: src/gnu/usr.bin/perl/t/comp/proto.t
diff -u src/gnu/usr.bin/perl/t/comp/proto.t:1.7 src/gnu/usr.bin/perl/t/comp/proto.t:1.8
--- t/comp/proto.t:1.7	Mon Sep 29 17:36:18 2008
+++ t/comp/proto.t	Fri Sep 24 15:07:05 2010
@@ -14,9 +14,11 @@
     @INC = '../lib';
 }
 
+# We need this, as in places we're testing the interaction of prototypes with
+# strict
 use strict;
 
-print "1..141\n";
+print "1..153\n";
 
 my $i = 1;
 
@@ -549,11 +551,21 @@
 # string "parse error".
 #
 for my $p ( "", qw{ () ($) ($@) ($%) ($;$) (&) (&\@) (&@) (%) (\%) (\@) } ) {
-  no warnings 'prototype';
+  my $warn = "";
+  local $SIG{__WARN__} = sub {
+    my $thiswarn = join("",@_);
+    return if $thiswarn =~ /^Prototype mismatch: sub main::evaled_subroutine/;
+    $warn .= $thiswarn;
+  };
   my $eval = "sub evaled_subroutine $p { &void *; }";
   eval $eval;
   print "# eval[$eval]\nnot " unless $@ && $@ =~ /(parse|syntax) error/i;
   print "ok ", $i++, "\n";
+  if ($warn eq '') {
+     print "ok ", $i++, "\n";
+  } else {
+    print "not ok ", $i++, "# $warn \n";
+  }
 }
 
 # Not $$;$;$
@@ -609,7 +621,7 @@
 
 # check that obviously bad prototypes are getting warnings
 {
-  use warnings 'syntax';
+  local $^W = 1;
   my $warn = "";
   local $SIG{__WARN__} = sub { $warn .= join("",@_) };
   
Index: src/gnu/usr.bin/perl/t/comp/require.t
diff -u src/gnu/usr.bin/perl/t/comp/require.t:1.2 src/gnu/usr.bin/perl/t/comp/require.t:1.3
--- t/comp/require.t:1.2	Fri Aug 14 16:34:57 2009
+++ t/comp/require.t	Fri Sep 24 15:07:05 2010
@@ -6,6 +6,13 @@
     push @INC, '../lib';
 }
 
+sub do_require {
+    %INC = ();
+    write_file('bleah.pm',@_);
+    eval { require "bleah.pm" };
+    my @a; # magic guard for scope violations (must be first lexical in file)
+}
+
 # don't make this lexical
 $i = 1;
 
@@ -15,22 +22,14 @@
 
 my $Is_EBCDIC = (ord('A') == 193) ? 1 : 0;
 my $Is_UTF8   = (${^OPEN} || "") =~ /:utf8/;
-my $total_tests = 50;
+my $total_tests = 49;
 if ($Is_EBCDIC || $Is_UTF8) { $total_tests -= 3; }
 print "1..$total_tests\n";
 
-sub do_require {
-    %INC = ();
-    write_file('bleah.pm',@_);
-    eval { require "bleah.pm" };
-    my @a; # magic guard for scope violations (must be first lexical in file)
-}
-
 sub write_file {
     my $f = shift;
     open(REQ,">$f") or die "Can't write '$f': $!";
     binmode REQ;
-    use bytes;
     print REQ @_;
     close REQ or die "Could not close $f: $!";
 }
@@ -63,14 +62,6 @@
 print "# $@\nnot " unless $@ =~ /^Perl v10\.0\.2 required/;
 print "ok ",$i++,"\n";
 
-eval q{ use v5.5.630; };
-print "# $@\nnot " if $@;
-print "ok ",$i++,"\n";
-
-eval q{ use 10.0.2; };
-print "# $@\nnot " unless $@ =~ /^Perl v10\.0\.2 required/;
-print "ok ",$i++,"\n";
-
 my $ver = 5.005_63;
 eval { require $ver; };
 print "# $@\nnot " if $@;
@@ -102,6 +93,12 @@
     print "ok ",$i++,"\n";
 }
 
+# "use 5.11.0" (and higher) loads strictures.
+# check that this doesn't happen with require
+eval 'require 5.11.0; ${"foo"} = "bar";';
+print "# $@\nnot " if $@;
+print "ok ",$i++,"\n";
+
 # interaction with pod (see the eof)
 write_file('bleah.pm', "print 'ok $i\n'; 1;\n");
 require "bleah.pm";
@@ -179,6 +176,7 @@
 @foo = eval q{require bleah}; delete $INC{"bleah.pm"}; ++$::i;
        eval q{require bleah}; delete $INC{"bleah.pm"}; ++$::i;
        eval q{$_=$_+2;require bleah}; delete $INC{"bleah.pm"}; ++$::i;
+       eval q{return require bleah}; delete $INC{"bleah.pm"}; ++$::i;
 $foo = eval  {require bleah}; delete $INC{"bleah.pm"}; ++$::i;
 @foo = eval  {require bleah}; delete $INC{"bleah.pm"}; ++$::i;
        eval  {require bleah};
@@ -258,20 +256,6 @@
     }
 }
 
-#  [perl #49472] Attributes + Unkown Error
-
-{
-    do_require
-	'use strict;sub MODIFY_CODE_ATTRIBUTE{} sub f:Blah {$nosuchvar}';
-    my $err = $@;
-    $err .= "\n" unless $err =~ /\n$/;
-    unless ($err =~ /Global symbol "\$nosuchvar" requires /) {
-	$err =~ s/^/# /mg;
-	print "${err}not ";
-    }
-    print "ok ", ++$i, " [perl #49472]\n";
-}
-
 ##########################################
 # What follows are UTF-8 specific tests. #
 # Add generic tests before this point.   #
@@ -281,17 +265,25 @@
 
 if ($Is_EBCDIC || $Is_UTF8) { exit; }
 
-my $utf8 = chr(0xFEFF);
-
-$i++; do_require(qq(${utf8}print "ok $i\n"; 1;\n));
-
-sub bytes_to_utf16 {
-    my $utf16 = pack("$_[0]*", unpack("C*", $_[1]));
-    return @_ == 3 && $_[2] ? pack("$_[0]", 0xFEFF) . $utf16 : $utf16;
+my %templates = (
+		 'UTF-8'    => 'C0U',
+		 'UTF-16BE' => 'n',
+		 'UTF-16LE' => 'v',
+		);
+
+sub bytes_to_utf {
+    my ($enc, $content, $do_bom) = @_;
+    my $template = $templates{$enc};
+    die "Unsupported encoding $enc" unless $template;
+    return pack "$template*", ($do_bom ? 0xFEFF : ()), unpack "C*", $content;
 }
 
-$i++; do_require(bytes_to_utf16('n', qq(print "ok $i\\n"; 1;\n), 1)); # BE
-$i++; do_require(bytes_to_utf16('v', qq(print "ok $i\\n"; 1;\n), 1)); # LE
+foreach (sort keys %templates) {
+    $i++; do_require(bytes_to_utf($_, qq(print "ok $i # $_\\n"; 1;\n), 1));
+    if ($@ =~ /^(Unsupported script encoding \Q$_\E)/) {
+	print "ok $i # skip $1\n";
+    }
+}
 
 END {
     foreach my $file (@fjles_to_delete) {
Index: src/gnu/usr.bin/perl/t/comp/use.t
diff -u src/gnu/usr.bin/perl/t/comp/use.t:1.7 src/gnu/usr.bin/perl/t/comp/use.t:1.8
--- t/comp/use.t:1.7	Mon Oct 12 18:30:27 2009
+++ t/comp/use.t	Fri Sep 24 15:07:05 2010
@@ -2,11 +2,11 @@
 
 BEGIN {
     chdir 't' if -d 't';
-    @INC = '../lib';
+    @INC = ('../lib', 'lib');
     $INC{"feature.pm"} = 1; # so we don't attempt to load feature.pm
 }
 
-print "1..63\n";
+print "1..73\n";
 
 # Can't require test.pl, as we're testing the use/require mechanism here.
 
@@ -37,7 +37,7 @@
 	} else {
 	    print "not ok $test\n";
 	}
-	my @caller = caller(2);
+	my @caller = caller(1);
 	print "# Failed test at $caller[1] line $caller[2]\n";
 	print "# Got      '$got'\n";
 	if ($type eq 'is') {
@@ -62,6 +62,26 @@
     _ok ('isnt', @_);
 }
 
+eval "use 5";           # implicit semicolon
+is ($@, '');
+
+eval "use 5;";
+is ($@, '');
+
+eval "{use 5}";         # [perl #70884]
+is ($@, '');
+
+eval "{use 5   }";      # [perl #70884]
+is ($@, '');
+
+# new style version numbers
+
+eval q{ use v5.5.630; };
+is ($@, '');
+
+eval q{ use 10.0.2; };
+like ($@, qr/^Perl v10\.0\.2 required/);
+
 eval "use 5.000";	# implicit semicolon
 is ($@, '');
 
@@ -89,6 +109,9 @@
 eval "use 5.10;";
 like ($@, qr/Perl v5\.100\.0 required \(did you mean v5\.10\.0\?\)--this is only \Q$^V\E, stopped/);
 
+eval "use 5.11;";
+like ($@, qr/Perl v5\.110\.0 required \(did you mean v5\.11\.0\?\)--this is only \Q$^V\E, stopped/);
+
 eval sprintf "use %.6f;", $];
 is ($@, '');
 
@@ -102,100 +125,92 @@
 eval sprintf "use %.6f;", $] + 0.00001;
 like ($@, qr/Perl v5.\d+.\d+ required--this is only \Q$^V\E, stopped/);
 
-{ use lib }	# check that subparse saves pending tokens
+# check that "use 5.11.0" (and higher) loads strictures
+eval 'use 5.11.0; ${"foo"} = "bar";';
+like ($@, qr/Can't use string \("foo"\) as a SCALAR ref while "strict refs" in use/);
+# but that they can be disabled
+eval 'use 5.11.0; no strict "refs"; ${"foo"} = "bar";';
+is ($@, "");
+# and they are properly scoped
+eval '{use 5.11.0;} ${"foo"} = "bar";';
+is ($@, "");
 
-local $lib::VERSION = 1.0;
+{ use test_use }	# check that subparse saves pending tokens
 
-eval "use lib 0.9";
+local $test_use::VERSION = 1.0;
+
+eval "use test_use 0.9";
 is ($@, '');
 
-eval "use lib 1.0";
+eval "use test_use 1.0";
 is ($@, '');
 
-eval "use lib 1.01";
+eval "use test_use 1.01";
 isnt ($@, '');
 
-
-eval "use lib 0.9 qw(fred)";
+eval "use test_use 0.9 qw(fred)";
 is ($@, '');
 
-if ($^O eq 'MacOS') {
-    is($INC[0], ":fred:");
-} else {
-    is($INC[0], "fred");
-}
+is("@test_use::got", "fred");
 
-eval "use lib 1.0 qw(joe)";
+eval "use test_use 1.0 qw(joe)";
 is ($@, '');
 
+is("@test_use::got", "joe");
 
-if ($^O eq 'MacOS') {
-    is($INC[0], ":joe:");
-} else {
-    is($INC[0], "joe");
-}
-
-
-eval "use lib 1.01 qw(freda)";
+eval "use test_use 1.01 qw(freda)";
 isnt($@, '');
 
-if ($^O eq 'MacOS') {
-    isnt($INC[0], ":freda:");
-} else {
-    isnt($INC[0], "freda");
-}
+is("@test_use::got", "joe");
 
 {
-    local $lib::VERSION = 35.36;
-    eval "use lib v33.55";
+    local $test_use::VERSION = 35.36;
+    eval "use test_use v33.55";
     is ($@, '');
 
-    eval "use lib v100.105";
-    like ($@, qr/lib version v100.105.0 required--this is only version v35\.360\.0/);
+    eval "use test_use v100.105";
+    like ($@, qr/test_use version v100.105.0 required--this is only version v35\.360\.0/);
 
-    eval "use lib 33.55";
+    eval "use test_use 33.55";
     is ($@, '');
 
-    eval "use lib 100.105";
-    like ($@, qr/lib version 100.105 required--this is only version 35.36/);
+    eval "use test_use 100.105";
+    like ($@, qr/test_use version 100.105 required--this is only version 35.36/);
 
-    local $lib::VERSION = '35.36';
-    eval "use lib v33.55";
+    local $test_use::VERSION = '35.36';
+    eval "use test_use v33.55";
     like ($@, '');
 
-    eval "use lib v100.105";
-    like ($@, qr/lib version v100.105.0 required--this is only version v35\.360\.0/);
+    eval "use test_use v100.105";
+    like ($@, qr/test_use version v100.105.0 required--this is only version v35\.360\.0/);
 
-    eval "use lib 33.55";
+    eval "use test_use 33.55";
     is ($@, '');
 
-    eval "use lib 100.105";
-    like ($@, qr/lib version 100.105 required--this is only version 35.36/);
+    eval "use test_use 100.105";
+    like ($@, qr/test_use version 100.105 required--this is only version 35.36/);
 
-    local $lib::VERSION = v35.36;
-    eval "use lib v33.55";
+    local $test_use::VERSION = v35.36;
+    eval "use test_use v33.55";
     is ($@, '');
 
-    eval "use lib v100.105";
-    like ($@, qr/lib version v100.105.0 required--this is only version v35\.36\.0/);
+    eval "use test_use v100.105";
+    like ($@, qr/test_use version v100.105.0 required--this is only version v35\.36\.0/);
 
-    eval "use lib 33.55";
+    eval "use test_use 33.55";
     is ($@, '');
 
-    eval "use lib 100.105";
-    like ($@, qr/lib version 100.105 required--this is only version v35.36/);
+    eval "use test_use 100.105";
+    like ($@, qr/test_use version 100.105 required--this is only version v35.36/);
 }
 
 
 {
     # Regression test for patch 14937: 
     #   Check that a .pm file with no package or VERSION doesn't core.
-    open F, ">xxx$$.pm" or die "Cannot open xxx$$.pm: $!\n";
-    print F "1;\n";
-    close F;
-    eval "use lib '.'; use xxx$$ 3;";
-    like ($@, qr/^xxx$$ defines neither package nor VERSION--version check failed at/);
-    unlink "xxx$$.pm";
+    # (git commit 2658f4d9934aba5f8b23afcc078dc12b3a40223)
+    eval "use test_use_14937 3";
+    like ($@, qr/^test_use_14937 defines neither package nor VERSION--version check failed at/);
 }
 
 my @ver = split /\./, sprintf "%vd", $^V;
Index: src/gnu/usr.bin/perl/t/io/dup.t
diff -u src/gnu/usr.bin/perl/t/io/dup.t:1.10 src/gnu/usr.bin/perl/t/io/dup.t:1.11
--- t/io/dup.t:1.10	Mon Oct 12 18:30:27 2009
+++ t/io/dup.t	Fri Sep 24 15:07:05 2010
@@ -35,16 +35,10 @@
 print `$cmd`;
 
 $cmd = sprintf "$echo 1>&2", 5;
-$cmd = sprintf $echo, 5 if $^O eq 'MacOS';  # don't know if we can do this ...
 print `$cmd`;
 
 system sprintf $echo, 6;
-if ($^O eq 'MacOS') {
-    system sprintf $echo, 7;
-}
-else {
-    system sprintf "$echo 1>&2", 7;
-}
+system sprintf "$echo 1>&2", 7;
 
 close(STDOUT) or die "Could not close: $!";
 close(STDERR) or die "Could not close: $!";
@@ -54,8 +48,7 @@
 
 if (($^O eq 'MSWin32') || ($^O eq 'NetWare')) { print `type $tempfile` }
 elsif ($^O eq 'VMS')   { system "type $tempfile.;" } # TYPE defaults to .LIS when there is no extension
-elsif ($^O eq 'MacOS') { system "catenate $tempfile" }
-else                   { system "cat $tempfile" }
+else { system "cat $tempfile" }
 
 print STDOUT "ok 8\n";
 
Index: src/gnu/usr.bin/perl/t/io/fs.t
diff -u src/gnu/usr.bin/perl/t/io/fs.t:1.10 src/gnu/usr.bin/perl/t/io/fs.t:1.11
--- t/io/fs.t:1.10	Mon Oct 12 18:30:27 2009
+++ t/io/fs.t	Fri Sep 24 15:07:05 2010
@@ -9,7 +9,6 @@
 use Config;
 use File::Spec::Functions;
 
-my $Is_MacOS  = ($^O eq 'MacOS');
 my $Is_VMSish = ($^O eq 'VMS');
 
 if (($^O eq 'MSWin32') || ($^O eq 'NetWare')) {
@@ -27,9 +26,8 @@
 my $accurate_timestamps =
     !($^O eq 'MSWin32' || $^O eq 'NetWare' ||
       $^O eq 'dos'     || $^O eq 'os2'     ||
-      $^O eq 'mint'    || $^O eq 'cygwin'  ||
-      $^O eq 'amigaos' || $wd =~ m#$Config{afsroot}/# ||
-      $Is_MacOS
+      $^O eq 'cygwin'  || $^O eq 'amigaos' ||
+	  $wd =~ m#$Config{afsroot}/#
      );
 
 if (defined &Win32::IsWinNT && Win32::IsWinNT()) {
@@ -64,9 +62,6 @@
     `if f\$search("$tmpdir.dir") .nes. "" then delete/nolog/noconfirm $tmpdir.dir;`;
     `create/directory [.$tmpdir]`;
 }
-elsif ($Is_MacOS) {
-    rmdir "$tmpdir"; mkdir "$tmpdir";
-}
 else {
     `rm -f $tmpdir 2>/dev/null; mkdir $tmpdir 2>/dev/null`;
 }
@@ -78,7 +73,7 @@
 umask(022);
 
 SKIP: {
-    skip "bogus umask", 1 if ($^O eq 'MSWin32') || ($^O eq 'NetWare') || ($^O eq 'epoc') || $Is_MacOS;
+    skip "bogus umask", 1 if ($^O eq 'MSWin32') || ($^O eq 'NetWare') || ($^O eq 'epoc');
 
     is((umask(0)&0777), 022, 'umask'),
 }
Index: src/gnu/usr.bin/perl/t/io/inplace.t
diff -u src/gnu/usr.bin/perl/t/io/inplace.t:1.9 src/gnu/usr.bin/perl/t/io/inplace.t:1.10
--- t/io/inplace.t:1.9	Mon Oct 12 18:30:27 2009
+++ t/io/inplace.t	Fri Sep 24 15:07:05 2010
@@ -4,7 +4,7 @@
 
 $^I = $^O eq 'VMS' ? '_bak' : '.bak';
 
-plan( tests => 2 );
+plan( tests => 6 );
 
 my @tfiles     = (tempfile(), tempfile(), tempfile());
 my @tfiles_bak = map "$_$^I", @tfiles;
@@ -33,3 +33,60 @@
      "foo\nfoo\nfoo\n", 
      "backup file contents stay the same" );
 
+SKIP:
+{
+    # based on code, dosish and epoc systems can't do no-backup inplace
+    # edits
+    $^O =~ /^(MSWin32|cygwin|uwin|dos|epoc|os2)$/
+	and skip("Can't inplace edit without backups on $^O", 4);
+    
+    our @ifiles = ( tempfile(), tempfile(), tempfile() );
+    
+    {
+	for my $file (@ifiles) {
+	    runperl( prog => 'print qq(bar\n);',
+		     args => [ '>', $file ] );
+	}
+	
+	local $^I = '';
+    local @ARGV = @ifiles;
+	
+	while (<>) {
+	    print "foo$_";
+	}
+	
+	is(scalar(@ARGV), 0, "consumed ARGV");
+	
+#	runperl may quote its arguments, so don't expect to be able
+#	to reuse things you send it.
+
+	my @my_ifiles = @ifiles;
+	is( runperl( prog => 'print<>;', args => \@my_ifiles ),
+	    "foobar\nfoobar\nfoobar\n",
+	    "normal inplace edit");
+    }
+    
+    # test * equivalency RT #70802
+    {
+	for my $file (@ifiles) {
+	    runperl( prog => 'print qq(bar\n);',
+		     args => [ '>', $file ] );
+	}
+	
+	local $^I = '*';
+	local @ARGV = @ifiles;
+	
+	while (<>) {
+	    print "foo$_";
+	}
+	
+	is(scalar(@ARGV), 0, "consumed ARGV");
+	
+	my @my_ifiles = @ifiles;
+	is( runperl( prog => 'print<>;', args => \@my_ifiles ),
+	    "foobar\nfoobar\nfoobar\n",
+	    "normal inplace edit");
+    }
+    
+    END { unlink_all(@ifiles); }
+}
Index: src/gnu/usr.bin/perl/t/io/open.t
diff -u src/gnu/usr.bin/perl/t/io/open.t:1.10 src/gnu/usr.bin/perl/t/io/open.t:1.11
--- t/io/open.t:1.10	Mon Oct 12 18:30:27 2009
+++ t/io/open.t	Fri Sep 24 15:07:05 2010
@@ -9,7 +9,6 @@
 $|  = 1;
 use warnings;
 use Config;
-$Is_MacOS = $^O eq 'MacOS';
 
 plan tests => 108;
 
@@ -84,9 +83,7 @@
     is( scalar @rows, 2,                '       readline, list context' );
     ok( close($f),                      '       close' );
 }
-SKIP: {
-    skip "Output for |- doesn't go to shell on MacOS", 5 if $Is_MacOS;
-
+{
     ok( open(my $f, '|-', <<EOC),     'open |-' );
     $Perl -pe "s/^not //"
 EOC
@@ -177,9 +174,7 @@
     ok( close($f),                      '       close' );
 }
 
-SKIP: {
-    skip "Output for |- doesn't go to shell on MacOS", 5 if $Is_MacOS;
-
+{
     ok( open(local $f, '|-', <<EOC),  'open local $f, "|-", ...' );
     $Perl -pe "s/^not //"
 EOC
Index: src/gnu/usr.bin/perl/t/io/pipe.t
diff -u src/gnu/usr.bin/perl/t/io/pipe.t:1.8 src/gnu/usr.bin/perl/t/io/pipe.t:1.9
--- t/io/pipe.t:1.8	Mon Sep 29 17:36:18 2008
+++ t/io/pipe.t	Fri Sep 24 15:07:05 2010
@@ -152,12 +152,11 @@
 
     SKIP: {
         # Sfio doesn't report failure when closing a broken pipe
-        # that has pending output.  Go figure.  MachTen doesn't either,
-        # but won't write to broken pipes, so nothing's pending at close.
+        # that has pending output.  Go figure.
         # BeOS will not write to broken pipes, either.
         # Nor does POSIX-BC.
         skip "Won't report failure on broken pipe", 1
-          if $Config{d_sfio} || $^O eq 'machten' || $^O eq 'beos' || 
+          if $Config{d_sfio} || $^O eq 'beos' ||
              $^O eq 'posix-bc';
 
         local $SIG{PIPE} = 'IGNORE';
Index: src/gnu/usr.bin/perl/t/io/tell.t
diff -u src/gnu/usr.bin/perl/t/io/tell.t:1.10 src/gnu/usr.bin/perl/t/io/tell.t:1.11
--- t/io/tell.t:1.10	Mon Oct 12 18:30:27 2009
+++ t/io/tell.t	Fri Sep 24 15:07:05 2010
@@ -11,7 +11,7 @@
 $TST = 'TST';
 
 $Is_Dosish = ($^O eq 'MSWin32' or $^O eq 'NetWare' or $^O eq 'dos' or
-              $^O eq 'os2' or $^O eq 'mint' or $^O eq 'cygwin' or
+              $^O eq 'os2' or $^O eq 'cygwin' or
               $^O =~ /^uwin/);
 
 open($TST, 'harness') || (die "Can't open harness");
Index: src/gnu/usr.bin/perl/t/lib/warnings/sv
diff -u src/gnu/usr.bin/perl/t/lib/warnings/sv:1.3 src/gnu/usr.bin/perl/t/lib/warnings/sv:1.4
--- t/lib/warnings/sv:1.3	Mon Sep 29 17:36:19 2008
+++ t/lib/warnings/sv	Fri Sep 24 15:07:07 2010
@@ -291,6 +291,16 @@
 $a = sprintf "%" ;
 printf F "%\x02" ;
 $a = sprintf "%\x02" ;
+printf F "%llz" ;
+$a = sprintf "%llz" ;
+printf F "%25llz" ;
+$a = sprintf "%25llz" ;
+printf F "%+2Lz" ;
+$a = sprintf "%+2Lz" ;
+printf F "%+2ll" ;
+$a = sprintf "%+2ll" ;
+printf F "%+2L\x03" ;
+$a = sprintf "%+2L\x03" ;
 no warnings 'printf' ;
 printf F "%z\n" ;
 $a = sprintf "%z" ;
@@ -298,6 +308,16 @@
 $a = sprintf "%" ;
 printf F "%\x02" ;
 $a = sprintf "%\x02" ;
+printf F "%llz" ;
+$a = sprintf "%llz" ;
+printf F "%25llz" ;
+$a = sprintf "%25llz" ;
+printf F "%+2Lz" ;
+$a = sprintf "%+2Lz" ;
+printf F "%+2ll" ;
+$a = sprintf "%+2ll" ;
+printf F "%+2L\x03" ;
+$a = sprintf "%+2L\x03" ;
 EXPECT
 Invalid conversion in printf: "%z" at - line 4.
 Invalid conversion in sprintf: "%z" at - line 5.
@@ -305,6 +325,16 @@
 Invalid conversion in sprintf: end of string at - line 7.
 Invalid conversion in printf: "%\002" at - line 8.
 Invalid conversion in sprintf: "%\002" at - line 9.
+Invalid conversion in printf: "%llz" at - line 10.
+Invalid conversion in sprintf: "%llz" at - line 11.
+Invalid conversion in printf: "%25llz" at - line 12.
+Invalid conversion in sprintf: "%25llz" at - line 13.
+Invalid conversion in printf: "%+2Lz" at - line 14.
+Invalid conversion in sprintf: "%+2Lz" at - line 15.
+Invalid conversion in printf: "%+2ll" at - line 16.
+Invalid conversion in sprintf: "%+2ll" at - line 17.
+Invalid conversion in printf: "%+2L\003" at - line 18.
+Invalid conversion in sprintf: "%+2L\003" at - line 19.
 ########
 # sv.c
 use warnings 'misc' ;
Index: src/gnu/usr.bin/perl/t/op/array.t
diff -u src/gnu/usr.bin/perl/t/op/array.t:1.10 src/gnu/usr.bin/perl/t/op/array.t:1.11
--- t/op/array.t:1.10	Mon Sep 29 17:36:19 2008
+++ t/op/array.t	Fri Sep 24 15:07:08 2010
@@ -7,7 +7,7 @@
 
 require 'test.pl';
 
-plan (125);
+plan (127);
 
 #
 # @foo, @bar, and @ary are also used from tie-stdarray after tie-ing them
@@ -21,6 +21,9 @@
 is($#ary, 3);
 is(join('',@ary), '1234');
 
+{
+    no warnings 'deprecated';
+
 $[ = 1;
 @ary = (1,2,3,4,5);
 is(join('',@ary), '12345');
@@ -70,6 +73,8 @@
 $r = join(',', $#bar, @bar);
 is($r, "2,0,,2");
 
+}
+
 $foo = 'now is the time';
 ok(scalar (($F1,$F2,$Etc) = ($foo =~ /^(\S+)\s+(\S+)\s*(.*)/)));
 is($F1, 'now');
@@ -119,7 +124,10 @@
 is($foo, 'b');
 
 @foo = ( 'foo', 'bar', 'burbl');
-push(foo, 'blah');
+{
+    no warnings 'deprecated';
+    push(foo, 'blah');
+}
 is($#foo, 3);
 
 # various AASSIGN_COMMON checks (see newASSIGNOP() in op.c)
@@ -252,6 +260,7 @@
 
 
 sub tary {
+  no warnings 'deprecated';
   local $[ = 10;
   my $five = 5;
   is ($tary[5], $tary[$five]);
@@ -417,6 +426,20 @@
     our($x,$y,$z) = (1..3);
     (our $y, our $z) = ($x,$y);
     is("$x $y $z", "1 1 2");
+}
+
+# [perl #70171]
+{
+ my $x = get_x(); my %x = %$x; sub get_x { %x=(1..4); return \%x };
+ is(
+   join(" ", map +($_,$x{$_}), sort keys %x), "1 2 3 4",
+  'bug 70171 (self-assignment via my %x = %$x)'
+ );
+ my $y = get_y(); my @y = @$y; sub get_y { @y=(1..4); return \@y };
+ is(
+  "@y", "1 2 3 4",
+  'bug 70171 (self-assignment via my @x = @$x)'
+ );
 }
 
 
Index: src/gnu/usr.bin/perl/t/op/assignwarn.t
diff -u src/gnu/usr.bin/perl/t/op/assignwarn.t:1.4 src/gnu/usr.bin/perl/t/op/assignwarn.t:1.5
--- t/op/assignwarn.t:1.4	Wed Dec  3 03:02:48 2003
+++ t/op/assignwarn.t	Fri Sep 24 15:07:08 2010
@@ -3,7 +3,7 @@
 #
 # Verify which OP= operators warn if their targets are undefined.
 # Based on redef.t, contributed by Graham Barr <Graham.Barr@tiuk.ti.com>
-#	-- Robin Barker <rmb@cise.npl.co.uk>
+#	-- Robin Barker 
 #
 
 BEGIN {
Index: src/gnu/usr.bin/perl/t/op/auto.t
diff -u src/gnu/usr.bin/perl/t/op/auto.t:1.8 src/gnu/usr.bin/perl/t/op/auto.t:1.9
--- t/op/auto.t:1.8	Mon Sep 29 17:36:19 2008
+++ t/op/auto.t	Fri Sep 24 15:07:08 2010
@@ -6,7 +6,7 @@
 }
 
 require "test.pl";
-plan( tests => 37 );
+plan( tests => 39 );
 
 $x = 10000;
 cmp_ok(0 + ++$x - 1,'==',10000,'scalar ++x - 1');
@@ -47,6 +47,8 @@
 # test magical autoincrement
 
 cmp_ok(++($foo = '99'), 'eq','100','99 incr 100');
+cmp_ok(++($foo = "99a"), 'eq','100','99a incr 100');
+cmp_ok(++($foo = "99\0a"), 'eq','100','99\0a incr 100');
 cmp_ok(++($foo = 'a0'), 'eq','a1','a0 incr a1');
 cmp_ok(++($foo = 'Az'), 'eq','Ba','Az incr Ba');
 cmp_ok(++($foo = 'zz'), 'eq','aaa','zzz incr aaa');
Index: src/gnu/usr.bin/perl/t/op/chop.t
diff -u src/gnu/usr.bin/perl/t/op/chop.t:1.10 src/gnu/usr.bin/perl/t/op/chop.t:1.11
--- t/op/chop.t:1.10	Mon Sep 29 17:36:19 2008
+++ t/op/chop.t	Fri Sep 24 15:07:08 2010
@@ -9,7 +9,7 @@
 plan tests => 139;
 
 $_ = 'abc';
-$c = do foo();
+$c = foo();
 is ($c . $_, 'cab', 'optimized');
 
 $_ = 'abc';
Index: src/gnu/usr.bin/perl/t/op/do.t
diff -u src/gnu/usr.bin/perl/t/op/do.t:1.8 src/gnu/usr.bin/perl/t/op/do.t:1.9
--- t/op/do.t:1.8	Mon Sep 29 17:36:19 2008
+++ t/op/do.t	Fri Sep 24 15:07:08 2010
@@ -29,17 +29,23 @@
     return $ok;
 }
 
-print "1..22\n";
+print "1..50\n";
 
 # Test do &sub and proper @_ handling.
 $_[0] = 0;
-$result = do foo1(1);
+{
+    no warnings 'deprecated';
+    $result = do foo1(1);
+}
 
 ok( $result eq 'value',  ":$result: eq :value:" );
 ok( $_[0] == 0 );
 
 $_[0] = 0;
-$result = do foo2(0,1,0);
+{
+    no warnings 'deprecated';
+    $result = do foo2(0,1,0);
+}
 ok( $result eq 'value', ":$result: eq :value:" );
 ok( $_[0] == 0 );
 
@@ -50,10 +56,16 @@
     ok 1 foreach @_;
 }
 
-do blather("ayep","sho nuff");
+{
+    no warnings 'deprecated';
+    do blather("ayep","sho nuff");
+}
 @x = ("jeepers", "okydoke");
 @y = ("uhhuh", "yeppers");
-do blather(@x,"noofie",@y);
+{
+    no warnings 'deprecated';
+    do blather(@x,"noofie",@y);
+}
 
 unshift @INC, '.';
 
@@ -91,6 +103,93 @@
 # [perl #19545]
 push @t, ($u = (do {} . "This should be pushed."));
 ok( $#t == 0, "empty do result value" );
+
+$zok = '';
+$owww = do { 1 if $zok };
+ok( $owww eq '', 'last is unless' );
+$owww = do { 2 unless not $zok };
+ok( $owww == 1, 'last is if not' );
+
+$zok = 'swish';
+$owww = do { 3 unless $zok };
+ok( $owww eq 'swish', 'last is unless' );
+$owww = do { 4 if not $zok };
+ok( $owww eq '', 'last is if not' );
+
+# [perl #38809]
+@a = (7);
+$x = sub { do { return do { @a } }; 2 }->();
+ok(defined $x && $x == 1, 'return do { } receives caller scalar context');
+@x = sub { do { return do { @a } }; 2 }->();
+ok("@x" eq "7", 'return do { } receives caller list context');
+
+@a = (7, 8);
+$x = sub { do { return do { 1; @a } }; 3 }->();
+ok(defined $x && $x == 2, 'return do { ; } receives caller scalar context');
+@x = sub { do { return do { 1; @a } }; 3 }->();
+ok("@x" eq "7 8", 'return do { ; } receives caller list context');
+
+@b = (11 .. 15);
+$x = sub { do { return do { 1; @a, @b } }; 3 }->();
+ok(defined $x && $x == 5, 'return do { ; , } receives caller scalar context');
+@x = sub { do { return do { 1; @a, @b } }; 3 }->();
+ok("@x" eq "7 8 11 12 13 14 15", 'return do { ; , } receives caller list context');
+
+$x = sub { do { return do { 1; @a }, do { 2; @b } }; 3 }->();
+ok(defined $x && $x == 5, 'return do { ; }, do { ; } receives caller scalar context');
+@x = sub { do { return do { 1; @a }, do { 2; @b } }; 3 }->();
+ok("@x" eq "7 8 11 12 13 14 15", 'return do { ; }, do { ; } receives caller list context');
+
+@a = (7, 8, 9);
+$x = sub { do { do { 1; return @a } }; 4 }->();
+ok(defined $x && $x == 3, 'do { return } receives caller scalar context');
+@x = sub { do { do { 1; return @a } }; 4 }->();
+ok("@x" eq "7 8 9", 'do { return } receives caller list context');
+
+@a = (7, 8, 9, 10);
+$x = sub { do { return do { 1; do { 2; @a } } }; 5 }->();
+ok(defined $x && $x == 4, 'return do { do { ; } } receives caller scalar context');
+@x = sub { do { return do { 1; do { 2; @a } } }; 5 }->();
+ok("@x" eq "7 8 9 10", 'return do { do { ; } } receives caller list context');
+
+# Do blocks created by constant folding
+# [perl #68108]
+$x = sub { if (1) { 20 } }->();
+ok($x == 20, 'if (1) { $x } receives caller scalar context');
+
+@a = (21 .. 23);
+$x = sub { if (1) { @a } }->();
+ok($x == 3, 'if (1) { @a } receives caller scalar context');
+@x = sub { if (1) { @a } }->();
+ok("@x" eq "21 22 23", 'if (1) { @a } receives caller list context');
+
+$x = sub { if (1) { 0; 20 } }->();
+ok($x == 20, 'if (1) { ...; $x } receives caller scalar context');
+
+@a = (24 .. 27);
+$x = sub { if (1) { 0; @a } }->();
+ok($x == 4, 'if (1) { ...; @a } receives caller scalar context');
+@x = sub { if (1) { 0; @a } }->();
+ok("@x" eq "24 25 26 27", 'if (1) { ...; @a } receives caller list context');
+
+$x = sub { if (1) { 0; 20 } else{} }->();
+ok($x == 20, 'if (1) { ...; $x } else{} receives caller scalar context');
+
+@a = (24 .. 27);
+$x = sub { if (1) { 0; @a } else{} }->();
+ok($x == 4, 'if (1) { ...; @a } else{} receives caller scalar context');
+@x = sub { if (1) { 0; @a } else{} }->();
+ok("@x" eq "24 25 26 27", 'if (1) { ...; @a } else{} receives caller list context');
+
+$x = sub { if (0){} else { 0; 20 } }->();
+ok($x == 20, 'if (0){} else { ...; $x } receives caller scalar context');
+
+@a = (24 .. 27);
+$x = sub { if (0){} else { 0; @a } }->();
+ok($x == 4, 'if (0){} else { ...; @a } receives caller scalar context');
+@x = sub { if (0){} else { 0; @a } }->();
+ok("@x" eq "24 25 26 27", 'if (0){} else { ...; @a } receives caller list context');
+
 
 END {
     1 while unlink("$$.16", "$$.17", "$$.18");
Index: src/gnu/usr.bin/perl/t/op/each.t
diff -u src/gnu/usr.bin/perl/t/op/each.t:1.6 src/gnu/usr.bin/perl/t/op/each.t:1.7
--- t/op/each.t:1.6	Tue Mar 28 19:23:12 2006
+++ t/op/each.t	Fri Sep 24 15:07:08 2010
@@ -6,7 +6,7 @@
     require './test.pl';
 }
 
-plan tests => 39;
+plan tests => 54;
 
 $h{'abc'} = 'ABC';
 $h{'def'} = 'DEF';
@@ -106,16 +106,22 @@
 
 is (keys(%hash), 10, "keys (%hash)");
 
-is (keys(hash), 10, "keys (hash)");
+{
+    no warnings 'deprecated';
+    is (keys(hash), 10, "keys (hash)");
+}
 
 $i = 0;
 %h = (a => A, b => B, c=> C, d => D, abc => ABC);
-@keys = keys(h);
-@values = values(h);
-while (($key, $value) = each(h)) {
+{
+    no warnings 'deprecated';
+    @keys = keys(h);
+    @values = values(h);
+    while (($key, $value) = each(h)) {
 	if ($key eq $keys[$i] && $value eq $values[$i] && $key eq lc($value)) {
 		$i++;
 	}
+    }
 }
 is ($i, 5);
 
@@ -187,3 +193,48 @@
     is($u{$u1}, 3, "U+0100        -> 3 ");
     is($u{$b1}, 4, "U+00C4 U+0080 -> 4");
 }
+
+# test for syntax errors
+for my $k (qw(each keys values)) {
+    eval $k;
+    like($@, qr/^Not enough arguments for $k/, "$k demands argument");
+}
+
+{
+    my %foo=(1..10);
+    my ($k,$v);
+    my $count=keys %foo;
+    my ($k1,$v1)=each(%foo);
+    my $yes = 0;
+    if (%foo) { $yes++ }
+    my ($k2,$v2)=each(%foo);
+    my $rest=0;
+    while (each(%foo)) {$rest++};
+    is($yes,1,"if(%foo) was true");
+    isnt($k1,$k2,"if(%foo) didnt mess with each (key)");
+    isnt($v1,$v2,"if(%foo) didnt mess with each (value)");
+    is($rest,3,"Got the expect number of keys");
+    my $hsv=1 && %foo;
+    like($hsv,'/',"Got bucket stats from %foo in scalar assignment context");
+    my @arr=%foo&&%foo;
+    is(@arr,10,"Got expected number of elements in list context");
+}    
+{
+    our %foo=(1..10);
+    my ($k,$v);
+    my $count=keys %foo;
+    my ($k1,$v1)=each(%foo);
+    my $yes = 0;
+    if (%foo) { $yes++ }
+    my ($k2,$v2)=each(%foo);
+    my $rest=0;
+    while (each(%foo)) {$rest++};
+    is($yes,1,"if(%foo) was true");
+    isnt($k1,$k2,"if(%foo) didnt mess with each (key)");
+    isnt($v1,$v2,"if(%foo) didnt mess with each (value)");
+    is($rest,3,"Got the expect number of keys");
+    my $hsv=1 && %foo;
+    like($hsv,'/',"Got bucket stats from %foo in scalar assignment context");
+    my @arr=%foo&&%foo;
+    is(@arr,10,"Got expected number of elements in list context");
+}    
Index: src/gnu/usr.bin/perl/t/op/eval.t
diff -u src/gnu/usr.bin/perl/t/op/eval.t:1.8 src/gnu/usr.bin/perl/t/op/eval.t:1.9
--- t/op/eval.t:1.8	Mon Oct 12 18:30:27 2009
+++ t/op/eval.t	Fri Sep 24 15:07:08 2010
@@ -6,7 +6,7 @@
     require './test.pl';
 }
 
-print "1..99\n";
+print "1..106\n";
 
 eval 'print "ok 1\n";';
 
@@ -557,3 +557,48 @@
     print "ok $test - RT 63110\n";
     $test++;
 }
+
+curr_test($test);
+
+{
+    # test that the CV compiled for the eval is freed by checking that no additional 
+    # reference to outside lexicals are made.
+    my $x;
+    is(Internals::SvREFCNT($x), 1, "originally only 1 referece");
+    eval '$x';
+    is(Internals::SvREFCNT($x), 1, "execution eval doesn't create new references");
+}
+
+fresh_perl_is(<<'EOP', "ok\n", undef, 'RT #70862');
+$::{'@'}='';
+eval {};
+print "ok\n";
+EOP
+
+fresh_perl_is(<<'EOP', "ok\n", undef, 'variant of RT #70862');
+eval {
+    $::{'@'}='';
+};
+print "ok\n";
+EOP
+
+fresh_perl_is(<<'EOP', "ok\n", undef, 'related to RT #70862');
+$::{'@'}=\3;
+eval {};
+print "ok\n";
+EOP
+
+fresh_perl_is(<<'EOP', "ok\n", undef, 'related to RT #70862');
+eval {
+    $::{'@'}=\3;
+};
+print "ok\n";
+EOP
+
+    fresh_perl_is(<<'EOP', "ok\n", undef, 'segfault on syntax errors in block evals');
+# localize the hits hash so the eval ends up with the pad offset of a copy of it in its targ
+BEGIN { $^H |= 0x00020000 }
+eval q{ eval { + } };
+print "ok\n";
+EOP
+
Index: src/gnu/usr.bin/perl/t/op/exec.t
diff -u src/gnu/usr.bin/perl/t/op/exec.t:1.7 src/gnu/usr.bin/perl/t/op/exec.t:1.8
--- t/op/exec.t:1.7	Mon Oct 12 18:30:27 2009
+++ t/op/exec.t	Fri Sep 24 15:07:08 2010
@@ -36,8 +36,6 @@
 my $Is_VMS   = $^O eq 'VMS';
 my $Is_Win32 = $^O eq 'MSWin32';
 
-skip_all("Tests mostly usesless on MacOS") if $^O eq 'MacOS';
-
 plan(tests => 22);
 
 my $Perl = which_perl();
Index: src/gnu/usr.bin/perl/t/op/flip.t
diff -u src/gnu/usr.bin/perl/t/op/flip.t:1.8 src/gnu/usr.bin/perl/t/op/flip.t:1.9
--- t/op/flip.t:1.8	Mon Sep 29 17:36:19 2008
+++ t/op/flip.t	Fri Sep 24 15:07:08 2010
@@ -1,19 +1,22 @@
 #!./perl
 
-chdir 't' if -d 't';
+BEGIN {
+    require "test.pl";
+}
 
-print "1..15\n";
+plan(11);
 
 @a = (1,2,3,4,5,6,7,8,9,10,11,12);
-
+@b = ();
 while ($_ = shift(@a)) {
-    if ($x = /4/../8/) { $z = $x; print "ok ", $x + 0, "\n"; }
+    if ($x = /4/../8/) { $z = $x; push @b, $x + 0; }
     $y .= /1/../2/;
 }
+is(join("*", @b), "1*2*3*4*5");
 
-if ($z eq '5E0') {print "ok 6\n";} else {print "not ok 6\n";}
+is($z, '5E0');
 
-if ($y eq '12E0123E0') {print "ok 7\n";} else {print "not ok 7\n";}
+is($y, '12E0123E0');
 
 @a = ('a','b','c','d','e','f','g');
 
@@ -26,41 +29,36 @@
 }
 $x = ($foo =~ y/\n/\n/);
 
-if ($x eq 3) {print "ok 8\n";} else {print "not ok 8 $x:$foo:\n";}
+is($x, 3);
 
 $x = 3.14;
-if (($x...$x) eq "1") {print "ok 9\n";} else {print "not ok 9\n";}
+ok(($x...$x) eq "1");
 
 {
     # coredump reported in bug 20001018.008
     readline(UNKNOWN);
     $. = 1;
     $x = 1..10;
-    print "ok 10\n";
+    ok(1);
 }
 
 }
 
-if (!defined $.) { print "ok 11\n" } else { print "not ok 11 # $.\n" }
+ok(!defined $.);
 
 use warnings;
 my $warn='';
 $SIG{__WARN__} = sub { $warn .= join '', @_ };
 
-if (0..2) { print "ok 12\n" } else { print "not ok 12\n" }
+ok(scalar(0..2));
 
-if ($warn =~ /uninitialized/) { print "ok 13\n" } else { print "not ok 13\n" }
+like($warn, qr/uninitialized/);
 $warn = '';
 
 $x = "foo".."bar";
 
-if ((() = ($warn =~ /isn't numeric/g)) == 2) {
-    print "ok 14\n"
-}
-else {
-    print "not ok 14\n"
-}
+ok((() = ($warn =~ /isn't numeric/g)) == 2);
 $warn = '';
 
 $. = 15;
-if (15..0) { print "ok 15\n" } else { print "not ok 15\n" }
+ok(scalar(15..0));
Index: src/gnu/usr.bin/perl/t/op/fork.t
diff -u src/gnu/usr.bin/perl/t/op/fork.t:1.9 src/gnu/usr.bin/perl/t/op/fork.t:1.10
--- t/op/fork.t:1.9	Mon Oct 12 18:30:27 2009
+++ t/op/fork.t	Fri Sep 24 15:07:08 2010
@@ -462,3 +462,21 @@
 EXPECT
 1
 1
+########
+# [perl #72604] @DB::args stops working across Win32 fork
+$|=1;
+sub f {
+    if ($pid = fork()) {
+	print "waitpid() returned ok\n" if waitpid($pid,0) == $pid;
+    }
+    else {
+	package DB;
+	my @c = caller(0);
+	print "child: called as [$c[3](", join(',',@DB::args), ")]\n";
+	exit(0);
+    }
+}
+f("foo", "bar");
+EXPECT
+child: called as [main::f(foo,bar)]
+waitpid() returned ok
Index: src/gnu/usr.bin/perl/t/op/glob.t
diff -u src/gnu/usr.bin/perl/t/op/glob.t:1.7 src/gnu/usr.bin/perl/t/op/glob.t:1.8
--- t/op/glob.t:1.7	Mon Sep 29 17:36:19 2008
+++ t/op/glob.t	Fri Sep 24 15:07:08 2010
@@ -6,7 +6,7 @@
 }
 
 require 'test.pl';
-plan( tests => 15 );
+plan( tests => 16 );
 
 @oops = @ops = <op/*>;
 
@@ -18,11 +18,6 @@
   map { $files{lc($_)}++ } <[.op]*>;
   map { s/;.*$//; delete $files{lc($_)}; } split /[\n]/, `directory/noheading/notrailing/versions=1 [.op]`,
 }
-elsif ($^O eq 'MacOS') {
-  @oops = @ops = <:op:*>;
-  map { $files{$_}++ } <:op:*>;
-  map { delete $files{$_} } split /[\s\n]/, `echo :op:\xc5`;
-}
 else {
   map { $files{$_}++ } <op/*>;
   map { delete $files{$_} } split /[\s\n]/, `echo op/*`;
@@ -32,22 +27,15 @@
 cmp_ok($/,'eq',"\n",'sane input record separator');
 
 $not = '';
-if ($^O eq 'MacOS') {
-    while (<jskdfjskdfj* :op:* jskdjfjkosvk*>) {
-	$not = "not " unless $_ eq shift @ops;
-	$not = "not at all " if $/ eq "\0";
-    }
-} else {
-    while (<jskdfjskdfj* op/* jskdjfjkosvk*>) {
-	$not = "not " unless $_ eq shift @ops;
-	$not = "not at all " if $/ eq "\0";
-    }
+while (<jskdfjskdfj* op/* jskdjfjkosvk*>) {
+    $not = "not " unless $_ eq shift @ops;
+    $not = "not at all " if $/ eq "\0";
 }
 ok(!$not,"glob amid garbage [$not]");
 
 cmp_ok($/,'eq',"\n",'input record separator still sane');
 
-$_ = $^O eq 'MacOS' ? ":op:*" : "op/*";
+$_ = "op/*";
 @glops = glob $_;
 cmp_ok("@glops",'eq',"@oops",'glob operator 1');
 
@@ -63,7 +51,15 @@
     undef %File::Glob::;
     ++$i;
 }
-cmp_ok($i,'==',2,'remore File::Glob stash');
+cmp_ok($i,'==',2,'remove File::Glob stash');
+
+# a more sinister version of the same test (crashes from 5.8 to 5.13.1)
+{
+    undef %File::Glob::;
+    local %CORE::GLOBAL::;
+    eval "<.>";
+    ok(!length($@),"remove File::Glob stash *and* CORE::GLOBAL::glob");
+}
 
 # ... while ($var = glob(...)) should test definedness not truth
 
Index: src/gnu/usr.bin/perl/t/op/goto.t
diff -u src/gnu/usr.bin/perl/t/op/goto.t:1.11 src/gnu/usr.bin/perl/t/op/goto.t:1.12
--- t/op/goto.t:1.11	Mon Oct 12 18:30:27 2009
+++ t/op/goto.t	Fri Sep 24 15:07:08 2010
@@ -10,28 +10,37 @@
 
 use warnings;
 use strict;
-plan tests => 58;
+plan tests => 67;
 our $TODO;
 
+my $deprecated = 0;
+local $SIG{__WARN__} = sub { if ($_[0] =~ m/jump into a construct/) { $deprecated++; } else { warn $_[0] } };
+
 our $foo;
 while ($?) {
     $foo = 1;
   label1:
+    is($deprecated, 1);
+    $deprecated = 0;
     $foo = 2;
     goto label2;
 } continue {
     $foo = 0;
     goto label4;
   label3:
+    is($deprecated, 1);
+    $deprecated = 0;
     $foo = 4;
     goto label4;
 }
+is($deprecated, 0);
 goto label1;
 
 $foo = 3;
 
 label2:
 is($foo, 2, 'escape while loop');
+is($deprecated, 0);
 goto label3;
 
 label4:
@@ -60,7 +69,7 @@
 exit;
 
 FINALE:
-is(curr_test(), 16, 'FINALE');
+is(curr_test(), 20, 'FINALE');
 
 # does goto LABEL handle block contexts correctly?
 # note that this scope-hopping differs from last & next,
@@ -174,13 +183,18 @@
 	A: { if ($false) { redo A; B: $ok = 1; redo A; } }
 	goto B unless $count++;
     }
+    is($deprecated, 0);
     a();
     ok($ok, '#19061 loop label wiped away by goto');
+    is($deprecated, 1);
+    $deprecated = 0;
 
     $ok = 0;
     my $p;
     for ($p=1;$p && goto A;$p=0) { A: $ok = 1 }
     ok($ok, 'weird case of goto and for(;;) loop');
+    is($deprecated, 1);
+    $deprecated = 0;
 }
 
 # bug #9990 - don't prematurely free the CV we're &going to.
@@ -250,7 +264,7 @@
 
 bypass:
 
-is(curr_test(), 5, 'eval "goto $x"');
+is(curr_test(), 9, 'eval "goto $x"');
 
 # Test autoloading mechanism.
 
@@ -459,3 +473,13 @@
     }
 }
 
+is($deprecated, 0);
+
+#74290
+{
+    my $x;
+    my $y;
+    F1:++$x and eval 'return if ++$y == 10; goto F1;';
+    is($x, 10,
+       'labels outside evals can be distinguished from the start of the eval');
+}
Index: src/gnu/usr.bin/perl/t/op/groups.t
diff -u src/gnu/usr.bin/perl/t/op/groups.t:1.8 src/gnu/usr.bin/perl/t/op/groups.t:1.9
--- t/op/groups.t:1.8	Mon Oct 12 18:30:27 2009
+++ t/op/groups.t	Fri Sep 24 15:07:08 2010
@@ -1,34 +1,157 @@
 #!./perl
-
-$ENV{PATH} ="/bin:/usr/bin:/usr/xpg4/bin:/usr/ucb" .
-    exists $ENV{PATH} ? ":$ENV{PATH}" : "" unless $^O eq 'VMS';
-$ENV{LC_ALL} = "C"; # so that external utilities speak English
-$ENV{LANGUAGE} = 'C'; # GNU locale extension
-
 BEGIN {
+    if ( $^O eq 'VMS' ) {
+        my $p = "/bin:/usr/bin:/usr/xpg4/bin:/usr/ucb";
+        if ( $ENV{PATH} ) {
+            $p .= ":$ENV{PATH}";
+        }
+        $ENV{PATH} = $p;
+    }
+    $ENV{LC_ALL} = "C"; # so that external utilities speak English
+    $ENV{LANGUAGE} = 'C'; # GNU locale extension
+
     chdir 't';
     @INC = '../lib';
+}
+use 5.010;
+use strict;
+use Config ();
+use POSIX ();
+
+unless (eval { my($foo) = getgrgid(0); 1 }) {
+    quit( "getgrgid() not implemented" );
+}
+
+quit("No `id' or `groups'") if
+    $^O eq 'MSWin32'
+    || $^O eq 'NetWare'
+    || $^O eq 'VMS'
+    || $^O =~ /lynxos/i;
+
+Test();
+exit;
+
+
 
-    require Config;
-    if ($@) {
-	print "1..0 # Skip: no Config\n";
-    } else {
-	Config->import;
+sub Test {
+
+    # Get our supplementary groups from the system by running commands
+    # like `id -a'.
+    my ( $groups_command, $groups_string ) = system_groups()
+        or quit( "No `id' or `groups'" );
+    my @extracted_groups = extract_system_groups( $groups_string )
+        or quit( "Can't parse `${groups_command}'" );
+
+    my $pwgid = $( + 0;
+    my ($pwgnam) = getgrgid($pwgid);
+    $pwgnam //= '';
+    print "# pwgid=$pwgid pwgnam=$pwgnam \$(=$(\n";
+
+    # Get perl's supplementary groups by looking at $(
+    my ( $gid_count, $all_perl_groups ) = perl_groups();
+    my %basegroup = basegroups( $pwgid, $pwgnam );
+    my @extracted_supplementary_groups = remove_basegroup( \ %basegroup, \ @extracted_groups );
+
+    print "1..2\n";
+
+
+    # Test: The supplementary groups in $( should match the
+    # getgroups(2) kernal API call.
+    #
+    my $ngroups_max = posix_ngroups_max();
+    if ( defined $ngroups_max && $ngroups_max < @extracted_groups ) {
+        # Some OSes (like darwin)but conceivably others might return
+        # more groups from `id -a' than can be handled by the
+        # kernel. On darwin, NGROUPS_MAX is 16 and 12 are taken up for
+        # the system already.
+        #
+        # There is more fall-out from this than just Perl's unit
+        # tests. You may be a member of a group according to Active
+        # Directory (or whatever) but the OS won't respect it because
+        # it's the 17th (or higher) group and there's no space to
+        # store your membership.
+        print "ok 1 # SKIP Your platform's `$groups_command' is broken\n";
     }
+
+    elsif ( darwin() ) {
+        # darwin uses getgrouplist(3) or an Open Directory API within
+        # /usr/bin/id and /usr/bin/groups which while "nice" isn't
+        # accurate for this test. The hard, real, list of groups we're
+        # running in derives from getgroups(2) and is not dynamic but
+        # the Libc API getgrouplist(3) is.
+        #
+        # In practical terms, this meant that while `id -a' can be
+        # relied on in other OSes to purely use getgroups(2) and show
+        # us what's real, darwin will use getgrouplist(3) to show us
+        # what might be real if only we'd open a new console.
+        #
+        print "ok 1 # SKIP darwin's `${groups_command}' can't be trusted\n";
+    }
+
+    else {
+
+        # Read $( but ignore any groups in $( that we failed to parse
+        # successfully out of the `id -a` mess.
+        #
+        my @perl_groups = remove_unparsed_entries( \ @extracted_groups,
+                                                   \ @$all_perl_groups );
+        my @supplementary_groups = remove_basegroup( \ %basegroup,
+                                                     \ @perl_groups );
+
+        my $ok1 = 0;
+        if ( match_groups( \ @supplementary_groups,
+                           \ @extracted_supplementary_groups,
+                           $pwgid ) ) {
+            print "ok 1\n";
+            $ok1 = 1;
+        }
+        elsif ( cygwin_nt() ) {
+            %basegroup = unixy_cygwin_basegroups();
+            @extracted_supplementary_groups = remove_basegroup( \ %basegroup, \ @extracted_groups );
+
+            if ( match_groups( \ @supplementary_groups,
+                               \ @extracted_supplementary_groups,
+                               $pwgid ) ) {
+                print "ok 1 # This Cygwin behaves like Unix (Win2k?)\n";
+                $ok1 = 1;
+            }
+        }
+
+        unless ( $ok1 ) {
+
+        }
+    }
+
+    # multiple 0's indicate GROUPSTYPE is currently long but should be short
+    $gid_count->{0} //= 0;
+    if ( 0 == $pwgid || $gid_count->{0} < 2 ) {
+        print "ok 2\n";
+    }
+    else {
+        print "not ok 2 (groupstype should be type short, not long)\n";
+    }
+
+    return;
 }
 
+# Cleanly abort this entire test file
 sub quit {
-    print "1..0 # Skip: no `id` or `groups`\n";
+    print "1..0 # SKIP: @_\n";
     exit 0;
 }
 
-unless (eval { getgrgid(0); 1 }) {
-    print "1..0 # Skip: getgrgid() not implemented\n";
-    exit 0;
-}
+# Get the system groups and the command used to fetch them.
+#
+sub system_groups {
+    my ( $cmd, $groups_string ) = _system_groups();
+
+    if ( $groups_string ) {
+        chomp $groups_string;
+        diag_variable( groups => $groups_string );
+    }
 
-quit() if (($^O eq 'MSWin32' || $^O eq 'NetWare' || $^O eq 'VMS')
-           or $^O =~ /lynxos/i);
+    return ( $cmd, $groups_string );
+}
 
 # We have to find a command that prints all (effective
 # and real) group names (not ids).  The known commands are:
@@ -46,30 +169,61 @@
 # foo bar zot				# accept
 # foo 22 42 bar zot			# accept
 # 1 22 42 2 3				# reject
-# groups=(42),foo(1),bar(2),zot me(3)	# parse
-# groups=22,42,1(foo),2(bar),3(zot me)	# parse
+# groups=(42),foo(1),bar(2),zot me(3)	# parsed by $GROUP_RX1
+# groups=22,42,1(foo),2(bar),3(zot(me))	# parsed by $GROUP_RX2
 #
 # and the groups= might be after, before, or between uid=... and gid=...
+use constant GROUP_RX1 => qr/
+    ^
+    (?<gr_name>.+)
+    \(
+        (?<gid>\d+)
+    \)
+    $
+/x;
+use constant GROUP_RX2 => qr/
+    ^
+    (?<gid>\d+)
+    \(
+        (?<gr_name>.+)
+    \)
+    $
+/x;
+sub _system_groups {
+    my $cmd;
+    my $str;
 
-GROUPS: {
     # prefer 'id' over 'groups' (is this ever wrong anywhere?)
     # and 'id -a' over 'id -Gn' (the former is good about spaces in group names)
-    if (($groups = `id -a 2>/dev/null`) ne '') {
-	# $groups is of the form:
-	# uid=39957(gsar) gid=22(users) groups=33536,39181,22(users),0(root),1067(dev)
-	# FreeBSD since 6.2 has a fake id -a:
-	# uid=1001(tobez) gid=20(staff) groups=20(staff), 0(wheel), 68(dialer)
-	last GROUPS if $groups =~ /groups=/;
-    }
-    if (($groups = `id -Gn 2>/dev/null`) ne '') {
-	# $groups could be of the form:
-	# users 33536 39181 root dev
-	last GROUPS if $groups !~ /^(\d|\s)+$/;
-    }
-    if (($groups = `groups 2>/dev/null`) ne '') {
-	# may not reflect all groups in some places, so do a sanity check
-	if (-d '/afs') {
-	    print <<EOM;
+
+    $cmd = 'id -a 2>/dev/null || id 2>/dev/null';
+    $str = `$cmd`;
+    if ( $str && $str =~ /groups=/ ) {
+        # $str is of the form:
+        # uid=39957(gsar) gid=22(users) groups=33536,39181,22(users),0(root),1067(dev)
+        # FreeBSD since 6.2 has a fake id -a:
+        # uid=1001(tobez) gid=20(staff) groups=20(staff), 0(wheel), 68(dialer)
+        # On AIX it's id
+        #
+        # Linux may also have a context= field
+
+        return ( $cmd, $str );
+    }
+
+    $cmd = 'id -Gn 2>/dev/null';
+    $str = `$cmd`;
+    if ( $str && $str !~ /^[\d\s]$/ ) {
+        # $str could be of the form:
+        # users 33536 39181 root dev
+        return ( $cmd, $str );
+    }
+
+    $cmd = 'groups 2>/dev/null';
+    $str = `$cmd`;
+    if ( $str ) {
+        # may not reflect all groups in some places, so do a sanity check
+        if (-d '/afs') {
+            print <<EOM;
 # These test results *may* be bogus, as you appear to have AFS,
 # and I can't find a working 'id' in your PATH (which I have set
 # to '$ENV{PATH}').
@@ -78,105 +232,186 @@
 # on this platform to find *all* the groups that an arbitrary
 # user may belong to, using the 'perlbug' program.
 EOM
-	}
-	last GROUPS;
+        }
+        return ( $cmd, $str );
     }
-    # Okay, not today.
-    quit();
-}
 
-chomp($groups);
+    return ();
+}
 
-print "# groups = $groups\n";
-
-# Remember that group names can contain whitespace, '-', et cetera.
-# That is: do not \w, do not \S.
-if ($groups =~ /groups=(.+)( [ug]id=|$)/) {
-    my $gr = $1;
-    my @g0 = split /, ?/, $gr;
-    my @g1;
-    # prefer names over numbers
-    for (@g0) {
-	# 42(zot me)
-	if (/^(\d+)(?:\(([^)]+)\))?/) {
-	    push @g1, ($2 || $1);
-	}
-	# zot me(42)
-	elsif (/^([^(]*)\((\d+)\)/) {
-	    push @g1, ($1 || $2);
-	}
-	else {
-	    print "# ignoring group entry [$_]\n";
-	}
-    }
-    print "# groups=$gr\n";
-    print "# g0 = @g0\n";
-    print "# g1 = @g1\n";
-    $groups = "@g1";
-}
-
-print "1..2\n";
-
-$pwgid = $( + 0;
-($pwgnam) = getgrgid($pwgid);
-$seen{$pwgid}++;
-
-print "# pwgid = $pwgid, pwgnam = $pwgnam\n";
-
-for (split(' ', $()) {
-    ($group) = getgrgid($_);
-    next if (! defined $group or ! grep { $_ eq $group } @gr) and $seen{$_}++;
-    if (defined $group) {
-	push(@gr, $group);
+# Convert the strings produced by parsing `id -a' into a list of group
+# names
+sub extract_system_groups {
+    my ( $groups_string ) = @_;
+
+    # Remember that group names can contain whitespace, '-', '(parens)',
+    # et cetera. That is: do not \w, do not \S.
+    my @extracted;
+
+    my @fields = split /\b(\w+=)/, $groups_string;
+    my $gr;
+    for my $i (0..@fields-2) {
+        if ($fields[$i] eq 'groups=') {
+            $gr = $fields[$i+1];
+            $gr =~ s/ $//;
+            last;
+        }
     }
-    else {
-	push(@gr, $_);
+    if (defined $gr) {
+        my @g = split m{, ?}, $gr;
+        # prefer names over numbers
+        for (@g) {
+            if ( $_ =~ GROUP_RX1() || $_ =~ GROUP_RX2() ) {
+                push @extracted, $+{gr_name} || $+{gid};
+            }
+            else {
+                print "# ignoring group entry [$_]\n";
+            }
+        }
+
+        diag_variable( gr => $gr );
+        diag_variable( g => join ',', @g );
+        diag_variable( ex_gr => join ',', @extracted );
     }
-}
 
-print "# gr = @gr\n";
+    return @extracted;
+}
 
-my %did;
-if ($^O =~ /^(?:uwin|cygwin|interix|solaris|linux)$/) {
-	# Or anybody else who can have spaces in group names.
-	$gr1 = join(' ', grep(!$did{$_}++, sort split(' ', join(' ', @gr))));
-} else {
-	# Don't assume that there aren't duplicate groups
-	$gr1 = join(' ', sort grep defined $_ && !$did{$_}++, @gr);
+# Get the POSIX value NGROUPS_MAX.
+sub posix_ngroups_max {
+    return eval {
+        POSIX::NGROUPS_MAX();
+    };
 }
 
-if ($Config{myuname} =~ /^cygwin_nt/i) { # basegroup on CYGWIN_NT has id = 0.
-    @basegroup{$pwgid,$pwgnam} = (0,0);
-} else {
-    @basegroup{$pwgid,$pwgnam} = (1,1);
+# Test if this is Apple's darwin
+sub darwin {
+    # Observed 'darwin-2level'
+    return $Config::Config{myuname} =~ /^darwin/;
 }
-$gr2 = join(' ', grep(!$basegroup{$_}++, sort split(' ',$groups)));
 
-my $ok1 = 0;
-if ($gr1 eq $gr2 || ($gr1 eq '' && $gr2 eq $pwgid)) {
-    print "ok 1\n";
-    $ok1++;
+# Test if this is Cygwin
+sub cygwin_nt {
+    return $Config::Config{myuname} =~ /^cygwin_nt/i;
 }
-elsif ($Config{myuname} =~ /^cygwin_nt/i) { # basegroup on CYGWIN_NT has id = 0.
-    # Retry in default unix mode
-    %basegroup = ( $pwgid => 1, $pwgnam => 1 );
-    $gr2 = join(' ', grep(!$basegroup{$_}++, sort split(' ',$groups)));
-    if ($gr1 eq $gr2 || ($gr1 eq '' && $gr2 eq $pwgid)) {
-	print "ok 1 # This Cygwin behaves like Unix (Win2k?)\n";
-	$ok1++;
+
+# Get perl's supplementary groups and the number of times each gid
+# appeared.
+sub perl_groups {
+    # Lookup perl's own groups from $(
+    my @gids = split ' ', $(;
+    my %gid_count;
+    my @gr_name;
+    for my $gid ( @gids ) {
+        ++ $gid_count{$gid};
+
+        my ($group) = getgrgid $gid;
+
+        # Why does this test prefer to not test groups which we don't have
+        # a name for? One possible answer is that my primary group comes
+        # from from my entry in the user database but isn't mentioned in
+        # the group database.  Are there more reasons?
+        next if ! defined $group;
+
+
+        push @gr_name, $group;
     }
+
+    diag_variable( gr_name => join ',', @gr_name );
+
+    return ( \ %gid_count, \ @gr_name );
 }
-unless ($ok1) {
-    print "#gr1 is <$gr1>\n";
-    print "#gr2 is <$gr2>\n";
-    print "not ok 1\n";
-}
 
-# multiple 0's indicate GROUPSTYPE is currently long but should be short
+# Remove entries from our parsing of $( that don't appear in our
+# parsing of `id -a`.
+sub remove_unparsed_entries {
+    my ( $extracted_groups, $perl_groups ) = @_;
+
+    my %was_extracted =
+        map { $_ => 1 }
+        @$extracted_groups;
 
-if ($pwgid == 0 || $seen{0} < 2) {
-    print "ok 2\n";
+    return
+        grep { $was_extracted{$_} }
+        @$perl_groups;
 }
-else {
-    print "not ok 2 (groupstype should be type short, not long)\n";
+
+# Get a list of base groups. I'm not sure why cygwin by default is
+# skipped here.
+sub basegroups {
+    my ( $pwgid, $pwgnam ) = @_;
+
+    if ( cygwin_nt() ) {
+        return;
+    }
+    else {
+        return (
+            $pwgid  => 1,
+            $pwgnam => 1,
+        );
+    }
 }
+
+# Cygwin might have another form of basegroup which we should actually use
+sub unixy_cygwin_basegroups {
+    my ( $pwgid, $pwgnam ) = @_;
+    return (
+        $pwgid  => 1,
+        $pwgnam => 1,
+    );
+}
+
+# Filter a full list of groups and return only the supplementary
+# gorups.
+sub remove_basegroup {
+    my ( $basegroups, $groups ) = @_;
+
+    return
+        grep { ! $basegroups->{$_} }
+        @$groups;
+}
+
+# Test supplementary groups to see if they're a close enough match or
+# if there aren't any supplementary groups then validate the current
+# group against $(.
+sub match_groups {
+    my ( $supplementary_groups, $extracted_supplementary_groups, $pwgid ) = @_;
+
+    # Compare perl vs system groups
+    my %g;
+    $g{$_}[0] = 1 for @$supplementary_groups;
+    $g{$_}[1] = 1 for @$extracted_supplementary_groups;
+
+    # Find any mismatches
+    my @misses =
+        grep { ! ( $g{$_}[0] && $g{$_}[1] ) }
+        sort keys %g;
+
+    return
+        ! @misses
+        || ( ! @$supplementary_groups
+             && 1 == @$extracted_supplementary_groups
+             && $pwgid == $extracted_supplementary_groups->[0] );
+}
+
+# Print a nice little diagnostic.
+sub diag_variable {
+    my ( $label, $content ) = @_;
+
+    printf "# %-11s=%s\n", $label, $content;
+    return;
+}
+
+# Removes duplicates from a list
+sub uniq {
+    my %seen;
+    return
+        grep { ! $seen{$_}++ }
+        @_;
+}
+
+# Local variables:
+# indent-tabs-mode: nil
+# End:
+#
+# ex: set ts=8 sts=4 sw=4 noet:
Index: src/gnu/usr.bin/perl/t/op/gv.t
diff -u src/gnu/usr.bin/perl/t/op/gv.t:1.9 src/gnu/usr.bin/perl/t/op/gv.t:1.10
--- t/op/gv.t:1.9	Mon Oct 12 18:30:27 2009
+++ t/op/gv.t	Fri Sep 24 15:07:08 2010
@@ -12,7 +12,7 @@
 use warnings;
 
 require './test.pl';
-plan( tests => 178 );
+plan( tests => 188 );
 
 # type coersion on assignment
 $foo = 'foo';
@@ -167,7 +167,10 @@
     ok(!defined @{$a});
     ok(!defined *{$a});
 
-    ok(!defined %{$a});
+    {
+	no warnings 'deprecated';
+	ok(!defined %{$a});
+    }
     ok(!defined *{$a});
 
     ok(!defined ${$a});
@@ -556,6 +559,60 @@
     like ($@, qr/Can't coerce GLOB to $type in/,
 	  "with the correct error message");
 }
+
+# RT #60954 anonymous glob should be defined, and not coredump when
+# stringified. The behaviours are:
+#
+#        defined($glob)    "$glob"
+# 5.8.8     false           "" with uninit warning
+# 5.10.0    true            (coredump)
+# 5.12.0    true            ""
+
+{
+    my $io_ref = *STDOUT{IO};
+    my $glob = *$io_ref;
+    ok(defined $glob, "RT #60954 anon glob should be defined");
+
+    my $warn = '';
+    local $SIG{__WARN__} = sub { $warn = $_[0] };
+    use warnings;
+    my $str = "$glob";
+    is($warn, '', "RT #60954 anon glob stringification shouln't warn");
+    is($str,  '', "RT #60954 anon glob stringification should be empty");
+}
+
+# [perl #71254] - Assigning a glob to a variable that has a current
+# match position. (We are testing that Perl_magic_setmglob respects globs'
+# special used of SvSCREAM.)
+{
+    $m = 2; $m=~s/./0/gems; $m= *STDERR;
+    is(
+        "$m", "*main::STDERR",
+        '[perl #71254] assignment of globs to vars with pos'
+    );
+}
+
+# [perl #72740] - indirect object syntax, heuristically imputed due to
+# the non-existence of a function, should not cause a stash entry to be
+# created for the non-existent function.
+{
+	package RT72740a;
+	my $f = bless({}, RT72740b);
+	sub s1 { s2 $f; }
+	our $s4;
+	sub s3 { s4 $f; }
+}
+{
+	package RT72740b;
+	sub s2 { "RT72740b::s2" }
+	sub s4 { "RT72740b::s4" }
+}
+ok(exists($RT72740a::{s1}), "RT72740a::s1 exists");
+ok(!exists($RT72740a::{s2}), "RT72740a::s2 does not exist");
+ok(exists($RT72740a::{s3}), "RT72740a::s3 exists");
+ok(exists($RT72740a::{s4}), "RT72740a::s4 exists");
+is(RT72740a::s1(), "RT72740b::s2", "RT72740::s1 parsed correctly");
+is(RT72740a::s3(), "RT72740b::s4", "RT72740::s3 parsed correctly");
 
 __END__
 Perl
Index: src/gnu/usr.bin/perl/t/op/inc.t
diff -u src/gnu/usr.bin/perl/t/op/inc.t:1.7 src/gnu/usr.bin/perl/t/op/inc.t:1.8
--- t/op/inc.t:1.7	Mon Oct 12 18:30:27 2009
+++ t/op/inc.t	Fri Sep 24 15:07:08 2010
@@ -2,7 +2,7 @@
 
 # use strict;
 
-print "1..38\n";
+print "1..54\n";
 
 my $test = 1;
 
@@ -194,6 +194,82 @@
     $x--;
     ok ($x == 0, "(void) i_postdec");
 }
+
+# I'm sure that there's an IBM format with a 48 bit mantissa
+# IEEE doubles have a 53 bit mantissa
+# 80 bit long doubles have a 64 bit mantissa
+# sparcs have a 112 bit mantissa for their long doubles. Just to be awkward :-)
+
+sub check_some_code {
+    my ($start, $warn, $action, $description) = @_;
+    my $warn_line = ($warn ? 'use' : 'no') . " warnings 'imprecision';";
+    my @warnings;
+    local $SIG{__WARN__} = sub {push @warnings, "@_"};
+
+    print "# checking $action under $warn_line\n";
+    my $code = <<"EOC";
+$warn_line
+my \$i = \$start;
+for(0 .. 3) {
+    my \$a = $action;
+}
+1;
+EOC
+    eval $code or die "# $@\n$code";
+
+    if ($warn) {
+	unless (ok (scalar @warnings == 2, scalar @warnings)) {
+	    print STDERR "# $_" foreach @warnings;
+	}
+	foreach (@warnings) {
+	    unless (ok (/Lost precision when incrementing \d+/, $_)) {
+		print STDERR "# $_"
+	    }
+	}
+    } else {
+	unless (ok (scalar @warnings == 0)) {
+	    print STDERR "# @$_" foreach @warnings;
+	}
+    }
+}
+
+my $h_uv_max = 1 + (~0 >> 1);
+my $found;
+for my $n (47..113) {
+    my $power_of_2 = 2**$n;
+    my $plus_1 = $power_of_2 + 1;
+    next if $plus_1 != $power_of_2;
+    my ($start_p, $start_n);
+    if ($h_uv_max > $power_of_2 / 2) {
+	my $uv_max = 1 + 2 * (~0 >> 1);
+	# UV_MAX is 2**$something - 1, so subtract 1 to get the start value
+	$start_p = $uv_max - 1;
+	# whereas IV_MIN is -(2**$something), so subtract 2
+	$start_n = -$h_uv_max + 2;
+	print "# Mantissa overflows at 2**$n ($power_of_2)\n";
+	print "# But max UV ($uv_max) is greater so testing that\n";
+    } else {
+	print "# Testing 2**$n ($power_of_2) which overflows the mantissa\n";
+	$start_p = int($power_of_2 - 2);
+	$start_n = -$start_p;
+	my $check = $power_of_2 - 2;
+	die "Something wrong with our rounding assumptions: $check vs $start_p"
+	    unless $start_p == $check;
+    }
+
+    foreach my $warn (0, 1) {
+	foreach (['++$i', 'pre-inc'], ['$i++', 'post-inc']) {
+	    check_some_code($start_p, $warn, @$_);
+	}
+	foreach (['--$i', 'pre-dec'], ['$i--', 'post-dec']) {
+	    check_some_code($start_n, $warn, @$_);
+	}
+    }
+
+    $found = 1;
+    last;
+}
+die "Could not find a value which overflows the mantissa" unless $found;
 
 # these will segfault if they fail
 
Index: src/gnu/usr.bin/perl/t/op/index.t
diff -u src/gnu/usr.bin/perl/t/op/index.t:1.10 src/gnu/usr.bin/perl/t/op/index.t:1.11
--- t/op/index.t:1.10	Mon Oct 12 18:30:27 2009
+++ t/op/index.t	Fri Sep 24 15:07:08 2010
@@ -137,7 +137,8 @@
     foreach my $arraybase (0, 1, -1, -2) {
 	my $expect_pos = 2 + $arraybase;
 
-	my $prog = "\$[ = $arraybase; \$big = \"N\\xabN\\xab\"; ";
+	my $prog = "no warnings 'deprecated';\n";
+	$prog .= "\$[ = $arraybase; \$big = \"N\\xabN\\xab\"; ";
 	$prog .= '$big .= chr 256; chop $big; ' if $utf8;
 	$prog .= 'print rindex $big, "N", 2 + $[';
 
Index: src/gnu/usr.bin/perl/t/op/list.t
diff -u src/gnu/usr.bin/perl/t/op/list.t:1.7 src/gnu/usr.bin/perl/t/op/list.t:1.8
--- t/op/list.t:1.7	Mon Sep 29 17:36:19 2008
+++ t/op/list.t	Fri Sep 24 15:07:08 2010
@@ -6,7 +6,7 @@
 }
 
 require "test.pl";
-plan( tests => 57 );
+plan( tests => 58 );
 
 @foo = (1, 2, 3, 4);
 cmp_ok($foo[0], '==', 1, 'first elem');
@@ -161,3 +161,7 @@
     test_zero_args("do-returned list slice", do { (10,11)[2,3]; });
 }
 
+{
+    # perl #20321
+    is (join('', @{[('abc'=~/./g)[0,1,2,1,0]]}), "abcba");
+}
Index: src/gnu/usr.bin/perl/t/op/local.t
diff -u src/gnu/usr.bin/perl/t/op/local.t:1.9 src/gnu/usr.bin/perl/t/op/local.t:1.10
--- t/op/local.t:1.9	Mon Oct 12 18:30:27 2009
+++ t/op/local.t	Fri Sep 24 15:07:08 2010
@@ -5,7 +5,7 @@
     @INC = qw(. ../lib);
     require './test.pl';
 }
-plan tests => 123;
+plan tests => 296;
 
 my $list_assignment_supported = 1;
 
@@ -96,6 +96,58 @@
 
 @a = ('a', 'b', 'c');
 {
+    local($a[4]) = 'x';
+    ok(!defined $a[3]);
+    is($a[4], 'x');
+}
+is(scalar(@a), 3);
+ok(!exists $a[3]);
+ok(!exists $a[4]);
+
+@a = ('a', 'b', 'c');
+{
+    local($a[5]) = 'z';
+    $a[4] = 'y';
+    ok(!defined $a[3]);
+    is($a[4], 'y');
+    is($a[5], 'z');
+}
+is(scalar(@a), 5);
+ok(!defined $a[3]);
+is($a[4], 'y');
+ok(!exists $a[5]);
+
+@a = ('a', 'b', 'c');
+{
+    local(@a[4,6]) = ('x', 'z');
+    ok(!defined $a[3]);
+    is($a[4], 'x');
+    ok(!defined $a[5]);
+    is($a[6], 'z');
+}
+is(scalar(@a), 3);
+ok(!exists $a[3]);
+ok(!exists $a[4]);
+ok(!exists $a[5]);
+ok(!exists $a[6]);
+
+@a = ('a', 'b', 'c');
+{
+    local(@a[4,6]) = ('x', 'z');
+    $a[5] = 'y';
+    ok(!defined $a[3]);
+    is($a[4], 'x');
+    is($a[5], 'y');
+    is($a[6], 'z');
+}
+is(scalar(@a), 6);
+ok(!defined $a[3]);
+ok(!defined $a[4]);
+is($a[5], 'y');
+ok(!exists $a[6]);
+
+@a = ('a', 'b', 'c');
+{
     local($a[1]) = "X";
     shift @a;
 }
@@ -106,6 +158,109 @@
     is("@a", $d);
 }
 
+@a = ('a', 'b', 'c');
+$a[4] = 'd';
+{
+    delete local $a[1];
+    is(scalar(@a), 5);
+    is($a[0], 'a');
+    ok(!exists($a[1]));
+    is($a[2], 'c');
+    ok(!exists($a[3]));
+    is($a[4], 'd');
+
+    ok(!exists($a[888]));
+    delete local $a[888];
+    is(scalar(@a), 5);
+    ok(!exists($a[888]));
+
+    ok(!exists($a[999]));
+    my ($d, $zzz) = delete local @a[4, 999];
+    is(scalar(@a), 3);
+    ok(!exists($a[4]));
+    ok(!exists($a[999]));
+    is($d, 'd');
+    is($zzz, undef);
+
+    my $c = delete local $a[2];
+    is(scalar(@a), 1);
+    ok(!exists($a[2]));
+    is($c, 'c');
+
+    $a[888] = 'yyy';
+    $a[999] = 'zzz';
+}
+is(scalar(@a), 5);
+is($a[0], 'a');
+is($a[1], 'b');
+is($a[2], 'c');
+ok(!defined($a[3]));
+is($a[4], 'd');
+ok(!exists($a[5]));
+ok(!exists($a[888]));
+ok(!exists($a[999]));
+
+%h = (a => 1, b => 2, c => 3, d => 4);
+{
+    delete local $h{b};
+    is(scalar(keys(%h)), 3);
+    is($h{a}, 1);
+    ok(!exists($h{b}));
+    is($h{c}, 3);
+    is($h{d}, 4);
+
+    ok(!exists($h{yyy}));
+    delete local $h{yyy};
+    is(scalar(keys(%h)), 3);
+    ok(!exists($h{yyy}));
+
+    ok(!exists($h{zzz}));
+    my ($d, $zzz) = delete local @h{qw/d zzz/};
+    is(scalar(keys(%h)), 2);
+    ok(!exists($h{d}));
+    ok(!exists($h{zzz}));
+    is($d, 4);
+    is($zzz, undef);
+
+    my $c = delete local $h{c};
+    is(scalar(keys(%h)), 1);
+    ok(!exists($h{c}));
+    is($c, 3);
+
+    $h{yyy} = 888;
+    $h{zzz} = 999;
+}
+is(scalar(keys(%h)), 4);
+is($h{a}, 1);
+is($h{b}, 2);
+is($h{c}, 3);
+ok($h{d}, 4);
+ok(!exists($h{yyy}));
+ok(!exists($h{zzz}));
+
+%h = ('a' => { 'b' => 1 }, 'c' => 2);
+{
+    my $a = delete local $h{a};
+    is(scalar(keys(%h)), 1);
+    ok(!exists($h{a}));
+    is($h{c}, 2);
+    is(scalar(keys(%$a)), 1);
+
+    my $b = delete local $a->{b};
+    is(scalar(keys(%$a)), 0);
+    is($b, 1);
+
+    $a->{d} = 3;
+}
+is(scalar(keys(%h)), 2);
+{
+    my $a = $h{a};
+    is(scalar(keys(%$a)), 2);
+    is($a->{b}, 1);
+    is($a->{d}, 3);
+}
+is($h{c}, 2);
+
 %h = ('a' => 1, 'b' => 2, 'c' => 3);
 {
     local($h{'a'}) = 'foo';
@@ -145,6 +300,8 @@
     sub TIEARRAY { bless [], $_[0] }
     sub STORE { print "# STORE [@_]\n"; $_[0]->[$_[1]] = $_[2] }
     sub FETCH { my $v = $_[0]->[$_[1]]; print "# FETCH [@_=$v]\n"; $v }
+    sub EXISTS { print "# EXISTS [@_]\n"; exists $_[0]->[$_[1]]; }
+    sub DELETE { print "# DELETE [@_]\n"; delete $_[0]->[$_[1]]; }
     sub CLEAR { print "# CLEAR [@_]\n"; @{$_[0]} = (); }
     sub FETCHSIZE { scalar(@{$_[0]}) }
     sub SHIFT { shift (@{$_[0]}) }
@@ -169,6 +326,102 @@
     is("@a", $d);
 }
 
+# local() should preserve the existenceness of tied array elements
+@a = ('a', 'b', 'c');
+{
+    local($a[4]) = 'x';
+    ok(!defined $a[3]);
+    is($a[4], 'x');
+}
+is(scalar(@a), 3);
+ok(!exists $a[3]);
+ok(!exists $a[4]);
+
+@a = ('a', 'b', 'c');
+{
+    local($a[5]) = 'z';
+    $a[4] = 'y';
+    ok(!defined $a[3]);
+    is($a[4], 'y');
+    is($a[5], 'z');
+}
+is(scalar(@a), 5);
+ok(!defined $a[3]);
+is($a[4], 'y');
+ok(!exists $a[5]);
+
+@a = ('a', 'b', 'c');
+{
+    local(@a[4,6]) = ('x', 'z');
+    ok(!defined $a[3]);
+    is($a[4], 'x');
+    ok(!defined $a[5]);
+    is($a[6], 'z');
+}
+is(scalar(@a), 3);
+ok(!exists $a[3]);
+ok(!exists $a[4]);
+ok(!exists $a[5]);
+ok(!exists $a[6]);
+
+@a = ('a', 'b', 'c');
+{
+    local(@a[4,6]) = ('x', 'z');
+    $a[5] = 'y';
+    ok(!defined $a[3]);
+    is($a[4], 'x');
+    is($a[5], 'y');
+    is($a[6], 'z');
+}
+is(scalar(@a), 6);
+ok(!defined $a[3]);
+ok(!defined $a[4]);
+is($a[5], 'y');
+ok(!exists $a[6]);
+
+@a = ('a', 'b', 'c');
+$a[4] = 'd';
+{
+    delete local $a[1];
+    is(scalar(@a), 5);
+    is($a[0], 'a');
+    ok(!exists($a[1]));
+    is($a[2], 'c');
+    ok(!exists($a[3]));
+    is($a[4], 'd');
+
+    ok(!exists($a[888]));
+    delete local $a[888];
+    is(scalar(@a), 5);
+    ok(!exists($a[888]));
+
+    ok(!exists($a[999]));
+    my ($d, $zzz) = delete local @a[4, 999];
+    is(scalar(@a), 3);
+    ok(!exists($a[4]));
+    ok(!exists($a[999]));
+    is($d, 'd');
+    is($zzz, undef);
+
+    my $c = delete local $a[2];
+    is(scalar(@a), 1);
+    ok(!exists($a[2]));
+    is($c, 'c');
+
+    $a[888] = 'yyy';
+    $a[999] = 'zzz';
+}
+is(scalar(@a), 5);
+is($a[0], 'a');
+is($a[1], 'b');
+is($a[2], 'c');
+ok(!defined($a[3]));
+is($a[4], 'd');
+ok(!exists($a[5]));
+ok(!exists($a[888]));
+ok(!exists($a[999]));
+
+# see if localization works on tied hashes
 {
     package TH;
     sub TIEHASH { bless {}, $_[0] }
@@ -181,7 +434,6 @@
     sub NEXTKEY { print "# NEXTKEY [@_]\n"; each %{$_[0]} }
 }
 
-# see if localization works on tied hashes
 tie %h, 'TH';
 %h = ('a' => 1, 'b' => 2, 'c' => 3);
 
@@ -208,6 +460,44 @@
     is(join("\n", map { "$_=>$h{$_}" } sort keys %h), $d);
 }
 
+%h = (a => 1, b => 2, c => 3, d => 4);
+{
+    delete local $h{b};
+    is(scalar(keys(%h)), 3);
+    is($h{a}, 1);
+    ok(!exists($h{b}));
+    is($h{c}, 3);
+    is($h{d}, 4);
+
+    ok(!exists($h{yyy}));
+    delete local $h{yyy};
+    is(scalar(keys(%h)), 3);
+    ok(!exists($h{yyy}));
+
+    ok(!exists($h{zzz}));
+    my ($d, $zzz) = delete local @h{qw/d zzz/};
+    is(scalar(keys(%h)), 2);
+    ok(!exists($h{d}));
+    ok(!exists($h{zzz}));
+    is($d, 4);
+    is($zzz, undef);
+
+    my $c = delete local $h{c};
+    is(scalar(keys(%h)), 1);
+    ok(!exists($h{c}));
+    is($c, 3);
+
+    $h{yyy} = 888;
+    $h{zzz} = 999;
+}
+is(scalar(keys(%h)), 4);
+is($h{a}, 1);
+is($h{b}, 2);
+is($h{c}, 3);
+ok($h{d}, 4);
+ok(!exists($h{yyy}));
+ok(!exists($h{zzz}));
+
 @a = ('a', 'b', 'c');
 {
     local($a[1]) = "X";
@@ -333,6 +623,7 @@
 
 # RT #4342 Special local() behavior for $[
 {
+    no warnings 'deprecated';
     local $[ = 1;
     ok(1 == $[, 'lexcical scope of local $[');
     f();
Index: src/gnu/usr.bin/perl/t/op/magic.t
diff -u src/gnu/usr.bin/perl/t/op/magic.t:1.11 src/gnu/usr.bin/perl/t/op/magic.t:1.12
--- t/op/magic.t:1.11	Mon Oct 12 18:30:27 2009
+++ t/op/magic.t	Fri Sep 24 15:07:08 2010
@@ -4,6 +4,7 @@
     $| = 1;
     chdir 't' if -d 't';
     @INC = '../lib';
+    $ENV{PATH} = '/bin' if ${^TAINT};
     $SIG{__WARN__} = sub { die "Dying on warning: ", @_ };
     require './test.pl';
 }
@@ -11,8 +12,7 @@
 use warnings;
 use Config;
 
-
-plan (tests => 59);
+plan (tests => 80);
 
 $Is_MSWin32  = $^O eq 'MSWin32';
 $Is_NetWare  = $^O eq 'NetWare';
@@ -20,14 +20,13 @@
 $Is_Dos      = $^O eq 'dos';
 $Is_os2      = $^O eq 'os2';
 $Is_Cygwin   = $^O eq 'cygwin';
-$Is_MacOS    = $^O eq 'MacOS';
 $Is_MPE      = $^O eq 'mpeix';		
 $Is_miniperl = $ENV{PERL_CORE_MINITEST};
 $Is_BeOS     = $^O eq 'beos';
 
 $PERL = $ENV{PERL}
     || ($Is_NetWare           ? 'perl'   :
-       ($Is_MacOS || $Is_VMS) ? $^X      :
+       $Is_VMS                ? $^X      :
        $Is_MSWin32            ? '.\perl' :
        './perl');
 
@@ -40,7 +39,6 @@
 # cmd.exe will echo 'variable=value' but 4nt will echo just the value
 # -- Nikola Knezevic
 if ($Is_MSWin32)  { like `set FOO`, qr/^(?:FOO=)?hi there$/; }
-elsif ($Is_MacOS) { ok "1 # skipped", 1; }
 elsif ($Is_VMS)   { is `write sys\$output f\$trnlnm("FOO")`, "hi there\n"; }
 else              { is `echo \$FOO`, "hi there\n"; }
 
@@ -52,7 +50,7 @@
 
 SKIP: {
     skip('SIGINT not safe on this platform', 5)
-	if $Is_MSWin32 || $Is_NetWare || $Is_Dos || $Is_MPE || $Is_MacOS;
+	if $Is_MSWin32 || $Is_NetWare || $Is_Dos || $Is_MPE;
   # the next tests are done in a subprocess because sh spits out a
   # newline onto stderr when a child process kills itself with SIGINT.
   # We use a pipe rather than system() because the VMS command buffer
@@ -163,13 +161,10 @@
 }
 
 # $?, $@, $$
-SKIP:  {
-    skip('$? + system are broken on MacPerl', 2) if $Is_MacOS;
-    system qq[$PERL "-I../lib" -e "use vmsish qw(hushed); exit(0)"];
-    is $?, 0;
-    system qq[$PERL "-I../lib" -e "use vmsish qw(hushed); exit(1)"];
-    isnt $?, 0;
-}
+system qq[$PERL "-I../lib" -e "use vmsish qw(hushed); exit(0)"];
+is $?, 0;
+system qq[$PERL "-I../lib" -e "use vmsish qw(hushed); exit(1)"];
+isnt $?, 0;
 
 eval { die "foo\n" };
 is $@, "foo\n";
@@ -187,6 +182,7 @@
        # Cygwin turns the symlink into the real file
        chomp($wd = `pwd`);
        $wd =~ s#/t$##;
+       $wd =~ /(.*)/; $wd = $1; # untaint
        if ($Is_Cygwin) {
 	   $wd = Cygwin::win_to_posix_path(Cygwin::posix_to_win_path($wd, 1));
        }
@@ -194,13 +190,10 @@
     elsif($Is_os2) {
        $wd = Cwd::sys_cwd();
     }
-    elsif($Is_MacOS) {
-       $wd = ':';
-    }
     else {
 	$wd = '.';
     }
-    my $perl = ($Is_MacOS || $Is_VMS) ? $^X : "$wd/perl";
+    my $perl = $Is_VMS ? $^X : "$wd/perl";
     my $headmaybe = '';
     my $middlemaybe = '';
     my $tailmaybe = '';
@@ -226,9 +219,6 @@
     elsif ($Is_os2) {
       $script = "./show-shebang";
     }
-    elsif ($Is_MacOS) {
-      $script = ":show-shebang";
-    }
     elsif ($Is_VMS) {
       $script = "[]show-shebang";
     }
@@ -245,7 +235,7 @@
 EOH
     }
     $s1 = "\$^X is $perl, \$0 is $script\n";
-    ok open(SCRIPT, ">$script") or diag $!;
+    ok open(SCRIPT, ">$script") or diag "Can't write to $script: $!";
     ok print(SCRIPT $headmaybe . <<EOB . $middlemaybe . <<'EOF' . $tailmaybe) or diag $!;
 #!$wd/perl
 EOB
@@ -253,7 +243,7 @@
 EOF
     ok close(SCRIPT) or diag $!;
     ok chmod(0755, $script) or diag $!;
-    $_ = ($Is_MacOS || $Is_VMS) ? `$perl $script` : `$script`;
+    $_ = $Is_VMS ? `$perl $script` : `$script`;
     s/\.exe//i if $Is_Dos or $Is_Cygwin or $Is_os2;
     s{./$script}{$script} if $Is_BeOS; # revert BeOS execvp() side-effect
     s{\bminiperl\b}{perl}; # so that test doesn't fail with miniperl
@@ -291,7 +281,7 @@
 
 SKIP: {
     skip("%ENV manipulations fail or aren't safe on $^O", 4)
-	if $Is_VMS || $Is_Dos || $Is_MacOS;
+	if $Is_VMS || $Is_Dos;
 
  SKIP: {
 	skip("clearing \%ENV is not safe when running under valgrind")
@@ -392,7 +382,7 @@
 
    ok scalar eval q{
       %!;
-      defined %Errno::;
+      scalar %Errno::;
    }, $@;
 }
 
@@ -413,9 +403,10 @@
 eval " BEGIN { ok ! defined \$^S } ";
 is $^S, 0;
 
-is ${^TAINT}, 0;
+my $taint = ${^TAINT};
+is ${^TAINT}, $taint;
 eval { ${^TAINT} = 1 };
-is ${^TAINT}, 0;
+is ${^TAINT}, $taint;
 
 # 5.6.1 had a bug: @+ and @- were not properly interpolated
 # into double-quoted strings
@@ -474,4 +465,35 @@
     eval { my %h = qw(A B); %ENV = (PATH => (keys %h)[0]) };
     is $@, '', 'Assign a shared key to a magic hash';
     $@ and print "# $@";
+}
+
+# Tests for Perl_magic_clearsig
+foreach my $sig (qw(__WARN__ INT)) {
+    $SIG{$sig} = lc $sig;
+    is $SIG{$sig}, 'main::' . lc $sig, "Can assign to $sig";
+    is delete $SIG{$sig}, 'main::' . lc $sig, "Can delete from $sig";
+    is $SIG{$sig}, undef, "$sig is now gone";
+    is delete $SIG{$sig}, undef, "$sig remains gone";
+}
+
+# And now one which doesn't exist;
+{
+    no warnings 'signal';
+    $SIG{HUNGRY} = 'mmm, pie';
+}
+is $SIG{HUNGRY}, 'mmm, pie', 'Can assign to HUNGRY';
+is delete $SIG{HUNGRY}, 'mmm, pie', 'Can delete from HUNGRY';
+is $SIG{HUNGRY}, undef, "HUNGRY is now gone";
+is delete $SIG{HUNGRY}, undef, "HUNGRY remains gone";
+
+# Test deleting signals that we never set
+foreach my $sig (qw(__DIE__ _BOGUS_HOOK KILL THIRSTY)) {
+    is $SIG{$sig}, undef, "$sig is not present";
+    is delete $SIG{$sig}, undef, "delete of $sig returns undef";
+}
+
+{
+    $! = 9999;
+    is int $!, 9999, q{[perl #72850] Core dump in bleadperl from perl -e '$! = 9999; $a = $!;'};
+
 }
Index: src/gnu/usr.bin/perl/t/op/method.t
diff -u src/gnu/usr.bin/perl/t/op/method.t:1.7 src/gnu/usr.bin/perl/t/op/method.t:1.8
--- t/op/method.t:1.7	Mon Oct 12 18:30:27 2009
+++ t/op/method.t	Fri Sep 24 15:07:08 2010
@@ -10,7 +10,7 @@
     require "test.pl";
 }
 
-print "1..78\n";
+print "1..79\n";
 
 @A::ISA = 'B';
 @B::ISA = 'C';
@@ -284,7 +284,6 @@
 {
     fresh_perl_is(<<EOT,
 package UNIVERSAL; sub AUTOLOAD { my \$c = shift; print "\$c \$AUTOLOAD\\n" }
-sub DESTROY {} # IO object destructor called in MacOS, because of Mac::err
 package Xyz;
 package main; Foo->$meth->[0]();
 EOT
@@ -293,3 +292,16 @@
 	"check if UNIVERSAL::AUTOLOAD works",
     );
 }
+
+# Test for #71952: crash when looking for a nonexistent destructor
+# Regression introduced by fbb3ee5af3d4
+{
+    fresh_perl_is(<<'EOT',
+sub M::DESTROY; bless {}, "M" ; print "survived\n";
+EOT
+    "survived",
+    {},
+	"no crash with a declared but missing DESTROY method"
+    );
+}
+
Index: src/gnu/usr.bin/perl/t/op/mkdir.t
diff -u src/gnu/usr.bin/perl/t/op/mkdir.t:1.9 src/gnu/usr.bin/perl/t/op/mkdir.t:1.10
--- t/op/mkdir.t:1.9	Mon Sep 29 17:36:19 2008
+++ t/op/mkdir.t	Fri Sep 24 15:07:08 2010
@@ -25,15 +25,11 @@
 ok(mkdir('blurfl'));
 ok(rmdir('blurfl'));
 
-SKIP: {
-    # trailing slashes will be removed before the system call to mkdir
-    # but we don't care for MacOS ...
-    skip("MacOS", 4) if $^O eq 'MacOS';
-    ok(mkdir('blurfl///'));
-    ok(-d 'blurfl');
-    ok(rmdir('blurfl///'));
-    ok(!-d 'blurfl');
-}
+# trailing slashes will be removed before the system call to mkdir
+ok(mkdir('blurfl///'));
+ok(-d 'blurfl');
+ok(rmdir('blurfl///'));
+ok(!-d 'blurfl');
 
 # test default argument
 
Index: src/gnu/usr.bin/perl/t/op/pack.t
diff -u src/gnu/usr.bin/perl/t/op/pack.t:1.10 src/gnu/usr.bin/perl/t/op/pack.t:1.11
--- t/op/pack.t:1.10	Mon Oct 12 18:30:27 2009
+++ t/op/pack.t	Fri Sep 24 15:07:08 2010
@@ -12,7 +12,7 @@
 my $no_signedness = $] > 5.009 ? '' :
   "Signed/unsigned pack modifiers not available on this perl";
 
-plan tests => 14697;
+plan tests => 14699;
 
 use strict;
 use warnings qw(FATAL all);
@@ -1984,4 +1984,12 @@
     #50256
     my ($v) = split //, unpack ('(B)*', 'ab');
     is($v, 0); # Doesn't SEGV :-)
+}
+{
+    #73814
+    my $x = runperl( prog => 'print split( /,/, unpack(q(%2H*), q(hello world))), qq(\n)' );
+    is($x, "0\n", "split /a/, unpack('%2H*'...) didn't crash");
+
+    my $y = runperl( prog => 'print split( /,/, unpack(q(%32u*), q(#,3,Q)), qq(\n)), qq(\n)' );
+    is($y, "0\n", "split /a/, unpack('%32u*'...) didn't crash");
 }
Index: src/gnu/usr.bin/perl/t/op/push.t
diff -u src/gnu/usr.bin/perl/t/op/push.t:1.8 src/gnu/usr.bin/perl/t/op/push.t:1.9
--- t/op/push.t:1.8	Mon Sep 29 17:36:20 2008
+++ t/op/push.t	Fri Sep 24 15:07:09 2010
@@ -24,9 +24,15 @@
 if (join(':',@x) eq '1:2:3:1:2:3:4') {print "ok 2\n";} else {print "not ok 2\n";}
 
 # test for push/pop intuiting @ on array
-push(x,3);
+{
+    no warnings 'deprecated';
+    push(x,3);
+}
 if (join(':',@x) eq '1:2:3:1:2:3:4:3') {print "ok 3\n";} else {print "not ok 3\n";}
-pop(x);
+{
+    no warnings 'deprecated';
+    pop(x);
+}
 if (join(':',@x) eq '1:2:3:1:2:3:4') {print "ok 4\n";} else {print "not ok 4\n";}
 
 $test = 5;
Index: src/gnu/usr.bin/perl/t/op/range.t
diff -u src/gnu/usr.bin/perl/t/op/range.t:1.10 src/gnu/usr.bin/perl/t/op/range.t:1.11
--- t/op/range.t:1.10	Mon Oct 12 18:30:27 2009
+++ t/op/range.t	Fri Sep 24 15:07:09 2010
@@ -9,7 +9,7 @@
 
 use Config;
 
-plan (135);
+plan (141);
 
 is(join(':',1..5), '1:2:3:4:5');
 
@@ -402,5 +402,20 @@
   is(fetches($x), 1);
 }
 is(stores($x), 0);
+
+is( ( join ' ', map { join '', map ++$_, ($x=1)..4 } 1..2 ), '2345 2345',
+    'modifiable variable num range' );
+is( ( join ' ', map { join '', map ++$_, 1..4      } 1..2 ), '2345 3456',
+    'modifiable const num range' );  # Unresolved bug RT#3105
+$s = ''; for (1..2) { for (1..4) { $s .= ++$_ } $s.=' ' if $_==1; }
+is( $s, '2345 2345','modifiable num counting loop counter' );
+
+
+is( ( join ' ', map { join '', map ++$_, ($x='a')..'d' } 1..2 ), 'bcde bcde',
+    'modifiable variable alpha range' );
+is( ( join ' ', map { join '', map ++$_, 'a'..'d'      } 1..2 ), 'bcde cdef',
+    'modifiable const alpha range' );  # Unresolved bug RT#3105
+$s = ''; for (1..2) { for ('a'..'d') { $s .= ++$_ } $s.=' ' if $_==1; }
+is( $s, 'bcde bcde','modifiable alpha counting loop counter' );
 
 # EOF
Index: src/gnu/usr.bin/perl/t/op/readdir.t
diff -u src/gnu/usr.bin/perl/t/op/readdir.t:1.9 src/gnu/usr.bin/perl/t/op/readdir.t:1.10
--- t/op/readdir.t:1.9	Mon Oct 12 18:30:27 2009
+++ t/op/readdir.t	Fri Sep 24 15:07:09 2010
@@ -8,7 +8,7 @@
 eval 'opendir(NOSUCH, "no/such/directory");';
 if ($@) { print "1..0\n"; exit; }
 
-print "1..11\n";
+print "1..12\n";
 
 for $i (1..2000) {
     local *OP;
@@ -34,13 +34,12 @@
 
 @R = sort @D;
 @G = sort <op/*.t>;
-@G = sort <:op:*.t> if $^O eq 'MacOS';
 if ($G[0] =~ m#.*\](\w+\.t)#i) {
     # grep is to convert filespecs returned from glob under VMS to format
     # identical to that returned by readdir
     @G = grep(s#.*\](\w+\.t).*#op/$1#i,<op/*.t>);
 }
-while (@R && @G && $G[0] eq ($^O eq 'MacOS' ? ':op:' : 'op/').$R[0]) {
+while (@R && @G && $G[0] eq 'op/'.$R[0]) {
 	shift(@R);
 	shift(@G);
 }
@@ -54,3 +53,10 @@
 if (ref($fh{abc}) eq 'GLOB') { print "ok 9\n"; } else { print "not ok 9\n"; }
 if ("$fh" ne "$fh[0]") { print "ok 10\n"; } else { print "not ok 10\n"; }
 if ("$fh" ne "$fh{abc}") { print "ok 11\n"; } else { print "not ok 11\n"; }
+# See that perl does not segfault upon readdir($x="."); 
+# http://rt.perl.org/rt3/Ticket/Display.html?id=68182
+eval {
+    my $x = ".";
+    my @files = readdir($x);
+};
+print "ok 12\n";
Index: src/gnu/usr.bin/perl/t/op/recurse.t
diff -u src/gnu/usr.bin/perl/t/op/recurse.t:1.4 src/gnu/usr.bin/perl/t/op/recurse.t:1.5
--- t/op/recurse.t:1.4	Wed Dec  3 03:02:49 2003
+++ t/op/recurse.t	Fri Sep 24 15:07:09 2010
@@ -125,13 +125,7 @@
       skip("Out of memory -- increase your data/heap?", 2)
 	  if $r =~ /Out of memory/i;
       is($r, '', "64K deep recursion - no output expected");
-
-      if ($^O eq 'MacOS') {
-          ok(1, "$^O: \$? is unreliable");
-      } else {
-          is($?, 0, "64K deep recursion - no coredump expected");
-      }
-
+      is($?, 0, "64K deep recursion - no coredump expected");
   }
 }
 
Index: src/gnu/usr.bin/perl/t/op/ref.t
diff -u src/gnu/usr.bin/perl/t/op/ref.t:1.11 src/gnu/usr.bin/perl/t/op/ref.t:1.12
--- t/op/ref.t:1.11	Mon Oct 12 18:30:27 2009
+++ t/op/ref.t	Fri Sep 24 15:07:09 2010
@@ -7,8 +7,9 @@
 
 require 'test.pl';
 use strict qw(refs subs);
+use re ();
 
-plan(189);
+plan(196);
 
 # Test glob operations.
 
@@ -124,6 +125,32 @@
 is ($$subrefref->("GOOD"), "good");
 sub mysub2 { lc shift }
 
+# Test REGEXP assignment
+
+{
+    my $x = qr/x/;
+    my $str = "$x"; # regex stringification may change
+
+    my $y = $$x;
+    is ($y, $str, "bare REGEXP stringifies correctly");
+    ok (eval { "x" =~ $y }, "bare REGEXP matches correctly");
+    
+    my $z = \$y;
+    ok (re::is_regexp($z), "new ref to REXEXP passes is_regexp");
+    is ($z, $str, "new ref to REGEXP stringifies correctly");
+    ok (eval { "x" =~ $z }, "new ref to REGEXP matches correctly");
+}
+{
+    my ($x, $str);
+    {
+        my $y = qr/x/;
+        $str = "$y";
+        $x = $$y;
+    }
+    is ($x, $str, "REGEXP keeps a ref to its mother_re");
+    ok (eval { "x" =~ $x }, "REGEXP with mother_re still matches");
+}
+
 # Test the ref operator.
 
 sub PVBM () { 'foo' }
@@ -166,8 +193,8 @@
     like ("$ref", qr/^$type\(0x[0-9a-f]+\)$/, "stringify for ref to $desc");
 }
 
-is (ref *STDOUT{IO}, 'IO::Handle', 'IO refs are blessed into IO::Handle');
-like (*STDOUT{IO}, qr/^IO::Handle=IO\(0x[0-9a-f]+\)$/,
+is (ref *STDOUT{IO}, 'IO::File', 'IO refs are blessed into IO::File');
+like (*STDOUT{IO}, qr/^IO::File=IO\(0x[0-9a-f]+\)$/,
     'stringify for IO refs');
 
 # Test anonymous hash syntax.
@@ -413,10 +440,13 @@
 # REGEX pad had already been freed (ithreads build only). The
 # object is required to trigger the early freeing of GV refs to to STDOUT
 
-like (runperl(
-    prog => '$x=bless[]; sub IO::Handle::DESTROY{$_="bad";s/bad/ok/;print}',
-    stderr => 1
-      ), qr/^(ok)+$/, 'STDOUT destructor');
+TODO: {
+    local $TODO = "works but output through pipe is mangled" if $^O eq 'VMS';
+    like (runperl(
+        prog => '$x=bless[]; sub IO::Handle::DESTROY{$_="bad";s/bad/ok/;print}',
+        stderr => 1
+          ), qr/^(ok)+$/, 'STDOUT destructor');
+}
 
 TODO: {
     no strict 'refs';
Index: src/gnu/usr.bin/perl/t/op/runlevel.t
diff -u src/gnu/usr.bin/perl/t/op/runlevel.t:1.9 src/gnu/usr.bin/perl/t/op/runlevel.t:1.10
--- t/op/runlevel.t:1.9	Mon Oct 12 18:30:28 2009
+++ t/op/runlevel.t	Fri Sep 24 15:07:09 2010
@@ -12,7 +12,6 @@
 $Is_VMS = $^O eq 'VMS';
 $Is_MSWin32 = $^O eq 'MSWin32';
 $Is_NetWare = $^O eq 'NetWare';
-$Is_MacOS = $^O eq 'MacOS';
 $ENV{PERL5LIB} = "../lib" unless $Is_VMS;
 
 $|=1;
@@ -38,8 +37,6 @@
 		      `.\\perl -I../lib $switch $tmpfile 2>&1` :
 		  $Is_NetWare ?  
 		      `perl -I../lib $switch $tmpfile 2>&1` :
-		  $Is_MacOS ?
-		      `$^X -I::lib -MMac::err=unix $switch $tmpfile` :
 		  `./perl $switch $tmpfile 2>&1`;
     my $status = $?;
     $results =~ s/\n+$//;
Index: src/gnu/usr.bin/perl/t/op/sort.t
diff -u src/gnu/usr.bin/perl/t/op/sort.t:1.11 src/gnu/usr.bin/perl/t/op/sort.t:1.12
--- t/op/sort.t:1.11	Mon Oct 12 18:30:28 2009
+++ t/op/sort.t	Fri Sep 24 15:07:09 2010
@@ -6,7 +6,7 @@
     require 'test.pl';
 }
 use warnings;
-plan( tests => 144 );
+plan( tests => 148 );
 
 # these shouldn't hang
 {
@@ -701,8 +701,8 @@
 cmp_ok(substr($@,0,length($fail_msg)),'eq',$fail_msg,'undef active subr');
 
 
-
-{
+for(1,2) # We run this twice, to make sure sort does not lower the ref
+{        # count. See bug 71076.
     my $failed = 0;
 
     sub rec {
@@ -768,16 +768,22 @@
     cmp_ok(substr($@,0,length($fail_msg)),'eq',$fail_msg,'bug 7567');
 }
 
+{
+    local $TODO = "sort should make sure elements are not freed in the sort block";
+    eval { @nomodify_x=(1..8); our @copy = sort { @nomodify_x = (0) } (@nomodify_x, 3); };
+    is($@, "");
+}
+
 
 # Sorting shouldn't increase the refcount of a sub
 {
-    sub foo {(1+$a) <=> (1+$b)}
-    my $refcnt = &Internals::SvREFCNT(\&foo);
-    @output = sort foo 3,7,9;
+    sub sportello {(1+$a) <=> (1+$b)}
+    my $refcnt = &Internals::SvREFCNT(\&sportello);
+    @output = sort sportello 3,7,9;
 
     {
-        package Foo;
-        ::is($refcnt, &Internals::SvREFCNT(\&foo), "sort sub refcnt");
+        package Doc;
+        ::is($refcnt, &Internals::SvREFCNT(\&::sportello), "sort sub refcnt");
         $fail_msg = q(Modification of a read-only value attempted);
         # Sorting a read-only array in-place shouldn't be allowed
         my @readonly = (1..10);
@@ -801,3 +807,10 @@
 sub ret_with_stacked { $_ = ($a<=>$b) + do {return $b <=> $a} }
 @b = sort ret_with_stacked 1..10;
 is("@b", "10 9 8 7 6 5 4 3 2 1", "return with SVs on stack");
+
+# Comparison code should be able to give result in non-integer representation.
+sub cmp_as_string($$) { $_[0] < $_[1] ? "-1" : $_[0] == $_[1] ? "0" : "+1" }
+@b = sort { cmp_as_string($a, $b) } (1,5,4,7,3,2,3);
+is("@b", "1 2 3 3 4 5 7", "comparison result as string");
+@b = sort cmp_as_string (1,5,4,7,3,2,3);
+is("@b", "1 2 3 3 4 5 7", "comparison result as string");
Index: src/gnu/usr.bin/perl/t/op/split.t
diff -u src/gnu/usr.bin/perl/t/op/split.t:1.11 src/gnu/usr.bin/perl/t/op/split.t:1.12
--- t/op/split.t:1.11	Mon Oct 12 18:30:28 2009
+++ t/op/split.t	Fri Sep 24 15:07:09 2010
@@ -6,7 +6,7 @@
     require './test.pl';
 }
 
-plan tests => 136;
+plan tests => 251;
 
 $FS = ':';
 
@@ -17,37 +17,61 @@
 is(join(';',$a,$b,$c), 'a;b;c');
 
 @ary = split(/:b:/);
+$cnt = split(/:b:/);
 is(join("$_",@ary), 'aa:b:cc');
+is($cnt, scalar(@ary));
 
 $_ = "abc\n";
 my @xyz = (@ary = split(//));
+$cnt = split(//);
 is(join(".",@ary), "a.b.c.\n");
+is($cnt, scalar(@ary));
 
 $_ = "a:b:c::::";
 @ary = split(/:/);
+$cnt = split(/:/);
 is(join(".",@ary), "a.b.c");
+is($cnt, scalar(@ary));
 
 $_ = join(':',split(' ',"    a b\tc \t d "));
 is($_, 'a:b:c:d');
+@ary = split(' ',"    a b\tc \t d ");
+$cnt = split(' ',"    a b\tc \t d ");
+is($cnt, scalar(@ary));
 
 $_ = join(':',split(/ */,"foo  bar bie\tdoll"));
 is($_ , "f:o:o:b:a:r:b:i:e:\t:d:o:l:l");
+@ary = split(/ */,"foo  bar bie\tdoll");
+$cnt = split(/ */,"foo  bar bie\tdoll");
+is($cnt, scalar(@ary));
 
 $_ = join(':', 'foo', split(/ /,'a b  c'), 'bar');
 is($_, "foo:a:b::c:bar");
+@ary = split(/ /,'a b  c');
+$cnt = split(/ /,'a b  c');
+is($cnt, scalar(@ary));
 
 # Can we say how many fields to split to?
 $_ = join(':', split(' ','1 2 3 4 5 6', 3));
 is($_, '1:2:3 4 5 6');
+@ary = split(' ','1 2 3 4 5 6', 3);
+$cnt = split(' ','1 2 3 4 5 6', 3);
+is($cnt, scalar(@ary));
 
 # Can we do it as a variable?
 $x = 4;
 $_ = join(':', split(' ','1 2 3 4 5 6', $x));
 is($_, '1:2:3:4 5 6');
+@ary = split(' ','1 2 3 4 5 6', $x);
+$cnt = split(' ','1 2 3 4 5 6', $x);
+is($cnt, scalar(@ary));
 
 # Does the 999 suppress null field chopping?
 $_ = join(':', split(/:/,'1:2:3:4:5:6:::', 999));
 is($_ , '1:2:3:4:5:6:::');
+@ary = split(/:/,'1:2:3:4:5:6:::', 999);
+$cnt = split(/:/,'1:2:3:4:5:6:::', 999);
+is($cnt, scalar(@ary));
 
 # Does assignment to a list imply split to one more field than that?
 $foo = runperl( switches => ['-Dt'], stderr => 1, prog => '($a,$b)=split;' );
@@ -61,10 +85,16 @@
 # do subpatterns generate additional fields (without trailing nulls)?
 $_ = join '|', split(/,|(-)/, "1-10,20,,,");
 is($_, "1|-|10||20");
+@ary = split(/,|(-)/, "1-10,20,,,");
+$cnt = split(/,|(-)/, "1-10,20,,,");
+is($cnt, scalar(@ary));
 
 # do subpatterns generate additional fields (with a limit)?
 $_ = join '|', split(/,|(-)/, "1-10,20,,,", 10);
 is($_, "1|-|10||20||||||");
+@ary = split(/,|(-)/, "1-10,20,,,", 10);
+$cnt = split(/,|(-)/, "1-10,20,,,", 10);
+is($cnt, scalar(@ary));
 
 # is the 'two undefs' bug fixed?
 (undef, $a, undef, $b) = qw(1 2 3 4);
@@ -79,40 +109,69 @@
 # check splitting of null string
 $_ = join('|', split(/x/,   '',-1), 'Z');
 is($_, "Z");
+@ary = split(/x/,   '',-1);
+$cnt = split(/x/,   '',-1);
+is($cnt, scalar(@ary));
 
 $_ = join('|', split(/x/,   '', 1), 'Z');
 is($_, "Z");
+@ary = split(/x/,   '', 1);
+$cnt = split(/x/,   '', 1);
+is($cnt, scalar(@ary));
 
 $_ = join('|', split(/(p+)/,'',-1), 'Z');
 is($_, "Z");
+@ary = split(/(p+)/,'',-1);
+$cnt = split(/(p+)/,'',-1);
+is($cnt, scalar(@ary));
 
 $_ = join('|', split(/.?/,  '',-1), 'Z');
 is($_, "Z");
+@ary = split(/.?/,  '',-1);
+$cnt = split(/.?/,  '',-1);
+is($cnt, scalar(@ary));
 
 
 # Are /^/m patterns scanned?
 $_ = join '|', split(/^a/m, "a b a\na d a", 20);
 is($_, "| b a\n| d a");
+@ary = split(/^a/m, "a b a\na d a", 20);
+$cnt = split(/^a/m, "a b a\na d a", 20);
+is($cnt, scalar(@ary));
 
 # Are /$/m patterns scanned?
 $_ = join '|', split(/a$/m, "a b a\na d a", 20);
 is($_, "a b |\na d |");
+@ary = split(/a$/m, "a b a\na d a", 20);
+$cnt = split(/a$/m, "a b a\na d a", 20);
+is($cnt, scalar(@ary));
 
 # Are /^/m patterns scanned?
 $_ = join '|', split(/^aa/m, "aa b aa\naa d aa", 20);
 is($_, "| b aa\n| d aa");
+@ary = split(/^aa/m, "aa b aa\naa d aa", 20);
+$cnt = split(/^aa/m, "aa b aa\naa d aa", 20);
+is($cnt, scalar(@ary));
 
 # Are /$/m patterns scanned?
 $_ = join '|', split(/aa$/m, "aa b aa\naa d aa", 20);
 is($_, "aa b |\naa d |");
+@ary = split(/aa$/m, "aa b aa\naa d aa", 20);
+$cnt = split(/aa$/m, "aa b aa\naa d aa", 20);
+is($cnt, scalar(@ary));
 
 # Greedyness:
 $_ = "a : b :c: d";
 @ary = split(/\s*:\s*/);
+$cnt = split(/\s*:\s*/);
 is(($res = join(".",@ary)), "a.b.c.d", $res);
+is($cnt, scalar(@ary));
 
 # use of match result as pattern (!)
 is('p:q:r:s', join ':', split('abc' =~ /b/, 'p1q1r1s'));
+@ary = split('abc' =~ /b/, 'p1q1r1s');
+$cnt = split('abc' =~ /b/, 'p1q1r1s');
+is($cnt, scalar(@ary));
 
 # /^/ treated as /^/m
 $_ = join ':', split /^/, "ab\ncd\nef\n";
@@ -128,18 +187,26 @@
 # zero-width assertion
 $_ = join ':', split /(?=\w)/, "rm b";
 is($_, "r:m :b");
+@ary = split /(?=\w)/, "rm b";
+$cnt = split /(?=\w)/, "rm b";
+is($cnt, scalar(@ary));
 
 # unicode splittage
 
 @ary = map {ord} split //, v1.20.300.4000.50000.4000.300.20.1;
+$cnt =           split //, v1.20.300.4000.50000.4000.300.20.1;
 is("@ary", "1 20 300 4000 50000 4000 300 20 1");
+is($cnt, scalar(@ary));
 
 @ary = split(/\x{FE}/, "\x{FF}\x{FE}\x{FD}"); # bug id 20010105.016
+$cnt = split(/\x{FE}/, "\x{FF}\x{FE}\x{FD}"); # bug id 20010105.016
 ok(@ary == 2 &&
    $ary[0] eq "\xFF"   && $ary[1] eq "\xFD" &&
    $ary[0] eq "\x{FF}" && $ary[1] eq "\x{FD}");
+is($cnt, scalar(@ary));
 
 @ary = split(/(\x{FE}\xFE)/, "\xFF\x{FF}\xFE\x{FE}\xFD\x{FD}"); # variant of 31
+$cnt = split(/(\x{FE}\xFE)/, "\xFF\x{FF}\xFE\x{FE}\xFD\x{FD}"); # variant of 31
 ok(@ary == 3 &&
    $ary[0] eq "\xFF\xFF"     &&
    $ary[0] eq "\x{FF}\xFF"   &&
@@ -150,16 +217,21 @@
    $ary[2] eq "\xFD\xFD"     &&
    $ary[2] eq "\x{FD}\xFD"   &&
    $ary[2] eq "\x{FD}\x{FD}");
+is($cnt, scalar(@ary));
 
 {
     my @a = map ord, split(//, join("", map chr, (1234, 123, 2345)));
+    my $c =          split(//, join("", map chr, (1234, 123, 2345)));
     is("@a", "1234 123 2345");
+    is($c, scalar(@a));
 }
 
 {
     my $x = 'A';
     my @a = map ord, split(/$x/, join("", map chr, (1234, ord($x), 2345)));
+    my $c =          split(/$x/, join("", map chr, (1234, ord($x), 2345)));
     is("@a", "1234 2345");
+    is($c, scalar(@a));
 }
 
 {
@@ -171,6 +243,8 @@
     my $sushi = "\x{b36c}\x{5a8c}\x{ff5b}\x{5079}\x{505b}";
 
     my @charlist = split //, $sushi;
+    my $charnum  = split //, $sushi;
+    is($charnum, scalar(@charlist));
     my $r = '';
     foreach my $ch (@charlist) {
 	$r = $r . " " . sprintf "U+%04X", ord($ch);
@@ -218,6 +292,8 @@
     my $a = "ABC\x{263A}";
 
     my @b = split( //, $a );
+    my $c = split( //, $a );
+    is($c, scalar(@b));
 
     is(scalar @b, 4);
 
@@ -229,8 +305,10 @@
 
 {
     my @a = split(/\xFE/, "\xFF\xFE\xFD");
+    my $b = split(/\xFE/, "\xFF\xFE\xFD");
 
     ok(@a == 2 && $a[0] eq "\xFF" && $a[1] eq "\xFD");
+    is($b, scalar(@a));
 }
 
 {
@@ -247,6 +325,8 @@
 {
     # split /(A)|B/, "1B2" should return (1, undef, 2)
     my @x = split /(A)|B/, "1B2";
+    my $y = split /(A)|B/, "1B2";
+    is($y, scalar(@x));
     ok($x[0] eq '1' and (not defined $x[1]) and $x[2] eq '2');
 }
 
@@ -256,6 +336,8 @@
     local $SIG{__WARN__} = sub { $warn = join '', @_; chomp $warn };
     my $char = "\x{10f1ff}";
     my @a = split /\r?\n/, "$char\n";
+    my $b = split /\r?\n/, "$char\n";
+    is($b, scalar(@a));
     ok(@a == 1 && $a[0] eq $char && !defined($warn));
 }
 
@@ -267,6 +349,8 @@
 	    utf8::upgrade $_ if $u;
 	    /(.+)/;
 	    my @d = split /[,]/,$1;
+	    my $e = split /[,]/,$1;
+	    is($e, scalar(@d));
 	    is(join (':',@d), 'readin:database:readout', "[perl #18195]");
 	}
     }
@@ -276,6 +360,8 @@
     $p="a,b";
     utf8::upgrade $p;
     eval { @a=split(/[, ]+/,$p) };
+    eval { $b=split(/[, ]+/,$p) };
+    is($b, scalar(@a));
     is ("$@-@a-", '-a b-', '#20912 - split() to array with /[]+/ and utf8');
 }
 
@@ -335,16 +421,22 @@
         chop $str;
 
         my @res=split(/\s+/,$str);
+        my $cnt=split(/\s+/,$str);
         ok(@res == 2 && join('-',@res) eq "A:-:B", "$msg - /\\s+/");
+	is($cnt, scalar(@res), "$msg - /\\s+/ (count)");
 
         my $s2 = "$space$space:A:$space$space:B\x{FFFD}";
         chop $s2;
 
         my @r2 = split(' ',$s2);
+	my $c2 = split(' ',$s2);
         ok(@r2 == 2 && join('-', @r2) eq ":A:-:B",  "$msg - ' '");
+	is($c2, scalar(@r2), "$msg - ' ' (count)");
 
         my @r3 = split(/\s+/, $s2);
+        my $c3 = split(/\s+/, $s2);
         ok(@r3 == 3 && join('-', @r3) eq "-:A:-:B", "$msg - /\\s+/ No.2");
+	is($c3, scalar(@r3), "$msg - /\\s+/ No.2 (count)");
     }
 }
 
@@ -352,7 +444,11 @@
     my $src = "ABC \0 FOO \0  XYZ";
     my @s = split(" \0 ", $src);
     my @r = split(/ \0 /, $src);
+    my $cs = split(" \0 ", $src);
+    my $cr = split(/ \0 /, $src);
     is(scalar(@s), 3);
+    is($cs, 3);
+    is($cr, 3);
     is($s[0], "ABC");
     is($s[1], "FOO");
     is($s[2]," XYZ");
@@ -363,4 +459,12 @@
     use constant BANG => {};
     () = split m/,/, "", BANG;
     ok(1);
+}
+
+{
+    # Bug #69875
+    # 'Hybrid' scalar-and-array context
+    scalar(our @PATH = split /::/, "Font::GlyphNames");
+           # 'my' doesn't trigger the bug
+    is "@PATH", "Font GlyphNames", "hybrid scalar-and-array context";
 }
Index: src/gnu/usr.bin/perl/t/op/sprintf.t
diff -u src/gnu/usr.bin/perl/t/op/sprintf.t:1.11 src/gnu/usr.bin/perl/t/op/sprintf.t:1.12
--- t/op/sprintf.t:1.11	Mon Oct 12 18:30:28 2009
+++ t/op/sprintf.t	Fri Sep 24 15:07:09 2010
@@ -60,6 +60,8 @@
 	$w = ' INVALID';
     } elsif ($_[0] =~ /^Use of uninitialized value/) {
 	$w = ' UNINIT';
+    } elsif ($_[0] =~ /^Missing argument/) {
+	$w = ' MISSING';
     } else {
 	warn @_;
     }
@@ -618,7 +620,7 @@
 >%3$d %d %d<	>[12, 34, 56]<	>56 12 34<
 >%2$*3$d %d<	>[12, 34, 3]<	> 34 12<
 >%*3$2$d %d<	>[12, 34, 3]<	>%*3$2$d 12 INVALID<
->%2$d<		>12<	>0 UNINIT<
+>%2$d<		>12<	>0 MISSING<
 >%0$d<		>12<	>%0$d INVALID<
 >%1$$d<		>12<	>%1$$d INVALID<
 >%1$1$d<	>12<	>%1$1$d INVALID<
@@ -685,4 +687,4 @@
 >%#o<		>0<	>0<
 >%#x<		>0<	>0<
 >%2147483647$v2d<	>''<	><
->%*2147483647$v2d<	>''<	> UNINIT<
+>%*2147483647$v2d<	>''<	> MISSING<
Index: src/gnu/usr.bin/perl/t/op/sprintf2.t
diff -u src/gnu/usr.bin/perl/t/op/sprintf2.t:1.4 src/gnu/usr.bin/perl/t/op/sprintf2.t:1.5
--- t/op/sprintf2.t:1.4	Mon Oct 12 18:30:28 2009
+++ t/op/sprintf2.t	Fri Sep 24 15:07:09 2010
@@ -8,6 +8,9 @@
 
 plan tests => 1368;
 
+use strict;
+use Config;
+
 is(
     sprintf("%.40g ",0.01),
     sprintf("%.40g", 0.01)." ",
@@ -38,9 +41,9 @@
 }
 
 # Used to mangle PL_sv_undef
-fresh_perl_is(
+fresh_perl_like(
     'print sprintf "xxx%n\n"; print undef',
-    'Modification of a read-only value attempted at - line 1.',
+    'Modification of a read-only value attempted at - line 1\.',
     { switches => [ '-w' ] },
     q(%n should not be able to modify read-only constants),
 );
@@ -57,7 +60,7 @@
 {
     my ($warn, $bad) = (0,0);
     local $SIG{__WARN__} = sub {
-	if ($_[0] =~ /uninitialized/) {
+	if ($_[0] =~ /missing argument/i) {
 	    $warn++
 	}
 	else {
@@ -140,8 +143,26 @@
     is $@, "", "sprintf(\"%f\", $n)";
 }
 
-SKIP: {
-    skip "placeholder for tests not merged from 53f65a9ef4", 24;
+# test %ll formats with and without HAS_QUAD
+eval { my $q = pack "q", 0 };
+my $Q = $@ eq '';
+
+my @tests = (
+  [ '%lld' => [qw( 4294967296 -100000000000000 )] ],
+  [ '%lli' => [qw( 4294967296 -100000000000000 )] ],
+  [ '%llu' => [qw( 4294967296  100000000000000 )] ],
+  [ '%Ld'  => [qw( 4294967296 -100000000000000 )] ],
+  [ '%Li'  => [qw( 4294967296 -100000000000000 )] ],
+  [ '%Lu'  => [qw( 4294967296  100000000000000 )] ],
+);
+
+for my $t (@tests) {
+  my($fmt, $nums) = @$t;
+  for my $num (@$nums) {
+    my $w; local $SIG{__WARN__} = sub { $w = shift };
+    is(sprintf($fmt, $num), $Q ? $num : $fmt, "quad: $fmt -> $num");
+    like($w, $Q ? '' : qr/Invalid conversion in sprintf: "$fmt"/, "warning: $fmt");
+  }
 }
 
 # Check unicode vs byte length
Index: src/gnu/usr.bin/perl/t/op/stat.t
diff -u src/gnu/usr.bin/perl/t/op/stat.t:1.11 src/gnu/usr.bin/perl/t/op/stat.t:1.12
--- t/op/stat.t:1.11	Mon Oct 12 18:30:28 2009
+++ t/op/stat.t	Fri Sep 24 15:07:09 2010
@@ -17,7 +17,6 @@
 $Is_Cygwin  = $^O eq 'cygwin';
 $Is_Darwin  = $^O eq 'darwin';
 $Is_Dos     = $^O eq 'dos';
-$Is_MacOS   = $^O eq 'MacOS';
 $Is_MPE     = $^O eq 'mpeix';
 $Is_MSWin32 = $^O eq 'MSWin32';
 $Is_NetWare = $^O eq 'NetWare';
@@ -28,10 +27,15 @@
 $Is_MPRAS   = $^O =~ /svr4/ && -f '/etc/.relid';
 $Is_Rhapsody= $^O eq 'rhapsody';
 
-$Is_Dosish  = $Is_Dos || $Is_OS2 || $Is_MSWin32 || $Is_NetWare || $Is_Cygwin;
+$Is_Dosish  = $Is_Dos || $Is_OS2 || $Is_MSWin32 || $Is_NetWare;
 
 $Is_UFS     = $Is_Darwin && (() = `df -t ufs . 2>/dev/null`) == 2;
 
+if ($Is_Cygwin) {
+  require Win32;
+  Win32->import;
+}
+
 my($DEV, $INO, $MODE, $NLINK, $UID, $GID, $RDEV, $SIZE,
    $ATIME, $MTIME, $CTIME, $BLKSIZE, $BLOCKS) = (0..12);
 
@@ -64,7 +68,7 @@
 
 SKIP: {
   skip "mtime and ctime not reliable", 2
-    if $Is_MSWin32 or $Is_NetWare or $Is_Cygwin or $Is_Dos or $Is_MacOS or $Is_Darwin;
+    if $Is_MSWin32 or $Is_NetWare or $Is_Cygwin or $Is_Dos or $Is_Darwin;
 
   ok( $mtime,           'mtime' );
   is( $mtime, $ctime,   'mtime == ctime' );
@@ -164,10 +168,10 @@
         my $olduid = $>;
         eval { $> = 1; };
         skip "Can't test -r or -w meaningfully if you're superuser", 2
-          if $> == 0;
+          if ($Is_Cygwin ? Win32::IsAdminUser : $> == 0);
 
         SKIP: {
-            skip "Can't test -r meaningfully?", 1 if $Is_Dos || $Is_Cygwin;
+            skip "Can't test -r meaningfully?", 1 if $Is_Dos;
             ok(!-r $tmpfile,    "   -r");
         }
 
@@ -188,7 +192,7 @@
 
 SKIP: {
     skip "-x simply determines if a file ends in an executable suffix", 1
-      if $Is_Dosish || $Is_MacOS;
+      if $Is_Dosish;
 
     ok(-x $tmpfile,     '   -x');
 }
@@ -496,8 +500,11 @@
     ok(-d DIR, "-d on a dirhandle works");
 
     # And now for the ambigious bareword case
-    ok(open(DIR, "TEST"), 'Can open "TEST" dir')
-	|| diag "Can't open 'TEST':  $!";
+    {
+	no warnings 'deprecated';
+	ok(open(DIR, "TEST"), 'Can open "TEST" dir')
+	    || diag "Can't open 'TEST':  $!";
+    }
     my $size = (stat(DIR))[7];
     ok(defined $size, "stat() on bareword works");
     is($size, -s "TEST", "size returned by stat of bareword is for the file");
@@ -526,8 +533,11 @@
         ok(-d -r *DIR{IO} , "chained -x's on *DIR{IO}");
 
 	# And now for the ambigious bareword case
-	ok(open(DIR, "TEST"), 'Can open "TEST" dir')
-	    || diag "Can't open 'TEST':  $!";
+	{
+	    no warnings 'deprecated';
+	    ok(open(DIR, "TEST"), 'Can open "TEST" dir')
+		|| diag "Can't open 'TEST':  $!";
+	}
 	my $size = (stat(*DIR{IO}))[7];
 	ok(defined $size, "stat() on *THINGY{IO} works");
 	is($size, -s "TEST",
Index: src/gnu/usr.bin/perl/t/op/study.t
diff -u src/gnu/usr.bin/perl/t/op/study.t:1.7 src/gnu/usr.bin/perl/t/op/study.t:1.8
--- t/op/study.t:1.7	Mon Sep 29 17:36:20 2008
+++ t/op/study.t	Fri Sep 24 15:07:09 2010
@@ -104,7 +104,7 @@
 # used to be a test for $*
 ok("ab\ncd\n" =~ /^cd/m);
 
-if ($^O eq 'os390' or $^O eq 'posix-bc' or $^O eq 'MacOS') {
+if ($^O eq 'os390' or $^O eq 'posix-bc') {
     # Even with the alarm() OS/390 and BS2000 can't manage these tests
     # (Perl just goes into a busy loop, luckily an interruptable one)
     for (25..26) { print "not ok $_ # TODO compiler bug?\n" }
Index: src/gnu/usr.bin/perl/t/op/sysio.t
diff -u src/gnu/usr.bin/perl/t/op/sysio.t:1.6 src/gnu/usr.bin/perl/t/op/sysio.t:1.7
--- t/op/sysio.t:1.6	Mon Oct 12 18:30:28 2009
+++ t/op/sysio.t	Fri Sep 24 15:07:09 2010
@@ -1,10 +1,12 @@
 #!./perl
 
-print "1..42\n";
+BEGIN {
+  chdir('op') || chdir('t/op') || die "sysio.t: cannot look for myself: $!";
+  @INC = '../../lib';
+  require '../test.pl';
+}
 
-chdir('op') || chdir('t/op') || die "sysio.t: cannot look for myself: $!";
-@INC = '../../lib';
-require '../test.pl';
+plan tests => 48;
 
 open(I, 'sysio.t') || die "sysio.t: cannot find myself: $!";
 
@@ -19,47 +21,37 @@
 
 # should not be able to do negative lengths
 eval { sysread(I, $x, -1) };
-print 'not ' unless ($@ =~ /^Negative length /);
-print "ok 1\n";
+like($@, qr/^Negative length /);
 
 # $x should be intact
-print 'not ' unless ($x eq 'abc');
-print "ok 2\n";
+is($x, 'abc');
 
 # should not be able to read before the buffer
 eval { sysread(I, $x, 1, -4) };
-print 'not ' unless ($x eq 'abc');
-print "ok 3\n";
+like($@, qr/^Offset outside string /);
 
 # $x should be intact
-print 'not ' unless ($x eq 'abc');
-print "ok 4\n";
+is($x, 'abc');
 
 $a ='0123456789';
 
 # default offset 0
-print 'not ' unless(sysread(I, $a, 3) == 3);
-print "ok 5\n";
+is(sysread(I, $a, 3), 3);
 
 # $a should be as follows
-print 'not ' unless ($a eq '#!.');
-print "ok 6\n";
+is($a, '#!.');
 
 # reading past the buffer should zero pad
-print 'not ' unless(sysread(I, $a, 2, 5) == 2);
-print "ok 7\n";
+is(sysread(I, $a, 2, 5), 2);
 
 # the zero pad should be seen now
-print 'not ' unless ($a eq "#!.\0\0/p");
-print "ok 8\n";
+is($a, "#!.\0\0/p");
 
 # try changing the last two characters of $a
-print 'not ' unless(sysread(I, $a, 3, -2) == 3);
-print "ok 9\n";
+is(sysread(I, $a, 3, -2), 3);
 
 # the last two characters of $a should have changed (into three)
-print 'not ' unless ($a eq "#!.\0\0erl");
-print "ok 10\n";
+is($a, "#!.\0\0erl");
 
 $outfile = tempfile();
 
@@ -69,115 +61,125 @@
 
 # cannot write negative lengths
 eval { syswrite(O, $x, -1) };
-print 'not ' unless ($@ =~ /^Negative length /);
-print "ok 11\n";
+like($@, qr/^Negative length /);
 
 # $x still intact
-print 'not ' unless ($x eq 'abc');
-print "ok 12\n";
+is($x, 'abc');
 
 # $outfile still intact
-print 'not ' if (-s $outfile);
-print "ok 13\n";
+ok(!-s $outfile);
 
 # should not be able to write from after the buffer
-eval { syswrite(O, $x, 1, 3) };
-print 'not ' unless ($@ =~ /^Offset outside string /);
-print "ok 14\n";
+eval { syswrite(O, $x, 1, 4) };
+like($@, qr/^Offset outside string /);
 
 # $x still intact
-print 'not ' unless ($x eq 'abc');
-print "ok 15\n";
+is($x, 'abc');
+
+# but it should be ok to write from the end of the buffer
+syswrite(O, $x, 0, 3);
+syswrite(O, $x, 1, 3);
 
 # $outfile still intact
 if ($reopen) {  # must close file to update EOF marker for stat
   close O; open(O, ">>$outfile") || die "sysio.t: cannot write $outfile: $!";
 }
-print 'not ' if (-s $outfile);
-print "ok 16\n";
+ok(!-s $outfile);
 
 # should not be able to write from before the buffer
 
 eval { syswrite(O, $x, 1, -4) };
-print 'not ' unless ($@ =~ /^Offset outside string /);
-print "ok 17\n";
+like($@, qr/^Offset outside string /);
+
+# $x still intact
+is($x, 'abc');
+
+# $outfile still intact
+if ($reopen) {  # must close file to update EOF marker for stat
+  close O; open(O, ">>$outfile") || die "sysio.t: cannot write $outfile: $!";
+}
+ok(!-s $outfile);
+
+# [perl #67912] syswrite prints garbage if called with empty scalar and non-zero offset
+eval { my $buf = ''; syswrite(O, $buf, 1, 1) };
+like($@, qr/^Offset outside string /);
 
 # $x still intact
-print 'not ' unless ($x eq 'abc');
-print "ok 18\n";
+is($x, 'abc');
 
 # $outfile still intact
 if ($reopen) {  # must close file to update EOF marker for stat
   close O; open(O, ">>$outfile") || die "sysio.t: cannot write $outfile: $!";
 }
-print 'not ' if (-s $outfile);
-print "ok 19\n";
+ok(!-s $outfile);
+
+eval { my $buf = 'x'; syswrite(O, $buf, 1, 2) };
+like($@, qr/^Offset outside string /);
+
+# $x still intact
+is($x, 'abc');
+
+# $outfile still intact
+if ($reopen) {  # must close file to update EOF marker for stat
+  close O; open(O, ">>$outfile") || die "sysio.t: cannot write $outfile: $!";
+}
+ok(!-s $outfile);
 
 # default offset 0
 if (syswrite(O, $a, 2) == 2){
-  print "ok 20\n";
+  pass();
 } else {
-  print "# $!\nnot ok 20\n";
+  diag($!);
+  fail();
   # most other tests make no sense after e.g. "No space left on device"
   die $!;
 }
 
 
 # $a still intact
-print 'not ' unless ($a eq "#!.\0\0erl");
-print "ok 21\n";
+is($a, "#!.\0\0erl");
 
 # $outfile should have grown now
 if ($reopen) {  # must close file to update EOF marker for stat
   close O; open(O, ">>$outfile") || die "sysio.t: cannot write $outfile: $!";
 }
-print 'not ' unless (-s $outfile == 2);
-print "ok 22\n";
+is(-s $outfile, 2);
 
 # with offset
-print 'not ' unless (syswrite(O, $a, 2, 5) == 2);
-print "ok 23\n";
+is(syswrite(O, $a, 2, 5), 2);
 
 # $a still intact
-print 'not ' unless ($a eq "#!.\0\0erl");
-print "ok 24\n";
+is($a, "#!.\0\0erl");
 
 # $outfile should have grown now
 if ($reopen) {  # must close file to update EOF marker for stat
   close O; open(O, ">>$outfile") || die "sysio.t: cannot write $outfile: $!";
 }
-print 'not ' unless (-s $outfile == 4);
-print "ok 25\n";
+is(-s $outfile, 4);
 
 # with negative offset and a bit too much length
-print 'not ' unless (syswrite(O, $a, 5, -3) == 3);
-print "ok 26\n";
+is(syswrite(O, $a, 5, -3), 3);
 
 # $a still intact
-print 'not ' unless ($a eq "#!.\0\0erl");
-print "ok 27\n";
+is($a, "#!.\0\0erl");
 
 # $outfile should have grown now
 if ($reopen) {  # must close file to update EOF marker for stat
   close O; open(O, ">>$outfile") || die "sysio.t: cannot write $outfile: $!";
 }
-print 'not ' unless (-s $outfile == 7);
-print "ok 28\n";
+is(-s $outfile, 7);
 
 # with implicit length argument
-print 'not ' unless (syswrite(O, $x) == 3);
-print "ok 29\n";
+is(syswrite(O, $x), 3);
 
 # $a still intact
-print 'not ' unless ($x eq "abc");
-print "ok 30\n";
+is($x, "abc");
 
 # $outfile should have grown now
 if ($reopen) {  # must close file to update EOF marker for stat
   close O; open(O, ">>$outfile") || die "sysio.t: cannot write $outfile: $!";
 }
-print 'not ' unless (-s $outfile == 10);
-print "ok 31\n";
+is(-s $outfile, 10);
 
 close(O);
 
@@ -186,30 +188,24 @@
 $b = 'xyz';
 
 # reading too much only return as much as available
-print 'not ' unless (sysread(I, $b, 100) == 10);
-print "ok 32\n";
+is(sysread(I, $b, 100), 10);
+
 # this we should have
-print 'not ' unless ($b eq '#!ererlabc');
-print "ok 33\n";
+is($b, '#!ererlabc');
 
 # test sysseek
 
-print 'not ' unless sysseek(I, 2, 0) == 2;
-print "ok 34\n";
+is(sysseek(I, 2, 0), 2);
 sysread(I, $b, 3);
-print 'not ' unless $b eq 'ere';
-print "ok 35\n";
+is($b, 'ere');
 
-print 'not ' unless sysseek(I, -2, 1) == 3;
-print "ok 36\n";
+is(sysseek(I, -2, 1), 3);
 sysread(I, $b, 4);
-print 'not ' unless $b eq 'rerl';
-print "ok 37\n";
+is($b, 'rerl');
+
+ok(sysseek(I, 0, 0) eq '0 but true');
 
-print 'not ' unless sysseek(I, 0, 0) eq '0 but true';
-print "ok 38\n";
-print 'not ' if defined sysseek(I, -1, 1);
-print "ok 39\n";
+ok(not defined sysseek(I, -1, 1));
 
 close(I);
 
@@ -224,16 +220,16 @@
 # y diaresis is \w when UTF8
 $a = chr 255;
 
-print $a =~ /\w/ ? "not ok 40\n" : "ok 40\n";
+unlike($a, qr/\w/);
 
 syswrite I, $a;
 
 # Should not be upgraded as a side effect of syswrite.
-print $a =~ /\w/ ? "not ok 41\n" : "ok 41\n";
+unlike($a, qr/\w/);
 
 # This should work
 eval {syswrite I, 2;};
-print $@ eq "" ? "ok 42\n" : "not ok 42 # $@";
+is($@, '');
 
 close(I);
 unlink $outfile;
Index: src/gnu/usr.bin/perl/t/op/taint.t
diff -u src/gnu/usr.bin/perl/t/op/taint.t:1.12 src/gnu/usr.bin/perl/t/op/taint.t:1.13
--- t/op/taint.t:1.12	Mon Oct 12 18:30:28 2009
+++ t/op/taint.t	Fri Sep 24 15:07:09 2010
@@ -17,7 +17,7 @@
 use File::Spec::Functions;
 
 BEGIN { require './test.pl'; }
-plan tests => 301;
+plan tests => 302;
 
 $| = 1;
 
@@ -42,7 +42,6 @@
   }
 }
 
-my $Is_MacOS    = $^O eq 'MacOS';
 my $Is_VMS      = $^O eq 'VMS';
 my $Is_MSWin32  = $^O eq 'MSWin32';
 my $Is_NetWare  = $^O eq 'NetWare';
@@ -51,8 +50,7 @@
 my $Is_OpenBSD  = $^O eq 'openbsd';
 my $Invoke_Perl = $Is_VMS      ? 'MCR Sys$Disk:[]Perl.exe' :
                   $Is_MSWin32  ? '.\perl'               :
-                  $Is_MacOS    ? ':perl'                :
-                  $Is_NetWare  ? 'perl'                 : 
+                  $Is_NetWare  ? 'perl'                 :
                                  './perl'               ;
 my @MoreEnv = qw/IFS CDPATH ENV BASH_ENV/;
 
@@ -134,7 +132,7 @@
 }
 
 # We need an external program to call.
-my $ECHO = ($Is_MSWin32 ? ".\\echo$$" : $Is_MacOS ? ":echo$$" : ($Is_NetWare ? "echo$$" : "./echo$$"));
+my $ECHO = ($Is_MSWin32 ? ".\\echo$$" : ($Is_NetWare ? "echo$$" : "./echo$$"));
 END { unlink $ECHO }
 open PROG, "> $ECHO" or die "Can't create $ECHO: $!";
 print PROG 'print "@ARGV\n"', "\n";
@@ -173,7 +171,7 @@
 
     SKIP: {
         skip "Environment tainting tests skipped", 4
-          if $Is_MSWin32 || $Is_NetWare || $Is_VMS || $Is_Dos || $Is_MacOS;
+          if $Is_MSWin32 || $Is_NetWare || $Is_VMS || $Is_Dos;
 
 	my @vars = ('PATH', @MoreEnv);
 	while (my $v = $vars[0]) {
@@ -430,8 +428,7 @@
     # just because Errno possibly failing.
     test eval('$!{ENOENT}') ||
 	$! == 2 || # File not found
-	($Is_Dos && $! == 22) ||
-	($^O eq 'mint' && $! == 33);
+	($Is_Dos && $! == 22);
 
     test !eval { open FOO, "> $foo" }, 'open for write';
     test $@ =~ /^Insecure dependency/, $@;
@@ -628,7 +625,6 @@
 	unlink($symlink);
 	my $sl = "/something/naughty";
 	# it has to be a real path on Mac OS
-	$sl = MacPerl::MakePath((MacPerl::Volumes())[0]) if $Is_MacOS;
 	symlink($sl, $symlink) or die "symlink: $!\n";
 	my $readlink = readlink($symlink);
 	test tainted $readlink;
@@ -973,15 +969,11 @@
     };
     test !$@;
 
-    SKIP: {
-        skip "no exec() on MacOS Classic" if $Is_MacOS;
-
-	eval { 
-            no warnings;
-            exec("lskdfj does not exist","with","args"); 
-        };
-	test !$@;
-    }
+    eval {
+	no warnings;
+	exec("lskdfj does not exist","with","args"); 
+    };
+    test !$@;
 
     # If you add tests here update also the above skip block for VMS.
 }
@@ -1315,6 +1307,17 @@
     my $zz = pack "a*a*", q{print "Hello world\n"}, $TAINT;
     ok(tainted($zz), "pack a*a* preserves tainting");
 }
+
+# Bug RT #61976 tainted $! would show numeric rather than string value
+
+{
+    my $tainted_path = substr($^X,0,0) . "/no/such/file";
+    my $err;
+    # $! is used in a tainted expression, so gets tainted
+    open my $fh, $tainted_path or $err= "$!";
+    unlike($err, qr/^\d+$/, 'tainted $!');
+}
+
 
 # This may bomb out with the alarm signal so keep it last
 SKIP: {
Index: src/gnu/usr.bin/perl/t/op/tie.t
diff -u src/gnu/usr.bin/perl/t/op/tie.t:1.10 src/gnu/usr.bin/perl/t/op/tie.t:1.11
--- t/op/tie.t:1.10	Mon Sep 29 17:36:20 2008
+++ t/op/tie.t	Fri Sep 24 15:07:09 2010
@@ -447,7 +447,7 @@
 ok
 ########
 
-# TODO [perl #948] cannot meaningfully tie $,
+# [perl #948] cannot meaningfully tie $,
 package TieDollarComma;
 
 sub TIESCALAR {
@@ -463,7 +463,7 @@
 
 sub FETCH {
     my $self = shift;
-    print "FETCH\n";
+    print "<FETCH>";
     return $$self;
 }
 package main;
@@ -473,9 +473,7 @@
 print "join", "things", "up\n";
 EXPECT
 STORE set 'BOBBINS'
-FETCH
-FETCH
-joinBOBBINSthingsBOBBINSup
+join<FETCH>BOBBINSthings<FETCH>BOBBINSup
 ########
 
 # test SCALAR method
@@ -508,13 +506,17 @@
 tie my %h => "TieScalar";
 $h{key1} = "val1";
 $h{key2} = "val2";
-print scalar %h, "\n";
+print scalar %h, "\n"
+    if %h; # this should also call SCALAR but implicitly
 %h = ();
-print scalar %h, "\n";
+print scalar %h, "\n"
+    if !%h; # this should also call SCALAR but implicitly
 EXPECT
 SCALAR
+SCALAR
 2/2
 SCALAR
+SCALAR
 0
 ########
 
@@ -586,13 +588,19 @@
 EXPECT
 01
 ########
+# Bug 53482 (and maybe others)
 sub TIESCALAR { my $foo = $_[1]; bless \$foo, $_[0] }
 sub FETCH { ${$_[0]} }
-tie my $x, "main", 2;
-tie my $y, "main", 8;
-print $x | $y;
+tie my $x1, "main", 2;
+tie my $y1, "main", 8;
+print $x1 | $y1;
+print $x1 | $y1;
+tie my $x2, "main", "2";
+tie my $y2, "main", "8";
+print $x2 | $y2;
+print $x2 | $y2;
 EXPECT
-10
+1010::
 ########
 # Bug 36267
 sub TIEHASH  { bless {}, $_[0] }
Index: src/gnu/usr.bin/perl/t/op/time.t
diff -u src/gnu/usr.bin/perl/t/op/time.t:1.10 src/gnu/usr.bin/perl/t/op/time.t:1.11
--- t/op/time.t:1.10	Mon Sep 29 17:36:20 2008
+++ t/op/time.t	Fri Sep 24 15:07:09 2010
@@ -1,6 +1,4 @@
-#!./perl
-
-$does_gmtime = gmtime(time);
+#!./perl -w
 
 BEGIN {
     chdir 't' if -d 't';
@@ -8,7 +6,13 @@
     require './test.pl';
 }
 
-plan tests => 8;
+plan tests => 62;
+
+# These tests make sure, among other things, that we don't end up
+# burning tons of CPU for dates far in the future.
+# watchdog() makes sure that the test script eventually exits if
+# the tests are triggering the failing behavior
+watchdog(15);
 
 ($beguser,$begsys) = times;
 
@@ -32,7 +36,9 @@
 ($xsec,$foo) = localtime($now);
 $localyday = $yday;
 
-ok($sec != $xsec && $mday && $year,             'localtime() list context');
+isnt($sec, $xsec,      'localtime() list context');
+ok $mday,              '  month day';
+ok $year,              '  year';
 
 ok(localtime() =~ /^(Sun|Mon|Tue|Wed|Thu|Fri|Sat)[ ]
                     (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)[ ]
@@ -44,7 +50,7 @@
 SKIP: {
     # This conditional of "No tzset()" is stolen from ext/POSIX/t/time.t
     skip "No tzset()", 1
-        if $^O eq "MacOS" || $^O eq "VMS" || $^O eq "cygwin" ||
+        if $^O eq "VMS" || $^O eq "cygwin" ||
            $^O eq "djgpp" || $^O eq "MSWin32" || $^O eq "dos" ||
            $^O eq "interix";
 
@@ -56,13 +62,13 @@
 ok($hour != $hour2,                             'changes to $ENV{TZ} respected');
 }
 
-SKIP: {
-    skip "No gmtime()", 3 unless $does_gmtime;
 
 ($sec,$min,$hour,$mday,$mon,$year,$wday,$yday,$isdst) = gmtime($beg);
 ($xsec,$foo) = localtime($now);
 
-ok($sec != $xsec && $mday && $year,             'gmtime() list context');
+isnt($sec, $xsec,      'gmtime() list conext');
+ok $mday,              '  month day';
+ok $year,              '  year';
 
 my $day_diff = $localyday - $yday;
 ok( grep({ $day_diff == $_ } (0, 1, -1, 364, 365, -364, -365)),
@@ -76,4 +82,121 @@
                /x,
    'gmtime(), scalar context'
   );
+
+
+
+# Test gmtime over a range of times.
+{
+    # The range should be limited only by the 53-bit mantissa of an IEEE double (or 
+    # whatever kind of double you've got).  Here we just prove that we're comfortably 
+    # beyond the range possible with 32-bit time_t.
+    my %tests = (
+        # time_t         gmtime list                          scalar
+        -2**35  => [52, 13, 20, 7, 2, -1019, 5, 65, 0, "Fri Mar  7 20:13:52 881"],
+        -2**32  => [44, 31, 17, 24, 10, -67, 0, 327, 0, "Sun Nov 24 17:31:44 1833"],
+        -2**31  => [52, 45, 20, 13, 11, 1, 5, 346, 0, "Fri Dec 13 20:45:52 1901"],
+        -1      => [59, 59, 23, 31, 11, 69, 3, 364, 0, "Wed Dec 31 23:59:59 1969"],
+        0       => [0, 0, 0, 1, 0, 70, 4, 0, 0, "Thu Jan  1 00:00:00 1970"],
+        1       => [1, 0, 0, 1, 0, 70, 4, 0, 0, "Thu Jan  1 00:00:01 1970"],
+        2**30   => [4, 37, 13, 10, 0, 104, 6, 9, 0, "Sat Jan 10 13:37:04 2004"],
+        2**31   => [8, 14, 3, 19, 0, 138, 2, 18, 0, "Tue Jan 19 03:14:08 2038"],
+        2**32   => [16, 28, 6, 7, 1, 206, 0, 37, 0, "Sun Feb  7 06:28:16 2106"],
+        2**39   => [8, 18, 12, 25, 0, 17491, 2, 24, 0, "Tue Jan 25 12:18:08 19391"],
+    );
+
+    for my $time (keys %tests) {
+        my @expected  = @{$tests{$time}};
+        my $scalar    = pop @expected;
+
+        ok eq_array([gmtime($time)], \@expected),  "gmtime($time) list context";
+        is scalar gmtime($time), $scalar,       "  scalar";
+    }
+}
+
+
+# Test localtime
+{
+    # We pick times which fall in the middle of a month, so the month and year should be
+    # the same regardless of the time zone.
+    my %tests = (
+        # time_t           month, year,  scalar
+        -8589934592     => [9,    -203,                 qr/Oct \d+ .* 1697$/],
+        -1296000        => [11,   69,                   qr/Dec \d+ .* 1969$/],
+        1296000         => [0,    70,                   qr/Jan \d+ .* 1970$/],
+        5000000000      => [5,    228,                  qr/Jun \d+ .* 2128$/],
+        1163500000      => [10,   106,                  qr/Nov \d+ .* 2006$/],
+    );
+
+    for my $time (keys %tests) {
+        my @expected  = @{$tests{$time}};
+        my $scalar    = pop @expected;
+
+        my @time = (localtime($time))[4,5];
+        ok( eq_array(\@time, \@expected),  "localtime($time) list context" )
+          or diag("@time");
+        like scalar localtime($time), $scalar,       "  scalar";
+    }
+}
+
+# Test floating point args
+{
+    eval {
+        $SIG{__WARN__} = sub { die @_; };
+        is( (localtime(1296000.23))[5] + 1900, 1970 );
+    };
+    is($@, '', 'Ignore fractional time');
+    eval {
+        $SIG{__WARN__} = sub { die @_; };
+        is( (gmtime(1.23))[5] + 1900, 1970 );
+    };
+    is($@, '', 'Ignore fractional time');
+}
+
+
+# Some sanity tests for the far, far future and far, far past
+{
+    my %time2year = (
+        -2**52  => -142711421,
+        -2**48  => -8917617,
+        -2**46  => -2227927,
+         2**46  => 2231866,
+         2**48  => 8921556,
+         2**52  => 142715360,
+    );
+
+    for my $time (sort keys %time2year) {
+        my $want = $time2year{$time};
+
+        my $have = (gmtime($time))[5] + 1900;
+        is $have, $want, "year check, gmtime($time)";
+
+        $have = (localtime($time))[5] + 1900;
+        is $have, $want, "year check, localtime($time)";
+    }
+}
+
+
+# Test that Perl warns properly when it can't handle a time.
+{
+    my $warning;
+    local $SIG{__WARN__} = sub { $warning .= join "\n", @_; };
+
+    my $big_time   = 2**60;
+    my $small_time = -2**60;
+
+    $warning = '';
+    my $date = gmtime($big_time);
+    like $warning, qr/^gmtime(.*) too large/;
+
+    $warning = '';
+    $date = localtime($big_time);
+    like $warning, qr/^localtime(.*) too large/;
+
+    $warning = '';
+    $date = gmtime($small_time);
+    like $warning, qr/^gmtime(.*) too small/;
+
+    $warning = '';
+    $date = localtime($small_time);
+    like $warning, qr/^localtime(.*) too small/;
 }
Index: src/gnu/usr.bin/perl/t/op/undef.t
diff -u src/gnu/usr.bin/perl/t/op/undef.t:1.7 src/gnu/usr.bin/perl/t/op/undef.t:1.8
--- t/op/undef.t:1.7	Mon Oct 12 18:30:28 2009
+++ t/op/undef.t	Fri Sep 24 15:07:09 2010
@@ -10,7 +10,7 @@
 
 use vars qw(@ary %ary %hash);
 
-plan 37;
+plan 40;
 
 ok !defined($a);
 
@@ -45,15 +45,27 @@
 ok !defined($ary{'foo'});
 
 ok defined(@ary);
-ok defined(%ary);
+{
+    no warnings 'deprecated';
+    ok defined(%ary);
+}
+ok %ary;
 undef @ary;
 ok !defined(@ary);
 undef %ary;
-ok !defined(%ary);
+{
+    no warnings 'deprecated';
+    ok !defined(%ary);
+}
+ok !%ary;
 @ary = (1);
 ok defined @ary;
 %ary = (1,1);
-ok defined %ary;
+{
+    no warnings 'deprecated';
+    ok defined %ary;
+}
+ok %ary;
 
 sub foo { pass; 1 }
 
@@ -72,6 +84,7 @@
 {
     require Tie::Hash;
     tie my %foo, 'Tie::StdHash';
+    no warnings 'deprecated';
     ok defined %foo;
     %foo = ( a => 1 );
     ok defined %foo;
@@ -80,6 +93,7 @@
 {
     require Tie::Array;
     tie my @foo, 'Tie::StdArray';
+    no warnings 'deprecated';
     ok defined @foo;
     @foo = ( a => 1 );
     ok defined @foo;
Index: src/gnu/usr.bin/perl/t/op/universal.t
diff -u src/gnu/usr.bin/perl/t/op/universal.t:1.10 src/gnu/usr.bin/perl/t/op/universal.t:1.11
--- t/op/universal.t:1.10	Mon Oct 12 18:30:28 2009
+++ t/op/universal.t	Fri Sep 24 15:07:09 2010
@@ -10,7 +10,7 @@
     require "./test.pl";
 }
 
-plan tests => 116;
+plan tests => 124;
 
 $a = {};
 bless $a, "Bob";
@@ -245,3 +245,70 @@
 ok (!splatt->isa('zlopp'));
 ok (splatt->isa('plop'));
 
+use warnings "deprecated";
+{
+    my $m;
+    local $SIG{__WARN__} = sub { $m = $_[0] };
+    eval "use UNIVERSAL 'can'";
+    like($m, qr/^UNIVERSAL->import is deprecated/,
+	"deprecation warning for UNIVERSAL->import('can')");
+
+	  undef $m;
+    eval "use UNIVERSAL";
+    is($m, undef,
+	"no deprecation warning for UNIVERSAL->import");
+}
+
+# Test: [perl #66112]: change @ISA inside  sub isa
+{
+    package RT66112::A;
+
+    package RT66112::B;
+
+    sub isa {
+	my $self = shift;
+	@ISA = qw/RT66112::A/;
+	return $self->SUPER::isa(@_);
+    }
+
+    package RT66112::C;
+
+    package RT66112::D;
+
+    sub isa {
+	my $self = shift;
+	@RT66112::E::ISA = qw/RT66112::A/;
+	return $self->SUPER::isa(@_);
+    }
+
+    package RT66112::E;
+
+    package main;
+
+    @RT66112::B::ISA = qw//;
+    @RT66112::C::ISA = qw/RT66112::B/;
+    @RT66112::T1::ISA = qw/RT66112::C/;
+    ok(RT66112::T1->isa('RT66112::C'), "modify \@ISA in isa (RT66112::T1 isa RT66112::C)");
+
+    @RT66112::B::ISA = qw//;
+    @RT66112::C::ISA = qw/RT66112::B/;
+    @RT66112::T2::ISA = qw/RT66112::C/;
+    ok(RT66112::T2->isa('RT66112::B'), "modify \@ISA in isa (RT66112::T2 isa RT66112::B)");
+
+    @RT66112::B::ISA = qw//;
+    @RT66112::C::ISA = qw/RT66112::B/;
+    @RT66112::T3::ISA = qw/RT66112::C/;
+    ok(RT66112::T3->isa('RT66112::A'), "modify \@ISA in isa (RT66112::T3 isa RT66112::A)");
+
+    @RT66112::E::ISA = qw/RT66112::D/;
+    @RT66112::T4::ISA = qw/RT66112::E/;
+    ok(RT66112::T4->isa('RT66112::E'), "modify \@ISA in isa (RT66112::T4 isa RT66112::E)");
+
+    @RT66112::E::ISA = qw/RT66112::D/;
+    @RT66112::T5::ISA = qw/RT66112::E/;
+    ok(! RT66112::T5->isa('RT66112::D'), "modify \@ISA in isa (RT66112::T5 not isa RT66112::D)");
+
+    @RT66112::E::ISA = qw/RT66112::D/;
+    @RT66112::T6::ISA = qw/RT66112::E/;
+    ok(RT66112::T6->isa('RT66112::A'), "modify \@ISA in isa (RT66112::T6 isa RT66112::A)");
+}
Index: src/gnu/usr.bin/perl/t/op/unshift.t
diff -u src/gnu/usr.bin/perl/t/op/unshift.t:1.8 src/gnu/usr.bin/perl/t/op/unshift.t:1.9
--- t/op/unshift.t:1.8	Mon Sep 29 17:36:20 2008
+++ t/op/unshift.t	Fri Sep 24 15:07:09 2010
@@ -1,12 +1,67 @@
 #!./perl
 
-print "1..2\n";
+BEGIN {
+    require "test.pl";
+}
 
-@a = (1,2,3);
-$cnt1 = unshift(a,0);
+plan(18);
 
-if (join(' ',@a) eq '0 1 2 3') {print "ok 1\n";} else {print "not ok 1\n";}
-$cnt2 = unshift(a,3,2,1);
-if (join(' ',@a) eq '3 2 1 0 1 2 3') {print "ok 2\n";} else {print "not ok 2\n";}
+@array = (1, 2, 3);
 
+{
+    no warnings 'syntax';
+    $count3 = unshift (@array);
+}
+is(join(' ',@array), '1 2 3', 'unshift null');
+cmp_ok($count3, '==', 3, 'unshift count == 3');
+
+$count3_2 = unshift (@array, ());
+is(join(' ',@array), '1 2 3', 'unshift null empty');
+cmp_ok($count3_2, '==', 3, 'unshift count == 3 again');
+
+$count4 = unshift (@array, 0);
+is(join(' ',@array), '0 1 2 3', 'unshift singleton list');
+cmp_ok($count4, '==', 4, 'unshift count == 4');
+
+$count7 = unshift (@array, 3, 2, 1);
+is(join(' ',@array), '3 2 1 0 1 2 3', 'unshift list');
+cmp_ok($count7, '==', 7, 'unshift count == 7');
+
+@list = (5, 4);
+$count9 = unshift (@array, @list);
+is(join(' ',@array), '5 4 3 2 1 0 1 2 3', 'unshift array');
+cmp_ok($count9, '==', 9, 'unshift count == 9');
+
+@list = (7);
+@list2 = (6);
+$count11 = unshift (@array, @list, @list2);
+is(join(' ',@array), '7 6 5 4 3 2 1 0 1 2 3', 'unshift arrays');
+cmp_ok($count11, '==', 11, 'unshift count == 11');
+
+# ignoring counts
+@alpha = ('y', 'z');
+
+{
+    no warnings 'syntax';
+    unshift (@alpha);
+}
+is(join(' ',@alpha), 'y z', 'void unshift null');
+
+unshift (@alpha, ());
+is(join(' ',@alpha), 'y z', 'void unshift null empty');
+
+unshift (@alpha, 'x');
+is(join(' ',@alpha), 'x y z', 'void unshift singleton list');
+
+unshift (@alpha, 'u', 'v', 'w');
+is(join(' ',@alpha), 'u v w x y z', 'void unshift list');
+
+@bet = ('s', 't');
+unshift (@alpha, @bet);
+is(join(' ',@alpha), 's t u v w x y z', 'void unshift array');
+
+@bet = ('q');
+@gimel = ('r');
+unshift (@alpha, @bet, @gimel);
+is(join(' ',@alpha), 'q r s t u v w x y z', 'void unshift arrays');
 
Index: src/gnu/usr.bin/perl/t/op/vec.t
diff -u src/gnu/usr.bin/perl/t/op/vec.t:1.9 src/gnu/usr.bin/perl/t/op/vec.t:1.10
--- t/op/vec.t:1.9	Mon Sep 29 17:36:20 2008
+++ t/op/vec.t	Fri Sep 24 15:07:09 2010
@@ -11,7 +11,7 @@
 my $Is_EBCDIC = (ord('A') == 193) ? 1 : 0;
 
 is(vec($foo,0,1), 0);
-is(length($foo), 0);
+is(length($foo), undef);
 vec($foo,0,1) = 1;
 is(length($foo), 1);
 is(unpack('C',$foo), 1);
Index: src/gnu/usr.bin/perl/t/op/write.t
diff -u src/gnu/usr.bin/perl/t/op/write.t:1.11 src/gnu/usr.bin/perl/t/op/write.t:1.12
--- t/op/write.t:1.11	Mon Oct 12 18:30:28 2009
+++ t/op/write.t	Fri Sep 24 15:07:09 2010
@@ -637,7 +637,7 @@
 # Just a complete test for format, including top-, left- and bottom marging
 # and format detection through glob entries
 
-if ($^O eq 'VMS' || $^O eq 'MSWin32' || $^O eq 'dos' || $^O eq 'MacOS' ||
+if ($^O eq 'VMS' || $^O eq 'MSWin32' || $^O eq 'dos' ||
     ($^O eq 'os2' and not eval '$OS2::can_fork')) {
   $test = curr_test();
  SKIP: {
Index: src/gnu/usr.bin/perl/t/uni/tr_7jis.t
diff -u src/gnu/usr.bin/perl/t/uni/tr_7jis.t:1.6 src/gnu/usr.bin/perl/t/uni/tr_7jis.t:1.7
--- t/uni/tr_7jis.t:1.6	Mon Oct 12 18:30:28 2009
+++ t/uni/tr_7jis.t	Fri Sep 24 15:07:09 2010
@@ -1,3 +1,4 @@
+#! perl -w
 #
 # $Id$
 #
@@ -6,10 +7,6 @@
 # -- dankogai
 
 BEGIN {
-    if ($ENV{'PERL_CORE'}){
-        chdir 't';
-        @INC = '../lib';
-    }
     require Config; import Config;
     if ($Config{'extensions'} !~ /\bEncode\b/) {
       print "1..0 # Skip: Encode was not built\n";
@@ -28,11 +25,11 @@
         exit 0;
     }
     $| = 1;
+    require './test.pl';
 }
 
 use strict;
-use Test::More tests => 6;
-use Encode;
+plan(tests => 6);
 use encoding 'iso-2022-jp';
 
 my @hiragana =  map {chr} ord("$B$!(B")..ord("$B$s(B");
Index: src/gnu/usr.bin/perl/t/uni/tr_eucjp.t
diff -u src/gnu/usr.bin/perl/t/uni/tr_eucjp.t:1.5 src/gnu/usr.bin/perl/t/uni/tr_eucjp.t:1.6
--- t/uni/tr_eucjp.t:1.5	Mon Oct 12 18:30:28 2009
+++ t/uni/tr_eucjp.t	Fri Sep 24 15:07:09 2010
@@ -1,3 +1,4 @@
+#! perl -w
 #
 # $Id$
 #
@@ -5,10 +6,6 @@
 # -- dankogai
 
 BEGIN {
-    if ($ENV{'PERL_CORE'}){
-        chdir 't';
-        @INC = '../lib';
-    }
     require Config; import Config;
     if ($Config{'extensions'} !~ /\bEncode\b/) {
       print "1..0 # Skip: Encode was not built\n";
@@ -27,11 +24,11 @@
         exit 0;
     }
     $| = 1;
+    require './test.pl';
 }
 
 use strict;
-use Test::More tests => 6;
-use Encode;
+plan(tests => 6);
 use encoding 'euc-jp';
 
 my @hiragana =  map {chr} ord("")..ord("");
Index: src/gnu/usr.bin/perl/t/uni/tr_sjis.t
diff -u src/gnu/usr.bin/perl/t/uni/tr_sjis.t:1.6 src/gnu/usr.bin/perl/t/uni/tr_sjis.t:1.7
--- t/uni/tr_sjis.t:1.6	Mon Oct 12 18:30:28 2009
+++ t/uni/tr_sjis.t	Fri Sep 24 15:07:09 2010
@@ -1,3 +1,4 @@
+#!perl -w
 #
 # $Id$
 #
@@ -5,10 +6,6 @@
 # -- dankogai
 
 BEGIN {
-    if ($ENV{'PERL_CORE'}){
-        chdir 't';
-        @INC = '../lib';
-    }
     require Config; import Config;
     if ($Config{'extensions'} !~ /\bEncode\b/) {
       print "1..0 # Skip: Encode was not built\n";
@@ -27,11 +24,11 @@
         exit 0;
     }
     $| = 1;
+    require './test.pl';
 }
 
 use strict;
-use Test::More tests => 6;
-use Encode;
+plan(tests => 6);
 use encoding 'shiftjis';
 
 my @hiragana =  map {chr} ord("")..ord("");
Index: src/gnu/usr.bin/perl/t/uni/tr_utf8.t
diff -u src/gnu/usr.bin/perl/t/uni/tr_utf8.t:1.6 src/gnu/usr.bin/perl/t/uni/tr_utf8.t:1.7
--- t/uni/tr_utf8.t:1.6	Mon Oct 12 18:30:28 2009
+++ t/uni/tr_utf8.t	Fri Sep 24 15:07:09 2010
@@ -1,3 +1,4 @@
+#!perl -w
 #
 # $Id$
 #
@@ -28,11 +29,11 @@
         exit 0;
     }
     $| = 1;
+    require './test.pl';
 }
 
 use strict;
-use Test::More tests => 8;
-
+plan(tests => 8);
 use encoding 'utf8';
 
 my @hiragana =  map {chr} ord("")..ord("");
Index: src/gnu/usr.bin/perl/utils/Makefile
diff -u src/gnu/usr.bin/perl/utils/Makefile:1.11 src/gnu/usr.bin/perl/utils/Makefile:1.12
--- utils/Makefile:1.11	Tue Oct 13 01:25:48 2009
+++ utils/Makefile	Fri Sep 24 15:07:10 2010
@@ -7,9 +7,9 @@
 # Files to be built with variable substitution after miniperl is
 # available.  Dependencies handled manually below (for now).
 
-pl = c2ph.PL config_data.PL corelist.PL cpan.PL h2ph.PL h2xs.PL instmodsh.PL perlbug.PL perldoc.PL perlivp.PL pl2pm.PL prove.PL cpanp-run-perl.PL cpanp.PL cpan2dist.PL splain.PL dprofpp.PL libnetcfg.PL piconv.PL enc2xs.PL xsubpp.PL
-plextract = c2ph config_data corelist cpan h2ph h2xs instmodsh perlbug perldoc perlivp pl2pm prove cpanp-run-perl cpanp cpan2dist splain dprofpp libnetcfg piconv enc2xs xsubpp
-plextractexe = ./c2ph ./config_data ./corelist ./cpan ./h2ph ./h2xs ./instmodsh ./perlbug ./perldoc ./perlivp ./pl2pm ./prove ./cpanp-run-perl ./cpanp ./cpan2dist ./splain ./dprofpp ./libnetcfg ./piconv ./enc2xs ./xsubpp
+pl = c2ph.PL config_data.PL corelist.PL cpan.PL h2ph.PL h2xs.PL instmodsh.PL perlbug.PL perldoc.PL perlivp.PL pl2pm.PL prove.PL ptar.PL ptardiff.PL cpanp-run-perl.PL cpanp.PL cpan2dist.PL shasum.PL splain.PL dprofpp.PL libnetcfg.PL piconv.PL enc2xs.PL xsubpp.PL
+plextract = c2ph config_data corelist cpan h2ph h2xs instmodsh perlbug perldoc perlivp pl2pm prove ptar ptardiff cpanp-run-perl cpanp cpan2dist shasum splain dprofpp libnetcfg piconv enc2xs xsubpp
+plextractexe = ./c2ph ./config_data ./corelist ./cpan ./h2ph ./h2xs ./instmodsh ./perlbug ./perldoc ./perlivp ./pl2pm ./prove ./ptar ./ptardiff ./cpanp-run-perl ./cpanp ./cpan2dist ./shasum ./splain ./dprofpp ./libnetcfg ./piconv ./enc2xs ./xsubpp
 
 all: $(plextract) 
 
@@ -38,6 +38,10 @@
 
 prove:		prove.PL ../config.sh
 
+ptar:		ptar.PL ../config.sh
+
+ptardiff:	ptardiff.PL ../config.sh
+
 cpanp-run-perl:	cpanp-run-perl.PL ../config.sh
 
 cpanp:	cpanp.PL ../config.sh
@@ -45,6 +49,8 @@
 cpan2dist:	cpan2dist.PL ../config.sh
 
 pl2pm:		pl2pm.PL ../config.sh
+
+shasum:		shasum.PL ../config.sh
 
 splain:		splain.PL ../config.sh ../lib/diagnostics.pm
 
Index: src/gnu/usr.bin/perl/utils/h2ph.PL
diff -u src/gnu/usr.bin/perl/utils/h2ph.PL:1.18 src/gnu/usr.bin/perl/utils/h2ph.PL:1.19
--- utils/h2ph.PL:1.18	Tue Oct 13 01:25:48 2009
+++ utils/h2ph.PL	Fri Sep 24 15:07:10 2010
@@ -509,7 +509,7 @@
 		s/^\s*\((\w),/("$1",/ if $id =~ /^_IO[WR]*$/i;	# cheat
 		$new .= " &$id";
 	    } elsif ($isatype{$id}) {
-		if ($new =~ /{\s*$/) {
+		if ($new =~ /\{\s*$/) {
 		    $new .= "'$id'";
 		} elsif ($new =~ /\(\s*$/ && /^[\s*]*\)/) {
 		    $new =~ s/\(\s*$//;
@@ -518,8 +518,14 @@
 		    $new .= q(').$id.q(');
 		}
 	    } else {
-		if ($inif && $new !~ /defined\s*\($/) {
-		    $new .= '(defined(&' . $id . ') ? &' . $id . ' : undef)';
+		if ($inif) {
+		    if ($new =~ /defined\s*$/) {
+			$new .= '(&' . $id . ')';
+		    } elsif ($new =~ /defined\s*\($/) {
+			$new .= '&' . $id;
+		    } else {
+			$new .= '(defined(&' . $id . ') ? &' . $id . ' : undef)';
+		    }
 		} elsif (/^\[/) {
 		    $new .= " \$$id";
 		} else {
Index: src/gnu/usr.bin/perl/utils/h2xs.PL
diff -u src/gnu/usr.bin/perl/utils/h2xs.PL:1.12 src/gnu/usr.bin/perl/utils/h2xs.PL:1.13
--- utils/h2xs.PL:1.12	Mon Oct 12 18:30:28 2009
+++ utils/h2xs.PL	Fri Sep 24 15:07:10 2010
@@ -234,7 +234,7 @@
 
 When B<--compat-version> (B<-b>) is present the generated tests will use
 C<Test::More> rather than C<Test> which is the default for versions before
-5.7.2 .   C<Test::More> will be added to PREREQ_PM in the generated
+5.6.2.  C<Test::More> will be added to PREREQ_PM in the generated
 C<Makefile.PL>.
 
 =item B<--use-old-tests>
@@ -1903,14 +1903,18 @@
 
 my $prereq_pm = '';
 
-if ( $compat_version < 5.00702 and $new_test )
+if ( $compat_version < 5.006002 and $new_test )
 {
   $prereq_pm .= q%'Test::More'  =>  0, %;
 }
+elsif ( $compat_version < 5.006002 )
+{
+  $prereq_pm .= q%'Test'        =>  0, %;
+}
 
-if ( $compat_version < 5.00600 and !$opt_X and $use_xsloader)
+if ( $compat_version < 5.006 and !$opt_X and $use_xsloader)
 {
-  $prereq_pm .= q%'XSLoader'  =>  0, %;
+  $prereq_pm .= q%'XSLoader'    =>  0, %;
 }
 
 print PL <<"END";
@@ -2026,13 +2030,17 @@
 
 my $rm_prereq;
 
-if ( $compat_version < 5.00702 and $new_test )
+if ( $compat_version < 5.006002 and $new_test )
+{
+  $rm_prereq = 'Test::More';
+}
+elsif ( $compat_version < 5.006002 )
 {
-   $rm_prereq = 'Test::More';
+  $rm_prereq = 'Test';
 }
 else
 {
-   $rm_prereq = 'blah blah blah';
+  $rm_prereq = 'blah blah blah';
 }
 
 print RM <<_RMEND_;
@@ -2092,11 +2100,14 @@
 
 # change 'tests => $tests' to 'tests => last_test_to_print';
 
+use strict;
+use warnings;
+
 _END_
 
 my $test_mod = 'Test::More';
 
-if ( $old_test or ($compat_version < 5.007 and not $new_test ))
+if ( $old_test or ($compat_version < 5.006002 and not $new_test ))
 {
   my $test_mod = 'Test';
 
Index: src/gnu/usr.bin/perl/utils/perlbug.PL
diff -u src/gnu/usr.bin/perl/utils/perlbug.PL:1.12 src/gnu/usr.bin/perl/utils/perlbug.PL:1.13
--- utils/perlbug.PL:1.12	Tue Oct 13 16:46:05 2009
+++ utils/perlbug.PL	Fri Sep 24 15:07:10 2010
@@ -42,7 +42,7 @@
     last if /^\s*}/;
     next if /^\s*#/;  # preprocessor stuff
     next if /PERL_GIT_UNPUSHED_COMMITS/;    # XXX expand instead
-    next if /PERL_GIT_UNCOMMITTED_CHANGES/; # XXX expand instead
+    next if /"uncommitted-changes"/;        # XXX determine if active instead
     chomp;
     s/^\s+,?\s*"?//;
     s/"?\s*,?$//;
@@ -455,11 +455,11 @@
     }
 
     # Prompt for return address, if needed
-    unless ($from) {
+    unless ($::opt_r) {
 	# Try and guess return address
 	my $guess;
 
-	$guess = $ENV{'REPLY-TO'} || $ENV{'REPLYTO'} || '';
+	$guess = $ENV{'REPLY-TO'} || $ENV{'REPLYTO'} || $from || '';
         if ($Is_MacOS) {
             require Mac::InternetConfig;
             $guess = $Mac::InternetConfig::InternetConfig{
@@ -605,6 +605,12 @@
 EOF
 
             $entry = '';
+	} elsif (my $bug_tracker = $Module::CoreList::bug_tracker{$entry}) {
+		paraprint <<"EOF";
+$entry included with core Perl is copied directly from the CPAN distribution.
+Please report bugs in $entry directly to its maintainers using $bug_tracker
+EOF
+            $entry = '';
         } elsif ($entry) {
 	        $category ||= 'library';
 	        $report_about_module = $entry;
@@ -709,6 +715,10 @@
 sub Dump {
     local(*OUT) = @_;
 
+    # these won't have been set if run with -d
+    $category ||= 'core';
+    $severity ||= 'low';
+
     print OUT <<EFF;
 ---
 Flags:
@@ -777,6 +787,7 @@
 	my $value;
 	foreach (sort keys %::Config) {
 	    $value = $::Config{$_};
+	    $value = '' unless defined $value;
 	    $value =~ s/'/\\'/g;
 	    print OUT "$_='$value'\n";
 	}
@@ -864,7 +875,7 @@
 You have finished composing your message. At this point, you have 
 a few options. You can:
 
-    * [Se]end the message to $address$andcc, 
+    * [Se]nd the message to $address$andcc, 
     * [D]isplay the message on the screen,
     * [R]e-edit the message
     * Display or change the message's [su]bject
@@ -1127,7 +1138,7 @@
     open(REP, "<$filename") or die "Couldn't open '$filename': $!\n";
     while (<REP>) { print $fh $_ }
     close(REP) or die "Error closing $filename: $!";
-    $fh->close;
+    $fh->close or die "Error sending mail: $!";
 
     print "\nMessage sent.\n";
 }
@@ -1152,9 +1163,15 @@
 sub _send_message_sendmail {
     my $sendmail = _probe_for_sendmail();
     unless ($sendmail) {
-        paraprint(<<"EOF"), die "\n";
+        my $message_start = !$Is_Linux && !$Is_OpenBSD ? <<'EOT' : <<'EOT';
 It appears that there is no program which looks like "sendmail" on
 your system and that the Mail::Send library from CPAN isn't available.
+EOT
+It appears that there is no program which looks like "sendmail" on
+your system.
+EOT
+        paraprint(<<"EOF"), die "\n";
+$message_start
 Because of this, there's no easy way to automatically send your
 message.
 
Index: src/gnu/usr.bin/perl/vms/vms.c
diff -u src/gnu/usr.bin/perl/vms/vms.c:1.12 src/gnu/usr.bin/perl/vms/vms.c:1.13
--- vms/vms.c:1.12	Mon Oct 12 18:30:28 2009
+++ vms/vms.c	Fri Sep 24 15:07:10 2010
@@ -2885,7 +2885,11 @@
 
 
 /* default piping mailbox size */
-#define PERL_BUFSIZ        512
+#ifdef __VAX
+#  define PERL_BUFSIZ        512
+#else
+#  define PERL_BUFSIZ        8192
+#endif
 
 
 static void
@@ -3073,7 +3077,10 @@
 #if defined(USE_ITHREADS)
              && my_perl
 #endif
-             && PL_perlio_fd_refcnt) 
+#ifdef USE_PERLIO
+             && PL_perlio_fd_refcnt 
+#endif
+              )
                PerlIO_flush(info->fp);
            else 
                fflush((FILE *)info->fp);
@@ -4681,7 +4688,10 @@
 #if defined(USE_ITHREADS)
           && my_perl
 #endif
-          && PL_perlio_fd_refcnt) 
+#ifdef USE_PERLIO
+          && PL_perlio_fd_refcnt 
+#endif
+           )
             PerlIO_flush(info->fp);
         else 
             fflush((FILE *)info->fp);
@@ -4708,7 +4718,10 @@
 #if defined(USE_ITHREADS)
          && my_perl
 #endif
-         && PL_perlio_fd_refcnt) 
+#ifdef USE_PERLIO
+         && PL_perlio_fd_refcnt
+#endif
+        )
         PerlIO_close(info->fp);
      else 
         fclose((FILE *)info->fp);
@@ -5414,10 +5427,6 @@
 	   }
 
 	    /* The source must be a file specification */
-	    vms_dir_file = PerlMem_malloc(VMS_MAXRSS);
-	    if (vms_dir_file == NULL)
-		_ckvmssts_noperl(SS$_INSFMEM);
-
 	    ret_str = do_fileify_dirspec(vms_dst, vms_dir_file, 0, NULL);
 	    if (ret_str == NULL) {
 		PerlMem_free(vms_dst);
@@ -11289,7 +11298,8 @@
 int
 my_fwrite(const void *src, size_t itmsz, size_t nitm, FILE *dest)
 {
-  register char *cp, *end, *cpd, *data;
+  register char *cp, *end, *cpd;
+  char *data;
   register unsigned int fd = fileno(dest);
   register unsigned int fdoff = fd / sizeof(unsigned int);
   int retval;
@@ -12983,6 +12993,8 @@
     }
     /* If we were successful, leave errno where we found it */
     if (retval == 0) RESTORE_ERRNO;
+    PerlMem_free(temp_fspec);
+    PerlMem_free(fileified);
     return retval;
 
 }  /* end of flex_stat_int() */
@@ -13570,7 +13582,7 @@
   if (SvTYPE(mysv) == SVt_PVGV) {
     if (!(io = GvIOp(mysv)) || !PerlIO_getname(IoIFP(io),inspec)) {
       set_errno(EINVAL); set_vaxc_errno(LIB$_INVARG);
-      ST(0) = &PL_sv_no;
+      ST(0) = sv_2mortal(newSViv(0));
       Safefree(inspec);
       XSRETURN(1);
     }
@@ -13579,7 +13591,7 @@
   else {
     if (mysv != ST(0) || !(inp = SvPV(mysv,n_a)) || !*inp) {
       set_errno(EINVAL); set_vaxc_errno(LIB$_INVARG);
-      ST(0) = &PL_sv_no;
+      ST(0) = sv_2mortal(newSViv(0));
       Safefree(inspec);
       XSRETURN(1);
     }
@@ -13589,7 +13601,7 @@
   if (SvTYPE(mysv) == SVt_PVGV) {
     if (!(io = GvIOp(mysv)) || !PerlIO_getname(IoIFP(io),outspec)) {
       set_errno(EINVAL); set_vaxc_errno(LIB$_INVARG);
-      ST(0) = &PL_sv_no;
+      ST(0) = sv_2mortal(newSViv(0));
       Safefree(inspec);
       Safefree(outspec);
       XSRETURN(1);
@@ -13599,7 +13611,7 @@
   else {
     if (mysv != ST(1) || !(outp = SvPV(mysv,n_a)) || !*outp) {
       set_errno(EINVAL); set_vaxc_errno(LIB$_INVARG);
-      ST(0) = &PL_sv_no;
+      ST(0) = sv_2mortal(newSViv(0));
       Safefree(inspec);
       Safefree(outspec);
       XSRETURN(1);
@@ -13607,7 +13619,7 @@
   }
   date_flag = (items == 3) ? SvIV(ST(2)) : 0;
 
-  ST(0) = boolSV(rmscopy(inp,outp,date_flag));
+  ST(0) = sv_2mortal(newSViv(rmscopy(inp,outp,date_flag)));
   Safefree(inspec);
   Safefree(outspec);
   XSRETURN(1);
@@ -14302,9 +14314,10 @@
             if (mode) {
                 *mode = statbuf.old_st_mode;
             }
-	    return 0;
 	}
     }
+    PerlMem_free(temp_fspec);
+    PerlMem_free(fileified);
     return sts;
 }
 
Index: src/gnu/usr.bin/perl/win32/Makefile
diff -u src/gnu/usr.bin/perl/win32/Makefile:1.12 src/gnu/usr.bin/perl/win32/Makefile:1.13
--- win32/Makefile:1.12	Mon Oct 12 18:30:28 2009
+++ win32/Makefile	Fri Sep 24 15:07:10 2010
@@ -1,1363 +1,1370 @@
-#
-# Makefile to build perl on Windows NT using Microsoft NMAKE.
-# Supported compilers:
-#	Visual C++ 2.0 or later
-#	MS Platform SDK 64-bit compiler and tools
-#
-# This is set up to build a perl.exe that runs off a shared library
-# (perl510.dll).  Also makes individual DLLs for the XS extensions.
-#
-
-##
-## Make sure you read README.win32 *before* you mess with anything here!
-##
-
-##
-## Build configuration.  Edit the values below to suit your needs.
-##
-
-#
-# Set these to wherever you want "nmake install" to put your
-# newly built perl.
-#
-INST_DRV	= c:
-INST_TOP	= $(INST_DRV)\perl
-
-#
-# Comment this out if you DON'T want your perl installation to be versioned.
-# This means that the new installation will overwrite any files from the
-# old installation at the same INST_TOP location.  Leaving it enabled is
-# the safest route, as perl adds the extra version directory to all the
-# locations it installs files to.  If you disable it, an alternative
-# versioned installation can be obtained by setting INST_TOP above to a
-# path that includes an arbitrary version string.
-#
-#INST_VER	= \5.10.1
-
-#
-# Comment this out if you DON'T want your perl installation to have
-# architecture specific components.  This means that architecture-
-# specific files will be installed along with the architecture-neutral
-# files.  Leaving it enabled is safer and more flexible, in case you
-# want to build multiple flavors of perl and install them together in
-# the same location.  Commenting it out gives you a simpler
-# installation that is easier to understand for beginners.
-#
-#INST_ARCH	= \$(ARCHNAME)
-
-#
-# Uncomment this if you want perl to run
-# 	$Config{sitelibexp}\sitecustomize.pl
-# before anything else.  This script can then be set up, for example,
-# to add additional entries to @INC.
-#
-#USE_SITECUST	= define
-
-#
-# uncomment to enable multiple interpreters.  This is need for fork()
-# emulation and for thread support.
-#
-USE_MULTI	= define
-
-#
-# Beginnings of interpreter cloning/threads; now reasonably complete.
-# This should be enabled to get the fork() emulation.  This needs
-# USE_MULTI as well.
-#
-USE_ITHREADS	= define
-
-#
-# uncomment to enable the implicit "host" layer for all system calls
-# made by perl.  This needs USE_MULTI above.  This is also needed to
-# get fork().
-#
-USE_IMP_SYS	= define
-
-#
-# Comment out next assign to disable perl's I/O subsystem and use compiler's 
-# stdio for IO - depending on your compiler vendor and run time library you may 
-# then get a number of fails from make test i.e. bugs - complain to them not us ;-). 
-# You will also be unable to take full advantage of perl5.8's support for multiple 
-# encodings and may see lower IO performance. You have been warned.
-USE_PERLIO	= define
-
-#
-# Comment this out if you don't want to enable large file support for
-# some reason.  Should normally only be changed to maintain compatibility
-# with an older release of perl.
-USE_LARGE_FILES	= define
-
-#
-# uncomment exactly one of the following
-#
-# Visual C++ 2.x
-#CCTYPE		= MSVC20
-# Visual C++ > 2.x and < 6.x
-#CCTYPE		= MSVC
-# Visual C++ 6.x (aka Visual C++ 98)
-CCTYPE		= MSVC60
-# Visual C++ Toolkit 2003 (aka Visual C++ 7.x) (free command-line tools)
-#CCTYPE		= MSVC70FREE
-# Visual C++ .NET 2003 (aka Visual C++ 7.x) (full version)
-#CCTYPE		= MSVC70
-# Visual C++ 2005 Express Edition (aka Visual C++ 8.x) (free version)
-#CCTYPE		= MSVC80FREE
-# Visual C++ 2005 (aka Visual C++ 8.x) (full version)
-#CCTYPE		= MSVC80
-# Visual C++ 2008 Express Edition (aka Visual C++ 9.x) (free version)
-#CCTYPE		= MSVC90FREE
-# Visual C++ 2008 (aka Visual C++ 9.x) (full version)
-#CCTYPE		= MSVC90
-
-#
-# uncomment next line if you want debug version of perl (big,slow)
-# If not enabled, we automatically try to use maximum optimization
-# with all compilers that are known to have a working optimizer.
-#
-#CFG		= Debug
-
-#
-# uncomment to enable use of PerlCRT.DLL when using the Visual C compiler.
-# It has patches that fix known bugs in older versions of MSVCRT.DLL.
-# This currently requires VC 5.0 with Service Pack 3 or later.
-# Get it from CPAN at http://www.cpan.org/authors/id/D/DO/DOUGL/
-# and follow the directions in the package to install.
-#
-# Not recommended if you have VC 6.x and you're not running Windows 9x.
-#
-#USE_PERLCRT	= define
-
-#
-# uncomment to enable linking with setargv.obj under the Visual C
-# compiler. Setting this options enables perl to expand wildcards in
-# arguments, but it may be harder to use alternate methods like
-# File::DosGlob that are more powerful.  This option is supported only with
-# Visual C.
-#
-#USE_SETARGV	= define
-
-#
-# if you want to have the crypt() builtin function implemented, leave this or
-# CRYPT_LIB uncommented.  The fcrypt.c file named here contains a suitable
-# version of des_fcrypt().
-#
-CRYPT_SRC	= fcrypt.c
-
-#
-# if you didn't set CRYPT_SRC and if you have des_fcrypt() available in a
-# library, uncomment this, and make sure the library exists (see README.win32)
-# Specify the full pathname of the library.
-#
-#CRYPT_LIB	= fcrypt.lib
-
-#
-# set this if you wish to use perl's malloc
-# WARNING: Turning this on/off WILL break binary compatibility with extensions
-# you may have compiled with/without it.  Be prepared to recompile all
-# extensions if you change the default.  Currently, this cannot be enabled
-# if you ask for USE_IMP_SYS above.
-#
-#PERL_MALLOC	= define
-
-#
-# set this to enable debugging mstats
-# This must be enabled to use the Devel::Peek::mstat() function.  This cannot
-# be enabled without PERL_MALLOC as well.
-#
-#DEBUG_MSTATS	= define
-
-#
-# set this to additionally provide a statically linked perl-static.exe.
-# Note that dynamic loading will not work with this perl, so you must
-# include required modules statically using the STATIC_EXT or ALL_STATIC
-# variables below. A static library perl510s.lib will also be created.
-# Ordinary perl.exe is not affected by this option.
-#
-#BUILD_STATIC	= define
-
-#
-# in addition to BUILD_STATIC the option ALL_STATIC makes *every*
-# extension get statically built
-# This will result in a very large perl executable, but the main purpose
-# is to have proper linking set so as to be able to create miscellaneous
-# executables with different built-in extensions
-#
-#ALL_STATIC	= define
-
-#
-#
-# set the install locations of the compiler include/libraries
-# Running VCVARS32.BAT is *required* when using Visual C.
-# Some versions of Visual C don't define MSVCDIR in the environment,
-# so you may have to set CCHOME explicitly (spaces in the path name should
-# not be quoted)
-#
-#CCHOME		= f:\msvc20
-CCHOME		= $(MSVCDIR)
-CCINCDIR	= $(CCHOME)\include
-CCLIBDIR	= $(CCHOME)\lib
-
-#
-# Additional compiler flags can be specified here.
-#
-BUILDOPT	= $(BUILDOPTEXTRA)
-
-#
-# Adding -DPERL_HASH_SEED_EXPLICIT will disable randomization of Perl's
-# internal hash function unless the PERL_HASH_SEED environment variable is set.
-# Alternatively, adding -DNO_HASH_SEED will completely disable the
-# randomization feature. 
-# The latter is required to maintain binary compatibility with Perl 5.8.0.
-#
-#BUILDOPT	= $(BUILDOPT) -DPERL_HASH_SEED_EXPLICIT
-#BUILDOPT	= $(BUILDOPT) -DNO_HASH_SEED
-
-#
-# This should normally be disabled.  Adding -DPERL_POLLUTE enables support
-# for old symbols by default, at the expense of extreme pollution.  You most
-# probably just want to build modules that won't compile with
-#         perl Makefile.PL POLLUTE=1
-# instead of enabling this.  Please report such modules to the respective
-# authors.
-#
-#BUILDOPT	= $(BUILDOPT) -DPERL_POLLUTE
-
-#
-# This should normally be disabled.  Enabling it will disable the File::Glob
-# implementation of CORE::glob.
-#
-#BUILDOPT	= $(BUILDOPT) -DPERL_EXTERNAL_GLOB
-
-#
-# This should normally be disabled.  Enabling it causes perl to read scripts
-# in text mode (which is the 5.005 behavior) and will break ByteLoader.
-#
-#BUILDOPT	= $(BUILDOPT) -DPERL_TEXTMODE_SCRIPTS
-
-#
-# specify semicolon-separated list of extra directories that modules will
-# look for libraries (spaces in path names need not be quoted)
-#
-EXTRALIBDIRS	=
-
-#
-# set this to your email address (perl will guess a value from
-# from your loginname and your hostname, which may not be right)
-#
-#EMAIL		=
-
-##
-## Build configuration ends.
-##
-
-##################### CHANGE THESE ONLY IF YOU MUST #####################
-
-!IF "$(CRYPT_SRC)$(CRYPT_LIB)" == ""
-D_CRYPT		= undef
-!ELSE
-D_CRYPT		= define
-CRYPT_FLAG	= -DHAVE_DES_FCRYPT
-!ENDIF
-
-!IF "$(USE_IMP_SYS)" == "define"
-PERL_MALLOC	= undef
-DEBUG_MSTATS	= undef
-!ENDIF
-
-!IF "$(PERL_MALLOC)" == ""
-PERL_MALLOC	= undef
-DEBUG_MSTATS	= undef
-!ENDIF
-
-!IF "$(DEBUG_MSTATS)" == ""
-DEBUG_MSTATS	= undef
-!ENDIF
-
-!IF "$(DEBUG_MSTATS)" == "define"
-BUILDOPT	= $(BUILDOPT) -DPERL_DEBUGGING_MSTATS
-!ENDIF
-
-!IF "$(USE_SITECUST)" == ""
-USE_SITECUST	= undef
-!ENDIF
-
-!IF "$(USE_MULTI)" == ""
-USE_MULTI	= undef
-!ENDIF
-
-!IF "$(USE_ITHREADS)" == ""
-USE_ITHREADS	= undef
-!ENDIF
-
-!IF "$(USE_IMP_SYS)" == ""
-USE_IMP_SYS	= undef
-!ENDIF
-
-!IF "$(USE_PERLIO)" == ""
-USE_PERLIO	= undef
-!ENDIF
-
-!IF "$(USE_LARGE_FILES)" == ""
-USE_LARGE_FILES	= undef
-!ENDIF
-
-!IF "$(USE_PERLCRT)" == ""
-USE_PERLCRT	= undef
-!ENDIF
-
-!IF "$(USE_IMP_SYS)$(USE_MULTI)" == "defineundef"
-USE_MULTI	= define
-!ENDIF
-
-!IF "$(USE_ITHREADS)$(USE_MULTI)" == "defineundef"
-USE_MULTI	= define
-!ENDIF
-
-!IF "$(USE_SITECUST)" == "define"
-BUILDOPT	= $(BUILDOPT) -DUSE_SITECUSTOMIZE
-!ENDIF
-
-!IF "$(USE_MULTI)" != "undef"
-BUILDOPT	= $(BUILDOPT) -DPERL_IMPLICIT_CONTEXT
-!ENDIF
-
-!IF "$(USE_IMP_SYS)" != "undef"
-BUILDOPT	= $(BUILDOPT) -DPERL_IMPLICIT_SYS
-!ENDIF
-
-!IF "$(PROCESSOR_ARCHITECTURE)" == ""
-PROCESSOR_ARCHITECTURE	= x86
-!ENDIF
-
-!IF "$(WIN64)" == ""
-# When we are running from a 32bit cmd.exe on AMD64 then
-# PROCESSOR_ARCHITECTURE is set to x86 and PROCESSOR_ARCHITEW6432
-# is set to AMD64
-!IF "$(PROCESSOR_ARCHITEW6432)" != ""
-PROCESSOR_ARCHITECTURE	= $(PROCESSOR_ARCHITEW6432)
-WIN64			= define
-!ELSE
-!IF "$(PROCESSOR_ARCHITECTURE)" == "AMD64" || "$(PROCESSOR_ARCHITECTURE)" == "IA64"
-WIN64			= define
-!ELSE
-WIN64			= undef
-!ENDIF
-!ENDIF
-!ENDIF
-
-ARCHITECTURE = $(PROCESSOR_ARCHITECTURE)
-!IF "$(ARCHITECTURE)" == "AMD64"
-ARCHITECTURE	= x64
-!ENDIF
-!IF "$(ARCHITECTURE)" == "IA64"
-ARCHITECTURE	= ia64
-!ENDIF
-
-!IF "$(USE_MULTI)" == "define"
-ARCHNAME	= MSWin32-$(ARCHITECTURE)-multi
-!ELSE
-!IF "$(USE_PERLIO)" == "define"
-ARCHNAME	= MSWin32-$(ARCHITECTURE)-perlio
-!ELSE
-ARCHNAME	= MSWin32-$(ARCHITECTURE)
-!ENDIF
-!ENDIF
-
-!IF "$(USE_PERLIO)" == "define"
-BUILDOPT	= $(BUILDOPT) -DUSE_PERLIO
-!ENDIF
-
-!IF "$(USE_ITHREADS)" == "define"
-ARCHNAME	= $(ARCHNAME)-thread
-!ENDIF
-
-# Visual C++ 98, .NET 2003, 2005 and 2008 specific.
-# VC++ 6.x, 7.x, 8.x and 9.x can load DLL's on demand.  Makes the test suite run
-# in about 10% less time.  (The free version of 7.x can't do this, but the free
-# versions of 8.x and 9.x can.)
-!IF "$(CCTYPE)" == "MSVC60" || "$(CCTYPE)" == "MSVC70"     || \
-    "$(CCTYPE)" == "MSVC80" || "$(CCTYPE)" == "MSVC80FREE" || \
-    "$(CCTYPE)" == "MSVC90" || "$(CCTYPE)" == "MSVC90FREE"
-DELAYLOAD	= -DELAYLOAD:ws2_32.dll delayimp.lib
-!ENDIF
-
-# Visual C++ 2005 and 2008 (VC++ 8.x and 9.x) create manifest files for EXEs and
-# DLLs. These either need copying everywhere with the binaries, or else need
-# embedding in them otherwise MSVCR80.dll or MSVCR90.dll won't be found. For
-# simplicity, embed them if they exist (and delete them afterwards so that they
-# don't get installed too).
-EMBED_EXE_MANI	= if exist $@.manifest mt -nologo -manifest $@.manifest -outputresource:$@;1 && \
-		  if exist $@.manifest del $@.manifest
-EMBED_DLL_MANI	= if exist $@.manifest mt -nologo -manifest $@.manifest -outputresource:$@;2 && \
-		  if exist $@.manifest del $@.manifest
-
-ARCHDIR		= ..\lib\$(ARCHNAME)
-COREDIR		= ..\lib\CORE
-AUTODIR		= ..\lib\auto
-LIBDIR		= ..\lib
-EXTDIR		= ..\ext
-PODDIR		= ..\pod
-EXTUTILSDIR	= $(LIBDIR)\ExtUtils
-HTMLDIR		= .\html
-
-#
-INST_SCRIPT	= $(INST_TOP)$(INST_VER)\bin
-INST_BIN	= $(INST_SCRIPT)$(INST_ARCH)
-INST_LIB	= $(INST_TOP)$(INST_VER)\lib
-INST_ARCHLIB	= $(INST_LIB)$(INST_ARCH)
-INST_COREDIR	= $(INST_ARCHLIB)\CORE
-INST_HTML	= $(INST_TOP)$(INST_VER)\html
-
-#
-# Programs to compile, build .lib files and link
-#
-
-CC		= cl
-LINK32		= link
-LIB32		= $(LINK32) -lib
-RSC		= rc
-
-#
-# Options
-#
-
-INCLUDES	= -I$(COREDIR) -I.\include -I. -I..
-#PCHFLAGS	= -Fpc:\temp\vcmoduls.pch -YX
-DEFINES		= -DWIN32 -D_CONSOLE -DNO_STRICT $(CRYPT_FLAG)
-LOCDEFS		= -DPERLDLL -DPERL_CORE
-SUBSYS		= console
-CXX_FLAG	= -TP -EHsc
-
-!IF "$(USE_PERLCRT)" != "define"
-LIBC	= msvcrt.lib
-!ELSE
-LIBC	= PerlCRT.lib
-!ENDIF
-
-!IF  "$(CFG)" == "Debug"
-!  IF "$(CCTYPE)" == "MSVC20"
-OPTIMIZE	= -Od -MD -Z7 -DDEBUGGING
-!  ELSE
-OPTIMIZE	= -Od -MD -Zi -DDEBUGGING
-!  ENDIF
-LINK_DBG	= -debug
-!ELSE
-OPTIMIZE	= -MD -Zi -DNDEBUG
-# we enable debug symbols in release builds also
-LINK_DBG	= -debug -opt:ref,icf
-# you may want to enable this if you want COFF symbols in the executables
-# in addition to the PDB symbols.  The default Dr. Watson that ships with
-# Windows can use the the former but not latter.  The free WinDbg can be
-# installed to get better stack traces from just the PDB symbols, so we
-# avoid the bloat of COFF symbols by default.
-#LINK_DBG	= $(LINK_DBG) -debugtype:both
-!  IF "$(WIN64)" == "define"
-# enable Whole Program Optimizations (WPO) and Link Time Code Generation (LTCG)
-OPTIMIZE	= $(OPTIMIZE) -Ox -GL
-LINK_DBG	= $(LINK_DBG) -ltcg
-!  ELSE
-# -O1 yields smaller code, which turns out to be faster than -O2 on x86
-OPTIMIZE	= $(OPTIMIZE) -O1
-#OPTIMIZE	= $(OPTIMIZE) -O2
-!  ENDIF
-!ENDIF
-
-!IF "$(WIN64)" == "define"
-DEFINES		= $(DEFINES) -DWIN64 -DCONSERVATIVE
-OPTIMIZE	= $(OPTIMIZE) -Wp64 -fp:precise
-!ENDIF
-
-# For now, silence VC++ 8.x's and 9.x's warnings about "unsafe" CRT functions
-# and POSIX CRT function names being deprecated.
-!IF "$(CCTYPE)" == "MSVC80" || "$(CCTYPE)" == "MSVC80FREE" || \
-    "$(CCTYPE)" == "MSVC90" || "$(CCTYPE)" == "MSVC90FREE"
-DEFINES		= $(DEFINES) -D_CRT_SECURE_NO_DEPRECATE -D_CRT_NONSTDC_NO_DEPRECATE
-!ENDIF
-
-# Use the MSVCRT read() fix if the PerlCRT was not chosen, but only when using
-# VC++ 6.x or earlier. Later versions use MSVCR70.dll, MSVCR71.dll, etc, which
-# do not require the fix.
-!IF "$(CCTYPE)" == "MSVC20" || "$(CCTYPE)" == "MSVC" || "$(CCTYPE)" == "MSVC60" 
-!  IF "$(USE_PERLCRT)" != "define"
-BUILDOPT	= $(BUILDOPT) -DPERL_MSVCRT_READFIX
-!  ENDIF
-!ENDIF
-
-LIBBASEFILES	= $(CRYPT_LIB) \
-		oldnames.lib kernel32.lib user32.lib gdi32.lib winspool.lib \
-		comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib \
-		netapi32.lib uuid.lib ws2_32.lib mpr.lib winmm.lib \
-		version.lib odbc32.lib odbccp32.lib
-
-# The 64 bit Platform SDK compilers contain a runtime library that doesn't
-# include the buffer overrun verification code used by the /GS switch.
-# Since the code links against libraries that are compiled with /GS, this
-# "security cookie verification" must be included via bufferoverlow.lib.
-!IF "$(WIN64)" == "define"
-LIBBASEFILES    = $(LIBBASEFILES) bufferoverflowU.lib
-!ENDIF
-
-# we add LIBC here, since we may be using PerlCRT.dll
-LIBFILES	= $(LIBBASEFILES) $(LIBC)
-
-#EXTRACFLAGS	= -nologo -GF -W4 -wd4127 -wd4706
-EXTRACFLAGS	= -nologo -GF -W3
-CFLAGS		= $(EXTRACFLAGS) $(INCLUDES) $(DEFINES) $(LOCDEFS) \
-		$(PCHFLAGS) $(OPTIMIZE)
-LINK_FLAGS	= -nologo -nodefaultlib $(LINK_DBG) \
-		-libpath:"$(INST_COREDIR)" \
-		-machine:$(PROCESSOR_ARCHITECTURE)
-LIB_FLAGS	= -nologo
-OBJOUT_FLAG	= -Fo
-EXEOUT_FLAG	= -Fe
-
-CFLAGS_O	= $(CFLAGS) $(BUILDOPT)
-
-#################### do not edit below this line #######################
-############# NO USER-SERVICEABLE PARTS BEYOND THIS POINT ##############
-
-o = .obj
-
-#
-# Rules
-#
-
-.SUFFIXES : .c $(o) .dll .lib .exe .rc .res
-
-.c$(o):
-	$(CC) -c -I$(<D) $(CFLAGS_O) $(OBJOUT_FLAG)$@ $<
-
-.y.c:
-	$(NOOP)
-
-$(o).dll:
-	$(LINK32) -dll -subsystem:windows -implib:$(*B).lib -def:$(*B).def \
-	    -out:$@ $(LINK_FLAGS) $(LIBFILES) $< $(LIBPERL)
-	$(EMBED_DLL_MANI)
-
-.rc.res:
-	$(RSC) -i.. $<
-
-#
-# various targets
-
-# makedef.pl must be updated if this changes, and this should normally
-# only change when there is an incompatible revision of the public API.
-PERLIMPLIB	= ..\perl510.lib
-PERLSTATICLIB	= ..\perl510s.lib
-PERLDLL		= ..\perl510.dll
-
-MINIPERL	= ..\miniperl.exe
-MINIDIR		= .\mini
-PERLEXE		= ..\perl.exe
-WPERLEXE	= ..\wperl.exe
-PERLEXESTATIC	= ..\perl-static.exe
-GLOBEXE		= ..\perlglob.exe
-CONFIGPM	= ..\lib\Config.pm ..\lib\Config_heavy.pl
-MINIMOD		= ..\lib\ExtUtils\Miniperl.pm
-X2P		= ..\x2p\a2p.exe
-GENUUDMAP	= ..\generate_uudmap.exe
-!IF "$(BUILD_STATIC)" == "define"
-PERLSTATIC	= static
-!ELSE
-PERLSTATIC	= 
-!ENDIF
-  
-# Unicode data files generated by mktables
-FIRSTUNIFILE     = ..\lib\unicore\Canonical.pl
-UNIDATAFILES	 = ..\lib\unicore\Canonical.pl ..\lib\unicore\Exact.pl \
-		   ..\lib\unicore\Properties ..\lib\unicore\Decomposition.pl \
-		   ..\lib\unicore\CombiningClass.pl ..\lib\unicore\Name.pl \
-		   ..\lib\unicore\PVA.pl
-
-# Directories of Unicode data files generated by mktables
-UNIDATADIR1	= ..\lib\unicore\To
-UNIDATADIR2	= ..\lib\unicore\lib
-
-PERLEXE_ICO	= .\perlexe.ico
-PERLEXE_RES	= .\perlexe.res
-PERLDLL_RES	=
-
-# Nominate a target which causes extensions to be re-built
-# This used to be $(PERLEXE), but at worst it is the .dll that they depend
-# on and really only the interface - i.e. the .def file used to export symbols
-# from the .dll
-PERLDEP		= perldll.def
-
-PL2BAT		= bin\pl2bat.pl
-GLOBBAT		= bin\perlglob.bat
-
-UTILS		=			\
-		..\utils\h2ph		\
-		..\utils\splain		\
-		..\utils\dprofpp	\
-		..\utils\perlbug	\
-		..\utils\pl2pm 		\
-		..\utils\c2ph		\
-		..\utils\pstruct	\
-		..\utils\h2xs		\
-		..\utils\perldoc	\
-		..\utils\perlivp	\
-		..\utils\libnetcfg	\
-		..\utils\enc2xs		\
-		..\utils\piconv		\
-		..\utils\config_data	\
-		..\utils\corelist	\
-		..\utils\cpan		\
-		..\utils\xsubpp		\
-		..\utils\prove		\
-		..\utils\ptar		\
-		..\utils\ptardiff	\
-		..\utils\cpanp-run-perl	\
-		..\utils\cpanp	\
-		..\utils\cpan2dist	\
-		..\utils\shasum		\
-		..\utils\instmodsh	\
-		..\pod\pod2html		\
-		..\pod\pod2latex	\
-		..\pod\pod2man		\
-		..\pod\pod2text		\
-		..\pod\pod2usage	\
-		..\pod\podchecker	\
-		..\pod\podselect	\
-		..\x2p\find2perl	\
-		..\x2p\psed		\
-		..\x2p\s2p		\
-		bin\exetype.pl		\
-		bin\runperl.pl		\
-		bin\pl2bat.pl		\
-		bin\perlglob.pl		\
-		bin\search.pl
-
-MAKE		= nmake -nologo
-MAKE_BARE	= nmake
-
-!IF "$(WIN64)" == "define"
-CFGSH_TMPL	= config.vc64
-CFGH_TMPL	= config_H.vc64
-!ELSE
-CFGSH_TMPL	= config.vc
-CFGH_TMPL	= config_H.vc
-!ENDIF
-
-XCOPY		= xcopy /f /r /i /d /y
-RCOPY		= xcopy /f /r /i /e /d /y
-NOOP		= @rem
-NULL		=
-
-DEL		= del
-
-#
-# filenames given to xsubpp must have forward slashes (since it puts
-# full pathnames in #line strings)
-XSUBPP		= ..\$(MINIPERL) -I..\..\lib ..\$(EXTUTILSDIR)\xsubpp \
-		-C++ -prototypes
-
-MICROCORE_SRC	=		\
-		..\av.c		\
-		..\deb.c	\
-		..\doio.c	\
-		..\doop.c	\
-		..\dump.c	\
-		..\globals.c	\
-		..\gv.c		\
-		..\mro.c	\
-		..\hv.c		\
-		..\locale.c	\
-		..\mathoms.c    \
-		..\mg.c		\
-		..\numeric.c	\
-		..\op.c		\
-		..\pad.c	\
-		..\perl.c	\
-		..\perlapi.c	\
-		..\perly.c	\
-		..\pp.c		\
-		..\pp_ctl.c	\
-		..\pp_hot.c	\
-		..\pp_pack.c	\
-		..\pp_sort.c	\
-		..\pp_sys.c	\
-		..\reentr.c	\
-		..\regcomp.c	\
-		..\regexec.c	\
-		..\run.c	\
-		..\scope.c	\
-		..\sv.c		\
-		..\taint.c	\
-		..\toke.c	\
-		..\universal.c	\
-		..\utf8.c	\
-		..\util.c	\
-		..\xsutils.c
-
-EXTRACORE_SRC	= $(EXTRACORE_SRC) perllib.c
-
-!IF "$(PERL_MALLOC)" == "define"
-EXTRACORE_SRC	= $(EXTRACORE_SRC) ..\malloc.c
-!ENDIF
-
-EXTRACORE_SRC	= $(EXTRACORE_SRC) ..\perlio.c
-
-WIN32_SRC	=		\
-		.\win32.c	\
-		.\win32sck.c	\
-		.\win32thread.c
-
-# We need this for miniperl build unless we override canned 
-# config.h #define building mini\*
-#!IF "$(USE_PERLIO)" == "define"
-WIN32_SRC	= $(WIN32_SRC) .\win32io.c
-#!ENDIF
-
-!IF "$(CRYPT_SRC)" != ""
-WIN32_SRC	= $(WIN32_SRC) .\$(CRYPT_SRC)
-!ENDIF
-
-DLL_SRC		= $(DYNALOADER).c
-
-X2P_SRC		=		\
-		..\x2p\a2p.c	\
-		..\x2p\hash.c	\
-		..\x2p\str.c	\
-		..\x2p\util.c	\
-		..\x2p\walk.c
-
-CORE_NOCFG_H	=		\
-		..\av.h		\
-		..\cop.h	\
-		..\cv.h		\
-		..\dosish.h	\
-		..\embed.h	\
-		..\form.h	\
-		..\gv.h		\
-		..\handy.h	\
-		..\hv.h		\
-		..\iperlsys.h	\
-		..\mg.h		\
-		..\nostdio.h	\
-		..\op.h		\
-		..\opcode.h	\
-		..\perl.h	\
-		..\perlapi.h	\
-		..\perlsdio.h	\
-		..\perlsfio.h	\
-		..\perly.h	\
-		..\pp.h		\
-		..\proto.h	\
-		..\regcomp.h	\
-		..\regexp.h	\
-		..\scope.h	\
-		..\sv.h		\
-		..\thread.h	\
-		..\unixish.h	\
-		..\utf8.h	\
-		..\util.h	\
-		..\warnings.h	\
-		..\XSUB.h	\
-		..\EXTERN.h	\
-		..\perlvars.h	\
-		..\intrpvar.h	\
-		.\include\dirent.h	\
-		.\include\netdb.h	\
-		.\include\sys\socket.h	\
-		.\win32.h
-
-CORE_H		= $(CORE_NOCFG_H) .\config.h ..\git_version.h
-
-UUDMAP_H	= ..\uudmap.h
-
-MICROCORE_OBJ	= $(MICROCORE_SRC:.c=.obj)
-CORE_OBJ	= $(MICROCORE_OBJ) $(EXTRACORE_SRC:.c=.obj)
-WIN32_OBJ	= $(WIN32_SRC:.c=.obj)
-MINICORE_OBJ	= $(MICROCORE_OBJ:..\=.\mini\)	\
-		  $(MINIDIR)\miniperlmain$(o)	\
-		  $(MINIDIR)\perlio$(o)
-MINIWIN32_OBJ	= $(WIN32_OBJ:.\=.\mini\)
-MINI_OBJ	= $(MINICORE_OBJ) $(MINIWIN32_OBJ)
-DLL_OBJ		= $(DLL_SRC:.c=.obj)
-X2P_OBJ		= $(X2P_SRC:.c=.obj)
-GENUUDMAP_OBJ	= $(GENUUDMAP:.exe=.obj)
-
-PERLDLL_OBJ	= $(CORE_OBJ)
-PERLEXE_OBJ	= perlmain$(o)
-PERLEXEST_OBJ	= perlmainst$(o)
-
-PERLDLL_OBJ	= $(PERLDLL_OBJ) $(WIN32_OBJ) $(DLL_OBJ)
-
-!IF "$(USE_SETARGV)" != ""
-SETARGV_OBJ	= setargv$(o)
-!ENDIF
-
-!IF "$(ALL_STATIC)" == "define"
-# some exclusions, unfortunately, until fixed:
-#  - Win32 extension contains overlapped symbols with win32.c (BUG!)
-#  - MakeMaker isn't capable enough for SDBM_File (smaller bug)
-#  - Encode (encoding search algorithm relies on shared library?)
-STATIC_EXT	= * !Win32 !SDBM_File !Encode
-!ELSE
-# specify static extensions here, for example:
-#STATIC_EXT	= Cwd Compress/Raw/Zlib
-STATIC_EXT	= Win32CORE
-!ENDIF
-
-DYNALOADER	= $(EXTDIR)\DynaLoader\DynaLoader
-
-CFG_VARS	=					\
-		"INST_DRV=$(INST_DRV)"			\
-		"INST_TOP=$(INST_TOP)"			\
-		"INST_VER=$(INST_VER)"			\
-		"INST_ARCH=$(INST_ARCH)"		\
-		"archname=$(ARCHNAME)"			\
-		"cc=$(CC)"				\
-		"ld=$(LINK32)"				\
-		"ccflags=$(EXTRACFLAGS) $(OPTIMIZE:"=\") $(DEFINES) $(BUILDOPT)"	\
-		"cf_email=$(EMAIL)"	 		\
-		"d_crypt=$(D_CRYPT)"			\
-		"d_mymalloc=$(PERL_MALLOC)"		\
-		"libs=$(LIBFILES)"			\
-		"incpath=$(CCINCDIR:"=\")"		\
-		"libperl=$(PERLIMPLIB:..\=)"		\
-		"libpth=$(CCLIBDIR:"=\");$(EXTRALIBDIRS:"=\")"	\
-		"libc=$(LIBC)"				\
-		"make=$(MAKE_BARE)"				\
-		"static_ext=$(STATIC_EXT)"		\
-		"usethreads=$(USE_ITHREADS)"		\
-		"useithreads=$(USE_ITHREADS)"		\
-		"usemultiplicity=$(USE_MULTI)"		\
-		"useperlio=$(USE_PERLIO)"		\
-		"uselargefiles=$(USE_LARGE_FILES)"	\
-		"usesitecustomize=$(USE_SITECUST)"	\
-		"LINK_FLAGS=$(LINK_FLAGS:"=\")"		\
-		"optimize=$(OPTIMIZE:"=\")"
-
-#
-# Top targets
-#
-
-all : .\config.h ..\git_version.h $(GLOBEXE) $(MINIMOD) $(CONFIGPM) \
-	$(UNIDATAFILES) MakePPPort $(PERLEXE) $(X2P) Extensions $(PERLSTATIC)
-	@echo	Everything is up to date. '$(MAKE_BARE) test' to run test suite.
-
-..\regcharclass.h : ..\Porting\regcharclass.pl
-	cd ..
-	miniperl Porting\regcharclass.pl
-	cd win32
-
-regnodes : ..\regnodes.h
-
-..\regcomp$(o) : ..\regnodes.h ..\regcharclass.h	
-
-..\regexec$(o) : ..\regnodes.h ..\regcharclass.h
-
-reonly : regnodes .\config.h ..\git_version.h $(GLOBEXE) $(MINIMOD) $(CONFIGPM) \
-	$(UNIDATAFILES) $(PERLEXE) $(X2P) Extensions_reonly
-	@echo	Perl and 're' are up to date.
-
-$(DYNALOADER)$(o) : $(DYNALOADER).c $(CORE_H) $(EXTDIR)\DynaLoader\dlutils.c
-
-static: $(PERLEXESTATIC)
-
-#------------------------------------------------------------
-
-$(GLOBEXE) : perlglob$(o)
-	$(LINK32) $(LINK_FLAGS) $(LIBFILES) -out:$@ -subsystem:$(SUBSYS) \
-	    perlglob$(o) setargv$(o)
-	$(EMBED_EXE_MANI)
-
-perlglob$(o)  : perlglob.c
-
-config.w32 : $(CFGSH_TMPL)
-	copy $(CFGSH_TMPL) config.w32
-
-.\config.h : $(CFGH_TMPL)
-	-del /f config.h
-	copy $(CFGH_TMPL) config.h
-
-..\git_version.h : $(MINIPERL) ..\make_patchnum.pl
-	cd ..
-	miniperl -Ilib make_patchnum.pl
-	cd win32
-
-# make sure that we recompile perl.c if the git version changes
-..\perl$(o) : ..\git_version.h
-
-..\config.sh : config.w32 $(MINIPERL) config_sh.PL
-	$(MINIPERL) -I..\lib config_sh.PL $(CFG_VARS) config.w32 > ..\config.sh
-
-# this target is for when changes to the main config.sh happen.
-# edit config.vc, then make perl in a minimal configuration (i.e. with MULTI,
-# ITHREADS, IMP_SYS, LARGE_FILES, PERLIO and CRYPT off), then make this target
-# to regenerate config_H.vc.
-# repeat for config.vc64 and config_H.vc64 if you have a suitable build
-# environment, otherwise hand-edit them to maintain the same differences with
-# config.vc and config_H.vc as before.
-# unfortunately, some further manual editing is also then required to restore all
-# the special __GNUC__ handling that is otherwise lost.
-regen_config_h:
-	$(MINIPERL) -I..\lib config_sh.PL $(CFG_VARS) $(CFGSH_TMPL) > ..\config.sh
-	cd ..
-	miniperl configpm
-	cd win32
-	-del /f $(CFGH_TMPL)
-	-$(MINIPERL) -I..\lib config_h.PL "INST_VER=$(INST_VER)"
-	rename config.h $(CFGH_TMPL)
-
-$(CONFIGPM) : $(MINIPERL) ..\config.sh config_h.PL ..\minimod.pl
-	cd ..
-	miniperl configpm
-	cd win32
-	if exist lib\* $(RCOPY) lib\*.* ..\lib\$(NULL)
-	$(XCOPY) ..\*.h $(COREDIR)\*.*
-	$(XCOPY) *.h $(COREDIR)\*.*
-	$(XCOPY) ..\ext\re\re.pm $(LIBDIR)\*.*
-	$(RCOPY) include $(COREDIR)\*.*
-	-$(MINIPERL) -I..\lib config_h.PL "INST_VER=$(INST_VER)"
-	if errorlevel 1 $(MAKE) /$(MAKEFLAGS) $(CONFIGPM)
-
-$(MINIPERL) : $(MINIDIR) $(MINI_OBJ)
-	$(LINK32) -subsystem:console -out:$@ @<<
-	$(LINK_FLAGS) $(LIBFILES) $(MINI_OBJ)
-<<
-	$(EMBED_EXE_MANI)
-
-$(MINIDIR) :
-	if not exist "$(MINIDIR)" mkdir "$(MINIDIR)"
-
-$(MINICORE_OBJ) : $(CORE_NOCFG_H)
-	$(CC) -c $(CFLAGS) -DPERL_EXTERNAL_GLOB -DPERL_IS_MINIPERL $(OBJOUT_FLAG)$@ ..\$(*F).c
-
-$(MINIWIN32_OBJ) : $(CORE_NOCFG_H)
-	$(CC) -c $(CFLAGS) $(OBJOUT_FLAG)$@ $(*F).c
-
-# -DPERL_IMPLICIT_SYS needs C++ for perllib.c
-# This is the only file that depends on perlhost.h, vmem.h, and vdir.h
-!IF "$(USE_IMP_SYS)" == "define"
-perllib$(o)	: perllib.c .\perlhost.h .\vdir.h .\vmem.h
-	$(CC) -c -I. $(CFLAGS_O) $(CXX_FLAG) $(OBJOUT_FLAG)$@ perllib.c
-!ENDIF
-
-# 1. we don't want to rebuild miniperl.exe when config.h changes
-# 2. we don't want to rebuild miniperl.exe with non-default config.h
-# 3. we can't have miniperl.exe depend on git_version.h, as miniperl creates it
-$(MINI_OBJ)	: $(CORE_NOCFG_H)
-
-$(WIN32_OBJ)	: $(CORE_H)
-$(CORE_OBJ)	: $(CORE_H)
-$(DLL_OBJ)	: $(CORE_H)
-$(X2P_OBJ)	: $(CORE_H)
-
-perldll.def : $(MINIPERL) $(CONFIGPM) ..\global.sym ..\pp.sym ..\makedef.pl create_perllibst_h.pl
-	$(MINIPERL) -I..\lib create_perllibst_h.pl
-	$(MINIPERL) -w ..\makedef.pl PLATFORM=win32 $(OPTIMIZE) $(DEFINES) $(BUILDOPT) \
-	    CCTYPE=$(CCTYPE) > perldll.def
-
-$(PERLDLL): perldll.def $(PERLDLL_OBJ) $(PERLDLL_RES) Extensions_static
-	$(LINK32) -dll -def:perldll.def -base:0x28000000 -out:$@ @Extensions_static @<<
-		$(LINK_FLAGS) $(DELAYLOAD) $(LIBFILES) $(PERLDLL_OBJ) $(PERLDLL_RES)
-<<
-	$(EMBED_DLL_MANI)
-	$(XCOPY) $(PERLIMPLIB) $(COREDIR)
-
-$(PERLSTATICLIB): Extensions_static
-	$(LIB32) $(LIB_FLAGS) -out:$@ @Extensions_static @<<
-		$(PERLDLL_OBJ)
-<<
-	$(XCOPY) $(PERLSTATICLIB) $(COREDIR)
-
-$(PERLEXE_ICO): $(MINIPERL) ..\uupacktool.pl $(PERLEXE_ICO).packd
-	$(MINIPERL) -I..\lib ..\uupacktool.pl -u $(PERLEXE_ICO).packd $(PERLEXE_ICO)
-
-$(PERLEXE_RES): perlexe.rc $(PERLEXE_ICO)
-
-$(MINIMOD) : $(MINIPERL) ..\minimod.pl
-	cd ..
-	miniperl minimod.pl > lib\ExtUtils\Miniperl.pm
-	cd win32
-
-..\x2p\a2p$(o) : ..\x2p\a2p.c
-	$(CC) -I..\x2p $(CFLAGS) $(OBJOUT_FLAG)$@ -c ..\x2p\a2p.c
-
-..\x2p\hash$(o) : ..\x2p\hash.c
-	$(CC) -I..\x2p  $(CFLAGS) $(OBJOUT_FLAG)$@ -c ..\x2p\hash.c
-
-..\x2p\str$(o) : ..\x2p\str.c
-	$(CC) -I..\x2p  $(CFLAGS) $(OBJOUT_FLAG)$@ -c ..\x2p\str.c
-
-..\x2p\util$(o) : ..\x2p\util.c
-	$(CC) -I..\x2p  $(CFLAGS) $(OBJOUT_FLAG)$@ -c ..\x2p\util.c
-
-..\x2p\walk$(o) : ..\x2p\walk.c
-	$(CC) -I..\x2p  $(CFLAGS) $(OBJOUT_FLAG)$@ -c ..\x2p\walk.c
-
-$(X2P) : $(MINIPERL) $(X2P_OBJ)
-	$(MINIPERL) ..\x2p\find2perl.PL
-	$(MINIPERL) ..\x2p\s2p.PL
-	$(LINK32) -subsystem:console -out:$@ @<<
-		$(LINK_FLAGS) $(LIBFILES) $(X2P_OBJ)
-<<
-	$(EMBED_EXE_MANI)
-
-$(MINIDIR)\globals$(o) : $(UUDMAP_H)
-
-$(UUDMAP_H) : $(GENUUDMAP)
-	$(GENUUDMAP) >$(UUDMAP_H)
-
-$(GENUUDMAP) : $(GENUUDMAP_OBJ)
-	$(LINK32) -subsystem:console -out:$@ @<<
-		$(LINK_FLAGS) $(LIBFILES) $(GENUUDMAP_OBJ)
-<<
-	$(EMBED_EXE_MANI)
-
-perlmain.c : runperl.c
-	copy runperl.c perlmain.c
-
-perlmain$(o) : perlmain.c
-	$(CC) $(CFLAGS_O:-DPERLDLL=-UPERLDLL) $(OBJOUT_FLAG)$@ -c perlmain.c
-
-perlmainst.c : runperl.c
-	copy runperl.c perlmainst.c
-
-perlmainst$(o) : perlmainst.c
-	$(CC) $(CFLAGS_O) $(OBJOUT_FLAG)$@ -c perlmainst.c
-
-$(PERLEXE): $(PERLDLL) $(CONFIGPM) $(PERLEXE_OBJ) $(PERLEXE_RES)
-	$(LINK32) -subsystem:console -out:$@ -stack:0x1000000 $(LINK_FLAGS) \
-	    $(LIBFILES) $(PERLEXE_OBJ) $(SETARGV_OBJ) $(PERLIMPLIB) $(PERLEXE_RES)
-	$(EMBED_EXE_MANI)
-	copy $(PERLEXE) $(WPERLEXE)
-	$(MINIPERL) -I..\lib bin\exetype.pl $(WPERLEXE) WINDOWS
-	copy splittree.pl ..
-	$(MINIPERL) -I..\lib ..\splittree.pl "../LIB" $(AUTODIR)
-
-$(PERLEXESTATIC): $(PERLSTATICLIB) $(CONFIGPM) $(PERLEXEST_OBJ) $(PERLEXE_RES)
-	$(LINK32) -subsystem:console -out:$@ -stack:0x1000000 $(LINK_FLAGS) \
-	    @Extensions_static $(PERLSTATICLIB) /PDB:NONE \
-	    $(LIBFILES) $(PERLEXEST_OBJ) $(SETARGV_OBJ) $(PERLEXE_RES)
-	$(EMBED_EXE_MANI)
-
-$(DYNALOADER).c: $(MINIPERL) $(EXTDIR)\DynaLoader\dl_win32.xs $(CONFIGPM)
-	if not exist $(AUTODIR) mkdir $(AUTODIR)
-	cd $(EXTDIR)\$(*B)
-	..\$(MINIPERL) -I..\..\lib $(*B)_pm.PL
-	..\$(MINIPERL) -I..\..\lib XSLoader_pm.PL
-	cd ..\..\win32
-	$(XCOPY) $(EXTDIR)\$(*B)\$(*B).pm $(LIBDIR)\$(NULL)
-	$(XCOPY) $(EXTDIR)\$(*B)\XSLoader.pm $(LIBDIR)\$(NULL)
-	cd $(EXTDIR)\$(*B)
-	$(XSUBPP) dl_win32.xs > $(*B).c
-	cd ..\..\win32
-
-$(EXTDIR)\DynaLoader\dl_win32.xs: dl_win32.xs
-	copy dl_win32.xs $(EXTDIR)\DynaLoader\dl_win32.xs
-
-MakePPPort: $(MINIPERL) $(CONFIGPM)
-	$(MINIPERL) -I..\lib ..\mkppport
-
-MakePPPort_clean:
-	-if exist $(MINIPERL) $(MINIPERL) -I..\lib ..\mkppport --clean
-
-#-------------------------------------------------------------------------------
-Extensions: ..\make_ext.pl $(PERLDEP) $(CONFIGPM)
-	$(XCOPY) ..\*.h $(COREDIR)\*.*
-	$(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(EXTDIR) --dynamic
-
-Extensions_reonly: ..\make_ext.pl $(PERLDEP) $(CONFIGPM)
-	$(XCOPY) ..\*.h $(COREDIR)\*.*
-	$(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(EXTDIR) --dynamic +re
-
-Extensions_static : ..\make_ext.pl list_static_libs.pl $(PERLDEP) $(CONFIGPM)
-	$(XCOPY) ..\*.h $(COREDIR)\*.*
-	$(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(EXTDIR) --static
-	$(MINIPERL) -I..\lib list_static_libs.pl > Extensions_static
-
-Extensions_clean: 
-	-if exist $(MINIPERL) $(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(EXTDIR) --all --target=clean
-
-Extensions_realclean: 
-	-if exist $(MINIPERL) $(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(EXTDIR) --all --target=realclean
-
-#-------------------------------------------------------------------------------
-
-doc: $(PERLEXE)
-	$(PERLEXE) -I..\lib ..\installhtml --podroot=.. --htmldir=$(HTMLDIR) \
-	    --podpath=pod:lib:ext:utils --htmlroot="file://$(INST_HTML::=|)" \
-	    --libpod=perlfunc:perlguts:perlvar:perlrun:perlop --recurse
-
-# Note that this next section is parsed (and regenerated) by pod/buildtoc
-# so please check that script before making structural changes here
-
-utils: $(PERLEXE) $(X2P)
-	cd ..\utils
-	$(MAKE) PERL=$(MINIPERL)
-	cd ..\pod
-	copy ..\README.aix      ..\pod\perlaix.pod
-	copy ..\README.amiga    ..\pod\perlamiga.pod
-	copy ..\README.apollo   ..\pod\perlapollo.pod
-	copy ..\README.beos     ..\pod\perlbeos.pod
-	copy ..\README.bs2000   ..\pod\perlbs2000.pod
-	copy ..\README.ce       ..\pod\perlce.pod
-	copy ..\README.cn       ..\pod\perlcn.pod
-	copy ..\README.cygwin   ..\pod\perlcygwin.pod
-	copy ..\README.dgux     ..\pod\perldgux.pod
-	copy ..\README.dos      ..\pod\perldos.pod
-	copy ..\README.epoc     ..\pod\perlepoc.pod
-	copy ..\README.freebsd  ..\pod\perlfreebsd.pod
-	copy ..\README.haiku    ..\pod\perlhaiku.pod
-	copy ..\README.hpux     ..\pod\perlhpux.pod
-	copy ..\README.hurd     ..\pod\perlhurd.pod
-	copy ..\README.irix     ..\pod\perlirix.pod
-	copy ..\README.jp       ..\pod\perljp.pod
-	copy ..\README.ko       ..\pod\perlko.pod
-	copy ..\README.linux    ..\pod\perllinux.pod
-	copy ..\README.machten  ..\pod\perlmachten.pod
-	copy ..\README.macos    ..\pod\perlmacos.pod
-	copy ..\README.macosx   ..\pod\perlmacosx.pod
-	copy ..\README.mint     ..\pod\perlmint.pod
-	copy ..\README.mpeix    ..\pod\perlmpeix.pod
-	copy ..\README.netware  ..\pod\perlnetware.pod
-	copy ..\README.openbsd  ..\pod\perlopenbsd.pod
-	copy ..\README.os2      ..\pod\perlos2.pod
-	copy ..\README.os390    ..\pod\perlos390.pod
-	copy ..\README.os400    ..\pod\perlos400.pod
-	copy ..\README.plan9    ..\pod\perlplan9.pod
-	copy ..\README.qnx      ..\pod\perlqnx.pod
-	copy ..\README.riscos   ..\pod\perlriscos.pod
-	copy ..\README.solaris  ..\pod\perlsolaris.pod
-	copy ..\README.symbian  ..\pod\perlsymbian.pod
-	copy ..\README.tru64    ..\pod\perltru64.pod
-	copy ..\README.tw       ..\pod\perltw.pod
-	copy ..\README.uts      ..\pod\perluts.pod
-	copy ..\README.vmesa    ..\pod\perlvmesa.pod
-	copy ..\README.vos      ..\pod\perlvos.pod
-	copy ..\README.win32    ..\pod\perlwin32.pod
-	copy ..\pod\perl5101delta.pod ..\pod\perldelta.pod
-	$(MAKE) -f ..\win32\pod.mak converters
-	cd ..\lib
-	$(PERLEXE) lib_pm.PL
-	cd ..\win32
-	$(PERLEXE) $(PL2BAT) $(UTILS)
-	$(PERLEXE) ..\autodoc.pl ..
-	$(PERLEXE) ..\pod\perlmodlib.pl -q
-	$(PERLEXE) ..\pod\buildtoc --build-toc -q
-
-# Note that the pod cleanup in this next section is parsed (and regenerated
-# by pod/buildtoc so please check that script before making changes here
-
-distclean: realclean
-	-del /f $(MINIPERL) $(PERLEXE) $(PERLDLL) $(GLOBEXE) \
-		$(PERLIMPLIB) ..\miniperl.lib $(MINIMOD) \
-		$(PERLEXESTATIC) $(PERLSTATICLIB)
-	-del /f *.def *.map
-	-del /f $(DYNALOADER).c
-	-del /f $(EXTDIR)\DynaLoader\dl_win32.xs
-	-del /f $(EXTDIR)\DynaLoader\DynaLoader.pm
-	-del /f $(EXTDIR)\DynaLoader\XSLoader.pm
-	-del /f $(LIBDIR)\Encode.pm $(LIBDIR)\encoding.pm $(LIBDIR)\Errno.pm
-	-del /f $(LIBDIR)\Config.pod $(LIBDIR)\POSIX.pod $(LIBDIR)\threads.pm
-	-del /f $(LIBDIR)\.exists $(LIBDIR)\attrs.pm $(LIBDIR)\DynaLoader.pm
-	-del /f $(LIBDIR)\XSLoader.pm $(LIBDIR)\lib.pm
-	-del /f $(LIBDIR)\Fcntl.pm $(LIBDIR)\IO.pm $(LIBDIR)\Opcode.pm
-	-del /f $(LIBDIR)\ops.pm $(LIBDIR)\Safe.pm
-	-del /f $(LIBDIR)\SDBM_File.pm $(LIBDIR)\Socket.pm $(LIBDIR)\POSIX.pm
-	-del /f $(LIBDIR)\B.pm $(LIBDIR)\O.pm $(LIBDIR)\re.pm
-	-del /f $(LIBDIR)\Devel\Peek.pm $(LIBDIR)\Devel\DProf.pm
-	-del /f $(LIBDIR)\Devel\PPPort.pm
-	-del /f $(LIBDIR)\File\Glob.pm
-	-del /f $(LIBDIR)\Storable.pm
-	-del /f $(LIBDIR)\Digest\MD5.pm
-	-del /f $(LIBDIR)\Digest\SHA.pm
-	-del /f $(LIBDIR)\PerlIO\encoding.pm
-	-del /f $(LIBDIR)\PerlIO\scalar.pm
-	-del /f $(LIBDIR)\PerlIO\via.pm
-	-del /f $(LIBDIR)\Sys\Hostname.pm
-	-del /f $(LIBDIR)\threads\shared.pm
-	-del /f $(LIBDIR)\Time\HiRes.pm
-	-del /f $(LIBDIR)\Unicode\Normalize.pm
-	-del /f $(LIBDIR)\Math\BigInt\FastCalc.pm
-	-del /f $(LIBDIR)\Win32.pm
-	-del /f $(LIBDIR)\Win32CORE.pm
-	-del /f $(LIBDIR)\Win32API\File.pm
-	-del /f $(LIBDIR)\Win32API\File\cFile.pc
-	-if exist $(LIBDIR)\B rmdir /s /q $(LIBDIR)\B
-	-if exist $(LIBDIR)\Compress rmdir /s /q $(LIBDIR)\Compress
-	-if exist $(LIBDIR)\Data rmdir /s /q $(LIBDIR)\Data
-	-if exist $(LIBDIR)\Encode rmdir /s /q $(LIBDIR)\Encode
-	-if exist $(LIBDIR)\Filter\Util rmdir /s /q $(LIBDIR)\Filter\Util
-	-if exist $(LIBDIR)\Hash rmdir /s /q $(LIBDIR)\Hash
-	-if exist $(LIBDIR)\App rmdir /s /q $(LIBDIR)\App
-	-if exist $(LIBDIR)\Module\Pluggable rmdir /s /q $(LIBDIR)\Module\Pluggable
-	-if exist $(LIBDIR)\TAP rmdir /s /q $(LIBDIR)\TAP
-	-if exist $(LIBDIR)\mro rmdir /s /q $(LIBDIR)\mro
-	-if exist $(LIBDIR)\IO\Compress rmdir /s /q $(LIBDIR)\IO\Compress
-	-if exist $(LIBDIR)\IO\Socket rmdir /s /q $(LIBDIR)\IO\Socket
-	-if exist $(LIBDIR)\IO\Uncompress rmdir /s /q $(LIBDIR)\IO\Uncompress
-	-if exist $(LIBDIR)\List rmdir /s /q $(LIBDIR)\List
-	-if exist $(LIBDIR)\MIME rmdir /s /q $(LIBDIR)\MIME
-	-if exist $(LIBDIR)\re rmdir /s /q $(LIBDIR)\re
-	-if exist $(LIBDIR)\Scalar rmdir /s /q $(LIBDIR)\Scalar
-	-if exist $(LIBDIR)\Sys rmdir /s /q $(LIBDIR)\Sys
-	-if exist $(LIBDIR)\threads rmdir /s /q $(LIBDIR)\threads
-	-if exist $(LIBDIR)\XS rmdir /s /q $(LIBDIR)\XS
-	-if exist $(LIBDIR)\Win32API rmdir /s /q $(LIBDIR)\Win32API
-	-cd $(PODDIR) && del /f *.html *.bat podchecker \
-	    perlaix.pod perlamiga.pod perlapi.pod perlapollo.pod \
-	    perlbeos.pod perlbs2000.pod perlce.pod perlcn.pod \
-	    perlcygwin.pod perldelta.pod perldgux.pod perldos.pod \
-	    perlepoc.pod perlfreebsd.pod perlhaiku.pod perlhpux.pod \
-	    perlhurd.pod perlintern.pod perlirix.pod perljp.pod perlko.pod \
-	    perllinux.pod perlmachten.pod perlmacos.pod perlmacosx.pod \
-	    perlmint.pod perlmodlib.pod perlmpeix.pod perlnetware.pod \
-	    perlopenbsd.pod perlos2.pod perlos390.pod perlos400.pod \
-	    perlplan9.pod perlqnx.pod perlriscos.pod perlsolaris.pod \
-	    perlsymbian.pod perltoc.pod perltru64.pod perltw.pod \
-	    perluts.pod perlvmesa.pod perlvos.pod perlwin32.pod \
-	    pod2html pod2latex pod2man pod2text pod2usage \
-	    podchecker podselect
-	-cd ..\utils && del /f h2ph splain perlbug pl2pm c2ph pstruct h2xs \
-	    perldoc perlivp dprofpp libnetcfg enc2xs piconv cpan *.bat \
-	    xsubpp instmodsh prove ptar ptardiff cpanp-run-perl cpanp cpan2dist shasum corelist config_data
-	-cd ..\x2p && del /f find2perl s2p psed *.bat
-	-del /f ..\config.sh ..\splittree.pl perlmain.c dlutils.c config.h.new \
-	        perlmainst.c
-	-del /f $(CONFIGPM)
-	-del /f ..\lib\Config_git.pl
-	-del /f bin\*.bat
-	-del /f perllibst.h
-	-del /f $(PERLEXE_ICO) perl.base
-	-cd .. && del /s *.lib *.map *.pdb *.ilk *.bs *$(o) .exists pm_to_blib
-	-cd $(EXTDIR) && del /s *.def Makefile Makefile.old
-	-if exist $(AUTODIR) rmdir /s /q $(AUTODIR)
-	-if exist $(COREDIR) rmdir /s /q $(COREDIR)
-	-if exist pod2htmd.tmp del pod2htmd.tmp
-	-if exist pod2htmi.tmp del pod2htmi.tmp
-	-if exist $(HTMLDIR) rmdir /s /q $(HTMLDIR)
-	-del /f ..\t\test_state
-
-install : all installbare installhtml
-
-installbare : utils
-	$(PERLEXE) ..\installperl
-	if exist $(WPERLEXE) $(XCOPY) $(WPERLEXE) $(INST_BIN)\*.*
-	if exist $(PERLEXESTATIC) $(XCOPY) $(PERLEXESTATIC) $(INST_BIN)\*.*
-	$(XCOPY) $(GLOBEXE) $(INST_BIN)\*.*
-	if exist ..\perl*.pdb $(XCOPY) ..\perl*.pdb $(INST_BIN)\*.*
-	if exist ..\x2p\a2p.pdb $(XCOPY) ..\x2p\a2p.pdb $(INST_BIN)\*.*
-	$(XCOPY) bin\*.bat $(INST_SCRIPT)\*.*
-
-installhtml : doc
-	$(RCOPY) $(HTMLDIR)\*.* $(INST_HTML)\*.*
-
-inst_lib : $(CONFIGPM)
-	copy splittree.pl ..
-	$(MINIPERL) -I..\lib ..\splittree.pl "../LIB" $(AUTODIR)
-	$(RCOPY) ..\lib $(INST_LIB)\*.*
-
-$(UNIDATAFILES) : $(MINIPERL) $(CONFIGPM) ..\lib\unicore\mktables
-	cd ..\lib\unicore && \
-	..\$(MINIPERL) -I.. mktables -check $@ $(FIRSTUNIFILE)
-
-minitest : $(MINIPERL) $(GLOBEXE) $(CONFIGPM) utils $(UNIDATAFILES)
-	$(XCOPY) $(MINIPERL) ..\t\$(NULL)
-	if exist ..\t\perl.exe del /f ..\t\perl.exe
-	rename ..\t\miniperl.exe perl.exe
-	$(XCOPY) $(GLOBEXE) ..\t\$(NULL)
-	attrib -r ..\t\*.*
-	cd ..\t && \
-	$(MINIPERL) -I..\lib harness base/*.t comp/*.t cmd/*.t io/*.t op/*.t pragma/*.t
-
-test-prep : all utils unpack_files
-	$(XCOPY) $(PERLEXE) ..\t\$(NULL)
-	$(XCOPY) $(PERLDLL) ..\t\$(NULL)
-	$(XCOPY) $(GLOBEXE) ..\t\$(NULL)
-
-test : test-prep
-	cd ..\t
-	$(PERLEXE) -I..\lib harness $(TEST_SWITCHES) $(TEST_FILES)
-	cd ..\win32
-
-unpack_files:
-	$(MINIPERL) -I..\lib ..\uupacktool.pl -u -d .. -m
-
-cleanup_unpacked_files:
-	-if exist $(MINIPERL) $(MINIPERL) -I..\lib ..\uupacktool.pl -c -d .. -m
-
-test-reonly : reonly utils
-	$(XCOPY) $(PERLEXE) ..\t\$(NULL)
-	$(XCOPY) $(PERLDLL) ..\t\$(NULL)
-	$(XCOPY) $(GLOBEXE) ..\t\$(NULL)
-	cd ..\t
-	$(PERLEXE) -I..\lib harness $(OPT) -re \bpat\b \breg \bre\b \bsubst \brxcode $(EXTRA)
-	cd ..\win32
-
-regen :
-	cd ..
-	regen.pl
-	cd win32
-
-test-notty : test-prep
-	set PERL_SKIP_TTY_TEST=1
-	cd ..\t
-	$(PERLEXE) -I..\lib harness $(TEST_SWITCHES) $(TEST_FILES)
-	cd ..\win32
-
-_test : 
-       $(XCOPY) $(PERLEXE) ..\t\$(NULL)
-       $(XCOPY) $(PERLDLL) ..\t\$(NULL)
-       $(XCOPY) $(GLOBEXE) ..\t\$(NULL)
-       cd ..\t
-       $(PERLEXE) -I..\lib harness $(TEST_SWITCHES) $(TEST_FILES)
-       cd ..\win32
-
-_clean :
-	-@$(DEL) miniperlmain$(o)
-	-@$(DEL) $(MINIPERL)
-	-@$(DEL) perlglob$(o)
-	-@$(DEL) perlmain$(o)
-	-@$(DEL) perlmainst$(o)
-	-@$(DEL) config.w32
-	-@$(DEL) config.h
-	-@$(DEL) ..\git_version.h
-	-@$(DEL) $(GLOBEXE)
-	-@$(DEL) $(PERLEXE)
-	-@$(DEL) $(WPERLEXE)
-	-@$(DEL) $(PERLEXESTATIC)
-	-@$(DEL) $(PERLSTATICLIB)
-	-@$(DEL) $(PERLDLL)
-	-@$(DEL) $(CORE_OBJ)
-	-@$(DEL) $(GENUUDMAP) $(GENUUDMAP_OBJ) $(UUDMAP_H)
-	-if exist $(MINIDIR) rmdir /s /q $(MINIDIR)
-	-if exist $(UNIDATADIR1) rmdir /s /q $(UNIDATADIR1)
-	-if exist $(UNIDATADIR2) rmdir /s /q $(UNIDATADIR2)
-	-@$(DEL) $(UNIDATAFILES)
-	-@$(DEL) $(WIN32_OBJ)
-	-@$(DEL) $(DLL_OBJ)
-	-@$(DEL) $(X2P_OBJ)
-	-@$(DEL) ..\*$(o) ..\*.lib ..\*.exp *$(o) *.lib *.exp *.res
-	-@$(DEL) ..\t\*.exe ..\t\*.dll ..\t\*.bat
-	-@$(DEL) ..\x2p\*.exe ..\x2p\*.bat
-	-@$(DEL) *.ilk
-	-@$(DEL) *.pdb
-	-@$(DEL) Extensions_static
-
-_preclean : cleanup_unpacked_files
-
-clean : _preclean Extensions_clean _clean
-
-realclean : _preclean Extensions_realclean MakePPPort_clean _clean
-
-# Handy way to run perlbug -ok without having to install and run the
-# installed perlbug. We don't re-run the tests here - we trust the user.
-# Please *don't* use this unless all tests pass.
-# If you want to report test failures, use "nmake nok" instead.
-ok: utils
-	$(PERLEXE) -I..\lib ..\utils\perlbug -ok -s "(UNINSTALLED)"
-
-okfile: utils
-	$(PERLEXE) -I..\lib ..\utils\perlbug -ok -s "(UNINSTALLED)" -F perl.ok
-
-nok: utils
-	$(PERLEXE) -I..\lib ..\utils\perlbug -nok -s "(UNINSTALLED)"
-
-nokfile: utils
-	$(PERLEXE) -I..\lib ..\utils\perlbug -nok -s "(UNINSTALLED)" -F perl.nok
+#
+# Makefile to build perl on Windows NT using Microsoft NMAKE.
+# Supported compilers:
+#	Visual C++ 2.0 or later
+#	Windows SDK 64-bit compiler and tools
+#
+# This is set up to build a perl.exe that runs off a shared library
+# (perl512.dll).  Also makes individual DLLs for the XS extensions.
+#
+
+##
+## Make sure you read README.win32 *before* you mess with anything here!
+##
+
+##
+## Build configuration.  Edit the values below to suit your needs.
+##
+
+#
+# Set these to wherever you want "nmake install" to put your
+# newly built perl.
+#
+INST_DRV	= c:
+INST_TOP	= $(INST_DRV)\perl
+
+#
+# Uncomment if you want to build a 32-bit Perl using a 32-bit compiler
+# on a 64-bit version of Windows.
+#WIN64		= undef
+
+#
+# Comment this out if you DON'T want your perl installation to be versioned.
+# This means that the new installation will overwrite any files from the
+# old installation at the same INST_TOP location.  Leaving it enabled is
+# the safest route, as perl adds the extra version directory to all the
+# locations it installs files to.  If you disable it, an alternative
+# versioned installation can be obtained by setting INST_TOP above to a
+# path that includes an arbitrary version string.
+#
+#INST_VER	= \5.12.2
+
+#
+# Comment this out if you DON'T want your perl installation to have
+# architecture specific components.  This means that architecture-
+# specific files will be installed along with the architecture-neutral
+# files.  Leaving it enabled is safer and more flexible, in case you
+# want to build multiple flavors of perl and install them together in
+# the same location.  Commenting it out gives you a simpler
+# installation that is easier to understand for beginners.
+#
+#INST_ARCH	= \$(ARCHNAME)
+
+#
+# Uncomment this if you want perl to run
+# 	$Config{sitelibexp}\sitecustomize.pl
+# before anything else.  This script can then be set up, for example,
+# to add additional entries to @INC.
+#
+#USE_SITECUST	= define
+
+#
+# uncomment to enable multiple interpreters.  This is need for fork()
+# emulation and for thread support.
+#
+USE_MULTI	= define
+
+#
+# Beginnings of interpreter cloning/threads; now reasonably complete.
+# This should be enabled to get the fork() emulation.  This needs
+# USE_MULTI as well.
+#
+USE_ITHREADS	= define
+
+#
+# uncomment to enable the implicit "host" layer for all system calls
+# made by perl.  This needs USE_MULTI above.  This is also needed to
+# get fork().
+#
+USE_IMP_SYS	= define
+
+#
+# Comment out next assign to disable perl's I/O subsystem and use compiler's 
+# stdio for IO - depending on your compiler vendor and run time library you may 
+# then get a number of fails from make test i.e. bugs - complain to them not us ;-). 
+# You will also be unable to take full advantage of perl5.8's support for multiple 
+# encodings and may see lower IO performance. You have been warned.
+USE_PERLIO	= define
+
+#
+# Comment this out if you don't want to enable large file support for
+# some reason.  Should normally only be changed to maintain compatibility
+# with an older release of perl.
+USE_LARGE_FILES	= define
+
+#
+# uncomment exactly one of the following
+#
+# Visual C++ 2.x
+#CCTYPE		= MSVC20
+# Visual C++ > 2.x and < 6.x
+#CCTYPE		= MSVC
+# Visual C++ 6.x (aka Visual C++ 98)
+CCTYPE		= MSVC60
+# Visual C++ Toolkit 2003 (aka Visual C++ 7.x) (free command-line tools)
+#CCTYPE		= MSVC70FREE
+# Visual C++ .NET 2003 (aka Visual C++ 7.x) (full version)
+#CCTYPE		= MSVC70
+# Windows Server 2003 SP1 Platform SDK (April 2005)
+#CCTYPE		= SDK2003SP1
+# Visual C++ 2005 Express Edition (aka Visual C++ 8.x) (free version)
+#CCTYPE		= MSVC80FREE
+# Visual C++ 2005 (aka Visual C++ 8.x) (full version)
+#CCTYPE		= MSVC80
+# Visual C++ 2008 Express Edition (aka Visual C++ 9.x) (free version)
+#CCTYPE		= MSVC90FREE
+# Visual C++ 2008 (aka Visual C++ 9.x) (full version)
+#CCTYPE		= MSVC90
+
+#
+# uncomment next line if you want debug version of perl (big,slow)
+# If not enabled, we automatically try to use maximum optimization
+# with all compilers that are known to have a working optimizer.
+#
+#CFG		= Debug
+
+#
+# uncomment to enable use of PerlCRT.DLL when using the Visual C compiler.
+# It has patches that fix known bugs in older versions of MSVCRT.DLL.
+# This currently requires VC 5.0 with Service Pack 3 or later.
+# Get it from CPAN at http://www.cpan.org/authors/id/D/DO/DOUGL/
+# and follow the directions in the package to install.
+#
+# Not recommended if you have VC 6.x and you're not running Windows 9x.
+#
+#USE_PERLCRT	= define
+
+#
+# uncomment to enable linking with setargv.obj under the Visual C
+# compiler. Setting this options enables perl to expand wildcards in
+# arguments, but it may be harder to use alternate methods like
+# File::DosGlob that are more powerful.  This option is supported only with
+# Visual C.
+#
+#USE_SETARGV	= define
+
+#
+# if you want to have the crypt() builtin function implemented, leave this or
+# CRYPT_LIB uncommented.  The fcrypt.c file named here contains a suitable
+# version of des_fcrypt().
+#
+CRYPT_SRC	= fcrypt.c
+
+#
+# if you didn't set CRYPT_SRC and if you have des_fcrypt() available in a
+# library, uncomment this, and make sure the library exists (see README.win32)
+# Specify the full pathname of the library.
+#
+#CRYPT_LIB	= fcrypt.lib
+
+#
+# set this if you wish to use perl's malloc
+# WARNING: Turning this on/off WILL break binary compatibility with extensions
+# you may have compiled with/without it.  Be prepared to recompile all
+# extensions if you change the default.  Currently, this cannot be enabled
+# if you ask for USE_IMP_SYS above.
+#
+#PERL_MALLOC	= define
+
+#
+# set this to enable debugging mstats
+# This must be enabled to use the Devel::Peek::mstat() function.  This cannot
+# be enabled without PERL_MALLOC as well.
+#
+#DEBUG_MSTATS	= define
+
+#
+# set this to additionally provide a statically linked perl-static.exe.
+# Note that dynamic loading will not work with this perl, so you must
+# include required modules statically using the STATIC_EXT or ALL_STATIC
+# variables below. A static library perl512s.lib will also be created.
+# Ordinary perl.exe is not affected by this option.
+#
+#BUILD_STATIC	= define
+
+#
+# in addition to BUILD_STATIC the option ALL_STATIC makes *every*
+# extension get statically built
+# This will result in a very large perl executable, but the main purpose
+# is to have proper linking set so as to be able to create miscellaneous
+# executables with different built-in extensions
+#
+#ALL_STATIC	= define
+
+#
+#
+# set the install locations of the compiler include/libraries
+# Running VCVARS32.BAT is *required* when using Visual C.
+# Some versions of Visual C don't define MSVCDIR in the environment,
+# so you may have to set CCHOME explicitly (spaces in the path name should
+# not be quoted)
+#
+#CCHOME		= f:\msvc20
+CCHOME		= $(MSVCDIR)
+CCINCDIR	= $(CCHOME)\include
+CCLIBDIR	= $(CCHOME)\lib
+
+#
+# Additional compiler flags can be specified here.
+#
+BUILDOPT	= $(BUILDOPTEXTRA)
+
+#
+# Adding -DPERL_HASH_SEED_EXPLICIT will disable randomization of Perl's
+# internal hash function unless the PERL_HASH_SEED environment variable is set.
+# Alternatively, adding -DNO_HASH_SEED will completely disable the
+# randomization feature. 
+# The latter is required to maintain binary compatibility with Perl 5.8.0.
+#
+#BUILDOPT	= $(BUILDOPT) -DPERL_HASH_SEED_EXPLICIT
+#BUILDOPT	= $(BUILDOPT) -DNO_HASH_SEED
+
+#
+# This should normally be disabled.  Adding -DPERL_POLLUTE enables support
+# for old symbols by default, at the expense of extreme pollution.  You most
+# probably just want to build modules that won't compile with
+#         perl Makefile.PL POLLUTE=1
+# instead of enabling this.  Please report such modules to the respective
+# authors.
+#
+#BUILDOPT	= $(BUILDOPT) -DPERL_POLLUTE
+
+#
+# This should normally be disabled.  Enabling it will disable the File::Glob
+# implementation of CORE::glob.
+#
+#BUILDOPT	= $(BUILDOPT) -DPERL_EXTERNAL_GLOB
+
+#
+# This should normally be disabled.  Enabling it causes perl to read scripts
+# in text mode (which is the 5.005 behavior) and will break ByteLoader.
+#
+#BUILDOPT	= $(BUILDOPT) -DPERL_TEXTMODE_SCRIPTS
+
+#
+# specify semicolon-separated list of extra directories that modules will
+# look for libraries (spaces in path names need not be quoted)
+#
+EXTRALIBDIRS	=
+
+#
+# set this to your email address (perl will guess a value from
+# from your loginname and your hostname, which may not be right)
+#
+#EMAIL		=
+
+##
+## Build configuration ends.
+##
+
+##################### CHANGE THESE ONLY IF YOU MUST #####################
+
+!IF "$(CRYPT_SRC)$(CRYPT_LIB)" == ""
+D_CRYPT		= undef
+!ELSE
+D_CRYPT		= define
+CRYPT_FLAG	= -DHAVE_DES_FCRYPT
+!ENDIF
+
+!IF "$(USE_IMP_SYS)" == "define"
+PERL_MALLOC	= undef
+DEBUG_MSTATS	= undef
+!ENDIF
+
+!IF "$(PERL_MALLOC)" == ""
+PERL_MALLOC	= undef
+DEBUG_MSTATS	= undef
+!ENDIF
+
+!IF "$(DEBUG_MSTATS)" == ""
+DEBUG_MSTATS	= undef
+!ENDIF
+
+!IF "$(DEBUG_MSTATS)" == "define"
+BUILDOPT	= $(BUILDOPT) -DPERL_DEBUGGING_MSTATS
+!ENDIF
+
+!IF "$(USE_SITECUST)" == ""
+USE_SITECUST	= undef
+!ENDIF
+
+!IF "$(USE_MULTI)" == ""
+USE_MULTI	= undef
+!ENDIF
+
+!IF "$(USE_ITHREADS)" == ""
+USE_ITHREADS	= undef
+!ENDIF
+
+!IF "$(USE_IMP_SYS)" == ""
+USE_IMP_SYS	= undef
+!ENDIF
+
+!IF "$(USE_PERLIO)" == ""
+USE_PERLIO	= undef
+!ENDIF
+
+!IF "$(USE_LARGE_FILES)" == ""
+USE_LARGE_FILES	= undef
+!ENDIF
+
+!IF "$(USE_PERLCRT)" == ""
+USE_PERLCRT	= undef
+!ENDIF
+
+!IF "$(USE_IMP_SYS)$(USE_MULTI)" == "defineundef"
+USE_MULTI	= define
+!ENDIF
+
+!IF "$(USE_ITHREADS)$(USE_MULTI)" == "defineundef"
+USE_MULTI	= define
+!ENDIF
+
+!IF "$(USE_SITECUST)" == "define"
+BUILDOPT	= $(BUILDOPT) -DUSE_SITECUSTOMIZE
+!ENDIF
+
+!IF "$(USE_MULTI)" != "undef"
+BUILDOPT	= $(BUILDOPT) -DPERL_IMPLICIT_CONTEXT
+!ENDIF
+
+!IF "$(USE_IMP_SYS)" != "undef"
+BUILDOPT	= $(BUILDOPT) -DPERL_IMPLICIT_SYS
+!ENDIF
+
+!IF "$(PROCESSOR_ARCHITECTURE)" == ""
+PROCESSOR_ARCHITECTURE	= x86
+!ENDIF
+
+!IF "$(WIN64)" == ""
+# When we are running from a 32bit cmd.exe on AMD64 then
+# PROCESSOR_ARCHITECTURE is set to x86 and PROCESSOR_ARCHITEW6432
+# is set to AMD64
+!IF "$(PROCESSOR_ARCHITEW6432)" != ""
+PROCESSOR_ARCHITECTURE	= $(PROCESSOR_ARCHITEW6432)
+WIN64			= define
+!ELSE
+!IF "$(PROCESSOR_ARCHITECTURE)" == "AMD64" || "$(PROCESSOR_ARCHITECTURE)" == "IA64"
+WIN64			= define
+!ELSE
+WIN64			= undef
+!ENDIF
+!ENDIF
+!ENDIF
+
+# Treat 64-bit MSVC60 (doesn't really exist) as SDK2003SP1 because
+# both link against MSVCRT.dll (which is part of Windows itself) and
+# not against a compiler specific versioned runtime.
+!IF "$(WIN64)" == "define" && "$(CCTYPE)" == "MSVC60"
+CCTYPE		= SDK2003SP1
+!ENDIF
+
+ARCHITECTURE = $(PROCESSOR_ARCHITECTURE)
+!IF "$(ARCHITECTURE)" == "AMD64"
+ARCHITECTURE	= x64
+!ENDIF
+!IF "$(ARCHITECTURE)" == "IA64"
+ARCHITECTURE	= ia64
+!ENDIF
+
+!IF "$(USE_MULTI)" == "define"
+ARCHNAME	= MSWin32-$(ARCHITECTURE)-multi
+!ELSE
+!IF "$(USE_PERLIO)" == "define"
+ARCHNAME	= MSWin32-$(ARCHITECTURE)-perlio
+!ELSE
+ARCHNAME	= MSWin32-$(ARCHITECTURE)
+!ENDIF
+!ENDIF
+
+!IF "$(USE_PERLIO)" == "define"
+BUILDOPT	= $(BUILDOPT) -DUSE_PERLIO
+!ENDIF
+
+!IF "$(USE_ITHREADS)" == "define"
+ARCHNAME	= $(ARCHNAME)-thread
+!ENDIF
+
+# Visual C++ 98, .NET 2003, 2005 and 2008 specific.
+# VC++ 6.x, 7.x, 8.x and 9.x can load DLL's on demand.  Makes the test suite run
+# in about 10% less time.  (The free version of 7.x can't do this, but the free
+# versions of 8.x and 9.x can.)
+!IF "$(CCTYPE)" == "MSVC60" || "$(CCTYPE)" == "MSVC70"     || \
+    "$(CCTYPE)" == "MSVC80" || "$(CCTYPE)" == "MSVC80FREE" || \
+    "$(CCTYPE)" == "MSVC90" || "$(CCTYPE)" == "MSVC90FREE"
+DELAYLOAD	= -DELAYLOAD:ws2_32.dll delayimp.lib
+!ENDIF
+
+# Visual C++ 2005 and 2008 (VC++ 8.x and 9.x) create manifest files for EXEs and
+# DLLs. These either need copying everywhere with the binaries, or else need
+# embedding in them otherwise MSVCR80.dll or MSVCR90.dll won't be found. For
+# simplicity, embed them if they exist (and delete them afterwards so that they
+# don't get installed too).
+EMBED_EXE_MANI	= if exist $@.manifest mt -nologo -manifest $@.manifest -outputresource:$@;1 && \
+		  if exist $@.manifest del $@.manifest
+EMBED_DLL_MANI	= if exist $@.manifest mt -nologo -manifest $@.manifest -outputresource:$@;2 && \
+		  if exist $@.manifest del $@.manifest
+
+ARCHDIR		= ..\lib\$(ARCHNAME)
+COREDIR		= ..\lib\CORE
+AUTODIR		= ..\lib\auto
+LIBDIR		= ..\lib
+EXTDIR		= ..\ext
+DISTDIR		= ..\dist
+CPANDIR		= ..\cpan
+PODDIR		= ..\pod
+EXTUTILSDIR	= $(LIBDIR)\ExtUtils
+HTMLDIR		= .\html
+
+#
+INST_SCRIPT	= $(INST_TOP)$(INST_VER)\bin
+INST_BIN	= $(INST_SCRIPT)$(INST_ARCH)
+INST_LIB	= $(INST_TOP)$(INST_VER)\lib
+INST_ARCHLIB	= $(INST_LIB)$(INST_ARCH)
+INST_COREDIR	= $(INST_ARCHLIB)\CORE
+INST_HTML	= $(INST_TOP)$(INST_VER)\html
+
+#
+# Programs to compile, build .lib files and link
+#
+
+CC		= cl
+LINK32		= link
+LIB32		= $(LINK32) -lib
+RSC		= rc
+
+#
+# Options
+#
+
+INCLUDES	= -I$(COREDIR) -I.\include -I. -I..
+#PCHFLAGS	= -Fpc:\temp\vcmoduls.pch -YX
+DEFINES		= -DWIN32 -D_CONSOLE -DNO_STRICT $(CRYPT_FLAG)
+LOCDEFS		= -DPERLDLL -DPERL_CORE
+SUBSYS		= console
+CXX_FLAG	= -TP -EHsc
+
+!IF "$(USE_PERLCRT)" != "define"
+LIBC	= msvcrt.lib
+!ELSE
+LIBC	= PerlCRT.lib
+!ENDIF
+
+!IF  "$(CFG)" == "Debug"
+!  IF "$(CCTYPE)" == "MSVC20"
+OPTIMIZE	= -Od -MD -Z7 -DDEBUGGING
+!  ELSE
+OPTIMIZE	= -Od -MD -Zi -DDEBUGGING
+!  ENDIF
+LINK_DBG	= -debug
+!ELSE
+OPTIMIZE	= -MD -Zi -DNDEBUG
+# we enable debug symbols in release builds also
+LINK_DBG	= -debug -opt:ref,icf
+# you may want to enable this if you want COFF symbols in the executables
+# in addition to the PDB symbols.  The default Dr. Watson that ships with
+# Windows can use the the former but not latter.  The free WinDbg can be
+# installed to get better stack traces from just the PDB symbols, so we
+# avoid the bloat of COFF symbols by default.
+#LINK_DBG	= $(LINK_DBG) -debugtype:both
+!  IF "$(WIN64)" == "define"
+# enable Whole Program Optimizations (WPO) and Link Time Code Generation (LTCG)
+OPTIMIZE	= $(OPTIMIZE) -Ox -GL
+LINK_DBG	= $(LINK_DBG) -ltcg
+!  ELSE
+# -O1 yields smaller code, which turns out to be faster than -O2 on x86
+OPTIMIZE	= $(OPTIMIZE) -O1
+#OPTIMIZE	= $(OPTIMIZE) -O2
+!  ENDIF
+!ENDIF
+
+!IF "$(WIN64)" == "define"
+DEFINES		= $(DEFINES) -DWIN64 -DCONSERVATIVE
+OPTIMIZE	= $(OPTIMIZE) -fp:precise
+!ENDIF
+
+# For now, silence VC++ 8.x's and 9.x's warnings about "unsafe" CRT functions
+# and POSIX CRT function names being deprecated.
+!IF "$(CCTYPE)" == "MSVC80" || "$(CCTYPE)" == "MSVC80FREE" || \
+    "$(CCTYPE)" == "MSVC90" || "$(CCTYPE)" == "MSVC90FREE"
+DEFINES		= $(DEFINES) -D_CRT_SECURE_NO_DEPRECATE -D_CRT_NONSTDC_NO_DEPRECATE
+!ENDIF
+
+# Use the MSVCRT read() fix if the PerlCRT was not chosen, but only when using
+# VC++ 6.x or earlier. Later versions use MSVCR70.dll, MSVCR71.dll, etc, which
+# do not require the fix.
+!IF "$(CCTYPE)" == "MSVC20" || "$(CCTYPE)" == "MSVC" || "$(CCTYPE)" == "MSVC60" 
+!  IF "$(USE_PERLCRT)" != "define"
+BUILDOPT	= $(BUILDOPT) -DPERL_MSVCRT_READFIX
+!  ENDIF
+!ENDIF
+
+LIBBASEFILES	= $(CRYPT_LIB) \
+		oldnames.lib kernel32.lib user32.lib gdi32.lib winspool.lib \
+		comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib \
+		netapi32.lib uuid.lib ws2_32.lib mpr.lib winmm.lib \
+		version.lib odbc32.lib odbccp32.lib comctl32.lib
+
+# The 64 bit Windows Server 2003 SP1 SDK compilers link against MSVCRT.dll, which
+# doesn't include the buffer overrun verification code used by the /GS switch.
+# Since the code links against libraries that are compiled with /GS, this
+# "security cookie verification" code must be included via bufferoverflow.lib.
+!IF "$(WIN64)" == "define" && "$(CCTYPE)" == "SDK2003SP1"
+LIBBASEFILES    = $(LIBBASEFILES) bufferoverflowU.lib
+!ENDIF
+
+# we add LIBC here, since we may be using PerlCRT.dll
+LIBFILES	= $(LIBBASEFILES) $(LIBC)
+
+#EXTRACFLAGS	= -nologo -GF -W4 -wd4127 -wd4706
+EXTRACFLAGS	= -nologo -GF -W3
+CFLAGS		= $(EXTRACFLAGS) $(INCLUDES) $(DEFINES) $(LOCDEFS) \
+		$(PCHFLAGS) $(OPTIMIZE)
+LINK_FLAGS	= -nologo -nodefaultlib $(LINK_DBG) \
+		-libpath:"$(INST_COREDIR)" \
+		-machine:$(PROCESSOR_ARCHITECTURE)
+LIB_FLAGS	= -nologo
+OBJOUT_FLAG	= -Fo
+EXEOUT_FLAG	= -Fe
+
+CFLAGS_O	= $(CFLAGS) $(BUILDOPT)
+
+!IF "$(CCTYPE)" == "MSVC80" || "$(CCTYPE)" == "MSVC80FREE" || \
+    "$(CCTYPE)" == "MSVC90" || "$(CCTYPE)" == "MSVC90FREE"
+LINK_FLAGS	= $(LINK_FLAGS) "/manifestdependency:type='Win32' name='Microsoft.Windows.Common-Controls' version='6.0.0.0' processorArchitecture='*' publicKeyToken='6595b64144ccf1df' language='*'"
+!ELSE
+RSC_FLAGS	= -DINCLUDE_MANIFEST
+!ENDIF
+
+
+#################### do not edit below this line #######################
+############# NO USER-SERVICEABLE PARTS BEYOND THIS POINT ##############
+
+o = .obj
+
+#
+# Rules
+#
+
+.SUFFIXES : .c $(o) .dll .lib .exe .rc .res
+
+.c$(o):
+	$(CC) -c -I$(<D) $(CFLAGS_O) $(OBJOUT_FLAG)$@ $<
+
+.y.c:
+	$(NOOP)
+
+$(o).dll:
+	$(LINK32) -dll -subsystem:windows -implib:$(*B).lib -def:$(*B).def \
+	    -out:$@ $(LINK_FLAGS) $(LIBFILES) $< $(LIBPERL)
+	$(EMBED_DLL_MANI)
+
+.rc.res:
+	$(RSC) -i.. $(RSC_FLAGS) $<
+
+#
+# various targets
+
+# makedef.pl must be updated if this changes, and this should normally
+# only change when there is an incompatible revision of the public API.
+PERLIMPLIB	= ..\perl512.lib
+PERLSTATICLIB	= ..\perl512s.lib
+PERLDLL		= ..\perl512.dll
+
+MINIPERL	= ..\miniperl.exe
+MINIDIR		= .\mini
+PERLEXE		= ..\perl.exe
+WPERLEXE	= ..\wperl.exe
+PERLEXESTATIC	= ..\perl-static.exe
+GLOBEXE		= ..\perlglob.exe
+CONFIGPM	= ..\lib\Config.pm ..\lib\Config_heavy.pl
+MINIMOD		= ..\lib\ExtUtils\Miniperl.pm
+X2P		= ..\x2p\a2p.exe
+GENUUDMAP	= ..\generate_uudmap.exe
+!IF "$(BUILD_STATIC)" == "define"
+PERLSTATIC	= static
+!ELSE
+PERLSTATIC	= 
+!ENDIF
+  
+# Unicode data files generated by mktables
+FIRSTUNIFILE     = ..\lib\unicore\Decomposition.pl
+UNIDATAFILES	 = ..\lib\unicore\Decomposition.pl \
+		   ..\lib\unicore\CombiningClass.pl ..\lib\unicore\Name.pl \
+		   ..\lib\unicore\Heavy.pl ..\lib\unicore\mktables.lst \
+		   ..\lib\unicore\TestProp.pl
+
+# Directories of Unicode data files generated by mktables
+UNIDATADIR1	= ..\lib\unicore\To
+UNIDATADIR2	= ..\lib\unicore\lib
+
+PERLEXE_MANIFEST= .\perlexe.manifest
+PERLEXE_ICO	= .\perlexe.ico
+PERLEXE_RES	= .\perlexe.res
+PERLDLL_RES	=
+
+# Nominate a target which causes extensions to be re-built
+# This used to be $(PERLEXE), but at worst it is the .dll that they depend
+# on and really only the interface - i.e. the .def file used to export symbols
+# from the .dll
+PERLDEP		= perldll.def
+
+PL2BAT		= bin\pl2bat.pl
+GLOBBAT		= bin\perlglob.bat
+
+UTILS		=			\
+		..\utils\h2ph		\
+		..\utils\splain		\
+		..\utils\dprofpp	\
+		..\utils\perlbug	\
+		..\utils\pl2pm 		\
+		..\utils\c2ph		\
+		..\utils\pstruct	\
+		..\utils\h2xs		\
+		..\utils\perldoc	\
+		..\utils\perlivp	\
+		..\utils\libnetcfg	\
+		..\utils\enc2xs		\
+		..\utils\piconv		\
+		..\utils\config_data	\
+		..\utils\corelist	\
+		..\utils\cpan		\
+		..\utils\xsubpp		\
+		..\utils\prove		\
+		..\utils\ptar		\
+		..\utils\ptardiff	\
+		..\utils\cpanp-run-perl	\
+		..\utils\cpanp	\
+		..\utils\cpan2dist	\
+		..\utils\shasum		\
+		..\utils\instmodsh	\
+		..\pod\pod2html		\
+		..\pod\pod2latex	\
+		..\pod\pod2man		\
+		..\pod\pod2text		\
+		..\pod\pod2usage	\
+		..\pod\podchecker	\
+		..\pod\podselect	\
+		..\x2p\find2perl	\
+		..\x2p\psed		\
+		..\x2p\s2p		\
+		bin\exetype.pl		\
+		bin\runperl.pl		\
+		bin\pl2bat.pl		\
+		bin\perlglob.pl		\
+		bin\search.pl
+
+MAKE		= nmake -nologo
+MAKE_BARE	= nmake
+
+!IF "$(WIN64)" == "define"
+CFGSH_TMPL	= config.vc64
+CFGH_TMPL	= config_H.vc64
+!ELSE
+CFGSH_TMPL	= config.vc
+CFGH_TMPL	= config_H.vc
+!ENDIF
+
+XCOPY		= xcopy /f /r /i /d /y
+RCOPY		= xcopy /f /r /i /e /d /y
+NOOP		= @rem
+NULL		=
+
+DEL		= del
+
+MICROCORE_SRC	=		\
+		..\av.c		\
+		..\deb.c	\
+		..\doio.c	\
+		..\doop.c	\
+		..\dump.c	\
+		..\globals.c	\
+		..\gv.c		\
+		..\mro.c	\
+		..\hv.c		\
+		..\locale.c	\
+		..\mathoms.c    \
+		..\mg.c		\
+		..\numeric.c	\
+		..\op.c		\
+		..\pad.c	\
+		..\perl.c	\
+		..\perlapi.c	\
+		..\perly.c	\
+		..\pp.c		\
+		..\pp_ctl.c	\
+		..\pp_hot.c	\
+		..\pp_pack.c	\
+		..\pp_sort.c	\
+		..\pp_sys.c	\
+		..\reentr.c	\
+		..\regcomp.c	\
+		..\regexec.c	\
+		..\run.c	\
+		..\scope.c	\
+		..\sv.c		\
+		..\taint.c	\
+		..\toke.c	\
+		..\universal.c	\
+		..\utf8.c	\
+		..\util.c
+
+EXTRACORE_SRC	= $(EXTRACORE_SRC) perllib.c
+
+!IF "$(PERL_MALLOC)" == "define"
+EXTRACORE_SRC	= $(EXTRACORE_SRC) ..\malloc.c
+!ENDIF
+
+EXTRACORE_SRC	= $(EXTRACORE_SRC) ..\perlio.c
+
+WIN32_SRC	=		\
+		.\win32.c	\
+		.\win32sck.c	\
+		.\win32thread.c
+
+# We need this for miniperl build unless we override canned 
+# config.h #define building mini\*
+#!IF "$(USE_PERLIO)" == "define"
+WIN32_SRC	= $(WIN32_SRC) .\win32io.c
+#!ENDIF
+
+!IF "$(CRYPT_SRC)" != ""
+WIN32_SRC	= $(WIN32_SRC) .\$(CRYPT_SRC)
+!ENDIF
+
+X2P_SRC		=		\
+		..\x2p\a2p.c	\
+		..\x2p\hash.c	\
+		..\x2p\str.c	\
+		..\x2p\util.c	\
+		..\x2p\walk.c
+
+CORE_NOCFG_H	=		\
+		..\av.h		\
+		..\cop.h	\
+		..\cv.h		\
+		..\dosish.h	\
+		..\embed.h	\
+		..\form.h	\
+		..\gv.h		\
+		..\handy.h	\
+		..\hv.h		\
+		..\iperlsys.h	\
+		..\mg.h		\
+		..\nostdio.h	\
+		..\op.h		\
+		..\opcode.h	\
+		..\perl.h	\
+		..\perlapi.h	\
+		..\perlsdio.h	\
+		..\perlsfio.h	\
+		..\perly.h	\
+		..\pp.h		\
+		..\proto.h	\
+		..\regcomp.h	\
+		..\regexp.h	\
+		..\scope.h	\
+		..\sv.h		\
+		..\thread.h	\
+		..\unixish.h	\
+		..\utf8.h	\
+		..\util.h	\
+		..\warnings.h	\
+		..\XSUB.h	\
+		..\EXTERN.h	\
+		..\perlvars.h	\
+		..\intrpvar.h	\
+		.\include\dirent.h	\
+		.\include\netdb.h	\
+		.\include\sys\socket.h	\
+		.\win32.h
+
+CORE_H		= $(CORE_NOCFG_H) .\config.h ..\git_version.h
+
+UUDMAP_H	= ..\uudmap.h
+BITCOUNT_H	= ..\bitcount.h
+
+MICROCORE_OBJ	= $(MICROCORE_SRC:.c=.obj)
+CORE_OBJ	= $(MICROCORE_OBJ) $(EXTRACORE_SRC:.c=.obj)
+WIN32_OBJ	= $(WIN32_SRC:.c=.obj)
+MINICORE_OBJ	= $(MICROCORE_OBJ:..\=.\mini\)	\
+		  $(MINIDIR)\miniperlmain$(o)	\
+		  $(MINIDIR)\perlio$(o)
+MINIWIN32_OBJ	= $(WIN32_OBJ:.\=.\mini\)
+MINI_OBJ	= $(MINICORE_OBJ) $(MINIWIN32_OBJ)
+DLL_OBJ		= $(DYNALOADER)
+X2P_OBJ		= $(X2P_SRC:.c=.obj)
+GENUUDMAP_OBJ	= $(GENUUDMAP:.exe=.obj)
+
+PERLDLL_OBJ	= $(CORE_OBJ)
+PERLEXE_OBJ	= perlmain$(o)
+PERLEXEST_OBJ	= perlmainst$(o)
+
+PERLDLL_OBJ	= $(PERLDLL_OBJ) $(WIN32_OBJ) $(DLL_OBJ)
+
+!IF "$(USE_SETARGV)" != ""
+SETARGV_OBJ	= setargv$(o)
+!ENDIF
+
+!IF "$(ALL_STATIC)" == "define"
+# some exclusions, unfortunately, until fixed:
+#  - Win32 extension contains overlapped symbols with win32.c (BUG!)
+#  - MakeMaker isn't capable enough for SDBM_File (smaller bug)
+#  - Encode (encoding search algorithm relies on shared library?)
+STATIC_EXT	= * !Win32 !SDBM_File !Encode
+!ELSE
+# specify static extensions here, for example:
+#STATIC_EXT	= Cwd Compress/Raw/Zlib
+STATIC_EXT	= Win32CORE
+!ENDIF
+
+DYNALOADER	= ..\DynaLoader$(o)
+
+CFG_VARS	=					\
+		"INST_DRV=$(INST_DRV)"			\
+		"INST_TOP=$(INST_TOP)"			\
+		"INST_VER=$(INST_VER)"			\
+		"INST_ARCH=$(INST_ARCH)"		\
+		"archname=$(ARCHNAME)"			\
+		"cc=$(CC)"				\
+		"ld=$(LINK32)"				\
+		"ccflags=$(EXTRACFLAGS) $(OPTIMIZE:"=\") $(DEFINES) $(BUILDOPT)"	\
+		"cf_email=$(EMAIL)"	 		\
+		"d_crypt=$(D_CRYPT)"			\
+		"d_mymalloc=$(PERL_MALLOC)"		\
+		"libs=$(LIBFILES)"			\
+		"incpath=$(CCINCDIR:"=\")"		\
+		"libperl=$(PERLIMPLIB:..\=)"		\
+		"libpth=$(CCLIBDIR:"=\");$(EXTRALIBDIRS:"=\")"	\
+		"libc=$(LIBC)"				\
+		"make=$(MAKE_BARE)"				\
+		"static_ext=$(STATIC_EXT)"		\
+		"usethreads=$(USE_ITHREADS)"		\
+		"useithreads=$(USE_ITHREADS)"		\
+		"usemultiplicity=$(USE_MULTI)"		\
+		"useperlio=$(USE_PERLIO)"		\
+		"uselargefiles=$(USE_LARGE_FILES)"	\
+		"usesitecustomize=$(USE_SITECUST)"	\
+		"LINK_FLAGS=$(LINK_FLAGS:"=\")"		\
+		"optimize=$(OPTIMIZE:"=\")"
+
+ICWD = -I..\cpan\Cwd -I..\cpan\Cwd\lib
+
+#
+# Top targets
+#
+
+all : .\config.h ..\git_version.h $(GLOBEXE) $(MINIMOD) $(CONFIGPM) \
+	$(UNIDATAFILES) MakePPPort $(PERLEXE) $(X2P) Extensions_nonxs Extensions $(PERLSTATIC)
+	@echo	Everything is up to date. '$(MAKE_BARE) test' to run test suite.
+
+regnodes : ..\regnodes.h
+
+..\regcomp$(o) : ..\regnodes.h ..\regcharclass.h	
+
+..\regexec$(o) : ..\regnodes.h ..\regcharclass.h
+
+reonly : regnodes .\config.h ..\git_version.h $(GLOBEXE) $(MINIMOD) $(CONFIGPM) \
+	$(UNIDATAFILES) $(PERLEXE) $(X2P) Extensions_reonly
+	@echo	Perl and 're' are up to date.
+
+static: $(PERLEXESTATIC)
+
+#------------------------------------------------------------
+
+$(GLOBEXE) : perlglob$(o)
+	$(LINK32) $(LINK_FLAGS) $(LIBFILES) -out:$@ -subsystem:$(SUBSYS) \
+	    perlglob$(o) setargv$(o)
+	$(EMBED_EXE_MANI)
+
+perlglob$(o)  : perlglob.c
+
+config.w32 : $(CFGSH_TMPL)
+	copy $(CFGSH_TMPL) config.w32
+
+.\config.h : $(CFGH_TMPL)
+	-del /f config.h
+	copy $(CFGH_TMPL) config.h
+
+..\git_version.h : $(MINIPERL) ..\make_patchnum.pl
+	cd ..
+	miniperl -Ilib make_patchnum.pl
+	cd win32
+
+# make sure that we recompile perl.c if the git version changes
+..\perl$(o) : ..\git_version.h
+
+..\config.sh : config.w32 $(MINIPERL) config_sh.PL
+	$(MINIPERL) -I..\lib config_sh.PL $(CFG_VARS) config.w32 > ..\config.sh
+
+# this target is for when changes to the main config.sh happen.
+# edit config.vc, then make perl in a minimal configuration (i.e. with MULTI,
+# ITHREADS, IMP_SYS, LARGE_FILES, PERLIO and CRYPT off), then make this target
+# to regenerate config_H.vc.
+# repeat for config.vc64 and config_H.vc64 if you have a suitable build
+# environment, otherwise hand-edit them to maintain the same differences with
+# config.vc and config_H.vc as before.
+# unfortunately, some further manual editing is also then required to restore all
+# the special __GNUC__ handling that is otherwise lost.
+regen_config_h:
+	$(MINIPERL) -I..\lib config_sh.PL $(CFG_VARS) $(CFGSH_TMPL) > ..\config.sh
+	$(MINIPERL) -I..\lib ..\configpm --chdir=..
+	-del /f $(CFGH_TMPL)
+	-$(MINIPERL) -I..\lib $(ICWD) config_h.PL "INST_VER=$(INST_VER)"
+	rename config.h $(CFGH_TMPL)
+
+$(CONFIGPM) : $(MINIPERL) ..\config.sh config_h.PL ..\minimod.pl
+	$(MINIPERL) -I..\lib ..\configpm --chdir=..
+	if exist lib\* $(RCOPY) lib\*.* ..\lib\$(NULL)
+	$(XCOPY) ..\*.h $(COREDIR)\*.*
+	$(XCOPY) *.h $(COREDIR)\*.*
+	$(XCOPY) ..\ext\re\re.pm $(LIBDIR)\*.*
+	$(RCOPY) include $(COREDIR)\*.*
+	-$(MINIPERL) -I..\lib $(ICWD) config_h.PL "INST_VER=$(INST_VER)"
+	if errorlevel 1 $(MAKE) /$(MAKEFLAGS) $(CONFIGPM)
+
+$(MINIPERL) : $(MINIDIR) $(MINI_OBJ)
+	$(LINK32) -subsystem:console -out:$@ @<<
+	$(LINK_FLAGS) $(LIBFILES) $(MINI_OBJ)
+<<
+	$(EMBED_EXE_MANI)
+
+$(MINIDIR) :
+	if not exist "$(MINIDIR)" mkdir "$(MINIDIR)"
+
+$(MINICORE_OBJ) : $(CORE_NOCFG_H)
+	$(CC) -c $(CFLAGS) -DPERL_EXTERNAL_GLOB -DPERL_IS_MINIPERL $(OBJOUT_FLAG)$@ ..\$(*F).c
+
+$(MINIWIN32_OBJ) : $(CORE_NOCFG_H)
+	$(CC) -c $(CFLAGS) $(OBJOUT_FLAG)$@ $(*F).c
+
+# -DPERL_IMPLICIT_SYS needs C++ for perllib.c
+# This is the only file that depends on perlhost.h, vmem.h, and vdir.h
+!IF "$(USE_IMP_SYS)" == "define"
+perllib$(o)	: perllib.c .\perlhost.h .\vdir.h .\vmem.h
+	$(CC) -c -I. $(CFLAGS_O) $(CXX_FLAG) $(OBJOUT_FLAG)$@ perllib.c
+!ENDIF
+
+# 1. we don't want to rebuild miniperl.exe when config.h changes
+# 2. we don't want to rebuild miniperl.exe with non-default config.h
+# 3. we can't have miniperl.exe depend on git_version.h, as miniperl creates it
+$(MINI_OBJ)	: $(CORE_NOCFG_H)
+
+$(WIN32_OBJ)	: $(CORE_H)
+$(CORE_OBJ)	: $(CORE_H)
+$(DLL_OBJ)	: $(CORE_H)
+$(X2P_OBJ)	: $(CORE_H)
+
+perldll.def : $(MINIPERL) $(CONFIGPM) ..\global.sym ..\pp.sym ..\makedef.pl create_perllibst_h.pl
+	$(MINIPERL) -I..\lib create_perllibst_h.pl
+	$(MINIPERL) -I..\lib -w ..\makedef.pl PLATFORM=win32 $(OPTIMIZE) $(DEFINES) $(BUILDOPT) \
+	    CCTYPE=$(CCTYPE) > perldll.def
+
+$(PERLDLL): perldll.def $(PERLDLL_OBJ) $(PERLDLL_RES) Extensions_static
+	$(LINK32) -dll -def:perldll.def -base:0x28000000 -out:$@ @Extensions_static @<<
+		$(LINK_FLAGS) $(DELAYLOAD) $(LIBFILES) $(PERLDLL_OBJ) $(PERLDLL_RES)
+<<
+	$(EMBED_DLL_MANI)
+	$(XCOPY) $(PERLIMPLIB) $(COREDIR)
+
+$(PERLSTATICLIB): Extensions_static
+	$(LIB32) $(LIB_FLAGS) -out:$@ @Extensions_static @<<
+		$(PERLDLL_OBJ)
+<<
+	$(XCOPY) $(PERLSTATICLIB) $(COREDIR)
+
+$(PERLEXE_RES): perlexe.rc $(PERLEXE_MANIFEST) $(PERLEXE_ICO)
+
+$(MINIMOD) : $(MINIPERL) ..\minimod.pl
+	cd ..
+	miniperl minimod.pl > lib\ExtUtils\Miniperl.pm
+	cd win32
+
+..\x2p\a2p$(o) : ..\x2p\a2p.c
+	$(CC) -I..\x2p $(CFLAGS) $(OBJOUT_FLAG)$@ -c ..\x2p\a2p.c
+
+..\x2p\hash$(o) : ..\x2p\hash.c
+	$(CC) -I..\x2p  $(CFLAGS) $(OBJOUT_FLAG)$@ -c ..\x2p\hash.c
+
+..\x2p\str$(o) : ..\x2p\str.c
+	$(CC) -I..\x2p  $(CFLAGS) $(OBJOUT_FLAG)$@ -c ..\x2p\str.c
+
+..\x2p\util$(o) : ..\x2p\util.c
+	$(CC) -I..\x2p  $(CFLAGS) $(OBJOUT_FLAG)$@ -c ..\x2p\util.c
+
+..\x2p\walk$(o) : ..\x2p\walk.c
+	$(CC) -I..\x2p  $(CFLAGS) $(OBJOUT_FLAG)$@ -c ..\x2p\walk.c
+
+$(X2P) : $(MINIPERL) $(X2P_OBJ) Extensions
+	$(MINIPERL) -I..\lib ..\x2p\find2perl.PL
+	$(MINIPERL) -I..\lib ..\x2p\s2p.PL
+	$(LINK32) -subsystem:console -out:$@ @<<
+		$(LINK_FLAGS) $(LIBFILES) $(X2P_OBJ)
+<<
+	$(EMBED_EXE_MANI)
+
+$(MINIDIR)\globals$(o) : $(UUDMAP_H) $(BITCOUNT_H)
+
+$(UUDMAP_H) $(BITCOUNT_H) : $(GENUUDMAP)
+	$(GENUUDMAP) $(UUDMAP_H) $(BITCOUNT_H)
+
+$(GENUUDMAP) : $(GENUUDMAP_OBJ)
+	$(LINK32) -subsystem:console -out:$@ @<<
+		$(LINK_FLAGS) $(LIBFILES) $(GENUUDMAP_OBJ)
+<<
+	$(EMBED_EXE_MANI)
+
+perlmain.c : runperl.c
+	copy runperl.c perlmain.c
+
+perlmain$(o) : perlmain.c
+	$(CC) $(CFLAGS_O:-DPERLDLL=-UPERLDLL) $(OBJOUT_FLAG)$@ -c perlmain.c
+
+perlmainst.c : runperl.c
+	copy runperl.c perlmainst.c
+
+perlmainst$(o) : perlmainst.c
+	$(CC) $(CFLAGS_O) $(OBJOUT_FLAG)$@ -c perlmainst.c
+
+$(PERLEXE): $(PERLDLL) $(CONFIGPM) $(PERLEXE_OBJ) $(PERLEXE_RES)
+	$(LINK32) -subsystem:console -out:$@ -stack:0x1000000 $(LINK_FLAGS) \
+	    $(LIBFILES) $(PERLEXE_OBJ) $(SETARGV_OBJ) $(PERLIMPLIB) $(PERLEXE_RES)
+	$(EMBED_EXE_MANI)
+	copy $(PERLEXE) $(WPERLEXE)
+	$(MINIPERL) -I..\lib bin\exetype.pl $(WPERLEXE) WINDOWS
+
+$(PERLEXESTATIC): $(PERLSTATICLIB) $(CONFIGPM) $(PERLEXEST_OBJ) $(PERLEXE_RES)
+	$(LINK32) -subsystem:console -out:$@ -stack:0x1000000 $(LINK_FLAGS) \
+	    @Extensions_static $(PERLSTATICLIB) /PDB:NONE \
+	    $(LIBFILES) $(PERLEXEST_OBJ) $(SETARGV_OBJ) $(PERLEXE_RES)
+	$(EMBED_EXE_MANI)
+
+MakePPPort: $(MINIPERL) $(CONFIGPM) Extensions_nonxs
+	$(MINIPERL) -I..\lib $(ICWD) ..\mkppport
+
+#-------------------------------------------------------------------------------
+# There's no direct way to mark a dependency on
+# DynaLoader.pm, so this will have to do
+Extensions: ..\make_ext.pl $(PERLDEP) $(CONFIGPM) $(DYNALOADER)
+	$(XCOPY) ..\*.h $(COREDIR)\*.*
+	$(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(CPANDIR) --dir=$(DISTDIR) --dir=$(EXTDIR) --dynamic
+
+Extensions_reonly: ..\make_ext.pl $(PERLDEP) $(CONFIGPM) $(DYNALOADER)
+	$(XCOPY) ..\*.h $(COREDIR)\*.*
+	$(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(CPANDIR) --dir=$(DISTDIR) --dir=$(EXTDIR) --dynamic +re
+
+Extensions_static : ..\make_ext.pl list_static_libs.pl $(PERLDEP) $(CONFIGPM)
+	$(XCOPY) ..\*.h $(COREDIR)\*.*
+	$(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(CPANDIR) --dir=$(DISTDIR) --dir=$(EXTDIR) --static
+	$(MINIPERL) -I..\lib list_static_libs.pl > Extensions_static
+
+Extensions_nonxs: ..\make_ext.pl $(PERLDEP) $(CONFIGPM)
+	$(XCOPY) ..\*.h $(COREDIR)\*.*
+	$(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(CPANDIR) --dir=$(DISTDIR) --dir=$(EXTDIR) --nonxs
+
+$(DYNALOADER) : ..\make_ext.pl $(PERLDEP) $(CONFIGPM) Extensions_nonxs
+	$(XCOPY) ..\*.h $(COREDIR)\*.*
+	$(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(EXTDIR) --dynaloader
+
+Extensions_clean: 
+	-if exist $(MINIPERL) $(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(CPANDIR) --dir=$(DISTDIR) --dir=$(EXTDIR) --all --target=clean
+
+Extensions_realclean: 
+	-if exist $(MINIPERL) $(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(CPANDIR) --dir=$(DISTDIR) --dir=$(EXTDIR) --all --target=realclean
+
+#-------------------------------------------------------------------------------
+
+doc: $(PERLEXE) ..\pod\perltoc.pod
+	$(PERLEXE) -I..\lib ..\installhtml --podroot=.. --htmldir=$(HTMLDIR) \
+	    --podpath=pod:lib:ext:utils --htmlroot="file://$(INST_HTML::=|)" \
+	    --libpod=perlfunc:perlguts:perlvar:perlrun:perlop --recurse
+
+# Note that this next section is parsed (and regenerated) by pod/buildtoc
+# so please check that script before making structural changes here
+
+utils: $(PERLEXE) $(X2P)
+	cd ..\utils
+	$(MAKE) PERL=$(MINIPERL)
+	cd ..\pod
+	copy ..\README.aix      ..\pod\perlaix.pod
+	copy ..\README.amiga    ..\pod\perlamiga.pod
+	copy ..\README.apollo   ..\pod\perlapollo.pod
+	copy ..\README.beos     ..\pod\perlbeos.pod
+	copy ..\README.bs2000   ..\pod\perlbs2000.pod
+	copy ..\README.ce       ..\pod\perlce.pod
+	copy ..\README.cn       ..\pod\perlcn.pod
+	copy ..\README.cygwin   ..\pod\perlcygwin.pod
+	copy ..\README.dgux     ..\pod\perldgux.pod
+	copy ..\README.dos      ..\pod\perldos.pod
+	copy ..\README.epoc     ..\pod\perlepoc.pod
+	copy ..\README.freebsd  ..\pod\perlfreebsd.pod
+	copy ..\README.haiku    ..\pod\perlhaiku.pod
+	copy ..\README.hpux     ..\pod\perlhpux.pod
+	copy ..\README.hurd     ..\pod\perlhurd.pod
+	copy ..\README.irix     ..\pod\perlirix.pod
+	copy ..\README.jp       ..\pod\perljp.pod
+	copy ..\README.ko       ..\pod\perlko.pod
+	copy ..\README.linux    ..\pod\perllinux.pod
+	copy ..\README.macos    ..\pod\perlmacos.pod
+	copy ..\README.macosx   ..\pod\perlmacosx.pod
+	copy ..\README.mpeix    ..\pod\perlmpeix.pod
+	copy ..\README.netware  ..\pod\perlnetware.pod
+	copy ..\README.openbsd  ..\pod\perlopenbsd.pod
+	copy ..\README.os2      ..\pod\perlos2.pod
+	copy ..\README.os390    ..\pod\perlos390.pod
+	copy ..\README.os400    ..\pod\perlos400.pod
+	copy ..\README.plan9    ..\pod\perlplan9.pod
+	copy ..\README.qnx      ..\pod\perlqnx.pod
+	copy ..\README.riscos   ..\pod\perlriscos.pod
+	copy ..\README.solaris  ..\pod\perlsolaris.pod
+	copy ..\README.symbian  ..\pod\perlsymbian.pod
+	copy ..\README.tru64    ..\pod\perltru64.pod
+	copy ..\README.tw       ..\pod\perltw.pod
+	copy ..\README.uts      ..\pod\perluts.pod
+	copy ..\README.vmesa    ..\pod\perlvmesa.pod
+	copy ..\README.vos      ..\pod\perlvos.pod
+	copy ..\README.win32    ..\pod\perlwin32.pod
+	copy ..\pod\perl5122delta.pod ..\pod\perldelta.pod
+	$(MAKE) -f ..\win32\pod.mak converters
+	cd ..\win32
+	$(PERLEXE) $(PL2BAT) $(UTILS)
+	$(PERLEXE) $(ICWD) ..\autodoc.pl ..
+	$(PERLEXE) $(ICWD) ..\pod\perlmodlib.pl -q
+
+..\pod\perltoc.pod: $(PERLEXE) Extensions Extensions_nonxs
+	$(PERLEXE) -f ..\pod\buildtoc --build-toc -q
+
+# Note that the pod cleanup in this next section is parsed (and regenerated
+# by pod/buildtoc so please check that script before making changes here
+
+distclean: realclean
+	-del /f $(MINIPERL) $(PERLEXE) $(PERLDLL) $(GLOBEXE) \
+		$(PERLIMPLIB) ..\miniperl.lib $(MINIMOD) \
+		$(PERLEXESTATIC) $(PERLSTATICLIB)
+	-del /f *.def *.map
+	-del /f $(LIBDIR)\Encode.pm $(LIBDIR)\encoding.pm $(LIBDIR)\Errno.pm
+	-del /f $(LIBDIR)\Config.pod $(LIBDIR)\POSIX.pod $(LIBDIR)\threads.pm
+	-del /f $(LIBDIR)\.exists $(LIBDIR)\attributes.pm $(LIBDIR)\DynaLoader.pm
+	-del /f $(LIBDIR)\Fcntl.pm $(LIBDIR)\IO.pm $(LIBDIR)\Opcode.pm
+	-del /f $(LIBDIR)\ops.pm $(LIBDIR)\Safe.pm
+	-del /f $(LIBDIR)\SDBM_File.pm $(LIBDIR)\Socket.pm $(LIBDIR)\POSIX.pm
+	-del /f $(LIBDIR)\B.pm $(LIBDIR)\O.pm $(LIBDIR)\re.pm
+	-del /f $(LIBDIR)\File\Glob.pm
+	-del /f $(LIBDIR)\Storable.pm
+	-del /f $(LIBDIR)\Sys\Hostname.pm
+	-del /f $(LIBDIR)\Time\HiRes.pm
+	-del /f $(LIBDIR)\Unicode\Normalize.pm
+	-del /f $(LIBDIR)\Math\BigInt\FastCalc.pm
+	-del /f $(LIBDIR)\Win32.pm
+	-del /f $(LIBDIR)\Win32CORE.pm
+	-del /f $(LIBDIR)\Win32API\File.pm
+	-del /f $(LIBDIR)\Win32API\File\cFile.pc
+	-del /f $(DISTDIR)\XSLoader\XSLoader.pm
+	-if exist $(LIBDIR)\App rmdir /s /q $(LIBDIR)\App
+	-if exist $(LIBDIR)\Archive rmdir /s /q $(LIBDIR)\Archive
+	-if exist $(LIBDIR)\Attribute rmdir /s /q $(LIBDIR)\Attribute
+	-if exist $(LIBDIR)\autodie rmdir /s /q $(LIBDIR)\autodie
+	-if exist $(LIBDIR)\B rmdir /s /q $(LIBDIR)\B
+	-if exist $(LIBDIR)\CGI rmdir /s /q $(LIBDIR)\CGI
+	-if exist $(LIBDIR)\CPAN rmdir /s /q $(LIBDIR)\CPAN
+	-if exist $(LIBDIR)\CPANPLUS rmdir /s /q $(LIBDIR)\CPANPLUS
+	-if exist $(LIBDIR)\Compress rmdir /s /q $(LIBDIR)\Compress
+	-if exist $(LIBDIR)\Data rmdir /s /q $(LIBDIR)\Data
+	-if exist $(LIBDIR)\Devel rmdir /s /q $(LIBDIR)\Devel
+	-if exist $(LIBDIR)\Digest rmdir /s /q $(LIBDIR)\Digest
+	-if exist $(LIBDIR)\Encode rmdir /s /q $(LIBDIR)\Encode
+	-if exist $(LIBDIR)\encoding rmdir /s /q $(LIBDIR)\encoding
+	-if exist $(LIBDIR)\ExtUtils\CBuilder rmdir /s /q $(LIBDIR)\ExtUtils\CBuilder
+	-if exist $(LIBDIR)\ExtUtils\Command rmdir /s /q $(LIBDIR)\ExtUtils\Command
+	-if exist $(LIBDIR)\ExtUtils\Constant rmdir /s /q $(LIBDIR)\ExtUtils\Constant
+	-if exist $(LIBDIR)\ExtUtils\Liblist rmdir /s /q $(LIBDIR)\ExtUtils\Liblist
+	-if exist $(LIBDIR)\ExtUtils\MakeMaker rmdir /s /q $(LIBDIR)\ExtUtils\MakeMaker
+	-if exist $(LIBDIR)\File\Spec rmdir /s /q $(LIBDIR)\File\Spec
+	-if exist $(LIBDIR)\Filter rmdir /s /q $(LIBDIR)\Filter
+	-if exist $(LIBDIR)\Hash rmdir /s /q $(LIBDIR)\Hash
+	-if exist $(LIBDIR)\I18N\LangTags rmdir /s /q $(LIBDIR)\I18N\LangTags
+	-if exist $(LIBDIR)\inc rmdir /s /q $(LIBDIR)\inc
+	-if exist $(LIBDIR)\Module\Pluggable rmdir /s /q $(LIBDIR)\Module\Pluggable
+	-if exist $(LIBDIR)\IO rmdir /s /q $(LIBDIR)\IO
+	-if exist $(LIBDIR)\IPC rmdir /s /q $(LIBDIR)\IPC
+	-if exist $(LIBDIR)\List rmdir /s /q $(LIBDIR)\List
+	-if exist $(LIBDIR)\Locale rmdir /s /q $(LIBDIR)\Locale
+	-if exist $(LIBDIR)\Log rmdir /s /q $(LIBDIR)\Log
+	-if exist $(LIBDIR)\Math rmdir /s /q $(LIBDIR)\Math
+	-if exist $(LIBDIR)\Memoize rmdir /s /q $(LIBDIR)\Memoize
+	-if exist $(LIBDIR)\MIME rmdir /s /q $(LIBDIR)\MIME
+	-if exist $(LIBDIR)\Module rmdir /s /q $(LIBDIR)\Module
+	-if exist $(LIBDIR)\mro rmdir /s /q $(LIBDIR)\mro
+	-if exist $(LIBDIR)\Net\FTP rmdir /s /q $(LIBDIR)\Net\FTP
+	-if exist $(LIBDIR)\Object rmdir /s /q $(LIBDIR)\Object
+	-if exist $(LIBDIR)\Package rmdir /s /q $(LIBDIR)\Package
+	-if exist $(LIBDIR)\Params rmdir /s /q $(LIBDIR)\Params
+	-if exist $(LIBDIR)\Parse rmdir /s /q $(LIBDIR)\Parse
+	-if exist $(LIBDIR)\PerlIO rmdir /s /q $(LIBDIR)\PerlIO
+	-if exist $(LIBDIR)\Pod\Perldoc rmdir /s /q $(LIBDIR)\Pod\Perldoc
+	-if exist $(LIBDIR)\Pod\Simple rmdir /s /q $(LIBDIR)\Pod\Simple
+	-if exist $(LIBDIR)\Pod\Text rmdir /s /q $(LIBDIR)\Pod\Text
+	-if exist $(LIBDIR)\re rmdir /s /q $(LIBDIR)\re
+	-if exist $(LIBDIR)\Scalar rmdir /s /q $(LIBDIR)\Scalar
+	-if exist $(LIBDIR)\Sys rmdir /s /q $(LIBDIR)\Sys
+	-if exist $(LIBDIR)\TAP rmdir /s /q $(LIBDIR)\TAP
+	-if exist $(LIBDIR)\Term\UI rmdir /s /q $(LIBDIR)\Term\UI
+	-if exist $(LIBDIR)\Test rmdir /s /q $(LIBDIR)\Test
+	-if exist $(LIBDIR)\Thread rmdir /s /q $(LIBDIR)\Thread
+	-if exist $(LIBDIR)\threads rmdir /s /q $(LIBDIR)\threads
+	-if exist $(LIBDIR)\Unicode\Collate rmdir /s /q $(LIBDIR)\Unicode\Collate
+	-if exist $(LIBDIR)\XS rmdir /s /q $(LIBDIR)\XS
+	-if exist $(LIBDIR)\Win32API rmdir /s /q $(LIBDIR)\Win32API
+	-cd $(PODDIR) && del /f *.html *.bat \
+	    perlaix.pod perlamiga.pod perlapi.pod perlapollo.pod \
+	    perlbeos.pod perlbs2000.pod perlce.pod perlcn.pod \
+	    perlcygwin.pod perldelta.pod perldgux.pod perldos.pod \
+	    perlepoc.pod perlfreebsd.pod perlhaiku.pod perlhpux.pod \
+	    perlhurd.pod perlintern.pod perlirix.pod perljp.pod perlko.pod \
+	    perllinux.pod perlmacos.pod perlmacosx.pod perlmodlib.pod \
+	    perlmpeix.pod perlnetware.pod perlopenbsd.pod perlos2.pod \
+	    perlos390.pod perlos400.pod perlplan9.pod perlqnx.pod \
+	    perlriscos.pod perlsolaris.pod perlsymbian.pod perltoc.pod \
+	    perltru64.pod perltw.pod perluniprops.pod perluts.pod \
+	    perlvmesa.pod perlvos.pod perlwin32.pod \
+	    pod2html pod2latex pod2man pod2text pod2usage \
+	    podchecker podselect
+	-cd ..\utils && del /f h2ph splain perlbug pl2pm c2ph pstruct h2xs \
+	    perldoc perlivp dprofpp libnetcfg enc2xs piconv cpan *.bat \
+	    xsubpp instmodsh prove ptar ptardiff cpanp-run-perl cpanp cpan2dist shasum corelist config_data
+	-cd ..\x2p && del /f find2perl s2p psed *.bat
+	-del /f ..\config.sh perlmain.c dlutils.c config.h.new \
+	        perlmainst.c
+	-del /f $(CONFIGPM)
+	-del /f ..\lib\Config_git.pl
+	-del /f bin\*.bat
+	-del /f perllibst.h
+	-del /f $(PERLEXE_RES) perl.base
+	-cd .. && del /s *.lib *.map *.pdb *.ilk *.bs *$(o) .exists pm_to_blib ppport.h
+	-cd $(EXTDIR) && del /s *.def Makefile Makefile.old
+	-cd $(DISTDIR) && del /s *.def Makefile Makefile.old
+	-cd $(CPANDIR) && del /s *.def Makefile Makefile.old
+	-if exist $(AUTODIR) rmdir /s /q $(AUTODIR)
+	-if exist $(COREDIR) rmdir /s /q $(COREDIR)
+	-if exist pod2htmd.tmp del pod2htmd.tmp
+	-if exist pod2htmi.tmp del pod2htmi.tmp
+	-if exist $(HTMLDIR) rmdir /s /q $(HTMLDIR)
+	-del /f ..\t\test_state
+
+install : all installbare installhtml
+
+installbare : utils ..\pod\perltoc.pod
+	$(PERLEXE) ..\installperl
+	if exist $(WPERLEXE) $(XCOPY) $(WPERLEXE) $(INST_BIN)\*.*
+	if exist $(PERLEXESTATIC) $(XCOPY) $(PERLEXESTATIC) $(INST_BIN)\*.*
+	$(XCOPY) $(GLOBEXE) $(INST_BIN)\*.*
+	if exist ..\perl*.pdb $(XCOPY) ..\perl*.pdb $(INST_BIN)\*.*
+	if exist ..\x2p\a2p.pdb $(XCOPY) ..\x2p\a2p.pdb $(INST_BIN)\*.*
+	$(XCOPY) bin\*.bat $(INST_SCRIPT)\*.*
+
+installhtml : doc
+	$(RCOPY) $(HTMLDIR)\*.* $(INST_HTML)\*.*
+
+inst_lib : $(CONFIGPM)
+	$(RCOPY) ..\lib $(INST_LIB)\*.*
+
+$(UNIDATAFILES) ..\pod\perluniprops.pod : $(MINIPERL) $(CONFIGPM) ..\lib\unicore\mktables Extensions_nonxs
+	cd ..\lib\unicore && \
+	..\$(MINIPERL) -I.. -I..\..\cpan\Cwd\lib -I..\..\cpan\Cwd mktables -P ..\..\pod -maketest -makelist -p -check $@ $(FIRSTUNIFILE)
+
+minitest : $(MINIPERL) $(GLOBEXE) $(CONFIGPM) utils $(UNIDATAFILES)
+	$(XCOPY) $(MINIPERL) ..\t\$(NULL)
+	if exist ..\t\perl.exe del /f ..\t\perl.exe
+	rename ..\t\miniperl.exe perl.exe
+	$(XCOPY) $(GLOBEXE) ..\t\$(NULL)
+	attrib -r ..\t\*.*
+	cd ..\t && \
+	$(MINIPERL) -I..\lib harness base/*.t comp/*.t cmd/*.t io/*.t op/*.t pragma/*.t
+
+test-prep : all utils
+	$(XCOPY) $(PERLEXE) ..\t\$(NULL)
+	$(XCOPY) $(PERLDLL) ..\t\$(NULL)
+	$(XCOPY) $(GLOBEXE) ..\t\$(NULL)
+
+test : test-prep
+	cd ..\t
+	$(PERLEXE) -I..\lib harness $(TEST_SWITCHES) $(TEST_FILES)
+	cd ..\win32
+
+test-reonly : reonly utils
+	$(XCOPY) $(PERLEXE) ..\t\$(NULL)
+	$(XCOPY) $(PERLDLL) ..\t\$(NULL)
+	$(XCOPY) $(GLOBEXE) ..\t\$(NULL)
+	cd ..\t
+	$(PERLEXE) -I..\lib harness $(OPT) -re \bre\\/ $(EXTRA)
+	cd ..\win32
+
+regen :
+	cd ..
+	regen.pl
+	cd win32
+
+test-notty : test-prep
+	set PERL_SKIP_TTY_TEST=1
+	cd ..\t
+	$(PERLEXE) -I..\lib harness $(TEST_SWITCHES) $(TEST_FILES)
+	cd ..\win32
+
+_test : 
+       $(XCOPY) $(PERLEXE) ..\t\$(NULL)
+       $(XCOPY) $(PERLDLL) ..\t\$(NULL)
+       $(XCOPY) $(GLOBEXE) ..\t\$(NULL)
+       cd ..\t
+       $(PERLEXE) -I..\lib harness $(TEST_SWITCHES) $(TEST_FILES)
+       cd ..\win32
+
+_clean :
+	-@$(DEL) miniperlmain$(o)
+	-@$(DEL) $(MINIPERL)
+	-@$(DEL) perlglob$(o)
+	-@$(DEL) perlmain$(o)
+	-@$(DEL) perlmainst$(o)
+	-@$(DEL) config.w32
+	-@$(DEL) config.h
+	-@$(DEL) ..\git_version.h
+	-@$(DEL) $(GLOBEXE)
+	-@$(DEL) $(PERLEXE)
+	-@$(DEL) $(WPERLEXE)
+	-@$(DEL) $(PERLEXESTATIC)
+	-@$(DEL) $(PERLSTATICLIB)
+	-@$(DEL) $(PERLDLL)
+	-@$(DEL) $(CORE_OBJ)
+	-@$(DEL) $(GENUUDMAP) $(GENUUDMAP_OBJ) $(UUDMAP_H) $(BITCOUNT_H)
+	-if exist $(MINIDIR) rmdir /s /q $(MINIDIR)
+	-if exist $(UNIDATADIR1) rmdir /s /q $(UNIDATADIR1)
+	-if exist $(UNIDATADIR2) rmdir /s /q $(UNIDATADIR2)
+	-@$(DEL) $(UNIDATAFILES)
+	-@$(DEL) $(WIN32_OBJ)
+	-@$(DEL) $(DLL_OBJ)
+	-@$(DEL) $(X2P_OBJ)
+	-@$(DEL) ..\*$(o) ..\*.lib ..\*.exp *$(o) *.lib *.exp *.res
+	-@$(DEL) ..\t\*.exe ..\t\*.dll ..\t\*.bat
+	-@$(DEL) ..\x2p\*.exe ..\x2p\*.bat
+	-@$(DEL) *.ilk
+	-@$(DEL) *.pdb
+	-@$(DEL) Extensions_static
+
+clean : Extensions_clean _clean
+
+realclean : Extensions_realclean _clean
+
+# Handy way to run perlbug -ok without having to install and run the
+# installed perlbug. We don't re-run the tests here - we trust the user.
+# Please *don't* use this unless all tests pass.
+# If you want to report test failures, use "nmake nok" instead.
+ok: utils
+	$(PERLEXE) -I..\lib ..\utils\perlbug -ok -s "(UNINSTALLED)"
+
+okfile: utils
+	$(PERLEXE) -I..\lib ..\utils\perlbug -ok -s "(UNINSTALLED)" -F perl.ok
+
+nok: utils
+	$(PERLEXE) -I..\lib ..\utils\perlbug -nok -s "(UNINSTALLED)"
+
+nokfile: utils
+	$(PERLEXE) -I..\lib ..\utils\perlbug -nok -s "(UNINSTALLED)" -F perl.nok
Index: src/gnu/usr.bin/perl/win32/config.bc
diff -u src/gnu/usr.bin/perl/win32/config.bc:1.11 src/gnu/usr.bin/perl/win32/config.bc:1.12
--- win32/config.bc:1.11	Mon Oct 12 18:30:28 2009
+++ win32/config.bc	Fri Sep 24 15:07:10 2010
@@ -51,6 +51,7 @@
 cf_by='nobody'
 cf_email='nobody@no.where.net'
 cf_time=''
+charbits='8'
 chgrp=''
 chmod=''
 chown=''
@@ -534,7 +535,7 @@
 drand01='(rand()/(double)((unsigned)1<<RANDBITS))'
 drand48_r_proto='0'
 dtrace=''
-dynamic_ext='Socket IO Fcntl Opcode SDBM_File attrs'
+dynamic_ext='Socket IO Fcntl Opcode SDBM_File attributes'
 eagain='EAGAIN'
 ebcdic='undef'
 echo='echo'
@@ -1037,6 +1038,7 @@
 uvtype='unsigned long'
 uvuformat='"lu"'
 uvxformat='"lx"'
+vaproto='undef'
 vendorarch=''
 vendorarchexp=''
 vendorbin=''
Index: src/gnu/usr.bin/perl/win32/config.vc
diff -u src/gnu/usr.bin/perl/win32/config.vc:1.11 src/gnu/usr.bin/perl/win32/config.vc:1.12
--- win32/config.vc:1.11	Mon Oct 12 18:30:28 2009
+++ win32/config.vc	Fri Sep 24 15:07:10 2010
@@ -51,6 +51,7 @@
 cf_by='nobody'
 cf_email='nobody@no.where.net'
 cf_time=''
+charbits='8'
 chgrp=''
 chmod=''
 chown=''
@@ -534,7 +535,7 @@
 drand01='(rand()/(double)((unsigned)1<<RANDBITS))'
 drand48_r_proto='0'
 dtrace=''
-dynamic_ext='Socket IO Fcntl Opcode SDBM_File attrs'
+dynamic_ext='Socket IO Fcntl Opcode SDBM_File attributes'
 eagain='EAGAIN'
 ebcdic='undef'
 echo='echo'
@@ -1037,6 +1038,7 @@
 uvtype='unsigned long'
 uvuformat='"lu"'
 uvxformat='"lx"'
+vaproto='undef'
 vendorarch=''
 vendorarchexp=''
 vendorbin=''
Index: src/gnu/usr.bin/perl/win32/config_H.bc
diff -u src/gnu/usr.bin/perl/win32/config_H.bc:1.12 src/gnu/usr.bin/perl/win32/config_H.bc:1.13
--- win32/config_H.bc:1.12	Mon Oct 12 18:30:28 2009
+++ win32/config_H.bc	Fri Sep 24 15:07:10 2010
@@ -13,8 +13,8 @@
 /*
  * Package name      : perl5
  * Source directory  : 
- * Configuration time: Fri Dec 12 15:47:15 2008
- * Configured by     : shay
+ * Configuration time: Mon Jan 11 00:09:46 2010
+ * Configured by     : Steve
  * Target system     : 
  */
 
@@ -36,31 +36,31 @@
  *	This symbol is defined if the bcmp() routine is available to
  *	compare blocks of memory.
  */
-/*#define HAS_BCMP	/**/
+/*#define HAS_BCMP	/ **/
 
 /* HAS_BCOPY:
  *	This symbol is defined if the bcopy() routine is available to
  *	copy blocks of memory.
  */
-/*#define HAS_BCOPY	/**/
+/*#define HAS_BCOPY	/ **/
 
 /* HAS_BZERO:
  *	This symbol is defined if the bzero() routine is available to
  *	set a memory block to 0.
  */
-/*#define HAS_BZERO	/**/
+/*#define HAS_BZERO	/ **/
 
 /* HAS_CHOWN:
  *	This symbol, if defined, indicates that the chown routine is
  *	available.
  */
-/*#define HAS_CHOWN		/**/
+/*#define HAS_CHOWN		/ **/
 
 /* HAS_CHROOT:
  *	This symbol, if defined, indicates that the chroot routine is
  *	available.
  */
-/*#define HAS_CHROOT		/**/
+/*#define HAS_CHROOT		/ **/
 
 /* HAS_CHSIZE:
  *	This symbol, if defined, indicates that the chsize routine is available
@@ -72,19 +72,19 @@
  *	This symbol, if defined, indicates that the crypt routine is available
  *	to encrypt passwords and the like.
  */
-/*#define HAS_CRYPT		/**/
+/*#define HAS_CRYPT		/ **/
 
 /* HAS_CTERMID:
  *	This symbol, if defined, indicates that the ctermid routine is
  *	available to generate filename for terminal.
  */
-/*#define HAS_CTERMID		/**/
+/*#define HAS_CTERMID		/ **/
 
 /* HAS_CUSERID:
  *	This symbol, if defined, indicates that the cuserid routine is
  *	available to get character login names.
  */
-/*#define HAS_CUSERID		/**/
+/*#define HAS_CUSERID		/ **/
 
 /* HAS_DBL_DIG:
  *	This symbol, if defined, indicates that this system's <float.h>
@@ -107,26 +107,6 @@
  */
 #define HAS_DLERROR	/**/
 
-/* SETUID_SCRIPTS_ARE_SECURE_NOW:
- *	This symbol, if defined, indicates that the bug that prevents
- *	setuid scripts from being secure is not present in this kernel.
- */
-/* DOSUID:
- *	This symbol, if defined, indicates that the C program should
- *	check the script that it is executing for setuid/setgid bits, and
- *	attempt to emulate setuid/setgid on systems that have disabled
- *	setuid #! scripts because the kernel can't do it securely.
- *	It is up to the package designer to make sure that this emulation
- *	is done securely.  Among other things, it should do an fstat on
- *	the script it just opened to make sure it really is a setuid/setgid
- *	script, it should make sure the arguments passed correspond exactly
- *	to the argument on the #! line, and it should not trust any
- *	subprocesses to which it must pass the filename rather than the
- *	file descriptor of the script to be executed.
- */
-/*#define SETUID_SCRIPTS_ARE_SECURE_NOW	/**/
-/*#define DOSUID		/**/
-
 /* HAS_DUP2:
  *	This symbol, if defined, indicates that the dup2 routine is
  *	available to duplicate file descriptors.
@@ -137,19 +117,19 @@
  *	This symbol, if defined, indicates that the fchmod routine is available
  *	to change mode of opened files.  If unavailable, use chmod().
  */
-/*#define HAS_FCHMOD		/**/
+/*#define HAS_FCHMOD		/ **/
 
 /* HAS_FCHOWN:
  *	This symbol, if defined, indicates that the fchown routine is available
  *	to change ownership of opened files.  If unavailable, use chown().
  */
-/*#define HAS_FCHOWN		/**/
+/*#define HAS_FCHOWN		/ **/
 
 /* HAS_FCNTL:
  *	This symbol, if defined, indicates to the C program that
  *	the fcntl() function exists.
  */
-/*#define HAS_FCNTL		/**/
+/*#define HAS_FCNTL		/ **/
 
 /* HAS_FGETPOS:
  *	This symbol, if defined, indicates that the fgetpos routine is
@@ -167,7 +147,7 @@
  *	This symbol, if defined, indicates that the fork routine is
  *	available.
  */
-/*#define HAS_FORK		/**/
+/*#define HAS_FORK		/ **/
 
 /* HAS_FSETPOS:
  *	This symbol, if defined, indicates that the fsetpos routine is
@@ -191,7 +171,7 @@
  *	available to get the list of process groups.  If unavailable, multiple
  *	groups are probably not supported.
  */
-/*#define HAS_GETGROUPS		/**/
+/*#define HAS_GETGROUPS		/ **/
 
 /* HAS_GETLOGIN:
  *	This symbol, if defined, indicates that the getlogin routine is
@@ -204,32 +184,32 @@
  *	the getpgid(pid) function is available to get the
  *	process group id.
  */
-/*#define HAS_GETPGID		/**/
+/*#define HAS_GETPGID		/ **/
 
 /* HAS_GETPGRP2:
  *	This symbol, if defined, indicates that the getpgrp2() (as in DG/UX)
  *	routine is available to get the current process group.
  */
-/*#define HAS_GETPGRP2		/**/
+/*#define HAS_GETPGRP2		/ **/
 
 /* HAS_GETPPID:
  *	This symbol, if defined, indicates that the getppid routine is
  *	available to get the parent process ID.
  */
-/*#define HAS_GETPPID		/**/
+/*#define HAS_GETPPID		/ **/
 
 /* HAS_GETPRIORITY:
  *	This symbol, if defined, indicates that the getpriority routine is
  *	available to get a process's priority.
  */
-/*#define HAS_GETPRIORITY		/**/
+/*#define HAS_GETPRIORITY		/ **/
 
 /* HAS_INET_ATON:
  *	This symbol, if defined, indicates to the C program that the
  *	inet_aton() function is available to parse IP address "dotted-quad"
  *	strings.
  */
-/*#define HAS_INET_ATON		/**/
+/*#define HAS_INET_ATON		/ **/
 
 /* HAS_KILLPG:
  *	This symbol, if defined, indicates that the killpg routine is available
@@ -254,13 +234,13 @@
  *	This symbol, if defined, indicates that the lockf routine is
  *	available to do file locking.
  */
-/*#define HAS_LOCKF		/**/
+/*#define HAS_LOCKF		/ **/
 
 /* HAS_LSTAT:
  *	This symbol, if defined, indicates that the lstat routine is
  *	available to do file stats on symbolic links.
  */
-/*#define HAS_LSTAT		/**/
+/*#define HAS_LSTAT		/ **/
 
 /* HAS_MBLEN:
  *	This symbol, if defined, indicates that the mblen routine is available
@@ -319,7 +299,7 @@
  *	do it for you. However, if mkfifo is there, mknod might require
  *	super-user privileges which mkfifo will not.
  */
-/*#define HAS_MKFIFO		/**/
+/*#define HAS_MKFIFO		/ **/
 
 /* HAS_MKTIME:
  *	This symbol, if defined, indicates that the mktime routine is
@@ -331,19 +311,19 @@
  *	This symbol, if defined, indicates that the msync system call is
  *	available to synchronize a mapped file.
  */
-/*#define HAS_MSYNC		/**/
+/*#define HAS_MSYNC		/ **/
 
 /* HAS_MUNMAP:
  *	This symbol, if defined, indicates that the munmap system call is
  *	available to unmap a region, usually mapped by mmap().
  */
-/*#define HAS_MUNMAP		/**/
+/*#define HAS_MUNMAP		/ **/
 
 /* HAS_NICE:
  *	This symbol, if defined, indicates that the nice routine is
  *	available.
  */
-/*#define HAS_NICE		/**/
+/*#define HAS_NICE		/ **/
 
 /* HAS_PATHCONF:
  *	This symbol, if defined, indicates that pathconf() is available
@@ -355,8 +335,8 @@
  *	to determine file-system related limits and options associated
  *	with a given open file descriptor.
  */
-/*#define HAS_PATHCONF		/**/
-/*#define HAS_FPATHCONF		/**/
+/*#define HAS_PATHCONF		/ **/
+/*#define HAS_FPATHCONF		/ **/
 
 /* HAS_PAUSE:
  *	This symbol, if defined, indicates that the pause routine is
@@ -375,7 +355,7 @@
  *	available to poll active file descriptors.  Please check I_POLL and
  *	I_SYS_POLL to know which header should be included as well.
  */
-/*#define HAS_POLL		/**/
+/*#define HAS_POLL		/ **/
 
 /* HAS_READDIR:
  *	This symbol, if defined, indicates that the readdir routine is
@@ -406,7 +386,7 @@
  *	This symbol, if defined, indicates that the readlink routine is
  *	available to read the value of a symbolic link.
  */
-/*#define HAS_READLINK		/**/
+/*#define HAS_READLINK		/ **/
 
 /* HAS_RENAME:
  *	This symbol, if defined, indicates that the rename routine is available
@@ -433,27 +413,27 @@
  *	This symbol, if defined, indicates that the setegid routine is available
  *	to change the effective gid of the current program.
  */
-/*#define HAS_SETEGID		/**/
+/*#define HAS_SETEGID		/ **/
 
 /* HAS_SETEUID:
  *	This symbol, if defined, indicates that the seteuid routine is available
  *	to change the effective uid of the current program.
  */
-/*#define HAS_SETEUID		/**/
+/*#define HAS_SETEUID		/ **/
 
 /* HAS_SETGROUPS:
  *	This symbol, if defined, indicates that the setgroups() routine is
  *	available to set the list of process groups.  If unavailable, multiple
  *	groups are probably not supported.
  */
-/*#define HAS_SETGROUPS		/**/
+/*#define HAS_SETGROUPS		/ **/
 
 /* HAS_SETLINEBUF:
  *	This symbol, if defined, indicates that the setlinebuf routine is
  *	available to change stderr or stdout from block-buffered or unbuffered
  *	to a line-buffered mode.
  */
-/*#define HAS_SETLINEBUF		/**/
+/*#define HAS_SETLINEBUF		/ **/
 
 /* HAS_SETLOCALE:
  *	This symbol, if defined, indicates that the setlocale routine is
@@ -465,19 +445,19 @@
  *	This symbol, if defined, indicates that the setpgid(pid, gpid)
  *	routine is available to set process group ID.
  */
-/*#define HAS_SETPGID	/**/
+/*#define HAS_SETPGID	/ **/
 
 /* HAS_SETPGRP2:
  *	This symbol, if defined, indicates that the setpgrp2() (as in DG/UX)
  *	routine is available to set the current process group.
  */
-/*#define HAS_SETPGRP2		/**/
+/*#define HAS_SETPGRP2		/ **/
 
 /* HAS_SETPRIORITY:
  *	This symbol, if defined, indicates that the setpriority routine is
  *	available to set a process's priority.
  */
-/*#define HAS_SETPRIORITY		/**/
+/*#define HAS_SETPRIORITY		/ **/
 
 /* HAS_SETREGID:
  *	This symbol, if defined, indicates that the setregid routine is
@@ -489,8 +469,8 @@
  *	available to change the real, effective and saved gid of the current
  *	process.
  */
-/*#define HAS_SETREGID		/**/
-/*#define HAS_SETRESGID		/**/
+/*#define HAS_SETREGID		/ **/
+/*#define HAS_SETRESGID		/ **/
 
 /* HAS_SETREUID:
  *	This symbol, if defined, indicates that the setreuid routine is
@@ -502,26 +482,26 @@
  *	available to change the real, effective and saved uid of the current
  *	process.
  */
-/*#define HAS_SETREUID		/**/
-/*#define HAS_SETRESUID		/**/
+/*#define HAS_SETREUID		/ **/
+/*#define HAS_SETRESUID		/ **/
 
 /* HAS_SETRGID:
  *	This symbol, if defined, indicates that the setrgid routine is available
  *	to change the real gid of the current program.
  */
-/*#define HAS_SETRGID		/**/
+/*#define HAS_SETRGID		/ **/
 
 /* HAS_SETRUID:
  *	This symbol, if defined, indicates that the setruid routine is available
  *	to change the real uid of the current program.
  */
-/*#define HAS_SETRUID		/**/
+/*#define HAS_SETRUID		/ **/
 
 /* HAS_SETSID:
  *	This symbol, if defined, indicates that the setsid routine is
  *	available to set the process group ID.
  */
-/*#define HAS_SETSID	/**/
+/*#define HAS_SETSID	/ **/
 
 /* HAS_STRCHR:
  *	This symbol is defined to indicate that the strchr()/strrchr()
@@ -533,7 +513,7 @@
  *	functions are available for string searching.
  */
 #define HAS_STRCHR	/**/
-/*#define HAS_INDEX	/**/
+/*#define HAS_INDEX	/ **/
 
 /* HAS_STRCOLL:
  *	This symbol, if defined, indicates that the strcoll routine is
@@ -563,19 +543,19 @@
  *	This symbol, if defined, indicates that the symlink routine is available
  *	to create symbolic links.
  */
-/*#define HAS_SYMLINK	/**/
+/*#define HAS_SYMLINK	/ **/
 
 /* HAS_SYSCALL:
  *	This symbol, if defined, indicates that the syscall routine is
  *	available to call arbitrary system calls. If undefined, that's tough.
  */
-/*#define HAS_SYSCALL	/**/
+/*#define HAS_SYSCALL	/ **/
 
 /* HAS_SYSCONF:
  *	This symbol, if defined, indicates that sysconf() is available
  *	to determine system related limits and options.
  */
-/*#define HAS_SYSCONF	/**/
+/*#define HAS_SYSCONF	/ **/
 
 /* HAS_SYSTEM:
  *	This symbol, if defined, indicates that the system routine is
@@ -587,19 +567,19 @@
  *	This symbol, if defined, indicates that the tcgetpgrp routine is
  *	available to get foreground process group ID.
  */
-/*#define HAS_TCGETPGRP		/**/
+/*#define HAS_TCGETPGRP		/ **/
 
 /* HAS_TCSETPGRP:
  *	This symbol, if defined, indicates that the tcsetpgrp routine is
  *	available to set foreground process group ID.
  */
-/*#define HAS_TCSETPGRP		/**/
+/*#define HAS_TCSETPGRP		/ **/
 
 /* HAS_TRUNCATE:
  *	This symbol, if defined, indicates that the truncate routine is
  *	available to truncate files.
  */
-/*#define HAS_TRUNCATE	/**/
+/*#define HAS_TRUNCATE	/ **/
 
 /* HAS_TZNAME:
  *	This symbol, if defined, indicates that the tzname[] array is
@@ -617,12 +597,12 @@
  *	This symbol, if defined, indicates that the usleep routine is
  *	available to let the process sleep on a sub-second accuracy.
  */
-/*#define HAS_USLEEP		/**/
+/*#define HAS_USLEEP		/ **/
 
 /* HAS_WAIT4:
  *	This symbol, if defined, indicates that wait4() exists.
  */
-/*#define HAS_WAIT4	/**/
+/*#define HAS_WAIT4	/ **/
 
 /* HAS_WAITPID:
  *	This symbol, if defined, indicates that the waitpid routine is
@@ -669,7 +649,7 @@
  *	This symbol, if defined, indicates that <rpcsvc/dbm.h> exists and
  *	should be included.
  */
-/*#define I_DBM	/**/
+/*#define I_DBM	/ **/
 #define I_RPCSVC_DBM	/**/
 
 /* I_DLFCN:
@@ -694,7 +674,7 @@
  *	This symbol, if defined, indicates that <gdbm.h> exists and should
  *	be included.
  */
-/*#define I_GDBM	/**/
+/*#define I_GDBM	/ **/
 
 /* I_LIMITS:
  *	This symbol, if defined, indicates to the C program that it should
@@ -719,19 +699,19 @@
  *	This symbol, if defined, indicates to the C program that it should
  *	include <memory.h>.
  */
-/*#define I_MEMORY		/**/
+/*#define I_MEMORY		/ **/
 
 /* I_NETINET_IN:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <netinet/in.h>. Otherwise, you may try <sys/in.h>.
  */
-/*#define I_NETINET_IN	/**/
+/*#define I_NETINET_IN	/ **/
 
 /* I_SFIO:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sfio.h>.
  */
-/*#define	I_SFIO		/**/
+/*#define	I_SFIO		/ **/
 
 /* I_STDDEF:
  *	This symbol, if defined, indicates that <stddef.h> exists and should
@@ -755,13 +735,13 @@
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/dir.h>.
  */
-/*#define I_SYS_DIR		/**/
+/*#define I_SYS_DIR		/ **/
 
 /* I_SYS_FILE:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/file.h> to get definition of R_OK and friends.
  */
-/*#define I_SYS_FILE		/**/
+/*#define I_SYS_FILE		/ **/
 
 /* I_SYS_IOCTL:
  *	This symbol, if defined, indicates that <sys/ioctl.h> exists and should
@@ -771,39 +751,39 @@
  *	This symbol, if defined, indicates the <sys/sockio.h> should be included
  *	to get socket ioctl options, like SIOCATMARK.
  */
-/*#define	I_SYS_IOCTL		/**/
-/*#define I_SYS_SOCKIO	/**/
+/*#define	I_SYS_IOCTL		/ **/
+/*#define I_SYS_SOCKIO	/ **/
 
 /* I_SYS_NDIR:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/ndir.h>.
  */
-/*#define I_SYS_NDIR	/**/
+/*#define I_SYS_NDIR	/ **/
 
 /* I_SYS_PARAM:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/param.h>.
  */
-/*#define I_SYS_PARAM		/**/
+/*#define I_SYS_PARAM		/ **/
 
 /* I_SYS_POLL:
  *	This symbol, if defined, indicates that the program may include
  *	<sys/poll.h>.  When I_POLL is also defined, it's probably safest
  *	to only include <poll.h>.
  */
-/*#define I_SYS_POLL	/**/
+/*#define I_SYS_POLL	/ **/
 
 /* I_SYS_RESOURCE:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/resource.h>.
  */
-/*#define I_SYS_RESOURCE		/**/
+/*#define I_SYS_RESOURCE		/ **/
 
 /* I_SYS_SELECT:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/select.h> in order to get definition of struct timeval.
  */
-/*#define I_SYS_SELECT	/**/
+/*#define I_SYS_SELECT	/ **/
 
 /* I_SYS_STAT:
  *	This symbol, if defined, indicates to the C program that it should
@@ -815,7 +795,7 @@
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/times.h>.
  */
-/*#define	I_SYS_TIMES		/**/
+/*#define	I_SYS_TIMES		/ **/
 
 /* I_SYS_TYPES:
  *	This symbol, if defined, indicates to the C program that it should
@@ -827,13 +807,13 @@
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/un.h> to get UNIX domain socket definitions.
  */
-/*#define I_SYS_UN		/**/
+/*#define I_SYS_UN		/ **/
 
 /* I_SYS_WAIT:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/wait.h>.
  */
-/*#define I_SYS_WAIT	/**/
+/*#define I_SYS_WAIT	/ **/
 
 /* I_TERMIO:
  *	This symbol, if defined, indicates that the program should include
@@ -851,15 +831,15 @@
  *	<sgtty.h> rather than <termio.h>.  There are also differences in
  *	the ioctl() calls that depend on the value of this symbol.
  */
-/*#define I_TERMIO		/**/
-/*#define I_TERMIOS		/**/
-/*#define I_SGTTY		/**/
+/*#define I_TERMIO		/ **/
+/*#define I_TERMIOS		/ **/
+/*#define I_SGTTY		/ **/
 
 /* I_UNISTD:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <unistd.h>.
  */
-/*#define I_UNISTD		/**/
+/*#define I_UNISTD		/ **/
 
 /* I_UTIME:
  *	This symbol, if defined, indicates to the C program that it should
@@ -873,13 +853,35 @@
  *	MAXLONG, i.e. machine dependant limitations.  Probably, you
  *	should use <limits.h> instead, if it is available.
  */
-/*#define I_VALUES		/**/
+/*#define I_VALUES		/ **/
 
 /* I_VFORK:
  *	This symbol, if defined, indicates to the C program that it should
  *	include vfork.h.
  */
-/*#define I_VFORK	/**/
+/*#define I_VFORK	/ **/
+
+/* CAN_VAPROTO:
+ *	This variable is defined on systems supporting prototype declaration
+ *	of functions with a variable number of arguments.
+ */
+/* _V:
+ *	This macro is used to declare function parameters in prototypes for
+ *	functions with a variable number of parameters. Use double parentheses.
+ *	For example:
+ *
+ *		int printf _V((char *fmt, ...));
+ *
+ *	Remember to use the plain simple _() macro when declaring a function
+ *	with no variable number of arguments, since it might be possible to
+ *	have a non-effect _V() macro and still get prototypes via _().
+ */
+/*#define CAN_VAPROTO	/ **/
+#ifdef CAN_VAPROTO
+#define	_V(args) args
+#else
+#define	_V(args) ()
+#endif
 
 /* INTSIZE:
  *	This symbol contains the value of sizeof(int) so that the C
@@ -904,7 +906,7 @@
  *	example with the NeXT "fat" binaries that contain executables
  *	for several CPUs.
  */
-/*#define MULTIARCH		/**/
+/*#define MULTIARCH		/ **/
 
 /* HAS_QUAD:
  *	This symbol, if defined, tells that there's a 64-bit integer type,
@@ -951,7 +953,7 @@
  *	in programs that are not prepared to deal with ~ expansion at run-time.
  */
 #define ARCHLIB "c:\\perl\\lib"		/**/
-/*#define ARCHLIB_EXP ""	/**/
+/*#define ARCHLIB_EXP ""	/ **/
 
 /* ARCHNAME:
  *	This symbol holds a string representing the architecture name.
@@ -1039,7 +1041,7 @@
  *	This symbol, if defined, indicates that the accessx routine is
  *	available to do extended access checks.
  */
-/*#define HAS_ACCESSX		/**/
+/*#define HAS_ACCESSX		/ **/
 
 /* HAS_ASCTIME_R:
  *	This symbol, if defined, indicates that the asctime_r routine
@@ -1051,7 +1053,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_asctime_r
  *	is defined.
  */
-/*#define HAS_ASCTIME_R	   /**/
+/*#define HAS_ASCTIME_R	   / **/
 #define ASCTIME_R_PROTO 0	   /**/
 
 /* HASATTRIBUTE_FORMAT:
@@ -1081,15 +1083,15 @@
 /* HASATTRIBUTE_WARN_UNUSED_RESULT:
  *	Can we handle GCC attribute for warning on unused results
  */
-/*#define HASATTRIBUTE_DEPRECATED	/**/
-/*#define HASATTRIBUTE_FORMAT	/**/
-/*#define PRINTF_FORMAT_NULL_OK	/**/
-/*#define HASATTRIBUTE_NORETURN	/**/
-/*#define HASATTRIBUTE_MALLOC	/**/
-/*#define HASATTRIBUTE_NONNULL	/**/
-/*#define HASATTRIBUTE_PURE	/**/
-/*#define HASATTRIBUTE_UNUSED	/**/
-/*#define HASATTRIBUTE_WARN_UNUSED_RESULT	/**/
+/*#define HASATTRIBUTE_DEPRECATED	/ **/
+/*#define HASATTRIBUTE_FORMAT	/ **/
+/*#define PRINTF_FORMAT_NULL_OK	/ **/
+/*#define HASATTRIBUTE_NORETURN	/ **/
+/*#define HASATTRIBUTE_MALLOC	/ **/
+/*#define HASATTRIBUTE_NONNULL	/ **/
+/*#define HASATTRIBUTE_PURE	/ **/
+/*#define HASATTRIBUTE_UNUSED	/ **/
+/*#define HASATTRIBUTE_WARN_UNUSED_RESULT	/ **/
 
 /* HASCONST:
  *	This symbol, if defined, indicates that this C compiler knows about
@@ -1112,7 +1114,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_crypt_r
  *	is defined.
  */
-/*#define HAS_CRYPT_R	   /**/
+/*#define HAS_CRYPT_R	   / **/
 #define CRYPT_R_PROTO 0	   /**/
 
 /* HAS_CSH:
@@ -1121,7 +1123,7 @@
 /* CSH:
  *	This symbol, if defined, contains the full pathname of csh.
  */
-/*#define HAS_CSH		/**/
+/*#define HAS_CSH		/ **/
 #ifdef HAS_CSH
 #define CSH ""	/**/
 #endif
@@ -1136,7 +1138,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_ctermid_r
  *	is defined.
  */
-/*#define HAS_CTERMID_R	   /**/
+/*#define HAS_CTERMID_R	   / **/
 #define CTERMID_R_PROTO 0	   /**/
 
 /* HAS_CTIME_R:
@@ -1149,7 +1151,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_ctime_r
  *	is defined.
  */
-/*#define HAS_CTIME_R	   /**/
+/*#define HAS_CTIME_R	   / **/
 #define CTIME_R_PROTO 0	   /**/
 
 /* HAS_DRAND48_R:
@@ -1162,7 +1164,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_drand48_r
  *	is defined.
  */
-/*#define HAS_DRAND48_R	   /**/
+/*#define HAS_DRAND48_R	   / **/
 #define DRAND48_R_PROTO 0	   /**/
 
 /* HAS_DRAND48_PROTO:
@@ -1171,19 +1173,19 @@
  *	to the program to supply one.  A good guess is
  *		extern double drand48(void);
  */
-/*#define	HAS_DRAND48_PROTO	/**/
+/*#define	HAS_DRAND48_PROTO	/ **/
 
 /* HAS_EACCESS:
  *	This symbol, if defined, indicates that the eaccess routine is
  *	available to do extended access checks.
  */
-/*#define HAS_EACCESS		/**/
+/*#define HAS_EACCESS		/ **/
 
 /* HAS_ENDGRENT:
  *	This symbol, if defined, indicates that the getgrent routine is
  *	available for finalizing sequential access of the group database.
  */
-/*#define HAS_ENDGRENT		/**/
+/*#define HAS_ENDGRENT		/ **/
 
 /* HAS_ENDGRENT_R:
  *	This symbol, if defined, indicates that the endgrent_r routine
@@ -1195,14 +1197,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_endgrent_r
  *	is defined.
  */
-/*#define HAS_ENDGRENT_R	   /**/
+/*#define HAS_ENDGRENT_R	   / **/
 #define ENDGRENT_R_PROTO 0	   /**/
 
 /* HAS_ENDHOSTENT:
  *	This symbol, if defined, indicates that the endhostent() routine is
  *	available to close whatever was being used for host queries.
  */
-/*#define HAS_ENDHOSTENT		/**/
+/*#define HAS_ENDHOSTENT		/ **/
 
 /* HAS_ENDHOSTENT_R:
  *	This symbol, if defined, indicates that the endhostent_r routine
@@ -1214,14 +1216,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_endhostent_r
  *	is defined.
  */
-/*#define HAS_ENDHOSTENT_R	   /**/
+/*#define HAS_ENDHOSTENT_R	   / **/
 #define ENDHOSTENT_R_PROTO 0	   /**/
 
 /* HAS_ENDNETENT:
  *	This symbol, if defined, indicates that the endnetent() routine is
  *	available to close whatever was being used for network queries.
  */
-/*#define HAS_ENDNETENT		/**/
+/*#define HAS_ENDNETENT		/ **/
 
 /* HAS_ENDNETENT_R:
  *	This symbol, if defined, indicates that the endnetent_r routine
@@ -1233,14 +1235,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_endnetent_r
  *	is defined.
  */
-/*#define HAS_ENDNETENT_R	   /**/
+/*#define HAS_ENDNETENT_R	   / **/
 #define ENDNETENT_R_PROTO 0	   /**/
 
 /* HAS_ENDPROTOENT:
  *	This symbol, if defined, indicates that the endprotoent() routine is
  *	available to close whatever was being used for protocol queries.
  */
-/*#define HAS_ENDPROTOENT		/**/
+/*#define HAS_ENDPROTOENT		/ **/
 
 /* HAS_ENDPROTOENT_R:
  *	This symbol, if defined, indicates that the endprotoent_r routine
@@ -1252,14 +1254,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_endprotoent_r
  *	is defined.
  */
-/*#define HAS_ENDPROTOENT_R	   /**/
+/*#define HAS_ENDPROTOENT_R	   / **/
 #define ENDPROTOENT_R_PROTO 0	   /**/
 
 /* HAS_ENDPWENT:
  *	This symbol, if defined, indicates that the getgrent routine is
  *	available for finalizing sequential access of the passwd database.
  */
-/*#define HAS_ENDPWENT		/**/
+/*#define HAS_ENDPWENT		/ **/
 
 /* HAS_ENDPWENT_R:
  *	This symbol, if defined, indicates that the endpwent_r routine
@@ -1271,14 +1273,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_endpwent_r
  *	is defined.
  */
-/*#define HAS_ENDPWENT_R	   /**/
+/*#define HAS_ENDPWENT_R	   / **/
 #define ENDPWENT_R_PROTO 0	   /**/
 
 /* HAS_ENDSERVENT:
  *	This symbol, if defined, indicates that the endservent() routine is
  *	available to close whatever was being used for service queries.
  */
-/*#define HAS_ENDSERVENT		/**/
+/*#define HAS_ENDSERVENT		/ **/
 
 /* HAS_ENDSERVENT_R:
  *	This symbol, if defined, indicates that the endservent_r routine
@@ -1290,7 +1292,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_endservent_r
  *	is defined.
  */
-/*#define HAS_ENDSERVENT_R	   /**/
+/*#define HAS_ENDSERVENT_R	   / **/
 #define ENDSERVENT_R_PROTO 0	   /**/
 
 /* FLEXFILENAMES:
@@ -1303,7 +1305,7 @@
  *	This symbol, if defined, indicates that the getgrent routine is
  *	available for sequential access of the group database.
  */
-/*#define HAS_GETGRENT		/**/
+/*#define HAS_GETGRENT		/ **/
 
 /* HAS_GETGRENT_R:
  *	This symbol, if defined, indicates that the getgrent_r routine
@@ -1315,7 +1317,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getgrent_r
  *	is defined.
  */
-/*#define HAS_GETGRENT_R	   /**/
+/*#define HAS_GETGRENT_R	   / **/
 #define GETGRENT_R_PROTO 0	   /**/
 
 /* HAS_GETGRGID_R:
@@ -1328,7 +1330,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getgrgid_r
  *	is defined.
  */
-/*#define HAS_GETGRGID_R	   /**/
+/*#define HAS_GETGRGID_R	   / **/
 #define GETGRGID_R_PROTO 0	   /**/
 
 /* HAS_GETGRNAM_R:
@@ -1341,7 +1343,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getgrnam_r
  *	is defined.
  */
-/*#define HAS_GETGRNAM_R	   /**/
+/*#define HAS_GETGRNAM_R	   / **/
 #define GETGRNAM_R_PROTO 0	   /**/
 
 /* HAS_GETHOSTBYADDR:
@@ -1360,7 +1362,7 @@
  *	This symbol, if defined, indicates that the gethostent() routine is
  *	available to look up host names in some data base or another.
  */
-/*#define HAS_GETHOSTENT		/**/
+/*#define HAS_GETHOSTENT		/ **/
 
 /* HAS_GETHOSTNAME:
  *	This symbol, if defined, indicates that the C program may use the
@@ -1386,7 +1388,7 @@
  */
 #define HAS_GETHOSTNAME	/**/
 #define HAS_UNAME		/**/
-/*#define HAS_PHOSTNAME	/**/
+/*#define HAS_PHOSTNAME	/ **/
 #ifdef HAS_PHOSTNAME
 #define PHOSTNAME ""	/* How to get the host name */
 #endif
@@ -1401,7 +1403,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_gethostbyaddr_r
  *	is defined.
  */
-/*#define HAS_GETHOSTBYADDR_R	   /**/
+/*#define HAS_GETHOSTBYADDR_R	   / **/
 #define GETHOSTBYADDR_R_PROTO 0	   /**/
 
 /* HAS_GETHOSTBYNAME_R:
@@ -1414,7 +1416,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_gethostbyname_r
  *	is defined.
  */
-/*#define HAS_GETHOSTBYNAME_R	   /**/
+/*#define HAS_GETHOSTBYNAME_R	   / **/
 #define GETHOSTBYNAME_R_PROTO 0	   /**/
 
 /* HAS_GETHOSTENT_R:
@@ -1427,7 +1429,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_gethostent_r
  *	is defined.
  */
-/*#define HAS_GETHOSTENT_R	   /**/
+/*#define HAS_GETHOSTENT_R	   / **/
 #define GETHOSTENT_R_PROTO 0	   /**/
 
 /* HAS_GETHOST_PROTOS:
@@ -1448,26 +1450,26 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getlogin_r
  *	is defined.
  */
-/*#define HAS_GETLOGIN_R	   /**/
+/*#define HAS_GETLOGIN_R	   / **/
 #define GETLOGIN_R_PROTO 0	   /**/
 
 /* HAS_GETNETBYADDR:
  *	This symbol, if defined, indicates that the getnetbyaddr() routine is
  *	available to look up networks by their IP addresses.
  */
-/*#define HAS_GETNETBYADDR		/**/
+/*#define HAS_GETNETBYADDR		/ **/
 
 /* HAS_GETNETBYNAME:
  *	This symbol, if defined, indicates that the getnetbyname() routine is
  *	available to look up networks by their names.
  */
-/*#define HAS_GETNETBYNAME		/**/
+/*#define HAS_GETNETBYNAME		/ **/
 
 /* HAS_GETNETENT:
  *	This symbol, if defined, indicates that the getnetent() routine is
  *	available to look up network names in some data base or another.
  */
-/*#define HAS_GETNETENT		/**/
+/*#define HAS_GETNETENT		/ **/
 
 /* HAS_GETNETBYADDR_R:
  *	This symbol, if defined, indicates that the getnetbyaddr_r routine
@@ -1479,7 +1481,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getnetbyaddr_r
  *	is defined.
  */
-/*#define HAS_GETNETBYADDR_R	   /**/
+/*#define HAS_GETNETBYADDR_R	   / **/
 #define GETNETBYADDR_R_PROTO 0	   /**/
 
 /* HAS_GETNETBYNAME_R:
@@ -1492,7 +1494,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getnetbyname_r
  *	is defined.
  */
-/*#define HAS_GETNETBYNAME_R	   /**/
+/*#define HAS_GETNETBYNAME_R	   / **/
 #define GETNETBYNAME_R_PROTO 0	   /**/
 
 /* HAS_GETNETENT_R:
@@ -1505,7 +1507,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getnetent_r
  *	is defined.
  */
-/*#define HAS_GETNETENT_R	   /**/
+/*#define HAS_GETNETENT_R	   / **/
 #define GETNETENT_R_PROTO 0	   /**/
 
 /* HAS_GETNET_PROTOS:
@@ -1514,13 +1516,13 @@
  *	getnetbyaddr().  Otherwise, it is up to the program to guess
  *	them.  See netdbtype.U for probing for various Netdb_xxx_t types.
  */
-/*#define	HAS_GETNET_PROTOS	/**/
+/*#define	HAS_GETNET_PROTOS	/ **/
 
 /* HAS_GETPROTOENT:
  *	This symbol, if defined, indicates that the getprotoent() routine is
  *	available to look up protocols in some data base or another.
  */
-/*#define HAS_GETPROTOENT		/**/
+/*#define HAS_GETPROTOENT		/ **/
 
 /* HAS_GETPGRP:
  *	This symbol, if defined, indicates that the getpgrp routine is
@@ -1530,8 +1532,8 @@
  *	This symbol, if defined, indicates that getpgrp needs one
  *	arguments whereas USG one needs none.
  */
-/*#define HAS_GETPGRP		/**/
-/*#define USE_BSD_GETPGRP	/**/
+/*#define HAS_GETPGRP		/ **/
+/*#define USE_BSD_GETPGRP	/ **/
 
 /* HAS_GETPROTOBYNAME:
  *	This symbol, if defined, indicates that the getprotobyname()
@@ -1554,7 +1556,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getprotobyname_r
  *	is defined.
  */
-/*#define HAS_GETPROTOBYNAME_R	   /**/
+/*#define HAS_GETPROTOBYNAME_R	   / **/
 #define GETPROTOBYNAME_R_PROTO 0	   /**/
 
 /* HAS_GETPROTOBYNUMBER_R:
@@ -1567,7 +1569,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getprotobynumber_r
  *	is defined.
  */
-/*#define HAS_GETPROTOBYNUMBER_R	   /**/
+/*#define HAS_GETPROTOBYNUMBER_R	   / **/
 #define GETPROTOBYNUMBER_R_PROTO 0	   /**/
 
 /* HAS_GETPROTOENT_R:
@@ -1580,7 +1582,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getprotoent_r
  *	is defined.
  */
-/*#define HAS_GETPROTOENT_R	   /**/
+/*#define HAS_GETPROTOENT_R	   / **/
 #define GETPROTOENT_R_PROTO 0	   /**/
 
 /* HAS_GETPROTO_PROTOS:
@@ -1596,7 +1598,7 @@
  *	available for sequential access of the passwd database.
  *	If this is not available, the older getpw() function may be available.
  */
-/*#define HAS_GETPWENT		/**/
+/*#define HAS_GETPWENT		/ **/
 
 /* HAS_GETPWENT_R:
  *	This symbol, if defined, indicates that the getpwent_r routine
@@ -1608,7 +1610,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getpwent_r
  *	is defined.
  */
-/*#define HAS_GETPWENT_R	   /**/
+/*#define HAS_GETPWENT_R	   / **/
 #define GETPWENT_R_PROTO 0	   /**/
 
 /* HAS_GETPWNAM_R:
@@ -1621,7 +1623,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getpwnam_r
  *	is defined.
  */
-/*#define HAS_GETPWNAM_R	   /**/
+/*#define HAS_GETPWNAM_R	   / **/
 #define GETPWNAM_R_PROTO 0	   /**/
 
 /* HAS_GETPWUID_R:
@@ -1634,14 +1636,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getpwuid_r
  *	is defined.
  */
-/*#define HAS_GETPWUID_R	   /**/
+/*#define HAS_GETPWUID_R	   / **/
 #define GETPWUID_R_PROTO 0	   /**/
 
 /* HAS_GETSERVENT:
  *	This symbol, if defined, indicates that the getservent() routine is
  *	available to look up network services in some data base or another.
  */
-/*#define HAS_GETSERVENT		/**/
+/*#define HAS_GETSERVENT		/ **/
 
 /* HAS_GETSERVBYNAME_R:
  *	This symbol, if defined, indicates that the getservbyname_r routine
@@ -1653,7 +1655,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getservbyname_r
  *	is defined.
  */
-/*#define HAS_GETSERVBYNAME_R	   /**/
+/*#define HAS_GETSERVBYNAME_R	   / **/
 #define GETSERVBYNAME_R_PROTO 0	   /**/
 
 /* HAS_GETSERVBYPORT_R:
@@ -1666,7 +1668,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getservbyport_r
  *	is defined.
  */
-/*#define HAS_GETSERVBYPORT_R	   /**/
+/*#define HAS_GETSERVBYPORT_R	   / **/
 #define GETSERVBYPORT_R_PROTO 0	   /**/
 
 /* HAS_GETSERVENT_R:
@@ -1679,7 +1681,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getservent_r
  *	is defined.
  */
-/*#define HAS_GETSERVENT_R	   /**/
+/*#define HAS_GETSERVENT_R	   / **/
 #define GETSERVENT_R_PROTO 0	   /**/
 
 /* HAS_GETSERV_PROTOS:
@@ -1700,7 +1702,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getspnam_r
  *	is defined.
  */
-/*#define HAS_GETSPNAM_R	   /**/
+/*#define HAS_GETSPNAM_R	   / **/
 #define GETSPNAM_R_PROTO 0	   /**/
 
 /* HAS_GETSERVBYNAME:
@@ -1724,7 +1726,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_gmtime_r
  *	is defined.
  */
-/*#define HAS_GMTIME_R	   /**/
+/*#define HAS_GMTIME_R	   / **/
 #define GMTIME_R_PROTO 0	   /**/
 
 /* HAS_HTONL:
@@ -1762,7 +1764,7 @@
  *	changes using \undef{TZ} without explicitly calling tzset
  *	impossible. This symbol makes us call tzset before localtime_r
  */
-/*#define LOCALTIME_R_NEEDS_TZSET /**/
+/*#define LOCALTIME_R_NEEDS_TZSET / **/
 #ifdef LOCALTIME_R_NEEDS_TZSET
 #define L_R_TZSET tzset(),
 #else
@@ -1775,7 +1777,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_localtime_r
  *	is defined.
  */
-/*#define HAS_LOCALTIME_R	   /**/
+/*#define HAS_LOCALTIME_R	   / **/
 #define LOCALTIME_R_PROTO 0	   /**/
 
 /* HAS_LONG_DOUBLE:
@@ -1800,7 +1802,7 @@
  *	C preprocessor can make decisions based on it.  It is only
  *	defined if the system supports long long.
  */
-/*#define HAS_LONG_LONG		/**/
+/*#define HAS_LONG_LONG		/ **/
 #ifdef HAS_LONG_LONG
 #define LONGLONGSIZE 8		/**/
 #endif
@@ -1824,7 +1826,7 @@
  *	available to exclusively create and open a uniquely named
  *	temporary file.
  */
-/*#define HAS_MKSTEMP		/**/
+/*#define HAS_MKSTEMP		/ **/
 
 /* HAS_MMAP:
  *	This symbol, if defined, indicates that the mmap system call is
@@ -1835,14 +1837,14 @@
  *	(and simultaneously the type of the first argument).
  *	Usually set to 'void *' or 'caddr_t'.
  */
-/*#define HAS_MMAP		/**/
+/*#define HAS_MMAP		/ **/
 #define Mmap_t void *	/**/
 
 /* HAS_MSG:
  *	This symbol, if defined, indicates that the entire msg*(2) library is
  *	supported (IPC mechanism based on message queues).
  */
-/*#define HAS_MSG		/**/
+/*#define HAS_MSG		/ **/
 
 /* OLD_PTHREAD_CREATE_JOINABLE:
  *	This symbol, if defined, indicates how to create pthread
@@ -1852,13 +1854,13 @@
  *	If defined, known values are PTHREAD_CREATE_UNDETACHED
  *	and __UNDETACHED.
  */
-/*#define OLD_PTHREAD_CREATE_JOINABLE  /**/
+/*#define OLD_PTHREAD_CREATE_JOINABLE  / **/
 
 /* HAS_PTHREAD_ATFORK:
  *	This symbol, if defined, indicates that the pthread_atfork routine
  *	is available to setup fork handlers.
  */
-/*#define HAS_PTHREAD_ATFORK		/**/
+/*#define HAS_PTHREAD_ATFORK		/ **/
 
 /* HAS_PTHREAD_YIELD:
  *	This symbol, if defined, indicates that the pthread_yield
@@ -1875,9 +1877,9 @@
  *	routine is available to yield the execution of the current
  *	thread.	 sched_yield is preferable to pthread_yield.
  */
-/*#define HAS_PTHREAD_YIELD	/**/
+/*#define HAS_PTHREAD_YIELD	/ **/
 #define SCHED_YIELD		/**/
-/*#define HAS_SCHED_YIELD	/**/
+/*#define HAS_SCHED_YIELD	/ **/
 
 /* HAS_RANDOM_R:
  *	This symbol, if defined, indicates that the random_r routine
@@ -1889,7 +1891,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_random_r
  *	is defined.
  */
-/*#define HAS_RANDOM_R	   /**/
+/*#define HAS_RANDOM_R	   / **/
 #define RANDOM_R_PROTO 0	   /**/
 
 /* HAS_READDIR64_R:
@@ -1902,7 +1904,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_readdir64_r
  *	is defined.
  */
-/*#define HAS_READDIR64_R	   /**/
+/*#define HAS_READDIR64_R	   / **/
 #define READDIR64_R_PROTO 0	   /**/
 
 /* HAS_READDIR_R:
@@ -1915,20 +1917,20 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_readdir_r
  *	is defined.
  */
-/*#define HAS_READDIR_R	   /**/
+/*#define HAS_READDIR_R	   / **/
 #define READDIR_R_PROTO 0	   /**/
 
 /* HAS_SEM:
  *	This symbol, if defined, indicates that the entire sem*(2) library is
  *	supported.
  */
-/*#define HAS_SEM		/**/
+/*#define HAS_SEM		/ **/
 
 /* HAS_SETGRENT:
  *	This symbol, if defined, indicates that the setgrent routine is
  *	available for initializing sequential access of the group database.
  */
-/*#define HAS_SETGRENT		/**/
+/*#define HAS_SETGRENT		/ **/
 
 /* HAS_SETGRENT_R:
  *	This symbol, if defined, indicates that the setgrent_r routine
@@ -1940,14 +1942,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_setgrent_r
  *	is defined.
  */
-/*#define HAS_SETGRENT_R	   /**/
+/*#define HAS_SETGRENT_R	   / **/
 #define SETGRENT_R_PROTO 0	   /**/
 
 /* HAS_SETHOSTENT:
  *	This symbol, if defined, indicates that the sethostent() routine is
  *	available.
  */
-/*#define HAS_SETHOSTENT		/**/
+/*#define HAS_SETHOSTENT		/ **/
 
 /* HAS_SETHOSTENT_R:
  *	This symbol, if defined, indicates that the sethostent_r routine
@@ -1959,7 +1961,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_sethostent_r
  *	is defined.
  */
-/*#define HAS_SETHOSTENT_R	   /**/
+/*#define HAS_SETHOSTENT_R	   / **/
 #define SETHOSTENT_R_PROTO 0	   /**/
 
 /* HAS_SETLOCALE_R:
@@ -1972,14 +1974,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_setlocale_r
  *	is defined.
  */
-/*#define HAS_SETLOCALE_R	   /**/
+/*#define HAS_SETLOCALE_R	   / **/
 #define SETLOCALE_R_PROTO 0	   /**/
 
 /* HAS_SETNETENT:
  *	This symbol, if defined, indicates that the setnetent() routine is
  *	available.
  */
-/*#define HAS_SETNETENT		/**/
+/*#define HAS_SETNETENT		/ **/
 
 /* HAS_SETNETENT_R:
  *	This symbol, if defined, indicates that the setnetent_r routine
@@ -1991,14 +1993,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_setnetent_r
  *	is defined.
  */
-/*#define HAS_SETNETENT_R	   /**/
+/*#define HAS_SETNETENT_R	   / **/
 #define SETNETENT_R_PROTO 0	   /**/
 
 /* HAS_SETPROTOENT:
  *	This symbol, if defined, indicates that the setprotoent() routine is
  *	available.
  */
-/*#define HAS_SETPROTOENT		/**/
+/*#define HAS_SETPROTOENT		/ **/
 
 /* HAS_SETPGRP:
  *	This symbol, if defined, indicates that the setpgrp routine is
@@ -2009,8 +2011,8 @@
  *	arguments whereas USG one needs none.  See also HAS_SETPGID
  *	for a POSIX interface.
  */
-/*#define HAS_SETPGRP		/**/
-/*#define USE_BSD_SETPGRP	/**/
+/*#define HAS_SETPGRP		/ **/
+/*#define USE_BSD_SETPGRP	/ **/
 
 /* HAS_SETPROTOENT_R:
  *	This symbol, if defined, indicates that the setprotoent_r routine
@@ -2022,14 +2024,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_setprotoent_r
  *	is defined.
  */
-/*#define HAS_SETPROTOENT_R	   /**/
+/*#define HAS_SETPROTOENT_R	   / **/
 #define SETPROTOENT_R_PROTO 0	   /**/
 
 /* HAS_SETPWENT:
  *	This symbol, if defined, indicates that the setpwent routine is
  *	available for initializing sequential access of the passwd database.
  */
-/*#define HAS_SETPWENT		/**/
+/*#define HAS_SETPWENT		/ **/
 
 /* HAS_SETPWENT_R:
  *	This symbol, if defined, indicates that the setpwent_r routine
@@ -2041,14 +2043,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_setpwent_r
  *	is defined.
  */
-/*#define HAS_SETPWENT_R	   /**/
+/*#define HAS_SETPWENT_R	   / **/
 #define SETPWENT_R_PROTO 0	   /**/
 
 /* HAS_SETSERVENT:
  *	This symbol, if defined, indicates that the setservent() routine is
  *	available.
  */
-/*#define HAS_SETSERVENT		/**/
+/*#define HAS_SETSERVENT		/ **/
 
 /* HAS_SETSERVENT_R:
  *	This symbol, if defined, indicates that the setservent_r routine
@@ -2060,7 +2062,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_setservent_r
  *	is defined.
  */
-/*#define HAS_SETSERVENT_R	   /**/
+/*#define HAS_SETSERVENT_R	   / **/
 #define SETSERVENT_R_PROTO 0	   /**/
 
 /* HAS_SETVBUF:
@@ -2074,7 +2076,7 @@
  *	This symbol, if defined, indicates that the entire shm*(2) library is
  *	supported.
  */
-/*#define HAS_SHM		/**/
+/*#define HAS_SHM		/ **/
 
 /* Shmat_t:
  *	This symbol holds the return type of the shmat() system call.
@@ -2088,7 +2090,7 @@
  *	when HAS_SHMAT_PROTOTYPE is not defined to avoid conflicting defs.
  */
 #define Shmat_t void *	/**/
-/*#define HAS_SHMAT_PROTOTYPE	/**/
+/*#define HAS_SHMAT_PROTOTYPE	/ **/
 
 /* HAS_SOCKET:
  *	This symbol, if defined, indicates that the BSD socket interface is
@@ -2129,13 +2131,13 @@
  *	has been known to be an enum.
  */
 #define	HAS_SOCKET		/**/
-/*#define	HAS_SOCKETPAIR	/**/
-/*#define	HAS_MSG_CTRUNC	/**/
-/*#define	HAS_MSG_DONTROUTE	/**/
-/*#define	HAS_MSG_OOB	/**/
-/*#define	HAS_MSG_PEEK	/**/
-/*#define	HAS_MSG_PROXY	/**/
-/*#define	HAS_SCM_RIGHTS	/**/
+/*#define	HAS_SOCKETPAIR	/ **/
+/*#define	HAS_MSG_CTRUNC	/ **/
+/*#define	HAS_MSG_DONTROUTE	/ **/
+/*#define	HAS_MSG_OOB	/ **/
+/*#define	HAS_MSG_PEEK	/ **/
+/*#define	HAS_MSG_PROXY	/ **/
+/*#define	HAS_SCM_RIGHTS	/ **/
 
 /* HAS_SRAND48_R:
  *	This symbol, if defined, indicates that the srand48_r routine
@@ -2147,7 +2149,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_srand48_r
  *	is defined.
  */
-/*#define HAS_SRAND48_R	   /**/
+/*#define HAS_SRAND48_R	   / **/
 #define SRAND48_R_PROTO 0	   /**/
 
 /* HAS_SRANDOM_R:
@@ -2160,7 +2162,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_srandom_r
  *	is defined.
  */
-/*#define HAS_SRANDOM_R	   /**/
+/*#define HAS_SRANDOM_R	   / **/
 #define SRANDOM_R_PROTO 0	   /**/
 
 /* USE_STAT_BLOCKS:
@@ -2168,7 +2170,7 @@
  *	st_blksize and st_blocks.
  */
 #ifndef USE_STAT_BLOCKS
-/*#define USE_STAT_BLOCKS 	/**/
+/*#define USE_STAT_BLOCKS 	/ **/
 #endif
 
 /* USE_STRUCT_COPY:
@@ -2207,7 +2209,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_strerror_r
  *	is defined.
  */
-/*#define HAS_STRERROR_R	   /**/
+/*#define HAS_STRERROR_R	   / **/
 #define STRERROR_R_PROTO 0	   /**/
 
 /* HAS_STRTOUL:
@@ -2244,7 +2246,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_tmpnam_r
  *	is defined.
  */
-/*#define HAS_TMPNAM_R	   /**/
+/*#define HAS_TMPNAM_R	   / **/
 #define TMPNAM_R_PROTO 0	   /**/
 
 /* HAS_TTYNAME_R:
@@ -2257,7 +2259,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_ttyname_r
  *	is defined.
  */
-/*#define HAS_TTYNAME_R	   /**/
+/*#define HAS_TTYNAME_R	   / **/
 #define TTYNAME_R_PROTO 0	   /**/
 
 /* HAS_UNION_SEMUN:
@@ -2279,19 +2281,19 @@
  *	used for semctl IPC_STAT.
  */
 #define HAS_UNION_SEMUN	/**/
-/*#define USE_SEMCTL_SEMUN	/**/
-/*#define USE_SEMCTL_SEMID_DS	/**/
+/*#define USE_SEMCTL_SEMUN	/ **/
+/*#define USE_SEMCTL_SEMID_DS	/ **/
 
 /* HAS_VFORK:
  *	This symbol, if defined, indicates that vfork() exists.
  */
-/*#define HAS_VFORK	/**/
+/*#define HAS_VFORK	/ **/
 
 /* HAS_PSEUDOFORK:
  *	This symbol, if defined, indicates that an emulation of the
  *	fork routine is available.
  */
-/*#define HAS_PSEUDOFORK	/**/
+/*#define HAS_PSEUDOFORK	/ **/
 
 /* Signal_t:
  *	This symbol's value is either "void" or "int", corresponding to the
@@ -2370,14 +2372,14 @@
  *	This symbol, if defined, indicates to the C program that struct group
  *	in <grp.h> contains gr_passwd.
  */
-/*#define I_GRP		/**/
-/*#define GRPASSWD	/**/
+/*#define I_GRP		/ **/
+/*#define GRPASSWD	/ **/
 
 /* I_MACH_CTHREADS:
  *     This symbol, if defined, indicates to the C program that it should
  *     include <mach/cthreads.h>.
  */
-/*#define   I_MACH_CTHREADS	/**/
+/*#define   I_MACH_CTHREADS	/ **/
 
 /* I_NDBM:
  *	This symbol, if defined, indicates that <ndbm.h> exists and should
@@ -2411,30 +2413,30 @@
  *	parameter information. While ANSI C prototypes are supported in C++,
  *	K&R style function declarations will yield errors.
  */
-/*#define I_NDBM	/**/
-/*#define I_GDBMNDBM	/**/
-/*#define I_GDBM_NDBM	/**/
-/*#define NDBM_H_USES_PROTOTYPES	/**/
-/*#define GDBMNDBM_H_USES_PROTOTYPES	/**/
-/*#define GDBM_NDBM_H_USES_PROTOTYPES	/**/
+/*#define I_NDBM	/ **/
+/*#define I_GDBMNDBM	/ **/
+/*#define I_GDBM_NDBM	/ **/
+/*#define NDBM_H_USES_PROTOTYPES	/ **/
+/*#define GDBMNDBM_H_USES_PROTOTYPES	/ **/
+/*#define GDBM_NDBM_H_USES_PROTOTYPES	/ **/
 
 /* I_NETDB:
  *	This symbol, if defined, indicates that <netdb.h> exists and
  *	should be included.
  */
-/*#define I_NETDB		/**/
+/*#define I_NETDB		/ **/
 
 /* I_NET_ERRNO:
  *	This symbol, if defined, indicates that <net/errno.h> exists and
  *	should be included.
  */
-/*#define I_NET_ERRNO		/**/
+/*#define I_NET_ERRNO		/ **/
 
 /* I_PTHREAD:
  *     This symbol, if defined, indicates to the C program that it should
  *     include <pthread.h>.
  */
-/*#define   I_PTHREAD	/**/
+/*#define   I_PTHREAD	/ **/
 
 /* I_PWD:
  *	This symbol, if defined, indicates to the C program that it should
@@ -2472,33 +2474,33 @@
  *	This symbol, if defined, indicates to the C program that struct passwd
  *	contains pw_passwd.
  */
-/*#define I_PWD		/**/
-/*#define PWQUOTA	/**/
-/*#define PWAGE	/**/
-/*#define PWCHANGE	/**/
-/*#define PWCLASS	/**/
-/*#define PWEXPIRE	/**/
-/*#define PWCOMMENT	/**/
-/*#define PWGECOS	/**/
-/*#define PWPASSWD	/**/
+/*#define I_PWD		/ **/
+/*#define PWQUOTA	/ **/
+/*#define PWAGE	/ **/
+/*#define PWCHANGE	/ **/
+/*#define PWCLASS	/ **/
+/*#define PWEXPIRE	/ **/
+/*#define PWCOMMENT	/ **/
+/*#define PWGECOS	/ **/
+/*#define PWPASSWD	/ **/
 
 /* I_SYS_ACCESS:
  *     This symbol, if defined, indicates to the C program that it should
  *     include <sys/access.h>.
  */
-/*#define   I_SYS_ACCESS                /**/
+/*#define   I_SYS_ACCESS                / **/
 
 /* I_SYS_SECURITY:
  *     This symbol, if defined, indicates to the C program that it should
  *     include <sys/security.h>.
  */
-/*#define   I_SYS_SECURITY	/**/
+/*#define   I_SYS_SECURITY	/ **/
 
 /* I_SYSUIO:
  *	This symbol, if defined, indicates that <sys/uio.h> exists and
  *	should be included.
  */
-/*#define	I_SYSUIO		/**/
+/*#define	I_SYSUIO		/ **/
 
 /* I_STDARG:
  *	This symbol, if defined, indicates that <stdarg.h> exists and should
@@ -2509,7 +2511,7 @@
  *	include <varargs.h>.
  */
 #define I_STDARG		/**/
-/*#define I_VARARGS	/**/
+/*#define I_VARARGS	/ **/
 
 /* PERL_INC_VERSION_LIST:
  *	This variable specifies the list of subdirectories in over
@@ -2518,13 +2520,13 @@
  *	for a C initialization string.  See the inc_version_list entry
  *	in Porting/Glossary for more details.
  */
-/*#define PERL_INC_VERSION_LIST 0		/**/
+/*#define PERL_INC_VERSION_LIST 0		/ **/
 
 /* INSTALL_USR_BIN_PERL:
  *	This symbol, if defined, indicates that Perl is to be installed
  * 	also as /usr/bin/perl.
  */
-/*#define INSTALL_USR_BIN_PERL	/**/
+/*#define INSTALL_USR_BIN_PERL	/ **/
 
 /* Off_t:
  *	This symbol holds the type used to declare offsets in the kernel.
@@ -2559,7 +2561,7 @@
 /* MYMALLOC:
  *	This symbol, if defined, indicates that we're using our own malloc.
  */
-/*#define MYMALLOC			/**/
+/*#define MYMALLOC			/ **/
 
 /* Mode_t:
  *	This symbol holds the type used to declare file modes
@@ -2598,7 +2600,7 @@
  *	and architecture-specific directories.  See PERL_INC_VERSION_LIST
  *	for more details.
  */
-/*#define PERL_OTHERLIBDIRS ""		/**/
+/*#define PERL_OTHERLIBDIRS ""		/ **/
 
 /* Pid_t:
  *	This symbol holds the type used to declare process ids in the kernel.
@@ -2618,7 +2620,7 @@
  *	in programs that are not prepared to deal with ~ expansion at run-time.
  */
 #define PRIVLIB "c:\\perl\\lib"		/**/
-#define PRIVLIB_EXP (win32_get_privlib("5.11.0"))	/**/
+#define PRIVLIB_EXP (win32_get_privlib(PERL_VERSION_STRING, NULL))	/**/
 
 /* CAN_PROTOTYPE:
  *	If defined, this macro indicates that the C compiler can handle
@@ -2711,7 +2713,7 @@
  *	in programs that are not prepared to deal with ~ expansion at run-time.
  */
 #define SITEARCH "c:\\perl\\site\\lib"		/**/
-/*#define SITEARCH_EXP ""	/**/
+/*#define SITEARCH_EXP ""	/ **/
 
 /* SITELIB:
  *	This symbol contains the name of the private library for this package.
@@ -2734,7 +2736,7 @@
  *	be tacked onto this variable to generate a list of directories to search.
  */
 #define SITELIB "c:\\perl\\site\\lib"		/**/
-#define SITELIB_EXP (win32_get_sitelib("5.11.0"))	/**/
+#define SITELIB_EXP (win32_get_sitelib(PERL_VERSION_STRING, NULL))	/**/
 #define SITELIB_STEM ""		/**/
 
 /* Size_t_size:
@@ -2803,13 +2805,13 @@
  *	try to use the various _r versions of library functions.
  *	This is extremely experimental.
  */
-/*#define	USE_5005THREADS		/**/
-/*#define	USE_ITHREADS		/**/
+/*#define	USE_5005THREADS		/ **/
+/*#define	USE_ITHREADS		/ **/
 #if defined(USE_5005THREADS) && !defined(USE_ITHREADS)
 #define		USE_THREADS		/* until src is revised*/
 #endif
-/*#define	OLD_PTHREADS_API		/**/
-/*#define	USE_REENTRANT_API	/**/
+/*#define	OLD_PTHREADS_API		/ **/
+/*#define	USE_REENTRANT_API	/ **/
 
 /* PERL_VENDORARCH:
  *	If defined, this symbol contains the name of a private library.
@@ -2826,8 +2828,8 @@
  *	This symbol contains the ~name expanded version of PERL_VENDORARCH, to be used
  *	in programs that are not prepared to deal with ~ expansion at run-time.
  */
-/*#define PERL_VENDORARCH ""		/**/
-/*#define PERL_VENDORARCH_EXP ""		/**/
+/*#define PERL_VENDORARCH ""		/ **/
+/*#define PERL_VENDORARCH_EXP ""		/ **/
 
 /* PERL_VENDORLIB_EXP:
  *	This symbol contains the ~name expanded version of VENDORLIB, to be used
@@ -2838,8 +2840,8 @@
  *	removed.  The elements in inc_version_list (inc_version_list.U) can
  *	be tacked onto this variable to generate a list of directories to search.
  */
-/*#define PERL_VENDORLIB_EXP ""		/**/
-/*#define PERL_VENDORLIB_STEM ""		/**/
+/*#define PERL_VENDORLIB_EXP ""		/ **/
+/*#define PERL_VENDORLIB_STEM ""		/ **/
 
 /* VOIDFLAGS:
  *	This symbol indicates how much support of the void type is given by this
@@ -2874,7 +2876,7 @@
  *	Perl has been cross-compiled to.  Undefined if not a cross-compile.
  */
 #ifndef USE_CROSS_COMPILE
-/*#define	USE_CROSS_COMPILE	/**/
+/*#define	USE_CROSS_COMPILE	/ **/
 #define	PERL_TARGETARCH	""	/**/
 #endif
 
@@ -2932,6 +2934,12 @@
 #define BYTEORDER 0x1234	/* large digits for MSB */
 #endif /* NeXT */
 
+/* CHARBITS:
+ *	This symbol contains the size of a char, so that the C preprocessor
+ *	can make decisions based on it.
+ */
+#define CHARBITS 8		/**/
+
 /* CASTI32:
  *	This symbol is defined if the C compiler can cast negative
  *	or large floating point numbers to 32-bit ints.
@@ -2957,7 +2965,7 @@
  *	This symbol, if defined, indicates that the closedir() routine
  *	does not return a value.
  */
-/*#define VOID_CLOSEDIR		/**/
+/*#define VOID_CLOSEDIR		/ **/
 
 /* HAS_FD_SET:
  *	This symbol, when defined, indicates presence of the fd_set typedef
@@ -2987,14 +2995,14 @@
  *	is available to get system page size, which is the granularity of
  *	many memory management calls.
  */
-/*#define HAS_GETPAGESIZE		/**/
+/*#define HAS_GETPAGESIZE		/ **/
 
 /* HAS_GNULIBC:
  *	This symbol, if defined, indicates to the C program that
  *	the GNU C library is being used.  A better check is to use
  *	the __GLIBC__ and __GLIBC_MINOR__ symbols supplied with glibc.
  */
-/*#define HAS_GNULIBC  	/**/
+/*#define HAS_GNULIBC  	/ **/
 #if defined(HAS_GNULIBC) && !defined(_GNU_SOURCE)
 #   define _GNU_SOURCE
 #endif
@@ -3010,13 +3018,13 @@
  *	available to operate on a symbolic link (instead of following the
  *	link).
  */
-/*#define HAS_LCHOWN		/**/
+/*#define HAS_LCHOWN		/ **/
 
 /* HAS_OPEN3:
  *	This manifest constant lets the C program know that the three
  *	argument form of open(2) is available.
  */
-/*#define HAS_OPEN3		/**/
+/*#define HAS_OPEN3		/ **/
 
 /* HAS_SAFE_BCOPY:
  *	This symbol, if defined, indicates that the bcopy routine is available
@@ -3024,7 +3032,7 @@
  *	probably use memmove() or memcpy(). If neither is defined, roll your
  *	own version.
  */
-/*#define HAS_SAFE_BCOPY	/**/
+/*#define HAS_SAFE_BCOPY	/ **/
 
 /* HAS_SAFE_MEMCPY:
  *	This symbol, if defined, indicates that the memcpy routine is available
@@ -3032,7 +3040,7 @@
  *	copy overlapping memory blocks, you should check HAS_MEMMOVE and
  *	use memmove() instead, if available.
  */
-/*#define HAS_SAFE_MEMCPY	/**/
+/*#define HAS_SAFE_MEMCPY	/ **/
 
 /* HAS_SANE_MEMCMP:
  *	This symbol, if defined, indicates that the memcmp routine is available
@@ -3045,7 +3053,7 @@
  *	This symbol, if defined, indicates that Vr4's sigaction() routine
  *	is available.
  */
-/*#define HAS_SIGACTION	/**/
+/*#define HAS_SIGACTION	/ **/
 
 /* HAS_SIGSETJMP:
  *	This variable indicates to the C program that the sigsetjmp()
@@ -3067,7 +3075,7 @@
  *	traditional longjmp() if siglongjmp isn't available.
  *	See HAS_SIGSETJMP.
  */
-/*#define HAS_SIGSETJMP	/**/
+/*#define HAS_SIGSETJMP	/ **/
 #ifdef HAS_SIGSETJMP
 #define Sigjmp_buf sigjmp_buf
 #define Sigsetjmp(buf,save_mask) sigsetjmp((buf),(save_mask))
@@ -3118,7 +3126,7 @@
 #define STDIO_PTR_LVALUE 		/**/
 #define FILE_cnt(fp)	((fp)->level)
 #define STDIO_CNT_LVALUE 		/**/
-/*#define STDIO_PTR_LVAL_SETS_CNT	/**/
+/*#define STDIO_PTR_LVAL_SETS_CNT	/ **/
 #define STDIO_PTR_LVAL_NOCHANGE_CNT	/**/
 #endif
 
@@ -3160,7 +3168,7 @@
  *	symbol.
  */
 #define HAS_VPRINTF	/**/
-/*#define USE_CHAR_VSPRINTF 	/**/
+/*#define USE_CHAR_VSPRINTF 	/ **/
 
 /* DOUBLESIZE:
  *	This symbol contains the size of a double, so that the C preprocessor
@@ -3189,10 +3197,10 @@
  *	the struct tm has a tm_gmtoff field.
  */
 #define I_TIME		/**/
-/*#define I_SYS_TIME		/**/
-/*#define I_SYS_TIME_KERNEL		/**/
-/*#define HAS_TM_TM_ZONE		/**/
-/*#define HAS_TM_TM_GMTOFF		/**/
+/*#define I_SYS_TIME		/ **/
+/*#define I_SYS_TIME_KERNEL		/ **/
+/*#define HAS_TM_TM_ZONE		/ **/
+/*#define HAS_TM_TM_GMTOFF		/ **/
 
 /* VAL_O_NONBLOCK:
  *	This symbol is to be used during open() or fcntl(F_SETFL) to turn on
@@ -3268,38 +3276,58 @@
  *     This symbol, if defined, indicates that this system uses
  *	EBCDIC encoding.
  */
-/*#define	EBCDIC 		/**/
+/*#define	EBCDIC 		/ **/
+
+/* SETUID_SCRIPTS_ARE_SECURE_NOW:
+ *	This symbol, if defined, indicates that the bug that prevents
+ *	setuid scripts from being secure is not present in this kernel.
+ */
+/* DOSUID:
+ *	This symbol, if defined, indicates that the C program should
+ *	check the script that it is executing for setuid/setgid bits, and
+ *	attempt to emulate setuid/setgid on systems that have disabled
+ *	setuid #! scripts because the kernel can't do it securely.
+ *	It is up to the package designer to make sure that this emulation
+ *	is done securely.  Among other things, it should do an fstat on
+ *	the script it just opened to make sure it really is a setuid/setgid
+ *	script, it should make sure the arguments passed correspond exactly
+ *	to the argument on the #! line, and it should not trust any
+ *	subprocesses to which it must pass the filename rather than the
+ *	file descriptor of the script to be executed.
+ */
+/*#define SETUID_SCRIPTS_ARE_SECURE_NOW	/ **/
+/*#define DOSUID		/ **/
 
 /* PERL_USE_DEVEL:
  *	This symbol, if defined, indicates that Perl was configured with
  *	-Dusedevel, to enable development features.  This should not be
  *	done for production builds.
  */
-/*#define	PERL_USE_DEVEL		/**/
+/*#define	PERL_USE_DEVEL		/ **/
 
 /* HAS_ATOLF:
  *	This symbol, if defined, indicates that the atolf routine is
  *	available to convert strings into long doubles.
  */
-/*#define HAS_ATOLF		/**/
+/*#define HAS_ATOLF		/ **/
 
 /* HAS_ATOLL:
  *	This symbol, if defined, indicates that the atoll routine is
  *	available to convert strings into long longs.
  */
-/*#define HAS_ATOLL		/**/
+/*#define HAS_ATOLL		/ **/
 
 /* HAS__FWALK:
  *	This symbol, if defined, indicates that the _fwalk system call is
  *	available to apply a function to all the file handles.
  */
-/*#define HAS__FWALK		/**/
+/*#define HAS__FWALK		/ **/
 
 /* HAS_AINTL:
  *	This symbol, if defined, indicates that the aintl routine is
  *	available.  If copysignl is also present we can emulate modfl.
  */
-/*#define HAS_AINTL		/**/
+/*#define HAS_AINTL		/ **/
 
 /* HAS_BUILTIN_CHOOSE_EXPR:
  *	Can we handle GCC builtin for compile-time ternary-like expressions
@@ -3308,13 +3336,13 @@
  *	Can we handle GCC builtin for telling that certain values are more
  *	likely
  */
-/*#define HAS_BUILTIN_EXPECT	/**/
-/*#define HAS_BUILTIN_CHOOSE_EXPR	/**/
+/*#define HAS_BUILTIN_EXPECT	/ **/
+/*#define HAS_BUILTIN_CHOOSE_EXPR	/ **/
 
 /* HAS_C99_VARIADIC_MACROS:
  *	If defined, the compiler supports C99 variadic macros.
  */
-/*#define	HAS_C99_VARIADIC_MACROS	/**/
+/*#define	HAS_C99_VARIADIC_MACROS	/ **/
 
 /* HAS_CLASS:
  *	This symbol, if defined, indicates that the class routine is
@@ -3332,31 +3360,31 @@
  *	FP_NANS		Signaling Not a Number (NaNS)
  *	FP_NANQ		Quiet Not a Number (NaNQ)
  */
-/*#define HAS_CLASS		/**/
+/*#define HAS_CLASS		/ **/
 
 /* HAS_CLEARENV:
  *	This symbol, if defined, indicates that the clearenv () routine is
  *	available for use.
  */
-/*#define HAS_CLEARENV		/**/
+/*#define HAS_CLEARENV		/ **/
 
 /* HAS_STRUCT_CMSGHDR:
  *	This symbol, if defined, indicates that the struct cmsghdr
  *	is supported.
  */
-/*#define HAS_STRUCT_CMSGHDR	/**/
+/*#define HAS_STRUCT_CMSGHDR	/ **/
 
 /* HAS_COPYSIGNL:
  *	This symbol, if defined, indicates that the copysignl routine is
  *	available.  If aintl is also present we can emulate modfl.
  */
-/*#define HAS_COPYSIGNL		/**/
+/*#define HAS_COPYSIGNL		/ **/
 
 /* USE_CPLUSPLUS:
  *	This symbol, if defined, indicates that a C++ compiler was
  *	used to compiled Perl and will be used to compile extensions.
  */
-/*#define USE_CPLUSPLUS		/**/
+/*#define USE_CPLUSPLUS		/ **/
 
 /* HAS_DBMINIT_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3364,19 +3392,19 @@
  *	to the program to supply one.  A good guess is
  *		extern int dbminit(char *);
  */
-/*#define	HAS_DBMINIT_PROTO	/**/
+/*#define	HAS_DBMINIT_PROTO	/ **/
 
 /* HAS_DIR_DD_FD:
  *	This symbol, if defined, indicates that the the DIR* dirstream
  *	structure contains a member variable named dd_fd.
  */
-/*#define HAS_DIR_DD_FD		/**/
+/*#define HAS_DIR_DD_FD		/ **/
 
 /* HAS_DIRFD:
  *	This manifest constant lets the C program know that dirfd
  *	is available.
  */
-/*#define HAS_DIRFD		/**/
+/*#define HAS_DIRFD		/ **/
 
 /* DLSYM_NEEDS_UNDERSCORE:
  *	This symbol, if defined, indicates that we need to prepend an
@@ -3384,7 +3412,7 @@
  *	makes sense if you *have* dlsym, which we will presume is the
  *	case if you're using dl_dlopen.xs.
  */
-/*#define 	DLSYM_NEEDS_UNDERSCORE 	/**/
+/*#define 	DLSYM_NEEDS_UNDERSCORE 	/ **/
 
 /* HAS_FAST_STDIO:
  *	This symbol, if defined, indicates that the "fast stdio"
@@ -3396,27 +3424,27 @@
  *	This symbol, if defined, indicates that the fchdir routine is
  *	available to change directory using a file descriptor.
  */
-/*#define HAS_FCHDIR		/**/
+/*#define HAS_FCHDIR		/ **/
 
 /* FCNTL_CAN_LOCK:
  *	This symbol, if defined, indicates that fcntl() can be used
  *	for file locking.  Normally on Unix systems this is defined.
  *	It may be undefined on VMS.
  */
-/*#define FCNTL_CAN_LOCK		/**/
+/*#define FCNTL_CAN_LOCK		/ **/
 
 /* HAS_FINITE:
  *	This symbol, if defined, indicates that the finite routine is
  *	available to check whether a double is finite (non-infinity non-NaN).
  */
-/*#define HAS_FINITE		/**/
+/*#define HAS_FINITE		/ **/
 
 /* HAS_FINITEL:
  *	This symbol, if defined, indicates that the finitel routine is
  *	available to check whether a long double is finite
  *	(non-infinity non-NaN).
  */
-/*#define HAS_FINITEL		/**/
+/*#define HAS_FINITEL		/ **/
 
 /* HAS_FLOCK_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3442,7 +3470,7 @@
  *	FP_POS_ZERO       +0.0 (positive zero)
  *	FP_NEG_ZERO       -0.0 (negative zero)
  */
-/*#define HAS_FP_CLASS		/**/
+/*#define HAS_FP_CLASS		/ **/
 
 /* HAS_FPCLASS:
  *	This symbol, if defined, indicates that the fpclass routine is
@@ -3460,7 +3488,7 @@
  *	FP_NNORM	negative normalized non-zero
  *	FP_PNORM	positive normalized non-zero
  */
-/*#define HAS_FPCLASS		/**/
+/*#define HAS_FPCLASS		/ **/
 
 /* HAS_FPCLASSIFY:
  *	This symbol, if defined, indicates that the fpclassify routine is
@@ -3474,7 +3502,7 @@
  *           FP_NAN        NaN
  *
  */
-/*#define HAS_FPCLASSIFY		/**/
+/*#define HAS_FPCLASSIFY		/ **/
 
 /* HAS_FPCLASSL:
  *	This symbol, if defined, indicates that the fpclassl routine is
@@ -3492,56 +3520,62 @@
  *	FP_NNORM	negative normalized non-zero
  *	FP_PNORM	positive normalized non-zero
  */
-/*#define HAS_FPCLASSL		/**/
+/*#define HAS_FPCLASSL		/ **/
 
 /* HAS_FPOS64_T:
  *	This symbol will be defined if the C compiler supports fpos64_t.
  */
-/*#define	HAS_FPOS64_T    	/**/
+/*#define	HAS_FPOS64_T    	/ **/
 
 /* HAS_FREXPL:
  *	This symbol, if defined, indicates that the frexpl routine is
  *	available to break a long double floating-point number into
  *	a normalized fraction and an integral power of 2.
  */
-/*#define HAS_FREXPL		/**/
+/*#define HAS_FREXPL		/ **/
 
 /* HAS_STRUCT_FS_DATA:
  *	This symbol, if defined, indicates that the struct fs_data
  *	to do statfs() is supported.
  */
-/*#define HAS_STRUCT_FS_DATA	/**/
+/*#define HAS_STRUCT_FS_DATA	/ **/
 
 /* HAS_FSEEKO:
  *	This symbol, if defined, indicates that the fseeko routine is
  *	available to fseek beyond 32 bits (useful for ILP32 hosts).
  */
-/*#define HAS_FSEEKO		/**/
+/*#define HAS_FSEEKO		/ **/
 
 /* HAS_FSTATFS:
  *	This symbol, if defined, indicates that the fstatfs routine is
  *	available to stat filesystems by file descriptors.
  */
-/*#define HAS_FSTATFS		/**/
+/*#define HAS_FSTATFS		/ **/
 
 /* HAS_FSYNC:
  *	This symbol, if defined, indicates that the fsync routine is
  *	available to write a file's modified data and attributes to
  *	permanent storage.
  */
-/*#define HAS_FSYNC		/**/
+/*#define HAS_FSYNC		/ **/
 
 /* HAS_FTELLO:
  *	This symbol, if defined, indicates that the ftello routine is
  *	available to ftell beyond 32 bits (useful for ILP32 hosts).
  */
-/*#define HAS_FTELLO		/**/
+/*#define HAS_FTELLO		/ **/
 
 /* HAS_FUTIMES:
  *	This symbol, if defined, indicates that the futimes routine is
  *	available to change file descriptor time stamps with struct timevals.
  */
-/*#define HAS_FUTIMES		/**/
+/*#define HAS_FUTIMES		/ **/
+
+/* HAS_GETADDRINFO:
+ *	This symbol, if defined, indicates that the getaddrinfo() function
+ *	is available for use.
+ */
+/*#define HAS_GETADDRINFO		/ **/
 
 /* HAS_GETCWD:
  *	This symbol, if defined, indicates that the getcwd routine is
@@ -3553,74 +3587,92 @@
  *	This symbol, if defined, indicates that the getespwnam system call is
  *	available to retrieve enchanced (shadow) password entries by name.
  */
-/*#define HAS_GETESPWNAM		/**/
+/*#define HAS_GETESPWNAM		/ **/
 
 /* HAS_GETFSSTAT:
  *	This symbol, if defined, indicates that the getfsstat routine is
  *	available to stat filesystems in bulk.
  */
-/*#define HAS_GETFSSTAT		/**/
+/*#define HAS_GETFSSTAT		/ **/
 
 /* HAS_GETITIMER:
  *	This symbol, if defined, indicates that the getitimer routine is
  *	available to return interval timers.
  */
-/*#define HAS_GETITIMER		/**/
+/*#define HAS_GETITIMER		/ **/
 
 /* HAS_GETMNT:
  *	This symbol, if defined, indicates that the getmnt routine is
  *	available to get filesystem mount info by filename.
  */
-/*#define HAS_GETMNT		/**/
+/*#define HAS_GETMNT		/ **/
 
 /* HAS_GETMNTENT:
  *	This symbol, if defined, indicates that the getmntent routine is
  *	available to iterate through mounted file systems to get their info.
  */
-/*#define HAS_GETMNTENT		/**/
+/*#define HAS_GETMNTENT		/ **/
+
+/* HAS_GETNAMEINFO:
+ *	This symbol, if defined, indicates that the getnameinfo() function
+ *	is available for use.
+ */
+/*#define HAS_GETNAMEINFO		/ **/
 
 /* HAS_GETPRPWNAM:
  *	This symbol, if defined, indicates that the getprpwnam system call is
  *	available to retrieve protected (shadow) password entries by name.
  */
-/*#define HAS_GETPRPWNAM		/**/
+/*#define HAS_GETPRPWNAM		/ **/
 
 /* HAS_GETSPNAM:
  *	This symbol, if defined, indicates that the getspnam system call is
  *	available to retrieve SysV shadow password entries by name.
  */
-/*#define HAS_GETSPNAM		/**/
+/*#define HAS_GETSPNAM		/ **/
 
 /* HAS_HASMNTOPT:
  *	This symbol, if defined, indicates that the hasmntopt routine is
  *	available to query the mount options of file systems.
  */
-/*#define HAS_HASMNTOPT		/**/
+/*#define HAS_HASMNTOPT		/ **/
 
 /* HAS_ILOGBL:
  *	This symbol, if defined, indicates that the ilogbl routine is
  *	available.  If scalbnl is also present we can emulate frexpl.
  */
-/*#define HAS_ILOGBL		/**/
+/*#define HAS_ILOGBL		/ **/
+
+/* HAS_INETNTOP:
+ *	This symbol, if defined, indicates that the inet_ntop() function
+ *	is available to parse IPv4 and IPv6 strings.
+ */
+/*#define HAS_INETNTOP		/ **/
+
+/* HAS_INETPTON:
+ *	This symbol, if defined, indicates that the inet_pton() function
+ *	is available to parse IPv4 and IPv6 strings.
+ */
+/*#define HAS_INETPTON		/ **/
 
 /* HAS_INT64_T:
  *     This symbol will defined if the C compiler supports int64_t.
  *     Usually the <inttypes.h> needs to be included, but sometimes
  *	<sys/types.h> is enough.
  */
-/*#define     HAS_INT64_T               /**/
+/*#define     HAS_INT64_T               / **/
 
 /* HAS_ISFINITE:
  *	This symbol, if defined, indicates that the isfinite routine is
  *	available to check whether a double is finite (non-infinity non-NaN).
  */
-/*#define HAS_ISFINITE		/**/
+/*#define HAS_ISFINITE		/ **/
 
 /* HAS_ISINF:
  *	This symbol, if defined, indicates that the isinf routine is
  *	available to check whether a double is an infinity.
  */
-/*#define HAS_ISINF		/**/
+/*#define HAS_ISINF		/ **/
 
 /* HAS_ISNAN:
  *	This symbol, if defined, indicates that the isnan routine is
@@ -3632,7 +3684,7 @@
  *	This symbol, if defined, indicates that the isnanl routine is
  *	available to check whether a long double is a NaN.
  */
-/*#define HAS_ISNANL		/**/
+/*#define HAS_ISNANL		/ **/
 
 /* HAS_LDBL_DIG:
  *	This symbol, if defined, indicates that this system's <float.h>
@@ -3646,38 +3698,38 @@
  *	This symbol, if defined, indicates that libm exports _LIB_VERSION
  *	and that math.h defines the enum to manipulate it.
  */
-/*#define LIBM_LIB_VERSION		/**/
+/*#define LIBM_LIB_VERSION		/ **/
 
 /* HAS_MADVISE:
  *	This symbol, if defined, indicates that the madvise system call is
  *	available to map a file into memory.
  */
-/*#define HAS_MADVISE		/**/
+/*#define HAS_MADVISE		/ **/
 
 /* HAS_MALLOC_SIZE:
  *	This symbol, if defined, indicates that the malloc_size
  *	routine is available for use.
  */
-/*#define HAS_MALLOC_SIZE		/**/
+/*#define HAS_MALLOC_SIZE		/ **/
 
 /* HAS_MALLOC_GOOD_SIZE:
  *	This symbol, if defined, indicates that the malloc_good_size
  *	routine is available for use.
  */
-/*#define HAS_MALLOC_GOOD_SIZE	/**/
+/*#define HAS_MALLOC_GOOD_SIZE	/ **/
 
 /* HAS_MKDTEMP:
  *	This symbol, if defined, indicates that the mkdtemp routine is
  *	available to exclusively create a uniquely named temporary directory.
  */
-/*#define HAS_MKDTEMP		/**/
+/*#define HAS_MKDTEMP		/ **/
 
 /* HAS_MKSTEMPS:
  *	This symbol, if defined, indicates that the mkstemps routine is
  *	available to excluslvely create and open a uniquely named
  *	(with a suffix) temporary file.
  */
-/*#define HAS_MKSTEMPS		/**/
+/*#define HAS_MKSTEMPS		/ **/
 
 /* HAS_MODFL:
  *	This symbol, if defined, indicates that the modfl routine is
@@ -3696,33 +3748,33 @@
  *	and 1.150000.  The bug has been seen in certain versions of glibc,
  *	release 2.2.2 is known to be okay.
  */
-/*#define HAS_MODFL		/**/
-/*#define HAS_MODFL_PROTO		/**/
-/*#define HAS_MODFL_POW32_BUG		/**/
+/*#define HAS_MODFL		/ **/
+/*#define HAS_MODFL_PROTO		/ **/
+/*#define HAS_MODFL_POW32_BUG		/ **/
 
 /* HAS_MPROTECT:
  *	This symbol, if defined, indicates that the mprotect system call is
  *	available to modify the access protection of a memory mapped file.
  */
-/*#define HAS_MPROTECT		/**/
+/*#define HAS_MPROTECT		/ **/
 
 /* HAS_STRUCT_MSGHDR:
  *	This symbol, if defined, indicates that the struct msghdr
  *	is supported.
  */
-/*#define HAS_STRUCT_MSGHDR	/**/
+/*#define HAS_STRUCT_MSGHDR	/ **/
 
 /* HAS_NL_LANGINFO:
  *	This symbol, if defined, indicates that the nl_langinfo routine is
  *	available to return local data.  You will also need <langinfo.h>
  *	and therefore I_LANGINFO.
  */
-/*#define HAS_NL_LANGINFO		/**/
+/*#define HAS_NL_LANGINFO		/ **/
 
 /* HAS_OFF64_T:
  *	This symbol will be defined if the C compiler supports off64_t.
  */
-/*#define	HAS_OFF64_T    		/**/
+/*#define	HAS_OFF64_T    		/ **/
 
 /* HAS_PROCSELFEXE:
  *	This symbol is defined if PROCSELFEXE_PATH is a symlink
@@ -3733,7 +3785,7 @@
  *	of the symbolic link pointing to the absolute pathname of
  *	the executing program.
  */
-/*#define HAS_PROCSELFEXE	/**/
+/*#define HAS_PROCSELFEXE	/ **/
 #if defined(HAS_PROCSELFEXE) && !defined(PROCSELFEXE_PATH)
 #define PROCSELFEXE_PATH		/**/
 #endif
@@ -3743,20 +3795,20 @@
  *	system call is available to set the contention scope attribute of
  *	a thread attribute object.
  */
-/*#define HAS_PTHREAD_ATTR_SETSCOPE		/**/
+/*#define HAS_PTHREAD_ATTR_SETSCOPE		/ **/
 
 /* HAS_READV:
  *	This symbol, if defined, indicates that the readv routine is
  *	available to do gather reads.  You will also need <sys/uio.h>
  *	and there I_SYSUIO.
  */
-/*#define HAS_READV		/**/
+/*#define HAS_READV		/ **/
 
 /* HAS_RECVMSG:
  *	This symbol, if defined, indicates that the recvmsg routine is
  *	available to send structured socket messages.
  */
-/*#define HAS_RECVMSG		/**/
+/*#define HAS_RECVMSG		/ **/
 
 /* HAS_SBRK_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3765,37 +3817,37 @@
  *		extern void* sbrk(int);
  *		extern void* sbrk(size_t);
  */
-/*#define	HAS_SBRK_PROTO	/**/
+/*#define	HAS_SBRK_PROTO	/ **/
 
 /* HAS_SCALBNL:
  *	This symbol, if defined, indicates that the scalbnl routine is
  *	available.  If ilogbl is also present we can emulate frexpl.
  */
-/*#define HAS_SCALBNL		/**/
+/*#define HAS_SCALBNL		/ **/
 
 /* HAS_SENDMSG:
  *	This symbol, if defined, indicates that the sendmsg routine is
  *	available to send structured socket messages.
  */
-/*#define HAS_SENDMSG		/**/
+/*#define HAS_SENDMSG		/ **/
 
 /* HAS_SETITIMER:
  *	This symbol, if defined, indicates that the setitimer routine is
  *	available to set interval timers.
  */
-/*#define HAS_SETITIMER		/**/
+/*#define HAS_SETITIMER		/ **/
 
 /* HAS_SETPROCTITLE:
  *	This symbol, if defined, indicates that the setproctitle routine is
  *	available to set process title.
  */
-/*#define HAS_SETPROCTITLE		/**/
+/*#define HAS_SETPROCTITLE		/ **/
 
 /* USE_SFIO:
  *	This symbol, if defined, indicates that sfio should
  *	be used.
  */
-/*#define	USE_SFIO		/**/
+/*#define	USE_SFIO		/ **/
 
 /* HAS_SIGNBIT:
  *	This symbol, if defined, indicates that the signbit routine is
@@ -3805,21 +3857,21 @@
  *	in perl.  Users should call Perl_signbit(), which will be #defined to
  *	the system's signbit() function or macro if this symbol is defined.
  */
-/*#define HAS_SIGNBIT		/**/
+/*#define HAS_SIGNBIT		/ **/
 
 /* HAS_SIGPROCMASK:
  *	This symbol, if defined, indicates that the sigprocmask
  *	system call is available to examine or change the signal mask
  *	of the calling process.
  */
-/*#define HAS_SIGPROCMASK		/**/
+/*#define HAS_SIGPROCMASK		/ **/
 
 /* USE_SITECUSTOMIZE:
  *	This symbol, if defined, indicates that sitecustomize should
  *	be used.
  */
 #ifndef USE_SITECUSTOMIZE
-/*#define	USE_SITECUSTOMIZE		/**/
+/*#define	USE_SITECUSTOMIZE		/ **/
 #endif
 
 /* HAS_SNPRINTF:
@@ -3837,7 +3889,7 @@
  *	This symbol, if defined, indicates that the sockatmark routine is
  *	available to test whether a socket is at the out-of-band mark.
  */
-/*#define HAS_SOCKATMARK		/**/
+/*#define HAS_SOCKATMARK		/ **/
 
 /* HAS_SOCKATMARK_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3845,13 +3897,13 @@
  *	to the program to supply one.  A good guess is
  *		extern int sockatmark(int);
  */
-/*#define	HAS_SOCKATMARK_PROTO	/**/
+/*#define	HAS_SOCKATMARK_PROTO	/ **/
 
 /* HAS_SOCKS5_INIT:
  *	This symbol, if defined, indicates that the socks5_init routine is
  *	available to initialize SOCKS 5.
  */
-/*#define HAS_SOCKS5_INIT		/**/
+/*#define HAS_SOCKS5_INIT		/ **/
 
 /* SPRINTF_RETURNS_STRLEN:
  *	This variable defines whether sprintf returns the length of the string
@@ -3865,7 +3917,7 @@
  *	This symbol, if defined, indicates that the sqrtl routine is
  *	available to do long double square roots.
  */
-/*#define HAS_SQRTL		/**/
+/*#define HAS_SQRTL		/ **/
 
 /* HAS_SETRESGID_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3873,7 +3925,7 @@
  *	to the program to supply one.  Good guesses are
  *		extern int setresgid(uid_t ruid, uid_t euid, uid_t suid);
  */
-/*#define	HAS_SETRESGID_PROTO	/**/
+/*#define	HAS_SETRESGID_PROTO	/ **/
 
 /* HAS_SETRESUID_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3881,7 +3933,7 @@
  *	to the program to supply one.  Good guesses are
  *		extern int setresuid(uid_t ruid, uid_t euid, uid_t suid);
  */
-/*#define	HAS_SETRESUID_PROTO	/**/
+/*#define	HAS_SETRESUID_PROTO	/ **/
 
 /* HAS_STRUCT_STATFS_F_FLAGS:
  *	This symbol, if defined, indicates that the struct statfs
@@ -3892,19 +3944,19 @@
  *	have statfs() and struct statfs, they have ustat() and getmnt()
  *	with struct ustat and struct fs_data.
  */
-/*#define HAS_STRUCT_STATFS_F_FLAGS		/**/
+/*#define HAS_STRUCT_STATFS_F_FLAGS		/ **/
 
 /* HAS_STRUCT_STATFS:
  *	This symbol, if defined, indicates that the struct statfs
  *	to do statfs() is supported.
  */
-/*#define HAS_STRUCT_STATFS	/**/
+/*#define HAS_STRUCT_STATFS	/ **/
 
 /* HAS_FSTATVFS:
  *	This symbol, if defined, indicates that the fstatvfs routine is
  *	available to stat filesystems by file descriptors.
  */
-/*#define HAS_FSTATVFS		/**/
+/*#define HAS_FSTATVFS		/ **/
 
 /* HAS_STRFTIME:
  *	This symbol, if defined, indicates that the strftime routine is
@@ -3916,43 +3968,43 @@
  *	This symbol, if defined, indicates that the strlcat () routine is
  *	available to do string concatenation.
  */
-/*#define HAS_STRLCAT		/**/
+/*#define HAS_STRLCAT		/ **/
 
 /* HAS_STRLCPY:
  *	This symbol, if defined, indicates that the strlcpy () routine is
  *	available to do string copying.
  */
-/*#define HAS_STRLCPY		/**/
+/*#define HAS_STRLCPY		/ **/
 
 /* HAS_STRTOLD:
  *	This symbol, if defined, indicates that the strtold routine is
  *	available to convert strings to long doubles.
  */
-/*#define HAS_STRTOLD		/**/
+/*#define HAS_STRTOLD		/ **/
 
 /* HAS_STRTOLL:
  *	This symbol, if defined, indicates that the strtoll routine is
  *	available to convert strings to long longs.
  */
-/*#define HAS_STRTOLL		/**/
+/*#define HAS_STRTOLL		/ **/
 
 /* HAS_STRTOQ:
  *	This symbol, if defined, indicates that the strtoq routine is
  *	available to convert strings to long longs (quads).
  */
-/*#define HAS_STRTOQ		/**/
+/*#define HAS_STRTOQ		/ **/
 
 /* HAS_STRTOULL:
  *	This symbol, if defined, indicates that the strtoull routine is
  *	available to convert strings to unsigned long longs.
  */
-/*#define HAS_STRTOULL		/**/
+/*#define HAS_STRTOULL		/ **/
 
 /* HAS_STRTOUQ:
  *	This symbol, if defined, indicates that the strtouq routine is
  *	available to convert strings to unsigned long longs (quads).
  */
-/*#define HAS_STRTOUQ		/**/
+/*#define HAS_STRTOUQ		/ **/
 
 /* HAS_SYSCALL_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3961,7 +4013,7 @@
  *		extern int syscall(int,  ...);
  *		extern int syscall(long, ...);
  */
-/*#define	HAS_SYSCALL_PROTO	/**/
+/*#define	HAS_SYSCALL_PROTO	/ **/
 
 /* HAS_TELLDIR_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3995,18 +4047,18 @@
  *	This symbol, if defined, indicates that the asctime64 () routine is
  *	available to do the 64bit variant of asctime ()
  */
-/*#define	HAS_CTIME64		/**/
-/*#define	HAS_LOCALTIME64		/**/
-/*#define	HAS_GMTIME64		/**/
-/*#define	HAS_MKTIME64		/**/
-/*#define	HAS_DIFFTIME64		/**/
-/*#define	HAS_ASCTIME64		/**/
+/*#define	HAS_CTIME64		/ **/
+/*#define	HAS_LOCALTIME64		/ **/
+/*#define	HAS_GMTIME64		/ **/
+/*#define	HAS_MKTIME64		/ **/
+/*#define	HAS_DIFFTIME64		/ **/
+/*#define	HAS_ASCTIME64		/ **/
 
 /* HAS_TIMEGM:
  *	This symbol, if defined, indicates that the timegm routine is
  *	available to do the opposite of gmtime ()
  */
-/*#define HAS_TIMEGM		/**/
+/*#define HAS_TIMEGM		/ **/
 
 /* U32_ALIGNMENT_REQUIRED:
  *	This symbol, if defined, indicates that you must access
@@ -4020,20 +4072,20 @@
  *	This symbol, if defined, indicates that the ualarm routine is
  *	available to do alarms with microsecond granularity.
  */
-/*#define HAS_UALARM		/**/
+/*#define HAS_UALARM		/ **/
 
 /* HAS_UNORDERED:
  *	This symbol, if defined, indicates that the unordered routine is
  *	available to check whether two doubles are unordered
  *	(effectively: whether either of them is NaN)
  */
-/*#define HAS_UNORDERED		/**/
+/*#define HAS_UNORDERED		/ **/
 
 /* HAS_UNSETENV:
  *	This symbol, if defined, indicates that the unsetenv () routine is
  *	available for use.
  */
-/*#define HAS_UNSETENV		/**/
+/*#define HAS_UNSETENV		/ **/
 
 /* HAS_USLEEP_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -4041,19 +4093,19 @@
  *	to the program to supply one.  A good guess is
  *		extern int usleep(useconds_t);
  */
-/*#define	HAS_USLEEP_PROTO	/**/
+/*#define	HAS_USLEEP_PROTO	/ **/
 
 /* HAS_USTAT:
  *	This symbol, if defined, indicates that the ustat system call is
  *	available to query file system statistics by dev_t.
  */
-/*#define HAS_USTAT		/**/
+/*#define HAS_USTAT		/ **/
 
 /* HAS_WRITEV:
  *	This symbol, if defined, indicates that the writev routine is
  *	available to do scatter writes.
  */
-/*#define HAS_WRITEV		/**/
+/*#define HAS_WRITEV		/ **/
 
 /* USE_DYNAMIC_LOADING:
  *	This symbol, if defined, indicates that dynamic loading of
@@ -4073,7 +4125,7 @@
  *	even be probed for and will be left undefined.
  */
 #define	FFLUSH_NULL 		/**/
-/*#define	FFLUSH_ALL 		/**/
+/*#define	FFLUSH_ALL 		/ **/
 
 /* I_ASSERT:
  *	This symbol, if defined, indicates that <assert.h> exists and
@@ -4085,7 +4137,7 @@
  *	This symbol, if defined, indicates that <crypt.h> exists and
  *	should be included.
  */
-/*#define	I_CRYPT		/**/
+/*#define	I_CRYPT		/ **/
 
 /* DB_Prefix_t:
  *	This symbol contains the type of the prefix structure element
@@ -4121,132 +4173,132 @@
  *	This symbol, if defined, indicates that <fp.h> exists and
  *	should be included.
  */
-/*#define	I_FP		/**/
+/*#define	I_FP		/ **/
 
 /* I_FP_CLASS:
  *	This symbol, if defined, indicates that <fp_class.h> exists and
  *	should be included.
  */
-/*#define	I_FP_CLASS		/**/
+/*#define	I_FP_CLASS		/ **/
 
 /* I_IEEEFP:
  *	This symbol, if defined, indicates that <ieeefp.h> exists and
  *	should be included.
  */
-/*#define	I_IEEEFP		/**/
+/*#define	I_IEEEFP		/ **/
 
 /* I_INTTYPES:
  *     This symbol, if defined, indicates to the C program that it should
  *     include <inttypes.h>.
  */
-/*#define   I_INTTYPES                /**/
+/*#define   I_INTTYPES                / **/
 
 /* I_LANGINFO:
  *	This symbol, if defined, indicates that <langinfo.h> exists and
  *	should be included.
  */
-/*#define	I_LANGINFO		/**/
+/*#define	I_LANGINFO		/ **/
 
 /* I_LIBUTIL:
  *	This symbol, if defined, indicates that <libutil.h> exists and
  *	should be included.
  */
-/*#define	I_LIBUTIL		/**/
+/*#define	I_LIBUTIL		/ **/
 
 /* I_MALLOCMALLOC:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <malloc/malloc.h>.
  */
-/*#define I_MALLOCMALLOC		/**/
+/*#define I_MALLOCMALLOC		/ **/
 
 /* I_MNTENT:
  *	This symbol, if defined, indicates that <mntent.h> exists and
  *	should be included.
  */
-/*#define	I_MNTENT		/**/
+/*#define	I_MNTENT		/ **/
 
 /* I_NETINET_TCP:
  *     This symbol, if defined, indicates to the C program that it should
  *     include <netinet/tcp.h>.
  */
-/*#define   I_NETINET_TCP                /**/
+/*#define   I_NETINET_TCP                / **/
 
 /* I_POLL:
  *	This symbol, if defined, indicates that <poll.h> exists and
  *	should be included. (see also HAS_POLL)
  */
-/*#define	I_POLL		/**/
+/*#define	I_POLL		/ **/
 
 /* I_PROT:
  *	This symbol, if defined, indicates that <prot.h> exists and
  *	should be included.
  */
-/*#define	I_PROT		/**/
+/*#define	I_PROT		/ **/
 
 /* I_SHADOW:
  *	This symbol, if defined, indicates that <shadow.h> exists and
  *	should be included.
  */
-/*#define	I_SHADOW		/**/
+/*#define	I_SHADOW		/ **/
 
 /* I_SOCKS:
  *	This symbol, if defined, indicates that <socks.h> exists and
  *	should be included.
  */
-/*#define	I_SOCKS		/**/
+/*#define	I_SOCKS		/ **/
 
 /* I_SUNMATH:
  *	This symbol, if defined, indicates that <sunmath.h> exists and
  *	should be included.
  */
-/*#define	I_SUNMATH		/**/
+/*#define	I_SUNMATH		/ **/
 
 /* I_SYSLOG:
  *	This symbol, if defined, indicates that <syslog.h> exists and
  *	should be included.
  */
-/*#define	I_SYSLOG		/**/
+/*#define	I_SYSLOG		/ **/
 
 /* I_SYSMODE:
  *	This symbol, if defined, indicates that <sys/mode.h> exists and
  *	should be included.
  */
-/*#define	I_SYSMODE		/**/
+/*#define	I_SYSMODE		/ **/
 
 /* I_SYS_MOUNT:
  *	This symbol, if defined, indicates that <sys/mount.h> exists and
  *	should be included.
  */
-/*#define	I_SYS_MOUNT		/**/
+/*#define	I_SYS_MOUNT		/ **/
 
 /* I_SYS_STATFS:
  *	This symbol, if defined, indicates that <sys/statfs.h> exists.
  */
-/*#define	I_SYS_STATFS		/**/
+/*#define	I_SYS_STATFS		/ **/
 
 /* I_SYS_STATVFS:
  *	This symbol, if defined, indicates that <sys/statvfs.h> exists and
  *	should be included.
  */
-/*#define	I_SYS_STATVFS		/**/
+/*#define	I_SYS_STATVFS		/ **/
 
 /* I_SYSUTSNAME:
  *	This symbol, if defined, indicates that <sys/utsname.h> exists and
  *	should be included.
  */
-/*#define	I_SYSUTSNAME		/**/
+/*#define	I_SYSUTSNAME		/ **/
 
 /* I_SYS_VFS:
  *	This symbol, if defined, indicates that <sys/vfs.h> exists and
  *	should be included.
  */
-/*#define	I_SYS_VFS		/**/
+/*#define	I_SYS_VFS		/ **/
 
 /* I_USTAT:
  *	This symbol, if defined, indicates that <ustat.h> exists and
  *	should be included.
  */
-/*#define	I_USTAT		/**/
+/*#define	I_USTAT		/ **/
 
 /* PERL_PRIfldbl:
  *	This symbol, if defined, contains the string used by stdio to
@@ -4264,16 +4316,16 @@
  *	This symbol, if defined, contains the string used by stdio to
  *	format long doubles (format 'f') for input.
  */
-/*#define PERL_PRIfldbl	"Lf"	/**/
-/*#define PERL_PRIgldbl	"Lg"	/**/
-/*#define PERL_PRIeldbl	"Le"	/**/
-/*#define PERL_SCNfldbl	"Lf"	/**/
+/*#define PERL_PRIfldbl	"Lf"	/ **/
+/*#define PERL_PRIgldbl	"Lg"	/ **/
+/*#define PERL_PRIeldbl	"Le"	/ **/
+/*#define PERL_SCNfldbl	"Lf"	/ **/
 
 /* PERL_MAD:
  *	This symbol, if defined, indicates that the Misc Attribution
  *	Declaration code should be conditionally compiled.
  */
-/*#define	PERL_MAD		/**/
+/*#define	PERL_MAD		/ **/
 
 /* NEED_VA_COPY:
  *	This symbol, if defined, indicates that the system stores
@@ -4284,7 +4336,7 @@
  *	of copying mechanisms, handy.h defines a platform-
  *	independent macro, Perl_va_copy(src, dst), to do the job.
  */
-/*#define	NEED_VA_COPY		/**/
+/*#define	NEED_VA_COPY		/ **/
 
 /* IVTYPE:
  *	This symbol defines the C type used for Perl's IV.
@@ -4479,7 +4531,7 @@
  *	This symbol tells the name of the array holding the stdio streams.
  *	Usual values include _iob, __iob, and __sF.
  */
-/*#define	HAS_STDIO_STREAM_ARRAY	/**/
+/*#define	HAS_STDIO_STREAM_ARRAY	/ **/
 #ifdef HAS_STDIO_STREAM_ARRAY
 #define STDIO_STREAM_ARRAY	
 #endif
@@ -4524,17 +4576,17 @@
  *	you may need at least to reboot your OS to 64-bit mode.
  */
 #ifndef USE_64_BIT_INT
-/*#define	USE_64_BIT_INT		/**/
+/*#define	USE_64_BIT_INT		/ **/
 #endif
 #ifndef USE_64_BIT_ALL
-/*#define	USE_64_BIT_ALL		/**/
+/*#define	USE_64_BIT_ALL		/ **/
 #endif
 
 /* USE_DTRACE:
  *	This symbol, if defined, indicates that Perl should
  *	be built with support for DTrace.
  */
-/*#define USE_DTRACE		/**/
+/*#define USE_DTRACE		/ **/
 
 /* USE_FAST_STDIO:
  *	This symbol, if defined, indicates that Perl should
@@ -4542,7 +4594,7 @@
  *	Defaults to define in Perls 5.8 and earlier, to undef later.
  */
 #ifndef USE_FAST_STDIO
-/*#define	USE_FAST_STDIO		/**/
+/*#define	USE_FAST_STDIO		/ **/
 #endif
 
 /* USE_LARGE_FILES:
@@ -4550,7 +4602,7 @@
  *	should be used when available.
  */
 #ifndef USE_LARGE_FILES
-/*#define	USE_LARGE_FILES		/**/
+/*#define	USE_LARGE_FILES		/ **/
 #endif
 
 /* USE_LONG_DOUBLE:
@@ -4558,7 +4610,7 @@
  *	be used when available.
  */
 #ifndef USE_LONG_DOUBLE
-/*#define	USE_LONG_DOUBLE		/**/
+/*#define	USE_LONG_DOUBLE		/ **/
 #endif
 
 /* USE_MORE_BITS:
@@ -4566,7 +4618,7 @@
  *	long doubles should be used when available.
  */
 #ifndef USE_MORE_BITS
-/*#define	USE_MORE_BITS		/**/
+/*#define	USE_MORE_BITS		/ **/
 #endif
 
 /* MULTIPLICITY:
@@ -4574,7 +4626,7 @@
  *	be built to use multiplicity.
  */
 #ifndef MULTIPLICITY
-/*#define	MULTIPLICITY		/**/
+/*#define	MULTIPLICITY		/ **/
 #endif
 
 /* USE_PERLIO:
@@ -4583,7 +4635,7 @@
  *	used in a fully backward compatible manner.
  */
 #ifndef USE_PERLIO
-/*#define	USE_PERLIO		/**/
+/*#define	USE_PERLIO		/ **/
 #endif
 
 /* USE_SOCKS:
@@ -4591,7 +4643,7 @@
  *	be built to use socks.
  */
 #ifndef USE_SOCKS
-/*#define	USE_SOCKS		/**/
+/*#define	USE_SOCKS		/ **/
 #endif
 
 #endif
Index: src/gnu/usr.bin/perl/win32/config_H.gc
diff -u src/gnu/usr.bin/perl/win32/config_H.gc:1.12 src/gnu/usr.bin/perl/win32/config_H.gc:1.13
--- win32/config_H.gc:1.12	Mon Oct 12 18:30:28 2009
+++ win32/config_H.gc	Fri Sep 24 15:07:11 2010
@@ -13,8 +13,8 @@
 /*
  * Package name      : perl5
  * Source directory  : 
- * Configuration time: Fri Dec 12 15:41:26 2008
- * Configured by     : shay
+ * Configuration time: Sun Jan 10 19:53:56 2010
+ * Configured by     : Steve
  * Target system     : 
  */
 
@@ -36,31 +36,31 @@
  *	This symbol is defined if the bcmp() routine is available to
  *	compare blocks of memory.
  */
-/*#define HAS_BCMP	/**/
+/*#define HAS_BCMP	/ **/
 
 /* HAS_BCOPY:
  *	This symbol is defined if the bcopy() routine is available to
  *	copy blocks of memory.
  */
-/*#define HAS_BCOPY	/**/
+/*#define HAS_BCOPY	/ **/
 
 /* HAS_BZERO:
  *	This symbol is defined if the bzero() routine is available to
  *	set a memory block to 0.
  */
-/*#define HAS_BZERO	/**/
+/*#define HAS_BZERO	/ **/
 
 /* HAS_CHOWN:
  *	This symbol, if defined, indicates that the chown routine is
  *	available.
  */
-/*#define HAS_CHOWN		/**/
+/*#define HAS_CHOWN		/ **/
 
 /* HAS_CHROOT:
  *	This symbol, if defined, indicates that the chroot routine is
  *	available.
  */
-/*#define HAS_CHROOT		/**/
+/*#define HAS_CHROOT		/ **/
 
 /* HAS_CHSIZE:
  *	This symbol, if defined, indicates that the chsize routine is available
@@ -72,19 +72,19 @@
  *	This symbol, if defined, indicates that the crypt routine is available
  *	to encrypt passwords and the like.
  */
-/*#define HAS_CRYPT		/**/
+/*#define HAS_CRYPT		/ **/
 
 /* HAS_CTERMID:
  *	This symbol, if defined, indicates that the ctermid routine is
  *	available to generate filename for terminal.
  */
-/*#define HAS_CTERMID		/**/
+/*#define HAS_CTERMID		/ **/
 
 /* HAS_CUSERID:
  *	This symbol, if defined, indicates that the cuserid routine is
  *	available to get character login names.
  */
-/*#define HAS_CUSERID		/**/
+/*#define HAS_CUSERID		/ **/
 
 /* HAS_DBL_DIG:
  *	This symbol, if defined, indicates that this system's <float.h>
@@ -107,26 +107,6 @@
  */
 #define HAS_DLERROR	/**/
 
-/* SETUID_SCRIPTS_ARE_SECURE_NOW:
- *	This symbol, if defined, indicates that the bug that prevents
- *	setuid scripts from being secure is not present in this kernel.
- */
-/* DOSUID:
- *	This symbol, if defined, indicates that the C program should
- *	check the script that it is executing for setuid/setgid bits, and
- *	attempt to emulate setuid/setgid on systems that have disabled
- *	setuid #! scripts because the kernel can't do it securely.
- *	It is up to the package designer to make sure that this emulation
- *	is done securely.  Among other things, it should do an fstat on
- *	the script it just opened to make sure it really is a setuid/setgid
- *	script, it should make sure the arguments passed correspond exactly
- *	to the argument on the #! line, and it should not trust any
- *	subprocesses to which it must pass the filename rather than the
- *	file descriptor of the script to be executed.
- */
-/*#define SETUID_SCRIPTS_ARE_SECURE_NOW	/**/
-/*#define DOSUID		/**/
-
 /* HAS_DUP2:
  *	This symbol, if defined, indicates that the dup2 routine is
  *	available to duplicate file descriptors.
@@ -137,19 +117,19 @@
  *	This symbol, if defined, indicates that the fchmod routine is available
  *	to change mode of opened files.  If unavailable, use chmod().
  */
-/*#define HAS_FCHMOD		/**/
+/*#define HAS_FCHMOD		/ **/
 
 /* HAS_FCHOWN:
  *	This symbol, if defined, indicates that the fchown routine is available
  *	to change ownership of opened files.  If unavailable, use chown().
  */
-/*#define HAS_FCHOWN		/**/
+/*#define HAS_FCHOWN		/ **/
 
 /* HAS_FCNTL:
  *	This symbol, if defined, indicates to the C program that
  *	the fcntl() function exists.
  */
-/*#define HAS_FCNTL		/**/
+/*#define HAS_FCNTL		/ **/
 
 /* HAS_FGETPOS:
  *	This symbol, if defined, indicates that the fgetpos routine is
@@ -167,7 +147,7 @@
  *	This symbol, if defined, indicates that the fork routine is
  *	available.
  */
-/*#define HAS_FORK		/**/
+/*#define HAS_FORK		/ **/
 
 /* HAS_FSETPOS:
  *	This symbol, if defined, indicates that the fsetpos routine is
@@ -191,7 +171,7 @@
  *	available to get the list of process groups.  If unavailable, multiple
  *	groups are probably not supported.
  */
-/*#define HAS_GETGROUPS		/**/
+/*#define HAS_GETGROUPS		/ **/
 
 /* HAS_GETLOGIN:
  *	This symbol, if defined, indicates that the getlogin routine is
@@ -204,32 +184,32 @@
  *	the getpgid(pid) function is available to get the
  *	process group id.
  */
-/*#define HAS_GETPGID		/**/
+/*#define HAS_GETPGID		/ **/
 
 /* HAS_GETPGRP2:
  *	This symbol, if defined, indicates that the getpgrp2() (as in DG/UX)
  *	routine is available to get the current process group.
  */
-/*#define HAS_GETPGRP2		/**/
+/*#define HAS_GETPGRP2		/ **/
 
 /* HAS_GETPPID:
  *	This symbol, if defined, indicates that the getppid routine is
  *	available to get the parent process ID.
  */
-/*#define HAS_GETPPID		/**/
+/*#define HAS_GETPPID		/ **/
 
 /* HAS_GETPRIORITY:
  *	This symbol, if defined, indicates that the getpriority routine is
  *	available to get a process's priority.
  */
-/*#define HAS_GETPRIORITY		/**/
+/*#define HAS_GETPRIORITY		/ **/
 
 /* HAS_INET_ATON:
  *	This symbol, if defined, indicates to the C program that the
  *	inet_aton() function is available to parse IP address "dotted-quad"
  *	strings.
  */
-/*#define HAS_INET_ATON		/**/
+/*#define HAS_INET_ATON		/ **/
 
 /* HAS_KILLPG:
  *	This symbol, if defined, indicates that the killpg routine is available
@@ -254,13 +234,13 @@
  *	This symbol, if defined, indicates that the lockf routine is
  *	available to do file locking.
  */
-/*#define HAS_LOCKF		/**/
+/*#define HAS_LOCKF		/ **/
 
 /* HAS_LSTAT:
  *	This symbol, if defined, indicates that the lstat routine is
  *	available to do file stats on symbolic links.
  */
-/*#define HAS_LSTAT		/**/
+/*#define HAS_LSTAT		/ **/
 
 /* HAS_MBLEN:
  *	This symbol, if defined, indicates that the mblen routine is available
@@ -319,7 +299,7 @@
  *	do it for you. However, if mkfifo is there, mknod might require
  *	super-user privileges which mkfifo will not.
  */
-/*#define HAS_MKFIFO		/**/
+/*#define HAS_MKFIFO		/ **/
 
 /* HAS_MKTIME:
  *	This symbol, if defined, indicates that the mktime routine is
@@ -331,19 +311,19 @@
  *	This symbol, if defined, indicates that the msync system call is
  *	available to synchronize a mapped file.
  */
-/*#define HAS_MSYNC		/**/
+/*#define HAS_MSYNC		/ **/
 
 /* HAS_MUNMAP:
  *	This symbol, if defined, indicates that the munmap system call is
  *	available to unmap a region, usually mapped by mmap().
  */
-/*#define HAS_MUNMAP		/**/
+/*#define HAS_MUNMAP		/ **/
 
 /* HAS_NICE:
  *	This symbol, if defined, indicates that the nice routine is
  *	available.
  */
-/*#define HAS_NICE		/**/
+/*#define HAS_NICE		/ **/
 
 /* HAS_PATHCONF:
  *	This symbol, if defined, indicates that pathconf() is available
@@ -355,8 +335,8 @@
  *	to determine file-system related limits and options associated
  *	with a given open file descriptor.
  */
-/*#define HAS_PATHCONF		/**/
-/*#define HAS_FPATHCONF		/**/
+/*#define HAS_PATHCONF		/ **/
+/*#define HAS_FPATHCONF		/ **/
 
 /* HAS_PAUSE:
  *	This symbol, if defined, indicates that the pause routine is
@@ -375,7 +355,7 @@
  *	available to poll active file descriptors.  Please check I_POLL and
  *	I_SYS_POLL to know which header should be included as well.
  */
-/*#define HAS_POLL		/**/
+/*#define HAS_POLL		/ **/
 
 /* HAS_READDIR:
  *	This symbol, if defined, indicates that the readdir routine is
@@ -406,7 +386,7 @@
  *	This symbol, if defined, indicates that the readlink routine is
  *	available to read the value of a symbolic link.
  */
-/*#define HAS_READLINK		/**/
+/*#define HAS_READLINK		/ **/
 
 /* HAS_RENAME:
  *	This symbol, if defined, indicates that the rename routine is available
@@ -433,27 +413,27 @@
  *	This symbol, if defined, indicates that the setegid routine is available
  *	to change the effective gid of the current program.
  */
-/*#define HAS_SETEGID		/**/
+/*#define HAS_SETEGID		/ **/
 
 /* HAS_SETEUID:
  *	This symbol, if defined, indicates that the seteuid routine is available
  *	to change the effective uid of the current program.
  */
-/*#define HAS_SETEUID		/**/
+/*#define HAS_SETEUID		/ **/
 
 /* HAS_SETGROUPS:
  *	This symbol, if defined, indicates that the setgroups() routine is
  *	available to set the list of process groups.  If unavailable, multiple
  *	groups are probably not supported.
  */
-/*#define HAS_SETGROUPS		/**/
+/*#define HAS_SETGROUPS		/ **/
 
 /* HAS_SETLINEBUF:
  *	This symbol, if defined, indicates that the setlinebuf routine is
  *	available to change stderr or stdout from block-buffered or unbuffered
  *	to a line-buffered mode.
  */
-/*#define HAS_SETLINEBUF		/**/
+/*#define HAS_SETLINEBUF		/ **/
 
 /* HAS_SETLOCALE:
  *	This symbol, if defined, indicates that the setlocale routine is
@@ -465,19 +445,19 @@
  *	This symbol, if defined, indicates that the setpgid(pid, gpid)
  *	routine is available to set process group ID.
  */
-/*#define HAS_SETPGID	/**/
+/*#define HAS_SETPGID	/ **/
 
 /* HAS_SETPGRP2:
  *	This symbol, if defined, indicates that the setpgrp2() (as in DG/UX)
  *	routine is available to set the current process group.
  */
-/*#define HAS_SETPGRP2		/**/
+/*#define HAS_SETPGRP2		/ **/
 
 /* HAS_SETPRIORITY:
  *	This symbol, if defined, indicates that the setpriority routine is
  *	available to set a process's priority.
  */
-/*#define HAS_SETPRIORITY		/**/
+/*#define HAS_SETPRIORITY		/ **/
 
 /* HAS_SETREGID:
  *	This symbol, if defined, indicates that the setregid routine is
@@ -489,8 +469,8 @@
  *	available to change the real, effective and saved gid of the current
  *	process.
  */
-/*#define HAS_SETREGID		/**/
-/*#define HAS_SETRESGID		/**/
+/*#define HAS_SETREGID		/ **/
+/*#define HAS_SETRESGID		/ **/
 
 /* HAS_SETREUID:
  *	This symbol, if defined, indicates that the setreuid routine is
@@ -502,26 +482,26 @@
  *	available to change the real, effective and saved uid of the current
  *	process.
  */
-/*#define HAS_SETREUID		/**/
-/*#define HAS_SETRESUID		/**/
+/*#define HAS_SETREUID		/ **/
+/*#define HAS_SETRESUID		/ **/
 
 /* HAS_SETRGID:
  *	This symbol, if defined, indicates that the setrgid routine is available
  *	to change the real gid of the current program.
  */
-/*#define HAS_SETRGID		/**/
+/*#define HAS_SETRGID		/ **/
 
 /* HAS_SETRUID:
  *	This symbol, if defined, indicates that the setruid routine is available
  *	to change the real uid of the current program.
  */
-/*#define HAS_SETRUID		/**/
+/*#define HAS_SETRUID		/ **/
 
 /* HAS_SETSID:
  *	This symbol, if defined, indicates that the setsid routine is
  *	available to set the process group ID.
  */
-/*#define HAS_SETSID	/**/
+/*#define HAS_SETSID	/ **/
 
 /* HAS_STRCHR:
  *	This symbol is defined to indicate that the strchr()/strrchr()
@@ -533,7 +513,7 @@
  *	functions are available for string searching.
  */
 #define HAS_STRCHR	/**/
-/*#define HAS_INDEX	/**/
+/*#define HAS_INDEX	/ **/
 
 /* HAS_STRCOLL:
  *	This symbol, if defined, indicates that the strcoll routine is
@@ -563,19 +543,19 @@
  *	This symbol, if defined, indicates that the symlink routine is available
  *	to create symbolic links.
  */
-/*#define HAS_SYMLINK	/**/
+/*#define HAS_SYMLINK	/ **/
 
 /* HAS_SYSCALL:
  *	This symbol, if defined, indicates that the syscall routine is
  *	available to call arbitrary system calls. If undefined, that's tough.
  */
-/*#define HAS_SYSCALL	/**/
+/*#define HAS_SYSCALL	/ **/
 
 /* HAS_SYSCONF:
  *	This symbol, if defined, indicates that sysconf() is available
  *	to determine system related limits and options.
  */
-/*#define HAS_SYSCONF	/**/
+/*#define HAS_SYSCONF	/ **/
 
 /* HAS_SYSTEM:
  *	This symbol, if defined, indicates that the system routine is
@@ -587,19 +567,19 @@
  *	This symbol, if defined, indicates that the tcgetpgrp routine is
  *	available to get foreground process group ID.
  */
-/*#define HAS_TCGETPGRP		/**/
+/*#define HAS_TCGETPGRP		/ **/
 
 /* HAS_TCSETPGRP:
  *	This symbol, if defined, indicates that the tcsetpgrp routine is
  *	available to set foreground process group ID.
  */
-/*#define HAS_TCSETPGRP		/**/
+/*#define HAS_TCSETPGRP		/ **/
 
 /* HAS_TRUNCATE:
  *	This symbol, if defined, indicates that the truncate routine is
  *	available to truncate files.
  */
-/*#define HAS_TRUNCATE	/**/
+/*#define HAS_TRUNCATE	/ **/
 
 /* HAS_TZNAME:
  *	This symbol, if defined, indicates that the tzname[] array is
@@ -617,12 +597,12 @@
  *	This symbol, if defined, indicates that the usleep routine is
  *	available to let the process sleep on a sub-second accuracy.
  */
-/*#define HAS_USLEEP		/**/
+/*#define HAS_USLEEP		/ **/
 
 /* HAS_WAIT4:
  *	This symbol, if defined, indicates that wait4() exists.
  */
-/*#define HAS_WAIT4	/**/
+/*#define HAS_WAIT4	/ **/
 
 /* HAS_WAITPID:
  *	This symbol, if defined, indicates that the waitpid routine is
@@ -669,7 +649,7 @@
  *	This symbol, if defined, indicates that <rpcsvc/dbm.h> exists and
  *	should be included.
  */
-/*#define I_DBM	/**/
+/*#define I_DBM	/ **/
 #define I_RPCSVC_DBM	/**/
 
 /* I_DLFCN:
@@ -694,7 +674,7 @@
  *	This symbol, if defined, indicates that <gdbm.h> exists and should
  *	be included.
  */
-/*#define I_GDBM	/**/
+/*#define I_GDBM	/ **/
 
 /* I_LIMITS:
  *	This symbol, if defined, indicates to the C program that it should
@@ -719,19 +699,19 @@
  *	This symbol, if defined, indicates to the C program that it should
  *	include <memory.h>.
  */
-/*#define I_MEMORY		/**/
+/*#define I_MEMORY		/ **/
 
 /* I_NETINET_IN:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <netinet/in.h>. Otherwise, you may try <sys/in.h>.
  */
-/*#define I_NETINET_IN	/**/
+/*#define I_NETINET_IN	/ **/
 
 /* I_SFIO:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sfio.h>.
  */
-/*#define	I_SFIO		/**/
+/*#define	I_SFIO		/ **/
 
 /* I_STDDEF:
  *	This symbol, if defined, indicates that <stddef.h> exists and should
@@ -755,13 +735,13 @@
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/dir.h>.
  */
-/*#define I_SYS_DIR		/**/
+/*#define I_SYS_DIR		/ **/
 
 /* I_SYS_FILE:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/file.h> to get definition of R_OK and friends.
  */
-/*#define I_SYS_FILE		/**/
+/*#define I_SYS_FILE		/ **/
 
 /* I_SYS_IOCTL:
  *	This symbol, if defined, indicates that <sys/ioctl.h> exists and should
@@ -771,39 +751,39 @@
  *	This symbol, if defined, indicates the <sys/sockio.h> should be included
  *	to get socket ioctl options, like SIOCATMARK.
  */
-/*#define	I_SYS_IOCTL		/**/
-/*#define I_SYS_SOCKIO	/**/
+/*#define	I_SYS_IOCTL		/ **/
+/*#define I_SYS_SOCKIO	/ **/
 
 /* I_SYS_NDIR:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/ndir.h>.
  */
-/*#define I_SYS_NDIR	/**/
+/*#define I_SYS_NDIR	/ **/
 
 /* I_SYS_PARAM:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/param.h>.
  */
-/*#define I_SYS_PARAM		/**/
+/*#define I_SYS_PARAM		/ **/
 
 /* I_SYS_POLL:
  *	This symbol, if defined, indicates that the program may include
  *	<sys/poll.h>.  When I_POLL is also defined, it's probably safest
  *	to only include <poll.h>.
  */
-/*#define I_SYS_POLL	/**/
+/*#define I_SYS_POLL	/ **/
 
 /* I_SYS_RESOURCE:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/resource.h>.
  */
-/*#define I_SYS_RESOURCE		/**/
+/*#define I_SYS_RESOURCE		/ **/
 
 /* I_SYS_SELECT:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/select.h> in order to get definition of struct timeval.
  */
-/*#define I_SYS_SELECT	/**/
+/*#define I_SYS_SELECT	/ **/
 
 /* I_SYS_STAT:
  *	This symbol, if defined, indicates to the C program that it should
@@ -815,7 +795,7 @@
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/times.h>.
  */
-/*#define	I_SYS_TIMES		/**/
+/*#define	I_SYS_TIMES		/ **/
 
 /* I_SYS_TYPES:
  *	This symbol, if defined, indicates to the C program that it should
@@ -827,13 +807,13 @@
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/un.h> to get UNIX domain socket definitions.
  */
-/*#define I_SYS_UN		/**/
+/*#define I_SYS_UN		/ **/
 
 /* I_SYS_WAIT:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/wait.h>.
  */
-/*#define I_SYS_WAIT	/**/
+/*#define I_SYS_WAIT	/ **/
 
 /* I_TERMIO:
  *	This symbol, if defined, indicates that the program should include
@@ -851,15 +831,15 @@
  *	<sgtty.h> rather than <termio.h>.  There are also differences in
  *	the ioctl() calls that depend on the value of this symbol.
  */
-/*#define I_TERMIO		/**/
-/*#define I_TERMIOS		/**/
-/*#define I_SGTTY		/**/
+/*#define I_TERMIO		/ **/
+/*#define I_TERMIOS		/ **/
+/*#define I_SGTTY		/ **/
 
 /* I_UNISTD:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <unistd.h>.
  */
-/*#define I_UNISTD		/**/
+/*#define I_UNISTD		/ **/
 
 /* I_UTIME:
  *	This symbol, if defined, indicates to the C program that it should
@@ -873,13 +853,35 @@
  *	MAXLONG, i.e. machine dependant limitations.  Probably, you
  *	should use <limits.h> instead, if it is available.
  */
-/*#define I_VALUES		/**/
+/*#define I_VALUES		/ **/
 
 /* I_VFORK:
  *	This symbol, if defined, indicates to the C program that it should
  *	include vfork.h.
  */
-/*#define I_VFORK	/**/
+/*#define I_VFORK	/ **/
+
+/* CAN_VAPROTO:
+ *	This variable is defined on systems supporting prototype declaration
+ *	of functions with a variable number of arguments.
+ */
+/* _V:
+ *	This macro is used to declare function parameters in prototypes for
+ *	functions with a variable number of parameters. Use double parentheses.
+ *	For example:
+ *
+ *		int printf _V((char *fmt, ...));
+ *
+ *	Remember to use the plain simple _() macro when declaring a function
+ *	with no variable number of arguments, since it might be possible to
+ *	have a non-effect _V() macro and still get prototypes via _().
+ */
+/*#define CAN_VAPROTO	/ **/
+#ifdef CAN_VAPROTO
+#define	_V(args) args
+#else
+#define	_V(args) ()
+#endif
 
 /* INTSIZE:
  *	This symbol contains the value of sizeof(int) so that the C
@@ -904,7 +906,7 @@
  *	example with the NeXT "fat" binaries that contain executables
  *	for several CPUs.
  */
-/*#define MULTIARCH		/**/
+/*#define MULTIARCH		/ **/
 
 /* HAS_QUAD:
  *	This symbol, if defined, tells that there's a 64-bit integer type,
@@ -957,7 +959,7 @@
  *	in programs that are not prepared to deal with ~ expansion at run-time.
  */
 #define ARCHLIB "c:\\perl\\lib"		/**/
-/*#define ARCHLIB_EXP ""	/**/
+/*#define ARCHLIB_EXP ""	/ **/
 
 /* ARCHNAME:
  *	This symbol holds a string representing the architecture name.
@@ -991,6 +993,7 @@
  */
 #if 42 == 1
 #define CAT2(a,b)	a/**/b
+#undef STRINGIFY
 #define STRINGIFY(a)	"a"
 #endif
 #if 42 == 42
@@ -998,6 +1001,7 @@
 #define PeRl_StGiFy(a)	#a
 #define CAT2(a,b)	PeRl_CaTiFy(a,b)
 #define StGiFy(a)	PeRl_StGiFy(a)
+#undef STRINGIFY
 #define STRINGIFY(a)	PeRl_StGiFy(a)
 #endif
 #if 42 != 1 && 42 != 42
@@ -1051,7 +1055,7 @@
  *	This symbol, if defined, indicates that the accessx routine is
  *	available to do extended access checks.
  */
-/*#define HAS_ACCESSX		/**/
+/*#define HAS_ACCESSX		/ **/
 
 /* HAS_ASCTIME_R:
  *	This symbol, if defined, indicates that the asctime_r routine
@@ -1063,7 +1067,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_asctime_r
  *	is defined.
  */
-/*#define HAS_ASCTIME_R	   /**/
+/*#define HAS_ASCTIME_R	   / **/
 #define ASCTIME_R_PROTO 0	   /**/
 
 /* The HASATTRIBUTE_* defines are left undefined here because they vary from
@@ -1097,15 +1101,15 @@
 /* HASATTRIBUTE_WARN_UNUSED_RESULT:
  *	Can we handle GCC attribute for warning on unused results
  */
-/*#define HASATTRIBUTE_DEPRECATED	/**/
-/*#define HASATTRIBUTE_FORMAT	/**/
-/*#define PRINTF_FORMAT_NULL_OK	/**/
-/*#define HASATTRIBUTE_NORETURN	/**/
-/*#define HASATTRIBUTE_MALLOC	/**/
-/*#define HASATTRIBUTE_NONNULL	/**/
-/*#define HASATTRIBUTE_PURE	/**/
-/*#define HASATTRIBUTE_UNUSED	/**/
-/*#define HASATTRIBUTE_WARN_UNUSED_RESULT	/**/
+/*#define HASATTRIBUTE_DEPRECATED	/ **/
+/*#define HASATTRIBUTE_FORMAT	/ **/
+/*#define PRINTF_FORMAT_NULL_OK	/ **/
+/*#define HASATTRIBUTE_NORETURN	/ **/
+/*#define HASATTRIBUTE_MALLOC	/ **/
+/*#define HASATTRIBUTE_NONNULL	/ **/
+/*#define HASATTRIBUTE_PURE	/ **/
+/*#define HASATTRIBUTE_UNUSED	/ **/
+/*#define HASATTRIBUTE_WARN_UNUSED_RESULT	/ **/
 
 /* HASCONST:
  *	This symbol, if defined, indicates that this C compiler knows about
@@ -1128,7 +1132,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_crypt_r
  *	is defined.
  */
-/*#define HAS_CRYPT_R	   /**/
+/*#define HAS_CRYPT_R	   / **/
 #define CRYPT_R_PROTO 0	   /**/
 
 /* HAS_CSH:
@@ -1137,7 +1141,7 @@
 /* CSH:
  *	This symbol, if defined, contains the full pathname of csh.
  */
-/*#define HAS_CSH		/**/
+/*#define HAS_CSH		/ **/
 #ifdef HAS_CSH
 #define CSH ""	/**/
 #endif
@@ -1152,7 +1156,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_ctermid_r
  *	is defined.
  */
-/*#define HAS_CTERMID_R	   /**/
+/*#define HAS_CTERMID_R	   / **/
 #define CTERMID_R_PROTO 0	   /**/
 
 /* HAS_CTIME_R:
@@ -1165,7 +1169,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_ctime_r
  *	is defined.
  */
-/*#define HAS_CTIME_R	   /**/
+/*#define HAS_CTIME_R	   / **/
 #define CTIME_R_PROTO 0	   /**/
 
 /* HAS_DRAND48_R:
@@ -1178,7 +1182,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_drand48_r
  *	is defined.
  */
-/*#define HAS_DRAND48_R	   /**/
+/*#define HAS_DRAND48_R	   / **/
 #define DRAND48_R_PROTO 0	   /**/
 
 /* HAS_DRAND48_PROTO:
@@ -1187,19 +1191,19 @@
  *	to the program to supply one.  A good guess is
  *		extern double drand48(void);
  */
-/*#define	HAS_DRAND48_PROTO	/**/
+/*#define	HAS_DRAND48_PROTO	/ **/
 
 /* HAS_EACCESS:
  *	This symbol, if defined, indicates that the eaccess routine is
  *	available to do extended access checks.
  */
-/*#define HAS_EACCESS		/**/
+/*#define HAS_EACCESS		/ **/
 
 /* HAS_ENDGRENT:
  *	This symbol, if defined, indicates that the getgrent routine is
  *	available for finalizing sequential access of the group database.
  */
-/*#define HAS_ENDGRENT		/**/
+/*#define HAS_ENDGRENT		/ **/
 
 /* HAS_ENDGRENT_R:
  *	This symbol, if defined, indicates that the endgrent_r routine
@@ -1211,14 +1215,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_endgrent_r
  *	is defined.
  */
-/*#define HAS_ENDGRENT_R	   /**/
+/*#define HAS_ENDGRENT_R	   / **/
 #define ENDGRENT_R_PROTO 0	   /**/
 
 /* HAS_ENDHOSTENT:
  *	This symbol, if defined, indicates that the endhostent() routine is
  *	available to close whatever was being used for host queries.
  */
-/*#define HAS_ENDHOSTENT		/**/
+/*#define HAS_ENDHOSTENT		/ **/
 
 /* HAS_ENDHOSTENT_R:
  *	This symbol, if defined, indicates that the endhostent_r routine
@@ -1230,14 +1234,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_endhostent_r
  *	is defined.
  */
-/*#define HAS_ENDHOSTENT_R	   /**/
+/*#define HAS_ENDHOSTENT_R	   / **/
 #define ENDHOSTENT_R_PROTO 0	   /**/
 
 /* HAS_ENDNETENT:
  *	This symbol, if defined, indicates that the endnetent() routine is
  *	available to close whatever was being used for network queries.
  */
-/*#define HAS_ENDNETENT		/**/
+/*#define HAS_ENDNETENT		/ **/
 
 /* HAS_ENDNETENT_R:
  *	This symbol, if defined, indicates that the endnetent_r routine
@@ -1249,14 +1253,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_endnetent_r
  *	is defined.
  */
-/*#define HAS_ENDNETENT_R	   /**/
+/*#define HAS_ENDNETENT_R	   / **/
 #define ENDNETENT_R_PROTO 0	   /**/
 
 /* HAS_ENDPROTOENT:
  *	This symbol, if defined, indicates that the endprotoent() routine is
  *	available to close whatever was being used for protocol queries.
  */
-/*#define HAS_ENDPROTOENT		/**/
+/*#define HAS_ENDPROTOENT		/ **/
 
 /* HAS_ENDPROTOENT_R:
  *	This symbol, if defined, indicates that the endprotoent_r routine
@@ -1268,14 +1272,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_endprotoent_r
  *	is defined.
  */
-/*#define HAS_ENDPROTOENT_R	   /**/
+/*#define HAS_ENDPROTOENT_R	   / **/
 #define ENDPROTOENT_R_PROTO 0	   /**/
 
 /* HAS_ENDPWENT:
  *	This symbol, if defined, indicates that the getgrent routine is
  *	available for finalizing sequential access of the passwd database.
  */
-/*#define HAS_ENDPWENT		/**/
+/*#define HAS_ENDPWENT		/ **/
 
 /* HAS_ENDPWENT_R:
  *	This symbol, if defined, indicates that the endpwent_r routine
@@ -1287,14 +1291,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_endpwent_r
  *	is defined.
  */
-/*#define HAS_ENDPWENT_R	   /**/
+/*#define HAS_ENDPWENT_R	   / **/
 #define ENDPWENT_R_PROTO 0	   /**/
 
 /* HAS_ENDSERVENT:
  *	This symbol, if defined, indicates that the endservent() routine is
  *	available to close whatever was being used for service queries.
  */
-/*#define HAS_ENDSERVENT		/**/
+/*#define HAS_ENDSERVENT		/ **/
 
 /* HAS_ENDSERVENT_R:
  *	This symbol, if defined, indicates that the endservent_r routine
@@ -1306,7 +1310,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_endservent_r
  *	is defined.
  */
-/*#define HAS_ENDSERVENT_R	   /**/
+/*#define HAS_ENDSERVENT_R	   / **/
 #define ENDSERVENT_R_PROTO 0	   /**/
 
 /* FLEXFILENAMES:
@@ -1319,7 +1323,7 @@
  *	This symbol, if defined, indicates that the getgrent routine is
  *	available for sequential access of the group database.
  */
-/*#define HAS_GETGRENT		/**/
+/*#define HAS_GETGRENT		/ **/
 
 /* HAS_GETGRENT_R:
  *	This symbol, if defined, indicates that the getgrent_r routine
@@ -1331,7 +1335,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getgrent_r
  *	is defined.
  */
-/*#define HAS_GETGRENT_R	   /**/
+/*#define HAS_GETGRENT_R	   / **/
 #define GETGRENT_R_PROTO 0	   /**/
 
 /* HAS_GETGRGID_R:
@@ -1344,7 +1348,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getgrgid_r
  *	is defined.
  */
-/*#define HAS_GETGRGID_R	   /**/
+/*#define HAS_GETGRGID_R	   / **/
 #define GETGRGID_R_PROTO 0	   /**/
 
 /* HAS_GETGRNAM_R:
@@ -1357,7 +1361,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getgrnam_r
  *	is defined.
  */
-/*#define HAS_GETGRNAM_R	   /**/
+/*#define HAS_GETGRNAM_R	   / **/
 #define GETGRNAM_R_PROTO 0	   /**/
 
 /* HAS_GETHOSTBYADDR:
@@ -1376,7 +1380,7 @@
  *	This symbol, if defined, indicates that the gethostent() routine is
  *	available to look up host names in some data base or another.
  */
-/*#define HAS_GETHOSTENT		/**/
+/*#define HAS_GETHOSTENT		/ **/
 
 /* HAS_GETHOSTNAME:
  *	This symbol, if defined, indicates that the C program may use the
@@ -1402,7 +1406,7 @@
  */
 #define HAS_GETHOSTNAME	/**/
 #define HAS_UNAME		/**/
-/*#define HAS_PHOSTNAME	/**/
+/*#define HAS_PHOSTNAME	/ **/
 #ifdef HAS_PHOSTNAME
 #define PHOSTNAME ""	/* How to get the host name */
 #endif
@@ -1417,7 +1421,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_gethostbyaddr_r
  *	is defined.
  */
-/*#define HAS_GETHOSTBYADDR_R	   /**/
+/*#define HAS_GETHOSTBYADDR_R	   / **/
 #define GETHOSTBYADDR_R_PROTO 0	   /**/
 
 /* HAS_GETHOSTBYNAME_R:
@@ -1430,7 +1434,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_gethostbyname_r
  *	is defined.
  */
-/*#define HAS_GETHOSTBYNAME_R	   /**/
+/*#define HAS_GETHOSTBYNAME_R	   / **/
 #define GETHOSTBYNAME_R_PROTO 0	   /**/
 
 /* HAS_GETHOSTENT_R:
@@ -1443,7 +1447,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_gethostent_r
  *	is defined.
  */
-/*#define HAS_GETHOSTENT_R	   /**/
+/*#define HAS_GETHOSTENT_R	   / **/
 #define GETHOSTENT_R_PROTO 0	   /**/
 
 /* HAS_GETHOST_PROTOS:
@@ -1464,26 +1468,26 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getlogin_r
  *	is defined.
  */
-/*#define HAS_GETLOGIN_R	   /**/
+/*#define HAS_GETLOGIN_R	   / **/
 #define GETLOGIN_R_PROTO 0	   /**/
 
 /* HAS_GETNETBYADDR:
  *	This symbol, if defined, indicates that the getnetbyaddr() routine is
  *	available to look up networks by their IP addresses.
  */
-/*#define HAS_GETNETBYADDR		/**/
+/*#define HAS_GETNETBYADDR		/ **/
 
 /* HAS_GETNETBYNAME:
  *	This symbol, if defined, indicates that the getnetbyname() routine is
  *	available to look up networks by their names.
  */
-/*#define HAS_GETNETBYNAME		/**/
+/*#define HAS_GETNETBYNAME		/ **/
 
 /* HAS_GETNETENT:
  *	This symbol, if defined, indicates that the getnetent() routine is
  *	available to look up network names in some data base or another.
  */
-/*#define HAS_GETNETENT		/**/
+/*#define HAS_GETNETENT		/ **/
 
 /* HAS_GETNETBYADDR_R:
  *	This symbol, if defined, indicates that the getnetbyaddr_r routine
@@ -1495,7 +1499,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getnetbyaddr_r
  *	is defined.
  */
-/*#define HAS_GETNETBYADDR_R	   /**/
+/*#define HAS_GETNETBYADDR_R	   / **/
 #define GETNETBYADDR_R_PROTO 0	   /**/
 
 /* HAS_GETNETBYNAME_R:
@@ -1508,7 +1512,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getnetbyname_r
  *	is defined.
  */
-/*#define HAS_GETNETBYNAME_R	   /**/
+/*#define HAS_GETNETBYNAME_R	   / **/
 #define GETNETBYNAME_R_PROTO 0	   /**/
 
 /* HAS_GETNETENT_R:
@@ -1521,7 +1525,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getnetent_r
  *	is defined.
  */
-/*#define HAS_GETNETENT_R	   /**/
+/*#define HAS_GETNETENT_R	   / **/
 #define GETNETENT_R_PROTO 0	   /**/
 
 /* HAS_GETNET_PROTOS:
@@ -1530,13 +1534,13 @@
  *	getnetbyaddr().  Otherwise, it is up to the program to guess
  *	them.  See netdbtype.U for probing for various Netdb_xxx_t types.
  */
-/*#define	HAS_GETNET_PROTOS	/**/
+/*#define	HAS_GETNET_PROTOS	/ **/
 
 /* HAS_GETPROTOENT:
  *	This symbol, if defined, indicates that the getprotoent() routine is
  *	available to look up protocols in some data base or another.
  */
-/*#define HAS_GETPROTOENT		/**/
+/*#define HAS_GETPROTOENT		/ **/
 
 /* HAS_GETPGRP:
  *	This symbol, if defined, indicates that the getpgrp routine is
@@ -1546,8 +1550,8 @@
  *	This symbol, if defined, indicates that getpgrp needs one
  *	arguments whereas USG one needs none.
  */
-/*#define HAS_GETPGRP		/**/
-/*#define USE_BSD_GETPGRP	/**/
+/*#define HAS_GETPGRP		/ **/
+/*#define USE_BSD_GETPGRP	/ **/
 
 /* HAS_GETPROTOBYNAME:
  *	This symbol, if defined, indicates that the getprotobyname()
@@ -1570,7 +1574,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getprotobyname_r
  *	is defined.
  */
-/*#define HAS_GETPROTOBYNAME_R	   /**/
+/*#define HAS_GETPROTOBYNAME_R	   / **/
 #define GETPROTOBYNAME_R_PROTO 0	   /**/
 
 /* HAS_GETPROTOBYNUMBER_R:
@@ -1583,7 +1587,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getprotobynumber_r
  *	is defined.
  */
-/*#define HAS_GETPROTOBYNUMBER_R	   /**/
+/*#define HAS_GETPROTOBYNUMBER_R	   / **/
 #define GETPROTOBYNUMBER_R_PROTO 0	   /**/
 
 /* HAS_GETPROTOENT_R:
@@ -1596,7 +1600,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getprotoent_r
  *	is defined.
  */
-/*#define HAS_GETPROTOENT_R	   /**/
+/*#define HAS_GETPROTOENT_R	   / **/
 #define GETPROTOENT_R_PROTO 0	   /**/
 
 /* HAS_GETPROTO_PROTOS:
@@ -1612,7 +1616,7 @@
  *	available for sequential access of the passwd database.
  *	If this is not available, the older getpw() function may be available.
  */
-/*#define HAS_GETPWENT		/**/
+/*#define HAS_GETPWENT		/ **/
 
 /* HAS_GETPWENT_R:
  *	This symbol, if defined, indicates that the getpwent_r routine
@@ -1624,7 +1628,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getpwent_r
  *	is defined.
  */
-/*#define HAS_GETPWENT_R	   /**/
+/*#define HAS_GETPWENT_R	   / **/
 #define GETPWENT_R_PROTO 0	   /**/
 
 /* HAS_GETPWNAM_R:
@@ -1637,7 +1641,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getpwnam_r
  *	is defined.
  */
-/*#define HAS_GETPWNAM_R	   /**/
+/*#define HAS_GETPWNAM_R	   / **/
 #define GETPWNAM_R_PROTO 0	   /**/
 
 /* HAS_GETPWUID_R:
@@ -1650,14 +1654,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getpwuid_r
  *	is defined.
  */
-/*#define HAS_GETPWUID_R	   /**/
+/*#define HAS_GETPWUID_R	   / **/
 #define GETPWUID_R_PROTO 0	   /**/
 
 /* HAS_GETSERVENT:
  *	This symbol, if defined, indicates that the getservent() routine is
  *	available to look up network services in some data base or another.
  */
-/*#define HAS_GETSERVENT		/**/
+/*#define HAS_GETSERVENT		/ **/
 
 /* HAS_GETSERVBYNAME_R:
  *	This symbol, if defined, indicates that the getservbyname_r routine
@@ -1669,7 +1673,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getservbyname_r
  *	is defined.
  */
-/*#define HAS_GETSERVBYNAME_R	   /**/
+/*#define HAS_GETSERVBYNAME_R	   / **/
 #define GETSERVBYNAME_R_PROTO 0	   /**/
 
 /* HAS_GETSERVBYPORT_R:
@@ -1682,7 +1686,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getservbyport_r
  *	is defined.
  */
-/*#define HAS_GETSERVBYPORT_R	   /**/
+/*#define HAS_GETSERVBYPORT_R	   / **/
 #define GETSERVBYPORT_R_PROTO 0	   /**/
 
 /* HAS_GETSERVENT_R:
@@ -1695,7 +1699,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getservent_r
  *	is defined.
  */
-/*#define HAS_GETSERVENT_R	   /**/
+/*#define HAS_GETSERVENT_R	   / **/
 #define GETSERVENT_R_PROTO 0	   /**/
 
 /* HAS_GETSERV_PROTOS:
@@ -1716,7 +1720,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getspnam_r
  *	is defined.
  */
-/*#define HAS_GETSPNAM_R	   /**/
+/*#define HAS_GETSPNAM_R	   / **/
 #define GETSPNAM_R_PROTO 0	   /**/
 
 /* HAS_GETSERVBYNAME:
@@ -1740,7 +1744,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_gmtime_r
  *	is defined.
  */
-/*#define HAS_GMTIME_R	   /**/
+/*#define HAS_GMTIME_R	   / **/
 #define GMTIME_R_PROTO 0	   /**/
 
 /* HAS_HTONL:
@@ -1778,7 +1782,7 @@
  *	changes using \undef{TZ} without explicitly calling tzset
  *	impossible. This symbol makes us call tzset before localtime_r
  */
-/*#define LOCALTIME_R_NEEDS_TZSET /**/
+/*#define LOCALTIME_R_NEEDS_TZSET / **/
 #ifdef LOCALTIME_R_NEEDS_TZSET
 #define L_R_TZSET tzset(),
 #else
@@ -1791,7 +1795,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_localtime_r
  *	is defined.
  */
-/*#define HAS_LOCALTIME_R	   /**/
+/*#define HAS_LOCALTIME_R	   / **/
 #define LOCALTIME_R_PROTO 0	   /**/
 
 /* HAS_LONG_DOUBLE:
@@ -1820,7 +1824,7 @@
  *	C preprocessor can make decisions based on it.  It is only
  *	defined if the system supports long long.
  */
-/*#define HAS_LONG_LONG		/**/
+/*#define HAS_LONG_LONG		/ **/
 #ifdef HAS_LONG_LONG
 #define LONGLONGSIZE 8		/**/
 #endif
@@ -1844,7 +1848,7 @@
  *	available to exclusively create and open a uniquely named
  *	temporary file.
  */
-/*#define HAS_MKSTEMP		/**/
+/*#define HAS_MKSTEMP		/ **/
 
 /* HAS_MMAP:
  *	This symbol, if defined, indicates that the mmap system call is
@@ -1855,14 +1859,14 @@
  *	(and simultaneously the type of the first argument).
  *	Usually set to 'void *' or 'caddr_t'.
  */
-/*#define HAS_MMAP		/**/
+/*#define HAS_MMAP		/ **/
 #define Mmap_t void *	/**/
 
 /* HAS_MSG:
  *	This symbol, if defined, indicates that the entire msg*(2) library is
  *	supported (IPC mechanism based on message queues).
  */
-/*#define HAS_MSG		/**/
+/*#define HAS_MSG		/ **/
 
 /* OLD_PTHREAD_CREATE_JOINABLE:
  *	This symbol, if defined, indicates how to create pthread
@@ -1872,13 +1876,13 @@
  *	If defined, known values are PTHREAD_CREATE_UNDETACHED
  *	and __UNDETACHED.
  */
-/*#define OLD_PTHREAD_CREATE_JOINABLE  /**/
+/*#define OLD_PTHREAD_CREATE_JOINABLE  / **/
 
 /* HAS_PTHREAD_ATFORK:
  *	This symbol, if defined, indicates that the pthread_atfork routine
  *	is available to setup fork handlers.
  */
-/*#define HAS_PTHREAD_ATFORK		/**/
+/*#define HAS_PTHREAD_ATFORK		/ **/
 
 /* HAS_PTHREAD_YIELD:
  *	This symbol, if defined, indicates that the pthread_yield
@@ -1895,9 +1899,9 @@
  *	routine is available to yield the execution of the current
  *	thread.	 sched_yield is preferable to pthread_yield.
  */
-/*#define HAS_PTHREAD_YIELD	/**/
+/*#define HAS_PTHREAD_YIELD	/ **/
 #define SCHED_YIELD		/**/
-/*#define HAS_SCHED_YIELD	/**/
+/*#define HAS_SCHED_YIELD	/ **/
 
 /* HAS_RANDOM_R:
  *	This symbol, if defined, indicates that the random_r routine
@@ -1909,7 +1913,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_random_r
  *	is defined.
  */
-/*#define HAS_RANDOM_R	   /**/
+/*#define HAS_RANDOM_R	   / **/
 #define RANDOM_R_PROTO 0	   /**/
 
 /* HAS_READDIR64_R:
@@ -1922,7 +1926,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_readdir64_r
  *	is defined.
  */
-/*#define HAS_READDIR64_R	   /**/
+/*#define HAS_READDIR64_R	   / **/
 #define READDIR64_R_PROTO 0	   /**/
 
 /* HAS_READDIR_R:
@@ -1935,20 +1939,20 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_readdir_r
  *	is defined.
  */
-/*#define HAS_READDIR_R	   /**/
+/*#define HAS_READDIR_R	   / **/
 #define READDIR_R_PROTO 0	   /**/
 
 /* HAS_SEM:
  *	This symbol, if defined, indicates that the entire sem*(2) library is
  *	supported.
  */
-/*#define HAS_SEM		/**/
+/*#define HAS_SEM		/ **/
 
 /* HAS_SETGRENT:
  *	This symbol, if defined, indicates that the setgrent routine is
  *	available for initializing sequential access of the group database.
  */
-/*#define HAS_SETGRENT		/**/
+/*#define HAS_SETGRENT		/ **/
 
 /* HAS_SETGRENT_R:
  *	This symbol, if defined, indicates that the setgrent_r routine
@@ -1960,14 +1964,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_setgrent_r
  *	is defined.
  */
-/*#define HAS_SETGRENT_R	   /**/
+/*#define HAS_SETGRENT_R	   / **/
 #define SETGRENT_R_PROTO 0	   /**/
 
 /* HAS_SETHOSTENT:
  *	This symbol, if defined, indicates that the sethostent() routine is
  *	available.
  */
-/*#define HAS_SETHOSTENT		/**/
+/*#define HAS_SETHOSTENT		/ **/
 
 /* HAS_SETHOSTENT_R:
  *	This symbol, if defined, indicates that the sethostent_r routine
@@ -1979,7 +1983,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_sethostent_r
  *	is defined.
  */
-/*#define HAS_SETHOSTENT_R	   /**/
+/*#define HAS_SETHOSTENT_R	   / **/
 #define SETHOSTENT_R_PROTO 0	   /**/
 
 /* HAS_SETLOCALE_R:
@@ -1992,14 +1996,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_setlocale_r
  *	is defined.
  */
-/*#define HAS_SETLOCALE_R	   /**/
+/*#define HAS_SETLOCALE_R	   / **/
 #define SETLOCALE_R_PROTO 0	   /**/
 
 /* HAS_SETNETENT:
  *	This symbol, if defined, indicates that the setnetent() routine is
  *	available.
  */
-/*#define HAS_SETNETENT		/**/
+/*#define HAS_SETNETENT		/ **/
 
 /* HAS_SETNETENT_R:
  *	This symbol, if defined, indicates that the setnetent_r routine
@@ -2011,14 +2015,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_setnetent_r
  *	is defined.
  */
-/*#define HAS_SETNETENT_R	   /**/
+/*#define HAS_SETNETENT_R	   / **/
 #define SETNETENT_R_PROTO 0	   /**/
 
 /* HAS_SETPROTOENT:
  *	This symbol, if defined, indicates that the setprotoent() routine is
  *	available.
  */
-/*#define HAS_SETPROTOENT		/**/
+/*#define HAS_SETPROTOENT		/ **/
 
 /* HAS_SETPGRP:
  *	This symbol, if defined, indicates that the setpgrp routine is
@@ -2029,8 +2033,8 @@
  *	arguments whereas USG one needs none.  See also HAS_SETPGID
  *	for a POSIX interface.
  */
-/*#define HAS_SETPGRP		/**/
-/*#define USE_BSD_SETPGRP	/**/
+/*#define HAS_SETPGRP		/ **/
+/*#define USE_BSD_SETPGRP	/ **/
 
 /* HAS_SETPROTOENT_R:
  *	This symbol, if defined, indicates that the setprotoent_r routine
@@ -2042,14 +2046,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_setprotoent_r
  *	is defined.
  */
-/*#define HAS_SETPROTOENT_R	   /**/
+/*#define HAS_SETPROTOENT_R	   / **/
 #define SETPROTOENT_R_PROTO 0	   /**/
 
 /* HAS_SETPWENT:
  *	This symbol, if defined, indicates that the setpwent routine is
  *	available for initializing sequential access of the passwd database.
  */
-/*#define HAS_SETPWENT		/**/
+/*#define HAS_SETPWENT		/ **/
 
 /* HAS_SETPWENT_R:
  *	This symbol, if defined, indicates that the setpwent_r routine
@@ -2061,14 +2065,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_setpwent_r
  *	is defined.
  */
-/*#define HAS_SETPWENT_R	   /**/
+/*#define HAS_SETPWENT_R	   / **/
 #define SETPWENT_R_PROTO 0	   /**/
 
 /* HAS_SETSERVENT:
  *	This symbol, if defined, indicates that the setservent() routine is
  *	available.
  */
-/*#define HAS_SETSERVENT		/**/
+/*#define HAS_SETSERVENT		/ **/
 
 /* HAS_SETSERVENT_R:
  *	This symbol, if defined, indicates that the setservent_r routine
@@ -2080,7 +2084,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_setservent_r
  *	is defined.
  */
-/*#define HAS_SETSERVENT_R	   /**/
+/*#define HAS_SETSERVENT_R	   / **/
 #define SETSERVENT_R_PROTO 0	   /**/
 
 /* HAS_SETVBUF:
@@ -2094,7 +2098,7 @@
  *	This symbol, if defined, indicates that the entire shm*(2) library is
  *	supported.
  */
-/*#define HAS_SHM		/**/
+/*#define HAS_SHM		/ **/
 
 /* Shmat_t:
  *	This symbol holds the return type of the shmat() system call.
@@ -2108,7 +2112,7 @@
  *	when HAS_SHMAT_PROTOTYPE is not defined to avoid conflicting defs.
  */
 #define Shmat_t void *	/**/
-/*#define HAS_SHMAT_PROTOTYPE	/**/
+/*#define HAS_SHMAT_PROTOTYPE	/ **/
 
 /* HAS_SOCKET:
  *	This symbol, if defined, indicates that the BSD socket interface is
@@ -2149,13 +2153,13 @@
  *	has been known to be an enum.
  */
 #define	HAS_SOCKET		/**/
-/*#define	HAS_SOCKETPAIR	/**/
-/*#define	HAS_MSG_CTRUNC	/**/
-/*#define	HAS_MSG_DONTROUTE	/**/
-/*#define	HAS_MSG_OOB	/**/
-/*#define	HAS_MSG_PEEK	/**/
-/*#define	HAS_MSG_PROXY	/**/
-/*#define	HAS_SCM_RIGHTS	/**/
+/*#define	HAS_SOCKETPAIR	/ **/
+/*#define	HAS_MSG_CTRUNC	/ **/
+/*#define	HAS_MSG_DONTROUTE	/ **/
+/*#define	HAS_MSG_OOB	/ **/
+/*#define	HAS_MSG_PEEK	/ **/
+/*#define	HAS_MSG_PROXY	/ **/
+/*#define	HAS_SCM_RIGHTS	/ **/
 
 /* HAS_SRAND48_R:
  *	This symbol, if defined, indicates that the srand48_r routine
@@ -2167,7 +2171,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_srand48_r
  *	is defined.
  */
-/*#define HAS_SRAND48_R	   /**/
+/*#define HAS_SRAND48_R	   / **/
 #define SRAND48_R_PROTO 0	   /**/
 
 /* HAS_SRANDOM_R:
@@ -2180,7 +2184,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_srandom_r
  *	is defined.
  */
-/*#define HAS_SRANDOM_R	   /**/
+/*#define HAS_SRANDOM_R	   / **/
 #define SRANDOM_R_PROTO 0	   /**/
 
 /* USE_STAT_BLOCKS:
@@ -2188,7 +2192,7 @@
  *	st_blksize and st_blocks.
  */
 #ifndef USE_STAT_BLOCKS
-/*#define USE_STAT_BLOCKS 	/**/
+/*#define USE_STAT_BLOCKS 	/ **/
 #endif
 
 /* USE_STRUCT_COPY:
@@ -2227,7 +2231,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_strerror_r
  *	is defined.
  */
-/*#define HAS_STRERROR_R	   /**/
+/*#define HAS_STRERROR_R	   / **/
 #define STRERROR_R_PROTO 0	   /**/
 
 /* HAS_STRTOUL:
@@ -2264,7 +2268,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_tmpnam_r
  *	is defined.
  */
-/*#define HAS_TMPNAM_R	   /**/
+/*#define HAS_TMPNAM_R	   / **/
 #define TMPNAM_R_PROTO 0	   /**/
 
 /* HAS_TTYNAME_R:
@@ -2277,7 +2281,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_ttyname_r
  *	is defined.
  */
-/*#define HAS_TTYNAME_R	   /**/
+/*#define HAS_TTYNAME_R	   / **/
 #define TTYNAME_R_PROTO 0	   /**/
 
 /* HAS_UNION_SEMUN:
@@ -2299,19 +2303,19 @@
  *	used for semctl IPC_STAT.
  */
 #define HAS_UNION_SEMUN	/**/
-/*#define USE_SEMCTL_SEMUN	/**/
-/*#define USE_SEMCTL_SEMID_DS	/**/
+/*#define USE_SEMCTL_SEMUN	/ **/
+/*#define USE_SEMCTL_SEMID_DS	/ **/
 
 /* HAS_VFORK:
  *	This symbol, if defined, indicates that vfork() exists.
  */
-/*#define HAS_VFORK	/**/
+/*#define HAS_VFORK	/ **/
 
 /* HAS_PSEUDOFORK:
  *	This symbol, if defined, indicates that an emulation of the
  *	fork routine is available.
  */
-/*#define HAS_PSEUDOFORK	/**/
+/*#define HAS_PSEUDOFORK	/ **/
 
 /* Signal_t:
  *	This symbol's value is either "void" or "int", corresponding to the
@@ -2390,14 +2394,14 @@
  *	This symbol, if defined, indicates to the C program that struct group
  *	in <grp.h> contains gr_passwd.
  */
-/*#define I_GRP		/**/
-/*#define GRPASSWD	/**/
+/*#define I_GRP		/ **/
+/*#define GRPASSWD	/ **/
 
 /* I_MACH_CTHREADS:
  *     This symbol, if defined, indicates to the C program that it should
  *     include <mach/cthreads.h>.
  */
-/*#define   I_MACH_CTHREADS	/**/
+/*#define   I_MACH_CTHREADS	/ **/
 
 /* I_NDBM:
  *	This symbol, if defined, indicates that <ndbm.h> exists and should
@@ -2431,30 +2435,30 @@
  *	parameter information. While ANSI C prototypes are supported in C++,
  *	K&R style function declarations will yield errors.
  */
-/*#define I_NDBM	/**/
-/*#define I_GDBMNDBM	/**/
-/*#define I_GDBM_NDBM	/**/
-/*#define NDBM_H_USES_PROTOTYPES	/**/
-/*#define GDBMNDBM_H_USES_PROTOTYPES	/**/
-/*#define GDBM_NDBM_H_USES_PROTOTYPES	/**/
+/*#define I_NDBM	/ **/
+/*#define I_GDBMNDBM	/ **/
+/*#define I_GDBM_NDBM	/ **/
+/*#define NDBM_H_USES_PROTOTYPES	/ **/
+/*#define GDBMNDBM_H_USES_PROTOTYPES	/ **/
+/*#define GDBM_NDBM_H_USES_PROTOTYPES	/ **/
 
 /* I_NETDB:
  *	This symbol, if defined, indicates that <netdb.h> exists and
  *	should be included.
  */
-/*#define I_NETDB		/**/
+/*#define I_NETDB		/ **/
 
 /* I_NET_ERRNO:
  *	This symbol, if defined, indicates that <net/errno.h> exists and
  *	should be included.
  */
-/*#define I_NET_ERRNO		/**/
+/*#define I_NET_ERRNO		/ **/
 
 /* I_PTHREAD:
  *     This symbol, if defined, indicates to the C program that it should
  *     include <pthread.h>.
  */
-/*#define   I_PTHREAD	/**/
+/*#define   I_PTHREAD	/ **/
 
 /* I_PWD:
  *	This symbol, if defined, indicates to the C program that it should
@@ -2492,33 +2496,33 @@
  *	This symbol, if defined, indicates to the C program that struct passwd
  *	contains pw_passwd.
  */
-/*#define I_PWD		/**/
-/*#define PWQUOTA	/**/
-/*#define PWAGE	/**/
-/*#define PWCHANGE	/**/
-/*#define PWCLASS	/**/
-/*#define PWEXPIRE	/**/
-/*#define PWCOMMENT	/**/
-/*#define PWGECOS	/**/
-/*#define PWPASSWD	/**/
+/*#define I_PWD		/ **/
+/*#define PWQUOTA	/ **/
+/*#define PWAGE	/ **/
+/*#define PWCHANGE	/ **/
+/*#define PWCLASS	/ **/
+/*#define PWEXPIRE	/ **/
+/*#define PWCOMMENT	/ **/
+/*#define PWGECOS	/ **/
+/*#define PWPASSWD	/ **/
 
 /* I_SYS_ACCESS:
  *     This symbol, if defined, indicates to the C program that it should
  *     include <sys/access.h>.
  */
-/*#define   I_SYS_ACCESS                /**/
+/*#define   I_SYS_ACCESS                / **/
 
 /* I_SYS_SECURITY:
  *     This symbol, if defined, indicates to the C program that it should
  *     include <sys/security.h>.
  */
-/*#define   I_SYS_SECURITY	/**/
+/*#define   I_SYS_SECURITY	/ **/
 
 /* I_SYSUIO:
  *	This symbol, if defined, indicates that <sys/uio.h> exists and
  *	should be included.
  */
-/*#define	I_SYSUIO		/**/
+/*#define	I_SYSUIO		/ **/
 
 /* I_STDARG:
  *	This symbol, if defined, indicates that <stdarg.h> exists and should
@@ -2529,7 +2533,7 @@
  *	include <varargs.h>.
  */
 #define I_STDARG		/**/
-/*#define I_VARARGS	/**/
+/*#define I_VARARGS	/ **/
 
 /* PERL_INC_VERSION_LIST:
  *	This variable specifies the list of subdirectories in over
@@ -2538,13 +2542,13 @@
  *	for a C initialization string.  See the inc_version_list entry
  *	in Porting/Glossary for more details.
  */
-/*#define PERL_INC_VERSION_LIST 0		/**/
+/*#define PERL_INC_VERSION_LIST 0		/ **/
 
 /* INSTALL_USR_BIN_PERL:
  *	This symbol, if defined, indicates that Perl is to be installed
  * 	also as /usr/bin/perl.
  */
-/*#define INSTALL_USR_BIN_PERL	/**/
+/*#define INSTALL_USR_BIN_PERL	/ **/
 
 /* Off_t:
  *	This symbol holds the type used to declare offsets in the kernel.
@@ -2579,7 +2583,7 @@
 /* MYMALLOC:
  *	This symbol, if defined, indicates that we're using our own malloc.
  */
-/*#define MYMALLOC			/**/
+/*#define MYMALLOC			/ **/
 
 /* Mode_t:
  *	This symbol holds the type used to declare file modes
@@ -2618,7 +2622,7 @@
  *	and architecture-specific directories.  See PERL_INC_VERSION_LIST
  *	for more details.
  */
-/*#define PERL_OTHERLIBDIRS ""		/**/
+/*#define PERL_OTHERLIBDIRS ""		/ **/
 
 /* Pid_t:
  *	This symbol holds the type used to declare process ids in the kernel.
@@ -2638,7 +2642,7 @@
  *	in programs that are not prepared to deal with ~ expansion at run-time.
  */
 #define PRIVLIB "c:\\perl\\lib"		/**/
-#define PRIVLIB_EXP (win32_get_privlib("5.11.0"))	/**/
+#define PRIVLIB_EXP (win32_get_privlib(PERL_VERSION_STRING, NULL))	/**/
 
 /* CAN_PROTOTYPE:
  *	If defined, this macro indicates that the C compiler can handle
@@ -2731,7 +2735,7 @@
  *	in programs that are not prepared to deal with ~ expansion at run-time.
  */
 #define SITEARCH "c:\\perl\\site\\lib"		/**/
-/*#define SITEARCH_EXP ""	/**/
+/*#define SITEARCH_EXP ""	/ **/
 
 /* SITELIB:
  *	This symbol contains the name of the private library for this package.
@@ -2754,7 +2758,7 @@
  *	be tacked onto this variable to generate a list of directories to search.
  */
 #define SITELIB "c:\\perl\\site\\lib"		/**/
-#define SITELIB_EXP (win32_get_sitelib("5.11.0"))	/**/
+#define SITELIB_EXP (win32_get_sitelib(PERL_VERSION_STRING, NULL))	/**/
 #define SITELIB_STEM ""		/**/
 
 /* Size_t_size:
@@ -2823,13 +2827,13 @@
  *	try to use the various _r versions of library functions.
  *	This is extremely experimental.
  */
-/*#define	USE_5005THREADS		/**/
-/*#define	USE_ITHREADS		/**/
+/*#define	USE_5005THREADS		/ **/
+/*#define	USE_ITHREADS		/ **/
 #if defined(USE_5005THREADS) && !defined(USE_ITHREADS)
 #define		USE_THREADS		/* until src is revised*/
 #endif
-/*#define	OLD_PTHREADS_API		/**/
-/*#define	USE_REENTRANT_API	/**/
+/*#define	OLD_PTHREADS_API		/ **/
+/*#define	USE_REENTRANT_API	/ **/
 
 /* PERL_VENDORARCH:
  *	If defined, this symbol contains the name of a private library.
@@ -2846,8 +2850,8 @@
  *	This symbol contains the ~name expanded version of PERL_VENDORARCH, to be used
  *	in programs that are not prepared to deal with ~ expansion at run-time.
  */
-/*#define PERL_VENDORARCH ""		/**/
-/*#define PERL_VENDORARCH_EXP ""		/**/
+/*#define PERL_VENDORARCH ""		/ **/
+/*#define PERL_VENDORARCH_EXP ""		/ **/
 
 /* PERL_VENDORLIB_EXP:
  *	This symbol contains the ~name expanded version of VENDORLIB, to be used
@@ -2858,8 +2862,8 @@
  *	removed.  The elements in inc_version_list (inc_version_list.U) can
  *	be tacked onto this variable to generate a list of directories to search.
  */
-/*#define PERL_VENDORLIB_EXP ""		/**/
-/*#define PERL_VENDORLIB_STEM ""		/**/
+/*#define PERL_VENDORLIB_EXP ""		/ **/
+/*#define PERL_VENDORLIB_STEM ""		/ **/
 
 /* VOIDFLAGS:
  *	This symbol indicates how much support of the void type is given by this
@@ -2894,7 +2898,7 @@
  *	Perl has been cross-compiled to.  Undefined if not a cross-compile.
  */
 #ifndef USE_CROSS_COMPILE
-/*#define	USE_CROSS_COMPILE	/**/
+/*#define	USE_CROSS_COMPILE	/ **/
 #define	PERL_TARGETARCH	""	/**/
 #endif
 
@@ -2952,6 +2956,12 @@
 #define BYTEORDER 0x1234	/* large digits for MSB */
 #endif /* NeXT */
 
+/* CHARBITS:
+ *	This symbol contains the size of a char, so that the C preprocessor
+ *	can make decisions based on it.
+ */
+#define CHARBITS 8		/**/
+
 /* CASTI32:
  *	This symbol is defined if the C compiler can cast negative
  *	or large floating point numbers to 32-bit ints.
@@ -2979,7 +2989,7 @@
  *	This symbol, if defined, indicates that the closedir() routine
  *	does not return a value.
  */
-/*#define VOID_CLOSEDIR		/**/
+/*#define VOID_CLOSEDIR		/ **/
 
 /* HAS_FD_SET:
  *	This symbol, when defined, indicates presence of the fd_set typedef
@@ -3009,14 +3019,14 @@
  *	is available to get system page size, which is the granularity of
  *	many memory management calls.
  */
-/*#define HAS_GETPAGESIZE		/**/
+/*#define HAS_GETPAGESIZE		/ **/
 
 /* HAS_GNULIBC:
  *	This symbol, if defined, indicates to the C program that
  *	the GNU C library is being used.  A better check is to use
  *	the __GLIBC__ and __GLIBC_MINOR__ symbols supplied with glibc.
  */
-/*#define HAS_GNULIBC  	/**/
+/*#define HAS_GNULIBC  	/ **/
 #if defined(HAS_GNULIBC) && !defined(_GNU_SOURCE)
 #   define _GNU_SOURCE
 #endif
@@ -3032,13 +3042,13 @@
  *	available to operate on a symbolic link (instead of following the
  *	link).
  */
-/*#define HAS_LCHOWN		/**/
+/*#define HAS_LCHOWN		/ **/
 
 /* HAS_OPEN3:
  *	This manifest constant lets the C program know that the three
  *	argument form of open(2) is available.
  */
-/*#define HAS_OPEN3		/**/
+/*#define HAS_OPEN3		/ **/
 
 /* HAS_SAFE_BCOPY:
  *	This symbol, if defined, indicates that the bcopy routine is available
@@ -3046,7 +3056,7 @@
  *	probably use memmove() or memcpy(). If neither is defined, roll your
  *	own version.
  */
-/*#define HAS_SAFE_BCOPY	/**/
+/*#define HAS_SAFE_BCOPY	/ **/
 
 /* HAS_SAFE_MEMCPY:
  *	This symbol, if defined, indicates that the memcpy routine is available
@@ -3054,7 +3064,7 @@
  *	copy overlapping memory blocks, you should check HAS_MEMMOVE and
  *	use memmove() instead, if available.
  */
-/*#define HAS_SAFE_MEMCPY	/**/
+/*#define HAS_SAFE_MEMCPY	/ **/
 
 /* HAS_SANE_MEMCMP:
  *	This symbol, if defined, indicates that the memcmp routine is available
@@ -3067,7 +3077,7 @@
  *	This symbol, if defined, indicates that Vr4's sigaction() routine
  *	is available.
  */
-/*#define HAS_SIGACTION	/**/
+/*#define HAS_SIGACTION	/ **/
 
 /* HAS_SIGSETJMP:
  *	This variable indicates to the C program that the sigsetjmp()
@@ -3089,7 +3099,7 @@
  *	traditional longjmp() if siglongjmp isn't available.
  *	See HAS_SIGSETJMP.
  */
-/*#define HAS_SIGSETJMP	/**/
+/*#define HAS_SIGSETJMP	/ **/
 #ifdef HAS_SIGSETJMP
 #define Sigjmp_buf sigjmp_buf
 #define Sigsetjmp(buf,save_mask) sigsetjmp((buf),(save_mask))
@@ -3140,7 +3150,7 @@
 #define STDIO_PTR_LVALUE 		/**/
 #define FILE_cnt(fp)	((fp)->_cnt)
 #define STDIO_CNT_LVALUE 		/**/
-/*#define STDIO_PTR_LVAL_SETS_CNT	/**/
+/*#define STDIO_PTR_LVAL_SETS_CNT	/ **/
 #define STDIO_PTR_LVAL_NOCHANGE_CNT	/**/
 #endif
 
@@ -3182,7 +3192,7 @@
  *	symbol.
  */
 #define HAS_VPRINTF	/**/
-/*#define USE_CHAR_VSPRINTF 	/**/
+/*#define USE_CHAR_VSPRINTF 	/ **/
 
 /* DOUBLESIZE:
  *	This symbol contains the size of a double, so that the C preprocessor
@@ -3211,10 +3221,10 @@
  *	the struct tm has a tm_gmtoff field.
  */
 #define I_TIME		/**/
-/*#define I_SYS_TIME		/**/
-/*#define I_SYS_TIME_KERNEL		/**/
-/*#define HAS_TM_TM_ZONE		/**/
-/*#define HAS_TM_TM_GMTOFF		/**/
+/*#define I_SYS_TIME		/ **/
+/*#define I_SYS_TIME_KERNEL		/ **/
+/*#define HAS_TM_TM_ZONE		/ **/
+/*#define HAS_TM_TM_GMTOFF		/ **/
 
 /* VAL_O_NONBLOCK:
  *	This symbol is to be used during open() or fcntl(F_SETFL) to turn on
@@ -3290,38 +3300,58 @@
  *     This symbol, if defined, indicates that this system uses
  *	EBCDIC encoding.
  */
-/*#define	EBCDIC 		/**/
+/*#define	EBCDIC 		/ **/
+
+/* SETUID_SCRIPTS_ARE_SECURE_NOW:
+ *	This symbol, if defined, indicates that the bug that prevents
+ *	setuid scripts from being secure is not present in this kernel.
+ */
+/* DOSUID:
+ *	This symbol, if defined, indicates that the C program should
+ *	check the script that it is executing for setuid/setgid bits, and
+ *	attempt to emulate setuid/setgid on systems that have disabled
+ *	setuid #! scripts because the kernel can't do it securely.
+ *	It is up to the package designer to make sure that this emulation
+ *	is done securely.  Among other things, it should do an fstat on
+ *	the script it just opened to make sure it really is a setuid/setgid
+ *	script, it should make sure the arguments passed correspond exactly
+ *	to the argument on the #! line, and it should not trust any
+ *	subprocesses to which it must pass the filename rather than the
+ *	file descriptor of the script to be executed.
+ */
+/*#define SETUID_SCRIPTS_ARE_SECURE_NOW	/ **/
+/*#define DOSUID		/ **/
 
 /* PERL_USE_DEVEL:
  *	This symbol, if defined, indicates that Perl was configured with
  *	-Dusedevel, to enable development features.  This should not be
  *	done for production builds.
  */
-/*#define	PERL_USE_DEVEL		/**/
+/*#define	PERL_USE_DEVEL		/ **/
 
 /* HAS_ATOLF:
  *	This symbol, if defined, indicates that the atolf routine is
  *	available to convert strings into long doubles.
  */
-/*#define HAS_ATOLF		/**/
+/*#define HAS_ATOLF		/ **/
 
 /* HAS_ATOLL:
  *	This symbol, if defined, indicates that the atoll routine is
  *	available to convert strings into long longs.
  */
-/*#define HAS_ATOLL		/**/
+/*#define HAS_ATOLL		/ **/
 
 /* HAS__FWALK:
  *	This symbol, if defined, indicates that the _fwalk system call is
  *	available to apply a function to all the file handles.
  */
-/*#define HAS__FWALK		/**/
+/*#define HAS__FWALK		/ **/
 
 /* HAS_AINTL:
  *	This symbol, if defined, indicates that the aintl routine is
  *	available.  If copysignl is also present we can emulate modfl.
  */
-/*#define HAS_AINTL		/**/
+/*#define HAS_AINTL		/ **/
 
 /* HAS_BUILTIN_CHOOSE_EXPR:
  *	Can we handle GCC builtin for compile-time ternary-like expressions
@@ -3330,13 +3360,13 @@
  *	Can we handle GCC builtin for telling that certain values are more
  *	likely
  */
-/*#define HAS_BUILTIN_EXPECT	/**/
-/*#define HAS_BUILTIN_CHOOSE_EXPR	/**/
+/*#define HAS_BUILTIN_EXPECT	/ **/
+/*#define HAS_BUILTIN_CHOOSE_EXPR	/ **/
 
 /* HAS_C99_VARIADIC_MACROS:
  *	If defined, the compiler supports C99 variadic macros.
  */
-/*#define	HAS_C99_VARIADIC_MACROS	/**/
+/*#define	HAS_C99_VARIADIC_MACROS	/ **/
 
 /* HAS_CLASS:
  *	This symbol, if defined, indicates that the class routine is
@@ -3354,31 +3384,31 @@
  *	FP_NANS		Signaling Not a Number (NaNS)
  *	FP_NANQ		Quiet Not a Number (NaNQ)
  */
-/*#define HAS_CLASS		/**/
+/*#define HAS_CLASS		/ **/
 
 /* HAS_CLEARENV:
  *	This symbol, if defined, indicates that the clearenv () routine is
  *	available for use.
  */
-/*#define HAS_CLEARENV		/**/
+/*#define HAS_CLEARENV		/ **/
 
 /* HAS_STRUCT_CMSGHDR:
  *	This symbol, if defined, indicates that the struct cmsghdr
  *	is supported.
  */
-/*#define HAS_STRUCT_CMSGHDR	/**/
+/*#define HAS_STRUCT_CMSGHDR	/ **/
 
 /* HAS_COPYSIGNL:
  *	This symbol, if defined, indicates that the copysignl routine is
  *	available.  If aintl is also present we can emulate modfl.
  */
-/*#define HAS_COPYSIGNL		/**/
+/*#define HAS_COPYSIGNL		/ **/
 
 /* USE_CPLUSPLUS:
  *	This symbol, if defined, indicates that a C++ compiler was
  *	used to compiled Perl and will be used to compile extensions.
  */
-/*#define USE_CPLUSPLUS		/**/
+/*#define USE_CPLUSPLUS		/ **/
 
 /* HAS_DBMINIT_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3386,19 +3416,19 @@
  *	to the program to supply one.  A good guess is
  *		extern int dbminit(char *);
  */
-/*#define	HAS_DBMINIT_PROTO	/**/
+/*#define	HAS_DBMINIT_PROTO	/ **/
 
 /* HAS_DIR_DD_FD:
  *	This symbol, if defined, indicates that the the DIR* dirstream
  *	structure contains a member variable named dd_fd.
  */
-/*#define HAS_DIR_DD_FD		/**/
+/*#define HAS_DIR_DD_FD		/ **/
 
 /* HAS_DIRFD:
  *	This manifest constant lets the C program know that dirfd
  *	is available.
  */
-/*#define HAS_DIRFD		/**/
+/*#define HAS_DIRFD		/ **/
 
 /* DLSYM_NEEDS_UNDERSCORE:
  *	This symbol, if defined, indicates that we need to prepend an
@@ -3406,7 +3436,7 @@
  *	makes sense if you *have* dlsym, which we will presume is the
  *	case if you're using dl_dlopen.xs.
  */
-/*#define 	DLSYM_NEEDS_UNDERSCORE 	/**/
+/*#define 	DLSYM_NEEDS_UNDERSCORE 	/ **/
 
 /* HAS_FAST_STDIO:
  *	This symbol, if defined, indicates that the "fast stdio"
@@ -3418,27 +3448,27 @@
  *	This symbol, if defined, indicates that the fchdir routine is
  *	available to change directory using a file descriptor.
  */
-/*#define HAS_FCHDIR		/**/
+/*#define HAS_FCHDIR		/ **/
 
 /* FCNTL_CAN_LOCK:
  *	This symbol, if defined, indicates that fcntl() can be used
  *	for file locking.  Normally on Unix systems this is defined.
  *	It may be undefined on VMS.
  */
-/*#define FCNTL_CAN_LOCK		/**/
+/*#define FCNTL_CAN_LOCK		/ **/
 
 /* HAS_FINITE:
  *	This symbol, if defined, indicates that the finite routine is
  *	available to check whether a double is finite (non-infinity non-NaN).
  */
-/*#define HAS_FINITE		/**/
+/*#define HAS_FINITE		/ **/
 
 /* HAS_FINITEL:
  *	This symbol, if defined, indicates that the finitel routine is
  *	available to check whether a long double is finite
  *	(non-infinity non-NaN).
  */
-/*#define HAS_FINITEL		/**/
+/*#define HAS_FINITEL		/ **/
 
 /* HAS_FLOCK_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3464,7 +3494,7 @@
  *	FP_POS_ZERO       +0.0 (positive zero)
  *	FP_NEG_ZERO       -0.0 (negative zero)
  */
-/*#define HAS_FP_CLASS		/**/
+/*#define HAS_FP_CLASS		/ **/
 
 /* HAS_FPCLASS:
  *	This symbol, if defined, indicates that the fpclass routine is
@@ -3482,7 +3512,7 @@
  *	FP_NNORM	negative normalized non-zero
  *	FP_PNORM	positive normalized non-zero
  */
-/*#define HAS_FPCLASS		/**/
+/*#define HAS_FPCLASS		/ **/
 
 /* HAS_FPCLASSIFY:
  *	This symbol, if defined, indicates that the fpclassify routine is
@@ -3496,7 +3526,7 @@
  *           FP_NAN        NaN
  *
  */
-/*#define HAS_FPCLASSIFY		/**/
+/*#define HAS_FPCLASSIFY		/ **/
 
 /* HAS_FPCLASSL:
  *	This symbol, if defined, indicates that the fpclassl routine is
@@ -3514,56 +3544,62 @@
  *	FP_NNORM	negative normalized non-zero
  *	FP_PNORM	positive normalized non-zero
  */
-/*#define HAS_FPCLASSL		/**/
+/*#define HAS_FPCLASSL		/ **/
 
 /* HAS_FPOS64_T:
  *	This symbol will be defined if the C compiler supports fpos64_t.
  */
-/*#define	HAS_FPOS64_T    	/**/
+/*#define	HAS_FPOS64_T    	/ **/
 
 /* HAS_FREXPL:
  *	This symbol, if defined, indicates that the frexpl routine is
  *	available to break a long double floating-point number into
  *	a normalized fraction and an integral power of 2.
  */
-/*#define HAS_FREXPL		/**/
+/*#define HAS_FREXPL		/ **/
 
 /* HAS_STRUCT_FS_DATA:
  *	This symbol, if defined, indicates that the struct fs_data
  *	to do statfs() is supported.
  */
-/*#define HAS_STRUCT_FS_DATA	/**/
+/*#define HAS_STRUCT_FS_DATA	/ **/
 
 /* HAS_FSEEKO:
  *	This symbol, if defined, indicates that the fseeko routine is
  *	available to fseek beyond 32 bits (useful for ILP32 hosts).
  */
-/*#define HAS_FSEEKO		/**/
+/*#define HAS_FSEEKO		/ **/
 
 /* HAS_FSTATFS:
  *	This symbol, if defined, indicates that the fstatfs routine is
  *	available to stat filesystems by file descriptors.
  */
-/*#define HAS_FSTATFS		/**/
+/*#define HAS_FSTATFS		/ **/
 
 /* HAS_FSYNC:
  *	This symbol, if defined, indicates that the fsync routine is
  *	available to write a file's modified data and attributes to
  *	permanent storage.
  */
-/*#define HAS_FSYNC		/**/
+/*#define HAS_FSYNC		/ **/
 
 /* HAS_FTELLO:
  *	This symbol, if defined, indicates that the ftello routine is
  *	available to ftell beyond 32 bits (useful for ILP32 hosts).
  */
-/*#define HAS_FTELLO		/**/
+/*#define HAS_FTELLO		/ **/
 
 /* HAS_FUTIMES:
  *	This symbol, if defined, indicates that the futimes routine is
  *	available to change file descriptor time stamps with struct timevals.
  */
-/*#define HAS_FUTIMES		/**/
+/*#define HAS_FUTIMES		/ **/
+
+/* HAS_GETADDRINFO:
+ *	This symbol, if defined, indicates that the getaddrinfo() function
+ *	is available for use.
+ */
+/*#define HAS_GETADDRINFO		/ **/
 
 /* HAS_GETCWD:
  *	This symbol, if defined, indicates that the getcwd routine is
@@ -3575,74 +3611,92 @@
  *	This symbol, if defined, indicates that the getespwnam system call is
  *	available to retrieve enchanced (shadow) password entries by name.
  */
-/*#define HAS_GETESPWNAM		/**/
+/*#define HAS_GETESPWNAM		/ **/
 
 /* HAS_GETFSSTAT:
  *	This symbol, if defined, indicates that the getfsstat routine is
  *	available to stat filesystems in bulk.
  */
-/*#define HAS_GETFSSTAT		/**/
+/*#define HAS_GETFSSTAT		/ **/
 
 /* HAS_GETITIMER:
  *	This symbol, if defined, indicates that the getitimer routine is
  *	available to return interval timers.
  */
-/*#define HAS_GETITIMER		/**/
+/*#define HAS_GETITIMER		/ **/
 
 /* HAS_GETMNT:
  *	This symbol, if defined, indicates that the getmnt routine is
  *	available to get filesystem mount info by filename.
  */
-/*#define HAS_GETMNT		/**/
+/*#define HAS_GETMNT		/ **/
 
 /* HAS_GETMNTENT:
  *	This symbol, if defined, indicates that the getmntent routine is
  *	available to iterate through mounted file systems to get their info.
  */
-/*#define HAS_GETMNTENT		/**/
+/*#define HAS_GETMNTENT		/ **/
+
+/* HAS_GETNAMEINFO:
+ *	This symbol, if defined, indicates that the getnameinfo() function
+ *	is available for use.
+ */
+/*#define HAS_GETNAMEINFO		/ **/
 
 /* HAS_GETPRPWNAM:
  *	This symbol, if defined, indicates that the getprpwnam system call is
  *	available to retrieve protected (shadow) password entries by name.
  */
-/*#define HAS_GETPRPWNAM		/**/
+/*#define HAS_GETPRPWNAM		/ **/
 
 /* HAS_GETSPNAM:
  *	This symbol, if defined, indicates that the getspnam system call is
  *	available to retrieve SysV shadow password entries by name.
  */
-/*#define HAS_GETSPNAM		/**/
+/*#define HAS_GETSPNAM		/ **/
 
 /* HAS_HASMNTOPT:
  *	This symbol, if defined, indicates that the hasmntopt routine is
  *	available to query the mount options of file systems.
  */
-/*#define HAS_HASMNTOPT		/**/
+/*#define HAS_HASMNTOPT		/ **/
 
 /* HAS_ILOGBL:
  *	This symbol, if defined, indicates that the ilogbl routine is
  *	available.  If scalbnl is also present we can emulate frexpl.
  */
-/*#define HAS_ILOGBL		/**/
+/*#define HAS_ILOGBL		/ **/
+
+/* HAS_INETNTOP:
+ *	This symbol, if defined, indicates that the inet_ntop() function
+ *	is available to parse IPv4 and IPv6 strings.
+ */
+/*#define HAS_INETNTOP		/ **/
+
+/* HAS_INETPTON:
+ *	This symbol, if defined, indicates that the inet_pton() function
+ *	is available to parse IPv4 and IPv6 strings.
+ */
+/*#define HAS_INETPTON		/ **/
 
 /* HAS_INT64_T:
  *     This symbol will defined if the C compiler supports int64_t.
  *     Usually the <inttypes.h> needs to be included, but sometimes
  *	<sys/types.h> is enough.
  */
-/*#define     HAS_INT64_T               /**/
+/*#define     HAS_INT64_T               / **/
 
 /* HAS_ISFINITE:
  *	This symbol, if defined, indicates that the isfinite routine is
  *	available to check whether a double is finite (non-infinity non-NaN).
  */
-/*#define HAS_ISFINITE		/**/
+/*#define HAS_ISFINITE		/ **/
 
 /* HAS_ISINF:
  *	This symbol, if defined, indicates that the isinf routine is
  *	available to check whether a double is an infinity.
  */
-/*#define HAS_ISINF		/**/
+/*#define HAS_ISINF		/ **/
 
 /* HAS_ISNAN:
  *	This symbol, if defined, indicates that the isnan routine is
@@ -3654,7 +3708,7 @@
  *	This symbol, if defined, indicates that the isnanl routine is
  *	available to check whether a long double is a NaN.
  */
-/*#define HAS_ISNANL		/**/
+/*#define HAS_ISNANL		/ **/
 
 /* HAS_LDBL_DIG:
  *	This symbol, if defined, indicates that this system's <float.h>
@@ -3668,38 +3722,38 @@
  *	This symbol, if defined, indicates that libm exports _LIB_VERSION
  *	and that math.h defines the enum to manipulate it.
  */
-/*#define LIBM_LIB_VERSION		/**/
+/*#define LIBM_LIB_VERSION		/ **/
 
 /* HAS_MADVISE:
  *	This symbol, if defined, indicates that the madvise system call is
  *	available to map a file into memory.
  */
-/*#define HAS_MADVISE		/**/
+/*#define HAS_MADVISE		/ **/
 
 /* HAS_MALLOC_SIZE:
  *	This symbol, if defined, indicates that the malloc_size
  *	routine is available for use.
  */
-/*#define HAS_MALLOC_SIZE		/**/
+/*#define HAS_MALLOC_SIZE		/ **/
 
 /* HAS_MALLOC_GOOD_SIZE:
  *	This symbol, if defined, indicates that the malloc_good_size
  *	routine is available for use.
  */
-/*#define HAS_MALLOC_GOOD_SIZE	/**/
+/*#define HAS_MALLOC_GOOD_SIZE	/ **/
 
 /* HAS_MKDTEMP:
  *	This symbol, if defined, indicates that the mkdtemp routine is
  *	available to exclusively create a uniquely named temporary directory.
  */
-/*#define HAS_MKDTEMP		/**/
+/*#define HAS_MKDTEMP		/ **/
 
 /* HAS_MKSTEMPS:
  *	This symbol, if defined, indicates that the mkstemps routine is
  *	available to excluslvely create and open a uniquely named
  *	(with a suffix) temporary file.
  */
-/*#define HAS_MKSTEMPS		/**/
+/*#define HAS_MKSTEMPS		/ **/
 
 /* HAS_MODFL:
  *	This symbol, if defined, indicates that the modfl routine is
@@ -3718,33 +3772,33 @@
  *	and 1.150000.  The bug has been seen in certain versions of glibc,
  *	release 2.2.2 is known to be okay.
  */
-/*#define HAS_MODFL		/**/
-/*#define HAS_MODFL_PROTO		/**/
-/*#define HAS_MODFL_POW32_BUG		/**/
+/*#define HAS_MODFL		/ **/
+/*#define HAS_MODFL_PROTO		/ **/
+/*#define HAS_MODFL_POW32_BUG		/ **/
 
 /* HAS_MPROTECT:
  *	This symbol, if defined, indicates that the mprotect system call is
  *	available to modify the access protection of a memory mapped file.
  */
-/*#define HAS_MPROTECT		/**/
+/*#define HAS_MPROTECT		/ **/
 
 /* HAS_STRUCT_MSGHDR:
  *	This symbol, if defined, indicates that the struct msghdr
  *	is supported.
  */
-/*#define HAS_STRUCT_MSGHDR	/**/
+/*#define HAS_STRUCT_MSGHDR	/ **/
 
 /* HAS_NL_LANGINFO:
  *	This symbol, if defined, indicates that the nl_langinfo routine is
  *	available to return local data.  You will also need <langinfo.h>
  *	and therefore I_LANGINFO.
  */
-/*#define HAS_NL_LANGINFO		/**/
+/*#define HAS_NL_LANGINFO		/ **/
 
 /* HAS_OFF64_T:
  *	This symbol will be defined if the C compiler supports off64_t.
  */
-/*#define	HAS_OFF64_T    		/**/
+/*#define	HAS_OFF64_T    		/ **/
 
 /* HAS_PROCSELFEXE:
  *	This symbol is defined if PROCSELFEXE_PATH is a symlink
@@ -3755,7 +3809,7 @@
  *	of the symbolic link pointing to the absolute pathname of
  *	the executing program.
  */
-/*#define HAS_PROCSELFEXE	/**/
+/*#define HAS_PROCSELFEXE	/ **/
 #if defined(HAS_PROCSELFEXE) && !defined(PROCSELFEXE_PATH)
 #define PROCSELFEXE_PATH		/**/
 #endif
@@ -3765,20 +3819,20 @@
  *	system call is available to set the contention scope attribute of
  *	a thread attribute object.
  */
-/*#define HAS_PTHREAD_ATTR_SETSCOPE		/**/
+/*#define HAS_PTHREAD_ATTR_SETSCOPE		/ **/
 
 /* HAS_READV:
  *	This symbol, if defined, indicates that the readv routine is
  *	available to do gather reads.  You will also need <sys/uio.h>
  *	and there I_SYSUIO.
  */
-/*#define HAS_READV		/**/
+/*#define HAS_READV		/ **/
 
 /* HAS_RECVMSG:
  *	This symbol, if defined, indicates that the recvmsg routine is
  *	available to send structured socket messages.
  */
-/*#define HAS_RECVMSG		/**/
+/*#define HAS_RECVMSG		/ **/
 
 /* HAS_SBRK_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3787,37 +3841,37 @@
  *		extern void* sbrk(int);
  *		extern void* sbrk(size_t);
  */
-/*#define	HAS_SBRK_PROTO	/**/
+/*#define	HAS_SBRK_PROTO	/ **/
 
 /* HAS_SCALBNL:
  *	This symbol, if defined, indicates that the scalbnl routine is
  *	available.  If ilogbl is also present we can emulate frexpl.
  */
-/*#define HAS_SCALBNL		/**/
+/*#define HAS_SCALBNL		/ **/
 
 /* HAS_SENDMSG:
  *	This symbol, if defined, indicates that the sendmsg routine is
  *	available to send structured socket messages.
  */
-/*#define HAS_SENDMSG		/**/
+/*#define HAS_SENDMSG		/ **/
 
 /* HAS_SETITIMER:
  *	This symbol, if defined, indicates that the setitimer routine is
  *	available to set interval timers.
  */
-/*#define HAS_SETITIMER		/**/
+/*#define HAS_SETITIMER		/ **/
 
 /* HAS_SETPROCTITLE:
  *	This symbol, if defined, indicates that the setproctitle routine is
  *	available to set process title.
  */
-/*#define HAS_SETPROCTITLE		/**/
+/*#define HAS_SETPROCTITLE		/ **/
 
 /* USE_SFIO:
  *	This symbol, if defined, indicates that sfio should
  *	be used.
  */
-/*#define	USE_SFIO		/**/
+/*#define	USE_SFIO		/ **/
 
 /* HAS_SIGNBIT:
  *	This symbol, if defined, indicates that the signbit routine is
@@ -3827,21 +3881,21 @@
  *	in perl.  Users should call Perl_signbit(), which will be #defined to
  *	the system's signbit() function or macro if this symbol is defined.
  */
-/*#define HAS_SIGNBIT		/**/
+/*#define HAS_SIGNBIT		/ **/
 
 /* HAS_SIGPROCMASK:
  *	This symbol, if defined, indicates that the sigprocmask
  *	system call is available to examine or change the signal mask
  *	of the calling process.
  */
-/*#define HAS_SIGPROCMASK		/**/
+/*#define HAS_SIGPROCMASK		/ **/
 
 /* USE_SITECUSTOMIZE:
  *	This symbol, if defined, indicates that sitecustomize should
  *	be used.
  */
 #ifndef USE_SITECUSTOMIZE
-/*#define	USE_SITECUSTOMIZE		/**/
+/*#define	USE_SITECUSTOMIZE		/ **/
 #endif
 
 /* HAS_SNPRINTF:
@@ -3859,7 +3913,7 @@
  *	This symbol, if defined, indicates that the sockatmark routine is
  *	available to test whether a socket is at the out-of-band mark.
  */
-/*#define HAS_SOCKATMARK		/**/
+/*#define HAS_SOCKATMARK		/ **/
 
 /* HAS_SOCKATMARK_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3867,13 +3921,13 @@
  *	to the program to supply one.  A good guess is
  *		extern int sockatmark(int);
  */
-/*#define	HAS_SOCKATMARK_PROTO	/**/
+/*#define	HAS_SOCKATMARK_PROTO	/ **/
 
 /* HAS_SOCKS5_INIT:
  *	This symbol, if defined, indicates that the socks5_init routine is
  *	available to initialize SOCKS 5.
  */
-/*#define HAS_SOCKS5_INIT		/**/
+/*#define HAS_SOCKS5_INIT		/ **/
 
 /* SPRINTF_RETURNS_STRLEN:
  *	This variable defines whether sprintf returns the length of the string
@@ -3887,7 +3941,7 @@
  *	This symbol, if defined, indicates that the sqrtl routine is
  *	available to do long double square roots.
  */
-/*#define HAS_SQRTL		/**/
+/*#define HAS_SQRTL		/ **/
 
 /* HAS_SETRESGID_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3895,7 +3949,7 @@
  *	to the program to supply one.  Good guesses are
  *		extern int setresgid(uid_t ruid, uid_t euid, uid_t suid);
  */
-/*#define	HAS_SETRESGID_PROTO	/**/
+/*#define	HAS_SETRESGID_PROTO	/ **/
 
 /* HAS_SETRESUID_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3903,7 +3957,7 @@
  *	to the program to supply one.  Good guesses are
  *		extern int setresuid(uid_t ruid, uid_t euid, uid_t suid);
  */
-/*#define	HAS_SETRESUID_PROTO	/**/
+/*#define	HAS_SETRESUID_PROTO	/ **/
 
 /* HAS_STRUCT_STATFS_F_FLAGS:
  *	This symbol, if defined, indicates that the struct statfs
@@ -3914,19 +3968,19 @@
  *	have statfs() and struct statfs, they have ustat() and getmnt()
  *	with struct ustat and struct fs_data.
  */
-/*#define HAS_STRUCT_STATFS_F_FLAGS		/**/
+/*#define HAS_STRUCT_STATFS_F_FLAGS		/ **/
 
 /* HAS_STRUCT_STATFS:
  *	This symbol, if defined, indicates that the struct statfs
  *	to do statfs() is supported.
  */
-/*#define HAS_STRUCT_STATFS	/**/
+/*#define HAS_STRUCT_STATFS	/ **/
 
 /* HAS_FSTATVFS:
  *	This symbol, if defined, indicates that the fstatvfs routine is
  *	available to stat filesystems by file descriptors.
  */
-/*#define HAS_FSTATVFS		/**/
+/*#define HAS_FSTATVFS		/ **/
 
 /* HAS_STRFTIME:
  *	This symbol, if defined, indicates that the strftime routine is
@@ -3938,43 +3992,43 @@
  *	This symbol, if defined, indicates that the strlcat () routine is
  *	available to do string concatenation.
  */
-/*#define HAS_STRLCAT		/**/
+/*#define HAS_STRLCAT		/ **/
 
 /* HAS_STRLCPY:
  *	This symbol, if defined, indicates that the strlcpy () routine is
  *	available to do string copying.
  */
-/*#define HAS_STRLCPY		/**/
+/*#define HAS_STRLCPY		/ **/
 
 /* HAS_STRTOLD:
  *	This symbol, if defined, indicates that the strtold routine is
  *	available to convert strings to long doubles.
  */
-/*#define HAS_STRTOLD		/**/
+/*#define HAS_STRTOLD		/ **/
 
 /* HAS_STRTOLL:
  *	This symbol, if defined, indicates that the strtoll routine is
  *	available to convert strings to long longs.
  */
-/*#define HAS_STRTOLL		/**/
+/*#define HAS_STRTOLL		/ **/
 
 /* HAS_STRTOQ:
  *	This symbol, if defined, indicates that the strtoq routine is
  *	available to convert strings to long longs (quads).
  */
-/*#define HAS_STRTOQ		/**/
+/*#define HAS_STRTOQ		/ **/
 
 /* HAS_STRTOULL:
  *	This symbol, if defined, indicates that the strtoull routine is
  *	available to convert strings to unsigned long longs.
  */
-/*#define HAS_STRTOULL		/**/
+/*#define HAS_STRTOULL		/ **/
 
 /* HAS_STRTOUQ:
  *	This symbol, if defined, indicates that the strtouq routine is
  *	available to convert strings to unsigned long longs (quads).
  */
-/*#define HAS_STRTOUQ		/**/
+/*#define HAS_STRTOUQ		/ **/
 
 /* HAS_SYSCALL_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3983,7 +4037,7 @@
  *		extern int syscall(int,  ...);
  *		extern int syscall(long, ...);
  */
-/*#define	HAS_SYSCALL_PROTO	/**/
+/*#define	HAS_SYSCALL_PROTO	/ **/
 
 /* HAS_TELLDIR_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -4017,18 +4071,18 @@
  *	This symbol, if defined, indicates that the asctime64 () routine is
  *	available to do the 64bit variant of asctime ()
  */
-/*#define	HAS_CTIME64		/**/
-/*#define	HAS_LOCALTIME64		/**/
-/*#define	HAS_GMTIME64		/**/
-/*#define	HAS_MKTIME64		/**/
-/*#define	HAS_DIFFTIME64		/**/
-/*#define	HAS_ASCTIME64		/**/
+/*#define	HAS_CTIME64		/ **/
+/*#define	HAS_LOCALTIME64		/ **/
+/*#define	HAS_GMTIME64		/ **/
+/*#define	HAS_MKTIME64		/ **/
+/*#define	HAS_DIFFTIME64		/ **/
+/*#define	HAS_ASCTIME64		/ **/
 
 /* HAS_TIMEGM:
  *	This symbol, if defined, indicates that the timegm routine is
  *	available to do the opposite of gmtime ()
  */
-/*#define HAS_TIMEGM		/**/
+/*#define HAS_TIMEGM		/ **/
 
 /* U32_ALIGNMENT_REQUIRED:
  *	This symbol, if defined, indicates that you must access
@@ -4042,20 +4096,20 @@
  *	This symbol, if defined, indicates that the ualarm routine is
  *	available to do alarms with microsecond granularity.
  */
-/*#define HAS_UALARM		/**/
+/*#define HAS_UALARM		/ **/
 
 /* HAS_UNORDERED:
  *	This symbol, if defined, indicates that the unordered routine is
  *	available to check whether two doubles are unordered
  *	(effectively: whether either of them is NaN)
  */
-/*#define HAS_UNORDERED		/**/
+/*#define HAS_UNORDERED		/ **/
 
 /* HAS_UNSETENV:
  *	This symbol, if defined, indicates that the unsetenv () routine is
  *	available for use.
  */
-/*#define HAS_UNSETENV		/**/
+/*#define HAS_UNSETENV		/ **/
 
 /* HAS_USLEEP_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -4063,19 +4117,19 @@
  *	to the program to supply one.  A good guess is
  *		extern int usleep(useconds_t);
  */
-/*#define	HAS_USLEEP_PROTO	/**/
+/*#define	HAS_USLEEP_PROTO	/ **/
 
 /* HAS_USTAT:
  *	This symbol, if defined, indicates that the ustat system call is
  *	available to query file system statistics by dev_t.
  */
-/*#define HAS_USTAT		/**/
+/*#define HAS_USTAT		/ **/
 
 /* HAS_WRITEV:
  *	This symbol, if defined, indicates that the writev routine is
  *	available to do scatter writes.
  */
-/*#define HAS_WRITEV		/**/
+/*#define HAS_WRITEV		/ **/
 
 /* USE_DYNAMIC_LOADING:
  *	This symbol, if defined, indicates that dynamic loading of
@@ -4095,7 +4149,7 @@
  *	even be probed for and will be left undefined.
  */
 #define	FFLUSH_NULL 		/**/
-/*#define	FFLUSH_ALL 		/**/
+/*#define	FFLUSH_ALL 		/ **/
 
 /* I_ASSERT:
  *	This symbol, if defined, indicates that <assert.h> exists and
@@ -4107,7 +4161,7 @@
  *	This symbol, if defined, indicates that <crypt.h> exists and
  *	should be included.
  */
-/*#define	I_CRYPT		/**/
+/*#define	I_CRYPT		/ **/
 
 /* DB_Prefix_t:
  *	This symbol contains the type of the prefix structure element
@@ -4143,132 +4197,132 @@
  *	This symbol, if defined, indicates that <fp.h> exists and
  *	should be included.
  */
-/*#define	I_FP		/**/
+/*#define	I_FP		/ **/
 
 /* I_FP_CLASS:
  *	This symbol, if defined, indicates that <fp_class.h> exists and
  *	should be included.
  */
-/*#define	I_FP_CLASS		/**/
+/*#define	I_FP_CLASS		/ **/
 
 /* I_IEEEFP:
  *	This symbol, if defined, indicates that <ieeefp.h> exists and
  *	should be included.
  */
-/*#define	I_IEEEFP		/**/
+/*#define	I_IEEEFP		/ **/
 
 /* I_INTTYPES:
  *     This symbol, if defined, indicates to the C program that it should
  *     include <inttypes.h>.
  */
-/*#define   I_INTTYPES                /**/
+/*#define   I_INTTYPES                / **/
 
 /* I_LANGINFO:
  *	This symbol, if defined, indicates that <langinfo.h> exists and
  *	should be included.
  */
-/*#define	I_LANGINFO		/**/
+/*#define	I_LANGINFO		/ **/
 
 /* I_LIBUTIL:
  *	This symbol, if defined, indicates that <libutil.h> exists and
  *	should be included.
  */
-/*#define	I_LIBUTIL		/**/
+/*#define	I_LIBUTIL		/ **/
 
 /* I_MALLOCMALLOC:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <malloc/malloc.h>.
  */
-/*#define I_MALLOCMALLOC		/**/
+/*#define I_MALLOCMALLOC		/ **/
 
 /* I_MNTENT:
  *	This symbol, if defined, indicates that <mntent.h> exists and
  *	should be included.
  */
-/*#define	I_MNTENT		/**/
+/*#define	I_MNTENT		/ **/
 
 /* I_NETINET_TCP:
  *     This symbol, if defined, indicates to the C program that it should
  *     include <netinet/tcp.h>.
  */
-/*#define   I_NETINET_TCP                /**/
+/*#define   I_NETINET_TCP                / **/
 
 /* I_POLL:
  *	This symbol, if defined, indicates that <poll.h> exists and
  *	should be included. (see also HAS_POLL)
  */
-/*#define	I_POLL		/**/
+/*#define	I_POLL		/ **/
 
 /* I_PROT:
  *	This symbol, if defined, indicates that <prot.h> exists and
  *	should be included.
  */
-/*#define	I_PROT		/**/
+/*#define	I_PROT		/ **/
 
 /* I_SHADOW:
  *	This symbol, if defined, indicates that <shadow.h> exists and
  *	should be included.
  */
-/*#define	I_SHADOW		/**/
+/*#define	I_SHADOW		/ **/
 
 /* I_SOCKS:
  *	This symbol, if defined, indicates that <socks.h> exists and
  *	should be included.
  */
-/*#define	I_SOCKS		/**/
+/*#define	I_SOCKS		/ **/
 
 /* I_SUNMATH:
  *	This symbol, if defined, indicates that <sunmath.h> exists and
  *	should be included.
  */
-/*#define	I_SUNMATH		/**/
+/*#define	I_SUNMATH		/ **/
 
 /* I_SYSLOG:
  *	This symbol, if defined, indicates that <syslog.h> exists and
  *	should be included.
  */
-/*#define	I_SYSLOG		/**/
+/*#define	I_SYSLOG		/ **/
 
 /* I_SYSMODE:
  *	This symbol, if defined, indicates that <sys/mode.h> exists and
  *	should be included.
  */
-/*#define	I_SYSMODE		/**/
+/*#define	I_SYSMODE		/ **/
 
 /* I_SYS_MOUNT:
  *	This symbol, if defined, indicates that <sys/mount.h> exists and
  *	should be included.
  */
-/*#define	I_SYS_MOUNT		/**/
+/*#define	I_SYS_MOUNT		/ **/
 
 /* I_SYS_STATFS:
  *	This symbol, if defined, indicates that <sys/statfs.h> exists.
  */
-/*#define	I_SYS_STATFS		/**/
+/*#define	I_SYS_STATFS		/ **/
 
 /* I_SYS_STATVFS:
  *	This symbol, if defined, indicates that <sys/statvfs.h> exists and
  *	should be included.
  */
-/*#define	I_SYS_STATVFS		/**/
+/*#define	I_SYS_STATVFS		/ **/
 
 /* I_SYSUTSNAME:
  *	This symbol, if defined, indicates that <sys/utsname.h> exists and
  *	should be included.
  */
-/*#define	I_SYSUTSNAME		/**/
+/*#define	I_SYSUTSNAME		/ **/
 
 /* I_SYS_VFS:
  *	This symbol, if defined, indicates that <sys/vfs.h> exists and
  *	should be included.
  */
-/*#define	I_SYS_VFS		/**/
+/*#define	I_SYS_VFS		/ **/
 
 /* I_USTAT:
  *	This symbol, if defined, indicates that <ustat.h> exists and
  *	should be included.
  */
-/*#define	I_USTAT		/**/
+/*#define	I_USTAT		/ **/
 
 /* PERL_PRIfldbl:
  *	This symbol, if defined, contains the string used by stdio to
@@ -4286,16 +4340,16 @@
  *	This symbol, if defined, contains the string used by stdio to
  *	format long doubles (format 'f') for input.
  */
-/*#define PERL_PRIfldbl	"f"	/**/
-/*#define PERL_PRIgldbl	"g"	/**/
-/*#define PERL_PRIeldbl	"e"	/**/
-/*#define PERL_SCNfldbl	"f"	/**/
+/*#define PERL_PRIfldbl	"f"	/ **/
+/*#define PERL_PRIgldbl	"g"	/ **/
+/*#define PERL_PRIeldbl	"e"	/ **/
+/*#define PERL_SCNfldbl	"f"	/ **/
 
 /* PERL_MAD:
  *	This symbol, if defined, indicates that the Misc Attribution
  *	Declaration code should be conditionally compiled.
  */
-/*#define	PERL_MAD		/**/
+/*#define	PERL_MAD		/ **/
 
 /* NEED_VA_COPY:
  *	This symbol, if defined, indicates that the system stores
@@ -4306,7 +4360,7 @@
  *	of copying mechanisms, handy.h defines a platform-
  *	independent macro, Perl_va_copy(src, dst), to do the job.
  */
-/*#define	NEED_VA_COPY		/**/
+/*#define	NEED_VA_COPY		/ **/
 
 /* IVTYPE:
  *	This symbol defines the C type used for Perl's IV.
@@ -4506,7 +4560,7 @@
  *	This symbol tells the name of the array holding the stdio streams.
  *	Usual values include _iob, __iob, and __sF.
  */
-/*#define	HAS_STDIO_STREAM_ARRAY	/**/
+/*#define	HAS_STDIO_STREAM_ARRAY	/ **/
 #ifdef HAS_STDIO_STREAM_ARRAY
 #define STDIO_STREAM_ARRAY	
 #endif
@@ -4527,8 +4581,8 @@
  *	This symbol contains the minimum value for the time_t offset that
  *	the system function localtime () accepts, and defaults to 0
  */
-#define GMTIME_MAX		2147483647	/**/
-#define GMTIME_MIN		0	/**/
+#define GMTIME_MAX	2147483647	/**/
+#define GMTIME_MIN	0	/**/
 #define LOCALTIME_MAX	2147483647	/**/
 #define LOCALTIME_MIN	0	/**/
 
@@ -4551,17 +4605,17 @@
  *	you may need at least to reboot your OS to 64-bit mode.
  */
 #ifndef USE_64_BIT_INT
-/*#define	USE_64_BIT_INT		/**/
+/*#define	USE_64_BIT_INT		/ **/
 #endif
 #ifndef USE_64_BIT_ALL
-/*#define	USE_64_BIT_ALL		/**/
+/*#define	USE_64_BIT_ALL		/ **/
 #endif
 
 /* USE_DTRACE:
  *	This symbol, if defined, indicates that Perl should
  *	be built with support for DTrace.
  */
-/*#define USE_DTRACE		/**/
+/*#define USE_DTRACE		/ **/
 
 /* USE_FAST_STDIO:
  *	This symbol, if defined, indicates that Perl should
@@ -4569,7 +4623,7 @@
  *	Defaults to define in Perls 5.8 and earlier, to undef later.
  */
 #ifndef USE_FAST_STDIO
-/*#define	USE_FAST_STDIO		/**/
+/*#define	USE_FAST_STDIO		/ **/
 #endif
 
 /* USE_LARGE_FILES:
@@ -4577,7 +4631,7 @@
  *	should be used when available.
  */
 #ifndef USE_LARGE_FILES
-/*#define	USE_LARGE_FILES		/**/
+/*#define	USE_LARGE_FILES		/ **/
 #endif
 
 /* USE_LONG_DOUBLE:
@@ -4585,7 +4639,7 @@
  *	be used when available.
  */
 #ifndef USE_LONG_DOUBLE
-/*#define	USE_LONG_DOUBLE		/**/
+/*#define	USE_LONG_DOUBLE		/ **/
 #endif
 
 /* USE_MORE_BITS:
@@ -4593,7 +4647,7 @@
  *	long doubles should be used when available.
  */
 #ifndef USE_MORE_BITS
-/*#define	USE_MORE_BITS		/**/
+/*#define	USE_MORE_BITS		/ **/
 #endif
 
 /* MULTIPLICITY:
@@ -4601,7 +4655,7 @@
  *	be built to use multiplicity.
  */
 #ifndef MULTIPLICITY
-/*#define	MULTIPLICITY		/**/
+/*#define	MULTIPLICITY		/ **/
 #endif
 
 /* USE_PERLIO:
@@ -4610,7 +4664,7 @@
  *	used in a fully backward compatible manner.
  */
 #ifndef USE_PERLIO
-/*#define	USE_PERLIO		/**/
+/*#define	USE_PERLIO		/ **/
 #endif
 
 /* USE_SOCKS:
@@ -4618,7 +4672,7 @@
  *	be built to use socks.
  */
 #ifndef USE_SOCKS
-/*#define	USE_SOCKS		/**/
+/*#define	USE_SOCKS		/ **/
 #endif
 
 #endif
Index: src/gnu/usr.bin/perl/win32/config_H.vc
diff -u src/gnu/usr.bin/perl/win32/config_H.vc:1.12 src/gnu/usr.bin/perl/win32/config_H.vc:1.13
--- win32/config_H.vc:1.12	Mon Oct 12 18:30:28 2009
+++ win32/config_H.vc	Fri Sep 24 15:07:11 2010
@@ -13,8 +13,8 @@
 /*
  * Package name      : perl5
  * Source directory  : 
- * Configuration time: Fri Dec 12 15:19:23 2008
- * Configured by     : shay
+ * Configuration time: Sat Jan  9 17:22:03 2010
+ * Configured by     : Steve
  * Target system     : 
  */
 
@@ -36,31 +36,31 @@
  *	This symbol is defined if the bcmp() routine is available to
  *	compare blocks of memory.
  */
-/*#define HAS_BCMP	/**/
+/*#define HAS_BCMP	/ **/
 
 /* HAS_BCOPY:
  *	This symbol is defined if the bcopy() routine is available to
  *	copy blocks of memory.
  */
-/*#define HAS_BCOPY	/**/
+/*#define HAS_BCOPY	/ **/
 
 /* HAS_BZERO:
  *	This symbol is defined if the bzero() routine is available to
  *	set a memory block to 0.
  */
-/*#define HAS_BZERO	/**/
+/*#define HAS_BZERO	/ **/
 
 /* HAS_CHOWN:
  *	This symbol, if defined, indicates that the chown routine is
  *	available.
  */
-/*#define HAS_CHOWN		/**/
+/*#define HAS_CHOWN		/ **/
 
 /* HAS_CHROOT:
  *	This symbol, if defined, indicates that the chroot routine is
  *	available.
  */
-/*#define HAS_CHROOT		/**/
+/*#define HAS_CHROOT		/ **/
 
 /* HAS_CHSIZE:
  *	This symbol, if defined, indicates that the chsize routine is available
@@ -72,19 +72,19 @@
  *	This symbol, if defined, indicates that the crypt routine is available
  *	to encrypt passwords and the like.
  */
-/*#define HAS_CRYPT		/**/
+/*#define HAS_CRYPT		/ **/
 
 /* HAS_CTERMID:
  *	This symbol, if defined, indicates that the ctermid routine is
  *	available to generate filename for terminal.
  */
-/*#define HAS_CTERMID		/**/
+/*#define HAS_CTERMID		/ **/
 
 /* HAS_CUSERID:
  *	This symbol, if defined, indicates that the cuserid routine is
  *	available to get character login names.
  */
-/*#define HAS_CUSERID		/**/
+/*#define HAS_CUSERID		/ **/
 
 /* HAS_DBL_DIG:
  *	This symbol, if defined, indicates that this system's <float.h>
@@ -107,26 +107,6 @@
  */
 #define HAS_DLERROR	/**/
 
-/* SETUID_SCRIPTS_ARE_SECURE_NOW:
- *	This symbol, if defined, indicates that the bug that prevents
- *	setuid scripts from being secure is not present in this kernel.
- */
-/* DOSUID:
- *	This symbol, if defined, indicates that the C program should
- *	check the script that it is executing for setuid/setgid bits, and
- *	attempt to emulate setuid/setgid on systems that have disabled
- *	setuid #! scripts because the kernel can't do it securely.
- *	It is up to the package designer to make sure that this emulation
- *	is done securely.  Among other things, it should do an fstat on
- *	the script it just opened to make sure it really is a setuid/setgid
- *	script, it should make sure the arguments passed correspond exactly
- *	to the argument on the #! line, and it should not trust any
- *	subprocesses to which it must pass the filename rather than the
- *	file descriptor of the script to be executed.
- */
-/*#define SETUID_SCRIPTS_ARE_SECURE_NOW	/**/
-/*#define DOSUID		/**/
-
 /* HAS_DUP2:
  *	This symbol, if defined, indicates that the dup2 routine is
  *	available to duplicate file descriptors.
@@ -137,19 +117,19 @@
  *	This symbol, if defined, indicates that the fchmod routine is available
  *	to change mode of opened files.  If unavailable, use chmod().
  */
-/*#define HAS_FCHMOD		/**/
+/*#define HAS_FCHMOD		/ **/
 
 /* HAS_FCHOWN:
  *	This symbol, if defined, indicates that the fchown routine is available
  *	to change ownership of opened files.  If unavailable, use chown().
  */
-/*#define HAS_FCHOWN		/**/
+/*#define HAS_FCHOWN		/ **/
 
 /* HAS_FCNTL:
  *	This symbol, if defined, indicates to the C program that
  *	the fcntl() function exists.
  */
-/*#define HAS_FCNTL		/**/
+/*#define HAS_FCNTL		/ **/
 
 /* HAS_FGETPOS:
  *	This symbol, if defined, indicates that the fgetpos routine is
@@ -167,7 +147,7 @@
  *	This symbol, if defined, indicates that the fork routine is
  *	available.
  */
-/*#define HAS_FORK		/**/
+/*#define HAS_FORK		/ **/
 
 /* HAS_FSETPOS:
  *	This symbol, if defined, indicates that the fsetpos routine is
@@ -191,7 +171,7 @@
  *	available to get the list of process groups.  If unavailable, multiple
  *	groups are probably not supported.
  */
-/*#define HAS_GETGROUPS		/**/
+/*#define HAS_GETGROUPS		/ **/
 
 /* HAS_GETLOGIN:
  *	This symbol, if defined, indicates that the getlogin routine is
@@ -204,32 +184,32 @@
  *	the getpgid(pid) function is available to get the
  *	process group id.
  */
-/*#define HAS_GETPGID		/**/
+/*#define HAS_GETPGID		/ **/
 
 /* HAS_GETPGRP2:
  *	This symbol, if defined, indicates that the getpgrp2() (as in DG/UX)
  *	routine is available to get the current process group.
  */
-/*#define HAS_GETPGRP2		/**/
+/*#define HAS_GETPGRP2		/ **/
 
 /* HAS_GETPPID:
  *	This symbol, if defined, indicates that the getppid routine is
  *	available to get the parent process ID.
  */
-/*#define HAS_GETPPID		/**/
+/*#define HAS_GETPPID		/ **/
 
 /* HAS_GETPRIORITY:
  *	This symbol, if defined, indicates that the getpriority routine is
  *	available to get a process's priority.
  */
-/*#define HAS_GETPRIORITY		/**/
+/*#define HAS_GETPRIORITY		/ **/
 
 /* HAS_INET_ATON:
  *	This symbol, if defined, indicates to the C program that the
  *	inet_aton() function is available to parse IP address "dotted-quad"
  *	strings.
  */
-/*#define HAS_INET_ATON		/**/
+/*#define HAS_INET_ATON		/ **/
 
 /* HAS_KILLPG:
  *	This symbol, if defined, indicates that the killpg routine is available
@@ -254,13 +234,13 @@
  *	This symbol, if defined, indicates that the lockf routine is
  *	available to do file locking.
  */
-/*#define HAS_LOCKF		/**/
+/*#define HAS_LOCKF		/ **/
 
 /* HAS_LSTAT:
  *	This symbol, if defined, indicates that the lstat routine is
  *	available to do file stats on symbolic links.
  */
-/*#define HAS_LSTAT		/**/
+/*#define HAS_LSTAT		/ **/
 
 /* HAS_MBLEN:
  *	This symbol, if defined, indicates that the mblen routine is available
@@ -319,7 +299,7 @@
  *	do it for you. However, if mkfifo is there, mknod might require
  *	super-user privileges which mkfifo will not.
  */
-/*#define HAS_MKFIFO		/**/
+/*#define HAS_MKFIFO		/ **/
 
 /* HAS_MKTIME:
  *	This symbol, if defined, indicates that the mktime routine is
@@ -331,19 +311,19 @@
  *	This symbol, if defined, indicates that the msync system call is
  *	available to synchronize a mapped file.
  */
-/*#define HAS_MSYNC		/**/
+/*#define HAS_MSYNC		/ **/
 
 /* HAS_MUNMAP:
  *	This symbol, if defined, indicates that the munmap system call is
  *	available to unmap a region, usually mapped by mmap().
  */
-/*#define HAS_MUNMAP		/**/
+/*#define HAS_MUNMAP		/ **/
 
 /* HAS_NICE:
  *	This symbol, if defined, indicates that the nice routine is
  *	available.
  */
-/*#define HAS_NICE		/**/
+/*#define HAS_NICE		/ **/
 
 /* HAS_PATHCONF:
  *	This symbol, if defined, indicates that pathconf() is available
@@ -355,8 +335,8 @@
  *	to determine file-system related limits and options associated
  *	with a given open file descriptor.
  */
-/*#define HAS_PATHCONF		/**/
-/*#define HAS_FPATHCONF		/**/
+/*#define HAS_PATHCONF		/ **/
+/*#define HAS_FPATHCONF		/ **/
 
 /* HAS_PAUSE:
  *	This symbol, if defined, indicates that the pause routine is
@@ -375,7 +355,7 @@
  *	available to poll active file descriptors.  Please check I_POLL and
  *	I_SYS_POLL to know which header should be included as well.
  */
-/*#define HAS_POLL		/**/
+/*#define HAS_POLL		/ **/
 
 /* HAS_READDIR:
  *	This symbol, if defined, indicates that the readdir routine is
@@ -406,7 +386,7 @@
  *	This symbol, if defined, indicates that the readlink routine is
  *	available to read the value of a symbolic link.
  */
-/*#define HAS_READLINK		/**/
+/*#define HAS_READLINK		/ **/
 
 /* HAS_RENAME:
  *	This symbol, if defined, indicates that the rename routine is available
@@ -433,27 +413,27 @@
  *	This symbol, if defined, indicates that the setegid routine is available
  *	to change the effective gid of the current program.
  */
-/*#define HAS_SETEGID		/**/
+/*#define HAS_SETEGID		/ **/
 
 /* HAS_SETEUID:
  *	This symbol, if defined, indicates that the seteuid routine is available
  *	to change the effective uid of the current program.
  */
-/*#define HAS_SETEUID		/**/
+/*#define HAS_SETEUID		/ **/
 
 /* HAS_SETGROUPS:
  *	This symbol, if defined, indicates that the setgroups() routine is
  *	available to set the list of process groups.  If unavailable, multiple
  *	groups are probably not supported.
  */
-/*#define HAS_SETGROUPS		/**/
+/*#define HAS_SETGROUPS		/ **/
 
 /* HAS_SETLINEBUF:
  *	This symbol, if defined, indicates that the setlinebuf routine is
  *	available to change stderr or stdout from block-buffered or unbuffered
  *	to a line-buffered mode.
  */
-/*#define HAS_SETLINEBUF		/**/
+/*#define HAS_SETLINEBUF		/ **/
 
 /* HAS_SETLOCALE:
  *	This symbol, if defined, indicates that the setlocale routine is
@@ -465,19 +445,19 @@
  *	This symbol, if defined, indicates that the setpgid(pid, gpid)
  *	routine is available to set process group ID.
  */
-/*#define HAS_SETPGID	/**/
+/*#define HAS_SETPGID	/ **/
 
 /* HAS_SETPGRP2:
  *	This symbol, if defined, indicates that the setpgrp2() (as in DG/UX)
  *	routine is available to set the current process group.
  */
-/*#define HAS_SETPGRP2		/**/
+/*#define HAS_SETPGRP2		/ **/
 
 /* HAS_SETPRIORITY:
  *	This symbol, if defined, indicates that the setpriority routine is
  *	available to set a process's priority.
  */
-/*#define HAS_SETPRIORITY		/**/
+/*#define HAS_SETPRIORITY		/ **/
 
 /* HAS_SETREGID:
  *	This symbol, if defined, indicates that the setregid routine is
@@ -489,8 +469,8 @@
  *	available to change the real, effective and saved gid of the current
  *	process.
  */
-/*#define HAS_SETREGID		/**/
-/*#define HAS_SETRESGID		/**/
+/*#define HAS_SETREGID		/ **/
+/*#define HAS_SETRESGID		/ **/
 
 /* HAS_SETREUID:
  *	This symbol, if defined, indicates that the setreuid routine is
@@ -502,26 +482,26 @@
  *	available to change the real, effective and saved uid of the current
  *	process.
  */
-/*#define HAS_SETREUID		/**/
-/*#define HAS_SETRESUID		/**/
+/*#define HAS_SETREUID		/ **/
+/*#define HAS_SETRESUID		/ **/
 
 /* HAS_SETRGID:
  *	This symbol, if defined, indicates that the setrgid routine is available
  *	to change the real gid of the current program.
  */
-/*#define HAS_SETRGID		/**/
+/*#define HAS_SETRGID		/ **/
 
 /* HAS_SETRUID:
  *	This symbol, if defined, indicates that the setruid routine is available
  *	to change the real uid of the current program.
  */
-/*#define HAS_SETRUID		/**/
+/*#define HAS_SETRUID		/ **/
 
 /* HAS_SETSID:
  *	This symbol, if defined, indicates that the setsid routine is
  *	available to set the process group ID.
  */
-/*#define HAS_SETSID	/**/
+/*#define HAS_SETSID	/ **/
 
 /* HAS_STRCHR:
  *	This symbol is defined to indicate that the strchr()/strrchr()
@@ -533,7 +513,7 @@
  *	functions are available for string searching.
  */
 #define HAS_STRCHR	/**/
-/*#define HAS_INDEX	/**/
+/*#define HAS_INDEX	/ **/
 
 /* HAS_STRCOLL:
  *	This symbol, if defined, indicates that the strcoll routine is
@@ -563,19 +543,19 @@
  *	This symbol, if defined, indicates that the symlink routine is available
  *	to create symbolic links.
  */
-/*#define HAS_SYMLINK	/**/
+/*#define HAS_SYMLINK	/ **/
 
 /* HAS_SYSCALL:
  *	This symbol, if defined, indicates that the syscall routine is
  *	available to call arbitrary system calls. If undefined, that's tough.
  */
-/*#define HAS_SYSCALL	/**/
+/*#define HAS_SYSCALL	/ **/
 
 /* HAS_SYSCONF:
  *	This symbol, if defined, indicates that sysconf() is available
  *	to determine system related limits and options.
  */
-/*#define HAS_SYSCONF	/**/
+/*#define HAS_SYSCONF	/ **/
 
 /* HAS_SYSTEM:
  *	This symbol, if defined, indicates that the system routine is
@@ -587,19 +567,19 @@
  *	This symbol, if defined, indicates that the tcgetpgrp routine is
  *	available to get foreground process group ID.
  */
-/*#define HAS_TCGETPGRP		/**/
+/*#define HAS_TCGETPGRP		/ **/
 
 /* HAS_TCSETPGRP:
  *	This symbol, if defined, indicates that the tcsetpgrp routine is
  *	available to set foreground process group ID.
  */
-/*#define HAS_TCSETPGRP		/**/
+/*#define HAS_TCSETPGRP		/ **/
 
 /* HAS_TRUNCATE:
  *	This symbol, if defined, indicates that the truncate routine is
  *	available to truncate files.
  */
-/*#define HAS_TRUNCATE	/**/
+/*#define HAS_TRUNCATE	/ **/
 
 /* HAS_TZNAME:
  *	This symbol, if defined, indicates that the tzname[] array is
@@ -617,12 +597,12 @@
  *	This symbol, if defined, indicates that the usleep routine is
  *	available to let the process sleep on a sub-second accuracy.
  */
-/*#define HAS_USLEEP		/**/
+/*#define HAS_USLEEP		/ **/
 
 /* HAS_WAIT4:
  *	This symbol, if defined, indicates that wait4() exists.
  */
-/*#define HAS_WAIT4	/**/
+/*#define HAS_WAIT4	/ **/
 
 /* HAS_WAITPID:
  *	This symbol, if defined, indicates that the waitpid routine is
@@ -669,7 +649,7 @@
  *	This symbol, if defined, indicates that <rpcsvc/dbm.h> exists and
  *	should be included.
  */
-/*#define I_DBM	/**/
+/*#define I_DBM	/ **/
 #define I_RPCSVC_DBM	/**/
 
 /* I_DLFCN:
@@ -694,7 +674,7 @@
  *	This symbol, if defined, indicates that <gdbm.h> exists and should
  *	be included.
  */
-/*#define I_GDBM	/**/
+/*#define I_GDBM	/ **/
 
 /* I_LIMITS:
  *	This symbol, if defined, indicates to the C program that it should
@@ -719,19 +699,19 @@
  *	This symbol, if defined, indicates to the C program that it should
  *	include <memory.h>.
  */
-/*#define I_MEMORY		/**/
+/*#define I_MEMORY		/ **/
 
 /* I_NETINET_IN:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <netinet/in.h>. Otherwise, you may try <sys/in.h>.
  */
-/*#define I_NETINET_IN	/**/
+/*#define I_NETINET_IN	/ **/
 
 /* I_SFIO:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sfio.h>.
  */
-/*#define	I_SFIO		/**/
+/*#define	I_SFIO		/ **/
 
 /* I_STDDEF:
  *	This symbol, if defined, indicates that <stddef.h> exists and should
@@ -755,13 +735,13 @@
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/dir.h>.
  */
-/*#define I_SYS_DIR		/**/
+/*#define I_SYS_DIR		/ **/
 
 /* I_SYS_FILE:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/file.h> to get definition of R_OK and friends.
  */
-/*#define I_SYS_FILE		/**/
+/*#define I_SYS_FILE		/ **/
 
 /* I_SYS_IOCTL:
  *	This symbol, if defined, indicates that <sys/ioctl.h> exists and should
@@ -771,39 +751,39 @@
  *	This symbol, if defined, indicates the <sys/sockio.h> should be included
  *	to get socket ioctl options, like SIOCATMARK.
  */
-/*#define	I_SYS_IOCTL		/**/
-/*#define I_SYS_SOCKIO	/**/
+/*#define	I_SYS_IOCTL		/ **/
+/*#define I_SYS_SOCKIO	/ **/
 
 /* I_SYS_NDIR:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/ndir.h>.
  */
-/*#define I_SYS_NDIR	/**/
+/*#define I_SYS_NDIR	/ **/
 
 /* I_SYS_PARAM:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/param.h>.
  */
-/*#define I_SYS_PARAM		/**/
+/*#define I_SYS_PARAM		/ **/
 
 /* I_SYS_POLL:
  *	This symbol, if defined, indicates that the program may include
  *	<sys/poll.h>.  When I_POLL is also defined, it's probably safest
  *	to only include <poll.h>.
  */
-/*#define I_SYS_POLL	/**/
+/*#define I_SYS_POLL	/ **/
 
 /* I_SYS_RESOURCE:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/resource.h>.
  */
-/*#define I_SYS_RESOURCE		/**/
+/*#define I_SYS_RESOURCE		/ **/
 
 /* I_SYS_SELECT:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/select.h> in order to get definition of struct timeval.
  */
-/*#define I_SYS_SELECT	/**/
+/*#define I_SYS_SELECT	/ **/
 
 /* I_SYS_STAT:
  *	This symbol, if defined, indicates to the C program that it should
@@ -815,7 +795,7 @@
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/times.h>.
  */
-/*#define	I_SYS_TIMES		/**/
+/*#define	I_SYS_TIMES		/ **/
 
 /* I_SYS_TYPES:
  *	This symbol, if defined, indicates to the C program that it should
@@ -827,13 +807,13 @@
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/un.h> to get UNIX domain socket definitions.
  */
-/*#define I_SYS_UN		/**/
+/*#define I_SYS_UN		/ **/
 
 /* I_SYS_WAIT:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <sys/wait.h>.
  */
-/*#define I_SYS_WAIT	/**/
+/*#define I_SYS_WAIT	/ **/
 
 /* I_TERMIO:
  *	This symbol, if defined, indicates that the program should include
@@ -851,15 +831,15 @@
  *	<sgtty.h> rather than <termio.h>.  There are also differences in
  *	the ioctl() calls that depend on the value of this symbol.
  */
-/*#define I_TERMIO		/**/
-/*#define I_TERMIOS		/**/
-/*#define I_SGTTY		/**/
+/*#define I_TERMIO		/ **/
+/*#define I_TERMIOS		/ **/
+/*#define I_SGTTY		/ **/
 
 /* I_UNISTD:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <unistd.h>.
  */
-/*#define I_UNISTD		/**/
+/*#define I_UNISTD		/ **/
 
 /* I_UTIME:
  *	This symbol, if defined, indicates to the C program that it should
@@ -873,13 +853,35 @@
  *	MAXLONG, i.e. machine dependant limitations.  Probably, you
  *	should use <limits.h> instead, if it is available.
  */
-/*#define I_VALUES		/**/
+/*#define I_VALUES		/ **/
 
 /* I_VFORK:
  *	This symbol, if defined, indicates to the C program that it should
  *	include vfork.h.
  */
-/*#define I_VFORK	/**/
+/*#define I_VFORK	/ **/
+
+/* CAN_VAPROTO:
+ *	This variable is defined on systems supporting prototype declaration
+ *	of functions with a variable number of arguments.
+ */
+/* _V:
+ *	This macro is used to declare function parameters in prototypes for
+ *	functions with a variable number of parameters. Use double parentheses.
+ *	For example:
+ *
+ *		int printf _V((char *fmt, ...));
+ *
+ *	Remember to use the plain simple _() macro when declaring a function
+ *	with no variable number of arguments, since it might be possible to
+ *	have a non-effect _V() macro and still get prototypes via _().
+ */
+/*#define CAN_VAPROTO	/ **/
+#ifdef CAN_VAPROTO
+#define	_V(args) args
+#else
+#define	_V(args) ()
+#endif
 
 /* INTSIZE:
  *	This symbol contains the value of sizeof(int) so that the C
@@ -904,12 +906,12 @@
  *	example with the NeXT "fat" binaries that contain executables
  *	for several CPUs.
  */
-/*#define MULTIARCH		/**/
+/*#define MULTIARCH		/ **/
 
 /* HAS_QUAD:
  *	This symbol, if defined, tells that there's a 64-bit integer type,
  *	Quad_t, and its unsigned counterpar, Uquad_t. QUADKIND will be one
- *	of QUAD_IS_INT, QUAD_IS_LONG, QUAD_IS_LONG_LONG, QUAD_IS_INT64_T.
+ *	of QUAD_IS_INT, QUAD_IS_LONG, QUAD_IS_LONG_LONG, QUAD_IS_INT64_T
  *	or QUAD_IS___INT64.
  */
 #define HAS_QUAD	/**/
@@ -957,7 +959,7 @@
  *	in programs that are not prepared to deal with ~ expansion at run-time.
  */
 #define ARCHLIB "c:\\perl\\lib"		/**/
-/*#define ARCHLIB_EXP ""	/**/
+/*#define ARCHLIB_EXP ""	/ **/
 
 /* ARCHNAME:
  *	This symbol holds a string representing the architecture name.
@@ -1051,7 +1053,7 @@
  *	This symbol, if defined, indicates that the accessx routine is
  *	available to do extended access checks.
  */
-/*#define HAS_ACCESSX		/**/
+/*#define HAS_ACCESSX		/ **/
 
 /* HAS_ASCTIME_R:
  *	This symbol, if defined, indicates that the asctime_r routine
@@ -1063,7 +1065,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_asctime_r
  *	is defined.
  */
-/*#define HAS_ASCTIME_R	   /**/
+/*#define HAS_ASCTIME_R	   / **/
 #define ASCTIME_R_PROTO 0	   /**/
 
 /* HASATTRIBUTE_FORMAT:
@@ -1093,15 +1095,15 @@
 /* HASATTRIBUTE_WARN_UNUSED_RESULT:
  *	Can we handle GCC attribute for warning on unused results
  */
-/*#define HASATTRIBUTE_DEPRECATED	/**/
-/*#define HASATTRIBUTE_FORMAT	/**/
-/*#define PRINTF_FORMAT_NULL_OK	/**/
-/*#define HASATTRIBUTE_NORETURN	/**/
-/*#define HASATTRIBUTE_MALLOC	/**/
-/*#define HASATTRIBUTE_NONNULL	/**/
-/*#define HASATTRIBUTE_PURE	/**/
-/*#define HASATTRIBUTE_UNUSED	/**/
-/*#define HASATTRIBUTE_WARN_UNUSED_RESULT	/**/
+/*#define HASATTRIBUTE_DEPRECATED	/ **/
+/*#define HASATTRIBUTE_FORMAT	/ **/
+/*#define PRINTF_FORMAT_NULL_OK	/ **/
+/*#define HASATTRIBUTE_NORETURN	/ **/
+/*#define HASATTRIBUTE_MALLOC	/ **/
+/*#define HASATTRIBUTE_NONNULL	/ **/
+/*#define HASATTRIBUTE_PURE	/ **/
+/*#define HASATTRIBUTE_UNUSED	/ **/
+/*#define HASATTRIBUTE_WARN_UNUSED_RESULT	/ **/
 
 /* HASCONST:
  *	This symbol, if defined, indicates that this C compiler knows about
@@ -1124,7 +1126,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_crypt_r
  *	is defined.
  */
-/*#define HAS_CRYPT_R	   /**/
+/*#define HAS_CRYPT_R	   / **/
 #define CRYPT_R_PROTO 0	   /**/
 
 /* HAS_CSH:
@@ -1133,7 +1135,7 @@
 /* CSH:
  *	This symbol, if defined, contains the full pathname of csh.
  */
-/*#define HAS_CSH		/**/
+/*#define HAS_CSH		/ **/
 #ifdef HAS_CSH
 #define CSH ""	/**/
 #endif
@@ -1148,7 +1150,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_ctermid_r
  *	is defined.
  */
-/*#define HAS_CTERMID_R	   /**/
+/*#define HAS_CTERMID_R	   / **/
 #define CTERMID_R_PROTO 0	   /**/
 
 /* HAS_CTIME_R:
@@ -1161,7 +1163,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_ctime_r
  *	is defined.
  */
-/*#define HAS_CTIME_R	   /**/
+/*#define HAS_CTIME_R	   / **/
 #define CTIME_R_PROTO 0	   /**/
 
 /* HAS_DRAND48_R:
@@ -1174,7 +1176,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_drand48_r
  *	is defined.
  */
-/*#define HAS_DRAND48_R	   /**/
+/*#define HAS_DRAND48_R	   / **/
 #define DRAND48_R_PROTO 0	   /**/
 
 /* HAS_DRAND48_PROTO:
@@ -1183,19 +1185,19 @@
  *	to the program to supply one.  A good guess is
  *		extern double drand48(void);
  */
-/*#define	HAS_DRAND48_PROTO	/**/
+/*#define	HAS_DRAND48_PROTO	/ **/
 
 /* HAS_EACCESS:
  *	This symbol, if defined, indicates that the eaccess routine is
  *	available to do extended access checks.
  */
-/*#define HAS_EACCESS		/**/
+/*#define HAS_EACCESS		/ **/
 
 /* HAS_ENDGRENT:
  *	This symbol, if defined, indicates that the getgrent routine is
  *	available for finalizing sequential access of the group database.
  */
-/*#define HAS_ENDGRENT		/**/
+/*#define HAS_ENDGRENT		/ **/
 
 /* HAS_ENDGRENT_R:
  *	This symbol, if defined, indicates that the endgrent_r routine
@@ -1207,14 +1209,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_endgrent_r
  *	is defined.
  */
-/*#define HAS_ENDGRENT_R	   /**/
+/*#define HAS_ENDGRENT_R	   / **/
 #define ENDGRENT_R_PROTO 0	   /**/
 
 /* HAS_ENDHOSTENT:
  *	This symbol, if defined, indicates that the endhostent() routine is
  *	available to close whatever was being used for host queries.
  */
-/*#define HAS_ENDHOSTENT		/**/
+/*#define HAS_ENDHOSTENT		/ **/
 
 /* HAS_ENDHOSTENT_R:
  *	This symbol, if defined, indicates that the endhostent_r routine
@@ -1226,14 +1228,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_endhostent_r
  *	is defined.
  */
-/*#define HAS_ENDHOSTENT_R	   /**/
+/*#define HAS_ENDHOSTENT_R	   / **/
 #define ENDHOSTENT_R_PROTO 0	   /**/
 
 /* HAS_ENDNETENT:
  *	This symbol, if defined, indicates that the endnetent() routine is
  *	available to close whatever was being used for network queries.
  */
-/*#define HAS_ENDNETENT		/**/
+/*#define HAS_ENDNETENT		/ **/
 
 /* HAS_ENDNETENT_R:
  *	This symbol, if defined, indicates that the endnetent_r routine
@@ -1245,14 +1247,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_endnetent_r
  *	is defined.
  */
-/*#define HAS_ENDNETENT_R	   /**/
+/*#define HAS_ENDNETENT_R	   / **/
 #define ENDNETENT_R_PROTO 0	   /**/
 
 /* HAS_ENDPROTOENT:
  *	This symbol, if defined, indicates that the endprotoent() routine is
  *	available to close whatever was being used for protocol queries.
  */
-/*#define HAS_ENDPROTOENT		/**/
+/*#define HAS_ENDPROTOENT		/ **/
 
 /* HAS_ENDPROTOENT_R:
  *	This symbol, if defined, indicates that the endprotoent_r routine
@@ -1264,14 +1266,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_endprotoent_r
  *	is defined.
  */
-/*#define HAS_ENDPROTOENT_R	   /**/
+/*#define HAS_ENDPROTOENT_R	   / **/
 #define ENDPROTOENT_R_PROTO 0	   /**/
 
 /* HAS_ENDPWENT:
  *	This symbol, if defined, indicates that the getgrent routine is
  *	available for finalizing sequential access of the passwd database.
  */
-/*#define HAS_ENDPWENT		/**/
+/*#define HAS_ENDPWENT		/ **/
 
 /* HAS_ENDPWENT_R:
  *	This symbol, if defined, indicates that the endpwent_r routine
@@ -1283,14 +1285,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_endpwent_r
  *	is defined.
  */
-/*#define HAS_ENDPWENT_R	   /**/
+/*#define HAS_ENDPWENT_R	   / **/
 #define ENDPWENT_R_PROTO 0	   /**/
 
 /* HAS_ENDSERVENT:
  *	This symbol, if defined, indicates that the endservent() routine is
  *	available to close whatever was being used for service queries.
  */
-/*#define HAS_ENDSERVENT		/**/
+/*#define HAS_ENDSERVENT		/ **/
 
 /* HAS_ENDSERVENT_R:
  *	This symbol, if defined, indicates that the endservent_r routine
@@ -1302,7 +1304,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_endservent_r
  *	is defined.
  */
-/*#define HAS_ENDSERVENT_R	   /**/
+/*#define HAS_ENDSERVENT_R	   / **/
 #define ENDSERVENT_R_PROTO 0	   /**/
 
 /* FLEXFILENAMES:
@@ -1315,7 +1317,7 @@
  *	This symbol, if defined, indicates that the getgrent routine is
  *	available for sequential access of the group database.
  */
-/*#define HAS_GETGRENT		/**/
+/*#define HAS_GETGRENT		/ **/
 
 /* HAS_GETGRENT_R:
  *	This symbol, if defined, indicates that the getgrent_r routine
@@ -1327,7 +1329,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getgrent_r
  *	is defined.
  */
-/*#define HAS_GETGRENT_R	   /**/
+/*#define HAS_GETGRENT_R	   / **/
 #define GETGRENT_R_PROTO 0	   /**/
 
 /* HAS_GETGRGID_R:
@@ -1340,7 +1342,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getgrgid_r
  *	is defined.
  */
-/*#define HAS_GETGRGID_R	   /**/
+/*#define HAS_GETGRGID_R	   / **/
 #define GETGRGID_R_PROTO 0	   /**/
 
 /* HAS_GETGRNAM_R:
@@ -1353,7 +1355,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getgrnam_r
  *	is defined.
  */
-/*#define HAS_GETGRNAM_R	   /**/
+/*#define HAS_GETGRNAM_R	   / **/
 #define GETGRNAM_R_PROTO 0	   /**/
 
 /* HAS_GETHOSTBYADDR:
@@ -1372,7 +1374,7 @@
  *	This symbol, if defined, indicates that the gethostent() routine is
  *	available to look up host names in some data base or another.
  */
-/*#define HAS_GETHOSTENT		/**/
+/*#define HAS_GETHOSTENT		/ **/
 
 /* HAS_GETHOSTNAME:
  *	This symbol, if defined, indicates that the C program may use the
@@ -1398,7 +1400,7 @@
  */
 #define HAS_GETHOSTNAME	/**/
 #define HAS_UNAME		/**/
-/*#define HAS_PHOSTNAME	/**/
+/*#define HAS_PHOSTNAME	/ **/
 #ifdef HAS_PHOSTNAME
 #define PHOSTNAME ""	/* How to get the host name */
 #endif
@@ -1413,7 +1415,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_gethostbyaddr_r
  *	is defined.
  */
-/*#define HAS_GETHOSTBYADDR_R	   /**/
+/*#define HAS_GETHOSTBYADDR_R	   / **/
 #define GETHOSTBYADDR_R_PROTO 0	   /**/
 
 /* HAS_GETHOSTBYNAME_R:
@@ -1426,7 +1428,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_gethostbyname_r
  *	is defined.
  */
-/*#define HAS_GETHOSTBYNAME_R	   /**/
+/*#define HAS_GETHOSTBYNAME_R	   / **/
 #define GETHOSTBYNAME_R_PROTO 0	   /**/
 
 /* HAS_GETHOSTENT_R:
@@ -1439,7 +1441,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_gethostent_r
  *	is defined.
  */
-/*#define HAS_GETHOSTENT_R	   /**/
+/*#define HAS_GETHOSTENT_R	   / **/
 #define GETHOSTENT_R_PROTO 0	   /**/
 
 /* HAS_GETHOST_PROTOS:
@@ -1460,26 +1462,26 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getlogin_r
  *	is defined.
  */
-/*#define HAS_GETLOGIN_R	   /**/
+/*#define HAS_GETLOGIN_R	   / **/
 #define GETLOGIN_R_PROTO 0	   /**/
 
 /* HAS_GETNETBYADDR:
  *	This symbol, if defined, indicates that the getnetbyaddr() routine is
  *	available to look up networks by their IP addresses.
  */
-/*#define HAS_GETNETBYADDR		/**/
+/*#define HAS_GETNETBYADDR		/ **/
 
 /* HAS_GETNETBYNAME:
  *	This symbol, if defined, indicates that the getnetbyname() routine is
  *	available to look up networks by their names.
  */
-/*#define HAS_GETNETBYNAME		/**/
+/*#define HAS_GETNETBYNAME		/ **/
 
 /* HAS_GETNETENT:
  *	This symbol, if defined, indicates that the getnetent() routine is
  *	available to look up network names in some data base or another.
  */
-/*#define HAS_GETNETENT		/**/
+/*#define HAS_GETNETENT		/ **/
 
 /* HAS_GETNETBYADDR_R:
  *	This symbol, if defined, indicates that the getnetbyaddr_r routine
@@ -1491,7 +1493,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getnetbyaddr_r
  *	is defined.
  */
-/*#define HAS_GETNETBYADDR_R	   /**/
+/*#define HAS_GETNETBYADDR_R	   / **/
 #define GETNETBYADDR_R_PROTO 0	   /**/
 
 /* HAS_GETNETBYNAME_R:
@@ -1504,7 +1506,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getnetbyname_r
  *	is defined.
  */
-/*#define HAS_GETNETBYNAME_R	   /**/
+/*#define HAS_GETNETBYNAME_R	   / **/
 #define GETNETBYNAME_R_PROTO 0	   /**/
 
 /* HAS_GETNETENT_R:
@@ -1517,7 +1519,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getnetent_r
  *	is defined.
  */
-/*#define HAS_GETNETENT_R	   /**/
+/*#define HAS_GETNETENT_R	   / **/
 #define GETNETENT_R_PROTO 0	   /**/
 
 /* HAS_GETNET_PROTOS:
@@ -1526,13 +1528,13 @@
  *	getnetbyaddr().  Otherwise, it is up to the program to guess
  *	them.  See netdbtype.U for probing for various Netdb_xxx_t types.
  */
-/*#define	HAS_GETNET_PROTOS	/**/
+/*#define	HAS_GETNET_PROTOS	/ **/
 
 /* HAS_GETPROTOENT:
  *	This symbol, if defined, indicates that the getprotoent() routine is
  *	available to look up protocols in some data base or another.
  */
-/*#define HAS_GETPROTOENT		/**/
+/*#define HAS_GETPROTOENT		/ **/
 
 /* HAS_GETPGRP:
  *	This symbol, if defined, indicates that the getpgrp routine is
@@ -1542,8 +1544,8 @@
  *	This symbol, if defined, indicates that getpgrp needs one
  *	arguments whereas USG one needs none.
  */
-/*#define HAS_GETPGRP		/**/
-/*#define USE_BSD_GETPGRP	/**/
+/*#define HAS_GETPGRP		/ **/
+/*#define USE_BSD_GETPGRP	/ **/
 
 /* HAS_GETPROTOBYNAME:
  *	This symbol, if defined, indicates that the getprotobyname()
@@ -1566,7 +1568,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getprotobyname_r
  *	is defined.
  */
-/*#define HAS_GETPROTOBYNAME_R	   /**/
+/*#define HAS_GETPROTOBYNAME_R	   / **/
 #define GETPROTOBYNAME_R_PROTO 0	   /**/
 
 /* HAS_GETPROTOBYNUMBER_R:
@@ -1579,7 +1581,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getprotobynumber_r
  *	is defined.
  */
-/*#define HAS_GETPROTOBYNUMBER_R	   /**/
+/*#define HAS_GETPROTOBYNUMBER_R	   / **/
 #define GETPROTOBYNUMBER_R_PROTO 0	   /**/
 
 /* HAS_GETPROTOENT_R:
@@ -1592,7 +1594,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getprotoent_r
  *	is defined.
  */
-/*#define HAS_GETPROTOENT_R	   /**/
+/*#define HAS_GETPROTOENT_R	   / **/
 #define GETPROTOENT_R_PROTO 0	   /**/
 
 /* HAS_GETPROTO_PROTOS:
@@ -1608,7 +1610,7 @@
  *	available for sequential access of the passwd database.
  *	If this is not available, the older getpw() function may be available.
  */
-/*#define HAS_GETPWENT		/**/
+/*#define HAS_GETPWENT		/ **/
 
 /* HAS_GETPWENT_R:
  *	This symbol, if defined, indicates that the getpwent_r routine
@@ -1620,7 +1622,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getpwent_r
  *	is defined.
  */
-/*#define HAS_GETPWENT_R	   /**/
+/*#define HAS_GETPWENT_R	   / **/
 #define GETPWENT_R_PROTO 0	   /**/
 
 /* HAS_GETPWNAM_R:
@@ -1633,7 +1635,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getpwnam_r
  *	is defined.
  */
-/*#define HAS_GETPWNAM_R	   /**/
+/*#define HAS_GETPWNAM_R	   / **/
 #define GETPWNAM_R_PROTO 0	   /**/
 
 /* HAS_GETPWUID_R:
@@ -1646,14 +1648,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getpwuid_r
  *	is defined.
  */
-/*#define HAS_GETPWUID_R	   /**/
+/*#define HAS_GETPWUID_R	   / **/
 #define GETPWUID_R_PROTO 0	   /**/
 
 /* HAS_GETSERVENT:
  *	This symbol, if defined, indicates that the getservent() routine is
  *	available to look up network services in some data base or another.
  */
-/*#define HAS_GETSERVENT		/**/
+/*#define HAS_GETSERVENT		/ **/
 
 /* HAS_GETSERVBYNAME_R:
  *	This symbol, if defined, indicates that the getservbyname_r routine
@@ -1665,7 +1667,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getservbyname_r
  *	is defined.
  */
-/*#define HAS_GETSERVBYNAME_R	   /**/
+/*#define HAS_GETSERVBYNAME_R	   / **/
 #define GETSERVBYNAME_R_PROTO 0	   /**/
 
 /* HAS_GETSERVBYPORT_R:
@@ -1678,7 +1680,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getservbyport_r
  *	is defined.
  */
-/*#define HAS_GETSERVBYPORT_R	   /**/
+/*#define HAS_GETSERVBYPORT_R	   / **/
 #define GETSERVBYPORT_R_PROTO 0	   /**/
 
 /* HAS_GETSERVENT_R:
@@ -1691,7 +1693,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getservent_r
  *	is defined.
  */
-/*#define HAS_GETSERVENT_R	   /**/
+/*#define HAS_GETSERVENT_R	   / **/
 #define GETSERVENT_R_PROTO 0	   /**/
 
 /* HAS_GETSERV_PROTOS:
@@ -1712,7 +1714,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_getspnam_r
  *	is defined.
  */
-/*#define HAS_GETSPNAM_R	   /**/
+/*#define HAS_GETSPNAM_R	   / **/
 #define GETSPNAM_R_PROTO 0	   /**/
 
 /* HAS_GETSERVBYNAME:
@@ -1736,7 +1738,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_gmtime_r
  *	is defined.
  */
-/*#define HAS_GMTIME_R	   /**/
+/*#define HAS_GMTIME_R	   / **/
 #define GMTIME_R_PROTO 0	   /**/
 
 /* HAS_HTONL:
@@ -1774,7 +1776,7 @@
  *	changes using \undef{TZ} without explicitly calling tzset
  *	impossible. This symbol makes us call tzset before localtime_r
  */
-/*#define LOCALTIME_R_NEEDS_TZSET /**/
+/*#define LOCALTIME_R_NEEDS_TZSET / **/
 #ifdef LOCALTIME_R_NEEDS_TZSET
 #define L_R_TZSET tzset(),
 #else
@@ -1787,7 +1789,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_localtime_r
  *	is defined.
  */
-/*#define HAS_LOCALTIME_R	   /**/
+/*#define HAS_LOCALTIME_R	   / **/
 #define LOCALTIME_R_PROTO 0	   /**/
 
 /* HAS_LONG_DOUBLE:
@@ -1816,7 +1818,7 @@
  *	C preprocessor can make decisions based on it.  It is only
  *	defined if the system supports long long.
  */
-/*#define HAS_LONG_LONG		/**/
+/*#define HAS_LONG_LONG		/ **/
 #ifdef HAS_LONG_LONG
 #define LONGLONGSIZE 8		/**/
 #endif
@@ -1840,7 +1842,7 @@
  *	available to exclusively create and open a uniquely named
  *	temporary file.
  */
-/*#define HAS_MKSTEMP		/**/
+/*#define HAS_MKSTEMP		/ **/
 
 /* HAS_MMAP:
  *	This symbol, if defined, indicates that the mmap system call is
@@ -1851,14 +1853,14 @@
  *	(and simultaneously the type of the first argument).
  *	Usually set to 'void *' or 'caddr_t'.
  */
-/*#define HAS_MMAP		/**/
+/*#define HAS_MMAP		/ **/
 #define Mmap_t void *	/**/
 
 /* HAS_MSG:
  *	This symbol, if defined, indicates that the entire msg*(2) library is
  *	supported (IPC mechanism based on message queues).
  */
-/*#define HAS_MSG		/**/
+/*#define HAS_MSG		/ **/
 
 /* OLD_PTHREAD_CREATE_JOINABLE:
  *	This symbol, if defined, indicates how to create pthread
@@ -1868,13 +1870,13 @@
  *	If defined, known values are PTHREAD_CREATE_UNDETACHED
  *	and __UNDETACHED.
  */
-/*#define OLD_PTHREAD_CREATE_JOINABLE  /**/
+/*#define OLD_PTHREAD_CREATE_JOINABLE  / **/
 
 /* HAS_PTHREAD_ATFORK:
  *	This symbol, if defined, indicates that the pthread_atfork routine
  *	is available to setup fork handlers.
  */
-/*#define HAS_PTHREAD_ATFORK		/**/
+/*#define HAS_PTHREAD_ATFORK		/ **/
 
 /* HAS_PTHREAD_YIELD:
  *	This symbol, if defined, indicates that the pthread_yield
@@ -1891,9 +1893,9 @@
  *	routine is available to yield the execution of the current
  *	thread.	 sched_yield is preferable to pthread_yield.
  */
-/*#define HAS_PTHREAD_YIELD	/**/
+/*#define HAS_PTHREAD_YIELD	/ **/
 #define SCHED_YIELD		/**/
-/*#define HAS_SCHED_YIELD	/**/
+/*#define HAS_SCHED_YIELD	/ **/
 
 /* HAS_RANDOM_R:
  *	This symbol, if defined, indicates that the random_r routine
@@ -1905,7 +1907,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_random_r
  *	is defined.
  */
-/*#define HAS_RANDOM_R	   /**/
+/*#define HAS_RANDOM_R	   / **/
 #define RANDOM_R_PROTO 0	   /**/
 
 /* HAS_READDIR64_R:
@@ -1918,7 +1920,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_readdir64_r
  *	is defined.
  */
-/*#define HAS_READDIR64_R	   /**/
+/*#define HAS_READDIR64_R	   / **/
 #define READDIR64_R_PROTO 0	   /**/
 
 /* HAS_READDIR_R:
@@ -1931,20 +1933,20 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_readdir_r
  *	is defined.
  */
-/*#define HAS_READDIR_R	   /**/
+/*#define HAS_READDIR_R	   / **/
 #define READDIR_R_PROTO 0	   /**/
 
 /* HAS_SEM:
  *	This symbol, if defined, indicates that the entire sem*(2) library is
  *	supported.
  */
-/*#define HAS_SEM		/**/
+/*#define HAS_SEM		/ **/
 
 /* HAS_SETGRENT:
  *	This symbol, if defined, indicates that the setgrent routine is
  *	available for initializing sequential access of the group database.
  */
-/*#define HAS_SETGRENT		/**/
+/*#define HAS_SETGRENT		/ **/
 
 /* HAS_SETGRENT_R:
  *	This symbol, if defined, indicates that the setgrent_r routine
@@ -1956,14 +1958,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_setgrent_r
  *	is defined.
  */
-/*#define HAS_SETGRENT_R	   /**/
+/*#define HAS_SETGRENT_R	   / **/
 #define SETGRENT_R_PROTO 0	   /**/
 
 /* HAS_SETHOSTENT:
  *	This symbol, if defined, indicates that the sethostent() routine is
  *	available.
  */
-/*#define HAS_SETHOSTENT		/**/
+/*#define HAS_SETHOSTENT		/ **/
 
 /* HAS_SETHOSTENT_R:
  *	This symbol, if defined, indicates that the sethostent_r routine
@@ -1975,7 +1977,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_sethostent_r
  *	is defined.
  */
-/*#define HAS_SETHOSTENT_R	   /**/
+/*#define HAS_SETHOSTENT_R	   / **/
 #define SETHOSTENT_R_PROTO 0	   /**/
 
 /* HAS_SETLOCALE_R:
@@ -1988,14 +1990,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_setlocale_r
  *	is defined.
  */
-/*#define HAS_SETLOCALE_R	   /**/
+/*#define HAS_SETLOCALE_R	   / **/
 #define SETLOCALE_R_PROTO 0	   /**/
 
 /* HAS_SETNETENT:
  *	This symbol, if defined, indicates that the setnetent() routine is
  *	available.
  */
-/*#define HAS_SETNETENT		/**/
+/*#define HAS_SETNETENT		/ **/
 
 /* HAS_SETNETENT_R:
  *	This symbol, if defined, indicates that the setnetent_r routine
@@ -2007,14 +2009,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_setnetent_r
  *	is defined.
  */
-/*#define HAS_SETNETENT_R	   /**/
+/*#define HAS_SETNETENT_R	   / **/
 #define SETNETENT_R_PROTO 0	   /**/
 
 /* HAS_SETPROTOENT:
  *	This symbol, if defined, indicates that the setprotoent() routine is
  *	available.
  */
-/*#define HAS_SETPROTOENT		/**/
+/*#define HAS_SETPROTOENT		/ **/
 
 /* HAS_SETPGRP:
  *	This symbol, if defined, indicates that the setpgrp routine is
@@ -2025,8 +2027,8 @@
  *	arguments whereas USG one needs none.  See also HAS_SETPGID
  *	for a POSIX interface.
  */
-/*#define HAS_SETPGRP		/**/
-/*#define USE_BSD_SETPGRP	/**/
+/*#define HAS_SETPGRP		/ **/
+/*#define USE_BSD_SETPGRP	/ **/
 
 /* HAS_SETPROTOENT_R:
  *	This symbol, if defined, indicates that the setprotoent_r routine
@@ -2038,14 +2040,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_setprotoent_r
  *	is defined.
  */
-/*#define HAS_SETPROTOENT_R	   /**/
+/*#define HAS_SETPROTOENT_R	   / **/
 #define SETPROTOENT_R_PROTO 0	   /**/
 
 /* HAS_SETPWENT:
  *	This symbol, if defined, indicates that the setpwent routine is
  *	available for initializing sequential access of the passwd database.
  */
-/*#define HAS_SETPWENT		/**/
+/*#define HAS_SETPWENT		/ **/
 
 /* HAS_SETPWENT_R:
  *	This symbol, if defined, indicates that the setpwent_r routine
@@ -2057,14 +2059,14 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_setpwent_r
  *	is defined.
  */
-/*#define HAS_SETPWENT_R	   /**/
+/*#define HAS_SETPWENT_R	   / **/
 #define SETPWENT_R_PROTO 0	   /**/
 
 /* HAS_SETSERVENT:
  *	This symbol, if defined, indicates that the setservent() routine is
  *	available.
  */
-/*#define HAS_SETSERVENT		/**/
+/*#define HAS_SETSERVENT		/ **/
 
 /* HAS_SETSERVENT_R:
  *	This symbol, if defined, indicates that the setservent_r routine
@@ -2076,7 +2078,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_setservent_r
  *	is defined.
  */
-/*#define HAS_SETSERVENT_R	   /**/
+/*#define HAS_SETSERVENT_R	   / **/
 #define SETSERVENT_R_PROTO 0	   /**/
 
 /* HAS_SETVBUF:
@@ -2090,7 +2092,7 @@
  *	This symbol, if defined, indicates that the entire shm*(2) library is
  *	supported.
  */
-/*#define HAS_SHM		/**/
+/*#define HAS_SHM		/ **/
 
 /* Shmat_t:
  *	This symbol holds the return type of the shmat() system call.
@@ -2104,7 +2106,7 @@
  *	when HAS_SHMAT_PROTOTYPE is not defined to avoid conflicting defs.
  */
 #define Shmat_t void *	/**/
-/*#define HAS_SHMAT_PROTOTYPE	/**/
+/*#define HAS_SHMAT_PROTOTYPE	/ **/
 
 /* HAS_SOCKET:
  *	This symbol, if defined, indicates that the BSD socket interface is
@@ -2145,13 +2147,13 @@
  *	has been known to be an enum.
  */
 #define	HAS_SOCKET		/**/
-/*#define	HAS_SOCKETPAIR	/**/
-/*#define	HAS_MSG_CTRUNC	/**/
-/*#define	HAS_MSG_DONTROUTE	/**/
-/*#define	HAS_MSG_OOB	/**/
-/*#define	HAS_MSG_PEEK	/**/
-/*#define	HAS_MSG_PROXY	/**/
-/*#define	HAS_SCM_RIGHTS	/**/
+/*#define	HAS_SOCKETPAIR	/ **/
+/*#define	HAS_MSG_CTRUNC	/ **/
+/*#define	HAS_MSG_DONTROUTE	/ **/
+/*#define	HAS_MSG_OOB	/ **/
+/*#define	HAS_MSG_PEEK	/ **/
+/*#define	HAS_MSG_PROXY	/ **/
+/*#define	HAS_SCM_RIGHTS	/ **/
 
 /* HAS_SRAND48_R:
  *	This symbol, if defined, indicates that the srand48_r routine
@@ -2163,7 +2165,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_srand48_r
  *	is defined.
  */
-/*#define HAS_SRAND48_R	   /**/
+/*#define HAS_SRAND48_R	   / **/
 #define SRAND48_R_PROTO 0	   /**/
 
 /* HAS_SRANDOM_R:
@@ -2176,7 +2178,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_srandom_r
  *	is defined.
  */
-/*#define HAS_SRANDOM_R	   /**/
+/*#define HAS_SRANDOM_R	   / **/
 #define SRANDOM_R_PROTO 0	   /**/
 
 /* USE_STAT_BLOCKS:
@@ -2184,7 +2186,7 @@
  *	st_blksize and st_blocks.
  */
 #ifndef USE_STAT_BLOCKS
-/*#define USE_STAT_BLOCKS 	/**/
+/*#define USE_STAT_BLOCKS 	/ **/
 #endif
 
 /* USE_STRUCT_COPY:
@@ -2223,7 +2225,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_strerror_r
  *	is defined.
  */
-/*#define HAS_STRERROR_R	   /**/
+/*#define HAS_STRERROR_R	   / **/
 #define STRERROR_R_PROTO 0	   /**/
 
 /* HAS_STRTOUL:
@@ -2260,7 +2262,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_tmpnam_r
  *	is defined.
  */
-/*#define HAS_TMPNAM_R	   /**/
+/*#define HAS_TMPNAM_R	   / **/
 #define TMPNAM_R_PROTO 0	   /**/
 
 /* HAS_TTYNAME_R:
@@ -2273,7 +2275,7 @@
  *	REENTRANT_PROTO_T_ABC macros of reentr.h if d_ttyname_r
  *	is defined.
  */
-/*#define HAS_TTYNAME_R	   /**/
+/*#define HAS_TTYNAME_R	   / **/
 #define TTYNAME_R_PROTO 0	   /**/
 
 /* HAS_UNION_SEMUN:
@@ -2295,19 +2297,19 @@
  *	used for semctl IPC_STAT.
  */
 #define HAS_UNION_SEMUN	/**/
-/*#define USE_SEMCTL_SEMUN	/**/
-/*#define USE_SEMCTL_SEMID_DS	/**/
+/*#define USE_SEMCTL_SEMUN	/ **/
+/*#define USE_SEMCTL_SEMID_DS	/ **/
 
 /* HAS_VFORK:
  *	This symbol, if defined, indicates that vfork() exists.
  */
-/*#define HAS_VFORK	/**/
+/*#define HAS_VFORK	/ **/
 
 /* HAS_PSEUDOFORK:
  *	This symbol, if defined, indicates that an emulation of the
  *	fork routine is available.
  */
-/*#define HAS_PSEUDOFORK	/**/
+/*#define HAS_PSEUDOFORK	/ **/
 
 /* Signal_t:
  *	This symbol's value is either "void" or "int", corresponding to the
@@ -2386,14 +2388,14 @@
  *	This symbol, if defined, indicates to the C program that struct group
  *	in <grp.h> contains gr_passwd.
  */
-/*#define I_GRP		/**/
-/*#define GRPASSWD	/**/
+/*#define I_GRP		/ **/
+/*#define GRPASSWD	/ **/
 
 /* I_MACH_CTHREADS:
  *     This symbol, if defined, indicates to the C program that it should
  *     include <mach/cthreads.h>.
  */
-/*#define   I_MACH_CTHREADS	/**/
+/*#define   I_MACH_CTHREADS	/ **/
 
 /* I_NDBM:
  *	This symbol, if defined, indicates that <ndbm.h> exists and should
@@ -2427,30 +2429,30 @@
  *	parameter information. While ANSI C prototypes are supported in C++,
  *	K&R style function declarations will yield errors.
  */
-/*#define I_NDBM	/**/
-/*#define I_GDBMNDBM	/**/
-/*#define I_GDBM_NDBM	/**/
-/*#define NDBM_H_USES_PROTOTYPES	/**/
-/*#define GDBMNDBM_H_USES_PROTOTYPES	/**/
-/*#define GDBM_NDBM_H_USES_PROTOTYPES	/**/
+/*#define I_NDBM	/ **/
+/*#define I_GDBMNDBM	/ **/
+/*#define I_GDBM_NDBM	/ **/
+/*#define NDBM_H_USES_PROTOTYPES	/ **/
+/*#define GDBMNDBM_H_USES_PROTOTYPES	/ **/
+/*#define GDBM_NDBM_H_USES_PROTOTYPES	/ **/
 
 /* I_NETDB:
  *	This symbol, if defined, indicates that <netdb.h> exists and
  *	should be included.
  */
-/*#define I_NETDB		/**/
+/*#define I_NETDB		/ **/
 
 /* I_NET_ERRNO:
  *	This symbol, if defined, indicates that <net/errno.h> exists and
  *	should be included.
  */
-/*#define I_NET_ERRNO		/**/
+/*#define I_NET_ERRNO		/ **/
 
 /* I_PTHREAD:
  *     This symbol, if defined, indicates to the C program that it should
  *     include <pthread.h>.
  */
-/*#define   I_PTHREAD	/**/
+/*#define   I_PTHREAD	/ **/
 
 /* I_PWD:
  *	This symbol, if defined, indicates to the C program that it should
@@ -2488,33 +2490,33 @@
  *	This symbol, if defined, indicates to the C program that struct passwd
  *	contains pw_passwd.
  */
-/*#define I_PWD		/**/
-/*#define PWQUOTA	/**/
-/*#define PWAGE	/**/
-/*#define PWCHANGE	/**/
-/*#define PWCLASS	/**/
-/*#define PWEXPIRE	/**/
-/*#define PWCOMMENT	/**/
-/*#define PWGECOS	/**/
-/*#define PWPASSWD	/**/
+/*#define I_PWD		/ **/
+/*#define PWQUOTA	/ **/
+/*#define PWAGE	/ **/
+/*#define PWCHANGE	/ **/
+/*#define PWCLASS	/ **/
+/*#define PWEXPIRE	/ **/
+/*#define PWCOMMENT	/ **/
+/*#define PWGECOS	/ **/
+/*#define PWPASSWD	/ **/
 
 /* I_SYS_ACCESS:
  *     This symbol, if defined, indicates to the C program that it should
  *     include <sys/access.h>.
  */
-/*#define   I_SYS_ACCESS                /**/
+/*#define   I_SYS_ACCESS                / **/
 
 /* I_SYS_SECURITY:
  *     This symbol, if defined, indicates to the C program that it should
  *     include <sys/security.h>.
  */
-/*#define   I_SYS_SECURITY	/**/
+/*#define   I_SYS_SECURITY	/ **/
 
 /* I_SYSUIO:
  *	This symbol, if defined, indicates that <sys/uio.h> exists and
  *	should be included.
  */
-/*#define	I_SYSUIO		/**/
+/*#define	I_SYSUIO		/ **/
 
 /* I_STDARG:
  *	This symbol, if defined, indicates that <stdarg.h> exists and should
@@ -2525,7 +2527,7 @@
  *	include <varargs.h>.
  */
 #define I_STDARG		/**/
-/*#define I_VARARGS	/**/
+/*#define I_VARARGS	/ **/
 
 /* PERL_INC_VERSION_LIST:
  *	This variable specifies the list of subdirectories in over
@@ -2534,13 +2536,13 @@
  *	for a C initialization string.  See the inc_version_list entry
  *	in Porting/Glossary for more details.
  */
-/*#define PERL_INC_VERSION_LIST 0		/**/
+/*#define PERL_INC_VERSION_LIST 0		/ **/
 
 /* INSTALL_USR_BIN_PERL:
  *	This symbol, if defined, indicates that Perl is to be installed
  * 	also as /usr/bin/perl.
  */
-/*#define INSTALL_USR_BIN_PERL	/**/
+/*#define INSTALL_USR_BIN_PERL	/ **/
 
 /* Off_t:
  *	This symbol holds the type used to declare offsets in the kernel.
@@ -2575,7 +2577,7 @@
 /* MYMALLOC:
  *	This symbol, if defined, indicates that we're using our own malloc.
  */
-/*#define MYMALLOC			/**/
+/*#define MYMALLOC			/ **/
 
 /* Mode_t:
  *	This symbol holds the type used to declare file modes
@@ -2614,7 +2616,7 @@
  *	and architecture-specific directories.  See PERL_INC_VERSION_LIST
  *	for more details.
  */
-/*#define PERL_OTHERLIBDIRS ""		/**/
+/*#define PERL_OTHERLIBDIRS ""		/ **/
 
 /* Pid_t:
  *	This symbol holds the type used to declare process ids in the kernel.
@@ -2634,7 +2636,7 @@
  *	in programs that are not prepared to deal with ~ expansion at run-time.
  */
 #define PRIVLIB "c:\\perl\\lib"		/**/
-#define PRIVLIB_EXP (win32_get_privlib("5.11.0"))	/**/
+#define PRIVLIB_EXP (win32_get_privlib(PERL_VERSION_STRING, NULL))	/**/
 
 /* CAN_PROTOTYPE:
  *	If defined, this macro indicates that the C compiler can handle
@@ -2727,7 +2729,7 @@
  *	in programs that are not prepared to deal with ~ expansion at run-time.
  */
 #define SITEARCH "c:\\perl\\site\\lib"		/**/
-/*#define SITEARCH_EXP ""	/**/
+/*#define SITEARCH_EXP ""	/ **/
 
 /* SITELIB:
  *	This symbol contains the name of the private library for this package.
@@ -2750,7 +2752,7 @@
  *	be tacked onto this variable to generate a list of directories to search.
  */
 #define SITELIB "c:\\perl\\site\\lib"		/**/
-#define SITELIB_EXP (win32_get_sitelib("5.11.0"))	/**/
+#define SITELIB_EXP (win32_get_sitelib(PERL_VERSION_STRING, NULL))	/**/
 #define SITELIB_STEM ""		/**/
 
 /* Size_t_size:
@@ -2819,13 +2821,13 @@
  *	try to use the various _r versions of library functions.
  *	This is extremely experimental.
  */
-/*#define	USE_5005THREADS		/**/
-/*#define	USE_ITHREADS		/**/
+/*#define	USE_5005THREADS		/ **/
+/*#define	USE_ITHREADS		/ **/
 #if defined(USE_5005THREADS) && !defined(USE_ITHREADS)
 #define		USE_THREADS		/* until src is revised*/
 #endif
-/*#define	OLD_PTHREADS_API		/**/
-/*#define	USE_REENTRANT_API	/**/
+/*#define	OLD_PTHREADS_API		/ **/
+/*#define	USE_REENTRANT_API	/ **/
 
 /* PERL_VENDORARCH:
  *	If defined, this symbol contains the name of a private library.
@@ -2842,8 +2844,8 @@
  *	This symbol contains the ~name expanded version of PERL_VENDORARCH, to be used
  *	in programs that are not prepared to deal with ~ expansion at run-time.
  */
-/*#define PERL_VENDORARCH ""		/**/
-/*#define PERL_VENDORARCH_EXP ""		/**/
+/*#define PERL_VENDORARCH ""		/ **/
+/*#define PERL_VENDORARCH_EXP ""		/ **/
 
 /* PERL_VENDORLIB_EXP:
  *	This symbol contains the ~name expanded version of VENDORLIB, to be used
@@ -2854,8 +2856,8 @@
  *	removed.  The elements in inc_version_list (inc_version_list.U) can
  *	be tacked onto this variable to generate a list of directories to search.
  */
-/*#define PERL_VENDORLIB_EXP ""		/**/
-/*#define PERL_VENDORLIB_STEM ""		/**/
+/*#define PERL_VENDORLIB_EXP ""		/ **/
+/*#define PERL_VENDORLIB_STEM ""		/ **/
 
 /* VOIDFLAGS:
  *	This symbol indicates how much support of the void type is given by this
@@ -2890,7 +2892,7 @@
  *	Perl has been cross-compiled to.  Undefined if not a cross-compile.
  */
 #ifndef USE_CROSS_COMPILE
-/*#define	USE_CROSS_COMPILE	/**/
+/*#define	USE_CROSS_COMPILE	/ **/
 #define	PERL_TARGETARCH	""	/**/
 #endif
 
@@ -2948,6 +2950,12 @@
 #define BYTEORDER 0x1234	/* large digits for MSB */
 #endif /* NeXT */
 
+/* CHARBITS:
+ *	This symbol contains the size of a char, so that the C preprocessor
+ *	can make decisions based on it.
+ */
+#define CHARBITS 8		/**/
+
 /* CASTI32:
  *	This symbol is defined if the C compiler can cast negative
  *	or large floating point numbers to 32-bit ints.
@@ -2975,7 +2983,7 @@
  *	This symbol, if defined, indicates that the closedir() routine
  *	does not return a value.
  */
-/*#define VOID_CLOSEDIR		/**/
+/*#define VOID_CLOSEDIR		/ **/
 
 /* HAS_FD_SET:
  *	This symbol, when defined, indicates presence of the fd_set typedef
@@ -3005,14 +3013,14 @@
  *	is available to get system page size, which is the granularity of
  *	many memory management calls.
  */
-/*#define HAS_GETPAGESIZE		/**/
+/*#define HAS_GETPAGESIZE		/ **/
 
 /* HAS_GNULIBC:
  *	This symbol, if defined, indicates to the C program that
  *	the GNU C library is being used.  A better check is to use
  *	the __GLIBC__ and __GLIBC_MINOR__ symbols supplied with glibc.
  */
-/*#define HAS_GNULIBC  	/**/
+/*#define HAS_GNULIBC  	/ **/
 #if defined(HAS_GNULIBC) && !defined(_GNU_SOURCE)
 #   define _GNU_SOURCE
 #endif
@@ -3028,13 +3036,13 @@
  *	available to operate on a symbolic link (instead of following the
  *	link).
  */
-/*#define HAS_LCHOWN		/**/
+/*#define HAS_LCHOWN		/ **/
 
 /* HAS_OPEN3:
  *	This manifest constant lets the C program know that the three
  *	argument form of open(2) is available.
  */
-/*#define HAS_OPEN3		/**/
+/*#define HAS_OPEN3		/ **/
 
 /* HAS_SAFE_BCOPY:
  *	This symbol, if defined, indicates that the bcopy routine is available
@@ -3042,7 +3050,7 @@
  *	probably use memmove() or memcpy(). If neither is defined, roll your
  *	own version.
  */
-/*#define HAS_SAFE_BCOPY	/**/
+/*#define HAS_SAFE_BCOPY	/ **/
 
 /* HAS_SAFE_MEMCPY:
  *	This symbol, if defined, indicates that the memcpy routine is available
@@ -3050,7 +3058,7 @@
  *	copy overlapping memory blocks, you should check HAS_MEMMOVE and
  *	use memmove() instead, if available.
  */
-/*#define HAS_SAFE_MEMCPY	/**/
+/*#define HAS_SAFE_MEMCPY	/ **/
 
 /* HAS_SANE_MEMCMP:
  *	This symbol, if defined, indicates that the memcmp routine is available
@@ -3063,7 +3071,7 @@
  *	This symbol, if defined, indicates that Vr4's sigaction() routine
  *	is available.
  */
-/*#define HAS_SIGACTION	/**/
+/*#define HAS_SIGACTION	/ **/
 
 /* HAS_SIGSETJMP:
  *	This variable indicates to the C program that the sigsetjmp()
@@ -3085,7 +3093,7 @@
  *	traditional longjmp() if siglongjmp isn't available.
  *	See HAS_SIGSETJMP.
  */
-/*#define HAS_SIGSETJMP	/**/
+/*#define HAS_SIGSETJMP	/ **/
 #ifdef HAS_SIGSETJMP
 #define Sigjmp_buf sigjmp_buf
 #define Sigsetjmp(buf,save_mask) sigsetjmp((buf),(save_mask))
@@ -3136,7 +3144,7 @@
 #define STDIO_PTR_LVALUE 		/**/
 #define FILE_cnt(fp)	((fp)->_cnt)
 #define STDIO_CNT_LVALUE 		/**/
-/*#define STDIO_PTR_LVAL_SETS_CNT	/**/
+/*#define STDIO_PTR_LVAL_SETS_CNT	/ **/
 #define STDIO_PTR_LVAL_NOCHANGE_CNT	/**/
 #endif
 
@@ -3178,7 +3186,7 @@
  *	symbol.
  */
 #define HAS_VPRINTF	/**/
-/*#define USE_CHAR_VSPRINTF 	/**/
+/*#define USE_CHAR_VSPRINTF 	/ **/
 
 /* DOUBLESIZE:
  *	This symbol contains the size of a double, so that the C preprocessor
@@ -3207,10 +3215,10 @@
  *	the struct tm has a tm_gmtoff field.
  */
 #define I_TIME		/**/
-/*#define I_SYS_TIME		/**/
-/*#define I_SYS_TIME_KERNEL		/**/
-/*#define HAS_TM_TM_ZONE		/**/
-/*#define HAS_TM_TM_GMTOFF		/**/
+/*#define I_SYS_TIME		/ **/
+/*#define I_SYS_TIME_KERNEL		/ **/
+/*#define HAS_TM_TM_ZONE		/ **/
+/*#define HAS_TM_TM_GMTOFF		/ **/
 
 /* VAL_O_NONBLOCK:
  *	This symbol is to be used during open() or fcntl(F_SETFL) to turn on
@@ -3286,38 +3294,58 @@
  *     This symbol, if defined, indicates that this system uses
  *	EBCDIC encoding.
  */
-/*#define	EBCDIC 		/**/
+/*#define	EBCDIC 		/ **/
+
+/* SETUID_SCRIPTS_ARE_SECURE_NOW:
+ *	This symbol, if defined, indicates that the bug that prevents
+ *	setuid scripts from being secure is not present in this kernel.
+ */
+/* DOSUID:
+ *	This symbol, if defined, indicates that the C program should
+ *	check the script that it is executing for setuid/setgid bits, and
+ *	attempt to emulate setuid/setgid on systems that have disabled
+ *	setuid #! scripts because the kernel can't do it securely.
+ *	It is up to the package designer to make sure that this emulation
+ *	is done securely.  Among other things, it should do an fstat on
+ *	the script it just opened to make sure it really is a setuid/setgid
+ *	script, it should make sure the arguments passed correspond exactly
+ *	to the argument on the #! line, and it should not trust any
+ *	subprocesses to which it must pass the filename rather than the
+ *	file descriptor of the script to be executed.
+ */
+/*#define SETUID_SCRIPTS_ARE_SECURE_NOW	/ **/
+/*#define DOSUID		/ **/
 
 /* PERL_USE_DEVEL:
  *	This symbol, if defined, indicates that Perl was configured with
  *	-Dusedevel, to enable development features.  This should not be
  *	done for production builds.
  */
-/*#define	PERL_USE_DEVEL		/**/
+/*#define	PERL_USE_DEVEL		/ **/
 
 /* HAS_ATOLF:
  *	This symbol, if defined, indicates that the atolf routine is
  *	available to convert strings into long doubles.
  */
-/*#define HAS_ATOLF		/**/
+/*#define HAS_ATOLF		/ **/
 
 /* HAS_ATOLL:
  *	This symbol, if defined, indicates that the atoll routine is
  *	available to convert strings into long longs.
  */
-/*#define HAS_ATOLL		/**/
+/*#define HAS_ATOLL		/ **/
 
 /* HAS__FWALK:
  *	This symbol, if defined, indicates that the _fwalk system call is
  *	available to apply a function to all the file handles.
  */
-/*#define HAS__FWALK		/**/
+/*#define HAS__FWALK		/ **/
 
 /* HAS_AINTL:
  *	This symbol, if defined, indicates that the aintl routine is
  *	available.  If copysignl is also present we can emulate modfl.
  */
-/*#define HAS_AINTL		/**/
+/*#define HAS_AINTL		/ **/
 
 /* HAS_BUILTIN_CHOOSE_EXPR:
  *	Can we handle GCC builtin for compile-time ternary-like expressions
@@ -3326,13 +3354,13 @@
  *	Can we handle GCC builtin for telling that certain values are more
  *	likely
  */
-/*#define HAS_BUILTIN_EXPECT	/**/
-/*#define HAS_BUILTIN_CHOOSE_EXPR	/**/
+/*#define HAS_BUILTIN_EXPECT	/ **/
+/*#define HAS_BUILTIN_CHOOSE_EXPR	/ **/
 
 /* HAS_C99_VARIADIC_MACROS:
  *	If defined, the compiler supports C99 variadic macros.
  */
-/*#define	HAS_C99_VARIADIC_MACROS	/**/
+/*#define	HAS_C99_VARIADIC_MACROS	/ **/
 
 /* HAS_CLASS:
  *	This symbol, if defined, indicates that the class routine is
@@ -3350,31 +3378,31 @@
  *	FP_NANS		Signaling Not a Number (NaNS)
  *	FP_NANQ		Quiet Not a Number (NaNQ)
  */
-/*#define HAS_CLASS		/**/
+/*#define HAS_CLASS		/ **/
 
 /* HAS_CLEARENV:
  *	This symbol, if defined, indicates that the clearenv () routine is
  *	available for use.
  */
-/*#define HAS_CLEARENV		/**/
+/*#define HAS_CLEARENV		/ **/
 
 /* HAS_STRUCT_CMSGHDR:
  *	This symbol, if defined, indicates that the struct cmsghdr
  *	is supported.
  */
-/*#define HAS_STRUCT_CMSGHDR	/**/
+/*#define HAS_STRUCT_CMSGHDR	/ **/
 
 /* HAS_COPYSIGNL:
  *	This symbol, if defined, indicates that the copysignl routine is
  *	available.  If aintl is also present we can emulate modfl.
  */
-/*#define HAS_COPYSIGNL		/**/
+/*#define HAS_COPYSIGNL		/ **/
 
 /* USE_CPLUSPLUS:
  *	This symbol, if defined, indicates that a C++ compiler was
  *	used to compiled Perl and will be used to compile extensions.
  */
-/*#define USE_CPLUSPLUS		/**/
+/*#define USE_CPLUSPLUS		/ **/
 
 /* HAS_DBMINIT_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3382,19 +3410,19 @@
  *	to the program to supply one.  A good guess is
  *		extern int dbminit(char *);
  */
-/*#define	HAS_DBMINIT_PROTO	/**/
+/*#define	HAS_DBMINIT_PROTO	/ **/
 
 /* HAS_DIR_DD_FD:
  *	This symbol, if defined, indicates that the the DIR* dirstream
  *	structure contains a member variable named dd_fd.
  */
-/*#define HAS_DIR_DD_FD		/**/
+/*#define HAS_DIR_DD_FD		/ **/
 
 /* HAS_DIRFD:
  *	This manifest constant lets the C program know that dirfd
  *	is available.
  */
-/*#define HAS_DIRFD		/**/
+/*#define HAS_DIRFD		/ **/
 
 /* DLSYM_NEEDS_UNDERSCORE:
  *	This symbol, if defined, indicates that we need to prepend an
@@ -3402,7 +3430,7 @@
  *	makes sense if you *have* dlsym, which we will presume is the
  *	case if you're using dl_dlopen.xs.
  */
-/*#define 	DLSYM_NEEDS_UNDERSCORE 	/**/
+/*#define 	DLSYM_NEEDS_UNDERSCORE 	/ **/
 
 /* HAS_FAST_STDIO:
  *	This symbol, if defined, indicates that the "fast stdio"
@@ -3414,27 +3442,27 @@
  *	This symbol, if defined, indicates that the fchdir routine is
  *	available to change directory using a file descriptor.
  */
-/*#define HAS_FCHDIR		/**/
+/*#define HAS_FCHDIR		/ **/
 
 /* FCNTL_CAN_LOCK:
  *	This symbol, if defined, indicates that fcntl() can be used
  *	for file locking.  Normally on Unix systems this is defined.
  *	It may be undefined on VMS.
  */
-/*#define FCNTL_CAN_LOCK		/**/
+/*#define FCNTL_CAN_LOCK		/ **/
 
 /* HAS_FINITE:
  *	This symbol, if defined, indicates that the finite routine is
  *	available to check whether a double is finite (non-infinity non-NaN).
  */
-/*#define HAS_FINITE		/**/
+/*#define HAS_FINITE		/ **/
 
 /* HAS_FINITEL:
  *	This symbol, if defined, indicates that the finitel routine is
  *	available to check whether a long double is finite
  *	(non-infinity non-NaN).
  */
-/*#define HAS_FINITEL		/**/
+/*#define HAS_FINITEL		/ **/
 
 /* HAS_FLOCK_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3460,7 +3488,7 @@
  *	FP_POS_ZERO       +0.0 (positive zero)
  *	FP_NEG_ZERO       -0.0 (negative zero)
  */
-/*#define HAS_FP_CLASS		/**/
+/*#define HAS_FP_CLASS		/ **/
 
 /* HAS_FPCLASS:
  *	This symbol, if defined, indicates that the fpclass routine is
@@ -3478,7 +3506,7 @@
  *	FP_NNORM	negative normalized non-zero
  *	FP_PNORM	positive normalized non-zero
  */
-/*#define HAS_FPCLASS		/**/
+/*#define HAS_FPCLASS		/ **/
 
 /* HAS_FPCLASSIFY:
  *	This symbol, if defined, indicates that the fpclassify routine is
@@ -3492,7 +3520,7 @@
  *           FP_NAN        NaN
  *
  */
-/*#define HAS_FPCLASSIFY		/**/
+/*#define HAS_FPCLASSIFY		/ **/
 
 /* HAS_FPCLASSL:
  *	This symbol, if defined, indicates that the fpclassl routine is
@@ -3510,56 +3538,62 @@
  *	FP_NNORM	negative normalized non-zero
  *	FP_PNORM	positive normalized non-zero
  */
-/*#define HAS_FPCLASSL		/**/
+/*#define HAS_FPCLASSL		/ **/
 
 /* HAS_FPOS64_T:
  *	This symbol will be defined if the C compiler supports fpos64_t.
  */
-/*#define	HAS_FPOS64_T    	/**/
+/*#define	HAS_FPOS64_T    	/ **/
 
 /* HAS_FREXPL:
  *	This symbol, if defined, indicates that the frexpl routine is
  *	available to break a long double floating-point number into
  *	a normalized fraction and an integral power of 2.
  */
-/*#define HAS_FREXPL		/**/
+/*#define HAS_FREXPL		/ **/
 
 /* HAS_STRUCT_FS_DATA:
  *	This symbol, if defined, indicates that the struct fs_data
  *	to do statfs() is supported.
  */
-/*#define HAS_STRUCT_FS_DATA	/**/
+/*#define HAS_STRUCT_FS_DATA	/ **/
 
 /* HAS_FSEEKO:
  *	This symbol, if defined, indicates that the fseeko routine is
  *	available to fseek beyond 32 bits (useful for ILP32 hosts).
  */
-/*#define HAS_FSEEKO		/**/
+/*#define HAS_FSEEKO		/ **/
 
 /* HAS_FSTATFS:
  *	This symbol, if defined, indicates that the fstatfs routine is
  *	available to stat filesystems by file descriptors.
  */
-/*#define HAS_FSTATFS		/**/
+/*#define HAS_FSTATFS		/ **/
 
 /* HAS_FSYNC:
  *	This symbol, if defined, indicates that the fsync routine is
  *	available to write a file's modified data and attributes to
  *	permanent storage.
  */
-/*#define HAS_FSYNC		/**/
+/*#define HAS_FSYNC		/ **/
 
 /* HAS_FTELLO:
  *	This symbol, if defined, indicates that the ftello routine is
  *	available to ftell beyond 32 bits (useful for ILP32 hosts).
  */
-/*#define HAS_FTELLO		/**/
+/*#define HAS_FTELLO		/ **/
 
 /* HAS_FUTIMES:
  *	This symbol, if defined, indicates that the futimes routine is
  *	available to change file descriptor time stamps with struct timevals.
  */
-/*#define HAS_FUTIMES		/**/
+/*#define HAS_FUTIMES		/ **/
+
+/* HAS_GETADDRINFO:
+ *	This symbol, if defined, indicates that the getaddrinfo() function
+ *	is available for use.
+ */
+/*#define HAS_GETADDRINFO		/ **/
 
 /* HAS_GETCWD:
  *	This symbol, if defined, indicates that the getcwd routine is
@@ -3571,74 +3605,92 @@
  *	This symbol, if defined, indicates that the getespwnam system call is
  *	available to retrieve enchanced (shadow) password entries by name.
  */
-/*#define HAS_GETESPWNAM		/**/
+/*#define HAS_GETESPWNAM		/ **/
 
 /* HAS_GETFSSTAT:
  *	This symbol, if defined, indicates that the getfsstat routine is
  *	available to stat filesystems in bulk.
  */
-/*#define HAS_GETFSSTAT		/**/
+/*#define HAS_GETFSSTAT		/ **/
 
 /* HAS_GETITIMER:
  *	This symbol, if defined, indicates that the getitimer routine is
  *	available to return interval timers.
  */
-/*#define HAS_GETITIMER		/**/
+/*#define HAS_GETITIMER		/ **/
 
 /* HAS_GETMNT:
  *	This symbol, if defined, indicates that the getmnt routine is
  *	available to get filesystem mount info by filename.
  */
-/*#define HAS_GETMNT		/**/
+/*#define HAS_GETMNT		/ **/
 
 /* HAS_GETMNTENT:
  *	This symbol, if defined, indicates that the getmntent routine is
  *	available to iterate through mounted file systems to get their info.
  */
-/*#define HAS_GETMNTENT		/**/
+/*#define HAS_GETMNTENT		/ **/
+
+/* HAS_GETNAMEINFO:
+ *	This symbol, if defined, indicates that the getnameinfo() function
+ *	is available for use.
+ */
+/*#define HAS_GETNAMEINFO		/ **/
 
 /* HAS_GETPRPWNAM:
  *	This symbol, if defined, indicates that the getprpwnam system call is
  *	available to retrieve protected (shadow) password entries by name.
  */
-/*#define HAS_GETPRPWNAM		/**/
+/*#define HAS_GETPRPWNAM		/ **/
 
 /* HAS_GETSPNAM:
  *	This symbol, if defined, indicates that the getspnam system call is
  *	available to retrieve SysV shadow password entries by name.
  */
-/*#define HAS_GETSPNAM		/**/
+/*#define HAS_GETSPNAM		/ **/
 
 /* HAS_HASMNTOPT:
  *	This symbol, if defined, indicates that the hasmntopt routine is
  *	available to query the mount options of file systems.
  */
-/*#define HAS_HASMNTOPT		/**/
+/*#define HAS_HASMNTOPT		/ **/
 
 /* HAS_ILOGBL:
  *	This symbol, if defined, indicates that the ilogbl routine is
  *	available.  If scalbnl is also present we can emulate frexpl.
  */
-/*#define HAS_ILOGBL		/**/
+/*#define HAS_ILOGBL		/ **/
+
+/* HAS_INETNTOP:
+ *	This symbol, if defined, indicates that the inet_ntop() function
+ *	is available to parse IPv4 and IPv6 strings.
+ */
+/*#define HAS_INETNTOP		/ **/
+
+/* HAS_INETPTON:
+ *	This symbol, if defined, indicates that the inet_pton() function
+ *	is available to parse IPv4 and IPv6 strings.
+ */
+/*#define HAS_INETPTON		/ **/
 
 /* HAS_INT64_T:
  *     This symbol will defined if the C compiler supports int64_t.
  *     Usually the <inttypes.h> needs to be included, but sometimes
  *	<sys/types.h> is enough.
  */
-/*#define     HAS_INT64_T               /**/
+/*#define     HAS_INT64_T               / **/
 
 /* HAS_ISFINITE:
  *	This symbol, if defined, indicates that the isfinite routine is
  *	available to check whether a double is finite (non-infinity non-NaN).
  */
-/*#define HAS_ISFINITE		/**/
+/*#define HAS_ISFINITE		/ **/
 
 /* HAS_ISINF:
  *	This symbol, if defined, indicates that the isinf routine is
  *	available to check whether a double is an infinity.
  */
-/*#define HAS_ISINF		/**/
+/*#define HAS_ISINF		/ **/
 
 /* HAS_ISNAN:
  *	This symbol, if defined, indicates that the isnan routine is
@@ -3650,7 +3702,7 @@
  *	This symbol, if defined, indicates that the isnanl routine is
  *	available to check whether a long double is a NaN.
  */
-/*#define HAS_ISNANL		/**/
+/*#define HAS_ISNANL		/ **/
 
 /* HAS_LDBL_DIG:
  *	This symbol, if defined, indicates that this system's <float.h>
@@ -3664,38 +3716,38 @@
  *	This symbol, if defined, indicates that libm exports _LIB_VERSION
  *	and that math.h defines the enum to manipulate it.
  */
-/*#define LIBM_LIB_VERSION		/**/
+/*#define LIBM_LIB_VERSION		/ **/
 
 /* HAS_MADVISE:
  *	This symbol, if defined, indicates that the madvise system call is
  *	available to map a file into memory.
  */
-/*#define HAS_MADVISE		/**/
+/*#define HAS_MADVISE		/ **/
 
 /* HAS_MALLOC_SIZE:
  *	This symbol, if defined, indicates that the malloc_size
  *	routine is available for use.
  */
-/*#define HAS_MALLOC_SIZE		/**/
+/*#define HAS_MALLOC_SIZE		/ **/
 
 /* HAS_MALLOC_GOOD_SIZE:
  *	This symbol, if defined, indicates that the malloc_good_size
  *	routine is available for use.
  */
-/*#define HAS_MALLOC_GOOD_SIZE	/**/
+/*#define HAS_MALLOC_GOOD_SIZE	/ **/
 
 /* HAS_MKDTEMP:
  *	This symbol, if defined, indicates that the mkdtemp routine is
  *	available to exclusively create a uniquely named temporary directory.
  */
-/*#define HAS_MKDTEMP		/**/
+/*#define HAS_MKDTEMP		/ **/
 
 /* HAS_MKSTEMPS:
  *	This symbol, if defined, indicates that the mkstemps routine is
  *	available to excluslvely create and open a uniquely named
  *	(with a suffix) temporary file.
  */
-/*#define HAS_MKSTEMPS		/**/
+/*#define HAS_MKSTEMPS		/ **/
 
 /* HAS_MODFL:
  *	This symbol, if defined, indicates that the modfl routine is
@@ -3714,33 +3766,33 @@
  *	and 1.150000.  The bug has been seen in certain versions of glibc,
  *	release 2.2.2 is known to be okay.
  */
-/*#define HAS_MODFL		/**/
-/*#define HAS_MODFL_PROTO		/**/
-/*#define HAS_MODFL_POW32_BUG		/**/
+/*#define HAS_MODFL		/ **/
+/*#define HAS_MODFL_PROTO		/ **/
+/*#define HAS_MODFL_POW32_BUG		/ **/
 
 /* HAS_MPROTECT:
  *	This symbol, if defined, indicates that the mprotect system call is
  *	available to modify the access protection of a memory mapped file.
  */
-/*#define HAS_MPROTECT		/**/
+/*#define HAS_MPROTECT		/ **/
 
 /* HAS_STRUCT_MSGHDR:
  *	This symbol, if defined, indicates that the struct msghdr
  *	is supported.
  */
-/*#define HAS_STRUCT_MSGHDR	/**/
+/*#define HAS_STRUCT_MSGHDR	/ **/
 
 /* HAS_NL_LANGINFO:
  *	This symbol, if defined, indicates that the nl_langinfo routine is
  *	available to return local data.  You will also need <langinfo.h>
  *	and therefore I_LANGINFO.
  */
-/*#define HAS_NL_LANGINFO		/**/
+/*#define HAS_NL_LANGINFO		/ **/
 
 /* HAS_OFF64_T:
  *	This symbol will be defined if the C compiler supports off64_t.
  */
-/*#define	HAS_OFF64_T    		/**/
+/*#define	HAS_OFF64_T    		/ **/
 
 /* HAS_PROCSELFEXE:
  *	This symbol is defined if PROCSELFEXE_PATH is a symlink
@@ -3751,7 +3803,7 @@
  *	of the symbolic link pointing to the absolute pathname of
  *	the executing program.
  */
-/*#define HAS_PROCSELFEXE	/**/
+/*#define HAS_PROCSELFEXE	/ **/
 #if defined(HAS_PROCSELFEXE) && !defined(PROCSELFEXE_PATH)
 #define PROCSELFEXE_PATH		/**/
 #endif
@@ -3761,20 +3813,20 @@
  *	system call is available to set the contention scope attribute of
  *	a thread attribute object.
  */
-/*#define HAS_PTHREAD_ATTR_SETSCOPE		/**/
+/*#define HAS_PTHREAD_ATTR_SETSCOPE		/ **/
 
 /* HAS_READV:
  *	This symbol, if defined, indicates that the readv routine is
  *	available to do gather reads.  You will also need <sys/uio.h>
  *	and there I_SYSUIO.
  */
-/*#define HAS_READV		/**/
+/*#define HAS_READV		/ **/
 
 /* HAS_RECVMSG:
  *	This symbol, if defined, indicates that the recvmsg routine is
  *	available to send structured socket messages.
  */
-/*#define HAS_RECVMSG		/**/
+/*#define HAS_RECVMSG		/ **/
 
 /* HAS_SBRK_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3783,37 +3835,37 @@
  *		extern void* sbrk(int);
  *		extern void* sbrk(size_t);
  */
-/*#define	HAS_SBRK_PROTO	/**/
+/*#define	HAS_SBRK_PROTO	/ **/
 
 /* HAS_SCALBNL:
  *	This symbol, if defined, indicates that the scalbnl routine is
  *	available.  If ilogbl is also present we can emulate frexpl.
  */
-/*#define HAS_SCALBNL		/**/
+/*#define HAS_SCALBNL		/ **/
 
 /* HAS_SENDMSG:
  *	This symbol, if defined, indicates that the sendmsg routine is
  *	available to send structured socket messages.
  */
-/*#define HAS_SENDMSG		/**/
+/*#define HAS_SENDMSG		/ **/
 
 /* HAS_SETITIMER:
  *	This symbol, if defined, indicates that the setitimer routine is
  *	available to set interval timers.
  */
-/*#define HAS_SETITIMER		/**/
+/*#define HAS_SETITIMER		/ **/
 
 /* HAS_SETPROCTITLE:
  *	This symbol, if defined, indicates that the setproctitle routine is
  *	available to set process title.
  */
-/*#define HAS_SETPROCTITLE		/**/
+/*#define HAS_SETPROCTITLE		/ **/
 
 /* USE_SFIO:
  *	This symbol, if defined, indicates that sfio should
  *	be used.
  */
-/*#define	USE_SFIO		/**/
+/*#define	USE_SFIO		/ **/
 
 /* HAS_SIGNBIT:
  *	This symbol, if defined, indicates that the signbit routine is
@@ -3823,21 +3875,21 @@
  *	in perl.  Users should call Perl_signbit(), which will be #defined to
  *	the system's signbit() function or macro if this symbol is defined.
  */
-/*#define HAS_SIGNBIT		/**/
+/*#define HAS_SIGNBIT		/ **/
 
 /* HAS_SIGPROCMASK:
  *	This symbol, if defined, indicates that the sigprocmask
  *	system call is available to examine or change the signal mask
  *	of the calling process.
  */
-/*#define HAS_SIGPROCMASK		/**/
+/*#define HAS_SIGPROCMASK		/ **/
 
 /* USE_SITECUSTOMIZE:
  *	This symbol, if defined, indicates that sitecustomize should
  *	be used.
  */
 #ifndef USE_SITECUSTOMIZE
-/*#define	USE_SITECUSTOMIZE		/**/
+/*#define	USE_SITECUSTOMIZE		/ **/
 #endif
 
 /* HAS_SNPRINTF:
@@ -3855,7 +3907,7 @@
  *	This symbol, if defined, indicates that the sockatmark routine is
  *	available to test whether a socket is at the out-of-band mark.
  */
-/*#define HAS_SOCKATMARK		/**/
+/*#define HAS_SOCKATMARK		/ **/
 
 /* HAS_SOCKATMARK_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3863,13 +3915,13 @@
  *	to the program to supply one.  A good guess is
  *		extern int sockatmark(int);
  */
-/*#define	HAS_SOCKATMARK_PROTO	/**/
+/*#define	HAS_SOCKATMARK_PROTO	/ **/
 
 /* HAS_SOCKS5_INIT:
  *	This symbol, if defined, indicates that the socks5_init routine is
  *	available to initialize SOCKS 5.
  */
-/*#define HAS_SOCKS5_INIT		/**/
+/*#define HAS_SOCKS5_INIT		/ **/
 
 /* SPRINTF_RETURNS_STRLEN:
  *	This variable defines whether sprintf returns the length of the string
@@ -3883,7 +3935,7 @@
  *	This symbol, if defined, indicates that the sqrtl routine is
  *	available to do long double square roots.
  */
-/*#define HAS_SQRTL		/**/
+/*#define HAS_SQRTL		/ **/
 
 /* HAS_SETRESGID_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3891,7 +3943,7 @@
  *	to the program to supply one.  Good guesses are
  *		extern int setresgid(uid_t ruid, uid_t euid, uid_t suid);
  */
-/*#define	HAS_SETRESGID_PROTO	/**/
+/*#define	HAS_SETRESGID_PROTO	/ **/
 
 /* HAS_SETRESUID_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3899,7 +3951,7 @@
  *	to the program to supply one.  Good guesses are
  *		extern int setresuid(uid_t ruid, uid_t euid, uid_t suid);
  */
-/*#define	HAS_SETRESUID_PROTO	/**/
+/*#define	HAS_SETRESUID_PROTO	/ **/
 
 /* HAS_STRUCT_STATFS_F_FLAGS:
  *	This symbol, if defined, indicates that the struct statfs
@@ -3910,19 +3962,19 @@
  *	have statfs() and struct statfs, they have ustat() and getmnt()
  *	with struct ustat and struct fs_data.
  */
-/*#define HAS_STRUCT_STATFS_F_FLAGS		/**/
+/*#define HAS_STRUCT_STATFS_F_FLAGS		/ **/
 
 /* HAS_STRUCT_STATFS:
  *	This symbol, if defined, indicates that the struct statfs
  *	to do statfs() is supported.
  */
-/*#define HAS_STRUCT_STATFS	/**/
+/*#define HAS_STRUCT_STATFS	/ **/
 
 /* HAS_FSTATVFS:
  *	This symbol, if defined, indicates that the fstatvfs routine is
  *	available to stat filesystems by file descriptors.
  */
-/*#define HAS_FSTATVFS		/**/
+/*#define HAS_FSTATVFS		/ **/
 
 /* HAS_STRFTIME:
  *	This symbol, if defined, indicates that the strftime routine is
@@ -3934,43 +3986,43 @@
  *	This symbol, if defined, indicates that the strlcat () routine is
  *	available to do string concatenation.
  */
-/*#define HAS_STRLCAT		/**/
+/*#define HAS_STRLCAT		/ **/
 
 /* HAS_STRLCPY:
  *	This symbol, if defined, indicates that the strlcpy () routine is
  *	available to do string copying.
  */
-/*#define HAS_STRLCPY		/**/
+/*#define HAS_STRLCPY		/ **/
 
 /* HAS_STRTOLD:
  *	This symbol, if defined, indicates that the strtold routine is
  *	available to convert strings to long doubles.
  */
-/*#define HAS_STRTOLD		/**/
+/*#define HAS_STRTOLD		/ **/
 
 /* HAS_STRTOLL:
  *	This symbol, if defined, indicates that the strtoll routine is
  *	available to convert strings to long longs.
  */
-/*#define HAS_STRTOLL		/**/
+/*#define HAS_STRTOLL		/ **/
 
 /* HAS_STRTOQ:
  *	This symbol, if defined, indicates that the strtoq routine is
  *	available to convert strings to long longs (quads).
  */
-/*#define HAS_STRTOQ		/**/
+/*#define HAS_STRTOQ		/ **/
 
 /* HAS_STRTOULL:
  *	This symbol, if defined, indicates that the strtoull routine is
  *	available to convert strings to unsigned long longs.
  */
-/*#define HAS_STRTOULL		/**/
+/*#define HAS_STRTOULL		/ **/
 
 /* HAS_STRTOUQ:
  *	This symbol, if defined, indicates that the strtouq routine is
  *	available to convert strings to unsigned long longs (quads).
  */
-/*#define HAS_STRTOUQ		/**/
+/*#define HAS_STRTOUQ		/ **/
 
 /* HAS_SYSCALL_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -3979,7 +4031,7 @@
  *		extern int syscall(int,  ...);
  *		extern int syscall(long, ...);
  */
-/*#define	HAS_SYSCALL_PROTO	/**/
+/*#define	HAS_SYSCALL_PROTO	/ **/
 
 /* HAS_TELLDIR_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -4013,18 +4065,18 @@
  *	This symbol, if defined, indicates that the asctime64 () routine is
  *	available to do the 64bit variant of asctime ()
  */
-/*#define	HAS_CTIME64		/**/
-/*#define	HAS_LOCALTIME64		/**/
-/*#define	HAS_GMTIME64		/**/
-/*#define	HAS_MKTIME64		/**/
-/*#define	HAS_DIFFTIME64		/**/
-/*#define	HAS_ASCTIME64		/**/
+/*#define	HAS_CTIME64		/ **/
+/*#define	HAS_LOCALTIME64		/ **/
+/*#define	HAS_GMTIME64		/ **/
+/*#define	HAS_MKTIME64		/ **/
+/*#define	HAS_DIFFTIME64		/ **/
+/*#define	HAS_ASCTIME64		/ **/
 
 /* HAS_TIMEGM:
  *	This symbol, if defined, indicates that the timegm routine is
  *	available to do the opposite of gmtime ()
  */
-/*#define HAS_TIMEGM		/**/
+/*#define HAS_TIMEGM		/ **/
 
 /* U32_ALIGNMENT_REQUIRED:
  *	This symbol, if defined, indicates that you must access
@@ -4038,20 +4090,20 @@
  *	This symbol, if defined, indicates that the ualarm routine is
  *	available to do alarms with microsecond granularity.
  */
-/*#define HAS_UALARM		/**/
+/*#define HAS_UALARM		/ **/
 
 /* HAS_UNORDERED:
  *	This symbol, if defined, indicates that the unordered routine is
  *	available to check whether two doubles are unordered
  *	(effectively: whether either of them is NaN)
  */
-/*#define HAS_UNORDERED		/**/
+/*#define HAS_UNORDERED		/ **/
 
 /* HAS_UNSETENV:
  *	This symbol, if defined, indicates that the unsetenv () routine is
  *	available for use.
  */
-/*#define HAS_UNSETENV		/**/
+/*#define HAS_UNSETENV		/ **/
 
 /* HAS_USLEEP_PROTO:
  *	This symbol, if defined, indicates that the system provides
@@ -4059,19 +4111,19 @@
  *	to the program to supply one.  A good guess is
  *		extern int usleep(useconds_t);
  */
-/*#define	HAS_USLEEP_PROTO	/**/
+/*#define	HAS_USLEEP_PROTO	/ **/
 
 /* HAS_USTAT:
  *	This symbol, if defined, indicates that the ustat system call is
  *	available to query file system statistics by dev_t.
  */
-/*#define HAS_USTAT		/**/
+/*#define HAS_USTAT		/ **/
 
 /* HAS_WRITEV:
  *	This symbol, if defined, indicates that the writev routine is
  *	available to do scatter writes.
  */
-/*#define HAS_WRITEV		/**/
+/*#define HAS_WRITEV		/ **/
 
 /* USE_DYNAMIC_LOADING:
  *	This symbol, if defined, indicates that dynamic loading of
@@ -4091,7 +4143,7 @@
  *	even be probed for and will be left undefined.
  */
 #define	FFLUSH_NULL 		/**/
-/*#define	FFLUSH_ALL 		/**/
+/*#define	FFLUSH_ALL 		/ **/
 
 /* I_ASSERT:
  *	This symbol, if defined, indicates that <assert.h> exists and
@@ -4103,7 +4155,7 @@
  *	This symbol, if defined, indicates that <crypt.h> exists and
  *	should be included.
  */
-/*#define	I_CRYPT		/**/
+/*#define	I_CRYPT		/ **/
 
 /* DB_Prefix_t:
  *	This symbol contains the type of the prefix structure element
@@ -4139,132 +4191,132 @@
  *	This symbol, if defined, indicates that <fp.h> exists and
  *	should be included.
  */
-/*#define	I_FP		/**/
+/*#define	I_FP		/ **/
 
 /* I_FP_CLASS:
  *	This symbol, if defined, indicates that <fp_class.h> exists and
  *	should be included.
  */
-/*#define	I_FP_CLASS		/**/
+/*#define	I_FP_CLASS		/ **/
 
 /* I_IEEEFP:
  *	This symbol, if defined, indicates that <ieeefp.h> exists and
  *	should be included.
  */
-/*#define	I_IEEEFP		/**/
+/*#define	I_IEEEFP		/ **/
 
 /* I_INTTYPES:
  *     This symbol, if defined, indicates to the C program that it should
  *     include <inttypes.h>.
  */
-/*#define   I_INTTYPES                /**/
+/*#define   I_INTTYPES                / **/
 
 /* I_LANGINFO:
  *	This symbol, if defined, indicates that <langinfo.h> exists and
  *	should be included.
  */
-/*#define	I_LANGINFO		/**/
+/*#define	I_LANGINFO		/ **/
 
 /* I_LIBUTIL:
  *	This symbol, if defined, indicates that <libutil.h> exists and
  *	should be included.
  */
-/*#define	I_LIBUTIL		/**/
+/*#define	I_LIBUTIL		/ **/
 
 /* I_MALLOCMALLOC:
  *	This symbol, if defined, indicates to the C program that it should
  *	include <malloc/malloc.h>.
  */
-/*#define I_MALLOCMALLOC		/**/
+/*#define I_MALLOCMALLOC		/ **/
 
 /* I_MNTENT:
  *	This symbol, if defined, indicates that <mntent.h> exists and
  *	should be included.
  */
-/*#define	I_MNTENT		/**/
+/*#define	I_MNTENT		/ **/
 
 /* I_NETINET_TCP:
  *     This symbol, if defined, indicates to the C program that it should
  *     include <netinet/tcp.h>.
  */
-/*#define   I_NETINET_TCP                /**/
+/*#define   I_NETINET_TCP                / **/
 
 /* I_POLL:
  *	This symbol, if defined, indicates that <poll.h> exists and
  *	should be included. (see also HAS_POLL)
  */
-/*#define	I_POLL		/**/
+/*#define	I_POLL		/ **/
 
 /* I_PROT:
  *	This symbol, if defined, indicates that <prot.h> exists and
  *	should be included.
  */
-/*#define	I_PROT		/**/
+/*#define	I_PROT		/ **/
 
 /* I_SHADOW:
  *	This symbol, if defined, indicates that <shadow.h> exists and
  *	should be included.
  */
-/*#define	I_SHADOW		/**/
+/*#define	I_SHADOW		/ **/
 
 /* I_SOCKS:
  *	This symbol, if defined, indicates that <socks.h> exists and
  *	should be included.
  */
-/*#define	I_SOCKS		/**/
+/*#define	I_SOCKS		/ **/
 
 /* I_SUNMATH:
  *	This symbol, if defined, indicates that <sunmath.h> exists and
  *	should be included.
  */
-/*#define	I_SUNMATH		/**/
+/*#define	I_SUNMATH		/ **/
 
 /* I_SYSLOG:
  *	This symbol, if defined, indicates that <syslog.h> exists and
  *	should be included.
  */
-/*#define	I_SYSLOG		/**/
+/*#define	I_SYSLOG		/ **/
 
 /* I_SYSMODE:
  *	This symbol, if defined, indicates that <sys/mode.h> exists and
  *	should be included.
  */
-/*#define	I_SYSMODE		/**/
+/*#define	I_SYSMODE		/ **/
 
 /* I_SYS_MOUNT:
  *	This symbol, if defined, indicates that <sys/mount.h> exists and
  *	should be included.
  */
-/*#define	I_SYS_MOUNT		/**/
+/*#define	I_SYS_MOUNT		/ **/
 
 /* I_SYS_STATFS:
  *	This symbol, if defined, indicates that <sys/statfs.h> exists.
  */
-/*#define	I_SYS_STATFS		/**/
+/*#define	I_SYS_STATFS		/ **/
 
 /* I_SYS_STATVFS:
  *	This symbol, if defined, indicates that <sys/statvfs.h> exists and
  *	should be included.
  */
-/*#define	I_SYS_STATVFS		/**/
+/*#define	I_SYS_STATVFS		/ **/
 
 /* I_SYSUTSNAME:
  *	This symbol, if defined, indicates that <sys/utsname.h> exists and
  *	should be included.
  */
-/*#define	I_SYSUTSNAME		/**/
+/*#define	I_SYSUTSNAME		/ **/
 
 /* I_SYS_VFS:
  *	This symbol, if defined, indicates that <sys/vfs.h> exists and
  *	should be included.
  */
-/*#define	I_SYS_VFS		/**/
+/*#define	I_SYS_VFS		/ **/
 
 /* I_USTAT:
  *	This symbol, if defined, indicates that <ustat.h> exists and
  *	should be included.
  */
-/*#define	I_USTAT		/**/
+/*#define	I_USTAT		/ **/
 
 /* PERL_PRIfldbl:
  *	This symbol, if defined, contains the string used by stdio to
@@ -4282,16 +4334,16 @@
  *	This symbol, if defined, contains the string used by stdio to
  *	format long doubles (format 'f') for input.
  */
-/*#define PERL_PRIfldbl	"f"	/**/
-/*#define PERL_PRIgldbl	"g"	/**/
-/*#define PERL_PRIeldbl	"e"	/**/
-/*#define PERL_SCNfldbl	"f"	/**/
+/*#define PERL_PRIfldbl	"f"	/ **/
+/*#define PERL_PRIgldbl	"g"	/ **/
+/*#define PERL_PRIeldbl	"e"	/ **/
+/*#define PERL_SCNfldbl	"f"	/ **/
 
 /* PERL_MAD:
  *	This symbol, if defined, indicates that the Misc Attribution
  *	Declaration code should be conditionally compiled.
  */
-/*#define	PERL_MAD		/**/
+/*#define	PERL_MAD		/ **/
 
 /* NEED_VA_COPY:
  *	This symbol, if defined, indicates that the system stores
@@ -4302,7 +4354,7 @@
  *	of copying mechanisms, handy.h defines a platform-
  *	independent macro, Perl_va_copy(src, dst), to do the job.
  */
-/*#define	NEED_VA_COPY		/**/
+/*#define	NEED_VA_COPY		/ **/
 
 /* IVTYPE:
  *	This symbol defines the C type used for Perl's IV.
@@ -4502,7 +4554,7 @@
  *	This symbol tells the name of the array holding the stdio streams.
  *	Usual values include _iob, __iob, and __sF.
  */
-/*#define	HAS_STDIO_STREAM_ARRAY	/**/
+/*#define	HAS_STDIO_STREAM_ARRAY	/ **/
 #ifdef HAS_STDIO_STREAM_ARRAY
 #define STDIO_STREAM_ARRAY	
 #endif
@@ -4523,8 +4575,8 @@
  *	This symbol contains the minimum value for the time_t offset that
  *	the system function localtime () accepts, and defaults to 0
  */
-#define GMTIME_MAX		2147483647	/**/
-#define GMTIME_MIN		0	/**/
+#define GMTIME_MAX	2147483647	/**/
+#define GMTIME_MIN	0	/**/
 #define LOCALTIME_MAX	2147483647	/**/
 #define LOCALTIME_MIN	0	/**/
 
@@ -4547,17 +4599,17 @@
  *	you may need at least to reboot your OS to 64-bit mode.
  */
 #ifndef USE_64_BIT_INT
-/*#define	USE_64_BIT_INT		/**/
+/*#define	USE_64_BIT_INT		/ **/
 #endif
 #ifndef USE_64_BIT_ALL
-/*#define	USE_64_BIT_ALL		/**/
+/*#define	USE_64_BIT_ALL		/ **/
 #endif
 
 /* USE_DTRACE:
  *	This symbol, if defined, indicates that Perl should
  *	be built with support for DTrace.
  */
-/*#define USE_DTRACE		/**/
+/*#define USE_DTRACE		/ **/
 
 /* USE_FAST_STDIO:
  *	This symbol, if defined, indicates that Perl should
@@ -4565,7 +4617,7 @@
  *	Defaults to define in Perls 5.8 and earlier, to undef later.
  */
 #ifndef USE_FAST_STDIO
-/*#define	USE_FAST_STDIO		/**/
+/*#define	USE_FAST_STDIO		/ **/
 #endif
 
 /* USE_LARGE_FILES:
@@ -4573,7 +4625,7 @@
  *	should be used when available.
  */
 #ifndef USE_LARGE_FILES
-/*#define	USE_LARGE_FILES		/**/
+/*#define	USE_LARGE_FILES		/ **/
 #endif
 
 /* USE_LONG_DOUBLE:
@@ -4581,7 +4633,7 @@
  *	be used when available.
  */
 #ifndef USE_LONG_DOUBLE
-/*#define	USE_LONG_DOUBLE		/**/
+/*#define	USE_LONG_DOUBLE		/ **/
 #endif
 
 /* USE_MORE_BITS:
@@ -4589,7 +4641,7 @@
  *	long doubles should be used when available.
  */
 #ifndef USE_MORE_BITS
-/*#define	USE_MORE_BITS		/**/
+/*#define	USE_MORE_BITS		/ **/
 #endif
 
 /* MULTIPLICITY:
@@ -4597,7 +4649,7 @@
  *	be built to use multiplicity.
  */
 #ifndef MULTIPLICITY
-/*#define	MULTIPLICITY		/**/
+/*#define	MULTIPLICITY		/ **/
 #endif
 
 /* USE_PERLIO:
@@ -4606,7 +4658,7 @@
  *	used in a fully backward compatible manner.
  */
 #ifndef USE_PERLIO
-/*#define	USE_PERLIO		/**/
+/*#define	USE_PERLIO		/ **/
 #endif
 
 /* USE_SOCKS:
@@ -4614,7 +4666,7 @@
  *	be built to use socks.
  */
 #ifndef USE_SOCKS
-/*#define	USE_SOCKS		/**/
+/*#define	USE_SOCKS		/ **/
 #endif
 
 #endif
Index: src/gnu/usr.bin/perl/win32/config_h.PL
diff -u src/gnu/usr.bin/perl/win32/config_h.PL:1.5 src/gnu/usr.bin/perl/win32/config_h.PL:1.6
--- win32/config_h.PL:1.5	Mon Sep 29 17:36:22 2008
+++ win32/config_h.PL	Fri Sep 24 15:07:11 2010
@@ -8,7 +8,8 @@
  }
 use File::Compare qw(compare);
 use File::Copy qw(copy);
-my $name = $0;
+use File::Basename qw(fileparse);
+my ($name, $dir) = fileparse($0);
 $name =~ s#^(.*)\.PL$#../$1.SH#;
 my %opt;
 while (@ARGV && $ARGV[0] =~ /^([\w_]+)=(.*)$/)
@@ -62,14 +63,15 @@
   munge();
   s/\\\$/\$/g;
   s#/[ *\*]*\*/#/**/#;
+  s#(.)/\*\*/#$1/ **/# if(/^\/\*/); #avoid "/*" inside comments
   if (/^\s*#define\s+(PRIVLIB|SITELIB|VENDORLIB)_EXP/)
    {
-     $_ = "#define ". $1 . "_EXP (win32_get_". lc($1) . "($patchlevel))\t/**/\n";
+     $_ = "#define ". $1 . "_EXP (win32_get_". lc($1) . "(PERL_VERSION_STRING, NULL))\t/**/\n";
    }
   # incpush() handles archlibs, so disable them
   elsif (/^\s*#define\s+(ARCHLIB|SITEARCH|VENDORARCH)_EXP/)
    {
-     $_ = "/*#define ". $1 . "_EXP \"\"\t/**/\n";
+     $_ = "/*#define ". $1 . "_EXP \"\"\t/ **/\n";
    }
   print H;
  }
Index: src/gnu/usr.bin/perl/win32/config_sh.PL
diff -u src/gnu/usr.bin/perl/win32/config_sh.PL:1.8 src/gnu/usr.bin/perl/win32/config_sh.PL:1.9
--- win32/config_sh.PL:1.8	Mon Oct 12 18:30:28 2009
+++ win32/config_sh.PL	Fri Sep 24 15:07:11 2010
@@ -42,6 +42,8 @@
     shift(@{$optref});
 }
 
+FindExt::scan_ext("../cpan");
+FindExt::scan_ext("../dist");
 FindExt::scan_ext("../ext");
 FindExt::set_static_extensions(split ' ', $opt{'static_ext'});
 
Index: src/gnu/usr.bin/perl/win32/makefile.mk
diff -u src/gnu/usr.bin/perl/win32/makefile.mk:1.12 src/gnu/usr.bin/perl/win32/makefile.mk:1.13
--- win32/makefile.mk:1.12	Mon Oct 12 18:30:28 2009
+++ win32/makefile.mk	Fri Sep 24 15:07:11 2010
@@ -1,1695 +1,1757 @@
-#
-# Makefile to build perl on Windows NT using DMAKE.
-# Supported compilers:
-#	Visual C++ 2.0 or later
-#	Borland C++ 5.02 or later
-#	MinGW with gcc-2.95.2 or later
-#	MS Platform SDK 64-bit compiler and tools **experimental**
-#
-# This is set up to build a perl.exe that runs off a shared library
-# (perl510.dll).  Also makes individual DLLs for the XS extensions.
-#
-
-##
-## Make sure you read README.win32 *before* you mess with anything here!
-##
-
-##
-## Build configuration.  Edit the values below to suit your needs.
-##
-
-#
-# Set these to wherever you want "dmake install" to put your
-# newly built perl.
-#
-INST_DRV	*= c:
-INST_TOP	*= $(INST_DRV)\perl
-
-#
-# Comment this out if you DON'T want your perl installation to be versioned.
-# This means that the new installation will overwrite any files from the
-# old installation at the same INST_TOP location.  Leaving it enabled is
-# the safest route, as perl adds the extra version directory to all the
-# locations it installs files to.  If you disable it, an alternative
-# versioned installation can be obtained by setting INST_TOP above to a
-# path that includes an arbitrary version string.
-#
-#INST_VER	*= \5.10.1
-
-#
-# Comment this out if you DON'T want your perl installation to have
-# architecture specific components.  This means that architecture-
-# specific files will be installed along with the architecture-neutral
-# files.  Leaving it enabled is safer and more flexible, in case you
-# want to build multiple flavors of perl and install them together in
-# the same location.  Commenting it out gives you a simpler
-# installation that is easier to understand for beginners.
-#
-#INST_ARCH	*= \$(ARCHNAME)
-
-#
-# Uncomment this if you want perl to run
-# 	$Config{sitelibexp}\sitecustomize.pl
-# before anything else.  This script can then be set up, for example,
-# to add additional entries to @INC.
-#
-#USE_SITECUST	*= define
-
-#
-# uncomment to enable multiple interpreters.  This is need for fork()
-# emulation and for thread support.
-#
-USE_MULTI	*= define
-
-#
-# Interpreter cloning/threads; now reasonably complete.
-# This should be enabled to get the fork() emulation.  
-# This needs USE_MULTI above.
-#
-USE_ITHREADS	*= define
-
-#
-# uncomment to enable the implicit "host" layer for all system calls
-# made by perl.  This needs USE_MULTI above.  
-# This is also needed to get fork().
-#
-USE_IMP_SYS	*= define
-
-#
-# Comment out next assign to disable perl's I/O subsystem and use compiler's 
-# stdio for IO - depending on your compiler vendor and run time library you may 
-# then get a number of fails from make test i.e. bugs - complain to them not us ;-). 
-# You will also be unable to take full advantage of perl5.8's support for multiple 
-# encodings and may see lower IO performance. You have been warned.
-USE_PERLIO	*= define
-
-#
-# Comment this out if you don't want to enable large file support for
-# some reason.  Should normally only be changed to maintain compatibility
-# with an older release of perl.
-USE_LARGE_FILES	*= define
-
-#
-# uncomment exactly one of the following
-#
-# Visual C++ 2.x
-#CCTYPE		*= MSVC20
-# Visual C++ > 2.x and < 6.x
-#CCTYPE		*= MSVC
-# Visual C++ 6.x (aka Visual C++ 98)
-#CCTYPE		*= MSVC60
-# Visual C++ Toolkit 2003 (aka Visual C++ 7.x) (free command-line tools)
-#CCTYPE		*= MSVC70FREE
-# Visual C++ .NET 2003 (aka Visual C++ 7.x) (full version)
-#CCTYPE		*= MSVC70
-# Visual C++ 2005 Express Edition (aka Visual C++ 8.x) (free version)
-#CCTYPE		*= MSVC80FREE
-# Visual C++ 2005 (aka Visual C++ 8.x) (full version)
-#CCTYPE		*= MSVC80
-# Visual C++ 2008 Express Edition (aka Visual C++ 9.x) (free version)
-#CCTYPE		*= MSVC90FREE
-# Visual C++ 2008 (aka Visual C++ 9.x) (full version)
-#CCTYPE		*= MSVC90
-# Borland 5.02 or later
-#CCTYPE		*= BORLAND
-# MinGW with gcc-2.95.2 or later
-CCTYPE		*= GCC
-
-#
-# uncomment this if your Borland compiler is older than v5.4.
-#BCCOLD		*= define
-#
-# uncomment this if you want to use Borland's VCL as your CRT
-#BCCVCL		*= define
-
-#
-# uncomment this if you are compiling under Windows 95/98 and command.com
-# (not needed if you're running under 4DOS/NT 6.01 or later)
-#IS_WIN95	*= define
-
-#
-# uncomment next line if you want debug version of perl (big,slow)
-# If not enabled, we automatically try to use maximum optimization
-# with all compilers that are known to have a working optimizer.
-#
-#CFG		*= Debug
-
-#
-# uncomment to enable use of PerlCRT.DLL when using the Visual C compiler.
-# It has patches that fix known bugs in older versions of MSVCRT.DLL.
-# This currently requires VC 5.0 with Service Pack 3 or later.
-# Get it from CPAN at http://www.cpan.org/authors/id/D/DO/DOUGL/
-# and follow the directions in the package to install.
-#
-# Not recommended if you have VC 6.x and you're not running Windows 9x.
-#
-#USE_PERLCRT	*= define
-
-#
-# uncomment to enable linking with setargv.obj under the Visual C
-# compiler. Setting this options enables perl to expand wildcards in
-# arguments, but it may be harder to use alternate methods like
-# File::DosGlob that are more powerful.  This option is supported only with
-# Visual C.
-#
-#USE_SETARGV	*= define
-
-#
-# if you want to have the crypt() builtin function implemented, leave this or
-# CRYPT_LIB uncommented.  The fcrypt.c file named here contains a suitable
-# version of des_fcrypt().
-#
-CRYPT_SRC	*= fcrypt.c
-
-#
-# if you didn't set CRYPT_SRC and if you have des_fcrypt() available in a
-# library, uncomment this, and make sure the library exists (see README.win32)
-# Specify the full pathname of the library.
-#
-#CRYPT_LIB	*= fcrypt.lib
-
-#
-# set this if you wish to use perl's malloc
-# WARNING: Turning this on/off WILL break binary compatibility with extensions
-# you may have compiled with/without it.  Be prepared to recompile all
-# extensions if you change the default.  Currently, this cannot be enabled
-# if you ask for USE_IMP_SYS above.
-#
-#PERL_MALLOC	*= define
-
-#
-# set this to enable debugging mstats
-# This must be enabled to use the Devel::Peek::mstat() function.  This cannot
-# be enabled without PERL_MALLOC as well.
-#
-#DEBUG_MSTATS	*= define
-
-#
-# set this to additionally provide a statically linked perl-static.exe.
-# Note that dynamic loading will not work with this perl, so you must
-# include required modules statically using the STATIC_EXT or ALL_STATIC
-# variables below. A static library perl510s.lib will also be created.
-# Ordinary perl.exe is not affected by this option.
-#
-#BUILD_STATIC	*= define
-
-#
-# in addition to BUILD_STATIC the option ALL_STATIC makes *every*
-# extension get statically built
-# This will result in a very large perl executable, but the main purpose
-# is to have proper linking set so as to be able to create miscellaneous
-# executables with different built-in extensions
-#
-#ALL_STATIC	*= define
-
-#
-# set the install locations of the compiler include/libraries
-# Running VCVARS32.BAT is *required* when using Visual C.
-# Some versions of Visual C don't define MSVCDIR in the environment,
-# so you may have to set CCHOME explicitly (spaces in the path name should
-# not be quoted)
-#
-.IF "$(CCTYPE)" == "BORLAND"
-CCHOME		*= C:\Borland\BCC55
-.ELIF "$(CCTYPE)" == "GCC"
-CCHOME		*= C:\MinGW
-.ELSE
-CCHOME		*= $(MSVCDIR)
-.ENDIF
-CCINCDIR	*= $(CCHOME)\include
-CCLIBDIR	*= $(CCHOME)\lib
-
-#
-# Additional compiler flags can be specified here.
-#
-BUILDOPT	*= $(BUILDOPTEXTRA)
-
-#
-# Adding -DPERL_HASH_SEED_EXPLICIT will disable randomization of Perl's
-# internal hash function unless the PERL_HASH_SEED environment variable is set.
-# Alternatively, adding -DNO_HASH_SEED will completely disable the
-# randomization feature. 
-# The latter is required to maintain binary compatibility with Perl 5.8.0.
-#
-#BUILDOPT	+= -DPERL_HASH_SEED_EXPLICIT
-#BUILDOPT	+= -DNO_HASH_SEED
-
-#
-# This should normally be disabled.  Adding -DPERL_POLLUTE enables support
-# for old symbols by default, at the expense of extreme pollution.  You most
-# probably just want to build modules that won't compile with
-#         perl Makefile.PL POLLUTE=1
-# instead of enabling this.  Please report such modules to the respective
-# authors.
-#
-#BUILDOPT	+= -DPERL_POLLUTE
-
-#
-# This should normally be disabled.  Enabling it will disable the File::Glob
-# implementation of CORE::glob.
-#
-#BUILDOPT	+= -DPERL_EXTERNAL_GLOB
-
-#
-# This should normally be disabled.  Enabling it causes perl to read scripts
-# in text mode (which is the 5.005 behavior) and will break ByteLoader.
-#
-#BUILDOPT	+= -DPERL_TEXTMODE_SCRIPTS
-
-#
-# specify semicolon-separated list of extra directories that modules will
-# look for libraries (spaces in path names need not be quoted)
-#
-EXTRALIBDIRS	*=
-
-#
-# set this to point to cmd.exe (only needed if you use some
-# alternate shell that doesn't grok cmd.exe style commands)
-#
-#SHELL		*= g:\winnt\system32\cmd.exe
-
-#
-# set this to your email address (perl will guess a value from
-# from your loginname and your hostname, which may not be right)
-#
-#EMAIL		*=
-
-##
-## Build configuration ends.
-##
-
-##################### CHANGE THESE ONLY IF YOU MUST #####################
-
-.IF "$(CRYPT_SRC)$(CRYPT_LIB)" == ""
-D_CRYPT		= undef
-.ELSE
-D_CRYPT		= define
-CRYPT_FLAG	= -DHAVE_DES_FCRYPT
-.ENDIF
-
-PERL_MALLOC	*= undef
-DEBUG_MSTATS	*= undef
-
-USE_SITECUST	*= undef
-USE_MULTI	*= undef
-USE_ITHREADS	*= undef
-USE_IMP_SYS	*= undef
-USE_PERLIO	*= undef
-USE_LARGE_FILES	*= undef
-USE_PERLCRT	*= undef
-
-.IF "$(USE_IMP_SYS)" == "define"
-PERL_MALLOC	= undef
-.ENDIF
-
-.IF "$(PERL_MALLOC)" == "undef"
-DEBUG_MSTATS	= undef
-.ENDIF
-
-.IF "$(DEBUG_MSTATS)" == "define"
-BUILDOPT	+= -DPERL_DEBUGGING_MSTATS
-.ENDIF
-
-.IF "$(USE_IMP_SYS) $(USE_MULTI)" == "define undef"
-USE_MULTI	!= define
-.ENDIF
-
-.IF "$(USE_ITHREADS) $(USE_MULTI)" == "define undef"
-USE_MULTI	!= define
-.ENDIF
-
-.IF "$(USE_SITECUST)" == "define"
-BUILDOPT	+= -DUSE_SITECUSTOMIZE
-.ENDIF
-
-.IF "$(USE_MULTI)" != "undef"
-BUILDOPT	+= -DPERL_IMPLICIT_CONTEXT
-.ENDIF
-
-.IF "$(USE_IMP_SYS)" != "undef"
-BUILDOPT	+= -DPERL_IMPLICIT_SYS
-.ENDIF
-
-.IMPORT .IGNORE : PROCESSOR_ARCHITECTURE PROCESSOR_ARCHITEW6432 WIN64
-
-PROCESSOR_ARCHITECTURE *= x86
-
-.IF "$(WIN64)" == ""
-# When we are running from a 32bit cmd.exe on AMD64 then
-# PROCESSOR_ARCHITECTURE is set to x86 and PROCESSOR_ARCHITEW6432
-# is set to AMD64
-.IF "$(PROCESSOR_ARCHITEW6432)" != ""
-PROCESSOR_ARCHITECTURE	!= $(PROCESSOR_ARCHITEW6432)
-WIN64			= define
-.ELIF "$(PROCESSOR_ARCHITECTURE)" == "AMD64" || "$(PROCESSOR_ARCHITECTURE)" == "IA64"
-WIN64			= define
-.ELSE
-WIN64			= undef
-.ENDIF
-.ENDIF
-
-ARCHITECTURE = $(PROCESSOR_ARCHITECTURE)
-.IF "$(ARCHITECTURE)" == "AMD64"
-ARCHITECTURE	= x64
-.ENDIF
-.IF "$(ARCHITECTURE)" == "IA64"
-ARCHITECTURE	= ia64
-.ENDIF
-
-.IF "$(USE_MULTI)" == "define"
-ARCHNAME	= MSWin32-$(ARCHITECTURE)-multi
-.ELSE
-.IF "$(USE_PERLIO)" == "define"
-ARCHNAME	= MSWin32-$(ARCHITECTURE)-perlio
-.ELSE
-ARCHNAME	= MSWin32-$(ARCHITECTURE)
-.ENDIF
-.ENDIF
-
-.IF "$(USE_ITHREADS)" == "define"
-ARCHNAME	!:= $(ARCHNAME)-thread
-.ENDIF
-
-# Visual C++ 98, .NET 2003, 2005 and 2008 specific.
-# VC++ 6.x, 7.x, 8.x and 9.x can load DLL's on demand.  Makes the test suite run
-# in about 10% less time.  (The free version of 7.x can't do this, but the free
-# versions of 8.x and 9.x can.)
-.IF "$(CCTYPE)" == "MSVC60" || "$(CCTYPE)" == "MSVC70"     || \
-    "$(CCTYPE)" == "MSVC80" || "$(CCTYPE)" == "MSVC80FREE" ||
-    "$(CCTYPE)" == "MSVC90" || "$(CCTYPE)" == "MSVC90FREE"
-DELAYLOAD	*= -DELAYLOAD:ws2_32.dll delayimp.lib
-.ENDIF
-
-# Visual C++ 2005 and 2008 (VC++ 8.x and 9.x) create manifest files for EXEs and
-# DLLs. These either need copying everywhere with the binaries, or else need
-# embedding in them otherwise MSVCR80.dll or MSVCR90.dll won't be found. For
-# simplicity, embed them if they exist (and delete them afterwards so that they
-# don't get installed too).
-EMBED_EXE_MANI	= if exist $@.manifest mt -nologo -manifest $@.manifest -outputresource:$@;1 && \
-		  if exist $@.manifest del $@.manifest
-EMBED_DLL_MANI	= if exist $@.manifest mt -nologo -manifest $@.manifest -outputresource:$@;2 && \
-		  if exist $@.manifest del $@.manifest
-
-ARCHDIR		= ..\lib\$(ARCHNAME)
-COREDIR		= ..\lib\CORE
-AUTODIR		= ..\lib\auto
-LIBDIR		= ..\lib
-EXTDIR		= ..\ext
-PODDIR		= ..\pod
-EXTUTILSDIR	= $(LIBDIR)\ExtUtils
-HTMLDIR		= .\html
-
-#
-INST_SCRIPT	= $(INST_TOP)$(INST_VER)\bin
-INST_BIN	= $(INST_SCRIPT)$(INST_ARCH)
-INST_LIB	= $(INST_TOP)$(INST_VER)\lib
-INST_ARCHLIB	= $(INST_LIB)$(INST_ARCH)
-INST_COREDIR	= $(INST_ARCHLIB)\CORE
-INST_HTML	= $(INST_TOP)$(INST_VER)\html
-
-#
-# Programs to compile, build .lib files and link
-#
-
-.USESHELL :
-
-.IF "$(CCTYPE)" == "BORLAND"
-
-CC		= bcc32
-.IF "$(BCCOLD)" != "define"
-LINK32		= ilink32
-.ELSE
-LINK32		= tlink32
-.ENDIF
-LIB32		= tlib /a /P128
-IMPLIB		= implib -c
-RSC		= brcc32
-
-#
-# Options
-#
-INCLUDES	= -I$(COREDIR) -I.\include -I. -I.. -I"$(CCINCDIR)"
-#PCHFLAGS	= -H -Hc -H=c:\temp\bcmoduls.pch
-DEFINES		= -DWIN32 $(CRYPT_FLAG)
-LOCDEFS		= -DPERLDLL -DPERL_CORE
-SUBSYS		= console
-CXX_FLAG	= -P
-
-LIBC		= cw32mti.lib
-
-# same libs as MSVC, except Borland doesn't have oldnames.lib
-LIBFILES	= $(CRYPT_LIB) \
-		kernel32.lib user32.lib gdi32.lib winspool.lib \
-		comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib \
-		netapi32.lib uuid.lib ws2_32.lib mpr.lib winmm.lib \
-		version.lib odbc32.lib odbccp32.lib \
-		import32.lib $(LIBC)
-
-.IF  "$(CFG)" == "Debug"
-OPTIMIZE	= -v -D_RTLDLL -DDEBUGGING
-LINK_DBG	= -v
-.ELSE
-OPTIMIZE	= -O2 -D_RTLDLL
-LINK_DBG	=
-.ENDIF
-
-EXTRACFLAGS	=
-CFLAGS		= -w -g0 -tWM -tWD $(INCLUDES) $(DEFINES) $(LOCDEFS) \
-		$(PCHFLAGS) $(OPTIMIZE)
-LINK_FLAGS	= $(LINK_DBG) -x -L"$(INST_COREDIR)" -L"$(CCLIBDIR)" \
-		-L"$(CCLIBDIR)\PSDK"
-OBJOUT_FLAG	= -o
-EXEOUT_FLAG	= -e
-LIBOUT_FLAG	=
-.IF "$(BCCOLD)" != "define"
-LINK_FLAGS	+= -Gn
-DEFINES  += -D_MT -D__USELOCALES__ -D_WIN32_WINNT=0x0410
-.END
-.IF "$(BCCVCL)" == "define"
-LIBC		= cp32mti.lib vcl.lib vcl50.lib vclx50.lib vcle50.lib
-LINK_FLAGS	+= -L"$(CCLIBDIR)\Release"
-.END
-
-
-.ELIF "$(CCTYPE)" == "GCC"
-
-CC		= gcc
-LINK32		= g++
-LIB32		= ar rc
-IMPLIB		= dlltool
-RSC		= windres
-
-i = .i
-o = .o
-a = .a
-
-#
-# Options
-#
-
-INCLUDES	= -I.\include -I. -I.. -I$(COREDIR)
-DEFINES		= -DWIN32 $(CRYPT_FLAG)
-LOCDEFS		= -DPERLDLL -DPERL_CORE
-SUBSYS		= console
-CXX_FLAG	= -xc++
-
-# Current releases of MinGW 5.1.4 (as of 11-Aug-2009) will fail to link
-# correctly if -lmsvcrt is specified explicitly.
-LIBC		=
-#LIBC		= -lmsvcrt
-
-# same libs as MSVC
-LIBFILES	= $(CRYPT_LIB) $(LIBC) \
-		  -lmoldname -lkernel32 -luser32 -lgdi32 \
-		  -lwinspool -lcomdlg32 -ladvapi32 -lshell32 -lole32 \
-		  -loleaut32 -lnetapi32 -luuid -lws2_32 -lmpr \
-		  -lwinmm -lversion -lodbc32 -lodbccp32
-
-.IF  "$(CFG)" == "Debug"
-OPTIMIZE	= -g -O2 -DDEBUGGING
-LINK_DBG	= -g
-.ELSE
-OPTIMIZE	= -s -O2
-LINK_DBG	= -s
-.ENDIF
-
-EXTRACFLAGS	=
-CFLAGS		= $(INCLUDES) $(DEFINES) $(LOCDEFS) $(OPTIMIZE)
-LINK_FLAGS	= $(LINK_DBG) -L"$(INST_COREDIR)" -L"$(CCLIBDIR)"
-OBJOUT_FLAG	= -o
-EXEOUT_FLAG	= -o
-LIBOUT_FLAG	=
-
-# NOTE: we assume that GCC uses MSVCRT.DLL
-# See comments about PERL_MSVCRT_READFIX in the "cl" compiler section below.
-BUILDOPT	+= -fno-strict-aliasing -DPERL_MSVCRT_READFIX
-
-.ELSE
-
-CC		= cl
-LINK32		= link
-LIB32		= $(LINK32) -lib
-RSC		= rc
-
-#
-# Options
-#
-
-INCLUDES	= -I$(COREDIR) -I.\include -I. -I..
-#PCHFLAGS	= -Fpc:\temp\vcmoduls.pch -YX
-DEFINES		= -DWIN32 -D_CONSOLE -DNO_STRICT $(CRYPT_FLAG)
-LOCDEFS		= -DPERLDLL -DPERL_CORE
-SUBSYS		= console
-CXX_FLAG	= -TP -EHsc
-
-.IF "$(USE_PERLCRT)" != "define"
-LIBC	= msvcrt.lib
-.ELSE
-LIBC	= PerlCRT.lib
-.ENDIF
-
-.IF  "$(CFG)" == "Debug"
-.IF "$(CCTYPE)" == "MSVC20"
-OPTIMIZE	= -Od -MD -Z7 -DDEBUGGING
-.ELSE
-OPTIMIZE	= -O1 -MD -Zi -DDEBUGGING
-.ENDIF
-LINK_DBG	= -debug
-.ELSE
-OPTIMIZE	= -MD -Zi -DNDEBUG
-# we enable debug symbols in release builds also
-LINK_DBG	= -debug -opt:ref,icf
-# you may want to enable this if you want COFF symbols in the executables
-# in addition to the PDB symbols.  The default Dr. Watson that ships with
-# Windows can use the the former but not latter.  The free WinDbg can be
-# installed to get better stack traces from just the PDB symbols, so we
-# avoid the bloat of COFF symbols by default.
-#LINK_DBG	= $(LINK_DBG) -debugtype:both
-.IF "$(WIN64)" == "define"
-# enable Whole Program Optimizations (WPO) and Link Time Code Generation (LTCG)
-OPTIMIZE	+= -Ox -GL
-LINK_DBG	+= -ltcg
-.ELSE
-# -O1 yields smaller code, which turns out to be faster than -O2 on x86
-OPTIMIZE	+= -O1
-#OPTIMIZE	+= -O2
-.ENDIF
-.ENDIF
-
-.IF "$(WIN64)" == "define"
-DEFINES		+= -DWIN64 -DCONSERVATIVE
-OPTIMIZE	+= -Wp64 -fp:precise
-.ENDIF
-
-# For now, silence VC++ 8.x's and 9.x's warnings about "unsafe" CRT functions
-# and POSIX CRT function names being deprecated.
-.IF "$(CCTYPE)" == "MSVC80" || "$(CCTYPE)" == "MSVC80FREE" || \
-    "$(CCTYPE)" == "MSVC90" || "$(CCTYPE)" == "MSVC90FREE"
-DEFINES		+= -D_CRT_SECURE_NO_DEPRECATE -D_CRT_NONSTDC_NO_DEPRECATE
-.ENDIF
-
-# Use the MSVCRT read() fix if the PerlCRT was not chosen, but only when using
-# VC++ 6.x or earlier. Later versions use MSVCR70.dll, MSVCR71.dll, etc, which
-# do not require the fix.
-.IF "$(CCTYPE)" == "MSVC20" || "$(CCTYPE)" == "MSVC" || "$(CCTYPE)" == "MSVC60" 
-.IF "$(USE_PERLCRT)" != "define"
-BUILDOPT	+= -DPERL_MSVCRT_READFIX
-.ENDIF
-.ENDIF
-
-LIBBASEFILES	= $(CRYPT_LIB) \
-		oldnames.lib kernel32.lib user32.lib gdi32.lib winspool.lib \
-		comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib \
-		netapi32.lib uuid.lib ws2_32.lib mpr.lib winmm.lib \
-		version.lib odbc32.lib odbccp32.lib
-
-# The 64 bit Platform SDK compilers contain a runtime library that doesn't
-# include the buffer overrun verification code used by the /GS switch.
-# Since the code links against libraries that are compiled with /GS, this
-# "security cookie verification" must be included via bufferoverlow.lib.
-.IF "$(WIN64)" == "define"
-LIBBASEFILES    = $(LIBBASEFILES) bufferoverflowU.lib
-.ENDIF
-
-# we add LIBC here, since we may be using PerlCRT.dll
-LIBFILES	= $(LIBBASEFILES) $(LIBC)
-
-EXTRACFLAGS	= -nologo -GF -W3
-CFLAGS		= $(EXTRACFLAGS) $(INCLUDES) $(DEFINES) $(LOCDEFS) \
-		$(PCHFLAGS) $(OPTIMIZE)
-LINK_FLAGS	= -nologo -nodefaultlib $(LINK_DBG) \
-		-libpath:"$(INST_COREDIR)" \
-		-machine:$(PROCESSOR_ARCHITECTURE)
-LIB_FLAGS	= -nologo
-OBJOUT_FLAG	= -Fo
-EXEOUT_FLAG	= -Fe
-LIBOUT_FLAG	= /out:
-
-.ENDIF
-
-CFLAGS_O	= $(CFLAGS) $(BUILDOPT)
-
-# used to allow local linking flags that are not propogated into Config.pm,
-# currently unused
-#   -- BKS, 12-12-1999
-PRIV_LINK_FLAGS	*=
-BLINK_FLAGS	= $(PRIV_LINK_FLAGS) $(LINK_FLAGS)
-
-#################### do not edit below this line #######################
-############# NO USER-SERVICEABLE PARTS BEYOND THIS POINT ##############
-
-# Some old dmakes (including Sarathy's one at
-# http://search.cpan.org/CPAN/authors/id/G/GS/GSAR/dmake-4.1pl1-win32.zip)
-# don't support logical OR (||) or logical AND (&&) in conditional
-# expressions and hence don't process this makefile correctly. Determine
-# whether this is the case so that we can give the user an error message.
-.IF 1 == 1 || 1 == 1
-NEWDMAKE = define
-.ELSE
-NEWDMAKE = undef
-.ENDIF
-
-o *= .obj
-a *= .lib
-
-LKPRE		= INPUT (
-LKPOST		= )
-
-#
-# Rules
-#
-
-.SUFFIXES : .c .i $(o) .dll $(a) .exe .rc .res
-
-.c$(o):
-	$(CC) -c $(null,$(<:d) $(NULL) -I$(<:d)) $(CFLAGS_O) $(OBJOUT_FLAG)$@ $<
-
-.c.i:
-	$(CC) -c $(null,$(<:d) $(NULL) -I$(<:d)) $(CFLAGS_O) -E $< >$@
-
-.y.c:
-	$(NOOP)
-
-$(o).dll:
-.IF "$(CCTYPE)" == "BORLAND"
-	$(LINK32) -Tpd -ap $(BLINK_FLAGS) c0d32$(o) $<,$@,,$(LIBFILES),$(*B).def
-	$(IMPLIB) $(*B).lib $@
-.ELIF "$(CCTYPE)" == "GCC"
-	$(LINK32) -o $@ $(BLINK_FLAGS) $< $(LIBFILES)
-	$(IMPLIB) --input-def $(*B).def --output-lib $(*B).a $@
-.ELSE
-	$(LINK32) -dll -subsystem:windows -implib:$(*B).lib -def:$(*B).def \
-	    -out:$@ $(BLINK_FLAGS) $(LIBFILES) $< $(LIBPERL)
-	$(EMBED_DLL_MANI)
-.ENDIF
-
-.rc.res:
-.IF "$(CCTYPE)" == "GCC"
-	$(RSC) --use-temp-file --include-dir=. --include-dir=.. -O COFF -i $< -o $@
-.ELSE
-	$(RSC) -i.. $<
-.ENDIF
-
-#
-# various targets
-MINIPERL	= ..\miniperl.exe
-MINIDIR		= .\mini
-PERLEXE		= ..\perl.exe
-WPERLEXE	= ..\wperl.exe
-PERLEXESTATIC	= ..\perl-static.exe
-GLOBEXE		= ..\perlglob.exe
-CONFIGPM	= ..\lib\Config.pm ..\lib\Config_heavy.pl
-MINIMOD		= ..\lib\ExtUtils\Miniperl.pm
-X2P		= ..\x2p\a2p.exe
-GENUUDMAP	= ..\generate_uudmap.exe
-.IF "$(BUILD_STATIC)" == "define"
-PERLSTATIC	= static
-.ELSE
-PERLSTATIC	= 
-.ENDIF
-
-# Unicode data files generated by mktables
-UNIDATAFILES	 = ..\lib\unicore\Canonical.pl ..\lib\unicore\Exact.pl \
-		   ..\lib\unicore\Properties ..\lib\unicore\Decomposition.pl \
-		   ..\lib\unicore\CombiningClass.pl ..\lib\unicore\Name.pl \
-		   ..\lib\unicore\PVA.pl
-
-# Directories of Unicode data files generated by mktables
-UNIDATADIR1	= ..\lib\unicore\To
-UNIDATADIR2	= ..\lib\unicore\lib
-
-PERLEXE_ICO	= .\perlexe.ico
-PERLEXE_RES	= .\perlexe.res
-PERLDLL_RES	=
-
-# Nominate a target which causes extensions to be re-built
-# This used to be $(PERLEXE), but at worst it is the .dll that they depend
-# on and really only the interface - i.e. the .def file used to export symbols
-# from the .dll
-PERLDEP = perldll.def
-
-
-PL2BAT		= bin\pl2bat.pl
-GLOBBAT		= bin\perlglob.bat
-
-UTILS		=			\
-		..\utils\h2ph		\
-		..\utils\splain		\
-		..\utils\dprofpp	\
-		..\utils\perlbug	\
-		..\utils\pl2pm 		\
-		..\utils\c2ph		\
-		..\utils\pstruct	\
-		..\utils\h2xs		\
-		..\utils\perldoc	\
-		..\utils\perlivp	\
-		..\utils\libnetcfg	\
-		..\utils\enc2xs		\
-		..\utils\piconv		\
-		..\utils\config_data	\
-		..\utils\corelist	\
-		..\utils\cpan		\
-		..\utils\xsubpp		\
-		..\utils\prove		\
-		..\utils\ptar		\
-		..\utils\ptardiff	\
-		..\utils\cpanp-run-perl	\
-		..\utils\cpanp	\
-		..\utils\cpan2dist	\
-		..\utils\shasum		\
-		..\utils\instmodsh	\
-		..\pod\pod2html		\
-		..\pod\pod2latex	\
-		..\pod\pod2man		\
-		..\pod\pod2text		\
-		..\pod\pod2usage	\
-		..\pod\podchecker	\
-		..\pod\podselect	\
-		..\x2p\find2perl	\
-		..\x2p\psed		\
-		..\x2p\s2p		\
-		bin\exetype.pl		\
-		bin\runperl.pl		\
-		bin\pl2bat.pl		\
-		bin\perlglob.pl		\
-		bin\search.pl
-
-.IF "$(CCTYPE)" == "BORLAND"
-
-CFGSH_TMPL	= config.bc
-CFGH_TMPL	= config_H.bc
-
-.ELIF "$(CCTYPE)" == "GCC"
-
-CFGSH_TMPL	= config.gc
-CFGH_TMPL	= config_H.gc
-PERLIMPLIB	= ..\libperl510$(a)
-PERLSTATICLIB	= ..\libperl510s$(a)
-
-.ELSE
-
-.IF "$(WIN64)" == "define"
-CFGSH_TMPL	= config.vc64
-CFGH_TMPL	= config_H.vc64
-.ELSE
-CFGSH_TMPL	= config.vc
-CFGH_TMPL	= config_H.vc
-.ENDIF
-
-.ENDIF
-
-# makedef.pl must be updated if this changes, and this should normally
-# only change when there is an incompatible revision of the public API.
-PERLIMPLIB	*= ..\perl510$(a)
-PERLSTATICLIB	*= ..\perl510s$(a)
-PERLDLL		= ..\perl510.dll
-
-XCOPY		= xcopy /f /r /i /d /y
-RCOPY		= xcopy /f /r /i /e /d /y
-NOOP		= @rem
-
-#
-# filenames given to xsubpp must have forward slashes (since it puts
-# full pathnames in #line strings)
-XSUBPP		= ..\$(MINIPERL) -I..\..\lib ..\$(EXTUTILSDIR)\xsubpp \
-		-C++ -prototypes
-
-MICROCORE_SRC	=		\
-		..\av.c		\
-		..\deb.c	\
-		..\doio.c	\
-		..\doop.c	\
-		..\dump.c	\
-		..\globals.c	\
-		..\gv.c		\
-		..\mro.c	\
-		..\hv.c		\
-		..\locale.c	\
-		..\mathoms.c    \
-		..\mg.c		\
-		..\numeric.c	\
-		..\op.c		\
-		..\pad.c	\
-		..\perl.c	\
-		..\perlapi.c	\
-		..\perly.c	\
-		..\pp.c		\
-		..\pp_ctl.c	\
-		..\pp_hot.c	\
-		..\pp_pack.c	\
-		..\pp_sort.c	\
-		..\pp_sys.c	\
-		..\reentr.c	\
-		..\regcomp.c	\
-		..\regexec.c	\
-		..\run.c	\
-		..\scope.c	\
-		..\sv.c		\
-		..\taint.c	\
-		..\toke.c	\
-		..\universal.c	\
-		..\utf8.c	\
-		..\util.c	\
-		..\xsutils.c
-
-EXTRACORE_SRC	+= perllib.c
-
-.IF "$(PERL_MALLOC)" == "define"
-EXTRACORE_SRC	+= ..\malloc.c
-.ENDIF
-
-EXTRACORE_SRC	+= ..\perlio.c
-
-WIN32_SRC	=		\
-		.\win32.c	\
-		.\win32sck.c	\
-		.\win32thread.c
-
-# We need this for miniperl build unless we override canned 
-# config.h #define building mini\*
-#.IF "$(USE_PERLIO)" == "define"
-WIN32_SRC	+= .\win32io.c
-#.ENDIF
-
-.IF "$(CRYPT_SRC)" != ""
-WIN32_SRC	+= .\$(CRYPT_SRC)
-.ENDIF
-
-DLL_SRC		= $(DYNALOADER).c
-
-X2P_SRC		=		\
-		..\x2p\a2p.c	\
-		..\x2p\hash.c	\
-		..\x2p\str.c	\
-		..\x2p\util.c	\
-		..\x2p\walk.c
-
-CORE_NOCFG_H	=		\
-		..\av.h		\
-		..\cop.h	\
-		..\cv.h		\
-		..\dosish.h	\
-		..\embed.h	\
-		..\form.h	\
-		..\gv.h		\
-		..\handy.h	\
-		..\hv.h		\
-		..\iperlsys.h	\
-		..\mg.h		\
-		..\nostdio.h	\
-		..\op.h		\
-		..\opcode.h	\
-		..\perl.h	\
-		..\perlapi.h	\
-		..\perlsdio.h	\
-		..\perlsfio.h	\
-		..\perly.h	\
-		..\pp.h		\
-		..\proto.h	\
-		..\regcomp.h	\
-		..\regexp.h	\
-		..\scope.h	\
-		..\sv.h		\
-		..\thread.h	\
-		..\unixish.h	\
-		..\utf8.h	\
-		..\util.h	\
-		..\warnings.h	\
-		..\XSUB.h	\
-		..\EXTERN.h	\
-		..\perlvars.h	\
-		..\intrpvar.h	\
-		.\include\dirent.h	\
-		.\include\netdb.h	\
-		.\include\sys\socket.h	\
-		.\win32.h
-
-CORE_H		= $(CORE_NOCFG_H) .\config.h ..\git_version.h
-
-UUDMAP_H	= ..\uudmap.h
-
-MICROCORE_OBJ	= $(MICROCORE_SRC:db:+$(o))
-CORE_OBJ	= $(MICROCORE_OBJ) $(EXTRACORE_SRC:db:+$(o))
-WIN32_OBJ	= $(WIN32_SRC:db:+$(o))
-MINICORE_OBJ	= $(MINIDIR)\{$(MICROCORE_OBJ:f) miniperlmain$(o) perlio$(o)}
-MINIWIN32_OBJ	= $(MINIDIR)\{$(WIN32_OBJ:f)}
-MINI_OBJ	= $(MINICORE_OBJ) $(MINIWIN32_OBJ)
-DLL_OBJ		= $(DLL_SRC:db:+$(o))
-X2P_OBJ		= $(X2P_SRC:db:+$(o))
-GENUUDMAP_OBJ	= $(GENUUDMAP:db:+$(o))
-
-PERLDLL_OBJ	= $(CORE_OBJ)
-PERLEXE_OBJ	= perlmain$(o)
-PERLEXEST_OBJ	= perlmainst$(o)
-
-PERLDLL_OBJ	+= $(WIN32_OBJ) $(DLL_OBJ)
-
-.IF "$(USE_SETARGV)" != ""
-SETARGV_OBJ	= setargv$(o)
-.ENDIF
-
-.IF "$(ALL_STATIC)" == "define"
-# some exclusions, unfortunately, until fixed:
-#  - Win32 extension contains overlapped symbols with win32.c (BUG!)
-#  - MakeMaker isn't capable enough for SDBM_File (smaller bug)
-#  - Encode (encoding search algorithm relies on shared library?)
-STATIC_EXT	= * !Win32 !SDBM_File !Encode
-.ELSE
-# specify static extensions here, for example:
-#STATIC_EXT	= Cwd Compress/Raw/Zlib
-STATIC_EXT	= Win32CORE
-.ENDIF
-
-DYNALOADER	= $(EXTDIR)\DynaLoader\DynaLoader
-
-# vars must be separated by "\t+~\t+", since we're using the tempfile
-# version of config_sh.pl (we were overflowing someone's buffer by
-# trying to fit them all on the command line)
-#	-- BKS 10-17-1999
-CFG_VARS	=					\
-		INST_DRV=$(INST_DRV)		~	\
-		INST_TOP=$(INST_TOP)	~	\
-		INST_VER=$(INST_VER)	~	\
-		INST_ARCH=$(INST_ARCH)		~	\
-		archname=$(ARCHNAME)		~	\
-		cc=$(CC)			~	\
-		ld=$(LINK32)			~	\
-		ccflags=$(EXTRACFLAGS) $(OPTIMIZE) $(DEFINES) $(BUILDOPT)	~	\
-		cf_email=$(EMAIL)		~	\
-		d_crypt=$(D_CRYPT)		~	\
-		d_mymalloc=$(PERL_MALLOC)	~	\
-		libs=$(LIBFILES:f)		~	\
-		incpath=$(CCINCDIR)	~	\
-		libperl=$(PERLIMPLIB:f)		~	\
-		libpth=$(CCLIBDIR);$(EXTRALIBDIRS)	~	\
-		libc=$(LIBC)			~	\
-		make=dmake			~	\
-		_o=$(o)				~	\
-		obj_ext=$(o)			~	\
-		_a=$(a)				~	\
-		lib_ext=$(a)			~	\
-		static_ext=$(STATIC_EXT)	~	\
-		usethreads=$(USE_ITHREADS)	~	\
-		useithreads=$(USE_ITHREADS)	~	\
-		usemultiplicity=$(USE_MULTI)	~	\
-		useperlio=$(USE_PERLIO)		~	\
-		uselargefiles=$(USE_LARGE_FILES)	~	\
-		usesitecustomize=$(USE_SITECUST)	~	\
-		LINK_FLAGS=$(LINK_FLAGS)	~	\
-		optimize=$(OPTIMIZE)
-
-#
-# set up targets varying between Win95 and WinNT builds
-#
-
-.IF "$(IS_WIN95)" == "define"
-MK2 		= .\makefile.95
-RIGHTMAKE	= __switch_makefiles
-.ELSE
-MK2		= __not_needed
-RIGHTMAKE	=
-.ENDIF
-
-.IMPORT .IGNORE : SystemRoot windir
-
-# Don't just .IMPORT OS from the environment because dmake sets OS itself.
-ENV_OS=$(subst,OS=, $(shell @set OS))
-
-.IF "$(ENV_OS)" == "Windows_NT"
-ODBCCP32_DLL = $(SystemRoot)\system32\odbccp32.dll
-.ELSE
-ODBCCP32_DLL = $(windir)\system\odbccp32.dll
-.ENDIF
-
-#
-# Top targets
-#
-
-all : CHECKDMAKE .\config.h ..\git_version.h $(GLOBEXE) $(MINIPERL) $(MK2)	\
-	$(RIGHTMAKE) $(MINIMOD) $(CONFIGPM) $(UNIDATAFILES) MakePPPort		\
-	$(PERLEXE) $(X2P) Extensions $(PERLSTATIC)
-
-..\regcharclass.h : ..\Porting\regcharclass.pl
-	cd .. && miniperl Porting\regcharclass.pl && cd win32
-
-regnodes : ..\regnodes.h
-
-..\regcomp$(o) : ..\regnodes.h ..\regcharclass.h	
-
-..\regexec$(o) : ..\regnodes.h ..\regcharclass.h
-
-reonly : regnodes .\config.h ..\git_version.h $(GLOBEXE) $(MINIPERL) $(MK2)	\
-	$(RIGHTMAKE) $(MINIMOD) $(CONFIGPM) $(UNIDATAFILES) $(PERLEXE)		\
-	$(X2P) Extensions_reonly
-
-$(DYNALOADER)$(o) : $(DYNALOADER).c $(CORE_H) $(EXTDIR)\DynaLoader\dlutils.c
-
-static: $(PERLEXESTATIC)
-
-#----------------------------------------------------------------
-
-#-------------------- BEGIN Win95 SPECIFIC ----------------------
-
-# this target is a jump-off point for Win95
-#  1. it switches to the Win95-specific makefile if it exists
-#     (__do_switch_makefiles)
-#  2. it prints a message when the Win95-specific one finishes (__done)
-#  3. it then kills this makefile by trying to make __no_such_target
-
-__switch_makefiles: __do_switch_makefiles __done __no_such_target
-
-__do_switch_makefiles:
-.IF "$(NOTFIRST)" != "true"
-	if exist $(MK2) $(MAKE:s/-S//) -f $(MK2) $(MAKETARGETS) NOTFIRST=true
-.ELSE
-	$(NOOP)
-.ENDIF
-
-.IF "$(NOTFIRST)" != "true"
-__done:
-	@echo Build process complete. Ignore any errors after this message.
-	@echo Run "dmake test" to test and "dmake install" to install
-
-.ELSE
-# dummy targets for Win95-specific makefile
-
-__done:
-	$(NOOP)
-
-__no_such_target:
-	$(NOOP)
-
-.ENDIF
-
-# This target is used to generate the new makefile (.\makefile.95) for Win95
-
-.\makefile.95: .\makefile.mk
-	$(MINIPERL) genmk95.pl makefile.mk $(MK2)
-
-#--------------------- END Win95 SPECIFIC ---------------------
-
-# a blank target for when builds don't need to do certain things
-# this target added for Win95 port but used to keep the WinNT port able to
-# use this file
-__not_needed:
-	$(NOOP)
-
-CHECKDMAKE :
-.IF "$(NEWDMAKE)" == "define"
-	$(NOOP)
-.ELSE
-	@echo Your dmake doesn't support ^|^| or ^&^& in conditional expressions.
-	@echo Please get the latest dmake from http://search.cpan.org/dist/dmake/
-	@exit 1
-.ENDIF
-
-$(GLOBEXE) : perlglob$(o)
-.IF "$(CCTYPE)" == "BORLAND"
-	$(CC) -c -w -v -tWM -I"$(CCINCDIR)" perlglob.c
-	$(LINK32) -Tpe -ap $(BLINK_FLAGS) c0x32$(o) perlglob$(o) \
-	    "$(CCLIBDIR)\32BIT\wildargs$(o)",$@,,import32.lib cw32mt.lib,
-.ELIF "$(CCTYPE)" == "GCC"
-	$(LINK32) $(BLINK_FLAGS) -mconsole -o $@ perlglob$(o) $(LIBFILES)
-.ELSE
-	$(LINK32) $(BLINK_FLAGS) $(LIBFILES) -out:$@ -subsystem:$(SUBSYS) \
-	    perlglob$(o) setargv$(o)
-	$(EMBED_EXE_MANI)
-.ENDIF
-
-perlglob$(o)  : perlglob.c
-
-config.w32 : $(CFGSH_TMPL)
-	copy $(CFGSH_TMPL) config.w32
-
-.\config.h : $(CFGH_TMPL) $(CORE_NOCFG_H)
-	-del /f config.h
-	copy $(CFGH_TMPL) config.h
-
-..\git_version.h : $(MINIPERL) ..\make_patchnum.pl
-	cd .. && miniperl -Ilib make_patchnum.pl
-
-# make sure that we recompile perl.c if the git version changes
-..\perl$(o) : ..\git_version.h
-
-..\config.sh : config.w32 $(MINIPERL) config_sh.PL FindExt.pm
-	$(MINIPERL) -I..\lib config_sh.PL --cfgsh-option-file \
-	    $(mktmp $(CFG_VARS)) config.w32 > ..\config.sh
-
-# this target is for when changes to the main config.sh happen.
-# edit config.gc, then make perl using GCC in a minimal configuration (i.e.
-# with MULTI, ITHREADS, IMP_SYS, LARGE_FILES, PERLIO and CRYPT off), then make
-# this target to regenerate config_H.gc.
-# unfortunately, some further manual editing is also then required to restore all
-# the special _MSC_VER handling that is otherwise lost.
-# repeat for config.bc and config_H.bc (using BORLAND), except that there is no
-# _MSC_VER stuff in that case.
-regen_config_h:
-	$(MINIPERL) -I..\lib config_sh.PL --cfgsh-option-file $(mktmp $(CFG_VARS)) \
-	    $(CFGSH_TMPL) > ..\config.sh
-	cd .. && miniperl configpm
-	-del /f $(CFGH_TMPL)
-	-$(MINIPERL) -I..\lib config_h.PL "INST_VER=$(INST_VER)"
-	rename config.h $(CFGH_TMPL)
-
-$(CONFIGPM) : $(MINIPERL) ..\config.sh config_h.PL ..\minimod.pl
-	cd .. && miniperl configpm
-	if exist lib\* $(RCOPY) lib\*.* ..\lib\$(NULL)
-	$(XCOPY) ..\*.h $(COREDIR)\*.*
-	$(XCOPY) *.h $(COREDIR)\*.*
-	$(XCOPY) ..\ext\re\re.pm $(LIBDIR)\*.*
-	$(RCOPY) include $(COREDIR)\*.*
-	$(MINIPERL) -I..\lib config_h.PL "INST_VER=$(INST_VER)" \
-	    || $(MAKE) $(MAKEMACROS) $(CONFIGPM) $(MAKEFILE)
-
-$(MINIPERL) : $(MINIDIR) $(MINI_OBJ) $(CRTIPMLIBS)
-.IF "$(CCTYPE)" == "BORLAND"
-	if not exist $(CCLIBDIR)\PSDK\odbccp32.lib \
-	    cd $(CCLIBDIR)\PSDK && implib odbccp32.lib $(ODBCCP32_DLL)
-	$(LINK32) -Tpe -ap $(BLINK_FLAGS) \
-	    @$(mktmp c0x32$(o) $(MINI_OBJ),$@,,$(LIBFILES),)
-.ELIF "$(CCTYPE)" == "GCC"
-	$(LINK32) -v -mconsole -o $@ $(BLINK_FLAGS) \
-	    $(mktmp $(LKPRE) $(MINI_OBJ) $(LIBFILES) $(LKPOST))
-.ELSE
-	$(LINK32) -subsystem:console -out:$@ $(BLINK_FLAGS) \
-	    @$(mktmp $(LIBFILES) $(MINI_OBJ))
-	$(EMBED_EXE_MANI)
-.ENDIF
-
-$(MINIDIR) :
-	if not exist "$(MINIDIR)" mkdir "$(MINIDIR)"
-
-$(MINICORE_OBJ) : $(CORE_NOCFG_H)
-	$(CC) -c $(CFLAGS) -DPERL_EXTERNAL_GLOB -DPERL_IS_MINIPERL $(OBJOUT_FLAG)$@ ..\$(*B).c
-
-$(MINIWIN32_OBJ) : $(CORE_NOCFG_H)
-	$(CC) -c $(CFLAGS) $(OBJOUT_FLAG)$@ $(*B).c
-
-# -DPERL_IMPLICIT_SYS needs C++ for perllib.c
-# rules wrapped in .IFs break Win9X build (we end up with unbalanced []s unless
-# unless the .IF is true), so instead we use a .ELSE with the default.
-# This is the only file that depends on perlhost.h, vmem.h, and vdir.h
-
-perllib$(o)	: perllib.c .\perlhost.h .\vdir.h .\vmem.h
-.IF "$(USE_IMP_SYS)" == "define"
-	$(CC) -c -I. $(CFLAGS_O) $(CXX_FLAG) $(OBJOUT_FLAG)$@ perllib.c
-.ELSE
-	$(CC) -c -I. $(CFLAGS_O) $(OBJOUT_FLAG)$@ perllib.c
-.ENDIF
-
-# 1. we don't want to rebuild miniperl.exe when config.h changes
-# 2. we don't want to rebuild miniperl.exe with non-default config.h
-# 3. we can't have miniperl.exe depend on git_version.h, as miniperl creates it
-$(MINI_OBJ)	: $(CORE_NOCFG_H)
-
-$(WIN32_OBJ)	: $(CORE_H)
-
-$(CORE_OBJ)	: $(CORE_H)
-
-$(DLL_OBJ)	: $(CORE_H)
-
-$(X2P_OBJ)	: $(CORE_H)
-
-perldll.def : $(MINIPERL) $(CONFIGPM) ..\global.sym ..\pp.sym ..\makedef.pl create_perllibst_h.pl
-	$(MINIPERL) -I..\lib create_perllibst_h.pl
-	$(MINIPERL) -w ..\makedef.pl PLATFORM=win32 $(OPTIMIZE) $(DEFINES) \
-	$(BUILDOPT) CCTYPE=$(CCTYPE) > perldll.def
-
-$(PERLDLL): perldll.def $(PERLDLL_OBJ) $(PERLDLL_RES) Extensions_static
-.IF "$(CCTYPE)" == "BORLAND"
-	$(LINK32) -Tpd -ap $(BLINK_FLAGS) \
-	    @$(mktmp c0d32$(o) $(PERLDLL_OBJ),$@,, \
-	        $(shell @type Extensions_static) $(LIBFILES),perldll.def)
-	$(IMPLIB) $*.lib $@
-.ELIF "$(CCTYPE)" == "GCC"
-	$(LINK32) -mdll -o $@ -Wl,--base-file -Wl,perl.base $(BLINK_FLAGS) \
-	    $(mktmp $(LKPRE) $(PERLDLL_OBJ) \
-		$(shell @type Extensions_static) \
-		$(LIBFILES) $(LKPOST))
-	dlltool --output-lib $(PERLIMPLIB) \
-		--dllname $(PERLDLL:b).dll \
-		--def perldll.def \
-		--base-file perl.base \
-		--output-exp perl.exp
-	$(LINK32) -mdll -o $@ $(BLINK_FLAGS) \
-	    $(mktmp $(LKPRE) $(PERLDLL_OBJ) \
-		$(shell @type Extensions_static) \
-		$(LIBFILES) perl.exp $(LKPOST))
-.ELSE
-	$(LINK32) -dll -def:perldll.def -out:$@ $(BLINK_FLAGS) \
-	    @Extensions_static \
-	    @$(mktmp -base:0x28000000 $(DELAYLOAD) $(LIBFILES) \
-		$(PERLDLL_RES) $(PERLDLL_OBJ))
-	$(EMBED_DLL_MANI)
-.ENDIF
-	$(XCOPY) $(PERLIMPLIB) $(COREDIR)
-
-$(PERLSTATICLIB): Extensions_static
-.IF "$(CCTYPE)" == "BORLAND"
-	$(LIB32) $(LIB_FLAGS) $@ \
-	    @$(mktmp $(shell @type Extensions_static) \
-		$(PERLDLL_OBJ))
-.ELIF "$(CCTYPE)" == "GCC"
-# XXX: It would be nice if MinGW's ar accepted a temporary file, but this
-# doesn't seem to work:
-#	$(LIB32) $(LIB_FLAGS) $@ \
-#	    $(mktmp $(LKPRE) $(shell @type Extensions_static) \
-#		$(PERLDLL_OBJ) $(LKPOST))
-	$(LIB32) $(LIB_FLAGS) $@ \
-	    $(shell @type Extensions_static) \
-	    $(PERLDLL_OBJ)
-.ELSE
-	$(LIB32) $(LIB_FLAGS) -out:$@ @Extensions_static \
-	    @$(mktmp $(PERLDLL_OBJ))
-.ENDIF
-	$(XCOPY) $(PERLSTATICLIB) $(COREDIR)
-
-$(PERLEXE_ICO): $(MINIPERL) ..\uupacktool.pl $(PERLEXE_ICO).packd
-	$(MINIPERL) -I..\lib ..\uupacktool.pl -u $(PERLEXE_ICO).packd $(PERLEXE_ICO)
-
-$(PERLEXE_RES): perlexe.rc $(PERLEXE_ICO)
-
-$(MINIMOD) : $(MINIPERL) ..\minimod.pl
-	cd .. && miniperl minimod.pl > lib\ExtUtils\Miniperl.pm
-
-..\x2p\a2p$(o) : ..\x2p\a2p.c
-	$(CC) -I..\x2p $(CFLAGS) $(OBJOUT_FLAG)$@ -c ..\x2p\a2p.c
-
-..\x2p\hash$(o) : ..\x2p\hash.c
-	$(CC) -I..\x2p  $(CFLAGS) $(OBJOUT_FLAG)$@ -c ..\x2p\hash.c
-
-..\x2p\str$(o) : ..\x2p\str.c
-	$(CC) -I..\x2p  $(CFLAGS) $(OBJOUT_FLAG)$@ -c ..\x2p\str.c
-
-..\x2p\util$(o) : ..\x2p\util.c
-	$(CC) -I..\x2p  $(CFLAGS) $(OBJOUT_FLAG)$@ -c ..\x2p\util.c
-
-..\x2p\walk$(o) : ..\x2p\walk.c
-	$(CC) -I..\x2p  $(CFLAGS) $(OBJOUT_FLAG)$@ -c ..\x2p\walk.c
-
-$(X2P) : $(MINIPERL) $(X2P_OBJ)
-	$(MINIPERL) ..\x2p\find2perl.PL
-	$(MINIPERL) ..\x2p\s2p.PL
-.IF "$(CCTYPE)" == "BORLAND"
-	$(LINK32) -Tpe -ap $(BLINK_FLAGS) \
-	    @$(mktmp c0x32$(o) $(X2P_OBJ),$@,,$(LIBFILES),)
-.ELIF "$(CCTYPE)" == "GCC"
-	$(LINK32) -v -o $@ $(BLINK_FLAGS) \
-	    $(mktmp $(LKPRE) $(X2P_OBJ) $(LIBFILES) $(LKPOST))
-.ELSE
-	$(LINK32) -subsystem:console -out:$@ $(BLINK_FLAGS) \
-	    @$(mktmp $(LIBFILES) $(X2P_OBJ))
-	$(EMBED_EXE_MANI)
-.ENDIF
-
-$(MINIDIR)\globals$(o) : $(UUDMAP_H)
-
-$(UUDMAP_H) : $(GENUUDMAP)
-	$(GENUUDMAP) >$(UUDMAP_H)
-
-$(GENUUDMAP) : $(GENUUDMAP_OBJ)
-.IF "$(CCTYPE)" == "BORLAND"
-	$(LINK32) -Tpe -ap $(BLINK_FLAGS) \
-	    @$(mktmp c0x32$(o) $(GENUUDMAP_OBJ),$@,,$(LIBFILES),)
-.ELIF "$(CCTYPE)" == "GCC"
-	$(LINK32) -v -o $@ $(BLINK_FLAGS) \
-	    $(mktmp $(LKPRE) $(GENUUDMAP_OBJ) $(LIBFILES) $(LKPOST))
-.ELSE
-	$(LINK32) -subsystem:console -out:$@ $(BLINK_FLAGS) \
-	    @$(mktmp $(LIBFILES) $(GENUUDMAP_OBJ))
-	$(EMBED_EXE_MANI)
-.ENDIF
-
-perlmain.c : runperl.c
-	copy runperl.c perlmain.c
-
-perlmain$(o) : perlmain.c
-	$(CC) $(CFLAGS_O:s,-DPERLDLL,-UPERLDLL,) $(OBJOUT_FLAG)$@ -c perlmain.c
-
-perlmainst.c : runperl.c
-	copy runperl.c perlmainst.c
-
-perlmainst$(o) : perlmainst.c
-	$(CC) $(CFLAGS_O) $(OBJOUT_FLAG)$@ -c perlmainst.c
-
-$(PERLEXE): $(PERLDLL) $(CONFIGPM) $(PERLEXE_OBJ) $(PERLEXE_RES)
-.IF "$(CCTYPE)" == "BORLAND"
-	$(LINK32) -Tpe -ap $(BLINK_FLAGS) \
-	    @$(mktmp c0x32$(o) $(PERLEXE_OBJ),$@,, \
-		$(PERLIMPLIB) $(LIBFILES),,$(PERLEXE_RES))
-.ELIF "$(CCTYPE)" == "GCC"
-	$(LINK32) -mconsole -o $@ $(BLINK_FLAGS)  \
-	    $(PERLEXE_OBJ) $(PERLEXE_RES) $(PERLIMPLIB) $(LIBFILES)
-.ELSE
-	$(LINK32) -subsystem:console -out:$@ -stack:0x1000000 $(BLINK_FLAGS) \
-	    $(LIBFILES) $(PERLEXE_OBJ) $(SETARGV_OBJ) $(PERLIMPLIB) $(PERLEXE_RES)
-	$(EMBED_EXE_MANI)
-.ENDIF
-	copy $(PERLEXE) $(WPERLEXE)
-	$(MINIPERL) -I..\lib bin\exetype.pl $(WPERLEXE) WINDOWS
-	copy splittree.pl ..
-	$(MINIPERL) -I..\lib ..\splittree.pl "../LIB" $(AUTODIR)
-
-$(PERLEXESTATIC): $(PERLSTATICLIB) $(CONFIGPM) $(PERLEXEST_OBJ) $(PERLEXE_RES)
-.IF "$(CCTYPE)" == "BORLAND"
-	$(LINK32) -Tpe -ap $(BLINK_FLAGS) \
-	    @$(mktmp c0x32$(o) $(PERLEXEST_OBJ),$@,, \
-		$(shell @type Extensions_static) $(PERLSTATICLIB) $(LIBFILES),, \
-		$(PERLEXE_RES))
-.ELIF "$(CCTYPE)" == "GCC"
-	$(LINK32) -mconsole -o $@ $(BLINK_FLAGS) \
-	    $(mktmp $(LKPRE) $(shell @type Extensions_static) \
-		$(PERLSTATICLIB) $(LIBFILES) $(PERLEXEST_OBJ) \
-		$(PERLEXE_RES) $(LKPOST))
-.ELSE
-	$(LINK32) -subsystem:console -out:$@ -stack:0x1000000 $(BLINK_FLAGS) \
-	    @Extensions_static $(PERLSTATICLIB) /PDB:NONE \
-	    $(LIBFILES) $(PERLEXEST_OBJ) $(SETARGV_OBJ) $(PERLEXE_RES)
-	$(EMBED_EXE_MANI)
-.ENDIF
-
-$(DYNALOADER).c: $(MINIPERL) $(EXTDIR)\DynaLoader\dl_win32.xs $(CONFIGPM)
-	if not exist $(AUTODIR) mkdir $(AUTODIR)
-	cd $(EXTDIR)\$(*B) && ..\$(MINIPERL) -I..\..\lib $(*B)_pm.PL
-	cd $(EXTDIR)\$(*B) && ..\$(MINIPERL) -I..\..\lib XSLoader_pm.PL
-	$(XCOPY) $(EXTDIR)\$(*B)\$(*B).pm $(LIBDIR)\$(NULL)
-	$(XCOPY) $(EXTDIR)\$(*B)\XSLoader.pm $(LIBDIR)\$(NULL)
-	cd $(EXTDIR)\$(*B) && $(XSUBPP) dl_win32.xs > $(*B).c
-	$(XCOPY) $(EXTDIR)\$(*B)\dlutils.c .
-
-$(EXTDIR)\DynaLoader\dl_win32.xs: dl_win32.xs
-	copy dl_win32.xs $(EXTDIR)\DynaLoader\dl_win32.xs
-
-MakePPPort: $(MINIPERL) $(CONFIGPM)
-	$(MINIPERL) -I..\lib ..\mkppport
-
-MakePPPort_clean:
-	-if exist $(MINIPERL) $(MINIPERL) -I..\lib ..\mkppport --clean
-
-#-------------------------------------------------------------------------------
-Extensions : ..\make_ext.pl $(PERLDEP) $(CONFIGPM)
-	$(XCOPY) ..\*.h $(COREDIR)\*.*
-	$(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(EXTDIR) --dynamic
-
-Extensions_reonly : ..\make_ext.pl $(PERLDEP) $(CONFIGPM)
-	$(XCOPY) ..\*.h $(COREDIR)\*.*
-	$(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(EXTDIR) --dynamic +re
-
-Extensions_static : ..\make_ext.pl list_static_libs.pl $(PERLDEP) $(CONFIGPM)
-	$(XCOPY) ..\*.h $(COREDIR)\*.*
-	$(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(EXTDIR) --static
-	$(MINIPERL) -I..\lib list_static_libs.pl > Extensions_static
-
-Extensions_clean :
-	-if exist $(MINIPERL) $(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(EXTDIR) --all --target=clean
-
-Extensions_realclean :
-	-if exist $(MINIPERL) $(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(EXTDIR) --all --target=realclean
-
-#-------------------------------------------------------------------------------
-
-
-doc: $(PERLEXE)
-	$(PERLEXE) -I..\lib ..\installhtml --podroot=.. --htmldir=$(HTMLDIR) \
-	    --podpath=pod:lib:ext:utils --htmlroot="file://$(INST_HTML:s,:,|,)"\
-	    --libpod=perlfunc:perlguts:perlvar:perlrun:perlop --recurse
-
-# Note that this next section is parsed (and regenerated) by pod/buildtoc
-# so please check that script before making structural changes here
-utils: $(PERLEXE) $(X2P)
-	cd ..\utils && $(MAKE) PERL=$(MINIPERL)
-	copy ..\README.aix      ..\pod\perlaix.pod
-	copy ..\README.amiga    ..\pod\perlamiga.pod
-	copy ..\README.apollo   ..\pod\perlapollo.pod
-	copy ..\README.beos     ..\pod\perlbeos.pod
-	copy ..\README.bs2000   ..\pod\perlbs2000.pod
-	copy ..\README.ce       ..\pod\perlce.pod
-	copy ..\README.cn       ..\pod\perlcn.pod
-	copy ..\README.cygwin   ..\pod\perlcygwin.pod
-	copy ..\README.dgux     ..\pod\perldgux.pod
-	copy ..\README.dos      ..\pod\perldos.pod
-	copy ..\README.epoc     ..\pod\perlepoc.pod
-	copy ..\README.freebsd  ..\pod\perlfreebsd.pod
-	copy ..\README.haiku    ..\pod\perlhaiku.pod
-	copy ..\README.hpux     ..\pod\perlhpux.pod
-	copy ..\README.hurd     ..\pod\perlhurd.pod
-	copy ..\README.irix     ..\pod\perlirix.pod
-	copy ..\README.jp       ..\pod\perljp.pod
-	copy ..\README.ko       ..\pod\perlko.pod
-	copy ..\README.linux    ..\pod\perllinux.pod
-	copy ..\README.machten  ..\pod\perlmachten.pod
-	copy ..\README.macos    ..\pod\perlmacos.pod
-	copy ..\README.macosx   ..\pod\perlmacosx.pod
-	copy ..\README.mint     ..\pod\perlmint.pod
-	copy ..\README.mpeix    ..\pod\perlmpeix.pod
-	copy ..\README.netware  ..\pod\perlnetware.pod
-	copy ..\README.openbsd  ..\pod\perlopenbsd.pod
-	copy ..\README.os2      ..\pod\perlos2.pod
-	copy ..\README.os390    ..\pod\perlos390.pod
-	copy ..\README.os400    ..\pod\perlos400.pod
-	copy ..\README.plan9    ..\pod\perlplan9.pod
-	copy ..\README.qnx      ..\pod\perlqnx.pod
-	copy ..\README.riscos   ..\pod\perlriscos.pod
-	copy ..\README.solaris  ..\pod\perlsolaris.pod
-	copy ..\README.symbian  ..\pod\perlsymbian.pod
-	copy ..\README.tru64    ..\pod\perltru64.pod
-	copy ..\README.tw       ..\pod\perltw.pod
-	copy ..\README.uts      ..\pod\perluts.pod
-	copy ..\README.vmesa    ..\pod\perlvmesa.pod
-	copy ..\README.vos      ..\pod\perlvos.pod
-	copy ..\README.win32    ..\pod\perlwin32.pod
-	copy ..\pod\perl5101delta.pod ..\pod\perldelta.pod
-	cd ..\pod && $(MAKE) -f ..\win32\pod.mak converters
-	cd ..\lib && $(PERLEXE) lib_pm.PL
-	$(PERLEXE) $(PL2BAT) $(UTILS)
-	$(PERLEXE) ..\autodoc.pl ..
-	$(PERLEXE) ..\pod\perlmodlib.pl -q
-	$(PERLEXE) ..\pod\buildtoc --build-toc -q
-
-# Note that the pod cleanup in this next section is parsed (and regenerated
-# by pod/buildtoc so please check that script before making changes here
-
-distclean: realclean
-	-del /f $(MINIPERL) $(PERLEXE) $(PERLDLL) $(GLOBEXE) \
-		$(PERLIMPLIB) ..\miniperl$(a) $(MINIMOD) \
-		$(PERLEXESTATIC) $(PERLSTATICLIB)
-	-del /f *.def *.map
-	-del /f $(DYNALOADER).c
-	-del /f $(EXTDIR)\DynaLoader\dl_win32.xs
-	-del /f $(EXTDIR)\DynaLoader\DynaLoader.pm
-	-del /f $(EXTDIR)\DynaLoader\XSLoader.pm
-	-del /f $(LIBDIR)\Encode.pm $(LIBDIR)\encoding.pm $(LIBDIR)\Errno.pm
-	-del /f $(LIBDIR)\Config.pod $(LIBDIR)\POSIX.pod $(LIBDIR)\threads.pm
-	-del /f $(LIBDIR)\.exists $(LIBDIR)\attrs.pm $(LIBDIR)\DynaLoader.pm
-	-del /f $(LIBDIR)\XSLoader.pm $(LIBDIR)\lib.pm
-	-del /f $(LIBDIR)\Fcntl.pm $(LIBDIR)\IO.pm $(LIBDIR)\Opcode.pm
-	-del /f $(LIBDIR)\ops.pm $(LIBDIR)\Safe.pm
-	-del /f $(LIBDIR)\SDBM_File.pm $(LIBDIR)\Socket.pm $(LIBDIR)\POSIX.pm
-	-del /f $(LIBDIR)\B.pm $(LIBDIR)\O.pm $(LIBDIR)\re.pm
-	-del /f $(LIBDIR)\Devel\Peek.pm $(LIBDIR)\Devel\DProf.pm
-	-del /f $(LIBDIR)\Devel\PPPort.pm
-	-del /f $(LIBDIR)\File\Glob.pm
-	-del /f $(LIBDIR)\Storable.pm
-	-del /f $(LIBDIR)\Digest\MD5.pm
-	-del /f $(LIBDIR)\Digest\SHA.pm
-	-del /f $(LIBDIR)\PerlIO\encoding.pm
-	-del /f $(LIBDIR)\PerlIO\scalar.pm
-	-del /f $(LIBDIR)\PerlIO\via.pm
-	-del /f $(LIBDIR)\Sys\Hostname.pm
-	-del /f $(LIBDIR)\threads\shared.pm
-	-del /f $(LIBDIR)\Time\HiRes.pm
-	-del /f $(LIBDIR)\Unicode\Normalize.pm
-	-del /f $(LIBDIR)\Math\BigInt\FastCalc.pm
-	-del /f $(LIBDIR)\Win32.pm
-	-del /f $(LIBDIR)\Win32CORE.pm
-	-del /f $(LIBDIR)\Win32API\File.pm
-	-del /f $(LIBDIR)\Win32API\File\cFile.pc
-	-if exist $(LIBDIR)\B rmdir /s /q $(LIBDIR)\B
-	-if exist $(LIBDIR)\Compress rmdir /s /q $(LIBDIR)\Compress
-	-if exist $(LIBDIR)\Data rmdir /s /q $(LIBDIR)\Data
-	-if exist $(LIBDIR)\Encode rmdir /s /q $(LIBDIR)\Encode
-	-if exist $(LIBDIR)\Filter\Util rmdir /s /q $(LIBDIR)\Filter\Util
-	-if exist $(LIBDIR)\Hash rmdir /s /q $(LIBDIR)\Hash
-	-if exist $(LIBDIR)\App rmdir /s /q $(LIBDIR)\App
-	-if exist $(LIBDIR)\Module\Pluggable rmdir /s /q $(LIBDIR)\Module\Pluggable
-	-if exist $(LIBDIR)\TAP rmdir /s /q $(LIBDIR)\TAP
-	-if exist $(LIBDIR)\mro rmdir /s /q $(LIBDIR)\mro
-	-if exist $(LIBDIR)\IO\Compress rmdir /s /q $(LIBDIR)\IO\Compress
-	-if exist $(LIBDIR)\IO\Socket rmdir /s /q $(LIBDIR)\IO\Socket
-	-if exist $(LIBDIR)\IO\Uncompress rmdir /s /q $(LIBDIR)\IO\Uncompress
-	-if exist $(LIBDIR)\List rmdir /s /q $(LIBDIR)\List
-	-if exist $(LIBDIR)\MIME rmdir /s /q $(LIBDIR)\MIME
-	-if exist $(LIBDIR)\re rmdir /s /q $(LIBDIR)\re
-	-if exist $(LIBDIR)\Scalar rmdir /s /q $(LIBDIR)\Scalar
-	-if exist $(LIBDIR)\Sys rmdir /s /q $(LIBDIR)\Sys
-	-if exist $(LIBDIR)\threads rmdir /s /q $(LIBDIR)\threads
-	-if exist $(LIBDIR)\XS rmdir /s /q $(LIBDIR)\XS
-	-if exist $(LIBDIR)\Win32API rmdir /s /q $(LIBDIR)\Win32API
-	-cd $(PODDIR) && del /f *.html *.bat podchecker \
-	    perlaix.pod perlamiga.pod perlapi.pod perlapollo.pod \
-	    perlbeos.pod perlbs2000.pod perlce.pod perlcn.pod \
-	    perlcygwin.pod perldelta.pod perldgux.pod perldos.pod \
-	    perlepoc.pod perlfreebsd.pod perlhaiku.pod perlhpux.pod \
-	    perlhurd.pod perlintern.pod perlirix.pod perljp.pod perlko.pod \
-	    perllinux.pod perlmachten.pod perlmacos.pod perlmacosx.pod \
-	    perlmint.pod perlmodlib.pod perlmpeix.pod perlnetware.pod \
-	    perlopenbsd.pod perlos2.pod perlos390.pod perlos400.pod \
-	    perlplan9.pod perlqnx.pod perlriscos.pod perlsolaris.pod \
-	    perlsymbian.pod perltoc.pod perltru64.pod perltw.pod \
-	    perluts.pod perlvmesa.pod perlvos.pod perlwin32.pod \
-	    pod2html pod2latex pod2man pod2text pod2usage \
-	    podselect
-	-cd ..\utils && del /f h2ph splain perlbug pl2pm c2ph pstruct h2xs \
-	    perldoc perlivp dprofpp libnetcfg enc2xs piconv cpan *.bat \
-	    xsubpp instmodsh prove ptar ptardiff cpanp-run-perl cpanp cpan2dist shasum corelist config_data
-	-cd ..\x2p && del /f find2perl s2p psed *.bat
-	-del /f ..\config.sh ..\splittree.pl perlmain.c dlutils.c config.h.new \
-	    perlmainst.c
-	-del /f $(CONFIGPM)
-	-del /f ..\lib\Config_git.pl
-	-del /f bin\*.bat
-	-del /f perllibst.h
-	-del /f $(PERLEXE_ICO) perl.base
-	-cd .. && del /s *$(a) *.map *.pdb *.ilk *.tds *.bs *$(o) .exists pm_to_blib
-	-cd $(EXTDIR) && del /s *.def Makefile Makefile.old
-	-if exist $(AUTODIR) rmdir /s /q $(AUTODIR)
-	-if exist $(COREDIR) rmdir /s /q $(COREDIR)
-	-if exist pod2htmd.tmp del pod2htmd.tmp
-	-if exist pod2htmi.tmp del pod2htmi.tmp
-	-if exist $(HTMLDIR) rmdir /s /q $(HTMLDIR)
-	-del /f ..\t\test_state
-
-install : all installbare installhtml
-
-installbare : $(RIGHTMAKE) utils
-	$(PERLEXE) ..\installperl
-	if exist $(WPERLEXE) $(XCOPY) $(WPERLEXE) $(INST_BIN)\*.*
-	if exist $(PERLEXESTATIC) $(XCOPY) $(PERLEXESTATIC) $(INST_BIN)\*.*
-	$(XCOPY) $(GLOBEXE) $(INST_BIN)\*.*
-	if exist ..\perl*.pdb $(XCOPY) ..\perl*.pdb $(INST_BIN)\*.*
-	if exist ..\x2p\a2p.pdb $(XCOPY) ..\x2p\a2p.pdb $(INST_BIN)\*.*
-	$(XCOPY) bin\*.bat $(INST_SCRIPT)\*.*
-
-installhtml : doc
-	$(RCOPY) $(HTMLDIR)\*.* $(INST_HTML)\*.*
-
-inst_lib : $(CONFIGPM)
-	copy splittree.pl ..
-	$(MINIPERL) -I..\lib ..\splittree.pl "../LIB" $(AUTODIR)
-	$(RCOPY) ..\lib $(INST_LIB)\*.*
-
-$(UNIDATAFILES) .UPDATEALL : $(MINIPERL) $(CONFIGPM) ..\lib\unicore\mktables
-	cd ..\lib\unicore && \
-	..\$(MINIPERL) -I.. mktables
-
-minitest : $(MINIPERL) $(GLOBEXE) $(CONFIGPM) $(UNIDATAFILES) utils
-	$(XCOPY) $(MINIPERL) ..\t\$(NULL)
-	if exist ..\t\perl.exe del /f ..\t\perl.exe
-	rename ..\t\miniperl.exe perl.exe
-.IF "$(CCTYPE)" == "BORLAND"
-	$(XCOPY) $(GLOBBAT) ..\t\$(NULL)
-.ELSE
-	$(XCOPY) $(GLOBEXE) ..\t\$(NULL)
-.ENDIF
-	attrib -r ..\t\*.*
-	cd ..\t && \
-	$(MINIPERL) -I..\lib harness base/*.t comp/*.t cmd/*.t io/*.t op/*.t pragma/*.t
-
-unpack_files:
-	$(MINIPERL) -I..\lib ..\uupacktool.pl -u -d .. -m
-
-cleanup_unpacked_files:
-	-if exist $(MINIPERL) $(MINIPERL) -I..\lib ..\uupacktool.pl -c -d .. -m
-	
-test-prep : all utils unpack_files
-	$(XCOPY) $(PERLEXE) ..\t\$(NULL)
-	$(XCOPY) $(PERLDLL) ..\t\$(NULL)
-.IF "$(CCTYPE)" == "BORLAND"
-	$(XCOPY) $(GLOBBAT) ..\t\$(NULL)
-.ELSE
-	$(XCOPY) $(GLOBEXE) ..\t\$(NULL)
-.ENDIF
-
-test : $(RIGHTMAKE) test-prep
-	cd ..\t && $(PERLEXE) -I..\lib harness $(TEST_SWITCHES) $(TEST_FILES)
-
-test-reonly : reonly utils
-	$(XCOPY) $(PERLEXE) ..\t\$(NULL)
-	$(XCOPY) $(PERLDLL) ..\t\$(NULL)
-	$(XCOPY) $(GLOBEXE) ..\t\$(NULL)
-	cd ..\t && \
-	$(PERLEXE) -I..\lib harness $(OPT) -re \bpat\b \breg \bre\b \bsubst \brxcode $(EXTRA) && \
-	cd ..\win32
-
-regen :
-	cd .. && regen.pl && cd win32
-
-test-notty : test-prep
-	set PERL_SKIP_TTY_TEST=1 && \
-	    cd ..\t && $(PERLEXE) -I.\lib harness $(TEST_SWITCHES) $(TEST_FILES)
-
-_test : $(RIGHTMAKE)
-	$(XCOPY) $(PERLEXE) ..\t\$(NULL)
-	$(XCOPY) $(PERLDLL) ..\t\$(NULL)
-.IF "$(CCTYPE)" == "BORLAND"
-	$(XCOPY) $(GLOBBAT) ..\t\$(NULL)
-.ELSE
-	$(XCOPY) $(GLOBEXE) ..\t\$(NULL)
-.ENDIF
-	cd ..\t && $(PERLEXE) -I..\lib harness $(TEST_SWITCHES) $(TEST_FILES)
-
-_clean :
-	-@erase miniperlmain$(o)
-	-@erase $(MINIPERL)
-	-@erase perlglob$(o)
-	-@erase perlmain$(o)
-	-@erase perlmainst$(o)
-	-@erase config.w32
-	-@erase /f config.h
-	-@erase /f ..\git_version.h
-	-@erase $(GLOBEXE)
-	-@erase $(PERLEXE)
-	-@erase $(WPERLEXE)
-	-@erase $(PERLEXESTATIC)
-	-@erase $(PERLSTATICLIB)
-	-@erase $(PERLDLL)
-	-@erase $(CORE_OBJ)
-	-@erase $(GENUUDMAP) $(GENUUDMAP_OBJ) $(UUDMAP_H)
-	-if exist $(MINIDIR) rmdir /s /q $(MINIDIR)
-	-if exist $(UNIDATADIR1) rmdir /s /q $(UNIDATADIR1)
-	-if exist $(UNIDATADIR2) rmdir /s /q $(UNIDATADIR2)
-	-@erase $(UNIDATAFILES)
-	-@erase $(WIN32_OBJ)
-	-@erase $(DLL_OBJ)
-	-@erase $(X2P_OBJ)
-	-@erase ..\*$(o) ..\*$(a) ..\*.exp *$(o) *$(a) *.exp *.res
-	-@erase ..\t\*.exe ..\t\*.dll ..\t\*.bat
-	-@erase ..\x2p\*.exe ..\x2p\*.bat
-	-@erase *.ilk
-	-@erase *.pdb
-	-@erase *.tds
-	-@erase Extensions_static
-
-
-
-_preclean : cleanup_unpacked_files
-	
-clean : _preclean Extensions_clean _clean
-
-realclean : _preclean Extensions_realclean MakePPPort_clean _clean
-
-# Handy way to run perlbug -ok without having to install and run the
-# installed perlbug. We don't re-run the tests here - we trust the user.
-# Please *don't* use this unless all tests pass.
-# If you want to report test failures, use "dmake nok" instead.
-ok: utils
-	$(PERLEXE) -I..\lib ..\utils\perlbug -ok -s "(UNINSTALLED)"
-
-okfile: utils
-	$(PERLEXE) -I..\lib ..\utils\perlbug -ok -s "(UNINSTALLED)" -F perl.ok
-
-nok: utils
-	$(PERLEXE) -I..\lib ..\utils\perlbug -nok -s "(UNINSTALLED)"
-
-nokfile: utils
-	$(PERLEXE) -I..\lib ..\utils\perlbug -nok -s "(UNINSTALLED)" -F perl.nok
+#
+# Makefile to build perl on Windows NT using DMAKE.
+# Supported compilers:
+#	Visual C++ 2.0 or later
+#	Borland C++ 5.02 or later
+#	MinGW with gcc-2.95.2 or later
+#	MS Platform SDK 64-bit compiler and tools **experimental**
+#
+# This is set up to build a perl.exe that runs off a shared library
+# (perl512.dll).  Also makes individual DLLs for the XS extensions.
+#
+
+##
+## Make sure you read README.win32 *before* you mess with anything here!
+##
+
+##
+## Build configuration.  Edit the values below to suit your needs.
+##
+
+#
+# Set these to wherever you want "dmake install" to put your
+# newly built perl.
+#
+INST_DRV	*= c:
+INST_TOP	*= $(INST_DRV)\perl
+
+#
+# Uncomment if you want to build a 32-bit Perl using a 32-bit compiler
+# on a 64-bit version of Windows.
+#WIN64		*= undef
+
+#
+# Comment this out if you DON'T want your perl installation to be versioned.
+# This means that the new installation will overwrite any files from the
+# old installation at the same INST_TOP location.  Leaving it enabled is
+# the safest route, as perl adds the extra version directory to all the
+# locations it installs files to.  If you disable it, an alternative
+# versioned installation can be obtained by setting INST_TOP above to a
+# path that includes an arbitrary version string.
+#
+#INST_VER	*= \5.12.2
+
+#
+# Comment this out if you DON'T want your perl installation to have
+# architecture specific components.  This means that architecture-
+# specific files will be installed along with the architecture-neutral
+# files.  Leaving it enabled is safer and more flexible, in case you
+# want to build multiple flavors of perl and install them together in
+# the same location.  Commenting it out gives you a simpler
+# installation that is easier to understand for beginners.
+#
+#INST_ARCH	*= \$(ARCHNAME)
+
+#
+# Uncomment this if you want perl to run
+# 	$Config{sitelibexp}\sitecustomize.pl
+# before anything else.  This script can then be set up, for example,
+# to add additional entries to @INC.
+#
+#USE_SITECUST	*= define
+
+#
+# uncomment to enable multiple interpreters.  This is need for fork()
+# emulation and for thread support.
+#
+USE_MULTI	*= define
+
+#
+# Interpreter cloning/threads; now reasonably complete.
+# This should be enabled to get the fork() emulation.  
+# This needs USE_MULTI above.
+#
+USE_ITHREADS	*= define
+
+#
+# uncomment to enable the implicit "host" layer for all system calls
+# made by perl.  This needs USE_MULTI above.  
+# This is also needed to get fork().
+#
+USE_IMP_SYS	*= define
+
+#
+# Comment out next assign to disable perl's I/O subsystem and use compiler's 
+# stdio for IO - depending on your compiler vendor and run time library you may 
+# then get a number of fails from make test i.e. bugs - complain to them not us ;-). 
+# You will also be unable to take full advantage of perl5.8's support for multiple 
+# encodings and may see lower IO performance. You have been warned.
+USE_PERLIO	*= define
+
+#
+# Comment this out if you don't want to enable large file support for
+# some reason.  Should normally only be changed to maintain compatibility
+# with an older release of perl.
+USE_LARGE_FILES	*= define
+
+#
+# uncomment exactly one of the following
+#
+# Visual C++ 2.x
+#CCTYPE		*= MSVC20
+# Visual C++ > 2.x and < 6.x
+#CCTYPE		*= MSVC
+# Visual C++ 6.x (aka Visual C++ 98)
+#CCTYPE		*= MSVC60
+# Visual C++ Toolkit 2003 (aka Visual C++ 7.x) (free command-line tools)
+#CCTYPE		*= MSVC70FREE
+# Visual C++ .NET 2003 (aka Visual C++ 7.x) (full version)
+#CCTYPE		*= MSVC70
+# Visual C++ 2005 Express Edition (aka Visual C++ 8.x) (free version)
+#CCTYPE		*= MSVC80FREE
+# Visual C++ 2005 (aka Visual C++ 8.x) (full version)
+#CCTYPE		*= MSVC80
+# Visual C++ 2008 Express Edition (aka Visual C++ 9.x) (free version)
+#CCTYPE		*= MSVC90FREE
+# Visual C++ 2008 (aka Visual C++ 9.x) (full version)
+#CCTYPE		*= MSVC90
+# Borland 5.02 or later
+#CCTYPE		*= BORLAND
+# MinGW or mingw-w64 with gcc-2.95.2 or later
+CCTYPE		*= GCC
+
+#
+# uncomment this if your Borland compiler is older than v5.4.
+#BCCOLD		*= define
+#
+# uncomment this if you want to use Borland's VCL as your CRT
+#BCCVCL		*= define
+
+#
+# uncomment this if you are compiling under Windows 95/98 and command.com
+# (not needed if you're running under 4DOS/NT 6.01 or later)
+#IS_WIN95	*= define
+
+#
+# uncomment next line if you want debug version of perl (big,slow)
+# If not enabled, we automatically try to use maximum optimization
+# with all compilers that are known to have a working optimizer.
+#
+#CFG		*= Debug
+
+#
+# uncomment to enable use of PerlCRT.DLL when using the Visual C compiler.
+# It has patches that fix known bugs in older versions of MSVCRT.DLL.
+# This currently requires VC 5.0 with Service Pack 3 or later.
+# Get it from CPAN at http://www.cpan.org/authors/id/D/DO/DOUGL/
+# and follow the directions in the package to install.
+#
+# Not recommended if you have VC 6.x and you're not running Windows 9x.
+#
+#USE_PERLCRT	*= define
+
+#
+# uncomment to enable linking with setargv.obj under the Visual C
+# compiler. Setting this options enables perl to expand wildcards in
+# arguments, but it may be harder to use alternate methods like
+# File::DosGlob that are more powerful.  This option is supported only with
+# Visual C.
+#
+#USE_SETARGV	*= define
+
+#
+# if you want to have the crypt() builtin function implemented, leave this or
+# CRYPT_LIB uncommented.  The fcrypt.c file named here contains a suitable
+# version of des_fcrypt().
+#
+CRYPT_SRC	*= fcrypt.c
+
+#
+# if you didn't set CRYPT_SRC and if you have des_fcrypt() available in a
+# library, uncomment this, and make sure the library exists (see README.win32)
+# Specify the full pathname of the library.
+#
+#CRYPT_LIB	*= fcrypt.lib
+
+#
+# set this if you wish to use perl's malloc
+# WARNING: Turning this on/off WILL break binary compatibility with extensions
+# you may have compiled with/without it.  Be prepared to recompile all
+# extensions if you change the default.  Currently, this cannot be enabled
+# if you ask for USE_IMP_SYS above.
+#
+#PERL_MALLOC	*= define
+
+#
+# set this to enable debugging mstats
+# This must be enabled to use the Devel::Peek::mstat() function.  This cannot
+# be enabled without PERL_MALLOC as well.
+#
+#DEBUG_MSTATS	*= define
+
+#
+# set this to additionally provide a statically linked perl-static.exe.
+# Note that dynamic loading will not work with this perl, so you must
+# include required modules statically using the STATIC_EXT or ALL_STATIC
+# variables below. A static library perl512s.lib will also be created.
+# Ordinary perl.exe is not affected by this option.
+#
+#BUILD_STATIC	*= define
+
+#
+# in addition to BUILD_STATIC the option ALL_STATIC makes *every*
+# extension get statically built
+# This will result in a very large perl executable, but the main purpose
+# is to have proper linking set so as to be able to create miscellaneous
+# executables with different built-in extensions
+#
+#ALL_STATIC	*= define
+
+#
+# set the install locations of the compiler include/libraries
+# Running VCVARS32.BAT is *required* when using Visual C.
+# Some versions of Visual C don't define MSVCDIR in the environment,
+# so you may have to set CCHOME explicitly (spaces in the path name should
+# not be quoted)
+#
+.IF "$(CCTYPE)" == "BORLAND"
+CCHOME		*= C:\Borland\BCC55
+.ELIF "$(CCTYPE)" == "GCC"
+CCHOME		*= C:\MinGW
+.ELSE
+CCHOME		*= $(MSVCDIR)
+.ENDIF
+
+#
+# If building with gcc-4.x.x (or x86_64-w64-mingw32-gcc-4.x.x), then
+# uncomment  the following assignment to GCC_4XX, make sure that CCHOME
+# has been set correctly above, and uncomment the appropriate
+# GCCHELPERDLL line.
+# The name of the dll can change, depending upon which vendor has supplied
+# your 4.x.x compiler, and upon the values of "x".
+# (The dll will be in your mingw/bin folder, so check there if you're
+# unsure about the correct name.)
+# Without these corrections, the op/taint.t test script will fail.
+#
+#GCC_4XX		*= define
+#GCCHELPERDLL	*= $(CCHOME)\bin\libgcc_s_sjlj-1.dll
+#GCCHELPERDLL	*= $(CCHOME)\bin\libgcc_s_dw2-1.dll
+#GCCHELPERDLL	*= $(CCHOME)\bin\libgcc_s_1.dll
+
+#
+# uncomment this if you are using x86_64-w64-mingw32 cross-compiler
+# ie if your gcc executable is called 'x86_64-w64-mingw32-gcc'
+# instead of the usual 'gcc'.
+#
+#GCCCROSS	*= define
+
+#
+# Following sets $Config{incpath} and $Config{libpth}
+#
+
+.IF "$(GCCCROSS)" == "define"
+CCINCDIR *= $(CCHOME)\mingw\include
+CCLIBDIR *= $(CCHOME)\mingw\lib
+.ELSE
+CCINCDIR *= $(CCHOME)\include
+CCLIBDIR *= $(CCHOME)\lib
+.ENDIF
+
+#
+# Additional compiler flags can be specified here.
+#
+BUILDOPT	*= $(BUILDOPTEXTRA)
+
+#
+# Adding -DPERL_HASH_SEED_EXPLICIT will disable randomization of Perl's
+# internal hash function unless the PERL_HASH_SEED environment variable is set.
+# Alternatively, adding -DNO_HASH_SEED will completely disable the
+# randomization feature. 
+# The latter is required to maintain binary compatibility with Perl 5.8.0.
+#
+#BUILDOPT	+= -DPERL_HASH_SEED_EXPLICIT
+#BUILDOPT	+= -DNO_HASH_SEED
+
+#
+# This should normally be disabled.  Adding -DPERL_POLLUTE enables support
+# for old symbols by default, at the expense of extreme pollution.  You most
+# probably just want to build modules that won't compile with
+#         perl Makefile.PL POLLUTE=1
+# instead of enabling this.  Please report such modules to the respective
+# authors.
+#
+#BUILDOPT	+= -DPERL_POLLUTE
+
+#
+# This should normally be disabled.  Enabling it will disable the File::Glob
+# implementation of CORE::glob.
+#
+#BUILDOPT	+= -DPERL_EXTERNAL_GLOB
+
+#
+# This should normally be disabled.  Enabling it causes perl to read scripts
+# in text mode (which is the 5.005 behavior) and will break ByteLoader.
+#
+#BUILDOPT	+= -DPERL_TEXTMODE_SCRIPTS
+
+#
+# specify semicolon-separated list of extra directories that modules will
+# look for libraries (spaces in path names need not be quoted)
+#
+EXTRALIBDIRS	*=
+
+#
+# set this to point to cmd.exe (only needed if you use some
+# alternate shell that doesn't grok cmd.exe style commands)
+#
+#SHELL		*= g:\winnt\system32\cmd.exe
+
+#
+# set this to your email address (perl will guess a value from
+# from your loginname and your hostname, which may not be right)
+#
+#EMAIL		*=
+
+##
+## Build configuration ends.
+##
+
+##################### CHANGE THESE ONLY IF YOU MUST #####################
+
+.IF "$(CRYPT_SRC)$(CRYPT_LIB)" == ""
+D_CRYPT		= undef
+.ELSE
+D_CRYPT		= define
+CRYPT_FLAG	= -DHAVE_DES_FCRYPT
+.ENDIF
+
+PERL_MALLOC	*= undef
+DEBUG_MSTATS	*= undef
+
+USE_SITECUST	*= undef
+USE_MULTI	*= undef
+USE_ITHREADS	*= undef
+USE_IMP_SYS	*= undef
+USE_PERLIO	*= undef
+USE_LARGE_FILES	*= undef
+USE_PERLCRT	*= undef
+
+.IF "$(USE_IMP_SYS)" == "define"
+PERL_MALLOC	= undef
+.ENDIF
+
+.IF "$(PERL_MALLOC)" == "undef"
+DEBUG_MSTATS	= undef
+.ENDIF
+
+.IF "$(DEBUG_MSTATS)" == "define"
+BUILDOPT	+= -DPERL_DEBUGGING_MSTATS
+.ENDIF
+
+.IF "$(USE_IMP_SYS) $(USE_MULTI)" == "define undef"
+USE_MULTI	!= define
+.ENDIF
+
+.IF "$(USE_ITHREADS) $(USE_MULTI)" == "define undef"
+USE_MULTI	!= define
+.ENDIF
+
+.IF "$(USE_SITECUST)" == "define"
+BUILDOPT	+= -DUSE_SITECUSTOMIZE
+.ENDIF
+
+.IF "$(USE_MULTI)" != "undef"
+BUILDOPT	+= -DPERL_IMPLICIT_CONTEXT
+.ENDIF
+
+.IF "$(USE_IMP_SYS)" != "undef"
+BUILDOPT	+= -DPERL_IMPLICIT_SYS
+.ENDIF
+
+.IMPORT .IGNORE : PROCESSOR_ARCHITECTURE PROCESSOR_ARCHITEW6432 WIN64
+
+PROCESSOR_ARCHITECTURE *= x86
+
+.IF "$(WIN64)" == ""
+# When we are running from a 32bit cmd.exe on AMD64 then
+# PROCESSOR_ARCHITECTURE is set to x86 and PROCESSOR_ARCHITEW6432
+# is set to AMD64
+.IF "$(PROCESSOR_ARCHITEW6432)" != ""
+PROCESSOR_ARCHITECTURE	!= $(PROCESSOR_ARCHITEW6432)
+WIN64			= define
+.ELIF "$(PROCESSOR_ARCHITECTURE)" == "AMD64" || "$(PROCESSOR_ARCHITECTURE)" == "IA64"
+WIN64			= define
+.ELSE
+WIN64			= undef
+.ENDIF
+.ENDIF
+
+ARCHITECTURE = $(PROCESSOR_ARCHITECTURE)
+.IF "$(ARCHITECTURE)" == "AMD64"
+ARCHITECTURE	= x64
+.ENDIF
+.IF "$(ARCHITECTURE)" == "IA64"
+ARCHITECTURE	= ia64
+.ENDIF
+
+.IF "$(USE_MULTI)" == "define"
+ARCHNAME	= MSWin32-$(ARCHITECTURE)-multi
+.ELSE
+.IF "$(USE_PERLIO)" == "define"
+ARCHNAME	= MSWin32-$(ARCHITECTURE)-perlio
+.ELSE
+ARCHNAME	= MSWin32-$(ARCHITECTURE)
+.ENDIF
+.ENDIF
+
+.IF "$(USE_ITHREADS)" == "define"
+ARCHNAME	!:= $(ARCHNAME)-thread
+.ENDIF
+
+# Visual C++ 98, .NET 2003, 2005 and 2008 specific.
+# VC++ 6.x, 7.x, 8.x and 9.x can load DLL's on demand.  Makes the test suite run
+# in about 10% less time.  (The free version of 7.x can't do this, but the free
+# versions of 8.x and 9.x can.)
+.IF "$(CCTYPE)" == "MSVC60" || "$(CCTYPE)" == "MSVC70"     || \
+    "$(CCTYPE)" == "MSVC80" || "$(CCTYPE)" == "MSVC80FREE" ||
+    "$(CCTYPE)" == "MSVC90" || "$(CCTYPE)" == "MSVC90FREE"
+DELAYLOAD	*= -DELAYLOAD:ws2_32.dll delayimp.lib
+.ENDIF
+
+# Visual C++ 2005 and 2008 (VC++ 8.x and 9.x) create manifest files for EXEs and
+# DLLs. These either need copying everywhere with the binaries, or else need
+# embedding in them otherwise MSVCR80.dll or MSVCR90.dll won't be found. For
+# simplicity, embed them if they exist (and delete them afterwards so that they
+# don't get installed too).
+EMBED_EXE_MANI	= if exist $@.manifest mt -nologo -manifest $@.manifest -outputresource:$@;1 && \
+		  if exist $@.manifest del $@.manifest
+EMBED_DLL_MANI	= if exist $@.manifest mt -nologo -manifest $@.manifest -outputresource:$@;2 && \
+		  if exist $@.manifest del $@.manifest
+
+ARCHDIR		= ..\lib\$(ARCHNAME)
+COREDIR		= ..\lib\CORE
+AUTODIR		= ..\lib\auto
+LIBDIR		= ..\lib
+EXTDIR		= ..\ext
+DISTDIR		= ..\dist
+CPANDIR		= ..\cpan
+PODDIR		= ..\pod
+EXTUTILSDIR	= $(LIBDIR)\ExtUtils
+HTMLDIR		= .\html
+
+#
+INST_SCRIPT	= $(INST_TOP)$(INST_VER)\bin
+INST_BIN	= $(INST_SCRIPT)$(INST_ARCH)
+INST_LIB	= $(INST_TOP)$(INST_VER)\lib
+INST_ARCHLIB	= $(INST_LIB)$(INST_ARCH)
+INST_COREDIR	= $(INST_ARCHLIB)\CORE
+INST_HTML	= $(INST_TOP)$(INST_VER)\html
+
+#
+# Programs to compile, build .lib files and link
+#
+
+.USESHELL :
+
+.IF "$(CCTYPE)" == "BORLAND"
+
+CC		= bcc32
+.IF "$(BCCOLD)" != "define"
+LINK32		= ilink32
+.ELSE
+LINK32		= tlink32
+.ENDIF
+LIB32		= tlib /a /P128
+IMPLIB		= implib -c
+RSC		= brcc32
+
+#
+# Options
+#
+INCLUDES	= -I$(COREDIR) -I.\include -I. -I.. -I"$(CCINCDIR)"
+#PCHFLAGS	= -H -Hc -H=c:\temp\bcmoduls.pch
+DEFINES		= -DWIN32 $(CRYPT_FLAG)
+LOCDEFS		= -DPERLDLL -DPERL_CORE
+SUBSYS		= console
+CXX_FLAG	= -P
+
+LIBC		= cw32mti.lib
+
+# same libs as MSVC, except Borland doesn't have oldnames.lib
+LIBFILES	= $(CRYPT_LIB) \
+		kernel32.lib user32.lib gdi32.lib winspool.lib \
+		comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib \
+		netapi32.lib uuid.lib ws2_32.lib mpr.lib winmm.lib \
+		version.lib odbc32.lib odbccp32.lib comctl32.lib \
+		import32.lib $(LIBC)
+
+.IF  "$(CFG)" == "Debug"
+OPTIMIZE	= -v -D_RTLDLL -DDEBUGGING
+LINK_DBG	= -v
+.ELSE
+OPTIMIZE	= -O2 -D_RTLDLL
+LINK_DBG	=
+.ENDIF
+
+EXTRACFLAGS	=
+CFLAGS		= -w -g0 -tWM -tWD $(INCLUDES) $(DEFINES) $(LOCDEFS) \
+		$(PCHFLAGS) $(OPTIMIZE)
+LINK_FLAGS	= $(LINK_DBG) -x -L"$(INST_COREDIR)" -L"$(CCLIBDIR)" \
+		-L"$(CCLIBDIR)\PSDK"
+OBJOUT_FLAG	= -o
+EXEOUT_FLAG	= -e
+LIBOUT_FLAG	=
+.IF "$(BCCOLD)" != "define"
+LINK_FLAGS	+= -Gn
+DEFINES  += -D_MT -D__USELOCALES__ -D_WIN32_WINNT=0x0410
+.END
+.IF "$(BCCVCL)" == "define"
+LIBC		= cp32mti.lib vcl.lib vcl50.lib vclx50.lib vcle50.lib
+LINK_FLAGS	+= -L"$(CCLIBDIR)\Release"
+.END
+
+
+.ELIF "$(CCTYPE)" == "GCC"
+
+.IF "$(GCCCROSS)" == "define"
+ARCHPREFIX      = x86_64-w64-mingw32-
+.ENDIF
+
+CC		= $(ARCHPREFIX)gcc
+LINK32		= $(ARCHPREFIX)g++
+LIB32		= $(ARCHPREFIX)ar rc
+IMPLIB		= $(ARCHPREFIX)dlltool
+RSC		= $(ARCHPREFIX)windres
+
+i = .i
+o = .o
+a = .a
+
+#
+# Options
+#
+
+INCLUDES	= -I.\include -I. -I.. -I$(COREDIR)
+DEFINES		= -DWIN32 $(CRYPT_FLAG)
+.IF "$(WIN64)" == "define"
+DEFINES		+= -DWIN64 -DCONSERVATIVE
+.ENDIF
+LOCDEFS		= -DPERLDLL -DPERL_CORE
+SUBSYS		= console
+CXX_FLAG	= -xc++
+
+# Current releases of MinGW 5.1.4 (as of 11-Aug-2009) will fail to link
+# correctly if -lmsvcrt is specified explicitly.
+LIBC		=
+#LIBC		= -lmsvcrt
+
+# same libs as MSVC
+LIBFILES	= $(CRYPT_LIB) $(LIBC) \
+		  -lmoldname -lkernel32 -luser32 -lgdi32 \
+		  -lwinspool -lcomdlg32 -ladvapi32 -lshell32 -lole32 \
+		  -loleaut32 -lnetapi32 -luuid -lws2_32 -lmpr \
+		  -lwinmm -lversion -lodbc32 -lodbccp32 -lcomctl32
+
+.IF  "$(CFG)" == "Debug"
+OPTIMIZE	= -g -O2 -DDEBUGGING
+LINK_DBG	= -g
+.ELSE
+OPTIMIZE	= -s -O2
+LINK_DBG	= -s
+.ENDIF
+
+EXTRACFLAGS	=
+CFLAGS		= $(INCLUDES) $(DEFINES) $(LOCDEFS) $(OPTIMIZE)
+LINK_FLAGS	= $(LINK_DBG) -L"$(INST_COREDIR)" -L"$(CCLIBDIR)"
+OBJOUT_FLAG	= -o
+EXEOUT_FLAG	= -o
+LIBOUT_FLAG	=
+
+# NOTE: we assume that GCC uses MSVCRT.DLL
+# See comments about PERL_MSVCRT_READFIX in the "cl" compiler section below.
+BUILDOPT	+= -fno-strict-aliasing -mms-bitfields -DPERL_MSVCRT_READFIX
+
+.ELSE
+
+CC		= cl
+LINK32		= link
+LIB32		= $(LINK32) -lib
+RSC		= rc
+
+#
+# Options
+#
+
+INCLUDES	= -I$(COREDIR) -I.\include -I. -I..
+#PCHFLAGS	= -Fpc:\temp\vcmoduls.pch -YX
+DEFINES		= -DWIN32 -D_CONSOLE -DNO_STRICT $(CRYPT_FLAG)
+LOCDEFS		= -DPERLDLL -DPERL_CORE
+SUBSYS		= console
+CXX_FLAG	= -TP -EHsc
+
+.IF "$(USE_PERLCRT)" != "define"
+LIBC	= msvcrt.lib
+.ELSE
+LIBC	= PerlCRT.lib
+.ENDIF
+
+.IF  "$(CFG)" == "Debug"
+.IF "$(CCTYPE)" == "MSVC20"
+OPTIMIZE	= -Od -MD -Z7 -DDEBUGGING
+.ELSE
+OPTIMIZE	= -O1 -MD -Zi -DDEBUGGING
+.ENDIF
+LINK_DBG	= -debug
+.ELSE
+OPTIMIZE	= -MD -Zi -DNDEBUG
+# we enable debug symbols in release builds also
+LINK_DBG	= -debug -opt:ref,icf
+# you may want to enable this if you want COFF symbols in the executables
+# in addition to the PDB symbols.  The default Dr. Watson that ships with
+# Windows can use the the former but not latter.  The free WinDbg can be
+# installed to get better stack traces from just the PDB symbols, so we
+# avoid the bloat of COFF symbols by default.
+#LINK_DBG	= $(LINK_DBG) -debugtype:both
+.IF "$(WIN64)" == "define"
+# enable Whole Program Optimizations (WPO) and Link Time Code Generation (LTCG)
+OPTIMIZE	+= -Ox -GL
+LINK_DBG	+= -ltcg
+.ELSE
+# -O1 yields smaller code, which turns out to be faster than -O2 on x86
+OPTIMIZE	+= -O1
+#OPTIMIZE	+= -O2
+.ENDIF
+.ENDIF
+
+.IF "$(WIN64)" == "define"
+DEFINES		+= -DWIN64 -DCONSERVATIVE
+OPTIMIZE	+= -Wp64 -fp:precise
+.ENDIF
+
+# For now, silence VC++ 8.x's and 9.x's warnings about "unsafe" CRT functions
+# and POSIX CRT function names being deprecated.
+.IF "$(CCTYPE)" == "MSVC80" || "$(CCTYPE)" == "MSVC80FREE" || \
+    "$(CCTYPE)" == "MSVC90" || "$(CCTYPE)" == "MSVC90FREE"
+DEFINES		+= -D_CRT_SECURE_NO_DEPRECATE -D_CRT_NONSTDC_NO_DEPRECATE
+.ENDIF
+
+# Use the MSVCRT read() fix if the PerlCRT was not chosen, but only when using
+# VC++ 6.x or earlier. Later versions use MSVCR70.dll, MSVCR71.dll, etc, which
+# do not require the fix.
+.IF "$(CCTYPE)" == "MSVC20" || "$(CCTYPE)" == "MSVC" || "$(CCTYPE)" == "MSVC60" 
+.IF "$(USE_PERLCRT)" != "define"
+BUILDOPT	+= -DPERL_MSVCRT_READFIX
+.ENDIF
+.ENDIF
+
+LIBBASEFILES	= $(CRYPT_LIB) \
+		oldnames.lib kernel32.lib user32.lib gdi32.lib winspool.lib \
+		comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib \
+		netapi32.lib uuid.lib ws2_32.lib mpr.lib winmm.lib \
+		version.lib odbc32.lib odbccp32.lib comctl32.lib
+
+# The 64 bit Platform SDK compilers contain a runtime library that doesn't
+# include the buffer overrun verification code used by the /GS switch.
+# Since the code links against libraries that are compiled with /GS, this
+# "security cookie verification" must be included via bufferoverlow.lib.
+.IF "$(WIN64)" == "define"
+LIBBASEFILES    += bufferoverflowU.lib
+.ENDIF
+
+# we add LIBC here, since we may be using PerlCRT.dll
+LIBFILES	= $(LIBBASEFILES) $(LIBC)
+
+EXTRACFLAGS	= -nologo -GF -W3
+CFLAGS		= $(EXTRACFLAGS) $(INCLUDES) $(DEFINES) $(LOCDEFS) \
+		$(PCHFLAGS) $(OPTIMIZE)
+LINK_FLAGS	= -nologo -nodefaultlib $(LINK_DBG) \
+		-libpath:"$(INST_COREDIR)" \
+		-machine:$(PROCESSOR_ARCHITECTURE)
+LIB_FLAGS	= -nologo
+OBJOUT_FLAG	= -Fo
+EXEOUT_FLAG	= -Fe
+LIBOUT_FLAG	= /out:
+
+.ENDIF
+
+CFLAGS_O	= $(CFLAGS) $(BUILDOPT)
+
+.IF "$(CCTYPE)" == "MSVC80" || "$(CCTYPE)" == "MSVC80FREE" || \
+    "$(CCTYPE)" == "MSVC90" || "$(CCTYPE)" == "MSVC90FREE"
+LINK_FLAGS	+= "/manifestdependency:type='Win32' name='Microsoft.Windows.Common-Controls' version='6.0.0.0' processorArchitecture='*' publicKeyToken='6595b64144ccf1df' language='*'"
+.ELSE
+RSC_FLAGS	= -DINCLUDE_MANIFEST
+.ENDIF
+
+
+# used to allow local linking flags that are not propogated into Config.pm,
+# currently unused
+#   -- BKS, 12-12-1999
+PRIV_LINK_FLAGS	*=
+BLINK_FLAGS	= $(PRIV_LINK_FLAGS) $(LINK_FLAGS)
+
+#################### do not edit below this line #######################
+############# NO USER-SERVICEABLE PARTS BEYOND THIS POINT ##############
+
+# Some old dmakes (including Sarathy's one at
+# http://search.cpan.org/CPAN/authors/id/G/GS/GSAR/dmake-4.1pl1-win32.zip)
+# don't support logical OR (||) or logical AND (&&) in conditional
+# expressions and hence don't process this makefile correctly. Determine
+# whether this is the case so that we can give the user an error message.
+.IF 1 == 1 || 1 == 1
+NEWDMAKE = define
+.ELSE
+NEWDMAKE = undef
+.ENDIF
+
+o *= .obj
+a *= .lib
+
+LKPRE		= INPUT (
+LKPOST		= )
+
+#
+# Rules
+#
+
+.SUFFIXES : .c .i $(o) .dll $(a) .exe .rc .res
+
+.c$(o):
+	$(CC) -c $(null,$(<:d) $(NULL) -I$(<:d)) $(CFLAGS_O) $(OBJOUT_FLAG)$@ $<
+
+.c.i:
+	$(CC) -c $(null,$(<:d) $(NULL) -I$(<:d)) $(CFLAGS_O) -E $< >$@
+
+.y.c:
+	$(NOOP)
+
+$(o).dll:
+.IF "$(CCTYPE)" == "BORLAND"
+	$(LINK32) -Tpd -ap $(BLINK_FLAGS) c0d32$(o) $<,$@,,$(LIBFILES),$(*B).def
+	$(IMPLIB) $(*B).lib $@
+.ELIF "$(CCTYPE)" == "GCC"
+	$(LINK32) -o $@ $(BLINK_FLAGS) $< $(LIBFILES)
+	$(IMPLIB) --input-def $(*B).def --output-lib $(*B).a $@
+.ELSE
+	$(LINK32) -dll -subsystem:windows -implib:$(*B).lib -def:$(*B).def \
+	    -out:$@ $(BLINK_FLAGS) $(LIBFILES) $< $(LIBPERL)
+	$(EMBED_DLL_MANI)
+.ENDIF
+
+.rc.res:
+.IF "$(CCTYPE)" == "GCC"
+	$(RSC) --use-temp-file --include-dir=. --include-dir=.. -O COFF -D INCLUDE_MANIFEST -i $< -o $@
+.ELSE
+	$(RSC) -i.. -DINCLUDE_MANIFEST $<
+.ENDIF
+
+#
+# various targets
+MINIPERL	= ..\miniperl.exe
+MINIDIR		= .\mini
+PERLEXE		= ..\perl.exe
+WPERLEXE	= ..\wperl.exe
+PERLEXESTATIC	= ..\perl-static.exe
+GLOBEXE		= ..\perlglob.exe
+CONFIGPM	= ..\lib\Config.pm ..\lib\Config_heavy.pl
+MINIMOD		= ..\lib\ExtUtils\Miniperl.pm
+X2P		= ..\x2p\a2p.exe
+GENUUDMAP	= ..\generate_uudmap.exe
+.IF "$(BUILD_STATIC)" == "define"
+PERLSTATIC	= static
+.ELSE
+PERLSTATIC	= 
+.ENDIF
+
+# Unicode data files generated by mktables
+UNIDATAFILES	 = ..\lib\unicore\Decomposition.pl ..\lib\unicore\TestProp.pl \
+		   ..\lib\unicore\CombiningClass.pl ..\lib\unicore\Name.pl \
+		   ..\lib\unicore\Heavy.pl ..\lib\unicore\mktables.lst
+
+# Directories of Unicode data files generated by mktables
+UNIDATADIR1	= ..\lib\unicore\To
+UNIDATADIR2	= ..\lib\unicore\lib
+
+PERLEXE_MANIFEST= .\perlexe.manifest
+PERLEXE_ICO	= .\perlexe.ico
+PERLEXE_RES	= .\perlexe.res
+PERLDLL_RES	=
+
+# Nominate a target which causes extensions to be re-built
+# This used to be $(PERLEXE), but at worst it is the .dll that they depend
+# on and really only the interface - i.e. the .def file used to export symbols
+# from the .dll
+PERLDEP = perldll.def
+
+
+PL2BAT		= bin\pl2bat.pl
+GLOBBAT		= bin\perlglob.bat
+
+UTILS		=			\
+		..\utils\h2ph		\
+		..\utils\splain		\
+		..\utils\dprofpp	\
+		..\utils\perlbug	\
+		..\utils\pl2pm 		\
+		..\utils\c2ph		\
+		..\utils\pstruct	\
+		..\utils\h2xs		\
+		..\utils\perldoc	\
+		..\utils\perlivp	\
+		..\utils\libnetcfg	\
+		..\utils\enc2xs		\
+		..\utils\piconv		\
+		..\utils\config_data	\
+		..\utils\corelist	\
+		..\utils\cpan		\
+		..\utils\xsubpp		\
+		..\utils\prove		\
+		..\utils\ptar		\
+		..\utils\ptardiff	\
+		..\utils\cpanp-run-perl	\
+		..\utils\cpanp	\
+		..\utils\cpan2dist	\
+		..\utils\shasum		\
+		..\utils\instmodsh	\
+		..\pod\pod2html		\
+		..\pod\pod2latex	\
+		..\pod\pod2man		\
+		..\pod\pod2text		\
+		..\pod\pod2usage	\
+		..\pod\podchecker	\
+		..\pod\podselect	\
+		..\x2p\find2perl	\
+		..\x2p\psed		\
+		..\x2p\s2p		\
+		bin\exetype.pl		\
+		bin\runperl.pl		\
+		bin\pl2bat.pl		\
+		bin\perlglob.pl		\
+		bin\search.pl
+
+.IF "$(CCTYPE)" == "BORLAND"
+
+CFGSH_TMPL	= config.bc
+CFGH_TMPL	= config_H.bc
+
+.ELIF "$(CCTYPE)" == "GCC"
+
+.IF "$(WIN64)" == "define"
+.IF "$(GCCCROSS)" == "define"
+CFGSH_TMPL	= config.gc64
+CFGH_TMPL	= config_H.gc64
+.ELSE
+CFGSH_TMPL	= config.gc64nox
+CFGH_TMPL	= config_H.gc64nox
+.ENDIF
+.ELSE
+CFGSH_TMPL	= config.gc
+CFGH_TMPL	= config_H.gc
+.ENDIF
+PERLIMPLIB	= ..\libperl512$(a)
+PERLSTATICLIB	= ..\libperl512s$(a)
+
+.ELSE
+
+.IF "$(WIN64)" == "define"
+CFGSH_TMPL	= config.vc64
+CFGH_TMPL	= config_H.vc64
+.ELSE
+CFGSH_TMPL	= config.vc
+CFGH_TMPL	= config_H.vc
+.ENDIF
+
+.ENDIF
+
+# makedef.pl must be updated if this changes, and this should normally
+# only change when there is an incompatible revision of the public API.
+PERLIMPLIB	*= ..\perl512$(a)
+PERLSTATICLIB	*= ..\perl512s$(a)
+PERLDLL		= ..\perl512.dll
+
+XCOPY		= xcopy /f /r /i /d /y
+RCOPY		= xcopy /f /r /i /e /d /y
+NOOP		= @rem
+
+MICROCORE_SRC	=		\
+		..\av.c		\
+		..\deb.c	\
+		..\doio.c	\
+		..\doop.c	\
+		..\dump.c	\
+		..\globals.c	\
+		..\gv.c		\
+		..\mro.c	\
+		..\hv.c		\
+		..\locale.c	\
+		..\mathoms.c    \
+		..\mg.c		\
+		..\numeric.c	\
+		..\op.c		\
+		..\pad.c	\
+		..\perl.c	\
+		..\perlapi.c	\
+		..\perly.c	\
+		..\pp.c		\
+		..\pp_ctl.c	\
+		..\pp_hot.c	\
+		..\pp_pack.c	\
+		..\pp_sort.c	\
+		..\pp_sys.c	\
+		..\reentr.c	\
+		..\regcomp.c	\
+		..\regexec.c	\
+		..\run.c	\
+		..\scope.c	\
+		..\sv.c		\
+		..\taint.c	\
+		..\toke.c	\
+		..\universal.c	\
+		..\utf8.c	\
+		..\util.c
+
+EXTRACORE_SRC	+= perllib.c
+
+.IF "$(PERL_MALLOC)" == "define"
+EXTRACORE_SRC	+= ..\malloc.c
+.ENDIF
+
+EXTRACORE_SRC	+= ..\perlio.c
+
+WIN32_SRC	=		\
+		.\win32.c	\
+		.\win32sck.c	\
+		.\win32thread.c
+
+# We need this for miniperl build unless we override canned 
+# config.h #define building mini\*
+#.IF "$(USE_PERLIO)" == "define"
+WIN32_SRC	+= .\win32io.c
+#.ENDIF
+
+.IF "$(CRYPT_SRC)" != ""
+WIN32_SRC	+= .\$(CRYPT_SRC)
+.ENDIF
+
+X2P_SRC		=		\
+		..\x2p\a2p.c	\
+		..\x2p\hash.c	\
+		..\x2p\str.c	\
+		..\x2p\util.c	\
+		..\x2p\walk.c
+
+CORE_NOCFG_H	=		\
+		..\av.h		\
+		..\cop.h	\
+		..\cv.h		\
+		..\dosish.h	\
+		..\embed.h	\
+		..\form.h	\
+		..\gv.h		\
+		..\handy.h	\
+		..\hv.h		\
+		..\iperlsys.h	\
+		..\mg.h		\
+		..\nostdio.h	\
+		..\op.h		\
+		..\opcode.h	\
+		..\perl.h	\
+		..\perlapi.h	\
+		..\perlsdio.h	\
+		..\perlsfio.h	\
+		..\perly.h	\
+		..\pp.h		\
+		..\proto.h	\
+		..\regcomp.h	\
+		..\regexp.h	\
+		..\scope.h	\
+		..\sv.h		\
+		..\thread.h	\
+		..\unixish.h	\
+		..\utf8.h	\
+		..\util.h	\
+		..\warnings.h	\
+		..\XSUB.h	\
+		..\EXTERN.h	\
+		..\perlvars.h	\
+		..\intrpvar.h	\
+		.\include\dirent.h	\
+		.\include\netdb.h	\
+		.\include\sys\socket.h	\
+		.\win32.h
+
+CORE_H		= $(CORE_NOCFG_H) .\config.h ..\git_version.h
+
+UUDMAP_H	= ..\uudmap.h
+BITCOUNT_H	= ..\bitcount.h
+
+MICROCORE_OBJ	= $(MICROCORE_SRC:db:+$(o))
+CORE_OBJ	= $(MICROCORE_OBJ) $(EXTRACORE_SRC:db:+$(o))
+WIN32_OBJ	= $(WIN32_SRC:db:+$(o))
+MINICORE_OBJ	= $(MINIDIR)\{$(MICROCORE_OBJ:f) miniperlmain$(o) perlio$(o)}
+MINIWIN32_OBJ	= $(MINIDIR)\{$(WIN32_OBJ:f)}
+MINI_OBJ	= $(MINICORE_OBJ) $(MINIWIN32_OBJ)
+DLL_OBJ		= $(DYNALOADER)
+X2P_OBJ		= $(X2P_SRC:db:+$(o))
+GENUUDMAP_OBJ	= $(GENUUDMAP:db:+$(o))
+
+PERLDLL_OBJ	= $(CORE_OBJ)
+PERLEXE_OBJ	= perlmain$(o)
+PERLEXEST_OBJ	= perlmainst$(o)
+
+PERLDLL_OBJ	+= $(WIN32_OBJ) $(DLL_OBJ)
+
+.IF "$(USE_SETARGV)" != ""
+SETARGV_OBJ	= setargv$(o)
+.ENDIF
+
+.IF "$(ALL_STATIC)" == "define"
+# some exclusions, unfortunately, until fixed:
+#  - Win32 extension contains overlapped symbols with win32.c (BUG!)
+#  - MakeMaker isn't capable enough for SDBM_File (smaller bug)
+#  - Encode (encoding search algorithm relies on shared library?)
+STATIC_EXT	= * !Win32 !SDBM_File !Encode
+.ELSE
+# specify static extensions here, for example:
+#STATIC_EXT	= Cwd Compress/Raw/Zlib
+STATIC_EXT	= Win32CORE
+.ENDIF
+
+DYNALOADER	= ..\DynaLoader$(o)
+
+# vars must be separated by "\t+~\t+", since we're using the tempfile
+# version of config_sh.pl (we were overflowing someone's buffer by
+# trying to fit them all on the command line)
+#	-- BKS 10-17-1999
+CFG_VARS	=					\
+		INST_DRV=$(INST_DRV)		~	\
+		INST_TOP=$(INST_TOP)	~	\
+		INST_VER=$(INST_VER)	~	\
+		INST_ARCH=$(INST_ARCH)		~	\
+		archname=$(ARCHNAME)		~	\
+		cc=$(CC)			~	\
+		ld=$(LINK32)			~	\
+		ccflags=$(EXTRACFLAGS) $(OPTIMIZE) $(DEFINES) $(BUILDOPT)	~	\
+		cf_email=$(EMAIL)		~	\
+		d_crypt=$(D_CRYPT)		~	\
+		d_mymalloc=$(PERL_MALLOC)	~	\
+		libs=$(LIBFILES:f)		~	\
+		incpath=$(CCINCDIR)	~	\
+		libperl=$(PERLIMPLIB:f)		~	\
+		libpth=$(CCLIBDIR);$(EXTRALIBDIRS)	~	\
+		libc=$(LIBC)			~	\
+		make=dmake			~	\
+		_o=$(o)				~	\
+		obj_ext=$(o)			~	\
+		_a=$(a)				~	\
+		lib_ext=$(a)			~	\
+		static_ext=$(STATIC_EXT)	~	\
+		usethreads=$(USE_ITHREADS)	~	\
+		useithreads=$(USE_ITHREADS)	~	\
+		usemultiplicity=$(USE_MULTI)	~	\
+		useperlio=$(USE_PERLIO)		~	\
+		uselargefiles=$(USE_LARGE_FILES)	~	\
+		usesitecustomize=$(USE_SITECUST)	~	\
+		LINK_FLAGS=$(LINK_FLAGS)	~	\
+		optimize=$(OPTIMIZE)
+
+#
+# set up targets varying between Win95 and WinNT builds
+#
+
+.IF "$(IS_WIN95)" == "define"
+MK2 		= .\makefile.95
+RIGHTMAKE	= __switch_makefiles
+.ELSE
+MK2		= __not_needed
+RIGHTMAKE	=
+.ENDIF
+
+.IMPORT .IGNORE : SystemRoot windir
+
+# Don't just .IMPORT OS from the environment because dmake sets OS itself.
+ENV_OS=$(subst,OS=, $(shell @set OS))
+
+.IF "$(ENV_OS)" == "Windows_NT"
+ODBCCP32_DLL = $(SystemRoot)\system32\odbccp32.dll
+.ELSE
+ODBCCP32_DLL = $(windir)\system\odbccp32.dll
+.ENDIF
+
+ICWD = -I..\cpan\Cwd -I..\cpan\Cwd\lib
+
+#
+# Top targets
+#
+
+all : CHECKDMAKE .\config.h ..\git_version.h $(GLOBEXE) $(MINIPERL) $(MK2)	\
+	$(RIGHTMAKE) $(MINIMOD) $(CONFIGPM) $(UNIDATAFILES) MakePPPort		\
+	$(PERLEXE) $(X2P) Extensions Extensions_nonxs $(PERLSTATIC)
+
+regnodes : ..\regnodes.h
+
+..\regcomp$(o) : ..\regnodes.h ..\regcharclass.h	
+
+..\regexec$(o) : ..\regnodes.h ..\regcharclass.h
+
+reonly : regnodes .\config.h ..\git_version.h $(GLOBEXE) $(MINIPERL) $(MK2)	\
+	$(RIGHTMAKE) $(MINIMOD) $(CONFIGPM) $(UNIDATAFILES) $(PERLEXE)		\
+	$(X2P) Extensions_reonly
+
+static: $(PERLEXESTATIC)
+
+#----------------------------------------------------------------
+
+#-------------------- BEGIN Win95 SPECIFIC ----------------------
+
+# this target is a jump-off point for Win95
+#  1. it switches to the Win95-specific makefile if it exists
+#     (__do_switch_makefiles)
+#  2. it prints a message when the Win95-specific one finishes (__done)
+#  3. it then kills this makefile by trying to make __no_such_target
+
+__switch_makefiles: __do_switch_makefiles __done __no_such_target
+
+__do_switch_makefiles:
+.IF "$(NOTFIRST)" != "true"
+	if exist $(MK2) $(MAKE:s/-S//) -f $(MK2) $(MAKETARGETS) NOTFIRST=true
+.ELSE
+	$(NOOP)
+.ENDIF
+
+.IF "$(NOTFIRST)" != "true"
+__done:
+	@echo Build process complete. Ignore any errors after this message.
+	@echo Run "dmake test" to test and "dmake install" to install
+
+.ELSE
+# dummy targets for Win95-specific makefile
+
+__done:
+	$(NOOP)
+
+__no_such_target:
+	$(NOOP)
+
+.ENDIF
+
+# This target is used to generate the new makefile (.\makefile.95) for Win95
+
+.\makefile.95: .\makefile.mk
+	$(MINIPERL) genmk95.pl makefile.mk $(MK2)
+
+#--------------------- END Win95 SPECIFIC ---------------------
+
+# a blank target for when builds don't need to do certain things
+# this target added for Win95 port but used to keep the WinNT port able to
+# use this file
+__not_needed:
+	$(NOOP)
+
+CHECKDMAKE :
+.IF "$(NEWDMAKE)" == "define"
+	$(NOOP)
+.ELSE
+	@echo Your dmake doesn't support ^|^| or ^&^& in conditional expressions.
+	@echo Please get the latest dmake from http://search.cpan.org/dist/dmake/
+	@exit 1
+.ENDIF
+
+$(GLOBEXE) : perlglob$(o)
+.IF "$(CCTYPE)" == "BORLAND"
+	$(CC) -c -w -v -tWM -I"$(CCINCDIR)" perlglob.c
+	$(LINK32) -Tpe -ap $(BLINK_FLAGS) c0x32$(o) perlglob$(o) \
+	    "$(CCLIBDIR)\32BIT\wildargs$(o)",$@,,import32.lib cw32mt.lib,
+.ELIF "$(CCTYPE)" == "GCC"
+	$(LINK32) $(BLINK_FLAGS) -mconsole -o $@ perlglob$(o) $(LIBFILES)
+.ELSE
+	$(LINK32) $(BLINK_FLAGS) $(LIBFILES) -out:$@ -subsystem:$(SUBSYS) \
+	    perlglob$(o) setargv$(o)
+	$(EMBED_EXE_MANI)
+.ENDIF
+
+perlglob$(o)  : perlglob.c
+
+config.w32 : $(CFGSH_TMPL)
+	copy $(CFGSH_TMPL) config.w32
+
+.\config.h : $(CFGH_TMPL) $(CORE_NOCFG_H)
+	-del /f config.h
+	copy $(CFGH_TMPL) config.h
+
+..\git_version.h : $(MINIPERL) ..\make_patchnum.pl
+	cd .. && miniperl -Ilib make_patchnum.pl
+
+# make sure that we recompile perl.c if the git version changes
+..\perl$(o) : ..\git_version.h
+
+..\config.sh : config.w32 $(MINIPERL) config_sh.PL FindExt.pm
+	$(MINIPERL) -I..\lib config_sh.PL --cfgsh-option-file \
+	    $(mktmp $(CFG_VARS)) config.w32 > ..\config.sh
+
+# this target is for when changes to the main config.sh happen.
+# edit config.gc, then make perl using GCC in a minimal configuration (i.e.
+# with MULTI, ITHREADS, IMP_SYS, LARGE_FILES, PERLIO and CRYPT off), then make
+# this target to regenerate config_H.gc.
+# unfortunately, some further manual editing is also then required to restore all
+# the special _MSC_VER handling that is otherwise lost.
+# repeat for config.bc and config_H.bc (using BORLAND), except that there is no
+# _MSC_VER stuff in that case.
+regen_config_h:
+	$(MINIPERL) -I..\lib config_sh.PL --cfgsh-option-file $(mktmp $(CFG_VARS)) \
+	    $(CFGSH_TMPL) > ..\config.sh
+	$(MINIPERL) -I..\lib ..\configpm --chdir=..
+	-del /f $(CFGH_TMPL)
+	-$(MINIPERL) -I..\lib $(ICWD) config_h.PL "INST_VER=$(INST_VER)"
+	rename config.h $(CFGH_TMPL)
+
+$(CONFIGPM) : $(MINIPERL) ..\config.sh config_h.PL ..\minimod.pl
+	$(MINIPERL) -I..\lib ..\configpm --chdir=..
+	if exist lib\* $(RCOPY) lib\*.* ..\lib\$(NULL)
+	$(XCOPY) ..\*.h $(COREDIR)\*.*
+	$(XCOPY) *.h $(COREDIR)\*.*
+	$(XCOPY) ..\ext\re\re.pm $(LIBDIR)\*.*
+	$(RCOPY) include $(COREDIR)\*.*
+	$(MINIPERL) -I..\lib $(ICWD) config_h.PL "INST_VER=$(INST_VER)" \
+	    || $(MAKE) $(MAKEMACROS) $(CONFIGPM) $(MAKEFILE)
+
+$(MINIPERL) : $(MINIDIR) $(MINI_OBJ) $(CRTIPMLIBS)
+.IF "$(CCTYPE)" == "BORLAND"
+	if not exist $(CCLIBDIR)\PSDK\odbccp32.lib \
+	    cd $(CCLIBDIR)\PSDK && implib odbccp32.lib $(ODBCCP32_DLL)
+	$(LINK32) -Tpe -ap $(BLINK_FLAGS) \
+	    @$(mktmp c0x32$(o) $(MINI_OBJ),$@,,$(LIBFILES),)
+.ELIF "$(CCTYPE)" == "GCC"
+	$(LINK32) -v -mconsole -o $@ $(BLINK_FLAGS) \
+	    $(mktmp $(LKPRE) $(MINI_OBJ) $(LIBFILES) $(LKPOST))
+.ELSE
+	$(LINK32) -subsystem:console -out:$@ $(BLINK_FLAGS) \
+	    @$(mktmp $(LIBFILES) $(MINI_OBJ))
+	$(EMBED_EXE_MANI)
+.ENDIF
+
+$(MINIDIR) :
+	if not exist "$(MINIDIR)" mkdir "$(MINIDIR)"
+
+$(MINICORE_OBJ) : $(CORE_NOCFG_H)
+	$(CC) -c $(CFLAGS) -DPERL_EXTERNAL_GLOB -DPERL_IS_MINIPERL $(OBJOUT_FLAG)$@ ..\$(*B).c
+
+$(MINIWIN32_OBJ) : $(CORE_NOCFG_H)
+	$(CC) -c $(CFLAGS) $(OBJOUT_FLAG)$@ $(*B).c
+
+# -DPERL_IMPLICIT_SYS needs C++ for perllib.c
+# rules wrapped in .IFs break Win9X build (we end up with unbalanced []s unless
+# unless the .IF is true), so instead we use a .ELSE with the default.
+# This is the only file that depends on perlhost.h, vmem.h, and vdir.h
+
+perllib$(o)	: perllib.c .\perlhost.h .\vdir.h .\vmem.h
+.IF "$(USE_IMP_SYS)" == "define"
+	$(CC) -c -I. $(CFLAGS_O) $(CXX_FLAG) $(OBJOUT_FLAG)$@ perllib.c
+.ELSE
+	$(CC) -c -I. $(CFLAGS_O) $(OBJOUT_FLAG)$@ perllib.c
+.ENDIF
+
+# 1. we don't want to rebuild miniperl.exe when config.h changes
+# 2. we don't want to rebuild miniperl.exe with non-default config.h
+# 3. we can't have miniperl.exe depend on git_version.h, as miniperl creates it
+$(MINI_OBJ)	: $(CORE_NOCFG_H)
+
+$(WIN32_OBJ)	: $(CORE_H)
+
+$(CORE_OBJ)	: $(CORE_H)
+
+$(DLL_OBJ)	: $(CORE_H)
+
+$(X2P_OBJ)	: $(CORE_H)
+
+perldll.def : $(MINIPERL) $(CONFIGPM) ..\global.sym ..\pp.sym ..\makedef.pl create_perllibst_h.pl
+	$(MINIPERL) -I..\lib create_perllibst_h.pl
+	$(MINIPERL) -I..\lib -w ..\makedef.pl PLATFORM=win32 $(OPTIMIZE) $(DEFINES) \
+	$(BUILDOPT) CCTYPE=$(CCTYPE) > perldll.def
+
+$(PERLDLL): perldll.def $(PERLDLL_OBJ) $(PERLDLL_RES) Extensions_static
+.IF "$(CCTYPE)" == "BORLAND"
+	$(LINK32) -Tpd -ap $(BLINK_FLAGS) \
+	    @$(mktmp c0d32$(o) $(PERLDLL_OBJ),$@,, \
+	        $(shell @type Extensions_static) $(LIBFILES),perldll.def)
+	$(IMPLIB) $*.lib $@
+.ELIF "$(CCTYPE)" == "GCC"
+	$(LINK32) -mdll -o $@ -Wl,--base-file -Wl,perl.base $(BLINK_FLAGS) \
+	    $(mktmp $(LKPRE) $(PERLDLL_OBJ) \
+		$(shell @type Extensions_static) \
+		$(LIBFILES) $(LKPOST))
+	$(IMPLIB) --output-lib $(PERLIMPLIB) \
+		--dllname $(PERLDLL:b).dll \
+		--def perldll.def \
+		--base-file perl.base \
+		--output-exp perl.exp
+	$(LINK32) -mdll -o $@ $(BLINK_FLAGS) \
+	    $(mktmp $(LKPRE) $(PERLDLL_OBJ) \
+		$(shell @type Extensions_static) \
+		$(LIBFILES) perl.exp $(LKPOST))
+.ELSE
+	$(LINK32) -dll -def:perldll.def -out:$@ $(BLINK_FLAGS) \
+	    @Extensions_static \
+	    @$(mktmp -base:0x28000000 $(DELAYLOAD) $(LIBFILES) \
+		$(PERLDLL_RES) $(PERLDLL_OBJ))
+	$(EMBED_DLL_MANI)
+.ENDIF
+	$(XCOPY) $(PERLIMPLIB) $(COREDIR)
+
+$(PERLSTATICLIB): Extensions_static
+.IF "$(CCTYPE)" == "BORLAND"
+	$(LIB32) $(LIB_FLAGS) $@ \
+	    @$(mktmp $(shell @type Extensions_static) \
+		$(PERLDLL_OBJ))
+.ELIF "$(CCTYPE)" == "GCC"
+# XXX: It would be nice if MinGW's ar accepted a temporary file, but this
+# doesn't seem to work:
+#	$(LIB32) $(LIB_FLAGS) $@ \
+#	    $(mktmp $(LKPRE) $(shell @type Extensions_static) \
+#		$(PERLDLL_OBJ) $(LKPOST))
+	$(LIB32) $(LIB_FLAGS) $@ \
+	    $(shell @type Extensions_static) \
+	    $(PERLDLL_OBJ)
+.ELSE
+	$(LIB32) $(LIB_FLAGS) -out:$@ @Extensions_static \
+	    @$(mktmp $(PERLDLL_OBJ))
+.ENDIF
+	$(XCOPY) $(PERLSTATICLIB) $(COREDIR)
+
+$(PERLEXE_RES): perlexe.rc $(PERLEXE_MANIFEST) $(PERLEXE_ICO)
+
+$(MINIMOD) : $(MINIPERL) ..\minimod.pl
+	cd .. && miniperl minimod.pl > lib\ExtUtils\Miniperl.pm
+
+..\x2p\a2p$(o) : ..\x2p\a2p.c
+	$(CC) -I..\x2p $(CFLAGS) $(OBJOUT_FLAG)$@ -c ..\x2p\a2p.c
+
+..\x2p\hash$(o) : ..\x2p\hash.c
+	$(CC) -I..\x2p  $(CFLAGS) $(OBJOUT_FLAG)$@ -c ..\x2p\hash.c
+
+..\x2p\str$(o) : ..\x2p\str.c
+	$(CC) -I..\x2p  $(CFLAGS) $(OBJOUT_FLAG)$@ -c ..\x2p\str.c
+
+..\x2p\util$(o) : ..\x2p\util.c
+	$(CC) -I..\x2p  $(CFLAGS) $(OBJOUT_FLAG)$@ -c ..\x2p\util.c
+
+..\x2p\walk$(o) : ..\x2p\walk.c
+	$(CC) -I..\x2p  $(CFLAGS) $(OBJOUT_FLAG)$@ -c ..\x2p\walk.c
+
+$(X2P) : $(MINIPERL) $(X2P_OBJ) Extensions
+	$(MINIPERL) -I..\lib ..\x2p\find2perl.PL
+	$(MINIPERL) -I..\lib ..\x2p\s2p.PL
+.IF "$(CCTYPE)" == "BORLAND"
+	$(LINK32) -Tpe -ap $(BLINK_FLAGS) \
+	    @$(mktmp c0x32$(o) $(X2P_OBJ),$@,,$(LIBFILES),)
+.ELIF "$(CCTYPE)" == "GCC"
+	$(LINK32) -v -o $@ $(BLINK_FLAGS) \
+	    $(mktmp $(LKPRE) $(X2P_OBJ) $(LIBFILES) $(LKPOST))
+.ELSE
+	$(LINK32) -subsystem:console -out:$@ $(BLINK_FLAGS) \
+	    @$(mktmp $(LIBFILES) $(X2P_OBJ))
+	$(EMBED_EXE_MANI)
+.ENDIF
+
+$(MINIDIR)\globals$(o) : $(UUDMAP_H) $(BITCOUNT_H)
+
+$(UUDMAP_H) $(BITCOUNT_H) : $(GENUUDMAP)
+	$(GENUUDMAP) $(UUDMAP_H) $(BITCOUNT_H)
+
+$(GENUUDMAP) : $(GENUUDMAP_OBJ)
+.IF "$(CCTYPE)" == "BORLAND"
+	$(LINK32) -Tpe -ap $(BLINK_FLAGS) \
+	    @$(mktmp c0x32$(o) $(GENUUDMAP_OBJ),$@,,$(LIBFILES),)
+.ELIF "$(CCTYPE)" == "GCC"
+	$(LINK32) -v -o $@ $(BLINK_FLAGS) \
+	    $(mktmp $(LKPRE) $(GENUUDMAP_OBJ) $(LIBFILES) $(LKPOST))
+.ELSE
+	$(LINK32) -subsystem:console -out:$@ $(BLINK_FLAGS) \
+	    @$(mktmp $(LIBFILES) $(GENUUDMAP_OBJ))
+	$(EMBED_EXE_MANI)
+.ENDIF
+
+perlmain.c : runperl.c
+	copy runperl.c perlmain.c
+
+perlmain$(o) : perlmain.c
+	$(CC) $(CFLAGS_O:s,-DPERLDLL,-UPERLDLL,) $(OBJOUT_FLAG)$@ -c perlmain.c
+
+perlmainst.c : runperl.c
+	copy runperl.c perlmainst.c
+
+perlmainst$(o) : perlmainst.c
+	$(CC) $(CFLAGS_O) $(OBJOUT_FLAG)$@ -c perlmainst.c
+
+$(PERLEXE): $(PERLDLL) $(CONFIGPM) $(PERLEXE_OBJ) $(PERLEXE_RES)
+.IF "$(CCTYPE)" == "BORLAND"
+	$(LINK32) -Tpe -ap $(BLINK_FLAGS) \
+	    @$(mktmp c0x32$(o) $(PERLEXE_OBJ),$@,, \
+		$(PERLIMPLIB) $(LIBFILES),,$(PERLEXE_RES))
+.ELIF "$(CCTYPE)" == "GCC"
+	$(LINK32) -mconsole -o $@ $(BLINK_FLAGS)  \
+	    $(PERLEXE_OBJ) $(PERLEXE_RES) $(PERLIMPLIB) $(LIBFILES)
+.ELSE
+	$(LINK32) -subsystem:console -out:$@ -stack:0x1000000 $(BLINK_FLAGS) \
+	    $(LIBFILES) $(PERLEXE_OBJ) $(SETARGV_OBJ) $(PERLIMPLIB) $(PERLEXE_RES)
+	$(EMBED_EXE_MANI)
+.ENDIF
+	copy $(PERLEXE) $(WPERLEXE)
+	$(MINIPERL) -I..\lib bin\exetype.pl $(WPERLEXE) WINDOWS
+
+$(PERLEXESTATIC): $(PERLSTATICLIB) $(CONFIGPM) $(PERLEXEST_OBJ) $(PERLEXE_RES)
+.IF "$(CCTYPE)" == "BORLAND"
+	$(LINK32) -Tpe -ap $(BLINK_FLAGS) \
+	    @$(mktmp c0x32$(o) $(PERLEXEST_OBJ),$@,, \
+		$(shell @type Extensions_static) $(PERLSTATICLIB) $(LIBFILES),, \
+		$(PERLEXE_RES))
+.ELIF "$(CCTYPE)" == "GCC"
+	$(LINK32) -mconsole -o $@ $(BLINK_FLAGS) \
+	    $(mktmp $(LKPRE) $(shell @type Extensions_static) \
+		$(PERLSTATICLIB) $(LIBFILES) $(PERLEXEST_OBJ) \
+		$(PERLEXE_RES) $(LKPOST))
+.ELSE
+	$(LINK32) -subsystem:console -out:$@ -stack:0x1000000 $(BLINK_FLAGS) \
+	    @Extensions_static $(PERLSTATICLIB) /PDB:NONE \
+	    $(LIBFILES) $(PERLEXEST_OBJ) $(SETARGV_OBJ) $(PERLEXE_RES)
+	$(EMBED_EXE_MANI)
+.ENDIF
+
+MakePPPort: $(MINIPERL) $(CONFIGPM) Extensions_nonxs
+	$(MINIPERL) -I..\lib $(ICWD) ..\mkppport
+
+#-------------------------------------------------------------------------------
+# There's no direct way to mark a dependency on
+# DynaLoader.pm, so this will have to do
+Extensions : ..\make_ext.pl $(PERLDEP) $(CONFIGPM) $(DYNALOADER)
+	$(XCOPY) ..\*.h $(COREDIR)\*.*
+	$(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(CPANDIR) --dir=$(DISTDIR) --dir=$(EXTDIR) --dynamic
+
+Extensions_reonly : ..\make_ext.pl $(PERLDEP) $(CONFIGPM) $(DYNALOADER)
+	$(XCOPY) ..\*.h $(COREDIR)\*.*
+	$(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(CPANDIR) --dir=$(DISTDIR) --dir=$(EXTDIR) --dynamic +re
+
+Extensions_static : ..\make_ext.pl list_static_libs.pl $(PERLDEP) $(CONFIGPM)
+	$(XCOPY) ..\*.h $(COREDIR)\*.*
+	$(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(CPANDIR) --dir=$(DISTDIR) --dir=$(EXTDIR) --static
+	$(MINIPERL) -I..\lib list_static_libs.pl > Extensions_static
+
+Extensions_nonxs : ..\make_ext.pl $(PERLDEP) $(CONFIGPM)
+	$(XCOPY) ..\*.h $(COREDIR)\*.*
+	$(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(CPANDIR) --dir=$(DISTDIR) --dir=$(EXTDIR) --nonxs
+
+$(DYNALOADER) : ..\make_ext.pl $(PERLDEP) $(CONFIGPM) Extensions_nonxs
+	$(XCOPY) ..\*.h $(COREDIR)\*.*
+	$(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(EXTDIR) --dynaloader
+
+Extensions_clean :
+	-if exist $(MINIPERL) $(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(CPANDIR) --dir=$(DISTDIR) --dir=$(EXTDIR) --all --target=clean
+
+Extensions_realclean :
+	-if exist $(MINIPERL) $(MINIPERL) -I..\lib ..\make_ext.pl "MAKE=$(MAKE)" --dir=$(CPANDIR) --dir=$(DISTDIR) --dir=$(EXTDIR) --all --target=realclean
+
+#-------------------------------------------------------------------------------
+
+
+doc: $(PERLEXE) ..\pod\perltoc.pod
+	$(PERLEXE) -I..\lib ..\installhtml --podroot=.. --htmldir=$(HTMLDIR) \
+	    --podpath=pod:lib:ext:utils --htmlroot="file://$(INST_HTML:s,:,|,)"\
+	    --libpod=perlfunc:perlguts:perlvar:perlrun:perlop --recurse
+
+# Note that this next section is parsed (and regenerated) by pod/buildtoc
+# so please check that script before making structural changes here
+utils: $(PERLEXE) $(X2P)
+	cd ..\utils && $(MAKE) PERL=$(MINIPERL)
+	copy ..\README.aix      ..\pod\perlaix.pod
+	copy ..\README.amiga    ..\pod\perlamiga.pod
+	copy ..\README.apollo   ..\pod\perlapollo.pod
+	copy ..\README.beos     ..\pod\perlbeos.pod
+	copy ..\README.bs2000   ..\pod\perlbs2000.pod
+	copy ..\README.ce       ..\pod\perlce.pod
+	copy ..\README.cn       ..\pod\perlcn.pod
+	copy ..\README.cygwin   ..\pod\perlcygwin.pod
+	copy ..\README.dgux     ..\pod\perldgux.pod
+	copy ..\README.dos      ..\pod\perldos.pod
+	copy ..\README.epoc     ..\pod\perlepoc.pod
+	copy ..\README.freebsd  ..\pod\perlfreebsd.pod
+	copy ..\README.haiku    ..\pod\perlhaiku.pod
+	copy ..\README.hpux     ..\pod\perlhpux.pod
+	copy ..\README.hurd     ..\pod\perlhurd.pod
+	copy ..\README.irix     ..\pod\perlirix.pod
+	copy ..\README.jp       ..\pod\perljp.pod
+	copy ..\README.ko       ..\pod\perlko.pod
+	copy ..\README.linux    ..\pod\perllinux.pod
+	copy ..\README.macos    ..\pod\perlmacos.pod
+	copy ..\README.macosx   ..\pod\perlmacosx.pod
+	copy ..\README.mpeix    ..\pod\perlmpeix.pod
+	copy ..\README.netware  ..\pod\perlnetware.pod
+	copy ..\README.openbsd  ..\pod\perlopenbsd.pod
+	copy ..\README.os2      ..\pod\perlos2.pod
+	copy ..\README.os390    ..\pod\perlos390.pod
+	copy ..\README.os400    ..\pod\perlos400.pod
+	copy ..\README.plan9    ..\pod\perlplan9.pod
+	copy ..\README.qnx      ..\pod\perlqnx.pod
+	copy ..\README.riscos   ..\pod\perlriscos.pod
+	copy ..\README.solaris  ..\pod\perlsolaris.pod
+	copy ..\README.symbian  ..\pod\perlsymbian.pod
+	copy ..\README.tru64    ..\pod\perltru64.pod
+	copy ..\README.tw       ..\pod\perltw.pod
+	copy ..\README.uts      ..\pod\perluts.pod
+	copy ..\README.vmesa    ..\pod\perlvmesa.pod
+	copy ..\README.vos      ..\pod\perlvos.pod
+	copy ..\README.win32    ..\pod\perlwin32.pod
+	copy ..\pod\perl5122delta.pod ..\pod\perldelta.pod
+	cd ..\pod && $(MAKE) -f ..\win32\pod.mak converters
+	$(PERLEXE) $(PL2BAT) $(UTILS)
+	$(PERLEXE) $(ICWD) ..\autodoc.pl ..
+	$(PERLEXE) $(ICWD) ..\pod\perlmodlib.pl -q
+
+..\pod\perltoc.pod: $(PERLEXE) Extensions Extensions_nonxs
+	$(PERLEXE) -f ..\pod\buildtoc --build-toc -q
+
+# Note that the pod cleanup in this next section is parsed (and regenerated
+# by pod/buildtoc so please check that script before making changes here
+
+distclean: realclean
+	-del /f $(MINIPERL) $(PERLEXE) $(PERLDLL) $(GLOBEXE) \
+		$(PERLIMPLIB) ..\miniperl$(a) $(MINIMOD) \
+		$(PERLEXESTATIC) $(PERLSTATICLIB)
+	-del /f *.def *.map
+	-del /f $(LIBDIR)\Encode.pm $(LIBDIR)\encoding.pm $(LIBDIR)\Errno.pm
+	-del /f $(LIBDIR)\Config.pod $(LIBDIR)\POSIX.pod $(LIBDIR)\threads.pm
+	-del /f $(LIBDIR)\.exists $(LIBDIR)\attributes.pm $(LIBDIR)\DynaLoader.pm
+	-del /f $(LIBDIR)\Fcntl.pm $(LIBDIR)\IO.pm $(LIBDIR)\Opcode.pm
+	-del /f $(LIBDIR)\ops.pm $(LIBDIR)\Safe.pm
+	-del /f $(LIBDIR)\SDBM_File.pm $(LIBDIR)\Socket.pm $(LIBDIR)\POSIX.pm
+	-del /f $(LIBDIR)\B.pm $(LIBDIR)\O.pm $(LIBDIR)\re.pm
+	-del /f $(LIBDIR)\File\Glob.pm
+	-del /f $(LIBDIR)\Storable.pm
+	-del /f $(LIBDIR)\Sys\Hostname.pm
+	-del /f $(LIBDIR)\Time\HiRes.pm
+	-del /f $(LIBDIR)\Unicode\Normalize.pm
+	-del /f $(LIBDIR)\Math\BigInt\FastCalc.pm
+	-del /f $(LIBDIR)\Win32.pm
+	-del /f $(LIBDIR)\Win32CORE.pm
+	-del /f $(LIBDIR)\Win32API\File.pm
+	-del /f $(LIBDIR)\Win32API\File\cFile.pc
+	-del /f $(DISTDIR)\XSLoader\XSLoader.pm
+	-if exist $(LIBDIR)\App rmdir /s /q $(LIBDIR)\App
+	-if exist $(LIBDIR)\Archive rmdir /s /q $(LIBDIR)\Archive
+	-if exist $(LIBDIR)\Attribute rmdir /s /q $(LIBDIR)\Attribute
+	-if exist $(LIBDIR)\autodie rmdir /s /q $(LIBDIR)\autodie
+	-if exist $(LIBDIR)\B rmdir /s /q $(LIBDIR)\B
+	-if exist $(LIBDIR)\CGI rmdir /s /q $(LIBDIR)\CGI
+	-if exist $(LIBDIR)\CPAN rmdir /s /q $(LIBDIR)\CPAN
+	-if exist $(LIBDIR)\CPANPLUS rmdir /s /q $(LIBDIR)\CPANPLUS
+	-if exist $(LIBDIR)\Compress rmdir /s /q $(LIBDIR)\Compress
+	-if exist $(LIBDIR)\Data rmdir /s /q $(LIBDIR)\Data
+	-if exist $(LIBDIR)\Devel rmdir /s /q $(LIBDIR)\Devel
+	-if exist $(LIBDIR)\Digest rmdir /s /q $(LIBDIR)\Digest
+	-if exist $(LIBDIR)\Encode rmdir /s /q $(LIBDIR)\Encode
+	-if exist $(LIBDIR)\encoding rmdir /s /q $(LIBDIR)\encoding
+	-if exist $(LIBDIR)\ExtUtils\CBuilder rmdir /s /q $(LIBDIR)\ExtUtils\CBuilder
+	-if exist $(LIBDIR)\ExtUtils\Command rmdir /s /q $(LIBDIR)\ExtUtils\Command
+	-if exist $(LIBDIR)\ExtUtils\Constant rmdir /s /q $(LIBDIR)\ExtUtils\Constant
+	-if exist $(LIBDIR)\ExtUtils\Liblist rmdir /s /q $(LIBDIR)\ExtUtils\Liblist
+	-if exist $(LIBDIR)\ExtUtils\MakeMaker rmdir /s /q $(LIBDIR)\ExtUtils\MakeMaker
+	-if exist $(LIBDIR)\File\Spec rmdir /s /q $(LIBDIR)\File\Spec
+	-if exist $(LIBDIR)\Filter rmdir /s /q $(LIBDIR)\Filter
+	-if exist $(LIBDIR)\Hash rmdir /s /q $(LIBDIR)\Hash
+	-if exist $(LIBDIR)\I18N\LangTags rmdir /s /q $(LIBDIR)\I18N\LangTags
+	-if exist $(LIBDIR)\inc rmdir /s /q $(LIBDIR)\inc
+	-if exist $(LIBDIR)\Module\Pluggable rmdir /s /q $(LIBDIR)\Module\Pluggable
+	-if exist $(LIBDIR)\IO rmdir /s /q $(LIBDIR)\IO
+	-if exist $(LIBDIR)\IPC rmdir /s /q $(LIBDIR)\IPC
+	-if exist $(LIBDIR)\List rmdir /s /q $(LIBDIR)\List
+	-if exist $(LIBDIR)\Locale rmdir /s /q $(LIBDIR)\Locale
+	-if exist $(LIBDIR)\Log rmdir /s /q $(LIBDIR)\Log
+	-if exist $(LIBDIR)\Math rmdir /s /q $(LIBDIR)\Math
+	-if exist $(LIBDIR)\Memoize rmdir /s /q $(LIBDIR)\Memoize
+	-if exist $(LIBDIR)\MIME rmdir /s /q $(LIBDIR)\MIME
+	-if exist $(LIBDIR)\Module rmdir /s /q $(LIBDIR)\Module
+	-if exist $(LIBDIR)\mro rmdir /s /q $(LIBDIR)\mro
+	-if exist $(LIBDIR)\Net\FTP rmdir /s /q $(LIBDIR)\Net\FTP
+	-if exist $(LIBDIR)\Object rmdir /s /q $(LIBDIR)\Object
+	-if exist $(LIBDIR)\Package rmdir /s /q $(LIBDIR)\Package
+	-if exist $(LIBDIR)\Params rmdir /s /q $(LIBDIR)\Params
+	-if exist $(LIBDIR)\Parse rmdir /s /q $(LIBDIR)\Parse
+	-if exist $(LIBDIR)\PerlIO rmdir /s /q $(LIBDIR)\PerlIO
+	-if exist $(LIBDIR)\Pod\Perldoc rmdir /s /q $(LIBDIR)\Pod\Perldoc
+	-if exist $(LIBDIR)\Pod\Simple rmdir /s /q $(LIBDIR)\Pod\Simple
+	-if exist $(LIBDIR)\Pod\Text rmdir /s /q $(LIBDIR)\Pod\Text
+	-if exist $(LIBDIR)\re rmdir /s /q $(LIBDIR)\re
+	-if exist $(LIBDIR)\Scalar rmdir /s /q $(LIBDIR)\Scalar
+	-if exist $(LIBDIR)\Sys rmdir /s /q $(LIBDIR)\Sys
+	-if exist $(LIBDIR)\TAP rmdir /s /q $(LIBDIR)\TAP
+	-if exist $(LIBDIR)\Term\UI rmdir /s /q $(LIBDIR)\Term\UI
+	-if exist $(LIBDIR)\Test rmdir /s /q $(LIBDIR)\Test
+	-if exist $(LIBDIR)\Thread rmdir /s /q $(LIBDIR)\Thread
+	-if exist $(LIBDIR)\threads rmdir /s /q $(LIBDIR)\threads
+	-if exist $(LIBDIR)\Unicode\Collate rmdir /s /q $(LIBDIR)\Unicode\Collate
+	-if exist $(LIBDIR)\XS rmdir /s /q $(LIBDIR)\XS
+	-if exist $(LIBDIR)\Win32API rmdir /s /q $(LIBDIR)\Win32API
+	-cd $(PODDIR) && del /f *.html *.bat \
+	    perlaix.pod perlamiga.pod perlapi.pod perlapollo.pod \
+	    perlbeos.pod perlbs2000.pod perlce.pod perlcn.pod \
+	    perlcygwin.pod perldelta.pod perldgux.pod perldos.pod \
+	    perlepoc.pod perlfreebsd.pod perlhaiku.pod perlhpux.pod \
+	    perlhurd.pod perlintern.pod perlirix.pod perljp.pod perlko.pod \
+	    perllinux.pod perlmacos.pod perlmacosx.pod perlmodlib.pod \
+	    perlmpeix.pod perlnetware.pod perlopenbsd.pod perlos2.pod \
+	    perlos390.pod perlos400.pod perlplan9.pod perlqnx.pod \
+	    perlriscos.pod perlsolaris.pod perlsymbian.pod perltoc.pod \
+	    perltru64.pod perltw.pod perluniprops.pod perluts.pod \
+	    perlvmesa.pod perlvos.pod perlwin32.pod \
+	    pod2html pod2latex pod2man pod2text pod2usage \
+	    podchecker podselect
+	-cd ..\utils && del /f h2ph splain perlbug pl2pm c2ph pstruct h2xs \
+	    perldoc perlivp dprofpp libnetcfg enc2xs piconv cpan *.bat \
+	    xsubpp instmodsh prove ptar ptardiff cpanp-run-perl cpanp cpan2dist shasum corelist config_data
+	-cd ..\x2p && del /f find2perl s2p psed *.bat
+	-del /f ..\config.sh perlmain.c dlutils.c config.h.new \
+	    perlmainst.c
+	-del /f $(CONFIGPM)
+	-del /f ..\lib\Config_git.pl
+	-del /f bin\*.bat
+	-del /f perllibst.h
+	-del /f $(PERLEXE_RES) perl.base
+	-cd .. && del /s *$(a) *.map *.pdb *.ilk *.tds *.bs *$(o) .exists pm_to_blib ppport.h
+	-cd $(EXTDIR) && del /s *.def Makefile Makefile.old
+	-cd $(DISTDIR) && del /s *.def Makefile Makefile.old
+	-cd $(CPANDIR) && del /s *.def Makefile Makefile.old
+	-if exist $(AUTODIR) rmdir /s /q $(AUTODIR)
+	-if exist $(COREDIR) rmdir /s /q $(COREDIR)
+	-if exist pod2htmd.tmp del pod2htmd.tmp
+	-if exist pod2htmi.tmp del pod2htmi.tmp
+	-if exist $(HTMLDIR) rmdir /s /q $(HTMLDIR)
+	-del /f ..\t\test_state
+
+install : all installbare installhtml
+
+installbare : $(RIGHTMAKE) utils ..\pod\perltoc.pod
+	$(PERLEXE) ..\installperl
+	if exist $(WPERLEXE) $(XCOPY) $(WPERLEXE) $(INST_BIN)\*.*
+	if exist $(PERLEXESTATIC) $(XCOPY) $(PERLEXESTATIC) $(INST_BIN)\*.*
+	$(XCOPY) $(GLOBEXE) $(INST_BIN)\*.*
+	if exist ..\perl*.pdb $(XCOPY) ..\perl*.pdb $(INST_BIN)\*.*
+	if exist ..\x2p\a2p.pdb $(XCOPY) ..\x2p\a2p.pdb $(INST_BIN)\*.*
+	$(XCOPY) bin\*.bat $(INST_SCRIPT)\*.*
+
+installhtml : doc
+	$(RCOPY) $(HTMLDIR)\*.* $(INST_HTML)\*.*
+
+inst_lib : $(CONFIGPM)
+	$(RCOPY) ..\lib $(INST_LIB)\*.*
+
+$(UNIDATAFILES) ..\pod\perluniprops.pod .UPDATEALL : $(MINIPERL) $(CONFIGPM) ..\lib\unicore\mktables Extensions_nonxs
+	cd ..\lib\unicore && \
+	..\$(MINIPERL) -I.. -I..\..\cpan\Cwd\lib -I..\..\cpan\Cwd mktables -P ..\..\pod -maketest -makelist -p
+
+minitest : $(MINIPERL) $(GLOBEXE) $(CONFIGPM) $(UNIDATAFILES) utils
+	$(XCOPY) $(MINIPERL) ..\t\$(NULL)
+	if exist ..\t\perl.exe del /f ..\t\perl.exe
+	rename ..\t\miniperl.exe perl.exe
+.IF "$(CCTYPE)" == "BORLAND"
+	$(XCOPY) $(GLOBBAT) ..\t\$(NULL)
+.ELSE
+	$(XCOPY) $(GLOBEXE) ..\t\$(NULL)
+.ENDIF
+	attrib -r ..\t\*.*
+	cd ..\t && \
+	$(MINIPERL) -I..\lib harness base/*.t comp/*.t cmd/*.t io/*.t op/*.t pragma/*.t
+
+test-prep : all utils
+	$(XCOPY) $(PERLEXE) ..\t\$(NULL)
+	$(XCOPY) $(PERLDLL) ..\t\$(NULL)
+.IF "$(CCTYPE)" == "BORLAND"
+	$(XCOPY) $(GLOBBAT) ..\t\$(NULL)
+.ELSE
+	$(XCOPY) $(GLOBEXE) ..\t\$(NULL)
+.ENDIF
+.IF "$(CCTYPE)" == "GCC"
+.IF "$(GCC_4XX)" == "define"
+	$(XCOPY) $(GCCHELPERDLL) ..\t\$(NULL)
+.ENDIF
+.ENDIF
+
+test : $(RIGHTMAKE) test-prep
+	cd ..\t && $(PERLEXE) -I..\lib harness $(TEST_SWITCHES) $(TEST_FILES)
+
+test-reonly : reonly utils
+	$(XCOPY) $(PERLEXE) ..\t\$(NULL)
+	$(XCOPY) $(PERLDLL) ..\t\$(NULL)
+	$(XCOPY) $(GLOBEXE) ..\t\$(NULL)
+	cd ..\t && \
+	$(PERLEXE) -I..\lib harness $(OPT) -re \bpat\\/ $(EXTRA) && \
+	cd ..\win32
+
+regen :
+	cd .. && regen.pl && cd win32
+
+test-notty : test-prep
+	set PERL_SKIP_TTY_TEST=1 && \
+	    cd ..\t && $(PERLEXE) -I.\lib harness $(TEST_SWITCHES) $(TEST_FILES)
+
+_test : $(RIGHTMAKE)
+	$(XCOPY) $(PERLEXE) ..\t\$(NULL)
+	$(XCOPY) $(PERLDLL) ..\t\$(NULL)
+.IF "$(CCTYPE)" == "BORLAND"
+	$(XCOPY) $(GLOBBAT) ..\t\$(NULL)
+.ELSE
+	$(XCOPY) $(GLOBEXE) ..\t\$(NULL)
+.ENDIF
+	cd ..\t && $(PERLEXE) -I..\lib harness $(TEST_SWITCHES) $(TEST_FILES)
+
+_clean :
+	-@erase miniperlmain$(o)
+	-@erase $(MINIPERL)
+	-@erase perlglob$(o)
+	-@erase perlmain$(o)
+	-@erase perlmainst$(o)
+	-@erase config.w32
+	-@erase /f config.h
+	-@erase /f ..\git_version.h
+	-@erase $(GLOBEXE)
+	-@erase $(PERLEXE)
+	-@erase $(WPERLEXE)
+	-@erase $(PERLEXESTATIC)
+	-@erase $(PERLSTATICLIB)
+	-@erase $(PERLDLL)
+	-@erase $(CORE_OBJ)
+	-@erase $(GENUUDMAP) $(GENUUDMAP_OBJ) $(UUDMAP_H) $(BITCOUNT_H)
+	-if exist $(MINIDIR) rmdir /s /q $(MINIDIR)
+	-if exist $(UNIDATADIR1) rmdir /s /q $(UNIDATADIR1)
+	-if exist $(UNIDATADIR2) rmdir /s /q $(UNIDATADIR2)
+	-@erase $(UNIDATAFILES)
+	-@erase $(WIN32_OBJ)
+	-@erase $(DLL_OBJ)
+	-@erase $(X2P_OBJ)
+	-@erase ..\*$(o) ..\*$(a) ..\*.exp *$(o) *$(a) *.exp *.res
+	-@erase ..\t\*.exe ..\t\*.dll ..\t\*.bat
+	-@erase ..\x2p\*.exe ..\x2p\*.bat
+	-@erase *.ilk
+	-@erase *.pdb
+	-@erase *.tds
+	-@erase Extensions_static
+
+
+
+clean : Extensions_clean _clean
+
+realclean : Extensions_realclean _clean
+
+# Handy way to run perlbug -ok without having to install and run the
+# installed perlbug. We don't re-run the tests here - we trust the user.
+# Please *don't* use this unless all tests pass.
+# If you want to report test failures, use "dmake nok" instead.
+ok: utils
+	$(PERLEXE) -I..\lib ..\utils\perlbug -ok -s "(UNINSTALLED)"
+
+okfile: utils
+	$(PERLEXE) -I..\lib ..\utils\perlbug -ok -s "(UNINSTALLED)" -F perl.ok
+
+nok: utils
+	$(PERLEXE) -I..\lib ..\utils\perlbug -nok -s "(UNINSTALLED)"
+
+nokfile: utils
+	$(PERLEXE) -I..\lib ..\utils\perlbug -nok -s "(UNINSTALLED)" -F perl.nok
Index: src/gnu/usr.bin/perl/win32/pod.mak
diff -u src/gnu/usr.bin/perl/win32/pod.mak:1.11 src/gnu/usr.bin/perl/win32/pod.mak:1.12
--- win32/pod.mak:1.11	Mon Oct 12 18:30:28 2009
+++ win32/pod.mak	Fri Sep 24 15:07:11 2010
@@ -14,12 +14,23 @@
 PERL = ..\miniperl.exe
 REALPERL = ..\perl.exe
 
+ICWD = -I..\cpan\Cwd
+
 POD = \
 	perl.pod	\
 	perl5004delta.pod	\
 	perl5005delta.pod	\
 	perl5100delta.pod	\
 	perl5101delta.pod	\
+	perl5110delta.pod	\
+	perl5111delta.pod	\
+	perl5112delta.pod	\
+	perl5113delta.pod	\
+	perl5114delta.pod	\
+	perl5115delta.pod	\
+	perl5120delta.pod	\
+	perl5121delta.pod	\
+	perl5122delta.pod	\
 	perl561delta.pod	\
 	perl56delta.pod	\
 	perl570delta.pod	\
@@ -100,11 +111,11 @@
 	perlobj.pod	\
 	perlop.pod	\
 	perlopentut.pod	\
-	perlothrtut.pod	\
 	perlpacktut.pod	\
 	perlperf.pod	\
 	perlpod.pod	\
 	perlpodspec.pod	\
+	perlpolicy.pod	\
 	perlport.pod	\
 	perlpragma.pod	\
 	perlre.pod	\
@@ -133,6 +144,7 @@
 	perlunicode.pod	\
 	perlunifaq.pod	\
 	perluniintro.pod	\
+	perluniprops.pod	\
 	perlunitut.pod	\
 	perlutil.pod	\
 	perlvar.pod	\
@@ -146,6 +158,15 @@
 	perl5005delta.man	\
 	perl5100delta.man	\
 	perl5101delta.man	\
+	perl5110delta.man	\
+	perl5111delta.man	\
+	perl5112delta.man	\
+	perl5113delta.man	\
+	perl5114delta.man	\
+	perl5115delta.man	\
+	perl5120delta.man	\
+	perl5121delta.man	\
+	perl5122delta.man	\
 	perl561delta.man	\
 	perl56delta.man	\
 	perl570delta.man	\
@@ -226,11 +247,11 @@
 	perlobj.man	\
 	perlop.man	\
 	perlopentut.man	\
-	perlothrtut.man	\
 	perlpacktut.man	\
 	perlperf.man	\
 	perlpod.man	\
 	perlpodspec.man	\
+	perlpolicy.man	\
 	perlport.man	\
 	perlpragma.man	\
 	perlre.man	\
@@ -259,6 +280,7 @@
 	perlunicode.man	\
 	perlunifaq.man	\
 	perluniintro.man	\
+	perluniprops.man	\
 	perlunitut.man	\
 	perlutil.man	\
 	perlvar.man	\
@@ -272,6 +294,15 @@
 	perl5005delta.html	\
 	perl5100delta.html	\
 	perl5101delta.html	\
+	perl5110delta.html	\
+	perl5111delta.html	\
+	perl5112delta.html	\
+	perl5113delta.html	\
+	perl5114delta.html	\
+	perl5115delta.html	\
+	perl5120delta.html	\
+	perl5121delta.html	\
+	perl5122delta.html	\
 	perl561delta.html	\
 	perl56delta.html	\
 	perl570delta.html	\
@@ -352,11 +383,11 @@
 	perlobj.html	\
 	perlop.html	\
 	perlopentut.html	\
-	perlothrtut.html	\
 	perlpacktut.html	\
 	perlperf.html	\
 	perlpod.html	\
 	perlpodspec.html	\
+	perlpolicy.html	\
 	perlport.html	\
 	perlpragma.html	\
 	perlre.html	\
@@ -384,6 +415,7 @@
 	perlunicode.html	\
 	perlunifaq.html	\
 	perluniintro.html	\
+	perluniprops.html	\
 	perlunitut.html	\
 	perlutil.html	\
 	perlvar.html	\
@@ -398,6 +430,15 @@
 	perl5005delta.tex	\
 	perl5100delta.tex	\
 	perl5101delta.tex	\
+	perl5110delta.tex	\
+	perl5111delta.tex	\
+	perl5112delta.tex	\
+	perl5113delta.tex	\
+	perl5114delta.tex	\
+	perl5115delta.tex	\
+	perl5120delta.tex	\
+	perl5121delta.tex	\
+	perl5122delta.tex	\
 	perl561delta.tex	\
 	perl56delta.tex	\
 	perl570delta.tex	\
@@ -478,11 +519,11 @@
 	perlobj.tex	\
 	perlop.tex	\
 	perlopentut.tex	\
-	perlothrtut.tex	\
 	perlpacktut.tex	\
 	perlperf.tex	\
 	perlpod.tex	\
 	perlpodspec.tex	\
+	perlpolicy.tex	\
 	perlport.tex	\
 	perlpragma.tex	\
 	perlre.tex	\
@@ -511,6 +552,7 @@
 	perlunicode.tex	\
 	perlunifaq.tex	\
 	perluniintro.tex	\
+	perluniprops.tex	\
 	perlunitut.tex	\
 	perlutil.tex	\
 	perlvar.tex	\
@@ -571,22 +613,22 @@
 
 # Dependencies.
 pod2latex:	pod2latex.PL ../lib/Config.pm
-	$(PERL) -I../lib pod2latex.PL
+	$(PERL) -I../lib $(ICWD) pod2latex.PL
 
 pod2html:	pod2html.PL ../lib/Config.pm
-	$(PERL) -I ../lib pod2html.PL
+	$(PERL) -I ../lib $(ICWD) pod2html.PL
 
 pod2man:	pod2man.PL ../lib/Config.pm
-	$(PERL) -I ../lib pod2man.PL
+	$(PERL) -I ../lib $(ICWD) pod2man.PL
 
 pod2text:	pod2text.PL ../lib/Config.pm
-	$(PERL) -I ../lib pod2text.PL
+	$(PERL) -I ../lib $(ICWD) pod2text.PL
 
 pod2usage:	pod2usage.PL ../lib/Config.pm
-	$(PERL) -I ../lib pod2usage.PL
+	$(PERL) -I ../lib $(ICWD) pod2usage.PL
 
 podchecker:	podchecker.PL ../lib/Config.pm
-	$(PERL) -I ../lib podchecker.PL
+	$(PERL) -I ../lib $(ICWD) podchecker.PL
 
 podselect:	podselect.PL ../lib/Config.pm
-	$(PERL) -I ../lib podselect.PL
+	$(PERL) -I ../lib $(ICWD) podselect.PL
Index: src/gnu/usr.bin/perl/win32/win32.c
diff -u src/gnu/usr.bin/perl/win32/win32.c:1.12 src/gnu/usr.bin/perl/win32/win32.c:1.13
--- win32/win32.c:1.12	Mon Oct 12 18:30:28 2009
+++ win32/win32.c	Fri Sep 24 15:07:11 2010
@@ -1,7 +1,7 @@
 /* WIN32.C
  *
  * (c) 1995 Microsoft Corporation. All rights reserved.
- * 		Developed by hip communications inc., http://info.hip.com/info/
+ * 		Developed by hip communications inc.
  * Portions (c) 1993 Intergraph Corporation. All rights reserved.
  *
  *    You may distribute under the terms of either the GNU General Public
@@ -22,6 +22,7 @@
 #  define WC_NO_BEST_FIT_CHARS 0x00000400 /* requires Windows 2000 or later */
 #endif
 #include <winnt.h>
+#include <commctrl.h>
 #include <tlhelp32.h>
 #include <io.h>
 #include <signal.h>
@@ -64,7 +65,6 @@
 #define PERL_NO_GET_CONTEXT
 #include "XSUB.h"
 
-#include "Win32iop.h"
 #include <fcntl.h>
 #ifndef __GNUC__
 /* assert.h conflicts with #define of assert in perl.h */
@@ -123,12 +123,13 @@
 static BOOL		has_shell_metachars(const char *ptr);
 static long		filetime_to_clock(PFILETIME ft);
 static BOOL		filetime_from_time(PFILETIME ft, time_t t);
-static char *		get_emd_part(SV **leading, char *trailing, ...);
+static char *		get_emd_part(SV **leading, STRLEN *const len,
+				     char *trailing, ...);
 static void		remove_dead_process(long deceased);
 static long		find_pid(int pid);
 static char *		qualified_path(const char *cmd);
 static char *		win32_get_xlib(const char *pl, const char *xlib,
-				       const char *libname);
+				       const char *libname, STRLEN *const len);
 static LRESULT  win32_process_message(HWND hwnd, UINT msg,
                        WPARAM wParam, LPARAM lParam);
 
@@ -320,7 +321,7 @@
 
 /* *prev_pathp (if non-NULL) is expected to be POK (valid allocated SvPVX(sv)) */
 static char *
-get_emd_part(SV **prev_pathp, char *trailing_path, ...)
+get_emd_part(SV **prev_pathp, STRLEN *const len, char *trailing_path, ...)
 {
     char base[10];
     va_list ap;
@@ -377,6 +378,8 @@
 	else if (SvPVX(*prev_pathp))
 	    sv_catpvn(*prev_pathp, ";", 1);
 	sv_catpv(*prev_pathp, mod_name);
+	if(len)
+	    *len = SvCUR(*prev_pathp);
 	return SvPVX(*prev_pathp);
     }
 
@@ -384,7 +387,7 @@
 }
 
 char *
-win32_get_privlib(const char *pl)
+win32_get_privlib(const char *pl, STRLEN *const len)
 {
     dTHX;
     char *stdlib = "lib";
@@ -397,11 +400,12 @@
 	(void)get_regstr(stdlib, &sv);
 
     /* $stdlib .= ";$EMD/../../lib" */
-    return get_emd_part(&sv, stdlib, ARCHNAME, "bin", NULL);
+    return get_emd_part(&sv, len, stdlib, ARCHNAME, "bin", NULL);
 }
 
 static char *
-win32_get_xlib(const char *pl, const char *xlib, const char *libname)
+win32_get_xlib(const char *pl, const char *xlib, const char *libname,
+	       STRLEN *const len)
 {
     dTHX;
     char regstr[40];
@@ -416,7 +420,7 @@
     /* $xlib .=
      * ";$EMD/" . ((-d $EMD/../../../$]) ? "../../.." : "../.."). "/$libname/$]/lib";  */
     sprintf(pathstr, "%s/%s/lib", libname, pl);
-    (void)get_emd_part(&sv1, pathstr, ARCHNAME, "bin", pl, NULL);
+    (void)get_emd_part(&sv1, NULL, pathstr, ARCHNAME, "bin", pl, NULL);
 
     /* $HKCU{$xlib} || $HKLM{$xlib} . ---; */
     (void)get_regstr(xlib, &sv2);
@@ -424,25 +428,26 @@
     /* $xlib .=
      * ";$EMD/" . ((-d $EMD/../../../$]) ? "../../.." : "../.."). "/$libname/lib";  */
     sprintf(pathstr, "%s/lib", libname);
-    (void)get_emd_part(&sv2, pathstr, ARCHNAME, "bin", pl, NULL);
+    (void)get_emd_part(&sv2, NULL, pathstr, ARCHNAME, "bin", pl, NULL);
 
     if (!sv1 && !sv2)
 	return NULL;
-    if (!sv1)
-	return SvPVX(sv2);
-    if (!sv2)
-	return SvPVX(sv1);
-
-    sv_catpvn(sv1, ";", 1);
-    sv_catsv(sv1, sv2);
+    if (!sv1) {
+	sv1 = sv2;
+    } else if (sv2) {
+	sv_catpvn(sv1, ";", 1);
+	sv_catsv(sv1, sv2);
+    }
 
+    if (len)
+	*len = SvCUR(sv1);
     return SvPVX(sv1);
 }
 
 char *
-win32_get_sitelib(const char *pl)
+win32_get_sitelib(const char *pl, STRLEN *const len)
 {
-    return win32_get_xlib(pl, "sitelib", "site");
+    return win32_get_xlib(pl, "sitelib", "site", len);
 }
 
 #ifndef PERL_VENDORLIB_NAME
@@ -450,9 +455,9 @@
 #endif
 
 char *
-win32_get_vendorlib(const char *pl)
+win32_get_vendorlib(const char *pl, STRLEN *const len)
 {
-    return win32_get_xlib(pl, "vendorlib", PERL_VENDORLIB_NAME);
+    return win32_get_xlib(pl, "vendorlib", PERL_VENDORLIB_NAME, len);
 }
 
 static BOOL
@@ -2009,7 +2014,7 @@
 	GetSystemInfo(&info);
 
 #if (defined(__BORLANDC__)&&(__BORLANDC__<=0x520)) \
- || (defined(__MINGW32__) && !defined(_ANONYMOUS_UNION))
+ || (defined(__MINGW32__) && !defined(_ANONYMOUS_UNION) && !defined(__MINGW_EXTENSION))
 	procarch = info.u.s.wProcessorArchitecture;
 #else
 	procarch = info.wProcessorArchitecture;
@@ -2500,7 +2505,6 @@
 
 /* simulate flock by locking a range on the file */
 
-#define LK_ERR(f,i)	((f) ? (i = 0) : (errno = GetLastError()))
 #define LK_LEN		0xffff0000
 
 DllExport int
@@ -2516,34 +2520,46 @@
 	return -1;
     }
     fh = (HANDLE)_get_osfhandle(fd);
+    if (fh == (HANDLE)-1)  /* _get_osfhandle() already sets errno to EBADF */
+        return -1;
+
     memset(&o, 0, sizeof(o));
 
     switch(oper) {
     case LOCK_SH:		/* shared lock */
-	LK_ERR(LockFileEx(fh, 0, 0, LK_LEN, 0, &o),i);
+	if (LockFileEx(fh, 0, 0, LK_LEN, 0, &o))
+            i = 0;
 	break;
     case LOCK_EX:		/* exclusive lock */
-	LK_ERR(LockFileEx(fh, LOCKFILE_EXCLUSIVE_LOCK, 0, LK_LEN, 0, &o),i);
+	if (LockFileEx(fh, LOCKFILE_EXCLUSIVE_LOCK, 0, LK_LEN, 0, &o))
+            i = 0;
 	break;
     case LOCK_SH|LOCK_NB:	/* non-blocking shared lock */
-	LK_ERR(LockFileEx(fh, LOCKFILE_FAIL_IMMEDIATELY, 0, LK_LEN, 0, &o),i);
+	if (LockFileEx(fh, LOCKFILE_FAIL_IMMEDIATELY, 0, LK_LEN, 0, &o))
+            i = 0;
 	break;
     case LOCK_EX|LOCK_NB:	/* non-blocking exclusive lock */
-	LK_ERR(LockFileEx(fh,
-		       LOCKFILE_EXCLUSIVE_LOCK|LOCKFILE_FAIL_IMMEDIATELY,
-		       0, LK_LEN, 0, &o),i);
+	if (LockFileEx(fh, LOCKFILE_EXCLUSIVE_LOCK|LOCKFILE_FAIL_IMMEDIATELY,
+		       0, LK_LEN, 0, &o))
+            i = 0;
 	break;
     case LOCK_UN:		/* unlock lock */
-	LK_ERR(UnlockFileEx(fh, 0, LK_LEN, 0, &o),i);
+	if (UnlockFileEx(fh, 0, LK_LEN, 0, &o))
+            i = 0;
 	break;
     default:			/* unknown */
 	errno = EINVAL;
-	break;
+	return -1;
+    }
+    if (i == -1) {
+        if (GetLastError() == ERROR_LOCK_VIOLATION)
+            errno = WSAEWOULDBLOCK;
+        else
+            errno = EINVAL;
     }
     return i;
 }
 
-#undef LK_ERR
 #undef LK_LEN
 
 /*
@@ -2607,21 +2623,24 @@
 #if !defined __BORLANDC__ && !defined __MINGW32__      /* compiler intolerance */
     extern int sys_nerr;
 #endif
-    DWORD source = 0;
 
     if (e < 0 || e > sys_nerr) {
         dTHX;
 	if (e < 0)
 	    e = GetLastError();
 
-	if (FormatMessage(FORMAT_MESSAGE_FROM_SYSTEM, &source, e, 0,
-			  w32_strerror_buffer,
-			  sizeof(w32_strerror_buffer), NULL) == 0)
+	if (FormatMessage(FORMAT_MESSAGE_FROM_SYSTEM
+                         |FORMAT_MESSAGE_IGNORE_INSERTS, NULL, e, 0,
+			  w32_strerror_buffer, sizeof(w32_strerror_buffer),
+                          NULL) == 0)
+        {
 	    strcpy(w32_strerror_buffer, "Unknown Error");
-
+        }
 	return w32_strerror_buffer;
     }
+#undef strerror
     return strerror(e);
+#define strerror win32_strerror
 }
 
 DllExport void
@@ -3082,9 +3101,7 @@
 	    lock_held = 0;
 	}
 
-	LOCK_FDPID_MUTEX;
 	sv_setiv(*av_fetch(w32_fdpid, p[parent], TRUE), childpid);
-	UNLOCK_FDPID_MUTEX;
 
 	/* set process id so that it can be returned by perl's open() */
 	PL_forkprocess = childpid;
@@ -3125,7 +3142,6 @@
     int childpid, status;
     SV *sv;
 
-    LOCK_FDPID_MUTEX;
     sv = *av_fetch(w32_fdpid, PerlIO_fileno(pf), TRUE);
 
     if (SvIOK(sv))
@@ -3134,7 +3150,6 @@
 	childpid = 0;
 
     if (!childpid) {
-        UNLOCK_FDPID_MUTEX;
 	errno = EBADF;
         return -1;
     }
@@ -3145,7 +3160,6 @@
     fclose(pf);
 #endif
     SvIVX(sv) = 0;
-    UNLOCK_FDPID_MUTEX;
 
     if (win32_waitpid(childpid, &status, 0) == -1)
         return -1;
@@ -3495,6 +3509,27 @@
 }
 
 DllExport int
+win32_isatty(int fd)
+{
+    /* The Microsoft isatty() function returns true for *all*
+     * character mode devices, including "nul".  Our implementation
+     * should only return true if the handle has a console buffer.
+     */
+    DWORD mode;
+    HANDLE fh = (HANDLE)_get_osfhandle(fd);
+    if (fh == (HANDLE)-1) {
+        /* errno is already set to EBADF */
+        return 0;
+    }
+
+    if (GetConsoleMode(fh, &mode))
+        return 1;
+
+    errno = ENOTTY;
+    return 0;
+}
+
+DllExport int
 win32_dup(int fd)
 {
     return dup(fd);
@@ -4803,6 +4838,16 @@
     _control87(MCW_EM, MCW_EM);
 #endif
     MALLOC_INIT;
+
+    /* When the manifest resource requests Common-Controls v6 then
+     * user32.dll no longer registers all the Windows classes used for
+     * standard controls but leaves some of them to be registered by
+     * comctl32.dll.  InitCommonControls() doesn't do anything but calling
+     * it makes sure comctl32.dll gets loaded into the process and registers
+     * the standard control classes.  Without this even normal Windows APIs
+     * like MessageBox() can fail under some versions of Windows XP.
+     */
+    InitCommonControls();
 
     module = GetModuleHandle("ntdll.dll");
     if (module) {
Index: src/gnu/usr.bin/perl/win32/win32.h
diff -u src/gnu/usr.bin/perl/win32/win32.h:1.8 src/gnu/usr.bin/perl/win32/win32.h:1.9
--- win32/win32.h:1.8	Mon Sep 29 17:36:22 2008
+++ win32/win32.h	Fri Sep 24 15:07:11 2010
@@ -1,7 +1,7 @@
 /* WIN32.H
  *
  * (c) 1995 Microsoft Corporation. All rights reserved.
- * 		Developed by hip communications inc., http://info.hip.com/info/
+ * 		Developed by hip communications inc.
  *
  *    You may distribute under the terms of either the GNU General Public
  *    License or the Artistic License, as specified in the README file.
@@ -58,6 +58,23 @@
 #define  WIN32_LEAN_AND_MEAN
 #include <windows.h>
 
+/*
+ * Bug in winbase.h in mingw-w64 4.4.0-1 at least... they
+ * do #define GetEnvironmentStringsA GetEnvironmentStrings and fail
+ * to declare GetEnvironmentStringsA.
+ */
+#if defined(__MINGW64__) && defined(GetEnvironmentStringsA) && !defined(UNICODE)
+#ifdef __cplusplus
+extern "C" {
+#endif
+#undef GetEnvironmentStringsA
+WINBASEAPI LPCH WINAPI GetEnvironmentStringsA(VOID);
+#define GetEnvironmentStrings GetEnvironmentStringsA
+#ifdef __cplusplus
+}
+#endif
+#endif
+
 #ifdef   WIN32_LEAN_AND_MEAN		/* C file is NOT a Perl5 original. */
 #define  CONTEXT	PERL_CONTEXT	/* Avoid conflict of CONTEXT defs. */
 #endif /*WIN32_LEAN_AND_MEAN */
@@ -170,6 +187,14 @@
 
 /* Compiler-specific stuff. */
 
+#if defined(_MSC_VER) || defined(__MINGW32__)
+/* VC uses non-standard way to determine the size and alignment if bit-fields */
+/* MinGW will compiler with -mms-bitfields, so should use the same types */
+#  define PERL_BITFIELD8  unsigned char
+#  define PERL_BITFIELD16 unsigned short
+#  define PERL_BITFIELD32 unsigned int
+#endif
+
 #ifdef __BORLANDC__		/* Borland C++ */
 
 #if (__BORLANDC__ <= 0x520)
@@ -235,7 +260,9 @@
 #endif
 #define flushall	_flushall
 #define fcloseall	_fcloseall
+#ifndef isnan
 #define isnan		_isnan	/* ...same libraries as MSVC */
+#endif
 
 #ifndef _O_NOINHERIT
 #  define _O_NOINHERIT	0x0080
@@ -337,9 +364,9 @@
 #endif
 extern int		my_fclose(FILE *);
 extern int		my_fstat(int fd, Stat_t *sbufptr);
-extern char *		win32_get_privlib(const char *pl);
-extern char *		win32_get_sitelib(const char *pl);
-extern char *		win32_get_vendorlib(const char *pl);
+extern char *		win32_get_privlib(const char *pl, STRLEN *const len);
+extern char *		win32_get_sitelib(const char *pl, STRLEN *const len);
+extern char *		win32_get_vendorlib(const char *pl, STRLEN *const len);
 extern int		IsWin95(void);
 extern int		IsWinNT(void);
 
Index: src/gnu/usr.bin/perl/win32/win32iop.h
diff -u src/gnu/usr.bin/perl/win32/win32iop.h:1.8 src/gnu/usr.bin/perl/win32/win32iop.h:1.9
--- win32/win32iop.h:1.8	Mon Sep 29 17:36:22 2008
+++ win32/win32iop.h	Fri Sep 24 15:07:11 2010
@@ -86,6 +86,7 @@
 DllExport  int		win32_open(const char *path, int oflag,...);
 DllExport  int		win32_close(int fd);
 DllExport  int		win32_eof(int fd);
+DllExport  int		win32_isatty(int fd);
 DllExport  int		win32_read(int fd, void *buf, unsigned int cnt);
 DllExport  int		win32_write(int fd, const void *buf, unsigned int cnt);
 DllExport  int		win32_spawnvp(int mode, const char *cmdname,
@@ -161,7 +162,9 @@
 END_EXTERN_C
 
 #undef alarm
-#define alarm			win32_alarm
+#define alarm				win32_alarm
+#undef strerror
+#define strerror			win32_strerror
 
 /*
  * the following six(6) is #define in stdio.h
@@ -205,7 +208,6 @@
 #define ferror(f)			win32_ferror(f)
 #define errno 				(*win32_errno())
 #define environ				(*win32_environ())
-#define strerror			win32_strerror
 
 /*
  * redirect to our own version
@@ -251,6 +253,7 @@
 #define open			win32_open
 #define close(fd)		win32_close(fd)
 #define eof(fd)			win32_eof(fd)
+#define isatty(fd)		win32_isatty(fd)
 #define read(fd,b,s)		win32_read(fd,b,s)
 #define write(fd,b,s)		win32_write(fd,b,s)
 #define _open_osfhandle		win32_open_osfhandle
@@ -293,6 +296,10 @@
 #define realloc			win32_realloc
 #define free			win32_free
 #endif
+
+/* XXX Why are APIs like sleep(), times() etc. inside a block
+ * XXX guarded by "#ifndef WIN32IO_IS_STDIO"?
+ */
 
 #define pipe(fd)		win32_pipe((fd), 512, O_BINARY)
 #define pause()			win32_sleep((32767L << 16) + 32767)
Index: src/gnu/usr.bin/perl/win32/win32sck.c
diff -u src/gnu/usr.bin/perl/win32/win32sck.c:1.11 src/gnu/usr.bin/perl/win32/win32sck.c:1.12
--- win32/win32sck.c:1.11	Mon Oct 12 18:30:28 2009
+++ win32/win32sck.c	Fri Sep 24 15:07:11 2010
@@ -1,7 +1,7 @@
 /* win32sck.c
  *
  * (c) 1995 Microsoft Corporation. All rights reserved. 
- * 		Developed by hip communications inc., http://info.hip.com/info/
+ * 		Developed by hip communications inc.
  * Portions (c) 1993 Intergraph Corporation. All rights reserved.
  *
  *    You may distribute under the terms of either the GNU General Public
@@ -261,18 +261,8 @@
 #ifdef USE_SOCKETS_AS_HANDLES
     int i, fd, save_errno = errno;
     FD_SET nrd, nwr, nex;
+    bool just_sleep = TRUE;
 
-    /* winsock seems incapable of dealing with all three null fd_sets,
-     * so do the (millisecond) sleep as a special case
-     */
-    if (!(rd || wr || ex)) {
-	if (timeout)
-	    Sleep(timeout->tv_sec  * 1000 +
-		  timeout->tv_usec / 1000);	/* do the best we can */
-	else
-	    Sleep(UINT_MAX);
-	return 0;
-    }
     StartSockets();
 
     FD_ZERO(&nrd);
@@ -282,15 +272,30 @@
 	if (rd && PERL_FD_ISSET(i,rd)) {
 	    fd = TO_SOCKET(i);
 	    FD_SET((unsigned)fd, &nrd);
+            just_sleep = FALSE;
 	}
 	if (wr && PERL_FD_ISSET(i,wr)) {
 	    fd = TO_SOCKET(i);
 	    FD_SET((unsigned)fd, &nwr);
+            just_sleep = FALSE;
 	}
 	if (ex && PERL_FD_ISSET(i,ex)) {
 	    fd = TO_SOCKET(i);
 	    FD_SET((unsigned)fd, &nex);
+            just_sleep = FALSE;
 	}
+    }
+
+    /* winsock seems incapable of dealing with all three fd_sets being empty,
+     * so do the (millisecond) sleep as a special case
+     */
+    if (just_sleep) {
+	if (timeout)
+	    Sleep(timeout->tv_sec  * 1000 +
+		  timeout->tv_usec / 1000);	/* do the best we can */
+	else
+	    Sleep(UINT_MAX);
+	return 0;
     }
 
     errno = save_errno;
Index: src/gnu/usr.bin/perl/win32/bin/pl2bat.pl
diff -u src/gnu/usr.bin/perl/win32/bin/pl2bat.pl:1.5 src/gnu/usr.bin/perl/win32/bin/pl2bat.pl:1.6
--- win32/bin/pl2bat.pl:1.5	Tue Mar 28 19:23:15 2006
+++ win32/bin/pl2bat.pl	Fri Sep 24 15:07:11 2010
@@ -403,7 +403,7 @@
 A loop should be used to build up the argument list when not on
 Windows NT so more than 9 arguments can be processed.
 
-See also L</Disadvantages>.
+See also L</DISADVANTAGES>.
 
 =head1 SEE ALSO
 
Index: src/gnu/usr.bin/perl/win32/bin/search.pl
diff -u src/gnu/usr.bin/perl/win32/bin/search.pl:1.4 src/gnu/usr.bin/perl/win32/bin/search.pl:1.5
--- win32/bin/search.pl:1.4	Wed Dec  3 03:02:52 2003
+++ win32/bin/search.pl	Fri Sep 24 15:07:12 2010
@@ -182,8 +182,6 @@
 If any letter in -newer/-older is upper case, "or equal" is
 inserted into the test.
 
-You can always find the latest version on the World Wide Web in
-   http://www.wg.omron.co.jp/~jfriedl/perl/
 INLINE_LITERAL_TEXT
 	  exit(0);
       }
@@ -1143,10 +1141,7 @@
 
 This manual describes
 .I search
-as of version "941227.4". You can always find the latest version at
-.nf
-   http://www.wg.omron.co.jp/~jfriedl/perl/index.html
-.fi
+as of version "941227.4".
 
 .SH "QUICK EXAMPLE"
 Basic use is simple:
Index: src/gnu/usr.bin/perl/x2p/Makefile.SH
diff -u src/gnu/usr.bin/perl/x2p/Makefile.SH:1.12 src/gnu/usr.bin/perl/x2p/Makefile.SH:1.13
--- x2p/Makefile.SH:1.12	Mon Oct 12 18:30:28 2009
+++ x2p/Makefile.SH	Fri Sep 24 15:07:12 2010
@@ -143,6 +143,8 @@
 clean:
 	rm -f a2p$(EXE_EXT) psed *$(OBJ_EXT) $(plexe) $(plc) $(plm)
 
+distclean: veryclean
+
 realclean: clean
 	-rmdir .depending
 	rm -f core $(addedbyconf) all malloc.c
Index: src/gnu/usr.bin/perl/x2p/a2p.h
diff -u src/gnu/usr.bin/perl/x2p/a2p.h:1.10 src/gnu/usr.bin/perl/x2p/a2p.h:1.11
--- x2p/a2p.h:1.10	Mon Oct 12 18:30:28 2009
+++ x2p/a2p.h	Fri Sep 24 15:07:12 2010
@@ -433,7 +433,6 @@
 
 EXT bool do_split INIT(FALSE);
 EXT bool split_to_array INIT(FALSE);
-EXT bool set_array_base INIT(FALSE);
 EXT bool saw_RS INIT(FALSE);
 EXT bool saw_OFS INIT(FALSE);
 EXT bool saw_ORS INIT(FALSE);
Index: src/gnu/usr.bin/perl/x2p/a2p.pod
diff -u src/gnu/usr.bin/perl/x2p/a2p.pod:1.4 src/gnu/usr.bin/perl/x2p/a2p.pod:1.5
--- x2p/a2p.pod:1.4	Tue Mar 28 19:23:15 2006
+++ x2p/a2p.pod	Fri Sep 24 15:07:12 2010
@@ -122,9 +122,9 @@
 down past some conditionals that test the entire record so that the
 split is not done as often.
 
-For aesthetic reasons you may wish to change the array base $[ from 1
-back to perl's default of 0, but remember to change all array
-subscripts AND all substr() and index() operations to match.
+For aesthetic reasons you may wish to change index variables from being
+1-based (awk style) to 0-based (Perl style).  Be sure to change all
+operations the variable is involved in to match.
 
 Cute comments that say "# Here is a workaround because awk is dumb"
 are passed through unmodified.
@@ -148,7 +148,7 @@
 catches the most common case, but doesn't analyze embedded blocks for
 subtler cases.
 
-ARGV[0] translates to $ARGV0, but ARGV[n] translates to $ARGV[$n].  A
+ARGV[0] translates to $ARGV0, but ARGV[n] translates to $ARGV[$n-1].  A
 loop that tries to iterate over ARGV[0] won't find it.
 
 =head1 ENVIRONMENT
Index: src/gnu/usr.bin/perl/x2p/a2py.c
diff -u src/gnu/usr.bin/perl/x2p/a2py.c:1.9 src/gnu/usr.bin/perl/x2p/a2py.c:1.10
--- x2p/a2py.c:1.9	Mon Oct 12 18:30:28 2009
+++ x2p/a2py.c	Fri Sep 24 15:07:12 2010
@@ -428,7 +428,7 @@
 	}
 	for (d = s; isALPHA(*s) || isDIGIT(*s) || *s == '_'; )
 	    s++;
-	split_to_array = set_array_base = TRUE;
+	split_to_array = TRUE;
 	if (d != s)
 	{
 	    yylval = string(d,s-d);
@@ -464,8 +464,6 @@
 
     case 'a': case 'A':
 	SNARFWORD;
-	if (strEQ(d,"ARGC"))
-	    set_array_base = TRUE;
 	if (strEQ(d,"ARGV")) {
 	    yylval=numary(string("ARGV",0));
 	    XOP(VAR);
@@ -598,7 +596,6 @@
 	if (strEQ(d,"in"))
 	    XTERM(IN);
 	if (strEQ(d,"index")) {
-	    set_array_base = TRUE;
 	    XTERM(INDEX);
 	}
 	if (strEQ(d,"int")) {
@@ -644,7 +641,6 @@
     case 'm': case 'M':
 	SNARFWORD;
 	if (strEQ(d,"match")) {
-	    set_array_base = TRUE;
 	    XTERM(MATCH);
 	}
 	if (strEQ(d,"m"))
@@ -653,7 +649,7 @@
     case 'n': case 'N':
 	SNARFWORD;
 	if (strEQ(d,"NF"))
-	    do_chop = do_split = split_to_array = set_array_base = TRUE;
+	    do_chop = do_split = split_to_array = TRUE;
 	if (strEQ(d,"next")) {
 	    saw_line_op = TRUE;
 	    XTERM(NEXT);
@@ -719,11 +715,9 @@
     case 's': case 'S':
 	SNARFWORD;
 	if (strEQ(d,"split")) {
-	    set_array_base = TRUE;
 	    XOP(SPLIT);
 	}
 	if (strEQ(d,"substr")) {
-	    set_array_base = TRUE;
 	    XTERM(SUBSTR);
 	}
 	if (strEQ(d,"sub"))
@@ -1204,7 +1198,6 @@
     str_cat(key,"[]");
     hstore(symtab,key->str_ptr,str_make("1"));
     str_free(key);
-    set_array_base = TRUE;
     return arg;
 }
 
Index: src/gnu/usr.bin/perl/x2p/walk.c
diff -u src/gnu/usr.bin/perl/x2p/walk.c:1.10 src/gnu/usr.bin/perl/x2p/walk.c:1.11
--- x2p/walk.c:1.10	Mon Oct 12 18:30:28 2009
+++ x2p/walk.c	Fri Sep 24 15:07:12 2010
@@ -84,11 +84,6 @@
 	str = walk(0,level,ops[node+1].ival,&numarg,P_MIN);
 	if (do_split && need_entire && !absmaxfld)
 	    split_to_array = TRUE;
-	if (do_split && split_to_array)
-	    set_array_base = TRUE;
-	if (set_array_base) {
-	    str_cat(str,"$[ = 1;\t\t\t# set array base to 1\n");
-	}
 	if (fswitch && !const_FS)
 	    const_FS = fswitch;
 	if (saw_FS > 1 || saw_RS)
@@ -650,9 +645,10 @@
 	str_set(str,"substr(");
 	str_scat(str,fstr=walk(1,level,ops[node+1].ival,&numarg,P_COMMA+1));
 	str_free(fstr);
-	str_cat(str,", ");
+	str_cat(str,", (");
 	str_scat(str,fstr=walk(1,level,ops[node+2].ival,&numarg,P_COMMA+1));
 	str_free(fstr);
+	str_cat(str,")-1");
 	if (len == 3) {
 	    str_cat(str,", ");
 	    str_scat(str,fstr=walk(1,level,ops[node+3].ival,&numarg,P_COMMA+1));
@@ -712,13 +708,13 @@
 	break;
     case OINDEX:
 	str = str_new(0);
-	str_set(str,"index(");
+	str_set(str,"(1+index(");
 	str_scat(str,fstr=walk(1,level,ops[node+1].ival,&numarg,P_COMMA+1));
 	str_free(fstr);
 	str_cat(str,", ");
 	str_scat(str,fstr=walk(1,level,ops[node+2].ival,&numarg,P_COMMA+1));
 	str_free(fstr);
-	str_cat(str,")");
+	str_cat(str,"))");
 	numeric = 1;
 	break;
     case OMATCH:
@@ -729,7 +725,7 @@
 	str_cat(str," =~ ");
 	str_scat(str,fstr=walk(1,level,ops[node+2].ival,&numarg,P_MATCH+1));
 	str_free(fstr);
-	str_cat(str," && ($RLENGTH = length($&), $RSTART = length($`)+1)");
+	str_cat(str," ? scalar($RLENGTH = length($&), $RSTART = length($`)+1) : 0");
 	numeric = 1;
 	break;
     case OUSERDEF:
@@ -845,7 +841,7 @@
 	    for (t = tmp2str->str_ptr, d=tokenbuf; *t; d++,t++) {
 		if (*t == '&')
                    *d++ = '$' + (char)128;
-		else if (*t == '$')
+		else if (*t == '$' || *t == '/')
                    *d++ = '\\' + (char)128;
 		*d = *t + 128;
 	    }
@@ -970,12 +966,12 @@
 	    }
 	    else if (strEQ(str->str_ptr,"$NF")) {
 		numeric = 1;
-		str_set(str,"$#Fld");
+		str_set(str,"($#Fld+1)");
 	    }
 	    else if (strEQ(str->str_ptr,"$0"))
 		str_set(str,"$_");
 	    else if (strEQ(str->str_ptr,"$ARGC"))
-		str_set(str,"($#ARGV+1)");
+		str_set(str,"($#ARGV+2)");
 	}
 	else {
 #ifdef NOTDEF
@@ -988,7 +984,7 @@
 	    str_cat(tmpstr,"[]");
 	    tmp2str = hfetch(symtab,tmpstr->str_ptr);
 	    if (tmp2str && atoi(tmp2str->str_ptr))
-		str_cat(str,"[");
+		str_cat(str,"[(");
 	    else
 		str_cat(str,"{");
 	    str_scat(str,fstr=walk(1,level,ops[node+2].ival,&numarg,P_MIN));
@@ -999,7 +995,7 @@
 	    }
 	    else {
 		if (tmp2str && atoi(tmp2str->str_ptr))
-		    strcpy(tokenbuf,"]");
+		    strcpy(tokenbuf,")-1]");
 		else
 		    strcpy(tokenbuf,"}");
                *tokenbuf += (char)128;
@@ -1012,10 +1008,10 @@
 	str = str_new(0);
 	if (split_to_array) {
 	    str_set(str,"$Fld");
-	    str_cat(str,"[");
+	    str_cat(str,"[(");
 	    str_scat(str,fstr=walk(1,level,ops[node+1].ival,&numarg,P_MIN));
 	    str_free(fstr);
-	    str_cat(str,"]");
+	    str_cat(str,")-1]");
 	}
 	else {
 	    i = atoi(walk(1,level,ops[node+1].ival,&numarg,P_MIN)->str_ptr);
@@ -1470,7 +1466,7 @@
 	tmp2str = hfetch(symtab,str->str_ptr);
 	if (tmp2str && atoi(tmp2str->str_ptr)) {
 	    sprintf(tokenbuf,
-	      "foreach %s ($[ .. $#%s) ",
+	      "foreach %s (0 .. $#%s) ",
 	      s,
 	      d+1);
 	}
