This is a multi-part message in MIME format.
--------------0A91985E56EC8B33A8A03609
Content-Type: text/plain; charset=utf-8; format=flowed
Content-Transfer-Encoding: 7bit

Hi,


The version of Archive::Tar part of the base system's Perl contains 
CVE-2018-12015:

Original bug report: https://rt.cpan.org/Public/Bug/Display.html?id=125523

Original commit with the fix: 
https://github.com/jib/archive-tar-new/commit/ae65651eab053fc6dc4590dbb863a268215c1fc5

The vulnerability was fixed in version 2.28 of Archive::Tar.


The attached patch is for OpenBSD 6.3.


Greetings,

Matthias


--------------0A91985E56EC8B33A8A03609
Content-Type: text/plain; charset=UTF-8;
 name="patch-perl-CVE-2018-12015"
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment;
 filename="patch-perl-CVE-2018-12015"

CVE-2018-12015: Directory Traversal in Archive::Tar

--------------------------------------------------------------------------------

From ae65651eab053fc6dc4590dbb863a268215c1fc5 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20P=C3=ADsa=C5=99?= <ppisar@redhat.com>
Date: Fri, 8 Jun 2018 11:45:40 +0100
Subject: [PATCH] [PATCH] Remove existing files before overwriting them

Archive should extract only the latest same-named entry.
Extracted regular file should not be writtent into existing block
device (or any other one).

https://rt.cpan.org/Ticket/Display.html?id=125523

Signed-off-by: Chris 'BinGOs' Williams <chris@bingosnet.co.uk>
---
 lib/Archive/Tar.pm | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/lib/Archive/Tar.pm b/lib/Archive/Tar.pm
--- ./cpan/Archive-Tar/lib/Archive/Tar.pm.orig	Fri Jun 30 14:03:20 2017
+++ ./cpan/Archive-Tar/lib/Archive/Tar.pm	Wed Jun 13 07:58:56 2018
@@ -845,6 +845,20 @@ sub _extract_file {
         return;
     }
 
+    ### If a file system already contains a block device with the same name as
+    ### the being extracted regular file, we would write the file's content
+    ### to the block device. So remove the existing file (block device) now.
+    ### If an archive contains multiple same-named entries, the last one
+    ### should replace the previous ones. So remove the old file now.
+    ### If the old entry is a symlink to a file outside of the CWD, the new
+    ### entry would create a file there. This is CVE-2018-12015
+    ### <https://rt.cpan.org/Ticket/Display.html?id=125523>.
+    if (-l $full || -e _) {
+	if (!unlink $full) {
+	    $self->_error( qq[Could not remove old file '$full': $!] );
+	    return;
+	}
+    }
     if( length $entry->type && $entry->is_file ) {
         my $fh = IO::File->new;
         $fh->open( '>' . $full ) or (
--- t/porting/customized.dat.orig	Fri Jun 30 14:03:22 2017
+++ t/porting/customized.dat	Wed Jun 13 18:13:16 2018
@@ -1,7 +1,7 @@
 Archive::Tar cpan/Archive-Tar/bin/ptar 5e9f3c6f565114193d98847ed8569cd0010c229c
 Archive::Tar cpan/Archive-Tar/bin/ptardiff 5a9f4c01a0390bf98da7e63f1c0bbf5bc74d12c7
 Archive::Tar cpan/Archive-Tar/bin/ptargrep eb74056c434acf314ac5a122e33bdd2ef99e6edb
-Archive::Tar cpan/Archive-Tar/lib/Archive/Tar.pm b7e13134a5bcabe8c33fb0729d2f2f80e924059a
+Archive::Tar cpan/Archive-Tar/lib/Archive/Tar.pm 1fed1865b952e6d6ddb1d8307daea261b01eaf29
 Archive::Tar cpan/Archive-Tar/lib/Archive/Tar/Constant.pm 18af3e90665fcf2ab40c5b02c10ba0ea3ac34d0e
 Archive::Tar cpan/Archive-Tar/lib/Archive/Tar/File.pm c0b849aa3d164305d7cb084ba3adf8d505971d6b
 CPAN cpan/CPAN/lib/App/Cpan.pm b2a9928c41083c82e884f6dc6d4b7043a2b0e351
