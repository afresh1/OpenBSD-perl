From 759fc846fd1dea0c293b091786c9260a39eb8715 Mon Sep 17 00:00:00 2001
From: "Craig A. Berry" <craig.a.berry@gmail.com>
Date: Sat, 13 Feb 2016 09:12:01 -0500
Subject: [PATCH 2/2] VMS patch for duplicate env entries

---
 vms/vms.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/vms/vms.c b/vms/vms.c
index 5367840..d3a57ea 100644
--- a/vms/vms.c
+++ b/vms/vms.c
@@ -1319,7 +1319,9 @@ prime_env_iter(void)
     if (!str$case_blind_compare(env_tables[i],&crtlenv)) {
       char *start;
       int j;
-      for (j = 0; environ[j]; j++) { 
+      /* Start at the end, so if there is a duplicate we keep the first one. */
+      for (j = 0; environ[j]; j++);
+      for (j--; j >= 0; j--) {
         if (!(start = strchr(environ[j],'='))) {
           if (ckWARN(WARN_INTERNAL)) 
             Perl_warner(aTHX_ packWARN(WARN_INTERNAL),"Ill-formed CRTL environ value \"%s\"\n",environ[j]);
-- 
2.7.1

